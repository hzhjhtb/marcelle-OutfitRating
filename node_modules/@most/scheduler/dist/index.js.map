{"version":3,"file":"index.js","sources":["../src/ScheduledTask.ts","../src/RelativeScheduler.ts","../src/task.ts","../src/Scheduler.ts","../src/Timeline.ts","../src/ClockTimer.ts","../src/clock.ts","../src/schedule.ts","../src/relative.ts","../src/index.ts"],"sourcesContent":["/** @license MIT License (c) copyright 2010-2017 original author or authors */\nimport { ScheduledTask, Time, Task, Scheduler } from '@most/types'\n\nexport default class ScheduledTaskImpl implements ScheduledTask {\n  /**\n   * @mutable\n   */\n  time: Time;\n  readonly localOffset: Time;\n  readonly period: Time;\n  readonly task: Task;\n  readonly scheduler: Scheduler;\n  /**\n   * @mutable\n   */\n  active: boolean;\n\n  constructor(time: Time, localOffset: Time, period: Time, task: Task, scheduler: Scheduler) {\n    this.time = time\n    this.localOffset = localOffset\n    this.period = period\n    this.task = task\n    this.scheduler = scheduler\n    this.active = true\n  }\n\n  run(): void {\n    return this.task.run(this.time - this.localOffset)\n  }\n\n  error(e: Error): void {\n    return this.task.error(this.time - this.localOffset, e)\n  }\n\n  dispose(): void {\n    this.active = false\n    this.scheduler.cancel(this)\n    return this.task.dispose()\n  }\n}\n","import { Scheduler, Time, Task, ScheduledTask } from '@most/types'\n\nexport default class RelativeScheduler implements Scheduler {\n  readonly origin: Time;\n  readonly scheduler: Scheduler;\n\n  constructor(origin: Time, scheduler: Scheduler) {\n    this.origin = origin\n    this.scheduler = scheduler\n  }\n\n  currentTime(): Time {\n    return this.scheduler.currentTime() - this.origin\n  }\n\n  scheduleTask(localOffset: Time, delay: Time, period: Time, task: Task): ScheduledTask {\n    return this.scheduler.scheduleTask(localOffset + this.origin, delay, period, task)\n  }\n\n  relative(origin: Time): Scheduler {\n    return new RelativeScheduler(origin + this.origin, this.scheduler)\n  }\n\n  cancel(task: ScheduledTask): void {\n    return this.scheduler.cancel(task)\n  }\n\n  cancelAll(f: (task: ScheduledTask) => boolean): void {\n    return this.scheduler.cancelAll(f)\n  }\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nexport interface DeferrableTask<E, A> {\n  run(): A\n  error(e: Error): E\n}\n\nexport const defer = <E, A>(task: DeferrableTask<E, A>): Promise<E | A> =>\n  Promise.resolve(task).then(runTask)\n\nexport function runTask <E, A>(task: DeferrableTask<E, A>): E | A {\n  try {\n    return task.run()\n  } catch (e) {\n    return task.error(e)\n  }\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nimport ScheduledTaskImpl from './ScheduledTask'\nimport RelativeScheduler from './RelativeScheduler'\nimport { runTask } from './task'\nimport { Scheduler, Time, Timer, Timeline, Task, ScheduledTask } from '@most/types'\n\nexport default class SchedulerImpl implements Scheduler {\n  private readonly timer: Timer\n  private readonly timeline: Timeline\n  private _timer: Time | null\n  private _nextArrival: Time;\n  private _runReadyTasksBound = () => this._runReadyTasks()\n\n  constructor(timer: Timer, timeline: Timeline) {\n    this.timer = timer\n    this.timeline = timeline\n\n    this._timer = null\n    this._nextArrival = Infinity\n  }\n\n  currentTime(): Time {\n    return this.timer.now()\n  }\n\n  scheduleTask(localOffset: Time, delay: Time, period: Time, task: Task): ScheduledTaskImpl {\n    const time = this.currentTime() + Math.max(0, delay)\n    const st = new ScheduledTaskImpl(time, localOffset, period, task, this)\n\n    this.timeline.add(st)\n    this._scheduleNextRun()\n    return st\n  }\n\n  relative(offset: Time): Scheduler {\n    return new RelativeScheduler(offset, this)\n  }\n\n  cancel(task: ScheduledTaskImpl): void {\n    task.active = false\n    if (this.timeline.remove(task)) {\n      this._reschedule()\n    }\n  }\n\n  // @deprecated\n  cancelAll(f: (task: ScheduledTask) => boolean): void {\n    this.timeline.removeAll(f)\n    this._reschedule()\n  }\n\n  _reschedule(): void {\n    if (this.timeline.isEmpty()) {\n      this._unschedule()\n    } else {\n      this._scheduleNextRun()\n    }\n  }\n\n  _unschedule(): void {\n    this.timer.clearTimer(this._timer)\n    this._timer = null\n  }\n\n  _scheduleNextRun(): void {\n    if (this.timeline.isEmpty()) {\n      return\n    }\n\n    const nextArrival = this.timeline.nextArrival()\n\n    if (this._timer === null) {\n      this._scheduleNextArrival(nextArrival)\n    } else if (nextArrival < this._nextArrival) {\n      this._unschedule()\n      this._scheduleNextArrival(nextArrival)\n    }\n  }\n\n  _scheduleNextArrival(nextArrival: Time): void {\n    this._nextArrival = nextArrival\n    const delay = Math.max(0, nextArrival - this.currentTime())\n    this._timer = this.timer.setTimer(this._runReadyTasksBound, delay)\n  }\n\n  _runReadyTasks(): void {\n    this._timer = null\n    this.timeline.runTasks(this.currentTime(), runTask)\n    this._scheduleNextRun()\n  }\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nimport { findIndex, removeAll } from '@most/prelude'\nimport { Time, Timeline } from '@most/types'\nimport ScheduledTaskImpl from './ScheduledTask'\n\nexport default class TimelineImpl implements Timeline {\n  private tasks: TimeSlot[];\n\n  constructor() {\n    this.tasks = []\n  }\n\n  nextArrival(): number {\n    return this.isEmpty() ? Infinity : this.tasks[0].time\n  }\n\n  isEmpty(): boolean {\n    return this.tasks.length === 0\n  }\n\n  add(st: ScheduledTaskImpl): void {\n    insertByTime(st, this.tasks)\n  }\n\n  remove(st: ScheduledTaskImpl): boolean {\n    const i = binarySearch(getTime(st), this.tasks)\n\n    if (i >= 0 && i < this.tasks.length) {\n      const events = this.tasks[i].events\n      const at = findIndex(st, events)\n      if (at >= 0) {\n        events.splice(at, 1)\n        if (events.length === 0) {\n          this.tasks.splice(i, 1)\n        }\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * @deprecated\n   */\n  removeAll(f: (task: ScheduledTaskImpl) => boolean): void {\n    for (let i = 0; i < this.tasks.length; ++i) {\n      removeAllFrom(f, this.tasks[i])\n    }\n  }\n\n  runTasks(t: Time, runTask: (task: ScheduledTaskImpl) => void): void {\n    const tasks = this.tasks\n    const l = tasks.length\n    let i = 0\n\n    while (i < l && tasks[i].time <= t) {\n      ++i\n    }\n\n    this.tasks = tasks.slice(i)\n\n    // Run all ready tasks\n    for (let j = 0; j < i; ++j) {\n      this.tasks = runReadyTasks(runTask, tasks[j].events, this.tasks)\n    }\n  }\n}\n\nfunction runReadyTasks(runTask: (task: ScheduledTaskImpl) => void, events: ArrayLike<ScheduledTaskImpl>, tasks: TimeSlot[]): TimeSlot[] {\n  for (let i = 0; i < events.length; ++i) {\n    const task = events[i]\n\n    if (task.active) {\n      runTask(task)\n\n      // Reschedule periodic repeating tasks\n      // Check active again, since a task may have canceled itself\n      if (task.period >= 0 && task.active) {\n        task.time = task.time + task.period\n        insertByTime(task, tasks)\n      }\n    }\n  }\n\n  return tasks\n}\n\nfunction insertByTime(task: ScheduledTaskImpl, timeslots: TimeSlot[]): void {\n  const l = timeslots.length\n  const time = getTime(task)\n\n  if (l === 0) {\n    timeslots.push(newTimeslot(time, [task]))\n    return\n  }\n\n  const i = binarySearch(time, timeslots)\n\n  if (i >= l) {\n    timeslots.push(newTimeslot(time, [task]))\n  } else {\n    insertAtTimeslot(task, timeslots, time, i)\n  }\n}\n\nfunction insertAtTimeslot(task: ScheduledTaskImpl, timeslots: TimeSlot[], time: Time, i: number): void {\n  const timeslot = timeslots[i]\n  if (time === timeslot.time) {\n    addEvent(task, timeslot.events)\n  } else {\n    timeslots.splice(i, 0, newTimeslot(time, [task]))\n  }\n}\n\nfunction addEvent(task: ScheduledTaskImpl, events: ScheduledTaskImpl[]): void {\n  if (events.length === 0 || task.time >= events[events.length - 1].time) {\n    events.push(task)\n  } else {\n    spliceEvent(task, events)\n  }\n}\n\nfunction spliceEvent(task: ScheduledTaskImpl, events: ScheduledTaskImpl[]): void {\n  for (let j = 0; j < events.length; j++) {\n    if (task.time < events[j].time) {\n      events.splice(j, 0, task)\n      break\n    }\n  }\n}\n\nfunction getTime(scheduledTask: ScheduledTaskImpl): Time {\n  return Math.floor(scheduledTask.time)\n}\n\n/**\n * @deprecated\n */\nfunction removeAllFrom(f: (task: ScheduledTaskImpl) => boolean, timeslot: TimeSlot): void {\n  timeslot.events = removeAll(f, timeslot.events)\n}\n\nfunction binarySearch(t: Time, sortedArray: ArrayLike<TimeSlot>): number {\n  let lo = 0\n  let hi = sortedArray.length\n  let mid, y\n\n  while (lo < hi) {\n    mid = Math.floor((lo + hi) / 2)\n    y = sortedArray[mid]\n\n    if (t === y.time) {\n      return mid\n    } else if (t < y.time) {\n      hi = mid\n    } else {\n      lo = mid + 1\n    }\n  }\n  return hi\n}\n\ninterface TimeSlot {\n  time: Time\n  events: ScheduledTaskImpl[]\n}\nconst newTimeslot = (t: Time, events: ScheduledTaskImpl[]): TimeSlot => ({ time: t, events: events })\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nimport { defer, DeferrableTask } from './task'\nimport { Clock, Time, Timer } from '@most/types'\n\n/* global setTimeout, clearTimeout */\n\nexport default class ClockTimer implements Timer {\n  private _clock: Clock;\n  constructor(clock: Clock) {\n    this._clock = clock\n  }\n\n  now(): Time {\n    return this._clock.now()\n  }\n\n  setTimer <A>(f: () => A, dt: Time): NodeJS.Timeout | Asap<A> {\n    return dt <= 0 ? runAsap(f) : setTimeout(f, dt)\n  }\n\n  clearTimer <A>(t: number | Asap<A>): void {\n    return t instanceof Asap ? t.cancel() : clearTimeout(t)\n  }\n}\n\nclass Asap<A> implements DeferrableTask<never, A | undefined> {\n  private readonly f: () => A;\n  /**\n   * @mutable\n   */\n  public active: boolean;\n\n  constructor(f: () => A) {\n    this.f = f\n    this.active = true\n  }\n\n  run(): A | undefined {\n    if (this.active) {\n      return this.f()\n    }\n  }\n\n  error(e: Error): never {\n    throw e\n  }\n\n  cancel(): void {\n    this.active = false\n  }\n}\n\nfunction runAsap <A>(f: () => A): Asap<A> {\n  const task = new Asap(f)\n  defer(task)\n  return task\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\nimport { Clock, Time } from '@most/types'\n\n/* global performance, process */\n\nexport class RelativeClock implements Clock {\n  private readonly clock: Clock;\n  private readonly origin: Time;\n  constructor(clock: Clock, origin: Time) {\n    this.origin = origin\n    this.clock = clock\n  }\n\n  now(): Time {\n    return this.clock.now() - this.origin\n  }\n}\n\nexport class HRTimeClock implements Clock {\n  private readonly hrtime: (time: [number, number]) => [number, number];\n  private readonly origin: [Time, Time];\n  constructor(hrtime: (time: [number, number]) => [number, number], origin: [Time, Time]) {\n    this.origin = origin\n    this.hrtime = hrtime\n  }\n\n  now(): Time {\n    const hrt = this.hrtime(this.origin)\n    return (hrt[0] * 1e9 + hrt[1]) / 1e6\n  }\n}\n\nexport const clockRelativeTo = (clock: Clock): Clock =>\n  new RelativeClock(clock, clock.now())\n\nexport const newPerformanceClock = (): Clock =>\n  clockRelativeTo(performance)\n\n/**\n * @deprecated will be removed in 2.0.0\n * Date.now is not monotonic, and performance.now is ubiquitous:\n * @see https://caniuse.com/#search=performance.now\n */\nexport const newDateClock = (): Clock =>\n  clockRelativeTo(Date)\n\nexport const newHRTimeClock = (): Clock =>\n  new HRTimeClock(process.hrtime, process.hrtime())\n\nexport const newPlatformClock = (): Clock => {\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n    return newPerformanceClock()\n  } else if (typeof process !== 'undefined' && typeof process.hrtime === 'function') {\n    return newHRTimeClock()\n  }\n\n  return newDateClock()\n}\n","import { curry2, curry3 } from '@most/prelude'\nimport { Scheduler, Time, Task, ScheduledTask } from '@most/types'\n\n/**\n * Read the current time from the provided Scheduler\n */\nexport const currentTime = (scheduler: Scheduler): Time =>\n  scheduler.currentTime()\n\n/**\n * Schedule a task to run as soon as possible, but\n * not in the current call stack\n */\nexport const asap = curry2((task: Task, scheduler: Scheduler): ScheduledTask =>\n  scheduler.scheduleTask(0, 0, -1, task))\n\n/**\n * Schedule a task to run after a millisecond delay\n */\nexport const delay = curry3((delay: Time, task: Task, scheduler: Scheduler): ScheduledTask =>\n  scheduler.scheduleTask(0, delay, -1, task))\n\n/**\n * Schedule a task to run periodically, with the\n * first run starting asap\n */\nexport const periodic = curry3((period: Time, task: Task, scheduler: Scheduler): ScheduledTask =>\n  scheduler.scheduleTask(0, 0, period, task))\n\n/**\n * Cancel a scheduledTask\n */\nexport const cancelTask = (scheduledTask: ScheduledTask): void =>\n  scheduledTask.dispose()\n\n/**\n * Cancel all ScheduledTasks for which a predicate is true\n * @deprecated Will be removed in 2.0.0\n */\nexport const cancelAllTasks = curry2((predicate: (task: ScheduledTask) => boolean, scheduler: Scheduler): void => {\n  console.warn(`DEPRECATED cancelAllTasks to be removed in 2.0.0`)\n  return scheduler.cancelAll(predicate)\n})\n","import RelativeScheduler from './RelativeScheduler'\nimport { curry2 } from '@most/prelude'\nimport { Time, Scheduler } from '@most/types'\n\nexport const schedulerRelativeTo = curry2((offset: Time, scheduler: Scheduler): Scheduler =>\n  new RelativeScheduler(offset, scheduler))\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nimport { curry2 } from '@most/prelude'\n\nimport Scheduler from './Scheduler'\nimport TimelineImpl from './Timeline'\nimport ClockTimer from './ClockTimer'\nimport { newPlatformClock } from './clock'\nimport { Clock, Timer, Timeline } from '@most/types'\n\nexport * from './clock'\nexport * from './schedule'\nexport * from './relative'\n\nexport const newScheduler = curry2((timer: Timer, timeline: Timeline): Scheduler => new Scheduler(timer, timeline))\n\nexport const newDefaultScheduler = (): Scheduler => new Scheduler(newDefaultTimer(), new TimelineImpl())\n\nexport const newDefaultTimer = (): Timer => new ClockTimer(newPlatformClock())\nexport const newClockTimer = (clock: Clock): Timer => new ClockTimer(clock)\n\nexport const newTimeline = (): Timeline => new TimelineImpl()\n"],"names":["findIndex","removeAll","curry2","curry3","Scheduler"],"mappings":"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"}