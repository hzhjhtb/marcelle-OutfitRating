function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class n{refCount(t){return r("refCount")}incRef(t){return r("incRef")}timerAvailable(){return!0}time(t){return r("time")}read(t){return r("read")}readSync(t){return r("readSync")}readToGPU(t,e){return r("readToGPU")}numDataIds(){return r("numDataIds")}disposeData(t,e){return r("disposeData")}write(t,e,n){return r("write")}move(t,e,n,i,s){return r("move")}memory(){return r("memory")}floatPrecision(){return r("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return r("dispose")}}function r(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,a(t,e,n)}function s(t,e,n){return Math.max(t,Math.min(e,n))}function o(t){return t%2==0?t:t+1}function a(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function l(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function c(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function u(t,e,n=""){c(f(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function h(t){c(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function d(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||M(t)&&!n)for(let r=0;r<t.length;++r)d(t[r],e,n);else e.push(t);return e}function p(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function f(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function m(t){return t%1==0}function g(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function y(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function b(t,e=(t=>0),n,r=setTimeout){return new Promise(((i,s)=>{let o=0;const a=()=>{if(t())return void i();o++;const l=e(o);null!=n&&o>=n?s():r(a,l)};a()}))}function v(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function x(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),c(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),c(t.every((t=>m(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function w(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:x(e,t).sort();let o=0;for(let e=0;e<t.length;++e){if(null!=s){if(s[o]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==s[o]||s[o]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),s[o]<=e&&o++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function S(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function _(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function k(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function T(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function E(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function M(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function C(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function A(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function N(t){return"string"==typeof t||t instanceof String}function I(t){return"boolean"==typeof t}function $(t){return"number"==typeof t}function R(t){return Array.isArray(t)?R(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":$(t)?"float32":N(t)?"string":I(t)?"bool":"float32"}function O(t){return!!(t&&t.constructor&&t.call&&t.apply)}function P(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function L(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function D(t,e,n,r=!1){const i=new Array;if(1===e.length){const s=e[0]*(r?2:1);for(let e=0;e<s;e++)i[e]=n[t+e]}else{const s=e[0],o=e.slice(1),a=o.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<s;e++)i[e]=D(t+e*a,o,n,r)}return i}function F(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return D(0,t,e,n)}function z(t,e){const n=B(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function B(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function U(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return F(t,new Float32Array(n));if("int32"===e)return F(t,new Int32Array(n));if("bool"===e)return F(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function V(t){t.forEach((e=>{c(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function j(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function W(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function H(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=q,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(H(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function q(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function X(){return K}let Y,K=null;function Z(){if(null==Y){let t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Y=t}return Y}function J(t,e){const n=function(){const t=Z();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const Q="Cos",tt="Erf",et="Exp",nt="Log",rt="Mod",it="Pow",st="Sin",ot="Sub",at="Tan";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lt(...t){X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ct=J("kernelRegistry",(()=>new Map)),ut=J("gradRegistry",(()=>new Map));function ht(t,e){const n=gt(t,e);return ct.get(n)}function dt(t){return ut.get(t)}function pt(t){const e=ct.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function ft(t){const{kernelName:e,backendName:n}=t,r=gt(e,n);ct.has(r)&&lt(`The kernel '${e}' for backend '${n}' is already registered`),ct.set(r,t)}function mt(t){const{kernelName:e}=t;ut.has(e)&&X().getBool("DEBUG")&&lt(`Overriding the gradient for '${e}'`),ut.set(e,t)}function gt(t,e){return`${e}_${t}`}var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function bt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function vt(t){var e=t.default;if("function"==typeof e){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var xt=St,wt=null;try{wt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function St(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function _t(t){return!0===(t&&t.__isLong__)}St.prototype.__isLong__,Object.defineProperty(St.prototype,"__isLong__",{value:!0}),St.isLong=_t;var kt={},Tt={};function Et(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=Tt[t])?r:(n=Ct(t,(0|t)<0?-1:0,!0),i&&(Tt[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=kt[t])?r:(n=Ct(t,t<0?-1:0,!1),i&&(kt[t]=n),n)}function Mt(t,e){if(isNaN(t))return e?Dt:Lt;if(e){if(t<0)return Dt;if(t>=Rt)return Vt}else{if(t<=-Ot)return jt;if(t+1>=Ot)return Ut}return t<0?Mt(-t,e).neg():Ct(t%$t|0,t/$t|0,e)}function Ct(t,e,n){return new St(t,e,n)}St.fromInt=Et,St.fromNumber=Mt,St.fromBits=Ct;var At=Math.pow;function Nt(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Lt;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Nt(t.substring(1),e,n).neg();for(var i=Mt(At(n,8)),s=Lt,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=Mt(At(n,a));s=s.mul(c).add(Mt(l))}else s=(s=s.mul(i)).add(Mt(l))}return s.unsigned=e,s}function It(t,e){return"number"==typeof t?Mt(t,e):"string"==typeof t?Nt(t,e):Ct(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}St.fromString=Nt,St.fromValue=It;var $t=4294967296,Rt=$t*$t,Ot=Rt/2,Pt=Et(1<<24),Lt=Et(0);St.ZERO=Lt;var Dt=Et(0,!0);St.UZERO=Dt;var Ft=Et(1);St.ONE=Ft;var zt=Et(1,!0);St.UONE=zt;var Bt=Et(-1);St.NEG_ONE=Bt;var Ut=Ct(-1,2147483647,!1);St.MAX_VALUE=Ut;var Vt=Ct(-1,-1,!0);St.MAX_UNSIGNED_VALUE=Vt;var jt=Ct(0,-2147483648,!1);St.MIN_VALUE=jt;var Wt=St.prototype;Wt.toInt=function(){return this.unsigned?this.low>>>0:this.low},Wt.toNumber=function(){return this.unsigned?(this.high>>>0)*$t+(this.low>>>0):this.high*$t+(this.low>>>0)},Wt.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(jt)){var e=Mt(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=Mt(At(t,6),this.unsigned),s=this,o="";;){var a=s.div(i),l=(s.sub(a.mul(i)).toInt()>>>0).toString(t);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},Wt.getHighBits=function(){return this.high},Wt.getHighBitsUnsigned=function(){return this.high>>>0},Wt.getLowBits=function(){return this.low},Wt.getLowBitsUnsigned=function(){return this.low>>>0},Wt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(jt)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Wt.isZero=function(){return 0===this.high&&0===this.low},Wt.eqz=Wt.isZero,Wt.isNegative=function(){return!this.unsigned&&this.high<0},Wt.isPositive=function(){return this.unsigned||this.high>=0},Wt.isOdd=function(){return 1==(1&this.low)},Wt.isEven=function(){return 0==(1&this.low)},Wt.equals=function(t){return _t(t)||(t=It(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Wt.eq=Wt.equals,Wt.notEquals=function(t){return!this.eq(t)},Wt.neq=Wt.notEquals,Wt.ne=Wt.notEquals,Wt.lessThan=function(t){return this.comp(t)<0},Wt.lt=Wt.lessThan,Wt.lessThanOrEqual=function(t){return this.comp(t)<=0},Wt.lte=Wt.lessThanOrEqual,Wt.le=Wt.lessThanOrEqual,Wt.greaterThan=function(t){return this.comp(t)>0},Wt.gt=Wt.greaterThan,Wt.greaterThanOrEqual=function(t){return this.comp(t)>=0},Wt.gte=Wt.greaterThanOrEqual,Wt.ge=Wt.greaterThanOrEqual,Wt.compare=function(t){if(_t(t)||(t=It(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Wt.comp=Wt.compare,Wt.negate=function(){return!this.unsigned&&this.eq(jt)?jt:this.not().add(Ft)},Wt.neg=Wt.negate,Wt.add=function(t){_t(t)||(t=It(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=0,c=0,u=0,h=0;return u+=(h+=i+(65535&t.low))>>>16,c+=(u+=r+a)>>>16,l+=(c+=n+o)>>>16,l+=e+s,Ct((u&=65535)<<16|(h&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},Wt.subtract=function(t){return _t(t)||(t=It(t)),this.add(t.neg())},Wt.sub=Wt.subtract,Wt.multiply=function(t){if(this.isZero())return Lt;if(_t(t)||(t=It(t)),wt)return Ct(wt.mul(this.low,this.high,t.low,t.high),wt.get_high(),this.unsigned);if(t.isZero())return Lt;if(this.eq(jt))return t.isOdd()?jt:Lt;if(t.eq(jt))return this.isOdd()?jt:Lt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Pt)&&t.lt(Pt))return Mt(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=65535&t.low,c=0,u=0,h=0,d=0;return h+=(d+=i*l)>>>16,u+=(h+=r*l)>>>16,h&=65535,u+=(h+=i*a)>>>16,c+=(u+=n*l)>>>16,u&=65535,c+=(u+=r*a)>>>16,u&=65535,c+=(u+=i*o)>>>16,c+=e*l+n*a+r*o+i*s,Ct((h&=65535)<<16|(d&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},Wt.mul=Wt.multiply,Wt.divide=function(t){if(_t(t)||(t=It(t)),t.isZero())throw Error("division by zero");var e,n,r;if(wt)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Ct((this.unsigned?wt.div_u:wt.div_s)(this.low,this.high,t.low,t.high),wt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Dt:Lt;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Dt;if(t.gt(this.shru(1)))return zt;r=Dt}else{if(this.eq(jt))return t.eq(Ft)||t.eq(Bt)?jt:t.eq(jt)?Ft:(e=this.shr(1).div(t).shl(1)).eq(Lt)?t.isNegative()?Ft:Bt:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(jt))return this.unsigned?Dt:Lt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Lt}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:At(2,i-48),o=Mt(e),a=o.mul(t);a.isNegative()||a.gt(n);)a=(o=Mt(e-=s,this.unsigned)).mul(t);o.isZero()&&(o=Ft),r=r.add(o),n=n.sub(a)}return r},Wt.div=Wt.divide,Wt.modulo=function(t){return _t(t)||(t=It(t)),wt?Ct((this.unsigned?wt.rem_u:wt.rem_s)(this.low,this.high,t.low,t.high),wt.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Wt.mod=Wt.modulo,Wt.rem=Wt.modulo,Wt.not=function(){return Ct(~this.low,~this.high,this.unsigned)},Wt.and=function(t){return _t(t)||(t=It(t)),Ct(this.low&t.low,this.high&t.high,this.unsigned)},Wt.or=function(t){return _t(t)||(t=It(t)),Ct(this.low|t.low,this.high|t.high,this.unsigned)},Wt.xor=function(t){return _t(t)||(t=It(t)),Ct(this.low^t.low,this.high^t.high,this.unsigned)},Wt.shiftLeft=function(t){return _t(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Ct(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Ct(0,this.low<<t-32,this.unsigned)},Wt.shl=Wt.shiftLeft,Wt.shiftRight=function(t){return _t(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Ct(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Ct(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Wt.shr=Wt.shiftRight,Wt.shiftRightUnsigned=function(t){if(_t(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?Ct(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Ct(32===t?e:e>>>t-32,0,this.unsigned)},Wt.shru=Wt.shiftRightUnsigned,Wt.shr_u=Wt.shiftRightUnsigned,Wt.toSigned=function(){return this.unsigned?Ct(this.low,this.high,!1):this},Wt.toUnsigned=function(){return this.unsigned?this:Ct(this.low,this.high,!0)},Wt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Wt.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Wt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},St.fromBytes=function(t,e,n){return n?St.fromBytesLE(t,e):St.fromBytesBE(t,e)},St.fromBytesLE=function(t,e){return new St(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},St.fromBytesBE=function(t,e){return new St(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Ht=xt||t({__proto__:null,default:xt},[xt]);function Gt(t){return Ht.fromString(t,!0,16)}const qt=Gt("c3a5c85c97cb3127"),Xt=Gt("b492b66fbe98f273"),Yt=Gt("9ae16a3b2f90404f");function Kt(t){return t.xor(t.shru(47))}function Zt(t,e,n){const r=t.slice(e,e+n);return Ht.fromBytes(Array.from(r),!0,!0)}function Jt(t,e){return Zt(t,e,8)}function Qt(t,e){return Zt(t,e,4)}function te(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function ee(t,e,n=Gt("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function ne(t,e,n,r){return function(t,e,n,r,i,s){i=i.add(t),s=te(s.add(i).add(r),21);const o=i;return i=(i=i.add(e)).add(n),s=s.add(te(i,44)),[i.add(r),s.add(o)]}(Jt(t,e),Jt(t,e+8),Jt(t,e+16),Jt(t,e+24),n,r)}function re(t,e=t.length){const n=Ht.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Yt.add(2*e),r=Jt(t,0).add(Yt),i=Jt(t,e-8);return ee(te(i,37).mul(n).add(r),te(r,25).add(i).mul(n),n)}if(e>=4){const n=Yt.add(2*e);return ee(Qt(t,0).shl(3).add(e),Qt(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return Kt(Yt.mul(n).xor(qt.mul(r))).mul(Yt)}return Yt}(t,e):function(t,e=t.length){const n=Yt.add(2*e),r=Jt(t,0).mul(Xt),i=Jt(t,8),s=Jt(t,e-8).mul(n),o=Jt(t,e-16).mul(Yt);return ee(te(r.add(i),43).add(te(s,30)).add(o),r.add(te(i.add(Yt),18)).add(s),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Yt.add(2*e),r=Jt(t,0).mul(Yt),i=Jt(t,8),s=Jt(t,e-8).mul(n),o=Jt(t,e-16).mul(Yt),a=te(r.add(i),43).add(te(s,30)).add(o),l=ee(a,r.add(te(i.add(Yt),18)).add(s),n),c=Jt(t,16).mul(n),u=Jt(t,24),h=a.add(Jt(t,e-32)).mul(n),d=l.add(Jt(t,e-24)).mul(n);return ee(te(c.add(u),43).add(te(h,30)).add(d),c.add(te(u.add(r),18)).add(h),n)}(t,e);let r=n,i=n.mul(Xt).add(113),s=Kt(i.mul(Yt).add(113)).mul(Yt),o=[Ht.UZERO,Ht.UZERO],a=[Ht.UZERO,Ht.UZERO];r=r.mul(Yt).add(Jt(t,0));let l=0;const c=64*(e-1>>6),u=c+(e-1&63)-63;do{r=te(r.add(i).add(o[0]).add(Jt(t,l+8)),37).mul(Xt),i=te(i.add(o[1]).add(Jt(t,l+48)),42).mul(Xt),r=r.xor(a[1]),i=i.add(o[0]).add(Jt(t,l+40)),s=te(s.add(a[0]),33).mul(Xt),o=ne(t,l,o[1].mul(Xt),r.add(a[0])),a=ne(t,l+32,s.add(a[1]),i.add(Jt(t,l+16))),[s,r]=[r,s],l+=64}while(l!==c);const h=Xt.add(s.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=te(r.add(i).add(o[0]).add(Jt(t,l+8)),37).mul(h),i=te(i.add(o[1]).add(Jt(t,l+48)),42).mul(h),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(Jt(t,l+40))),s=te(s.add(a[0]),33).mul(h),o=ne(t,l,o[1].mul(h),r.add(a[0])),a=ne(t,l+32,s.add(a[1]),i.add(Jt(t,l+16))),[s,r]=[r,s],ee(ee(o[0],a[0],h).add(Kt(i).mul(qt)).add(s),ee(o[1],a[1],h).add(r),h)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ie(t,e){return"string"===e?ae(t):se([t],e)}function se(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=d(t)),X().getBool("DEBUG")&&k(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function oe(){return X().platform.now()}function ae(t,e="utf-8"){return e=e||"utf-8",X().platform.encode(t,e)}function le(t,e="utf-8"){return e=e||"utf-8",X().platform.decode(t,e)}var ce=Object.freeze({__proto__:null,createScalarValue:ie,toTypedArray:se,now:oe,fetch:function(t,e){return X().platform.fetch(t,e)},encodeString:ae,decodeString:le,shuffle:i,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,a(t,n,r),a(e,n,r)},clamp:s,nearestLargerEven:o,swap:a,sum:l,randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n},assert:c,assertShapesMatch:u,assertNonNull:h,flatten:d,sizeFromShape:p,isScalarShape:function(t){return 0===t.length},arraysEqual:f,isInt:m,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:g,createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return i(e),e},rightPad:y,repeatedTry:b,inferFromImplicitShape:v,parseAxisParam:x,squeezeShape:w,getTypedArrayFromDType:S,getArrayFromDType:_,checkConversionForErrors:k,isValidDtype:T,hasEncodingLoss:E,isTypedArray:M,bytesPerElement:C,bytesFromStringArray:A,isString:N,isBoolean:I,isNumber:$,inferDtype:R,isFunction:O,nearestDivisor:P,computeStrides:L,toNestedArray:F,makeOnesTypedArray:z,makeZerosTypedArray:B,makeZerosNestedTypedArray:U,assertNonNegativeIntegerDimensions:V,locToIndex:j,indexToLoc:W,isPromise:H,hexToLong:Gt,fingerPrint64:re});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ue{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new de)}profileKernel(t,e,n){let r;const i=()=>{r=n()};let s;const o=oe();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(const t of r)t.dataSync();s=Promise.resolve({kernelMs:oe()-o})}if(X().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{he(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:s.then((t=>t.kernelMs)),extraInfo:s.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:s}=t;n.forEach((t=>{Promise.all([t.data(),r,s]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function he(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class de{logKernelProfile(t,e,n,r,i,s){const o="number"==typeof r?y(`${r}ms`,9):r.error,a=y(t,25),l=e.rank,c=e.size,u=y(e.shape.toString(),14);let h="";for(const t in i){const n=i[t];if(null!=n){const r=n.shape||e.shape,i=r.length;h+=`${t}: ${i}D ${i>0?r:""} `}}console.log(`%c${a}\t%c${o}\t%c${l}D ${u}\t%c${c}\t%c${h}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pe(t,e,n,r){const i=L(e),s=function(t,e,n,r){const i=p(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,l="complex64"===n?ye(t):t;if(a>1)for(let t=0;t<i/s;t++){const e=t*s;for(let t=0;t<s;t++)o[t]=Math.max(o[t],fe(l[e+t],0,n).length)}return o}(t,e,n,i),o=e.length,a=ge(t,e,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map((t=>"    "+t)).join("\n")),l.join("\n")}function fe(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:N(t)?`'${t}'`:"bool"===n?me(t):parseFloat(t.toFixed(7)).toString(),y(r,e)}function me(t){return 0===t?"false":"true"}function ge(t,e,n,r,i,s=!0){const o="complex64"===n?2:1,a=e[0],l=e.length;if(0===l){if("complex64"===n){return[fe(ye(t)[0],0,n)]}return"bool"===n?[me(t[0])]:[t[0].toString()]}if(1===l){if(a>20){const e=3*o;let r=Array.from(t.slice(0,e)),s=Array.from(t.slice((a-3)*o,a*o));return"complex64"===n&&(r=ye(r),s=ye(s)),["["+r.map(((t,e)=>fe(t,i[e],n))).join(", ")+", ..., "+s.map(((t,e)=>fe(t,i[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?ye(t):Array.from(t)).map(((t,e)=>fe(t,i[e],n))).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),h=r[0]*o,d=[];if(a>20){for(let e=0;e<3;e++){const r=e*h,s=r+h;d.push(...ge(t.slice(r,s),c,n,u,i,!1))}d.push("...");for(let e=a-3;e<a;e++){const r=e*h,s=r+h;d.push(...ge(t.slice(r,s),c,n,u,i,e===a-1))}}else for(let e=0;e<a;e++){const r=e*h,s=r+h;d.push(...ge(t.slice(r,s),c,n,u,i,e===a-1))}const p=2===l?",":"";d[0]="["+d[0]+p;for(let t=1;t<d.length-1;t++)d[t]=" "+d[t]+p;let f=",\n";for(let t=2;t<l;t++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function ye(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class be{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=p(t),null!=n){const t=n.length;c(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||_(e,this.size),this.strides=L(t)}set(t,...e){0===e.length&&(e=[0]),c(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return ve().makeTensor(this.values,this.shape,this.dtype)}}let ve=null,xe=null;class we{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=p(t),this.strides=L(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return xe.buffer(this.shape,this.dtype,t)}bufferSync(){return xe.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return F(this.shape,t,"complex64"===this.dtype)}arraySync(){return F(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=ve().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>le(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ve().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ve().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>le(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ve().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(ve().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return xe.print(this,t)}clone(){return this.throwIfDisposed(),xe.clone(this)}toString(t=!1){return pe(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),xe.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),ve().makeVariable(this,t,e,n)}}function Se(){return J("Tensor",(()=>we))}Object.defineProperty(we,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),Se();class _e extends we{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!f(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ve().disposeTensor(this),this.dataId=t.dataId,ve().incRef(this,null)}dispose(){ve().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var ke,Te,Ee,Me,Ce;Object.defineProperty(_e,Symbol.hasInstance,{value:t=>t instanceof we&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(ke||(ke={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Te||(Te={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ee||(Ee={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Me||(Me={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ce||(Ce={}));const Ae={float32:Me,int32:Te,bool:Ee,complex64:Ce};function Ne(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Ae[t][e]}function Ie(t){return Ne(t,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(t,e){if(t.dtype===e.dtype)return[t,e];const n=Ne(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Re(t,e){c(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Oe(t,e){return e.some((e=>e.id===t.id))}function Pe(t){const e=[];return Le(t,e,new Set),e}function Le(t,e,n){if(null==t)return;if(t instanceof we)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const i=t;for(const t in i){const r=i[t];n.has(r)||(n.add(r),Le(r,e,n))}}var De=Object.freeze({__proto__:null,makeTypesMatch:$e,assertTypesMatch:Re,isTensorInList:Oe,getTensorsInContainer:Pe});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(t){return null!=t.kernelName}class ze{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Be{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ze}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(lt(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ue(this.backendInstance),!0}setupRegisteredKernels(){pt(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){pt(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const r=e.factory();if(!r||r instanceof n||"function"!=typeof r.then)return this.registry[t]=r,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,n=r.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,lt(`Initialization of backend ${t} failed`),lt(n.stack||n.message)),!1)));return this.pendingBackendInit=n,{success:n,asyncInit:!0}}}catch(e){return lt(`Initialization of backend ${t} failed`),lt(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),s=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return Be.nextTensorId++}nextVariableId(){return Be.nextVariableId++}clone(t){const e=Ve.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return Ve.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=ht(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-e-i-s;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),i=this.state.numBytes,s=this.state.numTensors;let o,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=Fe(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Fe(t)){const{kernelName:e,inputs:i,attrs:s}=t;null==this.backendName&&this.backend;const l=ht(e,this.backendName);c(null!=l,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),o=()=>{const t=this.backend.numDataIds();a=l.kernelFunc({inputs:i,attrs:s,backend:this.backend});const o=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,o);const c=o.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,i,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,i=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};o=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,i)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,t,n),n}}const{inputs:u,attrs:h}=t,d=Fe(t)?null:t.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(l,u,(()=>o())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs):e=o()})),r&&this.addTapeNode(l,u,e,d,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map((t=>null!=u[t]?u[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=dt(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let s;r.saveAllInputs?(c(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),s=Object.keys(e).map((t=>e[t]))):s=t.map((t=>e[t]));const o=n.filter(((t,e)=>i[e]));return s.concat(o)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=t;"string"===n&&N(t[0])&&(i=t.map((t=>ae(t))));const s=r.write(i,e,n),o=new we(e,n,s,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const t=this.state.tensorInfo.get(s),e=A(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return o}makeTensorFromDataId(t,e,n,r){const i={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:i}=t,s=new we(r,i,n,this.nextTensorId());return this.trackTensor(s,e),s}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new _e(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*C(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof _e||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*C(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,s){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},a=dt(t);null!=a&&(r=a.gradFunc),null!=r&&(o.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=B(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],i,s))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Pe(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(c(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));c(i instanceof we,(()=>"The result y returned by f() must be a tensor."));const s=function(t,e,n){const r={},i={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const s=t[n],o=s.inputs;for(const t in o){const n=o[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){s.outputs.forEach((t=>r[t.id]=!0)),a=!0,i[s.id]=!0;break}if(a)break}}const s={};s[n.id]=!0;const o={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(s[n.outputs[t].id]){for(const t in r)s[r[t].id]=!0,o[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(i[n.id]&&o[n.id]){const t={};for(const e in n.inputs){const i=n.inputs[e];r[i.id]&&(t[e]=i)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,i);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?function(t){const e=z(p(t),"float32");return Ve.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach((e=>{const n=t[e.id];null!=n?o.push(n):o.push(null)})),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const e in s.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const i=n((()=>a[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const o=s.inputs[e];if(!f(i.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==t[o.id])t[o.id]=i;else{const e=t[o.id];t[o.id]=r(e,i),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,s,(t=>this.tidy(t)),je);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(t){return c(O(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;c(e.every((t=>t instanceof we)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,i)=>(n=t(...e,i),c(n.value instanceof we,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),c(O(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const i=n.gradFunc(t,r),s=Array.isArray(i)?i:[i];c(s.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),c(s.every((t=>t instanceof we)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return s.forEach(((t,e)=>{o[e]=()=>t})),o},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=oe(),n=await this.backend.time(t);return n.wallMs=oe()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ze;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function Ue(){const t=Z();if(null==t._tfengine){const e=new G(t);t._tfengine=new Be(e)}var e;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */return e=t._tfengine.ENV,K=e,ve=()=>t._tfengine,t._tfengine}Be.nextTensorId=0,Be.nextVariableId=0;const Ve=Ue();function je(t,e){const n={a:t,b:e};return Ve.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let We;function He(t){if(void 0!==We)return We;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Ge(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var qe=Object.freeze({__proto__:null,mockIsMobile:function(t){We=t},isMobile:He,isBrowser:Ge});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xe=X();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ye(t,e){let n=t;if(M(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||M(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ke(t,r,[]),r}function Ke(t,e,n){if(n=n||[],!Array.isArray(t)&&!M(t))return void c(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));c(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),c(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Ke(t[e],r,n.concat(e))}function Ze(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function Je(t,e,n,r="numeric"){if(t instanceof we)return Ze(r,t.dtype,e,n),t;let i=R(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Ze(r,i,e,n),null==t||!M(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=Ye(t,i);M(t)||Array.isArray(t)||(t=[t]);const o="string"!==i?se(t,i):d(t,[],!0);return Ve.makeTensor(o,s,i)}function Qe(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,i)=>Je(t,`${e}[${i}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Xe.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Xe.registerFlag("IS_BROWSER",(()=>Ge())),Xe.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),Xe.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Xe.registerFlag("PROD",(()=>!1)),Xe.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Xe.getBool("DEBUG"))),Xe.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Xe.registerFlag("IS_TEST",(()=>!1)),Xe.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),Xe.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),Xe.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1)),Xe.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),Xe.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));function tn(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const i=(...t)=>{Ve.startScope(n);try{const e=r(...t);return H(e)&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(e),e}catch(t){throw Ve.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const en=tn({complex_:function(t,e){const n=Je(t,"real","complex"),r=Je(e,"imag","complex");u(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return Ve.runKernel("Complex",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nn(t,e,n,r){if(null==r&&(r=R(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!M(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){V(e);const t=p(e),r=p(n);c(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],i=t!==n.length-1||r!==p(e.slice(t));c(n[t]===e[t]||!i,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return M(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?se(t,r):d(t,[],!0),Ve.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(t,e,n){return nn(t,e,Ye(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sn={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function on(t,e){const n=[],r=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let s=0;s<i.length;++s){const o=i[s],a=Array.isArray(t)?t[s].tensor:t[o];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${a.dtype}`);const l={name:o,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let i=0;for(let t=0;t<e.length;t++){const n=e[t],s=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(s,i),i+=4,r.set(n,i),i+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(l.group=e),n.push(l)}return{data:ln(await Promise.all(r)),specs:n}}function an(t,e){const n={};let r,i=0;for(const s of e){const e=s.name,o=s.dtype,a=s.shape,l=p(a);let c;if("quantization"in s){const n=s.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${s.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${s.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const a=sn[n.dtype],u=t.slice(i,i+l*a),h="uint8"===n.dtype?new Uint8Array(u):new Uint16Array(u);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=bn()),c=r(h)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];c[t]=Math.round(e*n.scale+n.min)}}i+=l*a}else if("string"===o){const e=p(s.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(i,i+4))[0];i+=4;const n=new Uint8Array(t.slice(i,i+e));c.push(n),i+=e}}else{const r=sn[o],s=t.slice(i,i+l*r);if("float32"===o)c=new Float32Array(s);else if("int32"===o)c=new Int32Array(s);else if("bool"===o)c=new Uint8Array(s);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);{c=new Float32Array(s);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const i=rn(t,a,"float32"),o=rn(r,a,"float32");n[e]=en(i,o),i.dispose(),o.dispose()}}i+=l*r}"complex64"!==o&&(n[e]=rn(c,a,o))}return n}function ln(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let i=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),r.buffer}const cn="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function un(t){return cn?Buffer.byteLength(t):new Blob([t]).size}function hn(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function dn(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function pn(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function fn(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null!=t.weightsManifest){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),r}async function mn(t,e){let n,r;return null!=t.weightsManifest&&([n,r]=await e(t.weightsManifest)),fn(t,n,r)}function gn(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:un(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:un(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function yn(t){const e=[];for(const n of t)e.push(...n.weights);return e}function bn(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let i=0;i<r.length;i++){const o=r[i],a=t[n[o>>10]+(1023&o)]+e[o>>10];s[i]=a}return new Float32Array(i)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==vn.instance&&(vn.instance=new vn),vn.instance}static registerSaveRouter(t){vn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){vn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return vn.getHandlers(t,"save")}static getLoadHandlers(t,e){return vn.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?vn.getInstance().loadRouters:vn.getInstance().saveRouters).forEach((e=>{const i=e(t,n);null!==i&&r.push(i)})),r}}const xn=t=>vn.getSaveHandlers(t),wn=(t,e)=>vn.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function Sn(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _n(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class kn{constructor(t){if(this.indexedDB=Sn(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>_n(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const r=gn(e),s=i.transaction("model_info_store","readwrite");let o=s.objectStore("model_info_store");const a=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let l;a.onsuccess=()=>{l=i.transaction("models_store","readwrite");const a=l.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{o=s.objectStore("model_info_store");const e=o.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(a.error)),e.onerror=t=>(i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)}))}}kn.URL_SCHEME="indexeddb://";const Tn=t=>{return X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(kn.URL_SCHEME)?(e=t.slice(kn.URL_SCHEME.length),new kn(e)):null;var e};vn.registerSaveRouter(Tn),vn.registerLoadRouter(Tn);class En{constructor(){this.indexedDB=Sn()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>_n(n),n.onsuccess=()=>{const r=n.result,i=r.transaction("model_info_store","readonly"),s=i.objectStore("model_info_store").getAll();s.onsuccess=()=>{const e={};for(const t of s.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},s.onerror=t=>(r.close(),e(s.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(kn.URL_SCHEME)?e.slice(kn.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>_n(r),r.onsuccess=()=>{const i=r.result,s=i.transaction("model_info_store","readwrite"),o=s.objectStore("model_info_store"),a=o.get(t);let l;a.onsuccess=()=>{if(null==a.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=o.delete(t),s=()=>{l=i.transaction("models_store","readwrite");const r=l.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=s,r.onerror=t=>(s(),i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mn="tensorflowjs_models",Cn="info",An="model_topology",Nn="weight_specs",In="weight_data",$n="model_metadata";function Rn(t){return{info:[Mn,t,Cn].join("/"),topology:[Mn,t,An].join("/"),weightSpecs:[Mn,t,Nn].join("/"),weightData:[Mn,t,In].join("/"),modelMetadata:[Mn,t,$n].join("/")}}function On(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Pn(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class Ln{constructor(t){if(!X().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Rn(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=gn(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(cn)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(t){throw On(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(cn){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(s),e}}Ln.URL_SCHEME="localstorage://";const Dn=t=>{return X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ln.URL_SCHEME)?(e=t.slice(Ln.URL_SCHEME.length),new Ln(e)):null;var e};vn.registerSaveRouter(Dn),vn.registerLoadRouter(Dn);class Fn{constructor(){c(X().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),c("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Mn+"/",n="/"+Cn;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(n)){t[Pn(i)]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){var e;const n=Rn(t=(e=t).startsWith(Ln.URL_SCHEME)?e.slice(Ln.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return On(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zn{constructor(){this.managers={}}static getInstance(){return null==zn.instance&&(zn.instance=new zn),zn.instance}static registerManager(t,e){c(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),c(t.length>0,(()=>"scheme must not be an empty string."));const n=zn.getInstance();c(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=zn.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(zn.getInstance().managers)}}function Bn(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${zn.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function Un(t,e,n=!1){c(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=vn.getLoadHandlers(t);c(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),c(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const i=r[0],s=vn.getSaveHandlers(e);c(s.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),c(s.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const o=s[0],a=Bn(t).scheme,l=Bn(t).path,u=a===Bn(t).scheme,h=await i.load();n&&u&&await zn.getManager(a).removeModel(l);const d=await o.save(h);return n&&!u&&await zn.getManager(a).removeModel(l),d.modelArtifactsInfo}async function Vn(){const t=zn.getSchemes(),e={};for(const n of t){const t=await zn.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e}async function jn(t){const e=Bn(t);return zn.getManager(e.scheme).removeModel(e.path)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Wn{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){window&&X().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(t),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(t=>{if(t.source===window&&t.data.name===this.messageName){t.stopPropagation();(0,this.functionRefs[t.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(t,e)}}if(X().get("IS_BROWSER")){X().setPlatform("browser",new Wn);try{zn.registerManager(Ln.URL_SCHEME,new Fn)}catch(t){}try{zn.registerManager(kn.URL_SCHEME,new En)}catch(t){}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hn=()=>require("node-fetch");let Gn;class qn{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=X().global.fetch?X().global.fetch(t,e):(null==Gn&&(Gn=Hn()),Gn(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xn(t,e="float32",n){return e=e||"float32",V(t),new be(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */X().get("IS_NODE")&&!X().get("IS_BROWSER")&&X().setPlatform("node",new qn);const Yn=tn({cast_:function(t,e){const n=Je(t,"x","cast");if(!T(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Ve.runKernel("Cast",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kn=tn({clone_:function(t){const e={x:Je(t,"x","clone","string_or_numeric")};return Ve.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zn(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ue();xe={buffer:Xn,cast:Yn,clone:Kn,print:Zn};function Jn(t){return new Promise((t=>setTimeout(t))).then(t)}class Qn{constructor(t){if(!X().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Qn.URL_SCHEME)&&(t=t.slice(Qn.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=pn(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await Jn((()=>i.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await Jn((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:gn(t)}}}}Qn.URL_SCHEME="downloads://";class tr{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),i=r.modelTopology;if(null==i)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:i});const s=mn(r,(t=>this.loadWeights(t)));t(s)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),i=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(i).then((t=>[e,hn(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const i=new FileReader;i.onload=t=>{const e=t.target.result;n(e)},i.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),i.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>dn(t.name))),r={};for(const i of t)i.paths.forEach((t=>{const i=dn(t);if(-1!==e.indexOf(i))throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(e.push(i),-1===n.indexOf(i))throw new Error(`Weight file with basename '${i}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(i)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}function er(t){return new tr(t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nr(t,e,n,r){!function(t){c(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){c(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),c(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),c(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(t.map((s=>(s.then((s=>{const o=n+ ++i/t.length*(r-n);return e(o),s})),s))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function rr(t,e){null==e&&(e={});const n=null==e.fetchFunc?X().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=(null==e.onProgress?await Promise.all(r):await nr(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(i):await nr(i,e.onProgress,.5,1)}function ir(t){return async(e,n="",r)=>{const i=e.map((()=>!1)),s={},o=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const l="quantization"in t?t.quantization.dtype:t.dtype,c=sn[l]*p(t.shape),u=()=>{i[e]=!0,null==s[e]&&(s[e]=[]),s[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(u(),o[n]=!0)})):u(),a.push(t.name),n+=c}))})),!o.every((t=>t))){const t=r.filter(((t,e)=>!o[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const l=i.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];l.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const u=await t(c),h={};let d=0;return l.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=u[d+t].byteLength;const i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(u[d+t]);o.set(e,a),a+=e.byteLength}s[t].forEach((t=>{const e=an(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)h[t]=e[t]})),d+=n})),h}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vn.registerSaveRouter((t=>X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Qn.URL_SCHEME)?function(t="model"){return new Qn(t)}(t.slice(Qn.URL_SCHEME.length)):null));class sr{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(c("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=X().platform.fetch,c(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&c(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=pn(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:gn(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return mn(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}(e),i=this.weightPathPrefix||n,s=yn(t),o=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):o.push(i+t+r);this.weightUrlConverter&&o.push(...await Promise.all(a));return[s,hn(await rr(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function or(t){return null!=t.match(sr.URL_SCHEME_REGEX)}sr.URL_SCHEME_REGEX=/^https?:\/\//;const ar=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>or(t))):or(t),n)return lr(t,e)}return null};function lr(t,e){return new sr(t,e)}function cr(t,e){return lr(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vn.registerSaveRouter(ar),vn.registerLoadRouter(ar);class ur{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class hr{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class dr{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function pr(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new ur(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ur({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ur({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}function fr(t){return new hr(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var mr=Object.freeze({__proto__:null,browserFiles:er,browserHTTPRequest:cr,concatenateArrayBuffers:hn,decodeWeights:an,encodeWeights:on,fromMemory:function(t,e,n,r){const i=arguments;return new dr(pr(...i))},fromMemorySync:pr,getLoadHandlers:wn,getModelArtifactsForJSON:mn,getModelArtifactsForJSONSync:fn,getModelArtifactsInfoForJSON:gn,getSaveHandlers:xn,getWeightSpecs:yn,http:lr,isHTTPScheme:or,loadWeights:async function(t,e="",n,r){return ir((t=>rr(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>vn.registerLoadRouter(t),registerSaveRouter:t=>vn.registerSaveRouter(t),weightsLoaderFactory:ir,withSaveHandler:fr,withSaveHandlerSync:function(t){return new hr(t)},copyModel:async function(t,e){return Un(t,e,!1)},listModels:Vn,moveModel:async function(t,e){return Un(t,e,!0)},removeModel:jn});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gr=tn({matMul_:function(t,e,n=!1,r=!1){let i=Je(t,"a","matMul"),s=Je(e,"b","matMul");[i,s]=$e(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return Ve.runKernel("BatchMatMul",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yr=tn({oneHot_:function(t,e,n=1,r=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:Je(t,"indices","oneHot","int32")},o={dtype:i,depth:e,onValue:n,offValue:r};return Ve.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function br(){return Ve}function vr(){return Ve.memory()}function xr(t,e){return Ve.tidy(t,e)}function wr(t){Pe(t).forEach((t=>t.dispose()))}function Sr(t){return Ve.keep(t)}function _r(){return Ve.backendName}function kr(t,e,n=1){return Ve.registerBackend(t,e,n)}function Tr(){return Ve.backend}const Er=tn({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:Je(t,"input","imag")};return Ve.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mr=tn({neg_:function(t){const e={x:Je(t,"x","neg")};return Ve.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cr=tn({real_:function(t){const e={input:Je(t,"input","real")};return Ve.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ar=tn({transpose_:function(t,e,n){const r=Je(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),c(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{c(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const i={x:r},s={perm:e};return"complex64"===r.dtype?xr((()=>{let t=Cr(r),e=Er(r);return t=Ve.runKernel("Transpose",{x:t},s),e=Ve.runKernel("Transpose",{x:e},s),n&&(e=Mr(e)),en(t,e)})):Ve.runKernel("Transpose",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nr=tn({confusionMatrix_:function(t,e,n){const r=Je(t,"labels","confusionMatrix"),i=Je(e,"predictions","confusionMatrix");c(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),c(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),c(1===i.rank,(()=>`Expected the rank of predictions to be 1, but got ${i.rank}`)),c(r.shape[0]===i.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`)),c(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const s=yr(Yn(r,"int32"),n),o=yr(Yn(i,"int32"),n),a=Ar(s),l=gr(a,o);return Yn(l,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ir=Object.freeze({__proto__:null,confusionMatrix:Nr});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&r.unshift(s)}return r}function Rr(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,o=e[s];(null==i||1===i&&o>1)&&n.unshift(s)}return n}function Or(t,e){const n=[],r=Math.max(t.length,e.length);for(let i=0;i<r;i++){let r=t[t.length-i-1];null==r&&(r=1);let s=e[e.length-i-1];if(null==s&&(s=1),1===r)n.unshift(s);else if(1===s)n.unshift(r);else{if(r!==s){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var Pr=Object.freeze({__proto__:null,getBroadcastDims:$r,getReductionAxes:Rr,assertAndGetBroadcastShape:Or});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lr(t,e,n){if(h(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Ye(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return nn(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Dr;function Fr(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)s=!0;else if(null!=t.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(null!=ht("FromPixels",Ve.backendName)){const n={pixels:t},r={numChannels:e};return Ve.runKernel("FromPixels",n,r)}const[l,c]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let u,h;if(o)u=t.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)u=t.data;else if(s||i||a){if(null==Dr)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Dr=new OffscreenCanvas(1,1).getContext("2d")}else Dr=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Dr.canvas.width=l,Dr.canvas.height=c,Dr.drawImage(t,0,0,l,c),u=Dr.getImageData(0,0,l,c).data}if(4===e)h=new Int32Array(u);else{const t=l*c;h=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)h[n*e+t]=u[4*n+t]}return Lr(h,[c,l,e],"int32")}function zr(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}async function Br(t,e){let n=Je(t,"img","toPixels");if(!(t instanceof we)){const t=n;n=Yn(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),s=2===n.rank?1:n.shape[2];if(s>4||2===s)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const o=await n.data(),a="float32"===n.dtype?255:1,l=new Uint8ClampedArray(i*r*4);for(let t=0;t<r*i;++t){const e=[0,0,0,255];for(let r=0;r<s;r++){const i=o[t*s+r];if("float32"===n.dtype){if(i<0||i>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${i}.`)}else if("int32"===n.dtype&&(i<0||i>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${i}.`);1===s?(e[0]=i*a,e[1]=i*a,e[2]=i*a):e[r]=i*a}const r=4*t;l[r+0]=Math.round(e[0]),l[r+1]=Math.round(e[1]),l[r+2]=Math.round(e[2]),l[r+3]=Math.round(e[3])}if(null!=e){e.width=i,e.height=r;const t=e.getContext("2d"),n=new ImageData(l,i,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),l}const Ur=tn({fromPixels_:Fr});var Vr=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(X().getBool("WRAP_TO_IMAGEBITMAP")&&zr(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return Fr(n,e)},toPixels:Br,fromPixels:Ur});function jr(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===p(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,s=i[i.length-1];let o=1;for(let t=0;t<i.length-1;++t)o*=i[t];const a=t.shape,l=i.slice();l.pop();let c=1;for(let t=s;t<n;++t)c*=a[t],l.push(a[t]);const u=[...L(t.shape).map((t=>t/c)),1].slice(0,s);return[l,o,c,u]}var Wr=Object.freeze({__proto__:null,prepareAndValidate:jr});function Hr(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(s+" update.rank != "+(i+t.length-r));for(let t=0;t<i;++t)if(n.shape[t]!==e.shape[t])throw new Error(s+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-i;++e)if(n.shape[e+i]!==t[e+r])throw new Error(s+` updates.shape[${e+i}] (${n.shape[e+i]}) != shape[${e+i}] (${t[e+i]})`)}function Gr(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Hr(n,e,t)}function qr(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let o=1;for(let t=i;t<s;++t)o*=n[t];const a=i<1?1:i;return{sliceRank:i,numUpdates:p(e.shape)/a,sliceSize:o,strides:[...L(n.slice(0,i)),1],outputSize:p(n)}}var Xr=Object.freeze({__proto__:null,validateUpdateShape:Hr,validateInput:Gr,calculateShapes:qr});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yr(t,e,n){const r=t.shape.length;c(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),c(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let i=0;i<r;++i)c(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function Kr(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function Zr(t,e,n,r){const i=[...t];for(let t=i.length;t<r.length;t++)i.push(1);for(let t=0;t<n;t++)0===t?i[e]=1:(i.splice(e,0,1),i.pop());return i}function Jr(t,e,n){return n<=t?n:n-(e-1)}function Qr(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function ti(t,e,n,r,i){const s=[...i],o=Qr(n,e);for(let i=0;i<s.length;i++)if(o.indexOf(i)>-1)s[i]=0;else{const o=Jr(e,n,i);let a=r[o];t&1<<o&&(a=0),s[i]=a}return s}function ei(t,e,n,r,i){const o=[...i],a=Qr(n,e);for(let i=0;i<o.length;i++)if(a.indexOf(i)>-1)o[i]=Number.MAX_SAFE_INTEGER;else{const s=Jr(e,n,i);let a=r[s];t&1<<s&&(a=Number.MAX_SAFE_INTEGER),o[i]=a}for(let t=0;t<o.length;t++){const e=i[t];o[t]<0&&(o[t]+=e),o[t]=s(0,o[t],i[t])}return o}function ni(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function ri(t,e,n,r,i,o){let a=e[i];const l=n[i]||1;(t&1<<i||o&1<<i||null==a)&&(a=l>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const c=r[i];return a<0&&(a+=c),a=s(0,a,c-1),a}function ii(t,e,n,r,i,o){let a=e[i];const l=n[i]||1;(t&1<<i||o&1<<i||null==a)&&(a=l>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const c=r[i];return a<0&&(a+=c),a=l>0?s(0,a,c):s(-1,a,c-1),a}function si(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function oi(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function ai(t,e,n){let r;const i=t.shape.length;let s;return r="number"==typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),r.forEach((t=>{c(-1!==t,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,s=s.map(((e,n)=>e>=0?e:(c(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,s]}function li(t,e,n,r,i,s,o,a,l){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=o&&0!=(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let t=0;t<h.dims;t++)u&&0!=(1<<t&a)&&h.numAddAxisAfterEllipsis++,1<<t&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let p=!0,f=!0,m=!0;const g=[],y=[];for(let e=0;e<t.length;++e){if(0===d.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(d.shrinkAxisMask&1<<e),r=t[e];if(-1===r){g.push(n?1:-1);continue}const i=[d.beginMask&1<<e,d.endMask&1<<e],s=[d.strides[e]>0?0:-1,d.strides[e]>0?r:r-1];if(n&&d.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[e];const o=!!(d.beginMask&1<<e&&d.endMask&1<<e);if(d.beginValid&&d.endValid){if(n){const t=d.begin[e]<0?r+d.begin[e]:d.begin[e];if(d.begin[e]=t,d.end[e]=d.begin[e]+1,t<0||t>=r)throw Error(`slice index ${d.begin[e]} of dimension ${e} out of bounds.`)}else d.begin[e]=ci(d.begin[e],0,d.strides[e],r,i,s),d.end[e]=ci(d.end[e],1,d.strides[e],r,i,s);const t=1===d.strides[e]&&0===d.begin[e]&&d.end[e]===r;p=p&&t,f=f&&(0===e&&1===d.strides[e]||t)}else p=p&&1===d.strides[e]&&o,f=f&&(0===e&&1===d.strides[e]||o);let a,l=!1;if(d.beginValid&&d.endValid?(a=d.end[e]-d.begin[e],l=!0):n?(a=1,l=!0):o&&r>=0&&(a=d.strides[e]<0?-r:r,l=!0),l){let t;t=0===a||a<0!=d.strides[e]<0?0:Math.trunc(a/d.strides[e])+(a%d.strides[e]!=0?1:0),g.push(t)}else g.push(-1)}for(let t=0;t<d.finalShapeGatherIndices.length;++t){const e=d.finalShapeGatherIndices[t];e>=0?y.push(g[e]):-2===e&&y.push(1)}const b=y.filter(((t,e)=>-2!==d.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function ci(t,e,n,r,i,s){if(i[e])return n>0?s[e]:s[e+1&1];{const e=t<0?r+t:t;return e<s[0]?s[0]:e>s[1]?s[1]:e}}var ui=Object.freeze({__proto__:null,assertParamsValid:Yr,maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:Kr,stridesWithElidedDims:Zr,getNormalizedAxes:function(t,e,n,r,i,s,o,a,l){const c=t.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(e.length&&n>0){const l=e[0],c=n+1;u=ti(o,l,c,r,t),h=ei(a,l,c,i,t),d=Zr(s,l,c,t)}else for(let e=0;e<c;e++)u[e]=ri(o,r,s,t,e,l),h[e]=ii(a,i,s,t,e,l),d[e]=ni(s,e,l);return{begin:u,end:h,strides:d}},startIndicesWithElidedDims:ti,stopIndicesWithElidedDims:ei,stridesForAxis:ni,startForAxis:ri,stopForAxis:ii,isSliceContinous:si,computeFlatOffset:oi,parseSliceParams:ai,sliceInfo:li});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hi{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class di{constructor(){this.classNameMap={}}static getMap(){return null==di.instance&&(di.instance=new di),di.instance}static register(t){di.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function pi(t){c(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),c("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),c(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),di.register(t)}var fi=Object.freeze({__proto__:null,Serializable:hi,SerializationMap:di,registerClass:pi});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(){return 32===Ve.backend.floatPrecision()?.001:.1}function gi(t,e,n){let r=!0;if((M(t)||M(e))&&(r=!1),M(t)&&M(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Ye(t),r=Ye(e);if(!f(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=M(t)?t:d(t),s=M(e)?e:d(e);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.\nActual:   ${i}.\nExpected: ${s}.`);for(let t=0;t<s.length;++t){const e=i[t],r=s[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${i}.\nExpected: ${s}.`)}"undefined"!=typeof expect&&expect().nothing()}function yi(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var bi=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=mi()),gi(t,e,((t,e)=>yi(t,e,n)))},testEpsilon:mi,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e())),"undefined"!=typeof expect&&expect().nothing()},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return N(t)||N(t[0])||N(e)||N(e[0])?gi(t,n,((t,e)=>t==e)):gi(t,e,((t,e)=>yi(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=mi()),!yi(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);"undefined"!=typeof expect&&expect().nothing()},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=ae(r)}return e},createVideoElement:function(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise((t=>{e.addEventListener("loadeddata",(n=>t(e))),e.load()}))},play:async function(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise((e=>{t.requestVideoFrameCallback(e)}))}});
/** @license See the LICENSE file. */const vi=tn({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Je(t,"a","add"),r=Je(e,"b","add");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel("Add",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xi=tn({floorDiv_:function(t,e){let n=Je(t,"a","floorDiv"),r=Je(e,"b","floorDiv");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel("FloorDiv",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wi=tn({div_:function(t,e){let n=Je(t,"a","div"),r=Je(e,"b","div");if([n,r]=$e(n,r),"int32"===n.dtype&&"int32"===r.dtype)return xi(n,r);const i={a:n,b:r};return Ve.runKernel("RealDiv",i,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Si=tn({mul_:function(t,e){let n=Je(t,"a","mul"),r=Je(e,"b","mul");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel("Multiply",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _i=tn({abs_:function(t){const e=Je(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return Ve.runKernel("ComplexAbs",t)}{const t={x:e};return Ve.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ki=tn({acos_:function(t){const e={x:Je(t,"x","acos")};return Ve.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ti=tn({acosh_:function(t){const e={x:Je(t,"x","acosh")};return Ve.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ei=tn({addN_:function(t){c(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),c(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Je(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!f(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return Ve.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mi=tn({all_:function(t,e=null,n=!1){const r={x:Je(t,"x","all","bool")},i={axis:e,keepDims:n};return Ve.runKernel("All",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ci=tn({any_:function(t,e=null,n=!1){const r={x:Je(t,"x","any","bool")},i={axis:e,keepDims:n};return Ve.runKernel("Any",r,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ai=tn({argMax_:function(t,e=0){const n={x:Je(t,"x","argMax")},r={axis:e};return Ve.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ni=tn({argMin_:function(t,e=0){const n={x:Je(t,"x","argMin")},r={axis:e};return Ve.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ii=tn({asin_:function(t){const e={x:Je(t,"x","asin")};return Ve.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $i=tn({asinh_:function(t){const e={x:Je(t,"x","asinh")};return Ve.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ri=tn({atan_:function(t){const e={x:Je(t,"x","atan")};return Ve.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oi=tn({atan2_:function(t,e){let n=Je(t,"a","atan2"),r=Je(e,"b","atan2");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel("Atan2",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pi=tn({atanh_:function(t){const e={x:Je(t,"x","atanh")};return Ve.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(t,e,n,r,i="NHWC",s){return zi(t,[...e,t[3]],n,s,r,null,null,Xi(i))}function Di(t,e,n,r,i,s,o="channelsLast"){const[a,l]=Vi(e);let c;if("channelsLast"===o)c=[a,l,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);c=[a,l,t[1],t[1]]}return zi(t,c,n,r,i,s,!1,o)}function Fi(t,e,n,r,i,s,o="NDHWC"){const[a,l,c]=ji(e);let u,h;if("NDHWC"===o)h="channelsLast",u=[a,l,c,t[4],t[4]];else{if("NCDHW"!==o)throw new Error(`Unknown dataFormat ${o}`);h="channelsFirst",u=[a,l,c,t[1],t[1]]}return Bi(t,u,n,r,i,!1,h,s)}function zi(t,e,n,r,i,s,o=!1,a="channelsLast"){let[l,c,u,h]=[-1,-1,-1,-1];if("channelsLast"===a)[l,c,u,h]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,h,c,u]=t}const[d,p,,f]=e,[m,g]=Vi(n),[y,b]=Vi(r),v=Wi(d,y),x=Wi(p,b),{padInfo:w,outHeight:S,outWidth:_}=function(t,e,n,r,i,s,o,a,l){let c,u,h;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=Ui(t,e,n));const s=t[0],o=t[1],a=Hi((s-e+2*r)/n+1,i),l=Hi((o-e+2*r)/n+1,i);return[a,l]}([e,n],s,r,t,a);u=i[0],h=i[1]}else if("same"===t){u=Math.ceil(e/r),h=Math.ceil(n/i);const t=Math.max(0,(u-1)*r+s-e),a=Math.max(0,(h-1)*i+o-n),l=Math.floor(t/2),d=t-l,p=Math.floor(a/2);c={top:l,bottom:d,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/r),h=Math.ceil((n-o+1)/i);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const d="channelsLast"===l?t[1][0]:t[2][0],p="channelsLast"===l?t[1][1]:t[2][1],f="channelsLast"===l?t[2][0]:t[3][0],m="channelsLast"===l?t[2][1]:t[3][1];c={top:d,bottom:p,left:f,right:m,type:0===d&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},u=Hi((e-s+d+p)/r+1,a),h=Hi((n-o+f+m)/i+1,a)}}return{padInfo:c,outHeight:u,outWidth:h}}(i,c,u,m,g,v,x,s,a),k=o?f*h:f;let T;return"channelsFirst"===a?T=[l,k,S,_]:"channelsLast"===a&&(T=[l,S,_,k]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:h,outHeight:S,outWidth:_,outChannels:k,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:t,outShape:T,filterShape:e}}function Bi(t,e,n,r,i,s=!1,o="channelsLast",a){let[l,c,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,h,d]=t;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,d,c,u,h]=t}const[p,f,m,,g]=e,[y,b,v]=ji(n),[x,w,S]=ji(r),_=Wi(p,x),k=Wi(f,w),T=Wi(m,S),{padInfo:E,outDepth:M,outHeight:C,outWidth:A}=function(t,e,n,r,i,s,o,a,l,c,u){let h,d,p,f;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,i,s){null==i&&(i=Ui(t,e,r));const o=t[0],a=t[1],l=t[2],c=Hi((o-e+2*i)/r+1,s),u=Hi((a-e+2*i)/r+1,s),h=Hi((l-e+2*i)/r+1,s);return[c,u,h,n]}([e,n,r,1],a,1,i,t,u);d=s[0],p=s[1],f=s[2]}else if("same"===t){d=Math.ceil(e/i),p=Math.ceil(n/s),f=Math.ceil(r/o);const t=(d-1)*i+a-e,u=(p-1)*s+l-n,m=(f-1)*o+c-r,g=Math.floor(t/2),y=t-g,b=Math.floor(u/2),v=u-b,x=Math.floor(m/2);h={top:b,bottom:v,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-a+1)/i),p=Math.ceil((n-l+1)/s),f=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(i,c,u,h,y,b,v,_,k,T,a),N=s?g*d:g;let I;return"channelsFirst"===o?I=[l,N,M,C,A]:"channelsLast"===o&&(I=[l,M,C,A,N]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:M,outHeight:C,outWidth:A,outChannels:N,padInfo:E,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:_,effectiveFilterHeight:k,effectiveFilterWidth:T,dilationDepth:x,dilationHeight:w,dilationWidth:S,inShape:t,outShape:I,filterShape:e}}function Ui(t,e,n,r=1){const i=Wi(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function Vi(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function ji(t){return"number"==typeof t?[t,t,t]:t}function Wi(t,e){return e<=1?t:t+(t-1)*(e-1)}function Hi(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Gi(t){const[e,n,r]=Vi(t);return 1===e&&1===n&&1===r}function qi(t,e){return Gi(t)||Gi(e)}function Xi(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Yi(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)c(m(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{c(m(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki=tn({reshape_:function(t,e){const n={x:Je(t,"x","reshape","string_or_numeric")},r={shape:e};return Ve.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zi=tn({avgPool_:function(t,e,n,r,i){const s=Je(t,"x","avgPool","float32");c(qi(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let o=s,a=!1;3===s.rank&&(a=!0,o=Ki(s,[1,s.shape[0],s.shape[1],s.shape[2]])),c(4===o.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`)),Yi("avgPool",r,i);const l={x:o},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let h=Ve.runKernel("AvgPool",l,u);return h=Yn(h,s.dtype),a?Ki(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ji=tn({avgPool3d_:function(t,e,n,r,i,s="NDHWC"){const o=Je(t,"x","avgPool3d","float32");let a=o,l=!1;4===o.rank&&(l=!0,a=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),c(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),c("NDHWC"===s,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),Yi("avgPool3d",r,i);const u={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let d=Ve.runKernel("AvgPool3D",u,h);return d=Yn(d,a.dtype),l?Ki(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qi=tn({concat_:function(t,e=0){c(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Qe(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return Kn(n[0]);const r=n,i={axis:e};return Ve.runKernel("Concat",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ts=tn({sigmoid_:function(t){const e={x:Je(t,"x","sigmoid","float32")};return Ve.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const es=tn({slice_:function(t,e,n){const r=Je(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:e,size:n};return Ve.runKernel("Slice",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ns=tn({tanh_:function(t){const e={x:Je(t,"x","tanh","float32")};return Ve.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rs=tn({basicLSTMCell_:function(t,e,n,r,i,s){const o=Je(t,"forgetBias","basicLSTMCell"),a=Je(e,"lstmKernel","basicLSTMCell"),l=Je(n,"lstmBias","basicLSTMCell"),c=Je(r,"data","basicLSTMCell"),u=Je(i,"c","basicLSTMCell"),h=Je(s,"h","basicLSTMCell"),d=Qi([c,h],1),p=gr(d,a),f=vi(p,l),m=f.shape[0],g=f.shape[1]/4,y=[m,g],b=es(f,[0,0],y),v=es(f,[0,g],y),x=es(f,[0,2*g],y),w=es(f,[0,3*g],y),S=vi(Si(ts(b),ns(v)),Si(u,ts(vi(o,x))));return[S,Si(ns(S),ts(w))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const is=tn({batchToSpaceND_:function(t,e,n){const r=Je(t,"x","batchToSpaceND"),i=e.reduce(((t,e)=>t*e));c(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),c(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),c(r.shape[0]%i==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`));const s={x:r},o={blockShape:e,crops:n};return Ve.runKernel("BatchToSpaceND",s,o)}});const ss=tn({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s){null==s&&(s=.001);const o=Je(t,"x","batchNorm"),a=Je(e,"mean","batchNorm"),l=Je(n,"variance","batchNorm");let u,h;null!=i&&(u=Je(i,"scale","batchNorm")),null!=r&&(h=Je(r,"offset","batchNorm")),c(a.rank===l.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),c(null==h||a.rank===h.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),c(null==u||a.rank===u.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const d=function(t){let e;return e=0===t.rank||1===t.rank?Ki(t,[1,1,1,t.size]):2===t.rank?Ki(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Ki(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(o),p={x:d,scale:u,offset:h,mean:a,variance:l},f={varianceEpsilon:s},m=Ve.runKernel("FusedBatchNorm",p,f);return Ki(m,o.shape)}});const os=tn({batchNorm2d_:function(t,e,n,r,i,s){const o=Je(t,"x","batchNorm"),a=Je(e,"mean","batchNorm"),l=Je(n,"variance","batchNorm");let u,h;return null!=i&&(u=Je(i,"scale","batchNorm")),null!=r&&(h=Je(r,"offset","batchNorm")),c(2===o.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`)),c(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),c(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=u&&c(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=h&&c(2===h.rank||1===h.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`)),ss(o,a,l,h,u,s)}});const as=tn({batchNorm3d_:function(t,e,n,r,i,s){const o=Je(t,"x","batchNorm"),a=Je(e,"mean","batchNorm"),l=Je(n,"variance","batchNorm");let u,h;return null!=i&&(u=Je(i,"scale","batchNorm")),null!=r&&(h=Je(r,"offset","batchNorm")),c(3===o.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`)),c(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),c(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=u&&c(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=h&&c(3===h.rank||1===h.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`)),ss(o,a,l,h,u,s)}});const ls=tn({batchNorm4d_:function(t,e,n,r,i,s){const o=Je(t,"x","batchNorm"),a=Je(e,"mean","batchNorm"),l=Je(n,"variance","batchNorm");let u,h;return null!=i&&(u=Je(i,"scale","batchNorm")),null!=r&&(h=Je(r,"offset","batchNorm")),c(4===o.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`)),c(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),c(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=u&&c(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=h&&c(4===h.rank||1===h.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`)),ss(o,a,l,h,u,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cs=tn({bincount_:function(t,e,n){const r=Je(t,"x","bincount"),i=Je(e,"weights","bincount");c("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),c(n>=0,(()=>`size must be non-negative, but got ${n}.`)),c(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const s={x:r,weights:i},o={size:n};return Ve.runKernel("Bincount",s,o)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const us=tn({broadcastArgs_:function(t,e){const n=Je(t,"s0","broadcastArgs","int32"),r=Je(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return Ve.runKernel("BroadcastArgs",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hs=tn({broadcastTo_:function(t,e){let n=Je(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=Ki(n,t)}const i=n.shape,s=Array.from(e);for(let t=e.length-1;t>=0;t--)if(i[t]===e[t])s[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const o=s.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===o.length)return Kn(n);const a={x:n},l={reps:s};return Ve.runKernel("Tile",a,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ds=tn({ceil_:function(t){const e={x:Je(t,"x","ceil","float32")};return Ve.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(t,e,n){const r={shape:t,value:e,dtype:n};return Ve.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fs=tn({clipByValue_:function(t,e,n){const r=Je(t,"x","clipByValue");if(c(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`)),e===n)return ps(r.shape,e,r.dtype);const i={x:r},s={clipValueMin:e,clipValueMax:n};return Ve.runKernel("ClipByValue",i,s)}});const ms=tn({concat1d_:function(t){return Qi(t,0)}});const gs=tn({concat2d_:function(t,e){return Qi(t,e)}});const ys=tn({concat3d_:function(t,e){return Qi(t,e)}});const bs=tn({concat4d_:function(t,e){return Qi(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vs=tn({conv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=Je(t,"x","conv2d","float32"),l=Je(e,"filter","conv2d","float32");let u=a,h=!1;3===a.rank&&(h=!0,u=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2]])),c(4===u.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`)),c(4===l.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`)),Yi("conv2d",r,o);const d="NHWC"===i?u.shape[3]:u.shape[1];c(d===l.shape[2],(()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`)),c(qi(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const p={x:u,filter:l},f={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},m=Ve.runKernel("Conv2D",p,f);return h?Ki(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const xs=tn({conv1d_:function(t,e,n,r,i="NWC",s=1,o){const a=Je(t,"x","conv1d"),l=Je(e,"filter","conv1d");let u=a,h=!1;2===a.rank&&(h=!0,u=Ki(a,[1,a.shape[0],a.shape[1]])),c(3===u.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`)),c(3===l.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`)),Yi("conv1d",r,o),c(u.shape[2]===l.shape[1],(()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`)),c(qi(n,s),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`)),c("NWC"===i,(()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`));const d=Ki(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=Ki(u,[u.shape[0],1,u.shape[1],u.shape[2]]),f=vs(p,d,[1,n],r,"NHWC",[1,s],o);return Ki(f,h?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ws=tn({conv2DBackpropInput_:function(t,e,n,r,i,s="NHWC",o){c(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,l=e,u=!1;3===e.rank&&(u=!0,l=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),c(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),c(4===l.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`)),c(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const h="NHWC"===s?a[3]:a[1],d="NHWC"===s?l.shape[3]:l.shape[1];c(h===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`)),c(d===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`)),Yi("conv2dDerInput",i,o);const p={dy:l,filter:n},f={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},m=Ve.runKernel("Conv2DBackpropInput",p,f);return u?Ki(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Ss=tn({conv2dTranspose_:function(t,e,n,r,i,s){const o=Je(t,"x","conv2dTranspose"),a=Je(e,"filter","conv2dTranspose");return ws(n,o,a,r,i,"NHWC",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _s=tn({conv3d_:function(t,e,n,r,i="NDHWC",s=[1,1,1]){const o=Je(t,"x","conv3d"),a=Je(e,"filter","conv3d");let l=o,u=!1;4===o.rank&&(u=!0,l=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),c(5===l.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`)),c(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),c(l.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),c(qi(n,s),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),c("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`));const h={x:l,filter:a},d={strides:n,pad:r,dataFormat:i,dilations:s},p=Ve.runKernel("Conv3D",h,d);return u?Ki(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ks=tn({conv3DBackpropInput_:function(t,e,n,r,i){c(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let s=t,o=e,a=!1;4===e.rank&&(a=!0,o=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const l=s[4],u=o.shape[4];c(5===s.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`)),c(5===o.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`)),c(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),c(l===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`)),c(u===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`));const h={dy:o,filter:n},d={pad:i,strides:r,inputShape:s},p=Ve.runKernel("Conv3DBackpropInputV2",h,d);return a?Ki(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});const Ts=tn({conv3dTranspose_:function(t,e,n,r,i){const s=Je(t,"x","conv3dTranspose"),o=Je(e,"filter","conv3dTranspose");return ks(n,s,o,r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Es=tn({cos_:function(t){const e={x:Je(t,"x","cos","float32")};return Ve.runKernel(Q,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ms=tn({cosh_:function(t){const e={x:Je(t,"x","cosh","float32")};return Ve.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cs=tn({cumprod_:function(t,e=0,n=!1,r=!1){const i={x:Je(t,"x","cumprod")},s={axis:e,exclusive:n,reverse:r};return Ve.runKernel("Cumprod",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const As=tn({cumsum_:function(t,e=0,n=!1,r=!1){const i={x:Je(t,"x","cumsum")},s={axis:e,exclusive:n,reverse:r};return Ve.runKernel("Cumsum",i,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ns=tn({denseBincount_:function(t,e,n,r=!1){const i=Je(t,"x","denseBincount"),s=Je(e,"weights","denseBincount");c("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),c(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),c(n>=0,(()=>`size must be non-negative, but got ${n}.`)),c(s.size===i.size||0===s.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`));const o={x:i,weights:s},a={size:n,binaryOutput:r};return Ve.runKernel("DenseBincount",o,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Is=tn({depthToSpace_:function(t,e,n="NHWC"){const r=Je(t,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];c(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),c(i*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),c(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),c(o%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`));const a={x:r},l={blockSize:e,dataFormat:n};return Ve.runKernel("DepthToSpace",a,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $s=tn({depthwiseConv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=Je(t,"x","depthwiseConv2d","float32"),l=Je(e,"filter","depthwiseConv2d","float32");let u=a,h=!1;3===a.rank&&(h=!0,u=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2]])),c(4===u.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`)),c(4===l.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`));const d="NHWC"===i?u.shape[3]:u.shape[1];c(d===l.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`)),Yi("depthwiseConv2d",r,o);const p={x:u,filter:l},f={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},m=Ve.runKernel("DepthwiseConv2dNative",p,f);return h?Ki(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rs=tn({diag_:function(t){const e={x:Je(t,"x","diag")};return Ve.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Os=tn({dilation2d_:function(t,e,n,r,i=[1,1],s="NHWC"){const o=Je(t,"x","dilation2d"),a=Je(e,"filter","dilation2d");c(3===o.rank||4===o.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`)),c(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),c("NHWC"===s,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`));let l=o,u=!1;3===o.rank&&(l=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0);const h={x:l,filter:a},d={strides:n,pad:r,dilations:i},p=Ve.runKernel("Dilation2D",h,d);return u?Ki(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ps=tn({equal_:function(t,e){let n=Je(t,"a","equal","string_or_numeric"),r=Je(e,"b","equal","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("Equal",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ls=tn({where_:function(t,e,n){const r=Je(e,"a","where"),i=Je(n,"b","where"),s=Je(t,"condition","where","bool"),o=Or(Or(s.shape,r.shape),i.shape),a={condition:hs(s,o),t:hs(r,o),e:hs(i,o)};return Ve.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=tn({zerosLike_:function(t){const e={x:Je(t,"x","zerosLike")};return Ve.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fs=tn({divNoNan_:function(t,e){let n=Je(t,"a","div"),r=Je(e,"b","div");[n,r]=$e(n,r);const i=wi(n,r),s=Ds(i),o=Ps(r,s);return Ls(o,s,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zs=tn({dot_:function(t,e){const n=Je(t,"t1","dot"),r=Je(e,"t2","dot");c(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(c(i===s,(()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`)),1===n.rank&&1===r.rank){const t=Ki(n,[1,-1]),e=Ki(r,[-1,1]),i=gr(t,e);return Ki(i,[])}if(1===n.rank&&2===r.rank){const t=Ki(n,[1,-1]),e=Ki(r,[r.shape[0],r.shape[1]]),i=gr(t,e);return Ki(i,[i.size])}if(2===n.rank&&1===r.rank){const t=Ki(r,[-1,1]),e=gr(n,t);return Ki(e,[e.size])}{const t=Ki(r,[r.shape[0],r.shape[1]]);return gr(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bs=tn({einsum_:function(t,...e){const n=e.map(((t,e)=>Je(t,`tensors${e}`,"einsum"))),r={equation:t};return Ve.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Us=tn({elu_:function(t){const e={x:Je(t,"x","elu","float32")};return Ve.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vs=tn({erf_:function(t){let e=Je(t,"x","erf");c("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=Yn(e,"float32"));const n={x:e};return Ve.runKernel(tt,n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Ws(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?i.push(t[s++]):i.push(e[o++]);return i}function Hs(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((e=>t[e]))]}function Gs(t,e){return Ws(t,e.map((t=>1)),e)}function qs(t,e,n){c(js(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Xs(t,e){if(js(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function Ys(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function Ks(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zs=tn({max_:function(t,e=null,n=!1){const r={x:Je(t,"x","max")},i={reductionIndices:e,keepDims:n};return Ve.runKernel("Max",r,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Js=tn({min_:function(t,e=null,n=!1){const r={x:Je(t,"x","min")},i={axis:e,keepDims:n};return Ve.runKernel("Min",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qs=tn({pow_:function(t,e){let n=Je(t,"base","pow"),r=Je(e,"exp","pow");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel(it,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(t,e){if((M(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&M(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return nn(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eo=tn({sqrt_:function(t){const e={x:Je(t,"x","sqrt","float32")};return Ve.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const no=tn({square_:function(t){const e=Je(t,"x","square");return Ve.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ro=tn({sum_:function(t,e=null,n=!1){let r=Je(t,"x","sum");"bool"===r.dtype&&(r=Yn(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Ve.runKernel("Sum",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function io(t,e,n=null){if(0===t.rank)return _i(t);if(1!==t.rank&&null===n)return io(Ki(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return ro(_i(t),n);if(e===1/0)return Zs(_i(t),n);if(e===-1/0)return Js(_i(t),n);if("euclidean"===e||2===e)return eo(ro(Qs(_i(t),to(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Zs(ro(_i(t),n[0]),n[1]-1);if(e===1/0)return Zs(ro(_i(t),n[1]),n[0]);if(e===-1/0)return Js(ro(_i(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return eo(ro(no(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const so=tn({norm_:function(t,e="euclidean",n=null,r=!1){const i=io(t=Je(t,"x","norm"),e,n);let s=i.shape;if(r){const e=x(n,t.shape);s=Gs(i.shape,e)}return Ki(i,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oo=tn({euclideanNorm_:function(t,e=null,n=!1){return so(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ao=tn({exp_:function(t){const e={x:Je(t,"x","exp")};return Ve.runKernel(et,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lo=tn({expandDims_:function(t,e=0){const n=Je(t,"x","expandDims","string_or_numeric");c(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},i={dim:e};return Ve.runKernel("ExpandDims",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const co=tn({expm1_:function(t){const e={x:Je(t,"x","expm1")};return Ve.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uo=tn({tile_:function(t,e){const n=Je(t,"x","tile","string_or_numeric");c(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},i={reps:e};return Ve.runKernel("Tile",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho=tn({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=Xn([t,e],r),s=t<=e?t:e;for(let t=0;t<s;++t)i.set(1,t,t);const o=Ki(i.toTensor(),[t,e]);if(null==n)return o;if(1===n.length)return uo(lo(o,0),[n[0],1,1]);if(2===n.length)return uo(lo(lo(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return uo(lo(lo(lo(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po=tn({floor_:function(t){const e={x:Je(t,"x","floor","float32")};return Ve.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fo=tn({gather_:function(t,e,n=0,r=0){const i={x:Je(t,"x","gather"),indices:Je(e,"indices","gather","int32")},s={axis:n,batchDims:r};return Ve.runKernel("GatherV2",i,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mo=tn({greater_:function(t,e){let n=Je(t,"a","greater","string_or_numeric"),r=Je(e,"b","greater","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("Greater",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const go=tn({greaterEqual_:function(t,e){let n=Je(t,"a","greaterEqual","string_or_numeric"),r=Je(e,"b","greaterEqual","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("GreaterEqual",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yo=tn({isFinite_:function(t){const e={x:Je(t,"x","isFinite")};return Ve.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo=tn({isInf_:function(t){const e={x:Je(t,"x","isInf")};return Ve.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vo=tn({isNaN_:function(t){const e={x:Je(t,"x","isNaN")};return Ve.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xo=tn({leakyRelu_:function(t,e=.2){const n={x:Je(t,"x","leakyRelu")},r={alpha:e};return Ve.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wo=tn({less_:function(t,e){let n=Je(t,"a","less","string_or_numeric"),r=Je(e,"b","less","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("Less",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const So=tn({lessEqual_:function(t,e){let n=Je(t,"a","lessEqual","string_or_numeric"),r=Je(e,"b","lessEqual","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("LessEqual",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _o(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return Ve.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ko=tn({localResponseNormalization_:function(t,e=5,n=1,r=1,i=.5){const s=Je(t,"x","localResponseNormalization");c(4===s.rank||3===s.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`)),c(m(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let o=s,a=!1;3===s.rank&&(a=!0,o=Ki(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:o},u={depthRadius:e,bias:n,alpha:r,beta:i},h=Ve.runKernel("LRN",l,u);return a?Ki(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const To=tn({log_:function(t){const e={x:Je(t,"x","log","float32")};return Ve.runKernel(nt,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eo=tn({log1p_:function(t){const e={x:Je(t,"x","log1p")};return Ve.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mo(t,e){c(O(t),(()=>"The f passed in variableGrads(f) must be a function")),c(null==e||Array.isArray(e)&&e.every((t=>t instanceof _e)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in Ve.registeredVariables)e.push(Ve.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,i=e.length;e=e.filter((t=>t.trainable)),c(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`));const{value:s,grads:o}=Ve.gradients(t,e,null,!0);c(o.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),c(0===s.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=o[e]&&(a[t.name]=o[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:s,grads:a}}function Co(t){return Ve.customGrad(t)}function Ao(t){if(t.filter((t=>null==t)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const No=tn({softplus_:function(t){const e={x:Je(t,"x","softplus")};return Ve.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Io=tn({logSigmoid_:function(t){const e=Je(t,"x","logSigmoid"),n=Co((t=>({value:Mr(No(Mr(t))),gradFunc:e=>Si(e,ts(Mr(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $o=tn({sub_:function(t,e){let n=Je(t,"a","sub"),r=Je(e,"b","sub");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel(ot,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ro=tn({logSoftmax_:function(t,e=-1){const n=Je(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=Co(((t,n)=>{const r=Zs(t,e,!0),i=$o(t,r),s=$o(Yn(i,"float32"),To(ro(ao(i),e,!0)));n([s]);return{value:s,gradFunc:(t,n)=>{const[r]=n,i=ao(r);return $o(t,Si(ro(t,e,!0),i))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oo=tn({logSumExp_:function(t,e=null,n=!1){const r=Je(t,"x","logSumExp"),i=x(e,r.shape),s=Zs(r,i,!0),o=$o(r,s),a=ao(o),l=ro(a,i),c=To(l),u=vi(Ki(s,c.shape),c);if(n){const t=Gs(u.shape,i);return Ki(u,t)}return u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Po=tn({logicalAnd_:function(t,e){const n=Je(t,"a","logicalAnd","bool"),r=Je(e,"b","logicalAnd","bool");Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("LogicalAnd",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lo=tn({logicalNot_:function(t){const e={x:Je(t,"x","logicalNot","bool")};return Ve.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=tn({logicalOr_:function(t,e){const n=Je(t,"a","logicalOr","bool"),r=Je(e,"b","logicalOr","bool");Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("LogicalOr",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fo=tn({logicalXor_:function(t,e){const n=Je(t,"a","logicalXor","bool"),r=Je(e,"b","logicalXor","bool");return Or(n.shape,r.shape),Po(Do(t,e),Lo(Po(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zo=tn({searchSorted_:function(t,e,n="left"){const r=Je(t,"sortedSequence","searchSorted"),i=Je(e,"values","searchSorted"),s=r.shape[r.shape.length-1],o=i.shape[i.shape.length-1],a=Ki(r,[-1,s]),l=Ki(i,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(p(l.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:l},u={side:n};return Ve.runKernel("SearchSorted",c,u)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bo(t,e){return zo(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uo=tn({maxPool_:function(t,e,n,r,i){const s=Je(t,"x","maxPool");let o=s,a=!1;3===s.rank&&(a=!0,o=Ki(s,[1,s.shape[0],s.shape[1],s.shape[2]])),c(4===o.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`)),c(qi(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),Yi("maxPool",r,i);const l={x:o},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i},h=Ve.runKernel("MaxPool",l,u);return a?Ki(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vo=tn({maxPool3d_:function(t,e=[1,1,1],n,r,i,s="NDHWC"){const o=Je(t,"x","maxPool3d");let a=o,l=!1;4===o.rank&&(l=!0,a=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),c(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),c("NDHWC"===s,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),Yi("maxPool3d",r,i);const u={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},d=Ve.runKernel("MaxPool3D",u,h);return l?Ki(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jo=tn({maxPoolWithArgmax_:function(t,e,n,r,i=!1){const s={x:Je(t,"x","maxPoolWithArgmax")},o={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},a=Ve.runKernel("MaxPoolWithArgmax",s,o);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wo=tn({maximum_:function(t,e){let n=Je(t,"a","maximum"),r=Je(e,"b","maximum");[n,r]=$e(n,r),"bool"===n.dtype&&(n=Yn(n,"int32"),r=Yn(r,"int32")),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("Maximum",i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=tn({mean_:function(t,e=null,n=!1){const r={x:Je(t,"x","mean")},i={axis:e,keepDims:n};return Ve.runKernel("Mean",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(t,e="float32"){if("complex64"===e){const e=Go(t,"float32"),n=Go(t,"float32");return en(e,n)}const n=B(p(t),e);return Ve.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qo(t,e="float32"){if("complex64"===e){const e=qo(t,"float32"),n=Go(t,"float32");return en(e,n)}const n=z(p(t),e);return Ve.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=Je(t,"x","meshgrid",t instanceof we?t.dtype:"float32");if(void 0===e)return[r];let i=Je(e,"y","meshgrid",e instanceof we?e.dtype:"float32");const s=p(r.shape),o=p(i.shape);return"xy"===n?(r=Ki(r,[1,-1]),i=Ki(i,[-1,1]),[gr(qo([o,1],r.dtype),r),gr(i,qo([1,s],i.dtype))]):(r=Ki(r,[-1,1]),i=Ki(i,[1,-1]),[gr(r,qo([1,o],r.dtype)),gr(qo([s,1],i.dtype),i)])}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yo=tn({minimum_:function(t,e){let n=Je(t,"a","minimum"),r=Je(e,"b","minimum");[n,r]=$e(n,r),"bool"===n.dtype&&(n=Yn(n,"int32"),r=Yn(r,"int32")),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("Minimum",i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ko=tn({mirrorPad_:function(t,e,n){c("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=Je(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");c(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const i="reflect"===n?1:0;for(let t=0;t<r.rank;t++)c(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),c(e[t][0]>=0&&e[t][0]<=r.shape[t]-i&&e[t][1]>=0&&e[t][1]<=r.shape[t]-i,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-i} or less than 0 for input of shape ${r.shape}`));const s={paddings:e,mode:n},o={x:r};return Ve.runKernel("MirrorPad",o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zo=tn({mod_:function(t,e){let n=Je(t,"a","mod"),r=Je(e,"b","mod");[n,r]=$e(n,r);const i={a:n,b:r};return Ve.runKernel(rt,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jo=tn({moments_:function(t,e=null,n=!1){const r=x(e,(t=Je(t,"x","moments")).shape),i=Ho(t,r,n);let s=i.shape;n||(s=Gs(i.shape,r));const o=no($o(Yn(t,"float32"),Ki(i,s)));return{mean:i,variance:Ho(o,r,n)}}});const Qo=tn({multiRNNCell_:function(t,e,n,r){const i=Je(e,"data","multiRNNCell"),s=Qe(n,"c","multiRNNCell"),o=Qe(r,"h","multiRNNCell");let a=i;const l=[];for(let e=0;e<t.length;e++){const n=t[e](a,s[e],o[e]);l.push(n[0]),l.push(n[1]),a=n[1]}const c=[],u=[];for(let t=0;t<l.length;t+=2)c.push(l[t]),u.push(l[t+1]);return[c,u]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ta=tn({multinomial_:function(t,e,n,r=!1){const i=Je(t,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const a={logits:1===o?Ki(i,[1,-1]):i},l={numSamples:e,seed:n,normalized:r},c=Ve.runKernel("Multinomial",a,l);return 1===o?Ki(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ea=tn({notEqual_:function(t,e){let n=Je(t,"a","notEqual","string_or_numeric"),r=Je(e,"b","notEqual","string_or_numeric");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("NotEqual",i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const na=tn({onesLike_:function(t){const e={x:Je(t,"x","onesLike")};return Ve.runKernel("OnesLike",e)}});const ra=tn({outerProduct_:function(t,e){const n=Je(t,"v1","outerProduct"),r=Je(e,"v2","outerProduct");c(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const i=Ki(n,[-1,1]),s=Ki(r,[1,-1]);return gr(i,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=tn({pad_:function(t,e,n=0){const r=Je(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},s={x:r};return Ve.runKernel("PadV2",s,i)}});const sa=tn({pad1d_:function(t,e,n=0){return c(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),ia(t,[e],n)}});const oa=tn({pad2d_:function(t,e,n=0){return c(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),ia(t,e,n)}});const aa=tn({pad3d_:function(t,e,n=0){return c(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),ia(t,e,n)}});const la=tn({pad4d_:function(t,e,n=0){return c(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),ia(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ca=tn({spaceToBatchND_:function(t,e,n){const r=Je(t,"x","spaceToBatchND");c(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),c(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),c(r.shape.reduce(((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const i={x:r},s={blockShape:e,paddings:n};return Ve.runKernel("SpaceToBatchND",i,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ua=tn({pool_:function(t,e,n,r,i,s,o){null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");const a=Je(t,"x","maxPool");let l=a,u=!1;3===a.rank&&(u=!0,l=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2]])),c(qi(s,i),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`));const h=Di(l.shape,e,s,i,r),d=[h.dilationHeight,h.dilationWidth];let p;p="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),i=r.map((t=>Math.floor(t/2))),s=r.map(((t,e)=>t-i[e]));return r.map(((t,e)=>[i[e],s[e]]))}([h.filterHeight,h.filterWidth],d):[[0,0],[0,0]];const f=1===d[0]&&1===d[1],[m,g]=function(t,e,n){const r=n.map((t=>t[0])),i=n.map((t=>t[1])),s=t.concat(r,i),o=e.map(((t,e)=>(t-s[e]%t)%t)),a=i.map(((t,e)=>t+o[e])),l=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,o[e]]));return[l,c]}([h.inHeight,h.inWidth],d,p),y=f?r:"valid",b=f?l:ca(l,d,m),v=("avg"===n?()=>Zi(b,e,s,y,o):()=>Uo(b,e,s,y,o))(),x=f?v:is(v,d,g);return u?Ki(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ha=tn({prelu_:function(t,e){const n={x:Je(t,"x","prelu"),alpha:Je(e,"alpha","prelu")};return Ve.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const da=tn({prod_:function(t,e=null,n=!1){let r=Je(t,"x","prod");"bool"===r.dtype&&(r=Yn(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Ve.runKernel("Prod",i,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pa=tn({raggedGather_:function(t,e,n,r){const i=t.map(((t,e)=>Je(t,`tensors${e}`,"raggedGather","int32"))),s={paramsNestedSplits:i,paramsDenseValues:Je(e,"paramsDenseValues","raggedGather"),indices:Je(n,"indices","raggedGather","int32")},o={outputRaggedRank:r},a=Ve.runKernel("RaggedGather",s,o);return{outputNestedSplits:a.slice(0,a.length-1),outputDenseValues:a[a.length-1]}}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fa=tn({raggedTensorToTensor_:function(t,e,n,r,i){const s=Je(t,"shape","raggedTensorToTensor","int32"),o=Je(e,"values","raggedTensorToTensor"),a=Je(n,"defaultValue","raggedTensorToTensor",o.dtype),l=r.map(((t,e)=>Je(t,`tensors${e}`,"raggedTensorToTensor","int32"))),c={shape:s,values:o,defaultValue:a,rowPartitionTensors:l},u={rowPartitionTypes:i};return Ve.runKernel("RaggedTensorToTensor",c,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ma=tn({rand_:function(t,e,n){const r=p(t);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);i=new Uint8Array(r)}for(let t=0;t<r;t++)i[t]=e();return Ve.makeTensor(i,t,n)}});var ga={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=String(e);for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function s(t,e){var n=new r(t),s=e&&e.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.alea=s}(0,ga,!1);var ya={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xor128=s}(0,ya,!1);var ba={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xorwow=s}(0,ba,!1);var va={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.x&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xorshift7=s}(0,va,!1);var xa={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],l=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,l=Math.max(l,e.length)),i=0,s=-32;s<l;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,i=0==(n=a[127&s]^=r+o)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=o,t.X=a,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.X&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xor4096=s}(0,xa,!1);var wa={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.tychei=s}(0,wa,!1);var Sa,_a={exports:{}},ka=vt(Object.freeze({__proto__:null,default:{}}));Sa=_a,function(t,e,n){var r,i=256,s=n.pow(i,6),o=n.pow(2,52),a=2*o,l=255;function c(l,c,m){var g=[],y=p(d((c=1==c?{entropy:!0}:c||{}).entropy?[l,f(e)]:null==l?function(){try{var n;return r&&(n=r.randomBytes)?n=n(i):(n=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(n)),f(n)}catch(n){var s=t.navigator,o=s&&s.plugins;return[+new Date,t,o,t.screen,f(e)]}}():l,3),g),b=new u(g),v=function(){for(var t=b.g(6),e=s,n=0;t<o;)t=(t+n)*i,e*=i,n=b.g(1);for(;t>=a;)t/=2,e/=2,n>>>=1;return(t+n)/e};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,p(f(b.S),e),(c.pass||m||function(t,e,r,i){return i&&(i.S&&h(i,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(v,y,"global"in c?c.global:this==n,c.state)}function u(t){var e,n=t.length,r=this,s=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<i;)a[s]=s++;for(s=0;s<i;s++)a[s]=a[o=l&o+t[s%n]+(e=a[s])],a[o]=e;(r.g=function(t){for(var e,n=0,s=r.i,o=r.j,a=r.S;t--;)e=a[s=l&s+1],n=n*i+a[l&(a[s]=a[o=l&o+e])+(a[o]=e)];return r.i=s,r.j=o,n})(i)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(d(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function p(t,e){for(var n,r=t+"",i=0;i<r.length;)e[l&i]=l&(n^=19*e[l&i])+r.charCodeAt(i++);return f(e)}function f(t){return String.fromCharCode.apply(0,t)}if(p(n.random(),e),Sa.exports){Sa.exports=c;try{r=ka}catch(t){}}else n.seedrandom=c}("undefined"!=typeof self?self:yt,[],Math);var Ta=ga.exports,Ea=ya.exports,Ma=ba.exports,Ca=va.exports,Aa=xa.exports,Na=wa.exports,Ia=_a.exports;Ia.alea=Ta,Ia.xor128=Ea,Ia.xorwow=Ma,Ia.xorshift7=Ca,Ia.xor4096=Aa,Ia.tychei=Na;var $a=Ia;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ra{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=i||Math.random();this.random=$a.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,s;do{r=2*this.random()-1,i=2*this.random()-1,s=r*r+i*i}while(s>=1||0===s);const o=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*r*o,e=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Oa{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const i=r||Math.random();this.randu=$a.alea(i.toString()),this.randn=new Ra(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,i,s;for(;;){do{r=this.randn.nextValue(),s=1+this.c*r}while(s<=0);if(s*=s*s,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-s+Math.log(s)),i=this.randu(),i<e||Math.log(i)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class Pa{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=$a.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const La=tn({randomGamma_:function(t,e,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const s=new Oa(e,n,r,i),o=Xn(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Da=tn({randomNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const s=new Ra(e,n,r,!1,i),o=Xn(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fa=tn({randomStandardNormal_:function(t,e,n){if(null!=e&&"bool"===e)throw new Error(`Unsupported data type ${e}`);return Da(t,0,1,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const za=tn({randomUniform_:function(t,e=0,n=1,r="float32",i){const s=Xn(t,r),o=new Pa(e,n,null,i);for(let t=0;t<s.values.length;t++)s.values[t]=o.nextValue();return s.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ba(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return Ve.runKernel("Range",{},i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ua=tn({reciprocal_:function(t){const e={x:Je(t,"x","reciprocal")};return Ve.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=tn({relu_:function(t){const e={x:Je(t,"x","relu")};return Ve.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ja=tn({relu6_:function(t){const e={x:Je(t,"x","relu6")};return Ve.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wa=tn({reverse_:function(t,e){const n={x:Je(t,"x","reverse")},r={dims:e};return Ve.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ha=tn({reverse1d_:function(t){const e=Je(t,"x","reverse");return c(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),Wa(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ga=tn({reverse2d_:function(t,e){const n=Je(t,"x","reverse");return c(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),Wa(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qa=tn({reverse3d_:function(t,e){const n=Je(t,"x","reverse");return c(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),Wa(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xa=tn({reverse4d_:function(t,e){const n=Je(t,"x","reverse");return c(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),Wa(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ya=tn({round_:function(t){const e={x:Je(t,"x","round")};return Ve.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ka=tn({rsqrt_:function(t){const e={x:Je(t,"x","rsqrt","float32")};return Ve.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Za=tn({selu_:function(t){const e={x:Je(t,"x","selu")};return Ve.runKernel("Selu",e)}});const Ja=tn({separableConv2d_:function(t,e,n,r,i,s=[1,1],o="NHWC"){const a=Je(t,"x","separableConv2d"),l=Je(e,"depthwiseFilter","separableConv2d"),u=Je(n,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(3===a.rank&&(d=!0,h=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");c(4===h.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`)),c(4===l.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`)),c(4===u.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`)),c(1===u.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`)),c(1===u.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`));const p=l.shape[2],f=l.shape[3];c(u.shape[2]===p*f,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${u.shape[2]}.`));const m=$s(h,l,r,i,o,s),g=vs(m,u,1,"valid",o);return d?Ki(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qa=async function(t,e){const n=Je(t,"x","setdiff1d"),r=Je(e,"y","setdiff1d");c(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),c(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),c(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let t=0;t<i.length;t++)o.has(i[t])||a++;const l=new be([a],n.dtype),u=new be([a],"int32");for(let t=0,e=0;t<i.length;t++)o.has(i[t])||(l.values[e]=i[t],u.values[e]=t,e++);return[l.toTensor(),u.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tl=tn({sign_:function(t){const e={x:Je(t,"x","sign")};return Ve.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const el=tn({sin_:function(t){const e={x:Je(t,"x","sin","float32")};return Ve.runKernel(st,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nl=tn({sinh_:function(t){const e={x:Je(t,"x","sinh")};return Ve.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rl=tn({slice1d_:function(t,e,n){const r=Je(t,"x","slice1d");return c(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),es(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const il=tn({slice2d_:function(t,e,n){const r=Je(t,"x","slice2d");return c(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),es(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sl=tn({slice3d_:function(t,e,n){const r=Je(t,"x","slice3d");return c(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),es(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ol=tn({slice4d_:function(t,e,n){const r=Je(t,"x","slice4d");return c(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),es(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=tn({softmax_:function(t,e=-1){const n=Je(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return Ve.runKernel("Softmax",r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ll=tn({fft_:function(t){c("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Ve.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=tn({ifft_:function(t){c("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Ve.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ul=tn({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=Ki(t,[n,e]);r=cl(i)}else{const i=[n,2*(e-1)],s=Ki(Cr(t),[n,e]),o=Ki(Er(t),[n,e]),a=Wa(es(s,[0,1],[n,e-2]),1),l=Si(Wa(es(o,[0,1],[n,e-2]),1),to(-1)),c=Qi([s,a],1),u=Qi([o,l],1),h=Ki(en(c,u),[i[0],i[1]]);r=cl(h)}if(r=Cr(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=Ki(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hl=tn({split_:function(t,e,n=0){const r={x:Je(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Ve.runKernel("SplitV",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dl=tn({rfft_:function(t,e){c("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(null!=e&&e<n){const r=t.shape.map((t=>0)),s=t.shape.map((t=>t));s[t.shape.length-1]=e,i=es(t,r,s),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,i=Qi([t,Go(r)],t.shape.length-1),n=e}else i=t;const s=Ds(i),o=Ki(en(i,s),[r,n]),a=ll(o),l=Math.floor(n/2)+1,u=Cr(a),h=Er(a),d=hl(u,[l,n-l],u.shape.length-1),p=hl(h,[l,n-l],h.shape.length-1),f=i.shape.slice();return f[i.shape.length-1]=l,Ki(en(d[0],p[0]),f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pl=tn({squaredDifference_:function(t,e){let n=Je(t,"a","squaredDifference"),r=Je(e,"b","squaredDifference");[n,r]=$e(n,r),Or(n.shape,r.shape);const i={a:n,b:r};return Ve.runKernel("SquaredDifference",i,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl=tn({squeeze_:function(t,e){const n=Je(t,"x","squeeze","string_or_numeric");return Ki(n,w(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ml=tn({stack_:function(t,e=0){const n=Qe(t,"tensors","stack","string_or_numeric");c(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&c(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,i={axis:e};return Ve.runKernel("Pack",r,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gl=tn({step_:function(t,e=0){const n={x:Je(t,"x","step")},r={alpha:e};return Ve.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yl=tn({stridedSlice_:function(t,e,n,r,i=0,s=0,o=0,a=0,l=0){const c={x:Je(t,"x","stridedSlice","string_or_numeric")},u={begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return Ve.runKernel("StridedSlice",c,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bl=tn({tan_:function(t){const e={x:Je(t,"x","tan","float32")};return Ve.runKernel(at,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vl(t,e){h(t);const n=Ye(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return nn(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xl(t,e,n){if(h(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Ye(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return nn(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wl(t,e,n){if(h(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Ye(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return nn(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(t,e,n){if(h(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Ye(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return nn(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(t,e,n){if(h(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Ye(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return nn(t,e=e||r,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kl=tn({topk_:function(t,e=1,n=!0){const r=Je(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const s={x:r},o={k:e,sorted:n},[a,l]=Ve.runKernel("TopK",s,o);return{values:a,indices:l}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tl=tn({truncatedNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new Ra(e,n,r,!0,i),o=Xn(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const El=tn({unique_:function(t,e=0){const n=Je(t,"x","unique","string_or_numeric");c(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},i={axis:e},[s,o]=Ve.runKernel("Unique",r,i);return{values:s,indices:o}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ml=tn({unsortedSegmentSum_:function(t,e,n){const r=Je(t,"x","unsortedSegmentSum"),i=Je(e,"segmentIds","unsortedSegmentSum","int32");c(m(n),(()=>"numSegments must be of dtype int"));const s={x:r,segmentIds:i},o={numSegments:n};return Ve.runKernel("UnsortedSegmentSum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cl=tn({unstack_:function(t,e=0){const n=Je(t,"x","unstack","string_or_numeric");c(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},i={axis:e};return Ve.runKernel("Unpack",r,i)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Al(t,e){return zo(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nl(t,e=!0,n,r){return Ve.makeVariable(t,e,n,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Il(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=Xn(t,"int32"),i=Xn([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const s=r.indexToLoc(n[e]),o=e*t.length;i.values.set(s,o)}return i.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $l=async function(t){const e=Je(t,"condition","whereAsync","bool"),n=await e.data(),r=Il(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rl=async function(t,e,n){const r=Je(t,"tensor","boolMask"),i=Je(e,"mask","boolMask","bool"),s=null==n?0:n,o=i.rank,a=r.shape;c(o>0,(()=>"mask cannot be scalar")),u(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let t=s;t<s+o;t++)l*=a[t];const h=a.slice(0,s).concat([l],a.slice(s+o)),d=Ki(r,h),p=Ki(i,[-1]),f=await $l(p),m=fl(f,[1]),g=fo(d,m,s);return t!==r&&r.dispose(),e!==i&&i.dispose(),m.dispose(),d.dispose(),p.dispose(),f.dispose(),g};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ol=tn({movingAverage_:function(t,e,n,r,i=!0){const s=Je(t,"v","movingAverage"),o=Je(e,"x","movingAverage"),a=Je(n,"decay","movingAverage");Re(s,o),c(f(s.shape,o.shape),(()=>"Shape mismatch in v and x"));const l=to(1),u=$o(l,a);let h=Si($o(o,s),u);if(i){c(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=Je(r,"step","movingAverage");h=wi(h,$o(l,Qs(a,t)))}return vi(s,h)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pl=tn({scatterND_:function(t,e,n){const r=Je(t,"indices","scatterND","int32"),i=Je(e,"updates","scatterND");Gr(i,r,n);const s={indices:r,updates:i},o={shape:n};return Ve.runKernel("ScatterNd",s,o)}});const Ll=tn({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const i=Je(t,"sparseIndices","sparseToDense","int32"),s=Je(e,"sparseValues","sparseToDense","string_or_numeric"),o=Je(r,"defaultValue","sparseToDense",s.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,s=t.rank>1?t.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=e.size;if(0!==e.rank&&(1!==e.rank||o!==i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},l={outputShape:n};return Ve.runKernel("SparseToDense",a,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dl=tn({gatherND_:function(t,e){const n=Je(e,"indices","gatherND","int32"),r={params:Je(t,"x","gatherND","string_or_numeric"),indices:n};return Ve.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fl=tn({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const i=Je(t,"x","dropout");if(c("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),c(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof we?i.clone():i;const s=function(t,e){if(null==e)return t.shape.slice();if(f(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),o=1-e,a=wi(po(vi(za(s,0,1,"float32",r),o)),o);return Si(i,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zl(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function Bl(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let s=0;s<t;++s){const o=2*Math.PI*s/(t+r-1);i[s]=e-n*Math.cos(o)}return vl(i,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ul=async function(t,e,n=1){const r=Je(t,"predictions","inTopK"),i=Je(e,"targets","inTopK");c(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),c(r.rank-1===i.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`)),u(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];c(n>0&&n<=s,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`));const o=await r.data(),a=await i.data(),[l,h]=[o.length/s,s],d=S("bool",l);for(let t=0;t<l;t++){const e=t*h,r=o.subarray(e,e+h),i=[];for(let t=0;t<r.length;t++)i.push({value:r[t],index:t});i.sort(((t,e)=>e.value-t.value)),d[t]=0;for(let e=0;e<n;e++)if(i[e].index===a[t]){d[t]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),rn(d,i.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vl=tn({conv2DBackpropFilter_:function(t,e,n,r,i,s="NHWC",o){let a=t;3===t.rank&&(a=Ki(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2]])),c(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),c(4===l.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`)),c(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const u="NHWC"===s?a.shape[3]:a.shape[1],h="NHWC"===s?l.shape[3]:l.shape[1];c(u===n[2],(()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`)),c(h===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`)),Yi("conv2dDerFilter",i,o);const d={x:a,dy:l},p={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return Ve.runKernel("Conv2DBackpropFilter",d,p)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jl(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return Si(t,gl(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Wl(t,e){let n=e;const r=Rr(t.shape,e.shape);return r.length>0&&(n=ro(n,r)),Ki(n,t.shape)}function Hl(t,e,n,r){if("linear"===e)return t;if("relu"===e)return Va(t);if("elu"===e)return Us(t);if("relu6"===e)return ja(t);if("prelu"===e)return ha(t,n);if("leakyrelu"===e)return xo(t,r);if("sigmoid"===e)return ts(t);throw new Error(`Unknown fused activation ${e}.`)}const Gl=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ql=tn({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",!1===Gl(Ve.state.gradientDepth,l)){c("NHWC"===i,(()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let d=vs(t,e,n,r,i,s,o);return null!=a&&(d=vi(d,a)),Hl(d,l,u,h)}const d=Je(t,"x","conv2d","float32"),p=Je(e,"filter","conv2d","float32");let f=d,m=!1;3===d.rank&&(m=!0,f=Ki(d,[1,d.shape[0],d.shape[1],d.shape[2]])),c(4===f.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`)),c(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),Yi("fused conv2d",r,o);const g="NHWC"===i?f.shape[3]:f.shape[1];c(p.shape[2]===g,(()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`)),c(qi(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const y=zi(f.shape,p.shape,n,s,r,o);let b,v;if(null!=a&&(b=Je(a,"bias","fused conv2d"),[b]=$e(b,d),"NHWC"===i?Or(y.outShape,b.shape):(c(b.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`)),c(0===b.shape.length||b.shape[0]===y.outChannels||1===b.shape[0],(()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=u){const t=u.shape;if(c(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)c(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{Or(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}v=Je(u,"prelu weights","fused conv2d")}const x=(t,e)=>{c("NHWC"===i,(()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`));const[o,a,u,h]=e,d=jl(t,u,l);c(Gi(s),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const p=[ws(a.shape,d,o,n,r),Vl(a,d,o.shape,n,r)];if(null!=h){const t=Wl(h,d);p.push(t)}return p},w={x:f,filter:p,bias:b,preluActivationWeights:v},S={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:h};if(null==a){const t=Co(((t,e,n)=>{let r=Ve.runKernel("FusedConv2D",w,S);return n([e,t,r]),m&&(r=Ki(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}));return t(f,p)}{const t=Co(((t,e,n,r)=>{let i=Ve.runKernel("FusedConv2D",w,S);return r([e,t,i,n]),m&&(i=Ki(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:x}}));return t(f,p,b)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xl=tn({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,s=[1,1],o){let a=t;3===t.rank&&(a=Ki(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return Ve.runKernel("DepthwiseConv2dNativeBackpropFilter",c,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yl=tn({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,s=[1,1],o){let a=e,l=!1;3===e.rank&&(l=!0,a=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:t},h=Ve.runKernel("DepthwiseConv2dNativeBackpropInput",c,u);return l?Ki(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kl=tn({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(!1===Gl(Ve.state.gradientDepth,l)){let c=$s(t,e,n,r,i,s,o);return null!=a&&(c=vi(c,a)),Hl(c,l,u,h)}const d=Je(t,"x","depthwiseConv2d","float32"),p=Je(e,"filter","depthwiseConv2d","float32");let f=d,m=!1;3===d.rank&&(m=!0,f=Ki(d,[1,d.shape[0],d.shape[1],d.shape[2]])),c(4===f.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`)),c(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),c(f.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==s&&(s=[1,1]),c(qi(n,s),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),Yi("fused depthwiseConv2d",r,o);const g=zi(f.shape,p.shape,n,s,r,o,!0);let y,b;null!=a&&(y=Je(a,"bias","fused conv2d"),[y]=$e(y,d),Or(g.outShape,y.shape)),null!=u&&(b=Je(u,"prelu weights","fused depthwiseConv2d"));const v=(t,e)=>{c(Gi(s),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`));const[i,a,u,h]=e,d=jl(t,u,l),p=Yl(a.shape,d,i,n,r,s,o),f=Xl(a,d,i.shape,n,r,s,o);if(null!=h){return[p,f,Wl(y,d)]}return[p,f]},x={x:f,filter:p,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:h};if(null==a){const t=Co(((t,e,n)=>{let r=Ve.runKernel("FusedDepthwiseConv2D",x,w);return n([e,t,r]),m&&(r=Ki(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return t(f,p)}{const t=Co(((t,e,n,r)=>{let i=Ve.runKernel("FusedDepthwiseConv2D",x,w);return r([e,t,i,n]),m&&(i=Ki(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}}));return t(f,p,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zl=tn({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(!1===Gl(Ve.state.gradientDepth,s)){let l=gr(t,e,n,r);return null!=i&&(l=vi(l,i)),Hl(l,s,o,a)}let l=Je(t,"a","fused matMul"),u=Je(e,"b","fused matMul");[l,u]=$e(l,u);const h=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],m=r?u.shape[u.rank-2]:u.shape[u.rank-1],g=l.shape.slice(0,-2),y=u.shape.slice(0,-2),b=p(g),v=p(y);c(h===d,(()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=Or(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,m]),w=Ki(l,n?[b,h,f]:[b,f,h]),S=Ki(u,r?[v,m,d]:[v,d,m]);let _,k;null!=i&&(_=Je(i,"bias","fused matMul"),[_]=$e(_,l),Or(x,_.shape)),null!=o&&(k=Je(o,"prelu weights","fused matMul"));const T=(t,e)=>{const[o,a,l,c]=e,u=jl(Ki(t,l.shape),l,s);let h,d;if(n||r?!n&&r?(h=gr(u,a,!1,!1),d=gr(u,o,!0,!1)):n&&!r?(h=gr(a,u,!1,!0),d=gr(o,u,!1,!1)):(h=gr(a,u,!0,!0),d=gr(u,o,!0,!0)):(h=gr(u,a,!1,!0),d=gr(o,u,!0,!1)),null!=i){return[h,d,Wl(c,u)]}return[h,d]},E={a:w,b:S,bias:_,preluActivationWeights:k},M={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};if(null==i){const t=Co(((t,e,n)=>{const r=Ve.runKernel("_FusedMatMul",E,M);return n([t,e,r]),{value:Ki(r,x),gradFunc:T}}));return t(w,S)}{const t=Co(((t,e,n,r)=>{const i=Ve.runKernel("_FusedMatMul",E,M);return r([t,e,i,n]),{value:Ki(i,x),gradFunc:T}}));return t(w,S,_)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Jl=Object.freeze({__proto__:null,conv2d:ql,depthwiseConv2d:Kl,matMul:Zl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ql=tn({hammingWindow_:function(t){return Bl(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tc=tn({hannWindow_:function(t){return Bl(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=tn({frame_:function(t,e,n,r=!1,i=0){let s=0;const o=[];for(;s+e<=t.size;)o.push(es(t,s,e)),s+=n;if(r)for(;s<t.size;){const r=s+e-t.size,a=Qi([es(t,s,e-r),ps([r],i)]);o.push(a),s+=n}return 0===o.length?xl([],[0,e]):Ki(Qi(o),[o.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nc=tn({stft_:function(t,e,n,r,i=tc){null==r&&(r=zl(e));const s=ec(t,e,n),o=Si(s,i(e));return dl(o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rc=tn({cropAndResize_:function(t,e,n,r,i="bilinear",s=0){const o=Je(t,"image","cropAndResize"),a=Je(e,"boxes","cropAndResize","float32"),l=Je(n,"boxInd","cropAndResize","int32"),u=a.shape[0];c(4===o.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`)),c(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`)),c(1===l.rank&&l.shape[0]===u,(()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`)),c(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),c(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),c("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const h={image:o,boxes:a,boxInd:l},d={method:i,extrapolationValue:s,cropSize:r};return Ve.runKernel("CropAndResize",h,d)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ic=tn({flipLeftRight_:function(t){const e=Je(t,"image","flipLeftRight","float32");c(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return Ve.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sc=tn({grayscaleToRGB_:function(t){const e=Je(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];c(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),c(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,uo(e,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oc=tn({rotateWithOffset_:function(t,e,n=0,r=.5){const i=Je(t,"image","rotateWithOffset","float32");c(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const s={image:i},o={radians:e,fillValue:n,center:r};return Ve.runKernel("RotateWithOffset",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ac(t,e,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);const o=t.shape[0];return n=Math.min(n,o),c(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),c(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),c(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),c(1===e.rank,(()=>"scores must be a 1D tensor")),c(e.shape[0]===o,(()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`)),c(0<=s&&s<=1,(()=>`softNmsSigma must be in [0, 1], but was '${s}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc=tn({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Je(t,"boxes","nonMaxSuppression","float32"),o=Je(e,"scores","nonMaxSuppression","float32"),a=ac(s,o,n,r,i),l={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold};return Ve.runKernel("NonMaxSuppressionV3",{boxes:s,scores:o},l)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cc(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(e,t[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||uc)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function uc(t,e){return t>e?1:t<e?-1:0}function hc(t,e,n,r,i){return fc(t,e,n,r,i,0)}function dc(t,e,n,r,i,s){return fc(t,e,n,r,i,0,!1,s,!0)}function pc(t,e,n,r,i,s){return fc(t,e,n,r,i,s,!0)}function fc(t,e,n,r,i,s,o=!1,a=!1,l=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>i&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(yc);const u=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:s,suppressBeginIndex:o}=e;if(n<i)break;let a=!1;for(let n=h.length-1;n>=o;--n){const o=mc(t,s,h[n]);if(o>=r){a=!0;break}if(e.score=e.score*gc(r,u,o),e.score<=i)break}e.suppressBeginIndex=h.length,a||(e.score===n?(h.push(s),d.push(e.score)):e.score>i&&cc(c,e,yc))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=p),m}function mc(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(a-s)*(l-o),f=(h-c)*(d-u);if(p<=0||f<=0)return 0;const m=Math.max(s,c),g=Math.max(o,u),y=Math.min(a,h),b=Math.min(l,d),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(p+f-v)}function gc(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function yc(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bc=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Je(t,"boxes","nonMaxSuppressionAsync"),o=Je(e,"scores","nonMaxSuppressionAsync"),a=ac(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([s.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:h}=hc(c,u,n,r,i);return s!==t&&s.dispose(),o!==e&&o.dispose(),vl(h,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vc=tn({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=Je(t,"boxes","nonMaxSuppression"),a=Je(e,"scores","nonMaxSuppression"),l=ac(o,a,n,r,i,s),c={boxes:o,scores:a},u={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},h=Ve.runKernel("NonMaxSuppressionV5",c,u);return{selectedIndices:h[0],selectedScores:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xc=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=Je(t,"boxes","nonMaxSuppressionAsync"),a=Je(e,"scores","nonMaxSuppressionAsync"),l=ac(o,a,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:p}=pc(u,h,n,r,i,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:vl(d,"int32"),selectedScores:vl(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wc=tn({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=Je(t,"boxes","nonMaxSuppression"),a=Je(e,"scores","nonMaxSuppression"),l=ac(o,a,n,r,i,null),c={boxes:o,scores:a},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s},h=Ve.runKernel("NonMaxSuppressionV4",c,u);return{selectedIndices:h[0],validOutputs:h[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=Je(t,"boxes","nonMaxSuppressionAsync"),a=Je(e,"scores","nonMaxSuppressionAsync"),l=ac(o,a,n,r,i,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:m}=dc(d,p,c,u,h,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:vl(f,"int32"),validOutputs:to(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _c=tn({resizeBilinear_:function(t,e,n=!1,r=!1){const i=Je(t,"images","resizeBilinear");c(3===i.rank||4===i.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`)),c(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),c(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=Ki(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},u=Ve.runKernel("ResizeBilinear",a,l);return o?Ki(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kc=tn({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const i=Je(t,"images","resizeNearestNeighbor");c(3===i.rank||4===i.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`)),c(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),c("float32"===i.dtype||"int32"===i.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),c(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=Ki(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},u=Ve.runKernel("ResizeNearestNeighbor",a,l);return o?Ki(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tc=tn({threshold_:function(t,e="binary",n=!1,r=.5){const i=Je(t,"image","threshold"),s=i.shape[0]*i.shape[1];let o,a,l,u,h=Si(vl([r]),255);if(c(3===i.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`)),c(3===i.shape[2]||1===i.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`)),c("int32"===i.dtype||"float32"===i.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`)),c("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===i.shape[2]){[o,a,l]=hl(i,[1,1,1],-1);const t=Si(o,.2989),e=Si(a,.587),n=Si(l,.114);u=vi(vi(t,e),n)}else u=t;if("otsu"===e){h=function(t,e){let n,r,i,s,o,a,l=vl([-1]),c=vl([0]),u=vl([0]);for(let h=0;h<t.size-1;h++){n=es(t,0,h+1),r=es(t,h+1),o=wi(ro(n),e),a=wi(ro(r),e);const d=ro(Si(n,Ba(0,n.size)));i=wi(d,ro(n));const p=ps(r.shape,n.size),f=vi(Ba(0,r.size),p),m=Si(r,f);s=wi(ro(m),ro(r));const g=$o(i,s),y=$o(i,s),b=Si(o,a);u=Si(Si(b,g),y);const v=mo(u,c);c=Ls(v,u,c),l=Ls(v,vl([h]),l)}return l}(cs(Yn(Ya(u),"int32"),rn([]),256),s)}const d=n?So(u,h):mo(u,h);return Yn(Si(d,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ec=tn({transform_:function(t,e,n="nearest",r="constant",i=0,s){const o=Je(t,"image","transform","float32"),a=Je(e,"transforms","transform","float32");c(4===o.rank,(()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`)),c(2===a.rank&&(a.shape[0]===o.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),c(null==s||2===s.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`));const l={image:o,transforms:a},u={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return Ve.runKernel("Transform",l,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mc=tn({bandPart_:function(t,e,n){c(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),c(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=Je(t,"a","bandPart");c(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[s,o]=r.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);e<0&&(e=s),n<0&&(n=o);const a=Ki(Ba(0,s,1,"int32"),[-1,1]),l=Ba(0,o,1,"int32"),u=$o(a,l),h=Po(So(u,to(+e,"int32")),go(u,to(-n,"int32"))),d=Go([s,o],r.dtype);return Ki(ml(Cl(Ki(r,[-1,s,o])).map((t=>Ls(h,t,d)))),i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cc=tn({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,c(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)c(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=hl(t,t.shape[0],0).map((t=>fl(t,[0])));c(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(Ve.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=Si(ro(Si(n[r],t)),n[r]);t=$o(t,e)}return wi(t,so(t,"euclidean"))})));return e?ml(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ac(t,e=!1){return Ve.tidy((()=>{c(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let i=ho(n),s=Kn(t);const o=xl([[1]],[1,1]);let a=Kn(o);const l=n>=r?r:n;for(let t=0;t<l;++t){const e=s,l=a,c=i;[a,s,i]=Ve.tidy((()=>{const e=es(s,[t,t],[n-t,1]),l=so(e),c=es(s,[t,t],[1,1]),u=Ls(mo(c,0),xl([[-1]]),xl([[1]])),h=$o(c,Si(u,l)),d=wi(e,h);a=1===d.shape[0]?Kn(o):Qi([o,es(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=Mr(wi(gr(u,h),l)),f=es(s,[t,0],[n-t,r]),m=Si(p,a),g=Ar(a);if(0===t)s=$o(f,gr(m,gr(g,f)));else{const e=$o(f,gr(m,gr(g,f)));s=Qi([es(s,[0,0],[t,r]),e],0)}const y=Ar(m),b=es(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=$o(b,gr(gr(b,a),y));else{const e=$o(b,gr(gr(b,a),y));i=Qi([es(i,[0,0],[n,t]),e],1)}return[a,s,i]})),wr([e,l,c])}return!e&&n>r&&(i=es(i,[0,0],[n,r]),s=es(s,[0,0],[r,r])),[i,s]}))}const Nc=tn({qr_:function(t,e=!1){if(c(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Ac(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=Cl(Ki(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];r.forEach((t=>{const[n,r]=Ac(t,e);i.push(n),s.push(r)}));return[Ki(ml(i,0),t.shape),Ki(ml(s,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ic;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ic||(Ic={}));const $c=tn({computeWeightedLoss_:function(t,e,n=Ic.SUM_BY_NONZERO_WEIGHTS){const r=Je(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=Je(e,"weights","computeWeightedLoss"));const s=null==i?r:Si(r,i);if(n===Ic.NONE)return s;if(n===Ic.SUM)return ro(s);if(n===Ic.MEAN){if(null==i)return Ho(s);{const t=r.size/i.size,e=wi(ro(s),ro(i));return t>1?wi(e,to(t)):e}}if(n===Ic.SUM_BY_NONZERO_WEIGHTS){if(null==i)return wi(ro(s),to(r.size));{const t=Si(i,qo(r.shape)),e=Yn(ro(ea(t,to(0))),"float32");return wi(ro(s),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rc=tn({absoluteDifference_:function(t,e,n,r=Ic.SUM_BY_NONZERO_WEIGHTS){const i=Je(t,"labels","absoluteDifference"),s=Je(e,"predictions","absoluteDifference");let o=null;null!=n&&(o=Je(n,"weights","absoluteDifference")),u(i.shape,s.shape,"Error in absoluteDifference: ");const a=_i($o(i,s));return $c(a,o,r)}});const Oc=tn({cosineDistance_:function(t,e,n,r,i=Ic.SUM_BY_NONZERO_WEIGHTS){const s=Je(t,"labels","cosineDistance"),o=Je(e,"predictions","cosineDistance");let a=null;null!=r&&(a=Je(r,"weights","cosineDistance")),u(s.shape,o.shape,"Error in cosineDistance: ");const l=to(1),c=$o(l,ro(Si(s,o),n,!0));return $c(c,a,i)}});const Pc=tn({hingeLoss_:function(t,e,n,r=Ic.SUM_BY_NONZERO_WEIGHTS){let i=Je(t,"labels","hingeLoss");const s=Je(e,"predictions","hingeLoss");let o=null;null!=n&&(o=Je(n,"weights","hingeLoss")),u(i.shape,s.shape,"Error in hingeLoss: ");const a=to(1);i=$o(Si(to(2),i),a);const l=Va($o(a,Si(i,s)));return $c(l,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lc=tn({huberLoss_:function(t,e,n,r=1,i=Ic.SUM_BY_NONZERO_WEIGHTS){const s=Je(t,"labels","huberLoss"),o=Je(e,"predictions","huberLoss");let a=null;null!=n&&(a=Je(n,"weights","huberLoss")),u(s.shape,o.shape,"Error in huberLoss: ");const l=to(r),c=_i($o(o,s)),h=Yo(c,l),d=$o(c,h),p=vi(Si(to(.5),no(h)),Si(l,d));return $c(p,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dc=tn({logLoss_:function(t,e,n,r=1e-7,i=Ic.SUM_BY_NONZERO_WEIGHTS){const s=Je(t,"labels","logLoss"),o=Je(e,"predictions","logLoss");let a=null;null!=n&&(a=Je(n,"weights","logLoss")),u(s.shape,o.shape,"Error in logLoss: ");const l=to(1),c=to(r),h=Mr(Si(s,To(vi(o,c)))),d=Si($o(l,s),To(vi($o(l,o),c))),p=$o(h,d);return $c(p,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fc=tn({meanSquaredError_:function(t,e,n,r=Ic.SUM_BY_NONZERO_WEIGHTS){const i=Je(t,"labels","meanSquaredError"),s=Je(e,"predictions","meanSquaredError");let o=null;null!=n&&(o=Je(n,"weights","meanSquaredError")),u(i.shape,s.shape,"Error in meanSquaredError: ");const a=pl(i,s);return $c(a,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zc=tn({sigmoidCrossEntropy_:function(t,e,n,r=0,i=Ic.SUM_BY_NONZERO_WEIGHTS){let s=Je(t,"multiClassLabels","sigmoidCrossEntropy");const o=Je(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=Je(n,"weights","sigmoidCrossEntropy")),u(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=to(r),e=to(1),n=to(.5);s=vi(Si(s,$o(e,t)),Si(n,t))}const l=function(t,e){const n=Je(t,"labels","sigmoidCrossEntropyWithLogits"),r=Je(e,"logits","sigmoidCrossEntropyWithLogits");u(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Va(r),s=Si(r,n),o=Eo(ao(Mr(_i(r))));return vi($o(i,s),o)}(s,o);return $c(l,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bc=tn({softmaxCrossEntropy_:function(t,e,n,r=0,i=Ic.SUM_BY_NONZERO_WEIGHTS){let s=Je(t,"onehotLabels","softmaxCrossEntropy");const o=Je(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=Je(n,"weights","softmaxCrossEntropy")),u(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const t=to(r),e=to(1),n=to(s.shape[1]);s=vi(Si(s,$o(e,t)),wi(t,n))}const l=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=Co(((t,e,r)=>{const i=Oo(e,[n],!0),s=$o(Yn(e,"float32"),i);r([t,s]);const o=Mr(Si(s,t));return{value:ro(o,[n]),gradFunc:(t,e)=>{const[r,i]=e,s=Gs(t.shape,[n]);return[Si(Ki(t,s),$o(Yn(r,"float32"),ao(i))),Si(Ki(t,s),$o(ao(i),Yn(r,"float32")))]}}}));return r(t,e)}(s,o);return $c(l,a,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uc=tn({sparseFillEmptyRows_:function(t,e,n,r){const i=Je(t,"indices","sparseFillEmptyRows","int32"),s=Je(e,"values","sparseFillEmptyRows"),o=Je(n,"denseShape","sparseFillEmptyRows","int32"),a=Je(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(2!==i.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==s.rank)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:i,values:s,denseShape:o,defaultValue:a},c=Ve.runKernel("SparseFillEmptyRows",l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vc=tn({sparseReshape_:function(t,e,n){const r=Je(t,"inputIndices","sparseReshape","int32"),i=Je(e,"inputShape","sparseReshape","int32"),s=Je(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==i.rank)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(1!==s.rank)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=Ve.runKernel("SparseReshape",o);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jc=tn({sparseSegmentMean_:function(t,e,n){const r=Je(t,"data","sparseSegmentMean"),i=Je(e,"indices","sparseSegmentMean","int32"),s=Je(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Ve.runKernel("SparseSegmentMean",o)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wc=tn({sparseSegmentSum_:function(t,e,n){const r=Je(t,"data","sparseSegmentSum"),i=Je(e,"indices","sparseSegmentSum","int32"),s=Je(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Ve.runKernel("SparseSegmentSum",o)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hc=tn({stringNGrams_:function(t,e,n,r,i,s,o,a){const l=Je(t,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=Je(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:c},d=Ve.runKernel("StringNGrams",h,u);return{nGrams:d[0],nGramsSplits:d[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gc=tn({stringSplit_:function(t,e,n=!0){const r=Je(t,"input","stringSplit","string"),i=Je(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==i.rank)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=Ve.runKernel("StringSplit",o,s);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qc=tn({stringToHashBucketFast_:function(t,e){const n=Je(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return Ve.runKernel("StringToHashBucketFast",i,r)}}),Xc={fft:ll,ifft:cl,rfft:dl,irfft:ul},Yc={hammingWindow:Ql,hannWindow:tc,frame:ec,stft:nc},Kc={flipLeftRight:ic,grayscaleToRGB:sc,resizeNearestNeighbor:kc,resizeBilinear:_c,rotateWithOffset:oc,cropAndResize:rc,nonMaxSuppression:lc,nonMaxSuppressionAsync:bc,nonMaxSuppressionWithScore:vc,nonMaxSuppressionWithScoreAsync:xc,nonMaxSuppressionPadded:wc,nonMaxSuppressionPaddedAsync:Sc,threshold:Tc,transform:Ec},Zc={bandPart:Mc,gramSchmidt:Cc,qr:Nc},Jc={absoluteDifference:Rc,computeWeightedLoss:$c,cosineDistance:Oc,hingeLoss:Pc,huberLoss:Lc,logLoss:Dc,meanSquaredError:Fc,sigmoidCrossEntropy:zc,softmaxCrossEntropy:Bc},Qc={sparseFillEmptyRows:Uc,sparseReshape:Vc,sparseSegmentMean:jc,sparseSegmentSum:Wc},tu={stringNGrams:Hc,stringSplit:Gc,stringToHashBucketFast:qc};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eu extends hi{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return wr(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return Mo(t,e)}dispose(){null!=this.iterations_&&wr(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:to(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(eu,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class nu extends eu{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Ve.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ve.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:xr((()=>Ds(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:xr((()=>Ds(r).variable(false)))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;xr((()=>{const t=vi(Si(s,this.rho),Si(no(i),1-this.rho)),e=Si(wi(eo(vi(o,this.epsilon)),eo(vi(s,this.epsilon))),i),n=vi(Si(o,this.rho),Si(no(e),1-this.rho));s.assign(t),o.assign(n);const a=vi(Si(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(wr(this.accumulatedGrads.map((t=>t.variable))),wr(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}nu.className="Adadelta",pi(nu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ru extends eu{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ve.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:xr((()=>ps(r.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable;xr((()=>{const t=vi(s,no(i));s.assign(t);const e=vi(Si(wi(i,eo(vi(t,Ve.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&wr(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}ru.className="Adagrad",pi(ru);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class iu extends eu{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],xr((()=>{this.accBeta1=to(e).variable(),this.accBeta2=to(n).variable()})),null==r&&(this.epsilon=Ve.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);xr((()=>{const n=$o(1,this.accBeta1),r=$o(1,this.accBeta2);e.forEach(((e,i)=>{const s=Ve.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:xr((()=>Ds(s).variable(false)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:xr((()=>Ds(s).variable(false)))});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,c=vi(Si(a,this.beta1),Si(o,1-this.beta1)),u=vi(Si(l,this.beta2),Si(no(o),1-this.beta2)),h=wi(c,n),d=wi(u,r);a.assign(c),l.assign(u);const p=vi(Si(wi(h,vi(eo(d),this.epsilon)),-this.learningRate),s);s.assign(p)})),this.accBeta1.assign(Si(this.accBeta1,this.beta1)),this.accBeta2.assign(Si(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&wr(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&wr(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),xr((()=>{this.accBeta1.assign(Qs(this.beta1,this.iterations_+1)),this.accBeta2.assign(Qs(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}iu.className="Adam",pi(iu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class su extends eu{constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],xr((()=>{this.iteration=to(0).variable(),this.accBeta1=to(e).variable()})),null==r&&(this.epsilon=Ve.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);xr((()=>{const n=$o(1,this.accBeta1),r=wi(-this.learningRate,vi(Si(this.iteration,this.decay),1));e.forEach(((e,i)=>{const s=Ve.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:Ds(s).variable(false)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:Ds(s).variable(false)});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,c=vi(Si(a,this.beta1),Si(o,1-this.beta1)),u=Si(l,this.beta2),h=_i(o),d=Wo(u,h);a.assign(c),l.assign(d);const p=vi(Si(wi(r,n),wi(c,vi(d,this.epsilon))),s);s.assign(p)})),this.iteration.assign(vi(this.iteration,1)),this.accBeta1.assign(Si(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&wr(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&wr(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}su.className="Adamax",pi(su);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ou extends eu{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=Ve.registeredVariables[e];xr((()=>{const t=vi(Si(this.c,r),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Sr(to(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}ou.className="SGD",pi(ou);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class au extends ou{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=to(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ve.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:xr((()=>Ds(r).variable(t)))}}const i=this.accumulations[n].variable,s=Array.isArray(t)?t[n].tensor:t[e];null!=s&&xr((()=>{let t;const e=vi(Si(this.m,i),s);t=this.useNesterov?vi(Si(this.c,vi(s,Si(e,this.m))),r):vi(Si(this.c,e),r),i.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&wr(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}au.className="Momentum",pi(au);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lu extends eu{constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Ve.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ve.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:xr((()=>Ds(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:xr((()=>Ds(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:xr((()=>Ds(r).variable(i)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;xr((()=>{const t=vi(Si(o,this.decay),Si(no(s),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=vi(Si(e,this.decay),Si(s,1-this.decay)),l=wi(Si(s,this.learningRate),eo($o(t,vi(no(i),this.epsilon)))),c=vi(Si(a,this.momentum),l);o.assign(t),e.assign(i),a.assign(c);const u=$o(r,c);r.assign(u)}else{const t=vi(Si(o,this.decay),Si(no(s),1-this.decay)),e=vi(Si(a,this.momentum),wi(Si(s,this.learningRate),eo(vi(t,this.epsilon))));o.assign(t),a.assign(e);const n=$o(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&wr(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&wr(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&wr(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}lu.className="RMSProp",pi(lu);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cu{static sgd(t){return new ou(t)}static momentum(t,e,n=!1){return new au(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new lu(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new iu(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new nu(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new su(t,e,n,r,i)}static adagrad(t,e=.1){return new ru(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uu={sgd:cu.sgd,momentum:cu.momentum,adadelta:cu.adadelta,adagrad:cu.adagrad,rmsprop:cu.rmsprop,adamax:cu.adamax,adam:cu.adam},hu="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function du(){return new Promise((t=>hu((()=>t()))))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pu(t,e){const n=t[0].length;t.forEach(((t,e)=>{c(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),c(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,i)=>{for(let s=0;s<n;s++)c(s===e||t[s]===r[s],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function fu(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mu;function gu(t,e,n){let r=new Array;if(null==n&&null==e)return r;if(null==e)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(null==n)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${s} but shape[${i+t}] = ${a}`)}else r[o]=s}return r}function yu(t){const e={FIRST_DIM_SIZE:mu.FIRST_DIM_SIZE,VALUE_ROWIDS:mu.VALUE_ROWIDS,ROW_LENGTHS:mu.ROW_LENGTHS,ROW_SPLITS:mu.ROW_SPLITS,ROW_LIMITS:mu.ROW_LIMITS,ROW_STARTS:mu.ROW_STARTS},n=[];for(const r of t){if(!(r in e))break;n.push(e[r])}return n}function bu(t){return 0===t.length?0:t[0]===mu.FIRST_DIM_SIZE?t.length-1:t.length}function vu(t,e){if(null==t||null==e)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const n=t[i],r=e[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${n} but ragged tensor input.flatValues.shape[${i-t.length}] = ${r}`)}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */!function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"}(mu||(mu={}));function xu(t){return t<=30?t:P(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wu(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Su(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function _u(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function ku(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?i.push(e[n-1]*t[n]):i.push(t[n]/e[n-1]):i.push(t[n]);return i}function Tu(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function Eu(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mu=1.0507009873554805;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cu(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function Au(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function Nu(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function Iu(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function $u(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Ru(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Ou(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function Pu(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lu=/->/g;function Du(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Lu,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=t.split("->");c(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const s=r.split(","),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<i.length;++t){const e=i[t];if(!s.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const l=new Array(s.length);for(let t=0;t<o;++t){if(new Set(s[t].split("")).size!==s[t].length)throw new Error(`Found duplicate axes in input component ${s[t]}. Support for duplicate axes in input is not implemented yet.`);l[t]=[];for(let e=0;e<s[t].length;++e)l[t].push(a.indexOf(s[t][e]))}const u=a.length,h=[];for(let t=i.length;t<u;++t)h.push(t);return{allDims:a,summedDims:h,idDims:l}}function Fu(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function zu(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const i=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=i[n]:c(r[e[t][n]]===i[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`))}}function Bu(t,e){const n=t,r=[];let i=0;0===t.length&&n.push(-1),i=t.length+1;for(let t=0;t<i;++t)r.push([]);const s=[];for(let t=0;t<n.length;++t){const i=Vu(e,n[t]);for(const e of i)-1===s.indexOf(e)&&(r[t].push(e),s.push(e))}return{path:n,steps:r}}function Uu(t){return t.every(((t,e)=>t===e))}function Vu(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function ju(t,e,n=0){let r=[];if("number"==typeof e)c(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0);c(i<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}c(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wu(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function Hu(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function Gu(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qu(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function Xu(t,e){return`size ${t} must be non-negative, not ${e}`}function Yu(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ku(t,e){return`Input to reshape is a SparseTensor with ${p(t)}\n  dense values, but the requested shape requires a multiple of ${p(e)}. inputShape=${t} outputShape= ${e}`}function Zu(t,e){return`Input to reshape is a tensor with ${p(t)} dense values, but the requested shape has ${p(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(){return"segment ids must be >= 0"}function Qu(){return"segment ids are not increasing"}function th(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function eh(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nh(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=P(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=P(t,n+1);return n}function rh(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)s!==e?r.push(t[s]):r.push(n);return r}function ih(t,e,n,r){const i=e.shape.length,s=t.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let e=0;e<r;++e)a.push(t.shape[e]),l*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<i;t++)a.push(e.shape[t]);for(let e=n+1;e<s;e++)a.push(t.shape[e]),u*=t.shape[e];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}var sh=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:nh,computeOutShape:rh,collectGatherOpShapeInfo:ih});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oh(t){try{return t.map((t=>le(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function ah(t){return t.map((t=>ae(t)))}var lh=Object.freeze({__proto__:null,slice_util:ui,segment_util:sh,fromUint8ToStringArray:oh,fromStringArrayToUint8:ah,upcastType:Ne,axesAreInnerMostDims:js,combineLocations:Ws,computeOutAndReduceShapes:Hs,expandShapeToKeepDim:Gs,assertAxesAreInnerMostDims:qs,getAxesPermutation:Xs,getUndoAxesPermutation:Ys,getInnerMostAxes:Ks,getBroadcastDims:$r,getReductionAxes:Rr,assertAndGetBroadcastShape:Or,assertParamsConsistent:pu,computeOutShape:fu,computeDilation2DInfo:Li,computePool2DInfo:Di,computePool3DInfo:Fi,computeConv2DInfo:zi,computeConv3DInfo:Bi,computeDefaultPad:Ui,tupleValuesAreOne:Gi,eitherStridesOrDilationsAreOne:qi,convertConv2DDataFormat:Xi,checkPadOnDimRoundingMode:Yi,getFusedDyActivation:jl,getFusedBiasGradient:Wl,applyActivation:Hl,shouldFuse:Gl,get RowPartitionType(){return mu},combineRaggedTensorToTensorShapes:gu,getRowPartitionTypesHelper:yu,getRaggedRank:bu,validateDefaultValueShape:vu,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:xu,getImageCenter:wu,getReshaped:Su,getPermuted:_u,getReshapedPermuted:ku,getSliceBeginCoords:Tu,getSliceSize:Eu,prepareAndValidate:jr,validateUpdateShape:Hr,validateInput:Gr,calculateShapes:qr,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:Mu,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:lt,log:function(...t){X().getBool("IS_TEST")||X().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:Cu,splitRealAndImagArrays:Au,complexWithEvenIndex:Nu,complexWithOddIndex:Iu,getComplexWithIndex:$u,assignToTypedArray:Ru,exponents:Ou,exponent:Pu,decodeEinsumEquation:Du,getEinsumPermutation:Fu,checkEinsumDimSizes:zu,getEinsumComputePath:Bu,isIdentityPermutation:Uu,prepareSplitSize:ju,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Wu,getSparseFillEmptyRowsNegativeIndexErrorMessage:Hu,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Gu,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:qu,getSparseReshapeNegativeOutputDimErrorMessage:Xu,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Yu,getSparseReshapeInputOutputMultipleErrorMessage:Ku,getSparseReshapeInputOutputMismatchErrorMessage:Zu,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Ju,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Qu,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:th,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:eh}),ch=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:hc,nonMaxSuppressionV4Impl:dc,nonMaxSuppressionV5Impl:pc,whereImpl:Il}),uh=Object.freeze({__proto__:null,AdadeltaOptimizer:nu,AdagradOptimizer:ru,AdamOptimizer:iu,AdamaxOptimizer:su,MomentumOptimizer:au,Optimizer:eu,OptimizerConstructors:cu,RMSPropOptimizer:lu,SGDOptimizer:ou,Tensor:we,TensorBuffer:be,Variable:_e,get Rank(){return ke},sumOutType:Ie,upcastType:Ne,get Reduction(){return Ic},customGrad:Co,grad:function(t){return c(O(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=Je(e,"x","tf.grad","string_or_numeric"),i=null!=n?Je(n,"dy","tf.grad"):null;return Ve.tidy((()=>{const{value:e,grads:n}=Ve.gradients((()=>t(r)),[r],i);return null!=i&&u(e.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ao(n),n[0]}))}},grads:function(t){return c(O(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{c(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=Qe(e,"args","tf.grads","string_or_numeric"),i=null!=n?Je(n,"dy","tf.grads"):null;return Ve.tidy((()=>{const{value:e,grads:n}=Ve.gradients((()=>t(...r)),r,i);return null!=i&&u(e.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ao(n),n}))}},valueAndGrad:function(t){return c(O(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{c(e instanceof we,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),c(null==n||n instanceof we,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:i}=Ve.gradients((()=>t(e)),[e],n);return Ao(r),{grad:r[0],value:i}}},valueAndGrads:function(t){return c(O(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{c(Array.isArray(e)&&e.every((t=>t instanceof we)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),c(null==n||n instanceof we,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=Ve.gradients((()=>t(...e)),e,n);return null!=n&&u(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ao(r.grads),r}},variableGrads:Mo,Environment:G,env:X,get ENV(){return K},nextFrame:du,KernelBackend:n,DataStorage:e,abs:_i,acos:ki,acosh:Ti,add:vi,addN:Ei,all:Mi,any:Ci,argMax:Ai,argMin:Ni,asin:Ii,asinh:$i,atan:Ri,atan2:Oi,atanh:Pi,avgPool:Zi,avgPool3d:Ji,basicLSTMCell:rs,batchToSpaceND:is,batchNorm:ss,batchNorm2d:os,batchNorm3d:as,batchNorm4d:ls,bincount:cs,broadcastArgs:us,broadcastTo:hs,buffer:Xn,cast:Yn,ceil:ds,clipByValue:fs,clone:Kn,complex:en,concat:Qi,concat1d:ms,concat2d:gs,concat3d:ys,concat4d:bs,conv1d:xs,conv2d:vs,conv2dTranspose:Ss,conv3d:_s,conv3dTranspose:Ts,cos:Es,cosh:Ms,cumprod:Cs,cumsum:As,denseBincount:Ns,depthToSpace:Is,depthwiseConv2d:$s,diag:Rs,dilation2d:Os,div:wi,divNoNan:Fs,dot:zs,einsum:Bs,elu:Us,equal:Ps,erf:Vs,euclideanNorm:oo,exp:ao,expandDims:lo,expm1:co,eye:ho,fill:ps,floor:po,floorDiv:xi,gather:fo,greater:mo,greaterEqual:go,imag:Er,isFinite:yo,isInf:bo,isNaN:vo,leakyRelu:xo,less:wo,lessEqual:So,linspace:_o,localResponseNormalization:ko,log:To,log1p:Eo,logSigmoid:Io,logSoftmax:Ro,logSumExp:Oo,logicalAnd:Po,logicalNot:Lo,logicalOr:Do,logicalXor:Fo,lowerBound:Bo,matMul:gr,max:Zs,maxPool:Uo,maxPool3d:Vo,maxPoolWithArgmax:jo,maximum:Wo,mean:Ho,meshgrid:Xo,min:Js,minimum:Yo,mirrorPad:Ko,mod:Zo,moments:Jo,mul:Si,multiRNNCell:Qo,multinomial:ta,neg:Mr,notEqual:ea,oneHot:yr,ones:qo,onesLike:na,outerProduct:ra,pad:ia,pad1d:sa,pad2d:oa,pad3d:aa,pad4d:la,pool:ua,pow:Qs,prelu:ha,print:Zn,prod:da,raggedGather:pa,raggedTensorToTensor:fa,rand:ma,randomGamma:La,randomNormal:Da,randomStandardNormal:Fa,randomUniform:za,range:Ba,real:Cr,reciprocal:Ua,relu:Va,relu6:ja,reshape:Ki,reverse:Wa,reverse1d:Ha,reverse2d:Ga,reverse3d:qa,reverse4d:Xa,round:Ya,rsqrt:Ka,scalar:to,selu:Za,separableConv2d:Ja,setdiff1dAsync:Qa,sigmoid:ts,sign:tl,sin:el,sinh:nl,slice:es,slice1d:rl,slice2d:il,slice3d:sl,slice4d:ol,softmax:al,softplus:No,spaceToBatchND:ca,fft:ll,ifft:cl,irfft:ul,rfft:dl,split:hl,sqrt:eo,square:no,squaredDifference:pl,squeeze:fl,stack:ml,step:gl,stridedSlice:yl,sub:$o,sum:ro,tan:bl,tanh:ns,tensor:rn,tensor1d:vl,tensor2d:xl,tensor3d:Lr,tensor4d:wl,tensor5d:Sl,tensor6d:_l,tile:uo,topk:kl,truncatedNormal:Tl,unique:El,unsortedSegmentSum:Ml,unstack:Cl,upperBound:Al,variable:Nl,where:Ls,whereAsync:$l,zeros:Go,zerosLike:Ds,op:tn,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:Rl,transpose:Ar,norm:so,movingAverage:Ol,scatterND:Pl,searchSorted:zo,sparseToDense:Ll,gatherND:Dl,dropout:Fl,enclosingPowerOfTwo:zl,cosineWindow:Bl,inTopKAsync:Ul,image:Kc,linalg:Zc,losses:Jc,spectral:Xc,fused:Jl,signal:Yc,sparse:Qc,string:tu,train:uu,enableProdMode:function(){X().set("PROD",!0)},enableDebugMode:function(){X().set("DEBUG",!0)},disableDeprecationWarnings:function(){X().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){X().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){Ve.disposeVariables()},engine:br,memory:vr,profile:function(t){return Ve.profile(t)},tidy:xr,dispose:wr,keep:Sr,time:function(t){return Ve.time(t)},setBackend:function(t){return Ve.setBackend(t)},ready:function(){return Ve.ready()},getBackend:_r,removeBackend:function(t){Ve.removeBackend(t)},findBackend:function(t){return Ve.findBackend(t)},findBackendFactory:function(t){return Ve.findBackendFactory(t)},registerBackend:kr,backend:Tr,setPlatform:function(t,e){X().setPlatform(t,e)},getKernel:ht,getGradient:dt,getKernelsForBackend:pt,registerKernel:ft,registerGradient:mt,unregisterKernel:function(t,e){const n=gt(t,e);if(!ct.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);ct.delete(n)},unregisterGradient:function(t){if(!ut.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);ut.delete(t)},copyRegisteredKernels:function(t,e){pt(t).forEach((t=>{ft(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:Q,Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:tt,Equal:"Equal",Exp:et,ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:nt,Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogicalXor:"LogicalXor",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:rt,Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:it,Prelu:"Prelu",Prod:"Prod",RaggedGather:"RaggedGather",RaggedTensorToTensor:"RaggedTensorToTensor",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:st,Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:ot,Tan:at,Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.21.0",browser:Vr,io:mr,math:Ir,serialization:fi,test_util:bi,util:ce,backend_util:lh,broadcast_util:Pr,tensor_util:De,slice_util:ui,gather_util:Wr,scatter_util:Xr,device_util:qe,kernel_impls:ch});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hh(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&c("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dh=Il;class ph extends n{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new e(this,br())}nextDataId(){return ph.nextDataId++}write(t,e,n){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&lt("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:n,refCount:1}),r}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&N(n[0])){const i=n.map((t=>ae(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){if(this.data.has(t)){return this.data.get(t).refCount}return 0}incRef(t){this.data.get(t).refCount++}decRef(t){if(this.data.has(t)){this.data.get(t).refCount--}}move(t,e,n,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){return Cu(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return this.data.get(t).values}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>le(t)));return Xn(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Xn(t.shape,t.dtype,e)}makeOutput(t,e,n){return br().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(t);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=oe();t();return{kernelMs:oe()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){hh([t],"where");const e=this.readSync(t.dataId);return dh(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fh(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}ph.nextDataId=0;const mh={kernelName:"Abs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend;hh(e,"abs");let r=new Float32Array(p(e.shape));return r=fh(n.data.get(e.dataId).values),n.makeOutput(r,e.shape,e.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gh(t){return(e,n,r,i,s)=>{const o=Or(e,n),a=o.length,l=L(o),c=S(s,p(o)),u=e.length,h=n.length,d=L(e),f=L(n),m=$r(e,o),g=$r(n,o);if(m.length+g.length===0)for(let e=0;e<c.length;++e)c[e]=t(r[e%r.length],i[e%i.length]);else for(let e=0;e<c.length;++e){const n=W(e,a,l),s=n.slice(-u);m.forEach((t=>s[t]=0));const o=j(s,u,d),p=n.slice(-h);g.forEach((t=>p[t]=0));const y=j(p,h,f);c[e]=t(r[o],i[y])}return[c,o]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yh(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64");return n.data.get(a.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const bh={kernelName:"Complex",backendName:"cpu",kernelFunc:yh};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vh(t,e,n="float32"){if("complex64"===n){return yh({inputs:{real:vh(t,e,"float32"),imag:vh(t,e,"float32")},backend:t})}const r=B(p(e),n);return t.makeTensorInfo(e,n,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xh(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const wh={kernelName:"Identity",backendName:"cpu",kernelFunc:xh};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const _h={kernelName:"Real",backendName:"cpu",kernelFunc:Sh};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kh(t,e,n,r){if("int32"===r){return[e,"int32",Int32Array.from(t)]}if("bool"===r){const r=se([0],n),[i,s]=gh(((t,e)=>t!==e?1:0))(e,[],t,r,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Th(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return xh({inputs:{x:i},backend:n});const t=vh(n,i.shape,i.dtype),e=Th({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=yh({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),r}if("complex64"===i.dtype){const t=Sh({inputs:{input:i},backend:n}),e=Th({inputs:{x:t},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(t),e}if(!E(i.dtype,s)){const t=xh({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,l,c]=kh(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,l,c)}const Eh={kernelName:"Cast",backendName:"cpu",kernelFunc:Th};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(t,e,n,r){return null==n?({inputs:n,backend:i})=>{const{a:s,b:o}=n,a=i;hh([s,o],t);const l=a.data.get(s.dataId).values,c=a.data.get(o.dataId).values,u="string"===s.dtype?oh(l):l,h="string"===s.dtype?oh(c):c,d=r||s.dtype,[p,f]=e(s.shape,o.shape,u,h,d);return a.makeTensorInfo(f,d,p)}:({inputs:t,backend:i})=>{const{a:s,b:o}=t,a=i;if("complex64"===s.dtype||"complex64"===o.dtype){const t=Th({inputs:{x:s},backend:a,attrs:{dtype:"complex64"}}),e=a.data.get(t.dataId),r=e.complexTensorInfos.real,i=e.complexTensorInfos.imag,l=a.data.get(r.dataId).values,c=a.data.get(i.dataId).values,u=Th({inputs:{x:o},backend:a,attrs:{dtype:"complex64"}}),h=a.data.get(u.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=a.data.get(d.dataId).values,m=a.data.get(p.dataId).values,[g,y,b]=n(s.shape,o.shape,l,c,f,m),v=a.makeTensorInfo(b,"float32",g),x=a.makeTensorInfo(b,"float32",y),w=yh({inputs:{real:v,imag:x},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(x),w}{const t=a.data.get(s.dataId).values,n=a.data.get(o.dataId).values,i=r||s.dtype,[l,c]=e(s.shape,o.shape,t,n,i);return a.makeTensorInfo(c,i,l)}}}function Ch(t){return(e,n,r,i,s,o)=>{const a=Or(e,n),l=p(a),c=a.length,u=L(a),h=S("float32",l),d=S("float32",l),f=$r(e,a),m=$r(n,a),g=Cu(r,i),y=Cu(s,o),b=e.length,v=L(e),x=n.length,w=L(n);if(f.length+m.length===0)for(let e=0;e<h.length;e++){const n=e%g.length,r=e%y.length,i=t(g[2*n],g[2*n+1],y[2*r],y[2*r+1]);h[e]=i.real,d[e]=i.imag}else for(let e=0;e<h.length;e++){const n=W(e,c,u),r=n.slice(-b);f.forEach((t=>r[t]=0));const i=j(r,b,v),s=n.slice(-x);m.forEach((t=>s[t]=0));const o=j(s,x,w),a=t(g[2*i],g[2*i+1],y[2*o],y[2*o+1]);h[e]=a.real,d[e]=a.imag}return[h,d,a]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ah=gh(((t,e)=>t+e)),Nh=Mh("Add",Ah,Ch(((t,e,n,r)=>({real:t+n,imag:e+r})))),Ih={kernelName:"Add",backendName:"cpu",kernelFunc:Nh};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $h(t,e,n,r,i){const s=p(r),o=B(i,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=i||(o[r]+=s>0?e[n]:1)}return o}function Rh(t,e,n,r=!1){const i=t.shape[0],s=t.shape[1],o=Xn([i,n],e.dtype);for(let a=0;a<i;a++)for(let i=0;i<s;i++){const s=t.get(a,i);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(r?o.set(1,a,s):e.size>0?o.set(o.get(a,s)+e.get(a,i),a,s):o.set(o.get(a,s)+1,a,s))}return o}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(t){return(e,n,r)=>{const i=S(n,e.length);for(let n=0;n<e.length;++n)i[n]=t(e[n],r);return i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ph(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(hh(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=p(o.shape),u=n||o.dtype,h=_(u,c);for(let t=0;t<c;++t)h[t]=e(l[t],i);return a.makeTensorInfo(o.shape,u,h)}}function Lh(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(hh(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=n||o.dtype,u=e(l,c,i);return a.makeTensorInfo(o.shape,c,u)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dh=Oh((t=>Math.ceil(t))),Fh={kernelName:"Ceil",backendName:"cpu",kernelFunc:Lh("Ceil",Dh)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zh(t,e,n,r){const i=_(n,p(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=p(t.shape);i.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const s="string"===n?oh(t.vals):t.vals;let o=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+r;for(let e=0;e<t.shape[1];++e)i[a+e]=s[o++]}r+=t.shape[1]}))}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bh=gh(((t,e)=>t===e?1:0)),Uh=Mh("Equal",Bh,null,"bool"),Vh={kernelName:"Equal",backendName:"cpu",kernelFunc:Uh},jh=Oh((t=>Math.exp(t))),Wh=Lh(et,jh,"float32"),Hh={kernelName:et,backendName:"cpu",kernelFunc:Wh},Gh=Oh((t=>Math.expm1(t))),qh={kernelName:"Expm1",backendName:"cpu",kernelFunc:Lh("Expm1",Gh)},Xh=Oh((t=>Math.floor(t))),Yh={kernelName:"Floor",backendName:"cpu",kernelFunc:Lh("Floor",Xh)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Kh(t,e,n,r,i,s,o,a,l){const c=Xn([r,s],n);for(let n=0;n<r;n++){const r=[];let u=0;for(let e=0;e<i;e++){const s=t[n*i+e];u+=s*o[e],r.push(s)}if(u<0||u>=l/s)throw new Error(`Invalid indices: ${r} does not index into ${a}`);for(let t=0;t<s;t++)c.values[n*s+t]=e.get(...e.indexToLoc(u*s+t))}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zh(t,e,n){const r=Xn(n,t.dtype);for(let n=0;n<r.size;++n){const i=r.indexToLoc(n).slice(),s=i[0],o=i[2],a=e.locToIndex([s,o]);i[2]=e.values[a];const l=t.locToIndex(i);0<=l&&l<t.values.length&&(r.values[n]=t.values[l])}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jh=gh(((t,e)=>t>e?1:0)),Qh={kernelName:"Greater",backendName:"cpu",kernelFunc:Mh("Greater",Jh,null,"bool")},td=gh(((t,e)=>t>=e?1:0)),ed={kernelName:"GreaterEqual",backendName:"cpu",kernelFunc:Mh("GreaterEqual",td,null,"bool")},nd=gh(((t,e)=>t<e?1:0)),rd={kernelName:"Less",backendName:"cpu",kernelFunc:Mh("Less",nd,null,"bool")},id=gh(((t,e)=>t<=e?1:0)),sd={kernelName:"LessEqual",backendName:"cpu",kernelFunc:Mh("LessEqual",id,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function od(t,e,n){const r=(e-t)/(n-1),i=B(n,"float32");i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+r;return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ad=Oh((t=>Math.log(t))),ld=Lh(nt,ad),cd={kernelName:nt,backendName:"cpu",kernelFunc:ld};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ud(t,e,n,r){const i=S(r,p(n));for(let n=0;n<i.length;++n){const r=n*e;let s=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>s)&&(s=e)}i[n]=s}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hd=gh(((t,e)=>Math.max(t,e))),dd={kernelName:"Maximum",backendName:"cpu",kernelFunc:Mh("Maximum",hd)},pd=gh(((t,e)=>Math.min(t,e))),fd={kernelName:"Minimum",backendName:"cpu",kernelFunc:Mh("Minimum",pd)},md=gh(((t,e)=>t*e)),gd=Ch(((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n}))),yd=Mh("Multiply",md,gd),bd={kernelName:"Multiply",backendName:"cpu",kernelFunc:yd};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vd(t,e,n){const r=ie(-1,n);return md([],e,r,t,n)}const xd={kernelName:"Neg",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;hh(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=vd(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}},wd=gh(((t,e)=>t!==e?1:0)),Sd={kernelName:"NotEqual",backendName:"cpu",kernelFunc:Mh("NotEqual",wd,null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _d(t,e,n,r,i){const s=e.length,o=p(e),a=L(e),l=L(i),c=S(n,p(i));for(let e=0;e<o;++e){const n=W(e,s,a),i=new Array(n.length);for(let t=0;t<i.length;t++)i[t]=n[r[t]];c[j(i,s,l)]=t[e]}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kd(t){const{inputs:e,attrs:n,backend:r}=t,{x:i}=e,{perm:s}=n;hh(i,"transpose");const o=i.shape.length,a=new Array(o);for(let t=0;t<a.length;t++)a[t]=i.shape[s[t]];const l=_d(r.data.get(i.dataId).values,i.shape,i.dtype,s,a);return{dataId:r.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const Td={kernelName:"Transpose",backendName:"cpu",kernelFunc:kd};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ed(t,e,n,r){const[i,s]=Hs(t,r),o=Ne(e,"int32"),a=B(p(i),o),l=p(s);for(let t=0;t<a.length;++t){const e=t*l;let r=1;for(let t=0;t<l;++t)r*=n[e+t];a[t]=r}return{outVals:a,outShape:i,outDtype:o}}const Md={kernelName:"Prod",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;hh(i,"prod");const a=i.shape.length,l=x(s,i.shape),c=Xs(l,a);let u=l,h=i;const d=[];null!=c&&(h=kd({inputs:{x:i},backend:n,attrs:{perm:c}}),d.push(h),u=Ks(u.length,a));const p=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:g}=Ed(h.shape,h.dtype,p,u);let y=m;return o&&(y=Gs(m,l)),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,g,f)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cd(t,e,n,r){const i=[];let s=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map((()=>[0]));!function(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let t=1;t<r.length;++t)if(r[t-1]>r[t])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let t=0;t<e.length-1;++t){l*=e[t];const n=e[t+1];for(let e=1;e<l+1;++e)a[t].push(e*n)}for(let r=0;r<t.length;++r){let o=t[r],l=t[r]+1;for(let t=0;t<n.length;++t){const r=n[t],i=t+e.length-1;if(i>=0){const t=a[i],e=t[t.length-1]-r[o];for(let t=o;t<l;++t)a[i].push(r[t+1]+e)}o=r[o],l=r[l]}l!==o&&(i.push([o,l]),s+=l-o)}return{outSplits:a,valueSlices:i,numValues:s}}function Ad(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function Nd(t,e,n,r,i){const s=e.slice();s[0]=i;const o=_(n,p(s)),a=t.length;return function(t,e,n,r,i,s){const o=Ad(e,2)[1],a=Ad(s,2)[1];let l=0;for(const e of n)for(let n=e[0];n<e[1];++n){for(let e=0;e<r;++e)i[l*a+e]=t[n*o+e];++l}}(t,e,r,0===a?0:a/e[0],o,s),[o,s]}function Id(t,e,n,r,i,s,o,a){if(0===t.length)throw new Error("paramsNestedSplits must be non empty");if(0===e[0].length)throw new Error("Split tensors must not be scalars");if(function(t,e,n){t.forEach(((t,r)=>{if(t<0||t>=n){const i=W(r,e.length,L(e)).join(",");throw new Error(`indices[${i}] = ${t} is not in [0, ${n})`)}}))}(s,o,e[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:u,numValues:h}=Cd(s,o,t,l),d=function(t){const e=[];for(let n=0;n<t.length;++n){const r=_("int32",t[n].length);e.push(r),t[n].forEach(((t,e)=>r[e]=t))}return e}(c),p=Nd(n,r,i,u,h);return[d,p[0],p[1]]}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $d=mu;class Rd{constructor(t,e,n,r,i,s,o,a,l,c){this.shape=t,this.shapeShape=e,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=o,this.rowPartitionValues=a,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=yu(c),this.raggedRank=bu(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===$d.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===$d.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case $d.VALUE_ROWIDS:return Rd.getMaxWidthValueRowID(e);case $d.ROW_SPLITS:return Rd.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${$d[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(0===e||1===e)return 0;let n=0;for(let r=0;r<e-1;++r){const e=t[r+1]-t[r];e>n&&(n=e)}return n}static getMaxWidthValueRowID(t){const e=t.length;if(0===e)return 0;let n=0,r=t[0],i=0;for(let s=1;s<e;++s){const e=t[s];e!==r&&(r=e,i=Math.max(s-n,i),n=s)}return Math.max(e-n,i)}tensorShapeFromTensor(t,e,n=!0){if(0===e.length){if(-1===t[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Pd(t,n)}calculateOutputSize(t){const e=this.valuesShape;vu(this.defaultValueShape,e);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=gu(this.raggedRank,n,e);r[0]<0&&(r[0]=t);for(let t=1;t<=this.raggedRank;++t)r[t]<0&&(r[t]=this.getMaxWidth(t));return r}calculateFirstParentOutputIndex(t,e,n){const r=Math.min(t,n),i=[];let s=0;for(let t=0;t<r;++t,s+=e)i.push(s);for(let e=r;e<t;++e)i.push(-1);return c(i.length===t,(()=>"Final length of result must be equal to firstDimension.")),i}calculateOutputIndexRowSplit(t,e,n,r){const i=t.length,s=[];for(let o=0;o<i-1;++o){const i=t[o+1]-t[o];let a=Math.min(r,i),l=e[o];-1===l&&(a=0);for(let t=0;t<a;++t)s.push(l),l+=n;for(let t=0;t<i-a;++t)s.push(-1)}if(i>0&&s.length!==t[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(t,e,n,r){const i=t.length,s=[];if(0===i)return[];let o=0,a=t[0];if(a>=e.length)throw new Error(`Got currentValueRowId=${a}, which is not less than ${e.length}`);let l=e[a];s.push(l);for(let c=1;c<i;++c){const i=t[c];if(i===a)l>=0&&(++o,o<r?l+=n:l=-1);else{if(o=0,a=i,i>=e.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${e.length}`);l=e[i]}s.push(l)}if(s.length!==t.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(t,e,n,r){const i=this.getRowPartitionTensor(t),s=this.getRowPartitionTypeByDimension(t);switch(s){case $d.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,n,r);case $d.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,n,r);default:throw new Error(`Unsupported partition type: ${$d[s]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case $d.FIRST_DIM_SIZE:return t[0];case $d.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case $d.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${$d[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),e=this.calculateOutputSize(t),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let t=n.length-2;t>=0;--t)n[t]=n[t+1]*e[t+1];const r=Pd(e,!1),i=_(this.valuesDType,p(r));if(n[0]*e[0]>0){let s=this.calculateFirstParentOutputIndex(t,n[0],e[0]);for(let t=1;t<=this.raggedRank;++t){s=this.calculateOutputIndex(t-1,s,n[t],e[t])}this.setOutput(this.raggedRank,s,i,r)}return[r,i]}setOutput(t,e,n,r){if(0===n.length)return;const i=this.values,s=n;let o=r.slice();o=o.slice(t+1);const a=p(o),l=e.length;let c=this.defaultValue;if(c.length!==a&&1!==c.length){const t=this.defaultValueShape;xr((()=>{const e=Ki(c,t),n=hs(e,o);c=n.dataSync()}))}let u=0,h=0,d=0;for(let t=0;t<=l;++t){let r=t<l?e[t]:-1;if(r!==d){if(h<d){const t=i.subarray(u*a);Od(s.subarray(h*a),t,(d-h)*a)}if(t>=l){const t=n.length;r=Math.floor(t/a)}if(r>d)if(1===this.defaultValue.length)s.subarray(d*a,r*a).fill(this.defaultValue[0]),d=r;else for(;r>d;){Od(s.slice(d*a),c,a),++d}r<0?(u=t+1,h=d):(u=t,h=d,d=h+1)}else++d}}}function Od(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function Pd(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function Ld(t,e,n,r,i,s,o,a,l,c){return new Rd(t,e,n,r,i,s,o,a,l,c).compute()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dd(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return B(0,r);const i=B(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+n;return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fd=Oh((t=>1/Math.sqrt(t))),zd={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:Lh("Rsqrt",Fd)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bd(t,e,n,r,i,s,o,a,l,c){const u=[r/i,i],h=t.values,d=e.values;if(0===r)return Xn(n,e.dtype);const p=Xn(u,e.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let t=0;t<s;t++){const s=[];let l=0;for(let e=0;e<o;e++){const n=h[t*o+e];s.push(n),l+=n*a[e]}if(l<0||l>=r/i)throw new Error(`Invalid indices: ${s} does not index into ${n}`);for(let n=0;n<i;n++)c?p.values[l*i+n]+=d[t*i+n]:p.values[l*i+n]=0===e.rank?d[0]:d[t*i+n]}return p}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ud=Oh((t=>1/(1+Math.exp(-t)))),Vd=Ph("Sigmoid",(t=>1/(1+Math.exp(-t)))),jd={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:Vd};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wd(t,e,n,r,i){const s=si(r,e,n),o=p(n),a=L(r);if(s){const n=oi(e,a);return"string"===i?t.slice(n,n+o):t.subarray(n,n+o)}const l=Xn(r,i,"string"===i?oh(t):t),c=Xn(n,i);for(let t=0;t<c.size;++t){const n=c.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));c.set(l.get(...r),...n)}return"string"===i?ah(c.values):c.values}function Hd(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r;hh(i,"slice");const[a,l]=ai(i,s,o);Yr(i,a,l);const c=Wd(n.data.get(i.dataId).values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,c)}const Gd={kernelName:"Slice",backendName:"cpu",kernelFunc:Hd};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qd(t,e,n,r,i,s,o){const a=e[0],l=s[0],c=new Array(l),u=new Array(a),h=e[1];if(0===l){if(0!==a)throw new Error(Wu(a));return[_(n,0),[0,h],_(i,0),c,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let e=0;e<a;++e){const n=t[e*h];if(n<0)throw new Error(Hu(e,n));if(n>=l)throw new Error(Gu(e,n,l));++f[n],d=d&&n>=p,p=n}let m=!0;for(let t=0;t<l;++t){const e=0===f[t];c[t]=e,m=m&&!e,f[t]=Math.max(f[t],1),t>0&&(f[t]+=f[t-1])}if(m&&d){const e=t,n=r;for(let t=0;t<a;++t)u[t]=t;return[e,[a,h],n,c,u]}{const e=f[l-1],s=_(n,e*h),d=_(i,e),p=new Array(l).fill(0);for(let e=0;e<a;++e){const n=t[e*h],i=p[n],o=(0===n?0:f[n-1])+i;p[n]++;for(let n=0;n<h;++n)s[o*h+n]=t[e*h+n];d[o]=r[e],u[e]=o}for(let t=0;t<l;++t){if(0===p[t]){const e=0===t?0:f[t-1];s[e*h+0]=t;for(let t=1;t<h;++t)s[e*h+t]=0;d[e]=o}}return[s,[e,h],d,c,u]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xd(t,e,n,r,i){const s=p(r),o=e[0],a=i.length,l=[];let c=1,u=-1;for(let t=0;t<a;++t){const e=i[t];if(-1===e){if(-1!==u)throw new Error(qu(u,t));u=t,l.push(1)}else{if(e<0)throw new Error(Xu(t,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(s/c);if(c*t!==s)throw new Error(Ku(r,l));l[u]=t}if(p(l)!==s)throw new Error(Zu(r,l));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let t=h-2;t>=0;--t)d[t]=d[t+1]*r[t+1]}const f=[];if(a>0){f[a-1]=1;for(let t=a-2;t>=0;--t)f[t]=f[t+1]*l[t+1]}const m=_(n,o*a);for(let e=0;e<o;++e){let n=0;for(let r=0;r<h;++r)n+=t[e*h+r]*d[r];for(let t=0;t<a;++t)m[e*a+t]=Math.trunc(n/f[t]),n%=f[t]}return[m,[o,a],l]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yd(t,e,n,r,i,s=!1,o=0){const a=r.length,l=[e[0],t.length/e[0]],c=l[1],u=a>0?i[a-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=e.slice();h[0]=u;const d=_(n,h.reduce(((t,e)=>t*e),1));if(0===a)return u>0&&d.fill(o),[d,h];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,m=0,g=i[p];for(;;){let e=0;if(f<a){if(e=i[f],g===e){++f;continue}if(g>=e)throw new Error("segment ids are not increasing")}if(g<0||g>=u)throw new Error(th(g,u));g>m&&d.fill(o,m*c,g*c);for(let e=p;e<f;++e){const n=r[e];if(n<0||n>=l[0])throw new Error(eh(e,r[e],l[0]));for(let e=0;e<c;e++)d[g*c+e]+=t[n*c+e]}if(s)for(let t=0;t<c;t++)d[g*c+t]/=f-p;if(p=f,++f,m=g+1,g=e,f>a)break}return m<u&&d.fill(o,m*c,u*c),[d,h]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kd=Oh((t=>Math.sqrt(t))),Zd={kernelName:"Sqrt",backendName:"cpu",kernelFunc:Ph("Sqrt",(t=>Math.sqrt(t)))},Jd=gh(((t,e)=>{const n=t-e;return n*n})),Qd={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:Mh("SquaredDifference",Jd)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tp(t,e,n,r){const i=Xn(t,e.dtype);for(let t=0;t<i.size;t++){const s=i.indexToLoc(t),o=new Array(s.length);for(let t=0;t<o.length;t++)o[t]=s[t]*n[t]+r[t];i.set(e.get(...o),...s)}return i}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ep{constructor(t,e,n,r,i,s){this.separator=ae(t),this.nGramWidths=e,this.leftPad=ae(n),this.rightPad=ae(r),this.padWidth=i,this.preserveShort=s}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,i,s){for(let o=0;o<i;++o){const a=this.getPadWidth(s),l=Math.max(0,a-o),c=Math.max(0,a-(i-(o+1))),u=s-(l+c),h=e+(l>0?0:o-a);let d=0;d+=l*this.leftPad.length;for(let e=0;e<u;++e)d+=t[h+e].length;d+=c*this.rightPad.length;d+=(l+c+u-1)*this.separator.length,n[r+o]=new Uint8Array(d);const p=n[r+o];let f=0;const m=t=>t.forEach((t=>p[f++]=t));for(let t=0;t<l;++t)m(this.leftPad),m(this.separator);for(let e=0;e<u-1;++e)m(t[h+e]),m(this.separator);if(u>0){m(t[h+u-1]);for(let t=0;t<c;++t)m(this.separator),m(this.rightPad)}else{for(let t=0;t<c-1;++t)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let i=1;i<r;++i){let r=e[i]>=t;if(r=r&&e[i]<=n,!r)throw new Error(`Invalid split value ${e[i]}, must be in [${t}, ${n}]`);t=e[i]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const i=r-1,s=_("int32",r);if(0===n||0===r){const t=new Array(n);for(let t=0;t<=i;++t)s[t]=0;return[t,s]}s[0]=0;for(let t=1;t<=i;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),s[t]=s[t-1]+r}const o=new Array(s[i]);for(let n=0;n<i;++n){const r=e[n];let i=s[n];if(this.nGramWidths.forEach((s=>{const a=e[n+1]-e[n],l=this.getNumNGrams(a,s);this.createNGrams(t,r,o,i,l,s),i+=l})),this.preserveShort&&i===s[n]){const s=e[n+1]-e[n];if(0===s)continue;const a=s+2*this.padWidth,l=1;this.createNGrams(t,r,o,i,l,a)}}return[o,s]}}function np(t,e,n,r,i,s,o,a){return new ep(n,r,i,s,o,a).compute(t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rp(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const i=e[0];let s=t.indexOf(i);for(;-1!==s;){const e=t.subarray(0,s);n&&0===e.length||r.push(e),s=(t=t.subarray(s+1)).indexOf(i)}return void(n&&0===t.length||r.push(t))}let i=0;for(let s=0;s<t.length+1;s++)if(s===t.length||-1!==e.indexOf(t[s])){const e=t.subarray(i,s);n&&0===e.length||r.push(e),i=s+1}}function ip(t,e,n){const r=t.length,i=[];let s=0,o=0;const a=new Array(r);for(let l=0;l<r;++l){const r=i.length;rp(t[l],e,n,i);const c=i.length-r;a[l]=c,s+=c,o=Math.max(o,c)}const l=_("int32",2*s),c=new Array(s),u=[r,o];let h=0;for(let t=0;t<r;++t)for(let e=0;e<a[t];++e)l[2*h]=t,l[2*h+1]=e,c[h]=i[h],++h;return[l,c,u]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sp(t,e){const n=_("int32",t.length);for(let r=0;r<t.length;++r)n[r]=re(t[r]).modulo(e).getLowBitsUnsigned();return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const op=gh(((t,e)=>t-e)),ap=Ch(((t,e,n,r)=>({real:t-n,imag:e-r}))),lp=Mh(ot,op,ap),cp={kernelName:ot,backendName:"cpu",kernelFunc:lp};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function up(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const r=Xn(n,t.dtype);for(let e=0;e<r.values.length;++e){const n=r.indexToLoc(e),i=new Array(t.rank);for(let e=0;e<i.length;e++)i[e]=n[e]%t.shape[e];const s=t.locToIndex(i);r.values[e]=t.values[s]}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hp=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function dp(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const i=r-n+1,s=e-n+1,o=Math.log(i),a=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*a*(i-a)/i)*Math.sign(s-i/2);dp(t,e,Math.max(n,Math.floor(e-s*a/i+l)),Math.min(r,Math.floor(e+(i-s)*a/i+l)))}const i=t[e];let s=n,o=r;for(a(t,n,e),hp(t[r],i)>0&&a(t,n,r);s<o;){for(a(t,s,o),s++,o--;hp(t[s],i)<0;)s+=1;for(;hp(t[o],i)>0;)o-=1}0===hp(t[n],i)?a(t,n,o):(o+=1,a(t,o,r)),o<=e&&(n=o+1),e<=o&&(r=o-1)}}function pp(t,e,n,r,i){const s=e[e.length-1],[o,a]=[t.length/s,s],l=S(n,o*r),c=S("int32",o*r);for(let e=0;e<o;e++){const n=e*a,s=t.subarray(n,n+a);let o=new Array(s.length);s.forEach(((t,e)=>o[e]={value:t,index:e})),r<o.length&&(dp(o,r),o=o.slice(0,r)),i&&o.sort(hp);const u=e*r,h=l.subarray(u,u+r),d=c.subarray(u,u+r);for(let t=0;t<r;t++)h[t]=o[t].value,d[t]=o[t].index}const u=e.slice();return u[u.length-1]=r,[Xn(u,n,l),Xn(u,"int32",c)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fp(t,e,n,r){const i=x(e,n)[0],s=[1,n[0],1];for(let t=0;t<i;t++)s[0]*=n[t];s[1]=n[i];for(let t=i+1;t<n.length;t++)s[2]*=n[t];const o={},a=new Int32Array(n[i]),l=new be(s,r,t),c=[],u=1===s[0]&&1===s[2];for(let e=0;e<n[i];e++){let n;if(u)n=t[e].toString();else{const t=[];for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)t.push(l.get(n,e,r));n=t.join(",")}if(void 0!==o[n])a[e]=o[n];else{const t=Object.keys(o).length;o[n]=t,a[e]=t,c.push(e)}}const h=s.slice();h[1]=Object.keys(o).length;const d=new be(h,r);c.forEach(((t,e)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)d.set(l.get(n,t,r),n,e,r)}));const p=n.slice();return p[i]=h[1],{outputValues:d.values,outputShape:p,indices:a}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mp=Object.freeze({__proto__:null,simpleAbsImpl:fh,addImpl:Ah,bincountImpl:$h,bincountReduceImpl:Rh,castImpl:kh,ceilImpl:Dh,concatImpl:zh,equalImpl:Bh,expImpl:jh,expm1Impl:Gh,floorImpl:Xh,gatherNdImpl:Kh,gatherV2Impl:Zh,greaterImpl:Jh,greaterEqualImpl:td,lessImpl:nd,lessEqualImpl:id,linSpaceImpl:od,logImpl:ad,maxImpl:ud,maximumImpl:hd,minimumImpl:pd,multiplyImpl:md,negImpl:vd,notEqualImpl:wd,prodImpl:Ed,raggedGatherImpl:Id,raggedTensorToTensorImpl:Ld,rangeImpl:Dd,rsqrtImpl:Fd,scatterImpl:Bd,sigmoidImpl:Ud,sliceImpl:Wd,sparseFillEmptyRowsImpl:qd,sparseReshapeImpl:Xd,sparseSegmentReductionImpl:Yd,sqrtImpl:Kd,squaredDifferenceImpl:Jd,stridedSliceImpl:tp,stringNGramsImpl:np,stringSplitImpl:ip,stringToHashBucketFastImpl:sp,subImpl:op,tileImpl:up,topKImpl:pp,transposeImpl:_d,uniqueImpl:fp});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */kr("cpu",(()=>new ph),1);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const gp=Ph("Elu",(t=>t>=0?t:Math.exp(t)-1)),yp={kernelName:"Elu",backendName:"cpu",kernelFunc:gp};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function bp(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r;hh([i],"leakyRelu");const o=p(i.shape),a=n.data.get(i.dataId).values,l=S("float32",o);for(let t=0;t<a.length;t++)l[t]=a[t]<0?s*a[t]:a[t];return n.makeTensorInfo(i.shape,"float32",l)}const vp={kernelName:"LeakyRelu",backendName:"cpu",kernelFunc:bp},xp=gh(((t,e)=>t<0?e*t:t));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e;hh([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,l]=xp(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Sp={kernelName:"Prelu",backendName:"cpu",kernelFunc:wp},_p=Ph("Relu",(t=>Math.max(0,t))),kp={kernelName:"Relu",backendName:"cpu",kernelFunc:_p},Tp=Ph("Relu6",(t=>Math.min(Math.max(0,t),6))),Ep={kernelName:"Relu6",backendName:"cpu",kernelFunc:Tp};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mp(t,e,n,r,i){if("linear"===n)return xh({inputs:{x:e},backend:t});if("relu"===n)return _p({inputs:{x:e},backend:t});if("elu"===n)return gp({inputs:{x:e},backend:t});if("relu6"===n)return Tp({inputs:{x:e},backend:t});if("prelu"===n)return wp({inputs:{x:e,alpha:r},backend:t});if("leakyrelu"===n)return bp({inputs:{x:e},backend:t,attrs:{alpha:i}});if("sigmoid"===n)return Vd({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cp(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=p(i.shape),a=v(s,o),l=p(a);c(o===l,(()=>`The new shape (${a}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const u=n.data.get(i.dataId);if(null!=u.complexTensorInfos){const t=u.complexTensorInfos.real,e=u.complexTensorInfos.imag;t.shape=a,e.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const Ap={kernelName:"Reshape",backendName:"cpu",kernelFunc:Cp};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Np(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;hh([i,s],"matMul");const l=i.shape.length,u=s.shape.length,h=o?i.shape[l-2]:i.shape[l-1],d=a?s.shape[u-1]:s.shape[u-2],f=o?i.shape[l-1]:i.shape[l-2],m=a?s.shape[u-2]:s.shape[u-1],g=i.shape.slice(0,-2),y=s.shape.slice(0,-2),b=p(g),v=p(y),x=Or(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([f,m]);c(h===d,(()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`));const w=a?[v,m,d]:[v,d,m],S=Cp({inputs:{x:i},backend:n,attrs:{shape:o?[b,h,f]:[b,f,h]}}),_=Cp({inputs:{x:s},backend:n,attrs:{shape:w}}),k=o?S.shape[1]:S.shape[2],T=o?S.shape[2]:S.shape[1],E=a?_.shape[1]:_.shape[2],M=Math.max(b,v),C=n.data.get(S.dataId).values,A=n.data.get(_.dataId).values,N=L(S.shape),I=L(_.shape),[$,R,O]=o?[N[0],1,N[1]]:[N[0],N[1],1],[P,D,F]=a?[1,I[1],I[0]]:[I[1],1,I[0]],z=T*E,B=Xn([M,T,E],S.dtype),U=B.values,V=n.blockSize;for(let t=0;t<M;t++)for(let e=0;e<T;e+=V)for(let n=0;n<E;n+=V)for(let r=0;r<k;r+=V){const i=Math.min(e+V,T),s=Math.min(n+V,E),o=Math.min(r+V,k);for(let a=e;a<i;a++)for(let e=n;e<s;e++){let n=0;for(let i=r;i<o;i++){const r=Math.min(t,b-1)*$,s=Math.min(t,v-1)*F;n+=C[r+a*R+i*O]*A[i*P+e*D+s]}U[t*z+(a*E+e)]+=n}}return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(_),n.makeTensorInfo(x,B.dtype,B.values)}const Ip={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:Np};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $p={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;let d,p,f;const m=[];d=Np({inputs:{a:i,b:s},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(p=Nh({inputs:{a:d,b:o},backend:n}),m.push(d),d=p),u&&(f=Mp(n,d,u,a,h),m.push(d),d=f);for(const t of m)n.disposeIntermediateTensorInfo(t);return d}},Rp={kernelName:"Acos",backendName:"cpu",kernelFunc:Ph("Acos",(t=>Math.acos(t)))},Op={kernelName:"Acosh",backendName:"cpu",kernelFunc:Ph("Acosh",(t=>Math.acosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pp={kernelName:"AddN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,r=e;hh(e,"addN");const i=r.map((t=>n.data.get(t.dataId).values)),s=Xn(r[0].shape,r[0].dtype),o=s.values;for(let t=0;t<r.length;t++){const e=i[t];for(let t=0;t<o.length;t++)o[t]+=e[t]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lp={kernelName:"All",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;hh(i,"all");const a=x(s,i.shape);let l=a;const c=Xs(l,i.shape.length);let u=i;null!=c&&(u=kd({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Ks(l.length,i.shape.length)),qs("all",l,u.shape.length);const[h,d]=Hs(u.shape,l),f=p(d),m=B(p(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*f;let n=g[e];for(let t=0;t<f;++t){const r=g[e+t];n=n&&r}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=Cp({inputs:{x:y},backend:n,attrs:{shape:Gs(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dp={kernelName:"Any",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;hh(i,"any");const a=x(s,i.shape);let l=a;const c=Xs(l,i.shape.length);let u=i;null!=c&&(u=kd({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Ks(l.length,i.shape.length)),qs("any",l,u.shape.length);const[h,d]=Hs(u.shape,l),f=p(d),m=B(p(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*f;let n=g[e];for(let t=0;t<f;++t){const r=g[e+t];n=n||r}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=Cp({inputs:{x:y},backend:n,attrs:{shape:Gs(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fp={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;hh(i,"argMax");let o=x(s,i.shape);const a=Xs(o,i.shape.length);let l=i;const c=[];null!=a&&(l=kd({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Ks(o.length,l.shape.length)),o=[o[0]],qs("argMax",o,l.shape.length);const[u,h]=Hs(l.shape,o),d=B(p(u),"int32"),f=p(h),m=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*f;let n=m[e],r=0;for(let t=0;t<f;++t){const i=m[e+t];i>n&&(n=i,r=t)}d[t]=r}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zp={kernelName:"ArgMin",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;hh(i,"argMin");let o=x(s,i.shape);const a=Xs(o,i.shape.length);let l=i;const c=[];null!=a&&(l=kd({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Ks(o.length,l.shape.length)),o=[o[0]],qs("argMin",o,l.shape.length);const[u,h]=Hs(l.shape,o),d=B(p(u),"int32"),f=p(h),m=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*f;let n=m[e],r=0;for(let t=0;t<f;++t){const i=m[e+t];i<n&&(n=i,r=t)}d[t]=r}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}},Bp={kernelName:"Asin",backendName:"cpu",kernelFunc:Ph("Asin",(t=>Math.asin(t)))},Up={kernelName:"Asinh",backendName:"cpu",kernelFunc:Ph("Asinh",(t=>Math.asinh(t)))},Vp={kernelName:"Atan",backendName:"cpu",kernelFunc:Ph("Atan",(t=>Math.atan(t)))},jp={kernelName:"Atan2",backendName:"cpu",kernelFunc:Mh("Atan2",gh(((t,e)=>Math.atan2(t,e))))},Wp={kernelName:"Atanh",backendName:"cpu",kernelFunc:Ph("Atanh",(t=>Math.atanh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hp(t,e,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,u=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,p=i.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Xn(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let e=0;e<i.batchSize;++e){const n=e*y,m=e*r[0];for(let e=0;e<i.inChannels;++e)for(let y=0;y<i.outHeight;++y){const x=y*o-d,w=Math.max(0,x),S=Math.min(i.inHeight,u+x),_=n+y*b;for(let n=0;n<i.outWidth;++n){const o=n*a-p,u=Math.max(0,o),d=Math.min(i.inWidth,h+o);let y=f,b=0,x=0;for(let n=w;n<S;n+=l){const i=m+n*r[1];for(let n=u;n<d;n+=c){const o=t[i+n*r[2]+e];"max"===s&&o>y?y=o:"avg"===s&&(b+=o,x++)}if(isNaN(y))break}g[_+n*v+e]="avg"===s?b/x:y}}}return m}function Gp(t,e,n,r,i=!1,s=!1){const o=Xn(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=Xn(e,n,t);for(let t=0;t<r.batchSize;++t)for(let e=0;e<r.inChannels;++e)for(let n=0;n<r.outHeight;++n){const g=n*a-p;let y=g;for(;y<0;)y+=c;const b=Math.min(r.inHeight,h+g);for(let a=0;a<r.outWidth;++a){const h=a*l-f;let p=h;for(;p<0;)p+=u;const v=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,w=-1;for(let n=y;n<b;n+=c){const o=n-g;for(let a=p;a<v;a+=u){const l=a-h,c=m.get(t,n,a,e);c>x&&(x=c,w=i?s?((t*r.inHeight+n)*r.inWidth+a)*r.inChannels+e:(n*r.inWidth+a)*r.inChannels+e:o*d+l)}}o.set(w,t,n,a,e)}}return o}function qp(t,e,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,u=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,y=i.padInfo.left,b="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Xn(i.outShape,n),x=v.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],S=i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[3]*i.outShape[4],k=i.outShape[4];for(let e=0;e<i.batchSize;++e){const n=e*w,v=e*r[0];for(let e=0;e<i.inChannels;++e)for(let w=0;w<i.outDepth;++w){const T=w*o-m;let E=T;for(;E<0;)E+=c;const M=Math.min(i.inDepth,d+T),C=n+w*S;for(let n=0;n<i.outHeight;++n){const o=n*a-g;let d=o;for(;d<0;)d+=u;const m=Math.min(i.inHeight,p+o),w=C+n*_;for(let n=0;n<i.outWidth;++n){const o=n*l-y;let a=o;for(;a<0;)a+=h;const p=Math.min(i.inWidth,f+o),g=w+n*k;let S=b,_=0,T=0;for(let n=E;n<M;n+=c){const i=v+n*r[1];for(let n=d;n<m;n+=u){const o=i+n*r[2];for(let n=a;n<p;n+=h){const i=t[o+n*r[3]+e];if("max"===s&&i>S?S=i:"avg"===s&&(_+=i,T++),isNaN(S))break}if(isNaN(S))break}if(isNaN(S))break}x[g+e]="avg"===s?_/T:S}}}}return v}const Xp={kernelName:"AvgPool",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;hh(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;c(qi(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const u=Di(i.shape,s,o,1,a,l);let h;if(1===u.filterWidth&&1===u.filterHeight&&f(u.inShape,u.outShape))h=xh({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=L(i.shape),r=Hp(t,i.shape,i.dtype,e,u,"avg");h=n.makeTensorInfo(u.outShape,i.dtype,r.values)}return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yp={kernelName:"AvgPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;hh(i,"avgPool3d");const u=Fi(i.shape,s,o,1,a,l,c),h=qp(n.data.get(i.dataId).values,i.shape,i.dtype,L(i.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kp={kernelName:"AvgPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;hh([i,s],"avgPool3DGrad");const u=Fi(s.shape,o,a,1,l,c),h=u.strideDepth,d=u.strideHeight,p=u.strideWidth,f=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,b=u.dilationHeight,v=u.dilationWidth,x=u.effectiveFilterDepth,w=u.effectiveFilterHeight,S=u.effectiveFilterWidth,_=x-1-u.padInfo.front,k=S-1-u.padInfo.left,T=w-1-u.padInfo.top,E=Xn(s.shape,"float32"),M=1/(f*m*g),C=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-_,o=r-T,a=i-k;let l=0;for(let n=0;n<x;n+=y){const r=(s+n)/h;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let n=0;n<w;n+=b){const i=(o+n)/d;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let n=0;n<S;n+=v){const s=(a+n)/p;if(s<0||s>=u.outWidth||Math.floor(s)!==s)continue;l+=C.get(t,r,i,s,e)}}}E.set(l*M,t,n,r,i,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zp={kernelName:"AvgPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;hh([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Di(o.shape,a,l,1,c),h=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,b=u.effectiveFilterWidth,v=b-1-u.padInfo.left,x=y-1-u.padInfo.top,w=Xn(o.shape,"float32"),S=1/(p*f),_=n.data.get(i.dataId).values,k=Xn(i.shape,"float32",_);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const i=n-x,s=r-v;let o=0;for(let n=0;n<y;n+=m){const r=(i+n)/h;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let n=0;n<b;n+=g){const i=(s+n)/d;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;o+=k.get(t,r,i,e)}}w.set(o*S,t,n,r,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jp={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,scale:s,offset:o,mean:a,variance:l}=e;c(a.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),c(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),c(null==s||a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),hh([i,a,l,s,o],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);const h=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,p=n.data.get(l.dataId).values,f=s?n.data.get(s.dataId).values:new Float32Array([1]),m=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(h.length),y=m.length,b=f.length,v=p.length,x=d.length;let w=0,S=0,_=0,k=0;for(let t=0;t<h.length;++t)g[t]=m[w++]+(h[t]-d[S++])*f[_++]/Math.sqrt(p[k++]+u),w>=y&&(w=0),S>=x&&(S=0),_>=b&&(_=0),k>=v&&(k=0);return n.makeTensorInfo(i.shape,i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qp={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;hh([i],"batchToSpaceND");const a=s.reduce(((t,e)=>t*e)),l=Su(i.shape,s,a),c=_u(l.length,s.length),u=ku(i.shape,s,a),h=Tu(o,s.length),d=Eu(u,o,s.length),p=Cp({inputs:{x:i},backend:n,attrs:{shape:l}}),f=kd({inputs:{x:p},backend:n,attrs:{perm:c}}),m=Cp({inputs:{x:f},backend:n,attrs:{shape:u}}),g=Hd({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tf={kernelName:"Bincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=$h(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,a)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ef={kernelName:"BroadcastArgs",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=Or(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},nf={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:Ph("ClipByValue",((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}))},rf={kernelName:"ComplexAbs",backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(p(e.shape)),i=n.data.get(e.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values;for(let t=0;t<a.length;t++){const e=a[t],n=l[t];r[t]=Math.hypot(e,n)}return n.makeOutput(r,e.shape,"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sf(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const of={kernelName:"Imag",backendName:"cpu",kernelFunc:sf};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function af(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=x(i,e[0].shape)[0];pu(e.map((t=>t.shape)),s);let o=fu(e.map((t=>t.shape)),s);if(0===p(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>p(t.shape)>0));if(1===a.length)return xh({inputs:{x:a[0]},backend:n});if("complex64"===a[0].dtype){const t=a.map((t=>Sh({inputs:{input:t},backend:n}))),e=a.map((t=>sf({inputs:{input:t},backend:n}))),r=af({inputs:t,backend:n,attrs:{axis:s}}),i=af({inputs:e,backend:n,attrs:{axis:s}}),o=yh({inputs:{real:r,imag:i},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),o}const l=a.map((t=>{const e=p(t.shape.slice(s));return Cp({inputs:{x:t},backend:n,attrs:{shape:[-1,e]}})})),c=l.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));o=fu(l.map((t=>t.shape)),1);const u=1===l[0].shape[0],h=zh(c,o,e[0].dtype,u),d=fu(a.map((t=>t.shape)),s),f=n.makeTensorInfo(d,e[0].dtype,h);return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}const lf={kernelName:"Concat",backendName:"cpu",kernelFunc:af};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cf(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;hh([i,s],"conv2d");const h=Xi(l),d=zi(i.shape,s.shape,o,c,a,u,!1,h),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,x=new be(d.outShape,i.dtype),w=L(i.shape),S=L(s.shape),_=w[0],k=v?w[1]:w[2],T=v?w[2]:1,E=v?1:w[1],M=x.strides[0],C=v?x.strides[1]:x.strides[2],A=v?x.strides[2]:1,N=v?1:x.strides[1],I=n.data.get(i.dataId).values,$=n.data.get(s.dataId).values,R=x.values;for(let t=0;t<d.batchSize;++t){const e=t*_,n=t*M;for(let t=0;t<d.outHeight;++t){const r=n+t*C,i=t*d.strideHeight-b;for(let t=0;t<p;++t){const n=i+t*m;if(n<0||n>=d.inHeight)continue;const s=t*S[0],o=e+n*k;for(let t=0;t<d.outWidth;++t){const e=r+t*A,n=t*d.strideWidth-y;for(let t=0;t<f;++t){const r=n+t*g;if(r<0||r>=d.inWidth)continue;const i=o+r*T;let a=s+t*S[1];for(let t=0;t<d.inChannels;++t){const n=I[i+t*E];for(let t=0;t<d.outChannels;++t)R[e+t*N]+=n*$[a+t];a+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,R)}const uf={kernelName:"Conv2D",backendName:"cpu",kernelFunc:cf};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hf={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;hh([i,s],"conv2dBackpropFilter");const h=Xi(l),d=zi(i.shape,u,o,1,a,c,!1,h),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=d,y="channelsLast"===d.dataFormat,b=new be(d.filterShape,"float32"),v=d.padInfo.left,x=d.padInfo.top,w=n.data.get(i.dataId).values,S=n.data.get(s.dataId).values,_=new be(i.shape,i.dtype,w),k=new be(s.shape,s.dtype,S);for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((x-t)/p)),n=Math.min(d.outHeight,(d.inHeight+x-t)/p);for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((v-r)/f)),s=Math.min(d.outWidth,(d.inWidth+v-r)/f);for(let o=0;o<d.inChannels;++o)for(let a=0;a<d.outChannels;++a){let l=0;for(let c=0;c<d.batchSize;++c)for(let u=e;u<n;++u){const e=t+u*p-x;for(let t=i;t<s;++t){const n=r+t*f-v;l+=y?_.get(c,e,n,o)*k.get(c,u,t,a):_.get(c,o,e,n)*k.get(c,a,u,t)}}b.set(l,t,r,o,a)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const df={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;hh([i,s],"conv2dBackpropInput");const h=L(s.shape),d=L(i.shape);let p=Xi(c);const f=zi(o,s.shape,a,1,l,u,!1,p),m=new be(f.inShape,"float32"),g=m.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,x,w]=h,{batchSize:S,filterHeight:_,filterWidth:k,inChannels:T,inHeight:E,inWidth:M,outChannels:C,outHeight:A,outWidth:N,strideHeight:I,strideWidth:$}=f;p=f.dataFormat;const R=_-1-f.padInfo.top,O=k-1-f.padInfo.left,P="channelsLast"===p,D=m.strides[0],F=P?m.strides[1]:m.strides[2],z=P?m.strides[2]:1,B=P?1:m.strides[1],U=d[0],V=P?d[1]:d[2],j=P?d[2]:1,W=P?1:d[1];for(let t=0;t<S;++t)for(let e=0;e<T;++e)for(let n=0;n<E;++n){const r=n-R,i=Math.max(0,Math.ceil(r/I)),s=Math.min(A,(_+r)/I);for(let o=0;o<M;++o){const a=o-O,l=Math.max(0,Math.ceil(a/$)),c=Math.min(N,(k+a)/$);let u=0;for(let n=i;n<s;++n){const i=n*I-r;for(let r=l;r<c;++r){const s=U*t+V*n+j*r,o=v*(_-1-i)+x*(k-1-(r*$-a))+w*e;for(let t=0;t<C;++t){u+=y[s+W*t]*b[o+t]}}}g[D*t+F*n+z*o+B*e]=u}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pf={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r;hh([i,s],"conv3d");const c=Bi(i.shape,s.shape,o,l,a),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=c,y=g.front,b=g.left,v=g.top,x=new be(c.outShape,i.dtype),w=n.data.get(i.dataId).values,S=n.data.get(s.dataId).values,_=x.values,k=L(i.shape),T=L(s.shape);for(let t=0;t<c.batchSize;++t){const e=t*k[0],n=t*x.strides[0];for(let t=0;t<c.outDepth;++t){const r=n+t*x.strides[1],i=t*c.strideDepth-y;for(let t=0;t<u;++t){const n=i+t*p;if(n<0||n>=c.inDepth)continue;const s=t*T[0],o=e+n*k[1];for(let t=0;t<c.outHeight;++t){const e=r+t*x.strides[2],n=t*c.strideHeight-v;for(let t=0;t<h;++t){const r=n+t*f;if(r<0||r>=c.inHeight)continue;const i=s+t*T[1],a=o+r*k[2];for(let t=0;t<c.outWidth;++t){const n=e+t*c.outChannels,r=t*c.strideWidth-b;for(let t=0;t<d;++t){const e=r+t*m;if(e<0||e>=c.inWidth)continue;const s=i+t*T[2],o=a+e*c.inChannels;let l=s;for(let t=0;t<c.inChannels;++t){const e=w[o+t];for(let t=0;t<c.outChannels;++t)_[n+t]+=e*S[l+t];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ff={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r;hh([i,s],"conv3dBackpropFilterV2");const c=L(i.shape),u=L(s.shape),h=Bi(i.shape,l,o,1,a),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new be(h.filterShape,"float32"),v=b.values,[x,w,S,_]=b.strides,k=n.data.get(s.dataId).values,[T,E,M,C]=u,A=n.data.get(i.dataId).values,[N,I,$,R]=c,O=h.padInfo.front,P=h.padInfo.left,D=h.padInfo.top;for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((O-t)/d)),n=Math.min(h.outDepth,(h.inDepth+O-t)/d),r=t*x;for(let i=0;i<g;++i){const s=Math.max(0,Math.ceil((D-i)/p)),o=Math.min(h.outHeight,(h.inHeight+D-i)/p),a=i*w+r;for(let r=0;r<y;++r){const l=Math.max(0,Math.ceil((P-r)/f)),c=Math.min(h.outWidth,(h.inWidth+P-r)/f),u=r*S+a;for(let a=0;a<h.inChannels;++a){const m=a*_+u;for(let u=0;u<h.outChannels;++u){let g=0;for(let m=0;m<h.batchSize;++m){const h=m*N,y=m*T;for(let m=e;m<n;++m){const e=(t+m*d-O)*I+h,n=m*E+y;for(let t=s;t<o;++t){const s=(i+t*p-D)*$+e,o=t*M+n;for(let t=l;t<c;++t){const e=t*C+o;g+=A[(r+t*f-P)*R+s+a]*k[e+u]}}}}v[m+u]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mf={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r;hh([i],"conv3dBackpropInputV2");const c=L(i.shape),u=L(s.shape),h=Bi(l,s.shape,a,1,o),d=new be(h.inShape,"float32"),p=d.values,[f,m,g,y]=d.strides,b=n.data.get(i.dataId).values,[v,x,w,S]=c,_=n.data.get(s.dataId).values,[k,T,E,M]=u,{batchSize:C,filterDepth:A,filterHeight:N,filterWidth:I,inChannels:$,inDepth:R,inHeight:O,inWidth:P,outChannels:D,outDepth:F,outHeight:z,outWidth:B,strideDepth:U,strideHeight:V,strideWidth:j}=h,W=A-1-h.padInfo.front,H=N-1-h.padInfo.top,G=I-1-h.padInfo.left;for(let t=0;t<C;++t)for(let e=0;e<$;++e)for(let n=0;n<R;++n){const r=n-W,i=Math.max(0,Math.ceil(r/U)),s=Math.min(F,(A+r)/U);for(let o=0;o<O;++o){const a=o-H,l=Math.max(0,Math.ceil(a/V)),c=Math.min(z,(N+a)/V);for(let u=0;u<P;++u){const h=u-G,d=Math.max(0,Math.ceil(h/j)),C=Math.min(B,(I+h)/j);let $=0;for(let n=i;n<s;++n){const i=n*U-r;for(let r=l;r<c;++r){const s=r*V-a;for(let o=d;o<C;++o){const a=v*t+x*n+w*r+S*o,l=k*(A-1-i)+T*(N-1-s)+E*(I-1-(o*j-h))+M*e;for(let t=0;t<D;++t){$+=b[a+t]*_[l+t]}}}}p[f*t+m*n+g*o+y*u+e]=$}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},gf=Ph(Q,(t=>Math.cos(t))),yf={kernelName:Q,backendName:"cpu",kernelFunc:gf},bf={kernelName:"Cosh",backendName:"cpu",kernelFunc:Ph("Cosh",(t=>Math.cosh(t)))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vf={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[u,h,d,p]=i.shape,f=s.shape[0],[m,g]=a,y=Xn([f,m,g,p],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,w=L(i.shape),S=L(y.shape);for(let t=0;t<f;t++){const e=4*t,n=b[e],r=b[e+1],i=b[e+2],s=b[e+3],o=v[t];if(o>=u)continue;const a=m>1?(i-n)*(h-1)/(m-1):0,f=g>1?(s-r)*(d-1)/(g-1):0;for(let e=0;e<m;e++){const u=m>1?n*(h-1)+e*a:.5*(n+i)*(h-1);if(u<0||u>h-1)for(let n=0;n<g;n++)for(let r=0;r<p;r++){const i=r+n*S[2]+e*S[1]+t*S[0];y.values[i]=c}else if("bilinear"===l){const n=Math.floor(u),i=Math.ceil(u),a=u-n;for(let l=0;l<g;l++){const u=g>1?r*(d-1)+l*f:.5*(r+s)*(d-1);if(u<0||u>d-1){for(let n=0;n<p;n++){const r=n+l*S[2]+e*S[1]+t*S[0];y.values[r]=c}continue}const h=Math.floor(u),m=Math.ceil(u),b=u-h;for(let r=0;r<p;r++){let s=r+h*w[2]+n*w[1]+o*w[0];const c=x[s];s=r+m*w[2]+n*w[1]+o*w[0];const u=x[s];s=r+h*w[2]+i*w[1]+o*w[0];const d=x[s];s=r+m*w[2]+i*w[1]+o*w[0];const p=c+(u-c)*b,f=d+(x[s]-d)*b;s=r+l*S[2]+e*S[1]+t*S[0],y.values[s]=p+(f-p)*a}}}else for(let n=0;n<g;++n){const i=g>1?r*(d-1)+n*f:.5*(r+s)*(d-1);if(i<0||i>d-1){for(let r=0;r<p;r++){const i=r+n*S[2]+e*S[1]+t*S[0];y.values[i]=c}continue}const a=Math.round(i),l=Math.round(u);for(let r=0;r<p;r++){const i=r+a*w[2]+l*w[1]+o*w[0],s=r+n*S[2]+e*S[1]+t*S[0];y.values[s]=x[i]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xf={kernelName:"Cumprod",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;hh(i,"cumprod");const l=Xs([s],i.shape.length);let c=i;null!=l&&(c=kd({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=Ks(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=Ne(c.dtype,"int32"),d=z(p(c.shape),h),f=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],g=a?(t,e)=>t+m-e-1:(t,e)=>t+e;for(let t=0;t<f.length;t+=m)for(let e=0;e<m;e++){const n=g(t,e);if(0===e)d[n]=o?1:f[n];else{const r=g(t,e-1);d[n]=o?f[r]*d[r]:f[n]*d[r]}}const y=n.makeTensorInfo(c.shape,h,d);if(null!=l){const t=kd({inputs:{x:y},backend:n,attrs:{perm:Ys(l)}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(c),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wf={kernelName:"Cumsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;hh(i,"cumsum");const l=Xs([s],i.shape.length);let c=i;null!=l&&(c=kd({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=Ks(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=Ne(c.dtype,"int32"),d=B(p(c.shape),h),f=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],g=a?(t,e)=>t+m-e-1:(t,e)=>t+e;for(let t=0;t<f.length;t+=m)for(let e=0;e<m;e++){const n=g(t,e);if(0===e)d[n]=o?0:f[n];else{const r=g(t,e-1);d[n]=o?f[r]+d[r]:f[n]+d[r]}}const y=n.makeTensorInfo(c.shape,h,d);if(null!=l){const t=kd({inputs:{x:y},backend:n,attrs:{perm:Ys(l)}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(c),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sf={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=$h(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,t)}if(2===i.shape.length){const t=Rh(n.bufferSync(i),n.bufferSync(s),o,a);return n.makeTensorInfo(t.shape,s.dtype,t.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _f={kernelName:"DepthToSpace",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r;c("NHWC"===o,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`));const a=i.shape[0],l=i.shape[1],u=i.shape[2],h=i.shape[3],d=l*s,p=u*s,f=h/(s*s),m=n.data.get(i.dataId).values,g=new Float32Array(a*d*p*f);let y=0;for(let t=0;t<a;++t)for(let e=0;e<d;++e){const n=Math.floor(e/s),r=e%s;for(let e=0;e<p;++e){const i=Math.floor(e/s),o=(r*s+e%s)*f;for(let e=0;e<f;++e){const r=e+o+h*(i+u*(n+l*t));g[y++]=m[r]}}}return n.makeTensorInfo([a,d,p,f],i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kf(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;hh([i,s],"depthwiseConv2DNative");const h=L(i.shape),d=L(s.shape);let p=l;null==p&&(p=[1,1]),c(qi(o,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`));const f=zi(i.shape,s.shape,o,p,a,u,!0),{filterHeight:m,filterWidth:g,dilationHeight:y,dilationWidth:b,padInfo:v}=f,x=v.left,w=v.top,S=f.outChannels/f.inChannels,_=new be(f.outShape,i.dtype),k=n.data.get(i.dataId).values,T=n.data.get(s.dataId).values,E=_.values;for(let t=0;t<f.batchSize;++t){const e=t*h[0],n=t*_.strides[0];for(let t=0;t<f.outHeight;++t){const r=n+t*_.strides[1],i=t*f.strideHeight-w;for(let t=0;t<m;++t){const n=i+t*y;if(n<0||n>=f.inHeight)continue;const s=t*d[0],o=e+n*h[1];for(let t=0;t<f.outWidth;++t){const e=r+t*_.strides[2],n=t*f.strideWidth-x;for(let t=0;t<g;++t){const r=n+t*b;if(r<0||r>=f.inWidth)continue;const i=s+t*d[1],a=o+r*f.inChannels;let l=e,c=i;for(let t=0;t<f.inChannels;++t){const e=k[a+t];for(let t=0;t<S;++t)E[l+t]+=e*T[c+t];l+=S,c+=S}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Tf={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:kf};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ef={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;hh([i,s],"depthwiseConv2dNativeBackpropFilter");const h=zi(i.shape,u,o,a,l,c,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=h,g=new be(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,x=n.data.get(i.dataId).values,w=new be(i.shape,i.dtype,x),S=n.data.get(s.dataId).values,_=new be(s.shape,s.dtype,S);for(let t=0;t<f;++t){const e=Math.max(0,Math.ceil((b-t)/d)),n=Math.min(h.outHeight,(h.inHeight+b-t)/d);for(let r=0;r<m;++r){const i=Math.max(0,Math.ceil((y-r)/p)),s=Math.min(h.outWidth,(h.inWidth+y-r)/p);for(let o=0;o<h.outChannels;++o){const a=Math.trunc(o/v),l=o%v;let c=0;for(let l=0;l<h.batchSize;++l)for(let u=e;u<n;++u){const e=t+u*d-b;for(let t=i;t<s;++t){const n=r+t*p-y;c+=w.get(l,e,n,a)*_.get(l,u,t,o)}}g.set(c,t,r,a,l)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mf={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;hh([i,s],"depthwiseConv2DNativeBackpropInput");const h=L(i.shape),d=L(s.shape),p=zi(u,s.shape,o,a,l,c,!0),f=new be(p.inShape,"float32"),m=f.values,[g,y,b]=f.strides,v=n.data.get(i.dataId).values,[x,w,S]=h,_=n.data.get(s.dataId).values,[k,T,E]=d,{batchSize:M,filterHeight:C,filterWidth:A,inChannels:N,inHeight:I,inWidth:$,outChannels:R,outHeight:O,outWidth:P,strideHeight:D,strideWidth:F}=p,z=C-1-p.padInfo.top,B=A-1-p.padInfo.left,U=R/N;for(let t=0;t<M;++t)for(let e=0;e<N;++e)for(let n=0;n<I;++n){const r=n-z,i=Math.max(0,Math.ceil(r/D)),s=Math.min(O,(C+r)/D);for(let o=0;o<$;++o){const a=o-B,l=Math.max(0,Math.ceil(a/F)),c=Math.min(P,(A+a)/F);let u=0;for(let n=i;n<s;++n){const i=n*D-r;for(let r=l;r<c;++r){const s=x*t+w*n+S*r,o=k*(C-1-i)+T*(A-1-(r*F-a))+E*e;for(let t=0;t<U;++t){u+=v[s+(e*U+t)]*_[o+t]}}}m[g*t+y*n+b*o+e]=u}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cf={kernelName:"Diag",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=p(r.shape),s=n.data.get(r.dataId).values,o=Xn([i,i],r.dtype),a=o.values;for(let t=0;t<s.length;t++)a[t*i+t]=s[t];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,o.dtype,o.values)}},Af={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i}=t,{strides:s,pad:o,dilations:a}=n,l=e,c=l.data.get(r.dataId).values,u=r.shape.length,h=l.data.get(i.dataId).values,d=i.shape.length,{batchSize:f,inHeight:m,inWidth:g,inChannels:y,outHeight:b,outWidth:v,padInfo:x,strideHeight:w,strideWidth:S,filterHeight:k,filterWidth:T,dilationHeight:E,dilationWidth:M,outShape:C}=Li(r.shape,i.shape,s,o,"NHWC",a),A=p(C),N=C.length,I=_(r.dtype,A);for(let t=0;t<f;++t)for(let e=0;e<b;++e){const n=e*w-x.top;for(let s=0;s<v;++s){const o=s*S-x.left;for(let a=0;a<y;++a){let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<k;++e){const s=n+e*E;if(s>=0&&s<m)for(let n=0;n<T;++n){const p=o+n*M;if(p>=0&&p<g){const o=j([t,s,p,a],u,L(r.shape)),f=j([e,n,a],d,L(i.shape)),m=c[o]+h[f];m>l&&(l=m)}}}I[j([t,e,s,a],N,L(C))]=l}}}return{dataId:l.write(se(I,r.dtype),C,r.dtype),shape:C,dtype:r.dtype}}},Nf={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,u=e,h=F(r.shape,u.data.get(r.dataId).values),d=F(i.shape,u.data.get(i.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:S,filterWidth:_,dilationHeight:k,dilationWidth:T,outShape:E}=Li(r.shape,i.shape,o,a,"NHWC",l);c(s.rank===E.length,(()=>`Error in Dilation2DBackpropFilter, dy must have the same rank as output ${E.length}, but got ${s.rank}`));const M=F(E,u.data.get(s.dataId).values),C=U(i.shape,i.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*x-v.top;for(let r=0;r<b;++r){const i=r*w-v.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=0,l=0;for(let e=0;e<S;++e){const r=n+e*k;if(r>=0&&r<f)for(let n=0;n<_;++n){const c=i+n*T;if(c>=0&&c<m){const i=h[t][r][c][s]+d[e][n][s];i>o&&(o=i,a=e,l=n)}}}C[a][l][s]+=M[t][e][r][s]}}}return{dataId:u.write(se(C,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},If={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,u=e,h=F(r.shape,u.data.get(r.dataId).values),d=F(i.shape,u.data.get(i.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:S,filterWidth:_,dilationHeight:k,dilationWidth:T,outShape:E}=Li(r.shape,i.shape,o,a,"NHWC",l);c(s.rank===E.length,(()=>`Error in Dilation2DBackpropInput, dy must have the same rank as output ${E.length}, but got ${s.rank}`));const M=F(E,u.data.get(s.dataId).values),C=U(r.shape,r.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*x-v.top;for(let r=0;r<b;++r){const i=r*w-v.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=n<0?0:n,l=i<0?0:i;for(let e=0;e<S;++e){const r=n+e*k;if(r>=0&&r<f)for(let n=0;n<_;++n){const c=i+n*T;if(c>=0&&c<m){const i=h[t][r][c][s]+d[e][n][s];i>o&&(o=i,a=r,l=c)}}}C[t][a][l][s]+=M[t][e][r][s]}}}return{dataId:u.write(se(C,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $f(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;let a;hh(i,"sum"),a="bool"===i.dtype?Th({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):xh({inputs:{x:i},backend:n});const l=a.shape.length,c=x(s,a.shape),u=Xs(c,l);let h=c,d=a;null!=u&&(d=kd({inputs:{x:a},backend:n,attrs:{perm:u}}),h=Ks(h.length,l)),qs("sum",h,d.shape.length);const[f,m]=Hs(d.shape,h);let g=vh(n,f,Ne(d.dtype,"int32"));const y=p(m),b=n.data.get(g.dataId).values,v=n.data.get(d.dataId).values;for(let t=0;t<b.length;++t){const e=t*y;let n=0;for(let t=0;t<y;++t)n+=v[e+t];b[t]=n}if(o){const t=g;g=Cp({inputs:{x:g},backend:n,attrs:{shape:Gs(g.shape,c)}}),n.disposeIntermediateTensorInfo(t)}return n.disposeIntermediateTensorInfo(a),null!=u&&n.disposeIntermediateTensorInfo(d),g}const Rf={kernelName:"Sum",backendName:"cpu",kernelFunc:$f};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Of={kernelName:"Einsum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=Du(i,s.length);zu(o.length,l,s);const{path:c,steps:u}=Bu(a,l),h=u.length;let d=null,p=o.length;const m=[];for(let t=0;t<h;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=Fu(p,l[e]);let i;Uu(t)?i=s[e]:(i=kd({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),m.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);f(i.shape,o)||(i=Cp({inputs:{x:i},backend:n,attrs:{shape:o}}),m.push(i)),null===d?d=i:(d=yd({inputs:{a:i,b:d},backend:n}),m.push(d))}t<h-1&&(c[t]>=0&&(d=$f({inputs:{x:d},backend:n,attrs:{axis:c[t]-(o.length-p),keepDims:!1}}),m.push(d)),p--)}for(const t of m)t!==d&&n.disposeIntermediateTensorInfo(t);return d}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pf={kernelName:"EluGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{dy:r,y:i}=e;hh([r,i],"eluGrad");const s=new Float32Array(p(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let t=0;t<o.length;++t){const e=o[t];s[t]=e>=1?a[t]:a[t]*(e+1)}return n.makeTensorInfo(i.shape,"float32",s)}},Lf=Ph(tt,(t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+.3275911*n);return e*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),Df={kernelName:tt,backendName:"cpu",kernelFunc:Lf};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ff(t){const{inputs:e,backend:n,attrs:r}=t,{input:i}=e,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(c(-(o+1)<=s,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),l=o+s+1),a.splice(l,0,1),Cp({inputs:{x:i},backend:n,attrs:{shape:a}})}const zf={kernelName:"ExpandDims",backendName:"cpu",kernelFunc:Ff},Bf=Mh("RealDiv",gh(((t,e)=>t/e))),Uf={kernelName:"RealDiv",backendName:"cpu",kernelFunc:Bf};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vf(t,e,n){const r=t.shape,i=r[0],s=r[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[i,s],u=p(c),h=S("float32",u),d=S("float32",u);for(let t=0;t<i;t++){const r=Hd({inputs:{x:a},backend:n,attrs:{begin:[t,0],size:[1,s]}}),i=Hd({inputs:{x:l},backend:n,attrs:{begin:[t,0],size:[1,s]}}),o=yh({inputs:{real:r,imag:i},backend:n}),{real:c,imag:u}=jf(o,e,n),p=Cu(c,u);for(let e=0;e<s;e++){const n=$u(p,e);h[t*s+e]=n.real,d[t*s+e]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o)}const f=n.makeTensorInfo(c,"float32",h),m=n.makeTensorInfo(c,"float32",d),g=yh({inputs:{real:f,imag:m},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}function jf(t,e,n){const r=p(t.shape),i=n.data.get(t.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((a=r)&a-1)){const i=Wf(s,o,r,e,n),a=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(a,"float32",i.real),e=n.makeTensorInfo(a,"float32",i.imag),s=n.makeTensorInfo([],"float32",ie(r,"float32")),o=xh({inputs:{x:s},backend:n}),l=Uf.kernelFunc({inputs:{a:t,b:s},backend:n}),c=Uf.kernelFunc({inputs:{a:e,b:o},backend:n}),u=n.data.get(l.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:h}}return i}{const t=function(t,e,n){const r=new Float32Array(2*e);for(let i=0;i<e;i++){let s=0,o=0;for(let r=0;r<e;r++){const a=Pu(i*r,e,n),l=$u(t,r);s+=l.real*a.real-l.imag*a.imag,o+=l.real*a.imag+l.imag*a.real}n&&(s/=e,o/=e),Ru(r,s,o,i)}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(Cu(s,o),r,e);return Au(t)}var a}function Wf(t,e,n,r,i){if(1===n)return{real:t,imag:e};const s=Cu(t,e),o=n/2,a=Nu(s),l=a.real,c=a.imag,u=[l.length],h=i.makeTensorInfo(u,"float32",l),d=i.makeTensorInfo(u,"float32",c),p=yh({inputs:{real:h,imag:d},backend:i}),f=Iu(s),m=f.real,g=f.imag,y=[m.length],b=i.makeTensorInfo(y,"float32",m),v=i.makeTensorInfo(y,"float32",g),x=yh({inputs:{real:b,imag:v},backend:i}),w=Wf(l,c,o,r,i),S=w.real,_=w.imag,k=[S.length],T=i.makeTensorInfo(k,"float32",S),E=i.makeTensorInfo(k,"float32",_),M=yh({inputs:{real:T,imag:E},backend:i}),C=Wf(m,g,o,r,i),A=C.real,N=C.imag,I=[A.length],$=i.makeTensorInfo(I,"float32",A),R=i.makeTensorInfo(I,"float32",N),O=yh({inputs:{real:$,imag:R},backend:i}),P=Ou(n,r),L=[P.real.length],D=i.makeTensorInfo(L,"float32",P.real),F=i.makeTensorInfo(L,"float32",P.imag),z=yh({inputs:{real:D,imag:F},backend:i}),B=yd({inputs:{a:z,b:O},backend:i}),U=Nh({inputs:{a:M,b:B},backend:i}),V=lp({inputs:{a:M,b:B},backend:i}),j=Sh({inputs:{input:U},backend:i}),W=Sh({inputs:{input:V},backend:i}),H=sf({inputs:{input:U},backend:i}),G=sf({inputs:{input:V},backend:i}),q=af({inputs:[j,W],backend:i,attrs:{axis:0}}),X=af({inputs:[H,G],backend:i,attrs:{axis:0}}),Y=i.data.get(q.dataId).values,K=i.data.get(X.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(X),{real:Y,imag:K}}const Hf={kernelName:"FFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=p(r.shape),s=r.shape[r.shape.length-1],o=Cp({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=Vf(o,!1,n),l=Cp({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gf(t){const{backend:e,attrs:n}=t,{shape:r,value:i,dtype:s}=n,o=s||R(i),a=_(o,p(r));return function(t,e,n){t.fill(e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(a,i),e.makeTensorInfo(r,o,a)}const qf={kernelName:"Fill",backendName:"cpu",kernelFunc:Gf};const Xf={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,i=n,s=S(r.dtype,p(r.shape)),[o,a,l,c]=r.shape,u=i.data.get(r.dataId).values;for(let t=0;t<o;t++){const e=t*l*a*c;for(let t=0;t<a;t++){const n=t*(l*c);for(let t=0;t<l;t++){const r=t*c;for(let i=0;i<c;i++){const o=Math.round(l-t-1),a=e+n+r+i;let h=u[a];if(o>=0&&o<l){h=u[e+n+o*c+i]}s[a]=h}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Yf={kernelName:"FloorDiv",backendName:"cpu",kernelFunc:Mh("FloorDiv",gh(((t,e)=>Math.floor(t/e))),null,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kf={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=cf({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const t=m;if("NCHW"===u&&1===o.shape.length&&1!==o.shape[0]){const t=Cp({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Nh({inputs:{a:m,b:t},backend:n}),n.disposeIntermediateTensorInfo(t)}else m=Nh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(t)}if(p){const t=m;if("NCHW"===u&&"prelu"===p&&1===a.shape.length&&1!==a.shape[0]){const t=Cp({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=Mp(n,m,p,t,f),n.disposeIntermediateTensorInfo(t)}else m=Mp(n,m,p,a,f);n.disposeIntermediateTensorInfo(t)}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zf={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=kf({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const t=m;m=Nh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=m;m=Mp(n,m,p,a,f),n.disposeIntermediateTensorInfo(t)}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jf={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=p(r.shape),o=i.shape,a=o[o.length-1],[l,c,u,h]=jr(r,i);if(0===c)return n.makeTensorInfo(l,r.dtype,[]);const d=Kh(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,c,a,u,h,r.shape,s);return n.makeTensorInfo(l,r.dtype,d.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qf={kernelName:"GatherV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r;hh([i,s],"gatherV2");const l=x(o,i.shape)[0],u=n.data.get(s.dataId).values,h=i.shape[l];for(let t=0;t<u.length;++t){const e=u[t];c(e<=h-1&&e>=0,(()=>`GatherV2: the index value ${e} is not in [0, ${h-1}]`))}let d=a;null==a&&(d=0);const f=p(s.shape),m=ih(i,s,l,d),g=Cp({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),y=Cp({inputs:{x:s},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),b=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],v=n.bufferSync(y),w=Zh(n.bufferSync(g),v,b);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),n.makeTensorInfo(m.outputShape,w.dtype,w.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tm={kernelName:"IFFT",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=p(r.shape),s=r.shape[r.shape.length-1],o=Cp({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=Vf(o,!0,n),l=Cp({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}},em={kernelName:"IsFinite",backendName:"cpu",kernelFunc:Ph("IsFinite",(t=>Number.isFinite(t)?1:0),"bool")},nm={kernelName:"IsInf",backendName:"cpu",kernelFunc:Ph("IsInf",(t=>Math.abs(t)===1/0?1:0),"bool")},rm={kernelName:"IsNan",backendName:"cpu",kernelFunc:Ph("IsNan",(t=>Number.isNaN(t)?1:0),"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const im={kernelName:"LinSpace",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=od(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},sm={kernelName:"Log1p",backendName:"cpu",kernelFunc:Ph("Log1p",(t=>Math.log1p(t)))},om={kernelName:"LogicalAnd",backendName:"cpu",kernelFunc:Mh("LogicalAnd",gh(((t,e)=>t&&e)),null,"bool")},am={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:Ph("LogicalNot",(t=>t?0:1),"bool")},lm={kernelName:"LogicalOr",backendName:"cpu",kernelFunc:Mh("LogicalOr",gh(((t,e)=>t||e)),null,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cm={kernelName:"LRN",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r;hh(i,"LRN");const c=i.shape[3],u=c-1,h=n.data.get(i.dataId).values,d=p(i.shape),f=new Float32Array(d);function m(t){const e=t%c;let n=t-e+Math.max(0,e-s);const r=t-e+Math.min(e+s,u);let i=0;for(;n<=r;n++){const t=h[n];i+=t*t}return i}for(let t=0;t<d;t++){const e=m(t),n=h[t]*Math.pow(o+a*e,-l);f[t]=n}return n.makeTensorInfo(i.shape,i.dtype,f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const um={kernelName:"LRNGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r;hh(o,"LRNGrad");const h=p(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,m=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,y=new Float32Array(h),b=h;for(let t=0;t<b;t++){const e=t%d,n=t-e+Math.max(0,e-a),r=t-e+Math.min(d,e+a+1);let i=0;for(let t=n;t<r;t++)i+=Math.pow(m[t],2);i=c*i+l;for(let e=n;e<r;e++){let n=-2*c*u*m[e]*g[t]/i;t===e&&(n+=Math.pow(i,-u)),n*=f[t],y[e]+=n}}return n.makeTensorInfo(o.shape,i.dtype,y)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hm(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=n;let l=i.shape;const c=l.length,u=x(s,l);let h=u;const d=Xs(h,c);let f=a.data.get(i.dataId).values;if(null!=d){const t=new Array(c);for(let e=0;e<t.length;e++)t[e]=l[d[e]];f=_d(f,l,i.dtype,d,t),h=Ks(h.length,c),l=t}hh(i,"max"),qs("max",h,c);const[m,g]=Hs(l,h),y=ud(f,p(g),m,i.dtype),b=a.write(y,m,i.dtype);let v=m;if(o){v=Gs(m,u)}return{dataId:b,shape:v,dtype:i.dtype}}const dm={kernelName:"Max",backendName:"cpu",kernelFunc:hm};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pm={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;hh(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;c(qi(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const u=Di(i.shape,s,o,1,a,l);let h;if(1===u.filterWidth&&1===u.filterHeight&&f(u.inShape,u.outShape))h=xh({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=L(i.shape),r=Hp(t,i.shape,i.dtype,e,u,"max");h=n.makeTensorInfo(u.outShape,i.dtype,r.values)}return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fm={kernelName:"MaxPool3D",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;hh(i,"maxPool3d");const u=Fi(i.shape,s,o,1,a,l,c),h=qp(n.data.get(i.dataId).values,i.shape,i.dtype,L(i.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mm={kernelName:"MaxPool3DGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;hh([i,s],"maxPool3DGrad");const u=Fi(s.shape,o,a,1,l,c),h=function(t,e){const n=Xn(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const b=y*r-d;let v=b;for(;v<0;)v+=o;const x=Math.min(e.inDepth,c+b);for(let r=0;r<e.outHeight;++r){const c=r*i-p;let d=c;for(;d<0;)d+=a;const w=Math.min(e.inHeight,u+c);for(let i=0;i<e.outWidth;++i){const p=i*s-f;let S=p;for(;S<0;)S+=l;const _=Math.min(e.inWidth,h+p);let k=Number.NEGATIVE_INFINITY,T=-1;for(let e=v;e<x;e+=o){const n=e-b;for(let r=d;r<w;r+=a){const i=r-c;for(let s=S;s<_;s+=l){const o=s-p,a=t.get(m,e,r,s,g);a>=k&&(k=a,T=n*u*h+i*u+o)}}}n.set(T,m,y,r,i,g)}}}return n}(n.bufferSync(s),u),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.dilationDepth,g=u.dilationHeight,y=u.dilationWidth,b=u.effectiveFilterDepth,v=u.effectiveFilterHeight,x=u.effectiveFilterWidth,w=b-1-u.padInfo.front,S=x-1-u.padInfo.left,_=v-1-u.padInfo.top,k=Xn(s.shape,"float32"),T=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-w,o=r-_,a=i-S;let l=0;for(let n=0;n<b;n+=m){const r=(s+n)/d;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let i=0;i<v;i+=g){const s=(o+i)/p;if(!(s<0||s>=u.outHeight||Math.floor(s)!==s))for(let o=0;o<x;o+=y){const c=(a+o)/f;if(c<0||c>=u.outWidth||Math.floor(c)!==c)continue;const d=b*v*x-1-h.get(t,r,s,c,e)===n*v*x+i*x+o?1:0;if(0===d)continue;l+=T.get(t,r,s,c,e)*d}}}k.set(l,t,n,r,i,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gm={kernelName:"MaxPoolGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;hh([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=Di(a.shape,l,c,1,u,h),p=n.data.get(a.dataId).values,f=Xn(d.outShape,a.dtype,Gp(p,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,x=d.effectiveFilterWidth,w=x-1-d.padInfo.left,S=v-1-d.padInfo.top,_=Xn(a.shape,"float32"),k=n.data.get(i.dataId).values,T=Xn(i.shape,"float32",k);for(let t=0;t<d.batchSize;++t)for(let e=0;e<d.inChannels;++e)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){const i=n-S,s=r-w;let o=0;for(let n=0;n<v;n+=y){const r=(i+n)/m;if(!(r<0||r>=d.outHeight||Math.floor(r)!==r))for(let i=0;i<x;i+=b){const a=(s+i)/g;if(a<0||a>=d.outWidth||Math.floor(a)!==a)continue;const l=v*x-1-f.get(t,r,a,e)===n*x+i?1:0;if(0===l)continue;o+=T.get(t,r,a,e)*l}}_.set(o,t,n,r,e)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ym={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;hh(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,u=Di(r.shape,i,s,[1,1],o),[h,d]=function(t,e,n,r,i){const s=Hp(t,0,n,L(e),i,"max"),o=Gp(t,e,n,i,!0,r);return[s.values,o.values]}(c,r.shape,r.dtype,a,u),p=l.write(h,u.outShape,r.dtype),f=l.write(d,u.outShape,r.dtype);return[{dataId:p,shape:u.outShape,dtype:r.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bm={kernelName:"Mean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=x(s,i.shape),l=p(Hs(i.shape,a)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const h=Th({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(h);const d=Bf({inputs:{a:h,b:u},backend:n});c.push(d);const f=$f({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:o}});return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vm={kernelName:"Min",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;hh(i,"min");const a=x(s,i.shape);let l=a;const c=Xs(l,i.shape.length);let u=i;null!=c&&(u=kd({inputs:{x:i},backend:n,attrs:{perm:c}}),l=Ks(l.length,i.shape.length)),qs("min",l,u.shape.length);const[h,d]=Hs(u.shape,l),f=p(d),m=B(p(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*f;let n=g[e];for(let t=0;t<f;++t){const r=g[e+t];(Number.isNaN(r)||r<n)&&(n=r)}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=Cp({inputs:{x:y},backend:n,attrs:{shape:Gs(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xm={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,mode:o}=r;hh(i,"mirrorPad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),c=s.map(((t,e)=>t[0]+i.shape[e])),u="reflect"===o?0:1,h=n.data.get(i.dataId).values,d=i.shape.length,f=L(i.shape),m=p(a),g=a.length,y=L(a),b=S(i.dtype,m);for(let t=0;t<m;t++){let e=W(t,g,y);for(let t=0;t<g;t++)e[t]<l[t]?e[t]=2*l[t]-e[t]-u:e[t]>=c[t]&&(e[t]=2*(c[t]-1)-e[t]+u);e=e.map(((t,e)=>t-l[e]));const n=j(e,d,f);b[t]=h[n]}return{dataId:n.write(b,a,i.dtype),shape:a,dtype:i.dtype}}},wm=gh(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),Sm=Mh(rt,wm),_m={kernelName:rt,backendName:"cpu",kernelFunc:Sm};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function km(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=i.shape.length;let a=s;if(-1===a&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=x([a],i.shape),c=hm({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Gs(c.shape,l),h=Cp({inputs:{x:c},backend:n,attrs:{shape:u}}),d=lp({inputs:{a:i,b:h},backend:n}),p=Wh({inputs:{x:d},backend:n}),f=$f({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=Cp({inputs:{x:f},backend:n,attrs:{shape:u}}),g=Bf({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const Tm={kernelName:"Softmax",backendName:"cpu",kernelFunc:km};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Em={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r;hh(i,"multinomial");const l=a?i:km({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,d=[c,s],f=B(p(d),"int32");for(let t=0;t<c;++t){const e=t*u,n=new Float32Array(u-1);n[0]=h[e];for(let t=1;t<n.length;++t)n[t]=n[t-1]+h[e+t];const r=$a.alea(o.toString()),i=t*s;for(let t=0;t<s;++t){const e=r();f[i+t]=n.length;for(let r=0;r<n.length;r++)if(e<n[r]){f[i+t]=r;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",f)}},Mm=hc;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cm={kernelName:"NonMaxSuppressionV3",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;hh(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:h}=Mm(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},Am=dc;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nm={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;hh(i,"NonMaxSuppressionPadded");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:d,validOutputs:p}=Am(u,h,o,a,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Im=pc;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $m={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;hh(i,"NonMaxSuppressionWithScore");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,d=o,p=a,f=l,m=c,{selectedIndices:g,selectedScores:y}=Im(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rm={kernelName:"OneHot",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:l}=r;hh(i,"oneHot");const c=p(i.shape),u=new Float32Array(c*o);u.fill(l);const h=n.data.get(i.dataId).values;for(let t=0;t<c;++t)h[t]>=0&&h[t]<o&&(u[t*o+h[t]]=a);return n.makeTensorInfo([...i.shape,o],s,u)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Om(t){const{inputs:e,backend:n}=t,{x:r}=e;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const t=Sh({inputs:{input:r},backend:n}),e=Om({inputs:{x:t},backend:n}),i=sf({inputs:{input:r},backend:n}),s=Om({inputs:{x:i},backend:n}),o=yh({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return Gf({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Pm={kernelName:"ZerosLike",backendName:"cpu",kernelFunc:Om};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lm={kernelName:"OnesLike",backendName:"cpu",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const e=Sh({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=sf({inputs:{input:i},backend:r}),o=Om({inputs:{x:s},backend:r}),a=yh({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return Gf({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dm(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return Ff({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{u(s,t.shape,"All tensors passed to stack must have matching shapes"),c(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],l=af({inputs:e.map((t=>{const e=Ff({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}const Fm={kernelName:"Pack",backendName:"cpu",kernelFunc:Dm};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zm={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;hh(i,"pad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),c=n.data.get(i.dataId).values,u=p(i.shape),h=i.shape.length,d=L(i.shape),f=p(a),m=a.length,g=L(a),y=S(i.dtype,f);0!==o&&y.fill(o);for(let t=0;t<u;t++){y[j(W(t,h,d).map(((t,e)=>t+l[e])),m,g)]=c[t]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}},Bm=gh(((t,e)=>Math.pow(t,e))),Um=Mh(it,Bm),Vm={kernelName:it,backendName:"cpu",kernelFunc:Um};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jm={kernelName:"RaggedGather",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,a=i.map((t=>n.data.get(t.dataId).values)),l=i.map((t=>t.shape)),c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values,[h,d,p]=Id(a,l,c,s.shape,s.dtype,u,o.shape),f=h.map((t=>n.makeTensorInfo([t.length],"int32",t))),m=n.makeTensorInfo(p,s.dtype,d);return f.concat([m])}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wm={kernelName:"RaggedTensorToTensor",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,h=n.data.get(o.dataId).values,d=a.map((t=>n.data.get(t.dataId).values)),p=a.map((t=>t.shape)),[f,m]=Ld(c,i.shape,u,s.shape,s.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hm={kernelName:"Range",backendName:"cpu",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,dtype:s,step:o}=n,a=Dd(r,i,o,s);return e.makeTensorInfo([a.length],s,a)}},Gm={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:Ph("Reciprocal",(t=>1/t))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qm={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;hh(i,"resizeBilinear");const l=L(i.shape),[c,u]=a,[h,d,f,m]=i.shape,g=n.data.get(i.dataId).values,y=new Float32Array(p([h,c,u,m])),b=[s&&c>1?d-1:d,s&&u>1?f-1:f],v=[s&&c>1?c-1:c,s&&u>1?u-1:u];let x=0;const w=b[0]/v[0],S=b[1]/v[1];for(let t=0;t<h;t++)for(let e=0;e<c;e++){let n;n=o?w*(e+.5)-.5:w*e;const r=Math.max(0,Math.floor(n)),i=n-r,s=Math.min(d-1,Math.ceil(n)),a=t*l[0]+r*l[1],c=t*l[0]+s*l[1];for(let t=0;t<u;t++){let e;e=o?S*(t+.5)-.5:S*t;const n=Math.max(0,Math.floor(e)),r=e-n,s=Math.min(f-1,Math.ceil(e)),u=a+n*l[2],h=c+n*l[2],d=a+s*l[2],p=c+s*l[2];for(let t=0;t<m;t++){const e=g[u+t],n=g[h+t],s=e+(g[d+t]-e)*r,o=s+(n+(g[p+t]-n)*r-s)*i;y[x++]=o}}}return n.makeTensorInfo([h,c,u,m],"float32",y)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xm={kernelName:"ResizeBilinearGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;hh([s,i],"resizeBilinearGrad");const a=L(i.shape),[l,c,u,h]=i.shape,[,d,p]=s.shape,f=new Float32Array(l*c*u*h),m=[o&&d>1?c-1:c,o&&p>1?u-1:u],g=[o&&d>1?d-1:d,o&&p>1?p-1:p],y=m[0]/g[0],b=m[1]/g[1],v=n.data.get(s.dataId).values;let x=0;for(let t=0;t<l;t++){const e=t*a[0];for(let t=0;t<d;t++){const n=t*y,r=Math.floor(n),i=Math.min(Math.ceil(n),c-1),s=e+r*a[1],o=e+i*a[1],l=n-r,d=1-l;for(let t=0;t<p;t++){const e=t*b,n=Math.floor(e),r=Math.min(Math.ceil(e),u-1),i=e-n,c=1-i,p=s+n*a[2],m=s+r*a[2],g=o+n*a[2],y=o+r*a[2],w=d*c,S=d*i,_=l*c,k=l*i;for(let t=0;t<h;t++){const e=v[x++];f[p+t]+=e*w,f[m+t]+=e*S,f[g+t]+=e*_,f[y+t]+=e*k}}}}return n.makeTensorInfo([l,u,c,h],"float32",f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ym={kernelName:"ResizeNearestNeighbor",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;hh(i,"resizeNearestNeighbor");const l=L(i.shape),[c,u]=a,[h,d,p,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(h*c*u*f),y=[s&&c>1?d-1:d,s&&u>1?p-1:p],b=[s&&c>1?c-1:c,s&&u>1?u-1:u],v=y[0]/b[0],x=y[1]/b[1];let w=0;for(let t=0;t<h;t++){const e=t*l[0];for(let t=0;t<c;t++){const n=o?v*(t+.5):v*t;let r=Math.min(d-1,s?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const i=e+r*l[1];for(let t=0;t<u;t++){const e=o?x*(t+.5):x*t;let n=Math.min(p-1,s?Math.round(e):Math.floor(e));o&&(n=Math.max(0,n));const r=i+n*l[2];for(let t=0;t<f;t++){const e=m[r+t];g[w++]=e}}}}return n.makeTensorInfo([h,c,u,f],i.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Km={kernelName:"ResizeNearestNeighborGrad",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;hh([s,i],"resizeNearestNeighborGrad");const a=L(i.shape),l=L(s.shape),[c,u,h,d]=i.shape,[,p,f]=s.shape,m=new Float32Array(c*u*h*d),g=n.data.get(s.dataId).values,y=[o&&p>1?u-1:u,o&&f>1?h-1:h],b=[o&&p>1?p-1:p,o&&f>1?f-1:f],v=y[0]/b[0],x=y[1]/b[1],w=1/v,S=1/x,_=2*Math.ceil(w)+2,k=2*Math.ceil(S)+2;for(let t=0;t<c;t++){const e=t*a[0];for(let t=0;t<u;t++){const n=e+t*a[1],r=Math.floor(t*w),i=Math.floor(r-_/2);for(let r=0;r<h;r++){const s=n+r*a[2],c=Math.floor(r*S),y=Math.floor(c-k/2);for(let n=0;n<d;n++){let a=0;for(let s=0;s<_;s++){const c=s+i;if(c<0||c>=p)continue;const d=e+c*l[1],m=c*v;if(t===Math.min(u-1,o?Math.round(m):Math.floor(m)))for(let t=0;t<k;t++){const e=t+y;if(e<0||e>=f)continue;const i=d+e*l[2],s=e*x;r===Math.min(h-1,o?Math.round(s):Math.floor(s))&&(a+=g[i+n])}}m[s+n]=a}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zm={kernelName:"Reverse",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r;hh(i,"reverse");const o=i.shape.length,a=x(s,i.shape);if(0===o)return xh({inputs:{x:i},backend:n});const l=new be(i.shape,i.dtype),c=n.bufferSync(i);for(let t=0;t<l.size;t++){const e=l.indexToLoc(t),n=e.slice();a.forEach((t=>n[t]=i.shape[t]-1-n[t])),l.set(c.get(...n),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},Jm={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=S(r.dtype,p(r.shape)),[c,u,h,d]=r.shape,[f,m]=wu(o,u,h),g=Math.sin(i),y=Math.cos(i),b=a.data.get(r.dataId).values;for(let t=0;t<c;t++){const e=t*h*u*d;for(let t=0;t<u;t++){const n=t*(h*d);for(let r=0;r<h;r++){const i=r*d;for(let o=0;o<d;o++){const a=[c,t,r,o],p=a[2],v=a[1];let x=(p-f)*y-(v-m)*g,w=(p-f)*g+(v-m)*y;x=Math.round(x+f),w=Math.round(w+m);let S=s;if("number"!=typeof s&&(S=3===o?255:s[o]),x>=0&&x<h&&w>=0&&w<u){S=b[e+w*(h*d)+x*d+o]}l[e+n+i+o]=S}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Qm=Ph("Round",(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1})),tg={kernelName:"Round",backendName:"cpu",kernelFunc:Qm};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eg={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=qr(0,i,o),d=Bd(n.bufferSync(i),n.bufferSync(s),o,h,c,l,a,u,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ng(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<e?n=i+1:r=i;return r}function rg(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<=e?n=i+1:r=i;return r}const ig={kernelName:"SearchSorted",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=function(t,e,n,r,i,s){const o=_("int32",n*i);for(let a=0;a<n;++a){const n=t.slice(a*r,(a+1)*r),l=a*i;for(let t=0;t<i;++t)o[l+t]="left"===s?ng(n,e[t+l]):rg(n,e[t+l])}return o}(n.data.get(i.dataId).values,n.data.get(s.dataId).values,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sg={kernelName:"Select",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e;hh([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=Ne(i.dtype,s.dtype),h=B(p(i.shape),u);let d=0;const f=0===o||o>1||1===i.shape.length?1:p(i.shape.slice(1));for(let t=0;t<a.length;t++)for(let e=0;e<f;e++)1===a[t]?h[d++]=l[t]:h[d++]=c[t];return n.makeTensorInfo(i.shape,u,h)}},og={kernelName:"Selu",backendName:"cpu",kernelFunc:Ph("Selu",(t=>t>=0?1.0507009873554805*t:1.7580993408473768*(Math.exp(t)-1)))},ag={kernelName:"Sign",backendName:"cpu",kernelFunc:Ph("Sign",(t=>t<0?-1:t>0?1:0))},lg=Ph(st,(t=>Math.sin(t))),cg={kernelName:st,backendName:"cpu",kernelFunc:lg},ug={kernelName:"Sinh",backendName:"cpu",kernelFunc:Ph("Sinh",(t=>Math.sinh(t)))},hg=Math.log(1.1920928955078125e-7)+2,dg={kernelName:"Softplus",backendName:"cpu",kernelFunc:Ph("Softplus",(t=>{const e=t>-hg,n=t<hg,r=Math.exp(t);let i;return i=n?r:e?t:Math.log(1+r),i}))};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pg={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;hh([i],"spaceToBatchND");const a=p(s),l=[[0,0]];l.push(...o);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const c=zm.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),u=Su(c.shape,s,a,!1),h=_u(u.length,s.length,!1),d=ku(c.shape,s,a,!1),f=Cp({inputs:{x:c},backend:n,attrs:{shape:u}}),m=kd({inputs:{x:f},backend:n,attrs:{perm:h}}),g=Cp({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fg={kernelName:"SparseFillEmptyRows",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n        ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[h,d,p,f,m]=qd(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mg={kernelName:"SparseReshape",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[c,u,h]=Xd(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gg={kernelName:"SparseSegmentMean",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=Yd(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yg={kernelName:"SparseSegmentSum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=Yd(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bg={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=qr(0,i,a),p=!1,f=n.bufferSync(i);let m;switch(s.dtype){case"bool":m=Bd(f,n.bufferSync(s),a,d,u,c,l,h,Boolean(n.data.get(o.dataId).values[0]),p);break;case"float32":m=Bd(f,n.bufferSync(s),a,d,u,c,l,h,n.data.get(o.dataId).values[0],p);break;case"int32":m=Bd(f,n.bufferSync(s),a,d,u,c,l,h,n.data.get(o.dataId).values[0],p);break;case"string":m=Bd(f,n.bufferSync(s),a,d,u,c,l,h,le(n.data.get(o.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vg={kernelName:"SplitV",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=x(o,i.shape)[0],l=ju(i,s,a),c=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map((t=>{const e=[...u];e[a]=t;const r=Hd({inputs:{x:i},backend:n,attrs:{begin:c,size:e}});return c[a]+=t,r}))}},xg={kernelName:"Square",backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;hh(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let t=0;t<i.length;++t){const e=i[t];s[t]=e*e}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},wg={kernelName:"Step",backendName:"cpu",kernelFunc:Ph("Step",((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}))};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sg={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r;hh(i,"stridedSlice");const{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:v,end:x,strides:w}=li(i.shape,s,o,a,l,u,h,d,p);let S;if(g)S=Cp({inputs:{x:i},backend:n,attrs:{shape:m}});else if(y||b){c(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=Kr(v,x,w),e=Hd({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});S=Cp({inputs:{x:e},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(e)}else{const t=tp(f,n.bufferSync(i),w,v);S=n.makeTensorInfo(m,t.dtype,t.values)}return S}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _g={kernelName:"StringNGrams",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,d=n.data.get(u.dataId).values,p=n.data.get(h.dataId).values,[f,m]=np(d,p,i,s,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kg={kernelName:"StringSplit",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values[0],[c,u,h]=ip(a,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tg={kernelName:"StringToHashBucketFast",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=sp(n.data.get(s.dataId).values,i);return n.makeTensorInfo(s.shape,"int32",o)}},Eg=Ph(at,(t=>Math.tan(t))),Mg={kernelName:at,backendName:"cpu",kernelFunc:Eg},Cg=Ph("Tanh",(t=>Math.tanh(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ag={kernelName:"Tile",backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;hh(i,"tile");const o=up(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ng={kernelName:"TopK",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r;hh(i,"topk");const a=n.data.get(i.dataId).values,[l,c]=pp(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ig={kernelName:"Transform",backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[u,h,d,f]=i.shape,[m,g]=null!=c?c:[h,d],y=[u,m,g,f],b=L(i.shape),v=b[0],x=b[1],w=b[2],_=L(y),k=_[0],T=_[1],E=_[2],M=S(i.dtype,p(y));M.fill(l);const C=r.data.get(i.dataId).values,A=r.data.get(s.dataId).values;for(let t=0;t<u;++t){const e=1===s.shape[0]?A:A.subarray(8*t,8*t+8);for(let n=0;n<m;++n)for(let r=0;r<g;++r)for(let i=0;i<f;++i){let s;const c=e[6]*r+e[7]*n+1;if(0===c)continue;const u=(e[0]*r+e[1]*n+e[2])/c,p=(e[3]*r+e[4]*n+e[5])/c,f=$g(u,d,a),m=$g(p,h,a);switch(o){case"nearest":s=Og(C,h,d,v,x,w,t,m,f,i,l);break;case"bilinear":s=Pg(C,h,d,v,x,w,t,m,f,i,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}M[t*k+n*T+r*E+i]=s}return r.makeTensorInfo(y,i.dtype,M)}return{dataId:r.write(M,y,i.dtype),shape:i.shape,dtype:i.dtype}}};function $g(t,e,n){switch(n){case"reflect":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=2*e;n<t&&(n=t*Math.trunc(-n/t)+n),n=n<-e?n+t:-n-1}else if(n>e-1)if(e<=1)n=0;else{const t=2*e;n-=t*Math.trunc(n/t),n>=e&&(n=t-n-1)}return s(0,n,e-1)}(t,e);case"wrap":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=e-1;n+=e*(Math.trunc(-n/t)+1)}else if(n>e-1)if(e<=1)n=0;else{const t=e-1;n-=e*Math.trunc(n/t)}return s(0,n,e-1)}(t,e);case"nearest":return function(t,e){return s(0,t,e-1)}(t,e);default:return function(t,e){return t}(t)}}function Rg(t,e,n,r,i,s,o,a,l,c,u){return 0<=a&&a<e&&0<=l&&l<n?t[o*r+a*i+l*s+c]:u}function Og(t,e,n,r,i,s,o,a,l,c,u){return Rg(t,e,n,r,i,s,o,Math.round(a),Math.round(l),c,u)}function Pg(t,e,n,r,i,s,o,a,l,c,u){const h=Math.floor(a),d=Math.floor(l),p=h+1,f=d+1;return(p-a)*((f-l)*Rg(t,e,n,r,i,s,o,h,d,c,u)+(l-d)*Rg(t,e,n,r,i,s,o,h,f,c,u))+(a-h)*((f-l)*Rg(t,e,n,r,i,s,o,p,d,c,u)+(l-d)*Rg(t,e,n,r,i,s,o,p,f,c,u))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lg={kernelName:"Unique",backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;hh(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:c}=fp(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dg={kernelName:"Unpack",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],l=new Array(o-1);let c=0;for(let t=0;t<o;t++)t!==s&&(l[c++]=i.shape[t]);const u=new Array(o).fill(0),h=i.shape.slice();h[s]=1;const d=new Array(a);for(let t=0;t<d.length;t++){u[s]=t;const e=Hd({inputs:{x:i},backend:n,attrs:{begin:u,size:h}});d[t]=Cp({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fg={kernelName:"UnsortedSegmentSum",backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r;hh(i,"unsortedSegmentSum");const a=[],l=[],c=i.shape.length-s.shape.length;let u=s;for(let t=0;t<c;++t){const e=Ff({inputs:{input:u},backend:n,attrs:{dim:t+1}});u=e,l.push(e)}for(let t=0;t<o;++t){const e=ie(t,"int32"),r=n.makeTensorInfo([],"int32",e),s=Uh({inputs:{a:r,b:u},backend:n}),o=Th({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),c=yd({inputs:{a:o,b:i},backend:n}),h=$f({inputs:{x:c},backend:n,attrs:{axis:0,keepDims:!1}});a.push(h),l.push(r),l.push(s),l.push(o),l.push(c),l.push(h)}const h=Dm({inputs:a,backend:n,attrs:{axis:0}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},zg=[$p,mh,Rp,Op,Ih,Pp,Lp,Dp,Fp,zp,Bp,Up,Vp,jp,Wp,Xp,Yp,Kp,Zp,Ip,Jp,Qp,tf,ef,Eh,Fh,nf,bh,rf,lf,uf,hf,df,pf,ff,mf,yf,bf,vf,xf,wf,Sf,_f,Tf,Ef,Mf,Cf,Af,Nf,If,Of,yp,Pf,Vh,Df,Hh,zf,qh,Hf,qf,Xf,Yh,Yf,Kf,Zf,Jf,Qf,Qh,ed,wh,tm,of,em,nm,rm,vp,rd,sd,im,cd,sm,om,am,lm,cm,um,dm,dd,pm,fm,mm,gm,ym,bm,vm,fd,xm,_m,Em,bd,xd,Cm,Nm,$m,Sd,Rm,Lm,Fm,zm,Vm,Sp,Md,jm,Wm,Hm,_h,Uf,Gm,kp,Ep,Ap,qm,Xm,Ym,Km,Zm,Jm,tg,zd,eg,ig,sg,og,jd,ag,cg,ug,Gd,Tm,dg,pg,fg,mg,gg,yg,bg,vg,Zd,xg,Qd,wg,Sg,_g,kg,Tg,cp,Rf,Mg,{kernelName:"Tanh",backendName:"cpu",kernelFunc:Cg},Ag,Ng,Ig,Td,Lg,Dg,Fg,Pm];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of zg)ft(t);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bg={},Ug={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Vg(t,e){if(!(t in Bg)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t):e;n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete Bg[t]}),!1),X().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ug.failIfMajorPerformanceCaveat=!1);if(1===t)return n.getContext("webgl",Ug)||n.getContext("experimental-webgl",Ug);return n.getContext("webgl2",Ug)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;Bg[t]=n}const n=Bg[t];return null==n||n.isContextLost()?(delete Bg[t],Vg(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Bg[t])}var jg,Wg,Hg;function Gg(t,e){return[e,t]}function qg(t){const e=p(t);return g(Math.ceil(e/4))}function Xg(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Yg(t,e){const n=t;let r,i,s,o,a,l,c,u,h,d;return 2===X().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=t.RGBA,i=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,h=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kg(t,e){const n=e();return X().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(jg||(jg={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Wg||(Wg={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Hg||(Hg={}));function Zg(t){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function Jg(t,e){return ay(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}const Qg=/ERROR: [0-9]+:([0-9]+):/g;function ty(t,e){const n=Qg.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const r=+n[1],i=t.split("\n"),s=i.length.toString().length+2,o=i.map(((t,e)=>y((e+1).toString(),s)+t));let a=0;for(let t=0;t<o.length;t++)a=Math.max(o[t].length,a);const l=o.slice(0,r-1),c=o.slice(r-1,r),u=o.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${y(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function ey(t,e){if(Kg(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function ny(t,e,n,r,i,s,o){const a=t.getAttribLocation(e,n);return-1!==a&&(Kg(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),Kg(t,(()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,s,o))),Kg(t,(()=>t.enableVertexAttribArray(a))),!0)}function ry(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),Kg(t,(()=>t.activeTexture(t.TEXTURE0+n))),Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function iy(t,e,n){Kg(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),Kg(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function sy(t,e){Kg(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),Kg(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function oy(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function ay(t,e,n){const r=Kg(t,(()=>e()));if(null==r)throw new Error(n);return r}function ly(t,e=2){return p(t.slice(0,t.length-e))}function cy(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function uy(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[ly(t),...cy(t)]),e}function hy(t){return t%2==0}function dy(t,e){if(f(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(hy(n)&&hy(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&hy(t[0])&&hy(e[0])}let py,fy;function my(t,e){return null!=t.getExtension(e)}function gy(t){try{if(null!=Vg(t))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function yy(t){if(0===t)return!1;const e=Vg(t);if(1!==t){if(my(e,"EXT_color_buffer_float"))return by(e);const t="EXT_color_buffer_half_float";if(my(e,t)){const n=e.getExtension(t);return function(t,e){const n=Yg(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,s=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}(e,n)}return!1}if(!my(e,"OES_texture_float"))return!1;if(!my(e,"WEBGL_color_buffer_float"))return!1;return by(e)}function by(t){const e=Yg(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function vy(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&c("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xy=X();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wy(){let t,e,n,r,i,s,o,a,l,c;return 2===X().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=X().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sy(t,e,n="index"){const r=L(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / ${e}`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${e}`:`index -= ${t[i]} * ${e}`};`)).join("")}function _y(t,e,n="index"){const r=L(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / outShapeStrides[${i}]`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`};`)).join("")}function ky(t,e,n="index"){const r=t.map(((t,e)=>e)),i=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),i=new Array(n-1);i[n-2]=r[n-1];for(let t=n-3;t>=0;--t)i[t]=`(${i[t+1]} * ${r[t+1]})`;return i}(r,e);return i.map(((e,r)=>`${`int ${t[r]} = ${n} / ${i[r]}`}; ${r===i.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${i[r]}`:`index -= ${t[r]} * ${i[r]}`};`)).join("")}function Ty(t){const e=L(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}xy.registerFlag("HAS_WEBGL",(()=>xy.getNumber("WEBGL_VERSION")>0)),xy.registerFlag("WEBGL_VERSION",(()=>gy(2)?2:gy(1)?1:0)),xy.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),xy.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===xy.get("WEBGL_VERSION"))),xy.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),xy.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),xy.registerFlag("WEBGL_PACK",(()=>xy.getBool("HAS_WEBGL"))),xy.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_CLIP",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_PACK_REDUCE",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_LAZILY_UNPACK",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_CONV_IM2COL",(()=>xy.getBool("WEBGL_PACK"))),xy.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==py){const e=Vg(t);py=e.getParameter(e.MAX_TEXTURE_SIZE)}return py}(xy.getNumber("WEBGL_VERSION")))),xy.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==fy){const e=Vg(t);fy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,fy)}(xy.getNumber("WEBGL_VERSION")))),xy.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=xy.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=Vg(t);return e=my(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:my(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),xy.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>xy.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!He())),xy.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=Vg(t);if(1===t){if(!my(e,"OES_texture_float"))return!1}else if(!my(e,"EXT_color_buffer_float"))return!1;return by(e)}(xy.getNumber("WEBGL_VERSION")))),xy.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!xy.getBool("WEBGL_FORCE_F16_TEXTURES")&&xy.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),xy.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>yy(xy.getNumber("WEBGL_VERSION")))),xy.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=xy.getNumber("WEBGL_VERSION"))&&null!=Vg(t).fenceSync;var t})),xy.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>xy.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),xy.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),xy.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>He()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),xy.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),xy.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),xy.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),xy.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),xy.registerFlag("WEBGL_EXP_CONV",(()=>!1)),xy.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>xy.getBool("IS_TEST"))),xy.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),xy.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),xy.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1));const Ey="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:My}=lh;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cy(t,e,n){const r=[];if(t.forEach((t=>{const e=p(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=zy(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const i=r.join("\n"),s=t.map((t=>function(t,e,n=!1,r){let i="";i+=n?Ny(t,r):Ay(t,r);const s=t.shapeInfo.logicalShape,o=e.logicalShape;s.length<=o.length&&(i+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=My(t.shapeInfo.logicalShape,e.logicalShape),l=Fy(o),c=o-s;let u;const h=["x","y","z","w","u","v"];u=0===s?"":o<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${h[t+c]} = 0;`)).join("\n");let d="";d=o<2&&s>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${h[e+c]}`)).join(", ");let f="return outputValue;";const m=1===p(t.shapeInfo.logicalShape),g=1===p(e.logicalShape);if(1!==s||m||g){if(m&&!g)f=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=s-2,e=s-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?f="return vec4(outputValue.x);":a.indexOf(t)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${l} coords = getOutputCoords();\n      ${u}\n      vec4 outputValue = get${r}(${d});\n      ${f}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&null==t.shapeInfo.flatOffset&&f(o,s))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=Fy(l),u=My(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const p=["x","y","z","w","u","v"];d=0===a?"":l<2&&u.length>=1?"coords = 0;":u.map((t=>`coords.${p[t+h]} = 0;`)).join("\n");let m="";m=l<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+h]}`)).join(", ");return`\n    float ${i}() {\n      ${c} coords = getOutputCoords();\n      ${d}\n      return get${r}(${m});\n    }\n  `}(t,e));return i}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=e.texShape,a=wy(),l=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(a);let c,u,h=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${Iy}\n    ${$y}\n    ${Ry}\n  `}(a);e.isPacked?(c=function(t,e,n){switch(t.length){case 0:return Py();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(f(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),s=i*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),s=i*Math.ceil(t[t.length-2]/2);let o=s,a="",l="b, r, c";for(let e=2;e<t.length-1;e++)o*=t[t.length-e-1],a=`\n      int b${e} = index / ${o};\n      index -= b${e} * ${o};\n    `+a,l=`b${e}, `+l;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${t.length}(${l});\n    }\n  `}(t,e,n)}}(e.logicalShape,o,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(a)):(c=function(t,e,n){switch(t.length){case 0:return Py();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(f(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${_y(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=Sy(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${_y(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=Sy(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=Sy(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=Sy(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,o,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(a)),n.packedInputs&&(h+=Oy);return[h,l,u,i,c,s,n.userCode].join("\n")}function Ay(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=t.shapeInfo.texShape;if(1===i&&1===s)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=Ly(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[a,l]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${a}, ${l}, ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${Dy(t)}\n      }\n    `;const i=t.shapeInfo.texShape,s=i[0],o=i[1];if(1===o&&1===s)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=Ly(n);if(1===o)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===s)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape;if(null!=s&&f(n,s)){if(e)return`\n      float ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=s[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:o,keptDims:a}=w(n),l=o;if(l.length<n.length){const n=["row","col"];return`\n      ${Ay(By(t,l),e)}\n      float ${i}(int row, int col) {\n        return ${i}(${Uy(n,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${Dy(t)}\n      }\n    `;const c=s[0],u=s[1],h=Ly(r);if(1===u)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===c)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${i}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${c}, ${u}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=w(n),c=a;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${Ay(By(t,c),e)}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${Uy(n,l)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${o}, 1)));\n        ${Dy(t)}\n      }\n    `;const u=t.shapeInfo.texShape,h=u[0],d=u[1],p=t.shapeInfo.flatOffset;if(d===s&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(d===o&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const f=Ly(r);if(e)return`\n    float ${i}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${o} + depth + ${f};\n        vec2 uv = uvFromFlat(${h}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:l,keptDims:c}=w(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${Ay(By(t,l),e)}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${Uy(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${o}, ${s}, 1)));\n        ${Dy(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===s&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=Ly(r);if(e)return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],s=e[3]*i,o=e[2]*s,a=e[1]*o,{newShape:l,keptDims:c}=w(e);if(l.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${Ay(By(t,l))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${Uy(e,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${o}, ${s}, ${i})) +\n          depth3;\n        ${Dy(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===i&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=Ly(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} + depth * ${s} +\n          depth2 * ${i} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=w(e);if(i.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${Ay(By(t,i))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${Uy(e,s)});\n      }\n    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${c}, ${l}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${Dy(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${l}, ${a}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===o&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=Ly(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${c} + depth * ${l} +\n          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Ny(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=wy();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,s=wy();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${o[0]}, ${o[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],l=wy();if(null!=s&&f(n,s))return e?`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${i}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=["b","row","col"];return`\n        ${Ny(By(t,n.slice(1)),e)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${Uy(s,r)});\n        }\n      `}const a=wy();if(e)return`\n    vec4 ${i}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${c}, ${h}, ${u}, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=wy();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);\n    }\n  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],h=Math.ceil(s[o-1]/2);let d=h*Math.ceil(s[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let t=2;t<o-1;t++)p=`int b${t}, `+p,d*=s[o-t-1],f=`b${t} * ${d} + `+f;return`\n    vec4 ${r}(${p}) {\n      int index = ${f};\n      int texR = index / ${u};\n      int texC = index - texR * ${u};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const Iy="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",$y="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ry="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Oy="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Py(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function Ly(t){return`offset${t}`}function Dy(t){const e=t.name,n=p(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function Fy(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function zy(t,e,n){const{newShape:r,keptDims:i}=w(e),s=e.length,o=t&&3===s&&1===e[0],a=o?e.slice(1):r,l=!t&&s>1&&!f(e,n)&&r.length<s||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:i}}function By(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Uy(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vy(t,e,n,r){const i=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=i.map((t=>t.shapeInfo)),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=Cy(i,o,e),l=function(t,e){const n=ay(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(Kg(t,(()=>t.shaderSource(n,e))),Kg(t,(()=>t.compileShader(n))),X().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw ty(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t.gl,a),c=t.createProgram(l);return X().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o},jy(t,e,c))}function jy(t,e,n){const r={},i={},s={},o=[];let a,l,c,u=null,h=null;h=t.getUniformLocation(n,"NAN",!1),1===X().getNumber("WEBGL_VERSION")&&(u=t.getUniformLocation(n,"INFINITY",!1));const d=!1;for(let o=0;o<e.variableNames.length;o++){const a=e.variableNames[o];r[a]=t.getUniformLocation(n,a,d),r[`offset${a}`]=t.getUniformLocation(n,`offset${a}`,d),e.enableShapeUniforms&&(i[`${a}Shape`]=t.getUniformLocation(n,`${a}Shape`,d),s[`${a}TexShape`]=t.getUniformLocation(n,`${a}TexShape`,d))}return e.enableShapeUniforms&&(a=t.getUniformLocation(n,"outShape",d),c=t.getUniformLocation(n,"outShapeStrides",d),l=t.getUniformLocation(n,"outTexShape",d)),e.customUniforms&&e.customUniforms.forEach(((e,r)=>{o[r]=t.getUniformLocation(n,e.name,d)})),{uniformLocations:r,customUniformLocations:o,infLoc:u,nanLoc:h,inShapesLocations:i,inTexShapesLocations:s,outShapeLocation:a,outShapeStridesLocation:c,outTexShapeLocation:l}}function Wy(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,i=e[n],s=i.shape;if(!f(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(t.isUniform&&i.isUniform)return;const o=t.texShape,a=i.isUniform?null:i.texData.texShape;if(!f(o,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${a} must match`)}))}function Hy(t){return X().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gy{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=jg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=wy();this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?_y(["r","c","d"],t):Sy(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qy{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=jg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=wy();this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?_y(["r","c","d"],t):Sy(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xy{constructor(t){this.variableNames=["A"],this.outTexUsage=Wg.DOWNLOAD;const e=wy();this.outputShape=t,this.userCode=`\n      ${Ey}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yy{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Wg.DOWNLOAD;const e=wy();this.outputShape=t,this.userCode=`\n      ${Ey}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ky{constructor(t,e=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=wy();this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length);let r="result";e&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ty(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zy{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=wy();this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){const s=2*e+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${s}] = values[0];\n            } else if (offset == 1) {\n              result[${s}] = values[1];\n            } else if (offset == 2) {\n              result[${s}] = values[2];\n            } else {\n              result[${s}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ty(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jy(t){const e=wy();return function(t,e){const n=ay(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(Kg(t,(()=>t.shaderSource(n,e))),Kg(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function Qy(t){return function(t,e){const n=ay(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return Kg(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),Kg(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function tb(t){return function(t,e){const n=ay(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return Kg(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),Kg(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function eb(t,e,n,r,i,s){!function(t,e){const n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const o=function(t){return ay(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return Kg(t,(()=>t.bindTexture(a,o))),Kg(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),Kg(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),Kg(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),Kg(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===X().getNumber("WEBGL_VERSION")?Kg(t,(()=>t.texImage2D(a,0,r,e,n,0,i,s,null))):Kg(t,(()=>t.texStorage2D(a,1,r,e,n))),Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:o,texShape:[n,e]}}function nb(t){return t.internalFormatFloat}function rb(t){return t.internalFormatHalfFloat}function ib(t){return t.downloadTextureFormat}function sb(t){return t.internalFormatPackedFloat}function ob(t){return t.internalFormatPackedHalfFloat}function ab(t,e,n,r,i,s,o,a){const l=t,c=new Float32Array(function(t,e){const[n,r]=Xg(t,e);return n*r*4}(s,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lb{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=X().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){Bg[t]=e}(e,t)):this.gl=Vg(e);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===X().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=Jg(this.gl,t),my(this.gl,e))this.textureHalfFloatExtension=Jg(this.gl,e);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),my(this.gl,r))this.colorBufferHalfFloatExtension=Jg(this.gl,r);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",my(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!my(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=Qy(this.gl),this.indexBuffer=tb(this.gl),this.framebuffer=function(t){return ay(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Yg(this.gl,this.textureHalfFloatExtension)}get debug(){return X().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Kg(t,(()=>t.finish())),Kg(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),Kg(t,(()=>t.deleteFramebuffer(this.framebuffer))),Kg(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),Kg(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),Kg(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Gg(e,n);return eb(t,i,s,nb(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Gg(e,n);return eb(t,i,s,rb(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Gg(e,n);return eb(t,i,s,ib(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===X().getNumber("WEBGL_VERSION")?Kg(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):Kg(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===X().getNumber("WEBGL_VERSION")?Kg(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):Kg(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,i,s){let o,a,l;Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,l=s.internalFormatPackedFloat),o.set(i),2===X().getNumber("WEBGL_VERSION")?Kg(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,o))):Kg(t,(()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,a,o))),Kg(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Xg(e,n);return eb(t,i,s,ob(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Xg(e,n);return eb(t,i,s,sb(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(sy(this.gl,this.framebuffer),this.outputTexture=null),Kg(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,r){const[i,s]=Gg(e,n),o=new Uint8Array(e*n*4);return Kg(t,(()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,o))),new Float32Array(o.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,i,s){return ab(this.gl,t,0,0,0,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const i=t.createBuffer();Kg(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const s=16*e*n;return Kg(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ))),Kg(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),Kg(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(X().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const r=new Float32Array(e*n*4);return Kg(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=Jy(e));const n=function(t){return ay(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);return Kg(e,(()=>e.attachShader(n,this.vertexShader))),Kg(e,(()=>e.attachShader(n,t))),function(t,e){if(Kg(t,(()=>t.linkProgram(e))),!X().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,n),this.debug&&ey(e,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(t,e,n){return Kg(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),ny(t,e,"clipSpacePos",n,3,20,0)&&ny(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),n}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Kg(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&ey(this.gl,this.program),Kg(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return ay(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),Kg(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){Kg(t,(()=>ry(t,e,r))),Kg(t,(()=>t.uniform1i(n,r)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=Xg(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&ey(this.gl,this.program),oy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),Kg(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Kg(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Jg(this.gl,2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await b((()=>this.disposed||this.isQueryAvailable(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in X().platform&&(n=X().platform.setTimeoutCustom.bind(X().platform)),b((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),iy(this.gl,t,this.framebuffer),this.debug&&oy(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(iy(this.gl,this.outputTexture,this.framebuffer),this.debug&&oy(this.gl)):sy(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;iy(r,t,this.framebuffer),this.debug&&oy(r),this.outputTexture=t,Kg(r,(()=>r.viewport(0,0,e,n))),Kg(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),Kg(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:cb,bincountImpl:ub,bincountReduceImpl:hb,castImpl:db,ceilImpl:pb,concatImpl:fb,equalImpl:mb,expImpl:gb,expm1Impl:yb,floorImpl:bb,gatherNdImpl:vb,gatherV2Impl:xb,greaterImpl:wb,greaterEqualImpl:Sb,lessImpl:_b,lessEqualImpl:kb,linSpaceImpl:Tb,logImpl:Eb,maxImpl:Mb,maximumImpl:Cb,minimumImpl:Ab,multiplyImpl:Nb,negImpl:Ib,notEqualImpl:$b,prodImpl:Rb,raggedGatherImpl:Ob,raggedTensorToTensorImpl:Pb,rangeImpl:Lb,rsqrtImpl:Db,scatterImpl:Fb,sigmoidImpl:zb,simpleAbsImpl:Bb,sliceImpl:Ub,sparseFillEmptyRowsImpl:Vb,sparseReshapeImpl:jb,sparseSegmentReductionImpl:Wb,sqrtImpl:Hb,stridedSliceImpl:Gb,stringNGramsImpl:qb,stringSplitImpl:Xb,stringToHashBucketFastImpl:Yb,subImpl:Kb,tileImpl:Zb,topKImpl:Jb,transposeImpl:Qb,uniqueImpl:tv}=mp;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function nv(t,e){return 1===e?[t]:ev(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class rv{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Hy(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=nv("rc",this.rank),e=Fy(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),i=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${i}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)i=`${t[t.length-1-e]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iv{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length);let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var r,i;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${r=e,i=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${i?ky(["r","c","d"],"inputShape"):Sy(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ty(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class sv{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const r=av(e,n),i=lv(t,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const s=ov(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const t=this.freeTextures[i].shift();return this.usedTextures[i].push(t),t}let o;return r===Hg.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===Hg.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===Hg.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===Hg.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===Hg.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const i=av(n,r),s=lv(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);const o=ov(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=X().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=o):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[s],c=l.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function ov(t,e,n,r,i){const s=function(t,e){switch(t){case Hg.PACKED_2X2_FLOAT32:return sb(e);case Hg.PACKED_2X2_FLOAT16:return ob(e);case Hg.UNPACKED_FLOAT32:return nb(e);case Hg.UNPACKED_FLOAT16:return rb(e);case Hg.PACKED_4X1_UNSIGNED_BYTE:return ib(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let o;if(i){const[e,n]=Xg(t[0],t[1]);o=e*n}else{const[e,n]=Gg(t[0],t[1]);o=e*n}const a=function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,s);return o*a}function av(t,e){if(t===Wg.UPLOAD)return Hg.PACKED_2X2_FLOAT32;if(t===Wg.RENDER||null==t)return function(t){return X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Hg.PACKED_2X2_FLOAT32:Hg.UNPACKED_FLOAT32:t?Hg.PACKED_2X2_FLOAT16:Hg.UNPACKED_FLOAT16}(e);if(t===Wg.DOWNLOAD||t===Wg.PIXELS)return Hg.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function lv(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cv{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const uv="return x;";class hv{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dv{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length);const e=t.length,n=nv("rc",e),r=Fy(e),i=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),s=n.slice(-2),o=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pv=Il,fv={};const mv=X().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class gv extends n{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(null!=t){if(t instanceof lb)n=t;else{const e=Vg(X().getNumber("WEBGL_VERSION"),t);n=new lb(e)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=Vg(X().getNumber("WEBGL_VERSION"));n=new lb(t),this.binaryCache=((r=X().getNumber("WEBGL_VERSION"))in fv||(fv[r]={}),fv[r]),this.gpgpuCreatedLocally=!0}var r;this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new sv(this.gpgpu),this.numMBBeforeWarning=null==X().global.screen?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new e(this,br())}nextDataId(){return gv.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,e,n){if((X().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||X().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:Wg.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:Wg.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:i,slice:s,shape:o,isPacked:a}=e;if(null!=s){let e;e=a?new hv(o,uv):new cv(o,uv);const n=this.runWebGLProgram(e,[{dataId:t,shape:o,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=oe()),"complex64"===r){u=Cu(this.readSync(i.real.dataId),this.readSync(i.imag.dataId))}else u=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=oe()-c),this.convertAndCacheOnCPU(t,u)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:i,dtype:s,complexTensorInfos:o,isPacked:a}=e;if(null!=i){let e;e=a?new hv(r,uv):new cv(r,uv);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:s}],s),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if(X().getBool("DEBUG")&&!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===X().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==s&&X().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(t);const e=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(e.texture.texture,...qg(r))}if(this.pendingRead.set(t,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const t=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);c=Cu(t[0],t[1])}else if(null==u)c=this.getValuesFromTexture(t);else{const t=p(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,t)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const t=this.gpgpu.gl;Kg(t,(()=>t.deleteBuffer(u)))}const h=this.convertAndCacheOnCPU(t,c),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach((t=>t(h))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&br().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,isPacked:a,texture:l}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=a?new hv(i,uv):new cv(i,uv);const r=this.runWebGLProgram(n,[{dataId:t,shape:i,dtype:o}],o),s=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),s}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),u=br().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>le(t)));return Xn(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Xn(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!Zg(n)){if(X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),i=p(e);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...qg(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),s}const s=X().getBool("WEBGL_PACK")&&!0===r,o=s?uy(e):e,a=s?new Yy(o):new Xy(o),l=this.runWebGLProgram(a,[{shape:o,dtype:n,dataId:t}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const i=d(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),s=d(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(i);o.kernelMs=l(t),o.getExtraProfileInfo=()=>t.map(((t,e)=>({name:s[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:oe(),endMs:null}}endTimer(t){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=oe(),t)}async getQueryTime(t){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:s,slice:o}=this.texData.get(t),a=o&&o.origDataId||t,l=this.dataRefCount.get(a);l>1?this.dataRefCount.set(a,l-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,s)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=mv){return X().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&p(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){lt("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return pv(t.shape,e)}packedUnaryOp(t,e,n){const r=new hv(t.shape,e),i=this.compileAndRun(r,[t],n);return br().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=Bb(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"return abs(x);",t.dtype);const e=new cv(t.shape,"return abs(x);"),n=this.compileAndRun(e,[t]);return br().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&N(n[0])){const i=n.map((t=>ae(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return br().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new dv(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new rv(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[ly(t.shape),...cy(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[ly(e),...cy(e)],s=new iv(i,n),o=[n],a=this.runWebGLProgram(s,[r],t.dtype,o,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:i,dtype:s}=n;if(null!=e){c(p(i)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const o=uy(i);let a;a=r?new qy(o):new Gy(o);const l=[null!=e?e:qg(o)];return{dtype:s,shape:i,dataId:this.runWebGLProgram(a,[{shape:o,dtype:s,dataId:t}],s,l,!0,e).dataId}}runWebGLProgram(t,e,n,r,i=!1,s){const o=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(o.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===jg.DENSE){const e=null!=s?s:qg(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===p(o.shape))return a.values=S(o.dtype,0),o;const l=[],c=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&p(e.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),l.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!dy(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),l.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const u={shape:o.shape,texData:a,isUniform:!1},h=function(t,e,n){let r="";e.concat(n).forEach((e=>{const i=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const s=e.texData.texShape,{useSqueezeShape:o,uniformShape:a,keptDims:l}=zy(t.packedInputs,e.shape,s);let c="",u="",h="";if(1===a.length&&t.packedInputs){const t=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];c=`${t[0]>1}_${t[1]>1}`}else if(2!==a.length||t.packedInputs){if(a.length>2&&!t.packedInputs){const t=L(a);h=`${t[0]===s[1]}_${t[t.length-1]===s[1]}`}}else u=`${a[0]>1}_${a[1]>1}`;const d=e.shape.length,m=2===a.length&&f(e.shape,s),g=1===p(e.shape),y=$r(e.shape,n.shape),b=!t.packedInputs&&d===n.shape.length&&f(s,n.texData.texShape),v=t.packedInputs||a.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${d}_${b}_${o?l:""}_${a.length}_${g}_${y}_${m}_${c}_${u}_${h}_${v}_${i}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${i}`}}));const i=t.userCode;let s=t.constructor.name;return s+="_"+r+"_"+i+`${X().getNumber("WEBGL_VERSION")}`,s}(t,c,u),d=this.getAndSaveBinary(h,(()=>Vy(this.gpgpu,t,c,u))),m=null!=this.activeTimers;let g;m&&(g=this.startTimer()),X().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,i){e.program.enableShapeUniforms||(Wy(e.inShapeInfos,n),Wy([e.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):t.setOutputMatrixTexture(s.texture,o[0],o[1]),t.setProgram(e.webGLProgram),1===X().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,r)=>{const i=e.program.variableNames[r],s=e.uniformLocations[i],o=e.uniformLocations[`offset${i}`],a=e.inShapesLocations[`${i}Shape`],l=e.inTexShapesLocations[`${i}TexShape`];if(a){const{uniformShape:r}=zy(e.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:t.gl.uniform1iv(a,new Int32Array(r));break;case 2:t.gl.uniform2iv(a,new Int32Array(r));break;case 3:t.gl.uniform3iv(a,new Int32Array(r));break;case 4:t.gl.uniform4iv(a,new Int32Array(r))}}if(l&&t.gl.uniform2i(l,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(p(n.shape)<2)t.gl.uniform1f(s,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(s,e)}else null!=n.texData.slice&&null!=o&&t.gl.uniform1i(o,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture.texture,s,r)}));const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=L(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i&&e.program.customUniforms.forEach(((n,r)=>{const s=e.customUniformLocations[r],o=i[r];if("float"===n.type)t.gl.uniform1fv(s,o);else if("vec2"===n.type)t.gl.uniform2fv(s,o);else if("vec3"===n.type)t.gl.uniform3fv(s,o);else if("vec4"===n.type)t.gl.uniform4fv(s,o);else if("int"===n.type)t.gl.uniform1iv(s,o);else if("ivec2"===n.type)t.gl.uniform2iv(s,o);else if("ivec3"===n.type)t.gl.uniform3iv(s,o);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(s,o)}})),t.executeProgram()}(this.gpgpu,d,c,u,r),l.forEach((t=>this.disposeIntermediateTensorInfo(t))),m&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));const y=X().get("WEBGL_FLUSH_THRESHOLD");if(y>0){const t=oe();t-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!X().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===i){const t=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),t}return o}compileAndRun(t,e,n,r,i=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!X().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=xr((()=>{if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=X().getBool("DEBUG");X().set("DEBUG",!1);const e=this.abs(to(1e-8)).dataSync()[0];if(X().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:i,texture:s,usage:a,isPacked:l}=e;if(null!=s)return;const c=null!=this.activeTimers;let u;c&&(u=oe());let h=e.texShape;if(null==h&&(h=function(t,e=!1){let n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=X().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&X().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n*=2,r*=2,t=t.map(((e,n)=>n>=t.length-2?o(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=w(t);t=e.newShape}let i=p(t),s=null;t.length<=1&&i<=n?s=[1,i]:2===t.length&&t[0]<=n&&t[1]<=n?s=t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const a=null!=s&&Math.max(...s)>r&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(null==s||a)if(e){const e=ly(t);let n=2,r=2;t.length&&([n,r]=cy(t)),i=e*(n/2)*(r/2),s=g(i).map((t=>2*t))}else s=g(i);return s}(n,l),e.texShape=h),null!=i){const t=uy(n);let s,o=h[1],a=h[0];const d=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!l&&d||([o,a]=Xg(h[0],h[1])),s=l?new Zy(t,d):new Ky(t,d);const p=d?[a,o]:h,f=this.makeTensorInfo(p,r),m=this.texData.get(f.dataId);m.usage=d?Wg.PIXELS:Wg.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),o,a,i);const g=[[a,o]],y=!0,b=this.runWebGLProgram(s,[f],r,g,y),v=this.texData.get(b.dataId);e.texShape=v.texShape,e.isPacked=v.isPacked,e.usage=v.usage,X().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(e.texture=v.texture,e.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(f),c&&(this.uploadWaitMs+=oe()-u)}else{const t=this.acquireTexture(h,a,r,l);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*C(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await du(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw ty(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:e,customUniformLocations:n,infLoc:r,nanLoc:i,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:a,outShapeStridesLocation:l,outTexShapeLocation:c}=jy(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=i,t.inShapesLocations=s,t.inTexShapesLocations=o,t.outShapeLocation=a,t.outShapeStridesLocation=l,t.outTexShapeLocation=c}}}gv.nextDataId=0,Ge()&&kr("webgl",(()=>new gv),2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;class yv{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=Or(e,n),this.enableShapeUniforms=Hy(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bv{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Or(e,n);const i=this.outputShape.length;this.enableShapeUniforms=Hy(i);let s="";if(r)if(0===i||1===p(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(s=`\n          ${Fy(i)} coords = getOutputCoords();\n        `,1===i)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=nv("coords",i);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= outShape[${i} - 2];\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= outShape[${i} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vv(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const xv={kernelName:"Identity",backendName:"webgl",kernelFunc:vv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wv(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=vv({inputs:{x:r},backend:n}),l=vv({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:l},s}const Sv={kernelName:"Complex",backendName:"webgl",kernelFunc:wv},_v="return (a < 0.) ? b * a : a;",kv="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tv={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r,o=n.makeTensorInfo([],"float32",ie(s,"float32")),a=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bv(kv,i.shape,o.shape):new yv(_v,i.shape,o.shape),l=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),l}},Ev="return (a < 0.) ? b * a : a;",Mv="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cv={kernelName:"Prelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,s=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bv(Mv,r.shape,i.shape):new yv(Ev,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Av({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&null!=n){const t=a.texData.get(o.dataId),e=n(t.values,l);return a.makeTensorInfo(o.shape,l,e)}let c;return c=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new hv(o.shape,e):new cv(o.shape,t),a.runWebGLProgram(c,[o],l)}}function Nv({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(r&&"complex64"===l.dtype){const e=u.texData.get(l.dataId),n=u.texData.get(c.dataId),[r,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,i={dataId:n.dataId,dtype:n.dtype,shape:l.shape},s={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o=new yv(t,l.shape,c.shape);return u.runWebGLProgram(o,[i,s],Ne(n.dtype,r.dtype))})),s=wv({inputs:{real:r,imag:i},backend:u});return u.disposeIntermediateTensorInfo(r),u.disposeIntermediateTensorInfo(i),s}const h=s||Ne(l.dtype,c.dtype);if(("string"===l.dtype||"string"===c.dtype||u.shouldExecuteOnCPU([l,c]))&&null!=i){const t=u.texData.get(l.dataId).values,e=u.texData.get(c.dataId).values,n="string"===l.dtype?oh(t):t,r="string"===l.dtype?oh(e):e,[s,o]=i(l.shape,c.shape,n,r,h),a=u.makeTensorInfo(o,h);return u.texData.get(a.dataId).values=s,a}let d;return d=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new bv(e,l.shape,c.shape,n):new yv(t,l.shape,c.shape),u.runWebGLProgram(d,[l,c],h)}}function Iv(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?Mv:Ev;if("leakyrelu"===t)return e?kv:_v;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $v{constructor(t,e,n,r=!1,i=!1,s=!1,o=null,a=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Hy(this.outputShape.length);const c=r?t[1]:t[2],u=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";o&&(m=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";t[0]<e[0]?b=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(v=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${u}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${u}; i++) {\n          int batchA = ${b};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rv="return areal * breal - aimag * bimag;",Ov="return areal * bimag + aimag * breal;";class Pv{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Or(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lv="return a * b;";function Dv(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=Ne(r.dtype,i.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),s=new Pv(Rv,r.shape,i.shape),o=new Pv(Ov,r.shape,i.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(s,a,"float32"),c=n.runWebGLProgram(o,a,"float32"),u=wv({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([r,i])){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),[o,a]=Nb(r.shape,i.shape,t.values,e.values,s),l=n.makeTensorInfo(a,s);return n.texData.get(l.dataId).values=o,l}let o;return o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bv(Lv,r.shape,i.shape):new yv(Lv,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const Fv={kernelName:"Multiply",backendName:"webgl",kernelFunc:Dv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zv(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=n,a=p(i.shape),l=v(s,a),u=p(l);c(a===u,(()=>`The new shape (${l}) has ${u} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const h=o.texData.get(i.dataId);return!h.isPacked||dy(i.shape,l)||null!==h.texture&&dy(h.shape,l)?(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):function(t,e,n){const r=[ly(t.shape),...cy(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[ly(e),...cy(e)],o=new iv(s,r),a=[r],l=n.runWebGLProgram(o,[i],t.dtype,a,!0);return{dataId:l.dataId,shape:e,dtype:l.dtype}}(i,l,o)}const Bv={kernelName:"Reshape",backendName:"webgl",kernelFunc:zv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uv{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];const o=4*Math.floor(n/4),a=n%4;let l="sumValue += dot(values, ones);";if(null!=e){const t=1/e;l=`sumValue += dot(values * ${m(t)?t.toPrecision(2):t}, ones);`}let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vv{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];let o="0.0",a="";"prod"===e?o="1.0":"min"===e?(o="1.0 / 1e-20",a="min"):"max"===e&&(o="-1.0 / 1e-20",a="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?l="sumValue":"prod"===e?l="prodValue":"all"===e?l="allValue":"any"===e&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${a}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===e?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";i%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${l});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jv(t,e,n,r){const i=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=xu(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let s=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:l,outSize:c}=i[o];let u,h;u="mean"===n?0===o?new Uv({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new Uv({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):new Vv({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),h=s,s=r.runWebGLProgram(u,[s],e),h.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(h)}return s}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wv{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const r=Fy(this.rank),i=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let e=0;e<t.length;e++)r[t[e]]=n[e];return r.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class Hv{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Fy(this.rank),i=ev("rc",this.rank),s=new Array(this.rank);for(let t=0;t<e.length;t++)s[e[t]]=i[t];const o=`vec2(${s.slice(-2).join()})`,a=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${a}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${a}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gv(t,e,n){const r=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hv(t.shape,e):new Wv(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qv(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;return function(t,e,n,r){const i=e,s=t.shape.length,o=x(i,t.shape);let a=o;const l=Xs(a,s),c=null!=l;let u=t;c&&(u=Gv(t,l,r),a=Ks(a.length,s)),qs("sum",a,s);const[h,d]=Hs(u.shape,a);let f=h;n&&(f=Gs(h,o));const m=p(d),g=zv({inputs:{x:u},attrs:{shape:[p(t.shape)/m,m]},backend:r}),y=jv(g,Ie(t.dtype),"sum",r),b=zv({inputs:{x:y},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(u),b}(i,s,o,n)}const Xv={kernelName:"Sum",backendName:"webgl",kernelFunc:qv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:s}=r,o=n,a=i.shape.length,l=new Array(a);for(let t=0;t<l.length;t++)l[t]=i.shape[s[t]];let c;if(o.shouldExecuteOnCPU([i])){const t=o.texData.get(i.dataId).values,e=Qb(t,i.shape,i.dtype,s,l);c=o.makeTensorInfo(l,i.dtype);o.texData.get(c.dataId).values=e}else c=Gv(i,s,o);return c}const Kv={kernelName:"Transpose",backendName:"webgl",kernelFunc:Yv};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,h=e.shape.length,d=n?t.shape[u-2]:t.shape[u-1],f=r?e.shape[h-1]:e.shape[h-2],m=n?t.shape[u-1]:t.shape[u-2],g=r?e.shape[h-2]:e.shape[h-1],y=t.shape.slice(0,-2),b=e.shape.slice(0,-2),v=p(y),x=p(b),w=Or(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,g]);c(d===f,(()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const S=n?[v,d,m]:[v,m,d],_=r?[x,g,f]:[x,f,g],k=zv({inputs:{x:t},backend:i,attrs:{shape:S}}),T=zv({inputs:{x:e},backend:i,attrs:{shape:_}}),E=[k,T],M=Math.max(v,x),C=n?k.shape[1]:k.shape[2],A=null!=s,N=null!=o,I="leakyrelu"===l,$=null!=l?Iv(l,!0):null;let R;if((1===m||1===g)&&C>1e3&&!1===(A||N||I||null!=$)){let t=k,e=T;n&&(t=Yv({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),E.push(t)),r&&(e=Yv({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),E.push(e));const s=1===g;let o=t;1!==g&&(o=zv({inputs:{x:t},backend:i,attrs:{shape:[M,C,1]}}),E.push(o));const a=1===g?2:1;let l=e;s&&(l=zv({inputs:{x:e},backend:i,attrs:{shape:[M,1,C]}}),E.push(l));const c=Dv({inputs:{a:o,b:l},backend:i});R=qv({inputs:{x:c},backend:i,attrs:{axis:a,keepDims:!0}}),E.push(c)}else{const l=Ne(t.dtype,e.dtype),c=new $v(S,_,[M,m,g],n,r,A,$,N,I),u=[k,T];if(null!=s&&u.push(s),N&&u.push(o),I){const t=i.makeTensorInfo([],"float32",ie(a,"float32"));u.push(t),E.push(t)}R=i.runWebGLProgram(c,u,l)}const O=zv({inputs:{x:R},backend:i,attrs:{shape:w}});E.push(R);for(const t of E)i.disposeIntermediateTensorInfo(t);return O}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jv={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;return Zv({a:i,b:s,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}},Qv="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tx={kernelName:"Abs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=Bb(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let i;return i=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new hv(r.shape,Qv):new cv(r.shape,Qv),n.runWebGLProgram(i,[r],r.dtype)}},ex={kernelName:"Acos",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},nx={kernelName:"Acosh",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},rx="return a + b;",ix={kernelName:"Add",backendName:"webgl",kernelFunc:Nv({opSnippet:rx,packedOpSnippet:rx,supportsComplex:!0,cpuKernelImpl:cb})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class sx{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ox{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ax={kernelName:"AddN",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,i=n;if(1===i.length)return vv({inputs:{x:i[0]},backend:r});if(i.length>X().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(i.length/2),n=t({inputs:i.slice(0,e),backend:r}),s=t({inputs:i.slice(e),backend:r});return t({inputs:[n,s],backend:r})}const s=i.map((t=>t.dtype)).reduce(((t,e)=>Ne(t,e))),o=i.map((t=>t.shape)),a=X().getBool("WEBGL_PACK")?new ox(i[0].shape,o):new sx(i[0].shape,o);return r.runWebGLProgram(a,i,s)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lx={kernelName:"All",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=x(s,i.shape);let c=l;const u=Xs(c,a);let h=i;null!=u&&(h=Yv({inputs:{x:i},backend:n,attrs:{perm:u}}),c=Ks(c.length,a)),qs("all",c,a);const[d,f]=Hs(h.shape,c),m=zv({inputs:{x:h},backend:n,attrs:{shape:[-1,p(f)]}}),g=jv(m,m.dtype,"all",n);let y;if(o){y=zv({inputs:{x:g},backend:n,attrs:{shape:Gs(d,l)}})}else y=zv({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx={kernelName:"Any",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=x(s,i.shape);let c=l;const u=Xs(c,a);let h=i;null!=u&&(h=Yv({inputs:{x:i},backend:n,attrs:{perm:u}}),c=Ks(c.length,a)),qs("any",c,a);const[d,f]=Hs(h.shape,c),m=zv({inputs:{x:h},backend:n,attrs:{shape:[-1,p(f)]}}),g=jv(m,m.dtype,"any",n);let y;if(o){y=zv({inputs:{x:g},backend:n,attrs:{shape:Gs(d,l)}})}else y=zv({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ux{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:s}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];const o="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${o} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hx{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,c(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=t[t.length-1],s=Math.ceil(i/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,a=o.length,l=Fy(a),u=nv("coords",a);let h,d;if(1===s){d=a+1;const t=Fy(d);h=`\n        ${t} sourceLocR = ${t}(${u.join()}, 0);\n        ++${u[a-1]};\n        ${t} sourceLocG = ${t}(${u.join()}, 0);\n        ++${u[a-2]};\n        ${t} sourceLocA = ${t}(${u.join()}, 0);\n        --${u[a-1]};\n        ${t} sourceLocB = ${t}(${u.join()}, 0);\n        --${u[a-2]};`}else d=a,h=`\n        ${l} sourceLocR = coords;\n        ++${u[a-1]};\n        ${l} sourceLocG = coords;\n        ++${u[a-2]};\n        ${l} sourceLocA = coords;\n        --${u[a-1]};\n        ${l} sourceLocB = coords;\n        --${u[a-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],m=p.map((t=>"int "+t)),g=nv("sourceLocR",d-1).concat("inIdx.r"),y=nv("sourceLocG",d-1).concat("inIdx.g"),b=nv("sourceLocB",d-1).concat("inIdx.b"),v=nv("sourceLocA",d-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,S=`vec4(\n            getAChannel(${g.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${b.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,_=r?"":`\n      float getBestIndicesAChannel(${m.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${m.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${u[a-1]} < ${o[a-1]-1};\n        bool hasNextRow = ${u[a-2]} < ${o[a-2]-1};\n        ${h}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${S};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${w}\n          vec4 candidate = ${S};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(t,e,n,r=null){let i=e.shape[0],s=e.shape[1];null!=r&&(i=r.shape[0],s=r.shape[1]);const o=xu(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},l=new ux(a,n,null==r),c=[e];null!=r&&c.push(r);const u=t.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const h=dx(t,e,n,u);return t.disposeIntermediateTensorInfo(u),h}function px(t,e,n,r=null){const i=null!=r?r.shape:e.shape,s=xu(i[i.length-1]),o=new hx(i,s,n,null==r),a=null==r?[e]:[e,r],l=t.runWebGLProgram(o,a,"int32");if(l.shape.length===e.shape.length){const r=px(t,e,n,l);return t.disposeIntermediateTensorInfo(l),r}return l}function fx(t,e,n,r){const i=[n];if(qs("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!X().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],s=t.texData.get(e.dataId);let o=e;null!==s&&s.isPacked&&(o=t.unpackTensor(e),n.push(o));const[a,l]=Hs(o.shape,i),c=p(l),u=zv({inputs:{x:o},backend:t,attrs:{shape:[-1,c]}});n.push(u);const h=dx(t,u,r);n.push(h);const d=zv({inputs:{x:h},backend:t,attrs:{shape:a}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),d}return px(t,e,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mx={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=x(s,i.shape);const a=Xs(o,i.shape.length);let l=i;const c=[];null!=a&&(l=Yv({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Ks(o.length,l.shape.length)),qs("argMax",[o[0]],l.shape.length);const u=fx(n,l,o[0],"max");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gx={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=x(s,i.shape);const a=Xs(o,i.shape.length);let l=i;const c=[];null!=a&&(l=Yv({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=Ks(o.length,l.shape.length)),qs("argMin",[o[0]],l.shape.length);const u=fx(n,l,o[0],"min");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}},yx={kernelName:"Asin",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},bx={kernelName:"Asinh",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},vx={kernelName:"Atan",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},xx={kernelName:"Atan2",backendName:"webgl",kernelFunc:Nv({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"})},wx={kernelName:"Atanh",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Sx{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,g=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${a});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${u};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / count");const v=4*Math.floor(s/4),x=s%4,w=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${u};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}class _x{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideDepth,a=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,u=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${a}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${u}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(x="avgValue / count");const w=4*Math.floor(s/4),S=s%4,_=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${a}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${v};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${v});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${_}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===S}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${_}\n            } else if (${2===S}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${_}\n            } else if (${3===S}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${_}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kx={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;vy(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;c(qi(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const u=Di(i.shape,s,o,1,a,l);if(1===u.filterWidth&&1===u.filterHeight&&f(u.inShape,u.outShape))return vv({inputs:{x:i},backend:n});const h=new Sx(u,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tx={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=Fi(i.shape,s,o,[1,1,1],a,l,c),h=new _x(u,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ex{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=a-1-t.padInfo.top,u=l-1-t.padInfo.left,h=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${u});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${o}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Mx{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=u-1-t.padInfo.front,f=h-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${u};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cx={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=Fi(o.shape,a,l,[1,1,1],c,u),d=new Mx(h);return n.runWebGLProgram(d,[i],o.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ax={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;vy([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Di(o.shape,a,l,1,c),h=new Ex(u);return n.runWebGLProgram(h,[i],o.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nx={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;return Zv({a:i,b:s,transposeA:o,transposeB:a,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ix{constructor(t,e,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Or(t,e),Or(t,n);let o="0.0";null!=r&&(Or(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="1.0";null!=i&&(Or(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $x{constructor(t,e,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Or(t,e),Or(t,n);let o="vec4(0.0)";null!=r&&(Or(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=i&&(Or(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rx={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=t;c(i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),c(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),c(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);const u=[r,i,s];let h=null;null!=o&&(h=o.shape,u.push(o));let d=null;null!=a&&(d=a.shape,u.push(a));const p=X().getBool("WEBGL_PACK_NORMALIZATION")?new $x(r.shape,i.shape,s.shape,h,d,l):new Ix(r.shape,i.shape,s.shape,h,d,l);return e.runWebGLProgram(p,u,u[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ox{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=Fy(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return Px.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let r;const i=t.map(((t,e)=>`sourceLoc.${Px[e]} = start[${e}] + coords.${Px[e]};`));r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${i.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const Px=["x","y","z","w","u","v"];class Lx{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=Fy(this.rank),n=nv("coords",this.rank),r=nv("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${o}\n        ${a}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dx(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r,[a,l]=ai(i,s,o);if(Yr(i,a,l),0===p(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const t=n.texData.get(i.dataId),e=Ub(t.values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,e)}const{isPacked:c}=n.texData.get(i.dataId),u=si(i.shape,a,l);if(c||!u){const t=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Lx(l):new Ox(l),e=[a];return n.runWebGLProgram(t,[i],i.dtype,e)}return n.uploadToGPU(i.dataId),function(t,e,n,r){const i=r.texData.get(t.dataId),s=r.makeTensorInfo(n,t.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=oi(e,L(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),s}(i,a,l,n)}const Fx={kernelName:"Slice",backendName:"webgl",kernelFunc:Dx},zx={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;c(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),l=Su(i.shape,s,a),u=_u(l.length,s.length),h=ku(i.shape,s,a),d=Tu(o,s.length),p=Eu(h,o,s.length),f=[],m=zv({inputs:{x:i},backend:n,attrs:{shape:l}}),g=Yv({inputs:{x:m},backend:n,attrs:{perm:u}}),y=zv({inputs:{x:g},backend:n,attrs:{shape:h}}),b=Dx({inputs:{x:y},backend:n,attrs:{begin:d,size:p}});return f.push(m),f.push(g),f.push(y),f.forEach((t=>n.disposeIntermediateTensorInfo(t))),b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bx={kernelName:"Bincount",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=n.readSync(i.dataId),l=n.readSync(s.dataId),c=ub(a,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux={kernelName:"BroadcastArgs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=Or(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},Vx=Nv({opSnippet:"return float(a != b);",cpuKernelImpl:$b,dtype:"bool"}),jx={kernelName:"NotEqual",backendName:"webgl",kernelFunc:Vx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wx(t){const{inputs:e,backend:n}=t,{input:r}=e;return vv({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const Hx={kernelName:"Real",backendName:"webgl",kernelFunc:Wx};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gx={kernelName:"Cast",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function t(e){const{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{dtype:o}=i;if("complex64"===o){if("complex64"===s.dtype)return vv({inputs:{x:s},backend:r});const e=Go(s.shape),n=t({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),i=wv({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===s.dtype){const e=Wx({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(e),n}if(!E(s.dtype,o)){const t=vv({inputs:{x:s},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:o}}if(r.shouldExecuteOnCPU([s])){const t=r.texData.get(s.dataId).values,[e,n,i]=db(t,s.shape,s.dtype,o);return r.makeTensorInfo(e,n,i)}if("int32"===o)return function(t,e){const n=new cv(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===o){const t=r.makeTensorInfo([],"bool",S("bool",1)),e=Vx({inputs:{a:s,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}},qx="return ceil(x);",Xx={kernelName:"Ceil",backendName:"webgl",kernelFunc:Av({opSnippet:qx,packedOpSnippet:qx,cpuKernelImpl:pb})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Yx{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kx{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zx={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:s,clipValueMax:o}=r;let a;a=X().getBool("WEBGL_PACK_CLIP")?new Kx(i.shape):new Yx(i.shape);const l=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,l)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jx{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qx(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const tw={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),s=new Jx(r.shape),o=[Qx(r,i.complexTensorInfos.real),Qx(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ew{constructor(t){this.outputShape=[],this.outputShape=fu(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const r=e.length,i=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nw{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=fu(t,e);const n=this.outputShape,r=n.length,i=Fy(r),s=nv("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let n=1;n<a.length;n++)a[n]=a[n-1]+t[n][e];const l=o[e],c=o.slice(-2),u=o.join();let h=`if (${l} < ${a[0]}) {\n        return getChannel(\n            getT0(${u}), vec2(${c.join()}));\n        }`;for(let t=1;t<a.length;t++){const e=a[t-1];h+=`\n        if (${l} < ${a[t]}  && ${l} >= ${a[t-1]}) {\n          return getChannel(\n            getT${t}(${rw(o,l,e)}),\n            vec2(${rw(c,l,e)}));\n        }`}const d=a.length,p=a[a.length-1];h+=`\n        return getChannel(\n          getT${d}(${rw(o,l,p)}),\n          vec2(${rw(c,l,p)}));`,this.userCode=`\n      float getValue(${o.map((t=>"int "+t))}) {\n        ${h}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function rw(t,e,n){const r=t.indexOf(e);return t.map(((t,e)=>e===r?`${t} - ${n}`:t)).join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iw(t){const{inputs:e,backend:n}=t,{input:r}=e;return vv({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const sw={kernelName:"Imag",backendName:"webgl",kernelFunc:iw};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ow(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>Wx({inputs:{input:t},backend:n}))),i=t.map((t=>iw({inputs:{input:t},backend:n}))),s=ow(r,e,n),o=ow(i,e,n),a=wv({inputs:{real:s,imag:o},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),i.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),a}let i=n.shouldExecuteOnCPU(t);if("string"===r&&(i=!0),i){const i=t.map((t=>{const r=p(t.shape.slice(e));return zv({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),s=i.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),o=fu(i.map((t=>t.shape)),1),a=1===i[0].shape[0],l=fb(s,o,r,a),c=fu(t.map((t=>t.shape)),e),u=n.makeTensorInfo(c,r,l);return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}const s=X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(t.length>s){const r=[];for(let i=0;i<t.length;i+=s){const o=t.slice(i,i+s);r.push(ow(o,e,n))}const i=ow(r,e,n);for(const t of r)n.disposeIntermediateTensorInfo(t);return i}if(X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const i=new nw(t.map((t=>t.shape)),e);return n.runWebGLProgram(i,t,r)}const{tensors2D:o,outShape:a}=function(t,e,n){const r=fu(t.map((t=>t.shape)),e);return{tensors2D:t.map((t=>zv({inputs:{x:t},attrs:{shape:[-1,p(t.shape.slice(e))]},backend:n}))),outShape:r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n),l=new ew(o.map((t=>t.shape))),c=n.runWebGLProgram(l,o,r);o.forEach((t=>n.disposeIntermediateTensorInfo(t)));const u=zv({inputs:{x:c},attrs:{shape:a},backend:n});return n.disposeIntermediateTensorInfo(c),u}function aw(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=x(i,e[0].shape)[0];pu(e.map((t=>t.shape)),s);const o=fu(e.map((t=>t.shape)),s);if(0===p(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>p(t.shape)>0));return 1===a.length?vv({inputs:{x:a[0]},backend:n}):ow(a,s,n)}const lw={kernelName:"Concat",backendName:"webgl",kernelFunc:aw};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cw{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const s=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,u=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",x="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${a}, ${l});\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class uw{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,u=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${s}, ${o});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${u}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hw{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Hy(this.outputShape.length);const s=t.padInfo.left,a=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,u=t.filterWidth,h=u;let d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<u;t++)d+=`\n           vec4 xTexelC${2*t};\n           int xTexelC${2*t}Ready;\n           vec4 xTexelC${2*t+1};\n           int xTexelC${2*t+1}Ready;\n           vec4 xC${t};`;d+=`\n     for (int r = 0; r < ${c}; r++) {\n      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {\n       `;for(let t=0;t<u;t++)d+=`\n           xTexelC${2*t} = vec4(0.0);\n           xTexelC${2*t}Ready = 0;\n           xTexelC${2*t+1} = vec4(0.0);\n           xTexelC${2*t+1}Ready = 0;\n           xC${t} = vec4(0.0);`;d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let e=0;e<(h+1)/2;e++){const n=2*e;if(d+=`\n           xC = xCCorner + ${n*l};\n           `,1===a){if(n<u&&(s%2==1?(d+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,d+=1===l&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):d+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<u)){const t=s%2==0?o(l):l;l%2==0&&s%2==1||l%2!=0&&s%2!=1?(d+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,d+=l>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):d+=1===t?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${t};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<u&&(s%2==1?(d+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<u&&(d+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(d+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<u&&(d+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<u&&(d+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${t.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<u&&(d+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${t.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:i?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,f="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${p}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${d}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${m}\n         ${f}\n         setOutput(result);\n       }\n     `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dw{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Hy(this.outputShape.length);const{dataFormat:n}=e,r=wy(),i="channelsLast"===n,s=i?1:2,o=i?2:3,a=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)l+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${t};\n\n          ${a}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${o}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${i}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${r.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pw(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&1===n&&t[0]>1?[t[0],1]:null}function fw({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,u=r.texData.get(t.dataId),h=n.inChannels,d=l[0]*l[1]*l[2],p=n.outChannels,m="channelsLast"===n.dataFormat;let g;const y=[];if(null!=s){const t=pw(s.shape,m);null!=t&&(s=zv({inputs:{x:s},backend:r,attrs:{shape:t}}),y.push(s))}if(null!=i){const t=pw(i.shape,m);null!=t&&(i=zv({inputs:{x:i},backend:r,attrs:{shape:t}}),y.push(i))}if(!((1===d||1===p)&&h>1e3)&&u.isPacked&&m&&null!=u.texture&&l[2]%2!=0&&f(u.shape.slice(-3),l.slice(-3))){const h=l[0]*l[1]*(l[2]+1),d={dataId:t.dataId,shape:[1,h,n.inChannels],dtype:t.dtype},p=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,c(dy(u.shape,d.shape),(()=>`packed reshape ${u.shape} to ${d.shape} isn't free`));const f=zv({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(f);const m=Zv({a:d,b:f,backend:r,transposeA:false,transposeB:false,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),b=r.texData.get(m.dataId);c(b.isPacked,(()=>"batchMatMul result is expected to be packed")),u.shape=p,b.shape=n.outShape,g=vv({inputs:{x:m},backend:r}),g.shape=n.outShape,y.push(m)}else{const l=n.outHeight*n.outWidth,c=zv({inputs:{x:t},backend:r,attrs:{shape:m?[n.batchSize,l,n.inChannels]:[n.batchSize,n.inChannels,l]}}),u=zv({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=Zv({a:m?c:u,b:m?u:c,transposeA:!m,transposeB:false,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});g=zv({inputs:{x:h},backend:r,attrs:{shape:n.outShape}}),y.push(c),y.push(u),y.push(h)}for(const t of y)r.disposeIntermediateTensorInfo(t);return g}function mw({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:h,outHeight:d,dataFormat:f}=n,m="channelsLast"===f,g=l*c*u,y=d*h,b=[n.batchSize,g,y],v=[];if(null!=s){const t=pw(s.shape,m);null!=t&&(s=zv({inputs:{x:s},backend:r,attrs:{shape:t}}),v.push(s))}if(null!=i){const t=pw(i.shape,m);null!=t&&(i=zv({inputs:{x:i},backend:r,attrs:{shape:t}}),v.push(i))}const x=zv({inputs:{x:e},backend:r,attrs:{shape:[1,g,p(e.shape)/g]}});v.push(x);const w=new dw(b,n),S=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(w,[t],"float32",S),k=zv({inputs:{x:_},backend:r,attrs:{shape:b}});v.push(_),v.push(k);const T=null!=i,E=null!=s,M="leakyrelu"===a,C=a?Iv(a,!0):null,A=new $v(m?k.shape:x.shape,m?x.shape:k.shape,m?[n.batchSize,y,n.outChannels]:[n.batchSize,n.outChannels,y],!0,!1,T,C,E,M),N=m?[k,x]:[x,k];if(i&&N.push(i),E&&N.push(s),M){const t=r.makeTensorInfo([],"float32",ie(o,"float32"));N.push(t),v.push(t)}const I=r.runWebGLProgram(A,N,"float32"),$=zv({inputs:{x:I},backend:r,attrs:{shape:n.outShape}});v.push(I);for(const t of v)r.disposeIntermediateTensorInfo(t);return $}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gw={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,h=Xi(l),d=zi(i.shape,s.shape,o,c,a,u,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&X().getBool("WEBGL_EXP_CONV")){const t=new hw(d),e=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(t,[i,s],"float32",e)}else if(X().getBool("WEBGL_CONV_IM2COL"))p=mw({x:i,filter:s,convInfo:d,backend:n});else{const t=new cw(d);p=n.runWebGLProgram(t,[i,s],"float32")}else p=fw({x:i,filter:s,convInfo:d,backend:n});const f=zv({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yw{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${s}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class bw{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s="channelsLast"===t.dataFormat,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,l=s?1:2,c=s?2:3,u=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${u}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class vw{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,s=t.padInfo.top,o=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${o};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class xw{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.front,l=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${l}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ww={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,h=Xi(l),d=zi(i.shape,u,o,1,a,c,!1,h),p=new yw(d);return n.runWebGLProgram(p,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sw={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,h=Xi(c),d=zi(o,s.shape,a,1,l,u,!1,h),p=new bw(d);return n.runWebGLProgram(p,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _w={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=Bi(i.shape,s.shape,o,l,a),u=new uw(c);return n.runWebGLProgram(u,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kw={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r,c=Bi(i.shape,l,o,1,a),u=new vw(c);return n.runWebGLProgram(u,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tw={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r,c=Bi(l,s.shape,a,1,o),u=new xw(c);return n.runWebGLProgram(u,[i,s],"float32")}},Ew=Av({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),Mw={kernelName:Q,backendName:"webgl",kernelFunc:Ew},Cw={kernelName:"Cosh",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Aw{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,o,a,l]=t,[c]=e,[u,h]=n;this.outputShape=[c,u,h,l];const d="bilinear"===r?1:0,[p,f]=[o-1+".0",a-1+".0"],[m,g,y]=u>1?[""+(o-1)/(u-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,v,x]=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nw={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,u=new Aw(i.shape,s.shape,a,l,c);return n.runWebGLProgram(u,[i,s,o],"float32")}};var Iw;!function(t){t.Prod="*",t.Sum="+"}(Iw||(Iw={}));class $w{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,s=this.op===Iw.Prod?"1.0":"0.0",o=n?s:`getX(${Rw(i,"coords",this.op)})`,a=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=r?"end != "+(a-1):"end != 0",c=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${a}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${Fy(i)} coords = getOutputCoords();\n        int end = ${Ow(i,"coords",this.op)};\n        float val = ${o};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${c};\n          ${Ow(i,"coords",this.op)} = idx;\n          val ${this.op}= getX(${Rw(i,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function Rw(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function Ow(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(t,e,n,r,i,s){const o=e.shape.length,a=Xs([r],o);let l=e;null!=a&&(l=Yv({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Ks(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const u=l.shape[c];let h=vv({inputs:{x:l},backend:n});for(let e=0;e<=Math.ceil(Math.log2(u))-1;e++){const r=new $w(t,l.shape,!1,s),i=[[e]],o=h;h=n.runWebGLProgram(r,[h],h.dtype,i),n.disposeIntermediateTensorInfo(o)}if(i){const e=new $w(t,l.shape,i,s),r=h;h=n.runWebGLProgram(e,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=a){const t=Yv({inputs:{x:h},backend:n,attrs:{perm:Ys(a)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),t}return h}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lw={kernelName:"Cumprod",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return Pw(Iw.Prod,i,n,s,o,a)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dw={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return Pw(Iw.Sum,i,n,s,o,a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fw={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=n.readSync(i.dataId),e=n.readSync(s.dataId),r=ub(t,e,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,r)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(s),r=hb(t,e,o,a);return n.makeTensorInfo(r.shape,s.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zw{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r,a=i.shape[0],l=("NHWC"===o?i.shape[1]:i.shape[2])*s,c=("NHWC"===o?i.shape[2]:i.shape[3])*s,u=("NHWC"===o?i.shape[3]:i.shape[1])/(s*s),h=new zw("NHWC"===o?[a,l,c,u]:[a,u,l,c],s,o);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uw{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Hy(this.outputShape.length);const s=t.filterHeight,o=t.filterWidth,a=t.outChannels/t.inChannels;let l="",c="";n&&(l=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const u=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${u}\n        ${c}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vw{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Hy(this.outputShape.length);const s=t.outChannels/t.inChannels,a=t.padInfo.left,l=t.strideWidth,c=t.dilationWidth,u=t.filterHeight,h=t.filterWidth,d=h;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<h;t++)p+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;p+=`\n    for (int r = 0; r < ${u}; r++) {\n      `;for(let t=0;t<h;t++)p+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(d+1)/2;t++){const e=2*t;if(p+=`\n          xC = xCCorner + ${e*c};\n          `,1===l){if(e<h&&(a%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,p+=1===c&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<h)){const t=a%2==0?o(c):c;c%2==0&&a%2==1||c%2!=0&&a%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,p+=c>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):p+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<h&&(a%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<h&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<h&&(p+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<h&&(p+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<h&&(p+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let f="",m="";n&&(f=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");const g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${f}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${g}\n        ${m}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jw={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;let h=l;null==h&&(h=[1,1]),c(qi(o,h),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`));const d=zi(i.shape,s.shape,o,h,a,u,!0);let p;p=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new Vw(d):new Uw(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(p,[i,s],"float32",f)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ww{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Hw{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.top,o=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gw={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,h=zi(i.shape,u,o,a,l,c,!0),d=new Ww(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,h=zi(u,s.shape,o,a,l,c,!0),d=new Hw(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xw{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw={kernelName:"Diag",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],s=p(r.shape),o=zv({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new Xw(s),l=n.runWebGLProgram(a,[o],o.dtype),c=zv({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kw{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:i,strideWidth:s,filterHeight:o,filterWidth:a,dilationHeight:l,dilationWidth:c}=t,{top:u,left:h}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${s});\n      const ivec2 pads = ivec2(${u}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${o}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zw={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=Li(i.shape,s.shape,o,a,"NHWC",l);let u;const h=new Kw(c);u=n.runWebGLProgram(h,[i,s],"float32");const d=zv({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jw={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=Du(i,s.length);zu(o.length,l,s);const{path:c,steps:u}=Bu(a,l),h=u.length;let d=null,p=o.length;const m=[];for(let t=0;t<h;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=Fu(p,l[e]);let i;Uu(t)?i=s[e]:(i=Yv({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),m.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);f(i.shape,o)||(i=zv({inputs:{x:i},backend:n,attrs:{shape:o}}),m.push(i)),null===d?d=i:(d=Dv({inputs:{a:i,b:d},backend:n}),m.push(d))}t<h-1&&(c[t]>=0&&(d=qv({inputs:{x:d},backend:n,attrs:{axis:c[t]-(o.length-p),keepDims:!1}}),m.push(d)),p--)}for(const t of m)t!==d&&n.disposeIntermediateTensorInfo(t);return d}},Qw={kernelName:"Elu",backendName:"webgl",kernelFunc:Av({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},tS={kernelName:"EluGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,s=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bv("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new yv("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)}},eS={kernelName:"Equal",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:mb})},nS=Av({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'}),rS={kernelName:tt,backendName:"webgl",kernelFunc:nS},iS=Av({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:gb,dtype:"float32"}),sS={kernelName:et,backendName:"webgl",kernelFunc:iS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function oS(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(c(-(o+1)<=i,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),l=o+i+1),a.splice(l,0,1),zv({inputs:{x:s},backend:r,attrs:{shape:a}})}const aS={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:oS},lS="return exp(x) - 1.0;",cS={kernelName:"Expm1",backendName:"webgl",kernelFunc:Av({opSnippet:lS,packedOpSnippet:lS,cpuKernelImpl:yb})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class uS{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0";let o;if("real"===t)o="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hS(t,e,n){const r=n.texData.get(t.dataId),i=p(t.shape),s=t.shape[t.shape.length-1],o=zv({inputs:{x:t},backend:n,attrs:{shape:[i/s,s]}}),a=o.shape,l=new uS("real",a,e),c=new uS("imag",a,e),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:a},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:a}],h=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(c,u,"float32"),f=wv({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const m=zv({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),m}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS={kernelName:"FFT",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return hS(r,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pS{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fS(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||R(i),"string"===s){const t=_(s,p(r));return t.fill(i),e.makeTensorInfo(r,s,t)}{const t=new pS(r,i),n=[[i]];return e.runWebGLProgram(t,[],s,n)}}const mS={kernelName:"Fill",backendName:"webgl",kernelFunc:fS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gS{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yS={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new gS(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},bS="return floor(x);",vS={kernelName:"Floor",backendName:"webgl",kernelFunc:Av({opSnippet:bS,packedOpSnippet:bS,cpuKernelImpl:bb})},xS={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:Nv({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class wS{constructor(t){this.variableNames=["A"];const e=wy(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SS{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=wy(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _S={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,c]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[c,l],h=[c,l,s];if(a||o){const t=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=kS&&t===TS||(TS=t,kS=document.createElement("canvas").getContext("2d",{willReadFrequently:TS})),kS.canvas.width=l,kS.canvas.height=c,kS.drawImage(i,0,0,l,c),i=kS.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=Wg.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const p=X().getBool("WEBGL_PACK")?new SS(h):new wS(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let kS,TS=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const ES={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=Xi(u),g=zi(i.shape,s.shape,l,h,c,d,!1,m);let y;const b=[],v=null!=o,x=null!=a,w="leakyrelu"===p,S=()=>{const t=[i,s],e=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=zv({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return b.push(e),e}return t};if(v&&t.push(e(o,u)),x&&t.push(e(a,u)),w){const e=n.makeTensorInfo([],"float32",ie(f,"float32"));t.push(e),b.push(e)}return t};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&X().getBool("WEBGL_EXP_CONV")){const t=p?Iv(p,!0):null,e=new hw(g,v,t,x,w),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],i=S();y=n.runWebGLProgram(e,i,"float32",r)}else if(X().getBool("WEBGL_CONV_IM2COL"))y=mw({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const t=p?Iv(p,!1):null,e=new cw(g,v,t,x,w),r=S();y=n.runWebGLProgram(e,r,"float32")}else y=fw({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});const _=zv({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),_}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MS={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[];let g=h;null==g&&(g=[1,1]),c(qi(l,g),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`));const y=zi(i.shape,s.shape,l,g,u,d,!0),b=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,v=p?Iv(p,b):null,x=[i,s],w=null!=o,S=null!=a,_="leakyrelu"===p;if(w&&x.push(o),S&&x.push(a),_){const t=n.makeTensorInfo([],"float32",ie(f,"float32"));x.push(t),m.push(t)}let k;k=b?new Vw(y,w,v,S,_):new Uw(y,w,v,S,_);const T=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],E=n.runWebGLProgram(k,x,"float32",T);return m.forEach((t=>n.disposeIntermediateTensorInfo(t))),E}};class CS{constructor(t,e,n,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=Fy(n.length);let s="\n    int index;";for(let t=0;t<this.sliceDim;t++)s+=`\n          index = round(getIndices(coords[0], ${t}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[t]};\n          flattenIndex += index * ${this.strides[t]};`;this.userCode=`\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${s}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AS={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=i.shape,o=s[s.length-1],a=p(r.shape),[l,c,u,h]=jr(r,i),d=zv({inputs:{x:i},backend:n,attrs:{shape:[c,o]}}),f=zv({inputs:{x:r},backend:n,attrs:{shape:[p(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const t=n.readSync(i.dataId),e=n.bufferSync(r),s=vb(t,e,r.dtype,c,o,u,h,r.shape,a);return n.makeTensorInfo(l,r.dtype,s.values)}const m=new CS(o,h,[c,u],r.shape),g=n.runWebGLProgram(m,[f,d],f.dtype),y=zv({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NS{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=Fy(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function IS(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r,l=x(o,i.shape)[0];if(X().get("DEBUG")){const t=n.readSync(s.dataId),e=i.shape[l];for(let n=0;n<t.length;++n){const r=t[n];c(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const u=ih(i,s,l,a),h=p(s.shape),d=[],f=zv({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),m=zv({inputs:{x:s},backend:n,attrs:{shape:[u.batchSize,h/u.batchSize]}});d.push(f),d.push(m);const g=[u.batchSize,u.outerSize,h/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){const t=n.bufferSync(m),e=n.bufferSync(f),r=xb(e,t,g);return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u.outputShape,r.dtype,r.values)}const y=new NS(f.shape,g),b=n.runWebGLProgram(y,[f,m],f.dtype);d.push(b);const v=zv({inputs:{x:b},backend:n,attrs:{shape:u.outputShape}});return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}const $S={kernelName:"GatherV2",backendName:"webgl",kernelFunc:IS},RS={kernelName:"Greater",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:wb,dtype:"bool"})},OS={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Sb})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PS={kernelName:"IFFT",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{input:r}=e;return hS(r,!0,n)}},LS={kernelName:"IsFinite",backendName:"webgl",kernelFunc:Av({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},DS={kernelName:"IsInf",backendName:"webgl",kernelFunc:Av({opSnippet:"return float(isinf(x));",dtype:"bool"})},FS={kernelName:"IsNan",backendName:"webgl",kernelFunc:Av({opSnippet:"return float(isnan(x));",dtype:"bool"})},zS={kernelName:"Less",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:_b,dtype:"bool"})},BS={kernelName:"LessEqual",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:kb,dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const US={kernelName:"LinSpace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=Tb(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},VS=Av({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:Eb}),jS={kernelName:nt,backendName:"webgl",kernelFunc:VS},WS={kernelName:"Log1p",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"})},HS={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},GS={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:Av({opSnippet:"return float(!(x >= 1.0));"})},qS={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:Nv({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class XS{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YS{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS={kernelName:"LRN",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r,c=X().getBool("WEBGL_PACK_NORMALIZATION")?new YS(i.shape,s,o,a,l):new XS(i.shape,s,o,a,l);return n.runWebGLProgram(c,[i],i.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ZS{constructor(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JS={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r,h=new ZS(i.shape,a,l,c,u);return n.runWebGLProgram(h,[i,s,o],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function QS(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,l=x(s,i.shape);let c=l;const u=Xs(c,a),h=null!=u,d=n.shouldExecuteOnCPU([i]);let f=i;if(h){if(d){const t=n.texData.get(f.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=i.shape[u[t]];const r=Qb(t,i.shape,i.dtype,u,e);f=n.makeTensorInfo(e,i.dtype);n.texData.get(f.dataId).values=r}else f=Gv(i,u,n);c=Ks(c.length,a)}qs("max",c,a);const[m,g]=Hs(f.shape,c);let y,b=m;if(o&&(b=Gs(m,l)),d){const t=n.texData.get(f.dataId).values,e=Mb(t,p(g),b,i.dtype);y=n.makeTensorInfo(b,i.dtype);n.texData.get(y.dataId).values=e}else y=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const i=p(e),s=zv({inputs:{x:t},attrs:{shape:[p(t.shape)/i,i]},backend:r}),o=jv(s,t.dtype,"max",r),a=zv({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(f,g,b,n);return h&&n.disposeIntermediateTensorInfo(f),y}const t_={kernelName:"Max",backendName:"webgl",kernelFunc:QS},e_={kernelName:"Maximum",backendName:"webgl",kernelFunc:Nv({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Cb})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_={kernelName:"MaxPool",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;vy(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;c(qi(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const u=Di(i.shape,s,o,1,a,l);if(1===u.filterWidth&&1===u.filterHeight&&f(u.inShape,u.outShape))return vv({inputs:{x:i},backend:n});const h=new Sx(u,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=Fi(i.shape,s,o,[1,1,1],a,c,l),h=new _x(u,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i_{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,s=t.effectiveFilterWidth,o=i-1-t.padInfo.top,a=s-1-t.padInfo.left,l=i*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class s_{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=a-1-t.padInfo.front,h=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=a*l*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${u}, ${h}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${o}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=Fi(o.shape,a,l,[1,1,1],c,u),d=new _x(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),f=new s_(h),m=n.runWebGLProgram(f,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;vy([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=Di(a.shape,l,c,1,u,h),p=new Sx(d,"max",!0),f=n.runWebGLProgram(p,[a],a.dtype),m=new i_(d),g=n.runWebGLProgram(m,[i,f],a.dtype);return n.disposeIntermediateTensorInfo(f),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const l_={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;c(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const u=[1,1];c(qi(s,u),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`));const h=Di(r.shape,i,s,u,o),[d,p]=function(t,e,n,r){let i=new Sx(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");return i=new Sx(n,"max",!0,!0,e),[s,r.runWebGLProgram(i,[t],"float32")]}(r,a,h,l);return[d,p]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const c_={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:s}=e,o=n,a=r.shape.length,l=x(s,r.shape);let c=l;const u=Xs(c,a),h=null!=u,d=o.shouldExecuteOnCPU([r]),f=[];let m=r;if(h){if(d){const t=o.texData.get(m.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=r.shape[u[t]];const n=Qb(t,r.shape,r.dtype,u,e);m=o.makeTensorInfo(e,r.dtype);o.texData.get(m.dataId).values=n}else m=Gv(r,u,o);f.push(m),c=Ks(c.length,a)}qs("sum",c,a);const[g,y]=Hs(m.shape,c);let b=g;i&&(b=Gs(g,l));const v=function(t,e,n,r){const i=p(e),s=zv({inputs:{x:t},attrs:{shape:[p(t.shape)/i,i]},backend:r}),o=jv(s,"float32","mean",r),a=zv({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(m,y,b,o);for(const t of f)o.disposeIntermediateTensorInfo(t);return v}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:"Min",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=x(s,i.shape);let c=l;const u=Xs(c,a);let h=i;null!=u&&(h=Yv({inputs:{x:i},backend:n,attrs:{perm:u}}),c=Ks(c.length,i.shape.length)),qs("min",c,a);const[d,f]=Hs(h.shape,c),m=zv({inputs:{x:h},backend:n,attrs:{shape:[-1,p(f)]}}),g=jv(m,m.dtype,"min",n);let y;if(o){y=zv({inputs:{x:g},backend:n,attrs:{shape:Gs(d,l)}})}else y=zv({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}},h_={kernelName:"Minimum",backendName:"webgl",kernelFunc:Nv({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Ab})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class d_{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Fy(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p_{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Fy(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=nv("rc",r),l=nv("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,h="reflect"===n?0:1;let d="";if(1===r){const t=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n      `}else{const t=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n        rc = outputLoc;\n        ${a[r-2]} += 1;\n        if(${a[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${l.join()}), ${u});\n          ${a[r-1]} += 1;\n          if(${c}) {\n            ${t}\n            result[3] = getChannel(getX(${l.join()}), ${u});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:s}=n,o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p_(r.shape,i,s):new d_(r.shape,i,s);return e.runWebGLProgram(o,[r],r.dtype)}},m_=Nv({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),g_={kernelName:rt,backendName:"webgl",kernelFunc:m_};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class y_{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_=Nv({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),v_={kernelName:"RealDiv",backendName:"webgl",kernelFunc:b_},x_="return a - b;",w_=Nv({opSnippet:x_,packedOpSnippet:x_,supportsComplex:!0,cpuKernelImpl:Kb}),S_={kernelName:ot,backendName:"webgl",kernelFunc:w_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function __(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=x([s],i.shape),a=QS({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=Gs(a.shape,o),c=zv({inputs:{x:a},backend:n,attrs:{shape:l}}),u=w_({inputs:{a:i,b:c},backend:n}),h=iS({inputs:{x:u},backend:n}),d=qv({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=zv({inputs:{x:d},backend:n,attrs:{shape:l}}),f=b_({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const k_={kernelName:"Softmax",backendName:"webgl",kernelFunc:__};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r,l=a?i:__({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new y_(c,u,s),d=[[o]],p=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_={kernelName:"Neg",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,i]=Ib(t.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,e)}let i;return i=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new hv(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new cv(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(i,[r],r.dtype)}},M_=hc;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(t){lt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,c=n.readSync(i.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=M_(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},A_=dc;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(t){lt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=A_(u,h,o,a,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},I_=pc;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $_={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){lt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),d=o,p=a,f=l,m=c,{selectedIndices:g,selectedScores:y}=I_(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R_{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_={kernelName:"OneHot",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:l}=r,c=p(i.shape),u=new R_(c,o,a,l),h=zv({inputs:{x:i},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);const f=zv({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,o]}});return n.disposeIntermediateTensorInfo(d),f}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function P_(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=Wx({inputs:{input:r},backend:n}),e=P_({inputs:{x:t},backend:n}),i=iw({inputs:{input:r},backend:n}),s=P_({inputs:{x:i},backend:n}),o=wv({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return fS({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const L_={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:P_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const e=Wx({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=iw({inputs:{input:i},backend:r}),o=P_({inputs:{x:s},backend:r}),a=wv({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return fS({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_={kernelName:"Pack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return oS({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{u(s,t.shape,"All tensors passed to stack must have matching shapes"),c(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],l=aw({inputs:e.map((t=>{const e=oS({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z_{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Fy(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B_{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Fy(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=nv("rc",r),l=nv("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${a[r-1]} += 1;\n       if(${c}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${c}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===r?2:4;t<e;t++)p+=`\n        ${h[t]}\n        if (${d}) {\n          result[${t}] = float(value);\n        } else {\n          ${i} source = rc - start;\n          result[${t}] = getChannel(getX(${l.join()}), ${u});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;if(0===p(i.shape)){const t=s.map(((t,e)=>t[0]+i.shape[e]+t[1]));return fS({backend:n,attrs:{shape:t,value:o,dtype:i.dtype}})}const a=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B_(i.shape,s,o):new z_(i.shape,s,o),l=[[o]];return n.runWebGLProgram(a,[i],i.dtype,l)},V_={kernelName:"PadV2",backendName:"webgl",kernelFunc:U_},j_=Nv({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),W_={kernelName:it,backendName:"webgl",kernelFunc:j_};const H_={kernelName:"Prod",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=[],c=x(s,i.shape);let u=c;const h=Xs(u,a);let d,f=i;if(null!=h&&(f=Yv({inputs:{x:i},backend:n,attrs:{perm:h}}),u=Ks(u.length,a),l.push(f)),qs("prod",u,a),n.shouldExecuteOnCPU([f])){const t=n.texData.get(f.dataId).values,{outVals:e,outShape:r,outDtype:i}=Rb(f.shape,f.dtype,t,u);d=n.makeTensorInfo(r,i,e)}else{const[t,e]=Hs(f.shape,u),r=p(e),s=zv({inputs:{x:f},backend:n,attrs:{shape:[-1,r]}}),o=jv(s,Ie(i.dtype),"prod",n);d=zv({inputs:{x:o},backend:n,attrs:{shape:t}}),l.push(s),l.push(o)}if(o){l.push(d);const t=Gs(d.shape,c);d=zv({inputs:{x:d},backend:n,attrs:{shape:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_={kernelName:"RaggedGather",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,{outputRaggedRank:a}=r,l=i.map((t=>n.readSync(t.dataId))),c=i.map((t=>t.shape)),u=n.readSync(s.dataId),h=n.readSync(o.dataId),[d,p,f]=Ob(l,c,u,s.shape,s.dtype,h,o.shape,a),m=d.map((t=>n.makeTensorInfo([t.length],"int32",t))),g=n.makeTensorInfo(f,s.dtype,p);return m.concat([g])}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_={kernelName:"RaggedTensorToTensor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=n.readSync(i.dataId),u=n.readSync(s.dataId),h=n.readSync(o.dataId),d=a.map((t=>n.readSync(t.dataId))),p=a.map((t=>t.shape)),[f,m]=Pb(c,i.shape,u,s.shape,s.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}},X_=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:s,dtype:o}=n,a=Lb(r,i,s,o);return e.makeTensorInfo([a.length],o,a)},Y_={kernelName:"Range",backendName:"webgl",kernelFunc:X_},K_={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:Av({opSnippet:"return 1.0 / x;"})},Z_={kernelName:"Relu",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},J_={kernelName:"Relu6",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Q_{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tk{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ek={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tk(i.shape,l,c,s,o):new Q_(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nk{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],c=a[0]/l[0],u=a[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rk={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new nk(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ik{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sk{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ok={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new sk(i.shape,l,c,s,o):new ik(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],i.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ak{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],c=a[0]/l[0],u=a[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lk={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new ak(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ck{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),i=Fy(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uk{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=nv("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=Fy(n);function a(n){const r=t.map(((r,i)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(i,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return a(t)}(r.slice())};\n          if(${i}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",a(t)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hk={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r,o=i.shape.length,a=x(s,i.shape);if(0===o)return vv({inputs:{x:i},backend:n});const l=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uk(i.shape,a):new ck(i.shape,a);return n.runWebGLProgram(l,[i],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dk{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let i="";i="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${i}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pk={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=new dk(r.shape,s),[c,u]=wu(o,r.shape[1],r.shape[2]),h=[[c,u,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(l,[r],r.dtype,h)}},fk={kernelName:"Round",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},mk={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:Av({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Db})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class gk{constructor(t,e,n,r,i,s,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const a=Fy(i.length),l=Fy(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const u=`getIndices(${c})`;let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d=`getUpdates(${h})`,p=e>1?"strides[j]":"strides";this.userCode=`\n        ${a} strides = ${a}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${u});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${d};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yk={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=qr(0,i,o),d=[h/c,c];if(0===h)return n.makeTensorInfo(o,i.dtype);const p=zv({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),f=zv({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new gk(l,a,p.shape.length,f.shape.length,u,d),y=n.runWebGLProgram(g,[f,p,m],f.dtype),b=zv({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bk{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,s=2===X().getNumber("WEBGL_VERSION")?"while (left < right) {":i,o="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${s}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${o} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vk={kernelName:"SearchSorted",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=new bk(i.shape[0],i.shape[1],s.shape[1],o),l=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",l)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xk{constructor(t,e,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],o=[];for(let r=0;r<e.length;r++)o.push(`${n[r]}`),r<t&&s.push(`${n[r]}`);r=s.join(),i=o.join()}const s=Fy(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wk={kernelName:"Select",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e,o=new xk(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],Ne(i.dtype,s.dtype))}},Sk={kernelName:"Selu",backendName:"webgl",kernelFunc:Av({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ${Mu};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`})},_k={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:Av({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:zb})},kk={kernelName:"Sign",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},Tk=Av({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),Ek={kernelName:st,backendName:"webgl",kernelFunc:Tk},Mk={kernelName:"Sinh",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},Ck={kernelName:"Softplus",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},Ak={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;c(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),l=[[0,0]];l.push(...o);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const u=[],h=U_({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),d=Su(h.shape,s,a,!1),p=_u(d.length,s.length,!1),f=ku(h.shape,s,a,!1),m=zv({inputs:{x:h},backend:n,attrs:{shape:d}}),g=Yv({inputs:{x:m},backend:n,attrs:{perm:p}}),y=zv({inputs:{x:g},backend:n,attrs:{shape:f}});return u.push(h),u.push(m),u.push(g),u.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nk={kernelName:"SparseFillEmptyRows",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n         ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,d,p,f,m]=Vb(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ik={kernelName:"SparseReshape",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,h]=jb(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $k={kernelName:"SparseSegmentMean",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=Wb(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rk={kernelName:"SparseSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=Wb(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=qr(0,i,a);if("string"===s.dtype){const t=n.bufferSync(i),e=n.bufferSync(s),r=le(n.readSync(o.dataId)[0]),p=Fb(t,e,a,d,u,c,l,h,r,false);return n.makeTensorInfo(a,p.dtype,p.values)}const p=new gk(c,l,i.shape.length,s.shape.length,h,[d,1],false),f=n.runWebGLProgram(p,[s,i,o],s.dtype),m=zv({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(f),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pk={kernelName:"SplitV",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=x(o,i.shape)[0],l=ju(i,s,a),c=i.shape.length,u=new Array(c).fill(0),h=i.shape.slice();return l.map((t=>{const e=[...h];e[a]=t;const r=Dx({inputs:{x:i},backend:n,attrs:{begin:u,size:e}});return u[a]+=t,r}))}},Lk="return sqrt(x);",Dk={kernelName:"Sqrt",backendName:"webgl",kernelFunc:Av({opSnippet:Lk,packedOpSnippet:Lk,cpuKernelImpl:Hb})},Fk={kernelName:"Square",backendName:"webgl",kernelFunc:Av({opSnippet:"return x * x;"})},zk={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:Nv({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bk={kernelName:"Step",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,s=new cv(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uk{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=Fy(n.length),s=Fy(n.length);let o="";if(1===r)o="coords * strides + begin";else{let t=0;o=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:v,end:x,strides:w}=li(i.shape,s,o,a,l,u,h,d,p);let S;if(g)S=zv({inputs:{x:i},backend:n,attrs:{shape:m}});else if(y||b){c(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=Kr(v,x,w),e=Dx({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});S=zv({inputs:{x:e},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([i])){const t=n.readSync(i.dataId),e=Xn(i.shape,i.dtype,t),r=Gb(f,e,w,v);S=n.makeTensorInfo(m,i.dtype,r.values)}else{const t=new Uk(v,w,f);S=n.runWebGLProgram(t,[i],i.dtype)}}const _=zv({inputs:{x:S},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(S),_}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jk={kernelName:"StringNGrams",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,d=n.readSync(u.dataId),p=n.readSync(h.dataId),[f,m]=qb(d,p,i,s,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wk={kernelName:"StringSplit",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId)[0],[c,u,h]=Xb(a,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hk={kernelName:"StringToHashBucketFast",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=Yb(o,i);return n.makeTensorInfo(s.shape,"int32",a)}},Gk=Av({opSnippet:"return tan(x);"}),qk={kernelName:at,backendName:"webgl",kernelFunc:Gk},Xk={kernelName:"Tanh",backendName:"webgl",kernelFunc:Av({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Yk{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const r=Fy(this.rank),i=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let e=0;e<t.length;e++)r.push(`imod(${n[e]}, ${t[e]})`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function Kk(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;if("string"===i.dtype||i.shape.length>5){const t=n.readSync(i.dataId),e="string"===i.dtype?t.map((t=>le(t))):t,r=Xn(i.shape,i.dtype,e),o=Zb(r,s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new Yk(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const Zk={kernelName:"Tile",backendName:"webgl",kernelFunc:Kk};class Jk{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class Qk{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tT(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function eT(t){let e=1;for(;e<t;)e*=2;return e}const nT={kernelName:"TopK",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r,a=X().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=X().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([i])||u<a||s>l){const t=n.readSync(i.dataId),[e,r]=Jb(t,c,i.dtype,s,o);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===s)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[i,fS({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(i.dataId),d=null!==h&&h.isPacked,f=d?n.unpackTensor(i):i,m=p(c)/u,g=zv({inputs:{x:f},attrs:{shape:[m,u]},backend:n});d&&tT(n,f);const y=eT(s),b=eT(u);let v=null;const x=()=>null===v?[g,g]:[g,v],w=(t,e,r)=>{const i=x(),s=new Jk(r),o=[[u],[null===v?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],a=v;v=n.runWebGLProgram(s,i,"int32",o),tT(n,a)};for(let t=1;t<y;t*=2){const e=2*t;for(let n=t;n>=1;n/=2)w(e,n,[m,b])}for(let t=b;t>y;t/=2){const e=x(),r=new Qk([m,t/2]),i=[[u],[null===v?1:0],[y]],s=v;v=n.runWebGLProgram(r,e,"int32",i),tT(n,s);const o=y/2,a=2*o;for(let t=o;t>=1;t/=2)w(a,t,v.shape)}let S=v;v=Dx({inputs:{x:v},backend:n,attrs:{begin:0,size:[m,s]}}),tT(n,S);let _=IS({inputs:{x:g,indices:v},backend:n,attrs:{axis:1,batchDims:1}});tT(n,g);const k=c.slice(0,-1);k.push(s),S=v,v=zv({inputs:{x:v},attrs:{shape:k},backend:n}),tT(n,S);const T=_;return _=zv({inputs:{x:_},attrs:{shape:k},backend:n}),tT(n,T),[_,v]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rT{constructor(t,e,n,r,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const o="nearest"===n?1:2;let a;switch(r){case"constant":default:a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${a} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${i});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${i});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${o} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iT={kernelName:"Transform",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=r,[u,h,d,p]=i.shape,[f,m]=null!=c?c:[h,d],g=new rT(h,d,o,a,l,[u,f,m,p]);return n.runWebGLProgram(g,[i,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sT={kernelName:"Unique",backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;vy(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:l,indices:c}=tv(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oT={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,l=i.shape[s],c=new Array(a-1);let u=0;for(let t=0;t<a;t++)t!==s&&(c[u++]=o.shape[t]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[s]=1;const f=new Array(l);for(let t=0;t<f.length;t++){d[s]=t;const e=Dx({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),r=zv({inputs:{x:e},backend:n,attrs:{shape:c}});f[t]=r,h.push(e)}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aT{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=t.numSegments,o=s*Math.ceil(i/n);this.outputShape=[r,o];const a=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";i%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let h="";i%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${c}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${c}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${c}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lT={kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r,a=i.shape.length,l=[];let c=0;const u=Xs([c],a);let h=i;null!=u&&(h=Yv({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(h),c=Ks(1,a)[0]);const d=rh(h.shape,c,o),f=p([h.shape[c]]),m=zv({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});l.push(m);const g=Ie(i.dtype),y=(t,e,r,i,s)=>{const o=t.shape[0],a=t.shape[1],c=nh(a,s),u=new aT({windowSize:c,inSize:a,batchSize:o,numSegments:s},e),h=n.compileAndRun(u,[t,r],i);if(l.push(h),h.shape[1]===s)return h;const d=X_({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=Kk({inputs:{x:d},backend:n,attrs:{reps:[a/c]}});l.push(d),l.push(p);return y(h,e,p,i,s)},b=zv({inputs:{x:y(m,"unsortedSegmentSum",s,g,o)},backend:n,attrs:{shape:d}});let v=b;if(null!=u){l.push(b);const t=Ys(u);v=Yv({inputs:{x:v},backend:n,attrs:{perm:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}},cT=[Jv,tx,ex,nx,ix,ax,lx,cx,mx,gx,yx,bx,vx,xx,wx,kx,Tx,Cx,Ax,Nx,Rx,zx,Bx,Ux,Gx,Xx,Zx,Sv,tw,lw,gw,ww,Sw,_w,kw,Tw,Mw,Cw,Nw,Lw,Dw,Fw,Bw,jw,Gw,qw,Yw,Zw,Jw,Qw,tS,eS,rS,sS,aS,cS,dS,mS,yS,vS,xS,_S,ES,MS,AS,$S,RS,OS,xv,PS,sw,LS,DS,FS,Tv,zS,BS,US,jS,WS,HS,GS,qS,KS,JS,t_,e_,n_,r_,o_,a_,l_,c_,u_,h_,f_,g_,T_,Fv,E_,C_,N_,$_,jx,O_,D_,F_,V_,W_,Cv,H_,G_,q_,Y_,Hx,v_,K_,Z_,J_,Bv,ek,rk,ok,lk,hk,pk,fk,mk,yk,vk,wk,Sk,_k,kk,Ek,Mk,Fx,k_,Ck,Ak,Nk,Ik,$k,Rk,Ok,Pk,Dk,Fk,zk,Bk,Vk,jk,Wk,Hk,S_,Xv,qk,Xk,Zk,nT,iT,Kv,sT,oT,lT,L_];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of cT)ft(t);function uT(){}const hT=t=>t;function dT(t){return t()}function pT(){return Object.create(null)}function fT(t){t.forEach(dT)}function mT(t){return"function"==typeof t}function gT(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let yT;function bT(t,e){return yT||(yT=document.createElement("a")),yT.href=e,t===yT.href}function vT(t,...e){if(null==t)return uT;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function xT(t){let e;return vT(t,(t=>e=t))(),e}function wT(t,e,n){t.$$.on_destroy.push(vT(e,n))}function ST(t,e,n,r){if(t){const i=_T(t,e,n,r);return t[0](i)}}function _T(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function kT(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|i[r];return t}return e.dirty|i}return e.dirty}function TT(t,e,n,r,i,s){if(i){const o=_T(e,n,r,s);t.p(o,i)}}function ET(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}const MT="undefined"!=typeof window;let CT=MT?()=>window.performance.now():()=>Date.now(),AT=MT?t=>requestAnimationFrame(t):uT;const NT=new Set;function IT(t){NT.forEach((e=>{e.c(t)||(NT.delete(e),e.f())})),0!==NT.size&&AT(IT)}function $T(t){let e;return 0===NT.size&&AT(IT),{promise:new Promise((n=>{NT.add(e={c:t,f:n})})),abort(){NT.delete(e)}}}function RT(t,e){t.appendChild(e)}function OT(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function PT(t){const e=zT("style");return function(t,e){RT(t.head||t,e),e.sheet}(OT(t),e),e.sheet}function LT(t,e,n){t.insertBefore(e,n||null)}function DT(t){t.parentNode.removeChild(t)}function FT(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function zT(t){return document.createElement(t)}function BT(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function UT(t){return document.createTextNode(t)}function VT(){return UT(" ")}function jT(){return UT("")}function WT(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function HT(t){return function(e){return e.preventDefault(),t.call(this,e)}}function GT(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function qT(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:GT(t,e,n)}function XT(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function YT(t,e){t.value=null==e?"":e}function KT(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function ZT(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}let JT;function QT(){if(void 0===JT){JT=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){JT=!0}}return JT}function tE(t,e,n){t.classList[n?"add":"remove"](e)}function eE(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}class nE{constructor(t=!1){this.is_svg=!1,this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){this.e||(this.is_svg?this.e=BT(e.nodeName):this.e=zT(e.nodeName),this.t=e,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)LT(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(DT)}}const rE=new Map;let iE,sE=0;function oE(t,e,n,r,i,s,o,a=0){const l=16.666/r;let c="{\n";for(let t=0;t<=1;t+=l){const r=e+(n-e)*s(t);c+=100*t+`%{${o(r,1-r)}}\n`}const u=c+`100% {${o(n,1-n)}}\n}`,h=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${a}`,d=OT(t),{stylesheet:p,rules:f}=rE.get(d)||function(t,e){const n={stylesheet:PT(e),rules:{}};return rE.set(t,n),n}(d,t);f[h]||(f[h]=!0,p.insertRule(`@keyframes ${h} ${u}`,p.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${h} ${r}ms linear ${i}ms 1 both`,sE+=1,h}function aE(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),i=n.length-r.length;i&&(t.style.animation=r.join(", "),sE-=i,sE||AT((()=>{sE||(rE.forEach((t=>{const{ownerNode:e}=t.stylesheet;e&&DT(e)})),rE.clear())})))}function lE(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i="none"===r.transform?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function cE(t){iE=t}function uE(){if(!iE)throw new Error("Function called outside component initialization");return iE}function hE(t){uE().$$.on_mount.push(t)}function dE(t){uE().$$.after_update.push(t)}function pE(t){uE().$$.on_destroy.push(t)}function fE(){const t=uE();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=eE(e,n,{cancelable:r});return i.slice().forEach((e=>{e.call(t,s)})),!s.defaultPrevented}return!0}}function mE(t){return uE().$$.context.get(t)}function gE(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const yE=[],bE=[],vE=[],xE=[],wE=Promise.resolve();let SE=!1;function _E(){SE||(SE=!0,wE.then(NE))}function kE(){return _E(),wE}function TE(t){vE.push(t)}function EE(t){xE.push(t)}const ME=new Set;let CE,AE=0;function NE(){const t=iE;do{for(;AE<yE.length;){const t=yE[AE];AE++,cE(t),IE(t.$$)}for(cE(null),yE.length=0,AE=0;bE.length;)bE.pop()();for(let t=0;t<vE.length;t+=1){const e=vE[t];ME.has(e)||(ME.add(e),e())}vE.length=0}while(yE.length);for(;xE.length;)xE.pop()();SE=!1,ME.clear(),cE(t)}function IE(t){if(null!==t.fragment){t.update(),fT(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(TE)}}function $E(){return CE||(CE=Promise.resolve(),CE.then((()=>{CE=null}))),CE}function RE(t,e,n){t.dispatchEvent(eE(`${e?"intro":"outro"}${n}`))}const OE=new Set;let PE;function LE(){PE={r:0,c:[],p:PE}}function DE(){PE.r||fT(PE.c),PE=PE.p}function FE(t,e){t&&t.i&&(OE.delete(t),t.i(e))}function zE(t,e,n,r){if(t&&t.o){if(OE.has(t))return;OE.add(t),PE.c.push((()=>{OE.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}const BE={duration:0};function UE(t,e,n,r){let i=e(t,n),s=r?0:1,o=null,a=null,l=null;function c(){l&&aE(t,l)}function u(t,e){const n=t.b-s;return e*=Math.abs(n),{a:s,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(e){const{delay:n=0,duration:r=300,easing:h=hT,tick:d=uT,css:p}=i||BE,f={start:CT()+n,b:e};e||(f.group=PE,PE.r+=1),o||a?a=f:(p&&(c(),l=oE(t,s,e,r,n,h,p)),e&&d(0,1),o=u(f,r),TE((()=>RE(t,e,"start"))),$T((e=>{if(a&&e>a.start&&(o=u(a,r),a=null,RE(t,o.b,"start"),p&&(c(),l=oE(t,s,o.b,o.duration,0,h,i.css))),o)if(e>=o.end)d(s=o.b,1-s),RE(t,o.b,"end"),a||(o.b?c():--o.group.r||fT(o.group.c)),o=null;else if(e>=o.start){const t=e-o.start;s=o.a+o.d*h(t/o.duration),d(s,1-s)}return!(!o&&!a)})))}return{run(t){mT(i)?$E().then((()=>{i=i(),h(t)})):h(t)},end(){c(),o=a=null}}}function VE(t,e){const n=e.token={};function r(t,r,i,s){if(e.token!==n)return;e.resolved=s;let o=e.ctx;void 0!==i&&(o=o.slice(),o[i]=s);const a=t&&(e.current=t)(o);let l=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(LE(),zE(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),DE())})):e.block.d(1),a.c(),FE(a,1),a.m(e.mount(),e.anchor),l=!0),e.block=a,e.blocks&&(e.blocks[r]=a),l&&NE()}if((i=t)&&"object"==typeof i&&"function"==typeof i.then){const n=uE();if(t.then((t=>{cE(n),r(e.then,1,e.value,t),cE(null)}),(t=>{if(cE(n),r(e.catch,2,e.error,t),cE(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}var i}function jE(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}const WE="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function HE(t,e){zE(t,1,1,(()=>{e.delete(t.key)}))}function GE(t,e){t.f(),HE(t,e)}function qE(t,e,n,r,i,s,o,a,l,c,u,h){let d=t.length,p=s.length,f=d;const m={};for(;f--;)m[t[f].key]=f;const g=[],y=new Map,b=new Map;for(f=p;f--;){const t=h(i,s,f),a=n(t);let l=o.get(a);l?r&&l.p(t,e):(l=c(a,t),l.c()),y.set(a,g[f]=l),a in m&&b.set(a,Math.abs(f-m[a]))}const v=new Set,x=new Set;function w(t){FE(t,1),t.m(a,u),o.set(t.key,t),u=t.first,p--}for(;d&&p;){const e=g[p-1],n=t[d-1],r=e.key,i=n.key;e===n?(u=e.first,d--,p--):y.has(i)?!o.has(r)||v.has(r)?w(e):x.has(i)?d--:b.get(r)>b.get(i)?(x.add(r),w(e)):(v.add(i),d--):(l(n,o),d--)}for(;d--;){const e=t[d];y.has(e.key)||l(e,o)}for(;p;)w(g[p-1]);return g}function XE(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function YE(t){t&&t.c()}function KE(t,e,n,r){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),r||TE((()=>{const e=t.$$.on_mount.map(dT).filter(mT);t.$$.on_destroy?t.$$.on_destroy.push(...e):fT(e),t.$$.on_mount=[]})),s.forEach(TE)}function ZE(t,e){const n=t.$$;null!==n.fragment&&(fT(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function JE(t,e,n,r,i,s,o,a=[-1]){const l=iE;cE(t);const c=t.$$={fragment:null,ctx:[],props:s,update:uT,not_equal:i,bound:pT(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:pT(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},((e,n,...r)=>{const s=r.length?r[0]:n;return c.ctx&&i(c.ctx[e],c.ctx[e]=s)&&(!c.skip_bound&&c.bound[e]&&c.bound[e](s),u&&function(t,e){-1===t.$$.dirty[0]&&(yE.push(t),_E(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n})):[],c.update(),u=!0,fT(c.before_update),c.fragment=!!r&&r(c.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(t),t.forEach(DT)}else c.fragment&&c.fragment.c();e.intro&&FE(t.$$.fragment),KE(t,e.target,e.anchor,e.customElement),NE()}cE(l)}class QE{$destroy(){ZE(this,1),this.$destroy=uT}$on(t,e){if(!mT(e))return uT;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function tM(t){let e,n,r,i,s;const o=t[9].default,a=ST(o,t,t[8],null);return{c(){e=VT(),n=zT("button"),a&&a.c(),GT(n,"class","marcelle svelte-babmty"),n.disabled=t[2],tE(n,"outline","outline"===t[1]),tE(n,"filled","filled"===t[1]),tE(n,"light","light"===t[1]),tE(n,"success","success"===t[3]),tE(n,"warning","warning"===t[3]),tE(n,"danger","danger"===t[3]),tE(n,"size-small","small"===t[4]),tE(n,"size-large","large"===t[4]),tE(n,"round",t[5])},m(o,l){LT(o,e,l),LT(o,n,l),a&&a.m(n,null),r=!0,i||(s=[WT(document.body,"mouseup",(function(){mT(t[0]&&t[7])&&(t[0]&&t[7]).apply(this,arguments)})),WT(n,"click",t[10]),WT(n,"mousedown",t[6])],i=!0)},p(e,[i]){t=e,a&&a.p&&(!r||256&i)&&TT(a,o,t,t[8],r?kT(o,t[8],i,null):ET(t[8]),null),(!r||4&i)&&(n.disabled=t[2]),(!r||2&i)&&tE(n,"outline","outline"===t[1]),(!r||2&i)&&tE(n,"filled","filled"===t[1]),(!r||2&i)&&tE(n,"light","light"===t[1]),(!r||8&i)&&tE(n,"success","success"===t[3]),(!r||8&i)&&tE(n,"warning","warning"===t[3]),(!r||8&i)&&tE(n,"danger","danger"===t[3]),(!r||16&i)&&tE(n,"size-small","small"===t[4]),(!r||16&i)&&tE(n,"size-large","large"===t[4]),(!r||32&i)&&tE(n,"round",t[5])},i(t){r||(FE(a,t),r=!0)},o(t){zE(a,t),r=!1},d(t){t&&DT(e),t&&DT(n),a&&a.d(t),i=!1,fT(s)}}}function eM(t,e,n){let{$$slots:r={},$$scope:i}=e,{variant:s="outline"}=e,{disabled:o=!1}=e,{type:a="default"}=e,{size:l="medium"}=e,{round:c=!1}=e,{pressed:u=!1}=e;const h=fE();return t.$$set=t=>{"variant"in t&&n(1,s=t.variant),"disabled"in t&&n(2,o=t.disabled),"type"in t&&n(3,a=t.type),"size"in t&&n(4,l=t.size),"round"in t&&n(5,c=t.round),"pressed"in t&&n(0,u=t.pressed),"$$scope"in t&&n(8,i=t.$$scope)},[u,s,o,a,l,c,function(){n(0,u=!0),h("pressed",u)},function(){n(0,u=!1),h("pressed",u)},i,r,function(e){gE.call(this,t,e)}]}class nM extends QE{constructor(t){super(),JE(this,t,eM,tM,gT,{variant:1,disabled:2,type:3,size:4,round:5,pressed:0})}}function rM(t){let e,n,r;return{c(){e=zT("input"),GT(e,"class","marcelle svelte-t20lcy"),e.disabled=t[2],GT(e,"type",t[3]),GT(e,"placeholder",t[1]),e.value=t[0]},m(i,s){LT(i,e,s),n||(r=WT(e,"input",t[4]),n=!0)},p(t,[n]){4&n&&(e.disabled=t[2]),8&n&&GT(e,"type",t[3]),2&n&&GT(e,"placeholder",t[1]),1&n&&e.value!==t[0]&&(e.value=t[0])},i:uT,o:uT,d(t){t&&DT(e),n=!1,r()}}}function iM(t,e,n){let{placeholder:r=""}=e,{disabled:i=!1}=e,{type:s="text"}=e,{value:o=null}=e;return t.$$set=t=>{"placeholder"in t&&n(1,r=t.placeholder),"disabled"in t&&n(2,i=t.disabled),"type"in t&&n(3,s=t.type),"value"in t&&n(0,o=t.value)},[o,r,i,s,function(t){n(0,o=t.currentTarget.value)}]}class sM extends QE{constructor(t){super(),JE(this,t,iM,rM,gT,{placeholder:1,disabled:2,type:3,value:0})}}function oM(t){let e,n,r,i,s,o,a,l;const c=t[3].default,u=ST(c,t,t[2],null);return{c(){e=zT("div"),n=zT("div"),r=zT("div"),i=VT(),s=zT("div"),u&&u.c(),GT(r,"class","absolute inset-0 bg-gray-500 opacity-50"),GT(n,"class","overlay svelte-nr9mik"),GT(s,"class","modal svelte-nr9mik"),GT(e,"class","modal-container svelte-nr9mik")},m(c,h){LT(c,e,h),RT(e,n),RT(n,r),RT(e,i),RT(e,s),u&&u.m(s,null),o=!0,a||(l=WT(r,"click",t[0]),a=!0)},p(t,[e]){u&&u.p&&(!o||4&e)&&TT(u,c,t,t[2],o?kT(c,t[2],e,null):ET(t[2]),null)},i(t){o||(FE(u,t),o=!0)},o(t){zE(u,t),o=!1},d(t){t&&DT(e),u&&u.d(t),a=!1,l()}}}function aM(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=fE();function o(){s("quit")}return t.$$set=t=>{"$$scope"in t&&n(2,i=t.$$scope)},[function(){o()},o,i,r]}class lM extends QE{constructor(t){super(),JE(this,t,aM,oM,gT,{quit:1})}get quit(){return this.$$.ctx[1]}}function cM(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function uM(t){const e=t-1;return e*e*e+1}function hM(t,{delay:e=0,duration:n=400,easing:r=cM,amount:i=5,opacity:s=0}={}){const o=getComputedStyle(t),a=+o.opacity,l="none"===o.filter?"":o.filter,c=a*(1-s);return{delay:e,duration:n,easing:r,css:(t,e)=>`opacity: ${a-c*e}; filter: ${l} blur(${e*i}px);`}}function dM(t,{delay:e=0,duration:n=400,easing:r=uM}={}){const i=getComputedStyle(t),s=+i.opacity,o=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:e,duration:n,easing:r,css:t=>`overflow: hidden;opacity: ${Math.min(20*t,1)*s};height: ${t*o}px;padding-top: ${t*a}px;padding-bottom: ${t*l}px;margin-top: ${t*c}px;margin-bottom: ${t*u}px;border-top-width: ${t*h}px;border-bottom-width: ${t*d}px;`}}function pM(t,{delay:e=0,duration:n=400,easing:r=uM,start:i=0,opacity:s=0}={}){const o=getComputedStyle(t),a=+o.opacity,l="none"===o.transform?"":o.transform,c=1-i,u=a*(1-s);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${l} scale(${1-c*e});\n\t\t\topacity: ${a-u*e}\n\t\t`}}function fM(t,{from:e,to:n},r={}){const i=getComputedStyle(t),s="none"===i.transform?"":i.transform,[o,a]=i.transformOrigin.split(" ").map(parseFloat),l=e.left+e.width*o/n.width-(n.left+o),c=e.top+e.height*a/n.height-(n.top+a),{delay:u=0,duration:h=(t=>120*Math.sqrt(t)),easing:d=uM}=r;return{delay:u,duration:mT(h)?h(Math.sqrt(l*l+c*c)):h,easing:d,css:(t,r)=>{const i=r*l,o=r*c,a=t+r*e.width/n.width,u=t+r*e.height/n.height;return`transform: ${s} translate(${i}px, ${o}px) scale(${a}, ${u});`}}}function mM(t,e,n){const r=t.slice();return r[5]=e[n].title,r[6]=e[n].message,r[7]=e[n].type,r[8]=e[n].id,r}function gM(t){let e;return{c(){e=BT("path"),GT(e,"d","M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0\n                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 5h2v6H9V5zm0 8h2v2H9v-2z")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function yM(t){let e;return{c(){e=BT("path"),GT(e,"d","M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0\n                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function bM(t,e){let n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,S,_,k,T=e[5]+"",E=e[6]+"",M=uT;function C(t,e){return"default"===t[7]?yM:"danger"===t[7]?gM:void 0}let A=C(e),N=A&&A(e);function I(){return e[3](e[8])}return{key:t,first:null,c(){n=zT("div"),r=zT("div"),i=zT("div"),s=BT("svg"),N&&N.c(),o=VT(),a=zT("div"),l=zT("p"),c=UT(T),u=VT(),h=zT("p"),d=UT(E),p=VT(),f=zT("div"),m=BT("svg"),g=BT("title"),y=UT("Close"),b=BT("path"),v=VT(),GT(s,"class","notification-svg mr-4 svelte-r4ekig"),GT(s,"xmlns","http://www.w3.org/2000/svg"),GT(s,"viewBox","0 0 20 20"),tE(s,"default","default"===e[7]),tE(s,"danger","danger"===e[7]),GT(i,"class","py-1"),GT(l,"class","my-1 font-bold"),GT(h,"class","my-1 text-sm"),GT(b,"d","M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1\n              1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10\n              8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0\n              1.698z"),GT(m,"class","notification-svg ml-4 cursor-pointer svelte-r4ekig"),GT(m,"role","button"),GT(m,"xmlns","http://www.w3.org/2000/svg"),GT(m,"viewBox","0 0 20 20"),tE(m,"default","default"===e[7]),tE(m,"danger","danger"===e[7]),GT(r,"class","flex items-start"),GT(n,"class","notification-card svelte-r4ekig"),GT(n,"role","alert"),tE(n,"default","default"===e[7]),tE(n,"danger","danger"===e[7]),this.first=n},m(t,e){LT(t,n,e),RT(n,r),RT(r,i),RT(i,s),N&&N.m(s,null),RT(r,o),RT(r,a),RT(a,l),RT(l,c),RT(a,u),RT(a,h),RT(h,d),RT(r,p),RT(r,f),RT(f,m),RT(m,g),RT(g,y),RT(m,b),RT(n,v),S=!0,_||(k=WT(m,"click",I),_=!0)},p(t,r){A!==(A=C(e=t))&&(N&&N.d(1),N=A&&A(e),N&&(N.c(),N.m(s,null))),(!S||1&r)&&tE(s,"default","default"===e[7]),(!S||1&r)&&tE(s,"danger","danger"===e[7]),(!S||1&r)&&T!==(T=e[5]+"")&&XT(c,T),(!S||1&r)&&E!==(E=e[6]+"")&&XT(d,E),(!S||1&r)&&tE(m,"default","default"===e[7]),(!S||1&r)&&tE(m,"danger","danger"===e[7]),(!S||1&r)&&tE(n,"default","default"===e[7]),(!S||1&r)&&tE(n,"danger","danger"===e[7])},r(){w=n.getBoundingClientRect()},f(){!function(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,lE(t,i)}}(n),M(),lE(n,w)},a(){M(),M=function(t,e,n,r){if(!e)return uT;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return uT;const{delay:s=0,duration:o=300,easing:a=hT,start:l=CT()+s,end:c=l+o,tick:u=uT,css:h}=n(t,{from:e,to:i},r);let d,p=!0,f=!1;function m(){h&&aE(t,d),p=!1}return $T((t=>{if(!f&&t>=l&&(f=!0),f&&t>=c&&(u(1,0),m()),!p)return!1;if(f){const e=0+1*a((t-l)/o);u(e,1-e)}return!0})),h&&(d=oE(t,0,1,o,s,a,h)),s||(f=!0),u(0,1),m}(n,w,fM,{})},i(t){S||(TE((()=>{x||(x=UE(n,hM,{amount:10},!0)),x.run(1)})),S=!0)},o(t){x||(x=UE(n,hM,{amount:10},!1)),x.run(0),S=!1},d(t){t&&DT(n),N&&N.d(),t&&x&&x.end(),_=!1,k()}}}function vM(t){let e,n,r=[],i=new Map,s=t[0].slice(0,10);const o=t=>t[8];for(let e=0;e<s.length;e+=1){let n=mM(t,s,e),a=o(n);i.set(a,r[e]=bM(a,n))}return{c(){e=zT("div");for(let t=0;t<r.length;t+=1)r[t].c();GT(e,"class","marcelle notification-container svelte-r4ekig")},m(t,i){LT(t,e,i);for(let t=0;t<r.length;t+=1)r[t].m(e,null);n=!0},p(t,[n]){if(3&n){s=t[0].slice(0,10),LE();for(let t=0;t<r.length;t+=1)r[t].r();r=qE(r,n,o,1,t,s,i,e,GE,bM,null,mM);for(let t=0;t<r.length;t+=1)r[t].a();DE()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)FE(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)zE(r[t]);n=!1},d(t){t&&DT(e);for(let t=0;t<r.length;t+=1)r[t].d()}}}function xM(t,e,n){let{notifications:r=[]}=e;function i(t){n(0,r=r.filter((e=>e.id!==t)))}let s=1;return t.$$set=t=>{"notifications"in t&&n(0,r=t.notifications)},[r,i,function({title:t,message:e,type:o="default",duration:a=3e3}){const l={id:s,title:t,message:e,type:o};s+=1,n(0,r=[...r,l]),a>0&&setTimeout((()=>{i(l.id)}),a)},t=>i(t)]}class wM extends QE{constructor(t){super(),JE(this,t,xM,vM,gT,{notifications:0,add:2})}get add(){return this.$$.ctx[2]}}function SM(t){let e,n,r,i,s,o,a,l,c,u;return{c(){e=zT("div"),n=zT("button"),r=UT("-"),i=VT(),s=zT("input"),o=VT(),a=zT("button"),l=UT("+"),n.disabled=t[1],GT(n,"class","left svelte-9ymaj0"),GT(s,"type","number"),GT(s,"inputmode","decimal"),s.value=t[0],s.disabled=t[1],KT(s,"width","80px"),GT(s,"class","svelte-9ymaj0"),a.disabled=t[1],GT(a,"class","right svelte-9ymaj0"),GT(e,"class","flex")},m(h,d){LT(h,e,d),RT(e,n),RT(n,r),RT(e,i),RT(e,s),RT(e,o),RT(e,a),RT(a,l),c||(u=[WT(n,"click",t[3]),WT(s,"change",t[2]),WT(a,"click",t[4])],c=!0)},p(t,[e]){2&e&&(n.disabled=t[1]),1&e&&s.value!==t[0]&&(s.value=t[0]),2&e&&(s.disabled=t[1]),2&e&&(a.disabled=t[1])},i:uT,o:uT,d(t){t&&DT(e),c=!1,fT(u)}}}function _M(t,e,n){let{disabled:r=!1}=e,{value:i}=e;return t.$$set=t=>{"disabled"in t&&n(1,r=t.disabled),"value"in t&&n(0,i=t.value)},[i,r,function(t){const e=t.target,r=parseFloat(e.value);Number.isNaN(r)?e.value=i.toString():n(0,i=r)},()=>{n(0,i-=1)},()=>{n(0,i+=1)}]}class kM extends QE{constructor(t){super(),JE(this,t,_M,SM,gT,{disabled:1,value:0})}}function TM(t,e,n){const r=t.slice();return r[12]=e[n],r[14]=n,r}function EM(t){let e,n,r,i,s,o,a,l,c,u=t[0],h=[];for(let e=0;e<u.length;e+=1)h[e]=MM(TM(t,u,e));return{c(){e=zT("div");for(let t=0;t<h.length;t+=1)h[t].c();n=VT(),r=zT("button"),i=UT("-"),s=VT(),o=zT("button"),a=UT("+"),r.disabled=t[1],GT(r,"class","left svelte-9ymaj0"),o.disabled=t[1],GT(o,"class","right svelte-9ymaj0"),KT(o,"border-left","none"),GT(e,"class","flex items-center")},m(u,d){LT(u,e,d);for(let t=0;t<h.length;t+=1)h[t].m(e,null);RT(e,n),RT(e,r),RT(r,i),RT(e,s),RT(e,o),RT(o,a),l||(c=[WT(r,"click",t[10]),WT(o,"click",t[11])],l=!0)},p(t,i){if(31&i){let r;for(u=t[0],r=0;r<u.length;r+=1){const s=TM(t,u,r);h[r]?h[r].p(s,i):(h[r]=MM(s),h[r].c(),h[r].m(e,n))}for(;r<h.length;r+=1)h[r].d(1);h.length=u.length}2&i&&(r.disabled=t[1]),2&i&&(o.disabled=t[1])},d(t){t&&DT(e),FT(h,t),l=!1,fT(c)}}}function MM(t){let e,n,r,i,s,o,a,l,c,u,h;function d(){return t[7](t[14])}function p(...e){return t[8](t[14],...e)}function f(){return t[9](t[14])}return{c(){e=zT("div"),n=zT("button"),r=UT("-"),i=VT(),s=zT("input"),a=VT(),l=zT("button"),c=UT("+"),n.disabled=t[1],GT(n,"class","left svelte-9ymaj0"),GT(s,"type","number"),GT(s,"inputmode","decimal"),s.value=o=t[12],s.disabled=t[1],KT(s,"width","80px"),GT(s,"class","svelte-9ymaj0"),l.disabled=t[1],GT(l,"class","right svelte-9ymaj0"),GT(e,"class","flex mr-2")},m(t,o){LT(t,e,o),RT(e,n),RT(n,r),RT(e,i),RT(e,s),RT(e,a),RT(e,l),RT(l,c),u||(h=[WT(n,"click",d),WT(s,"change",p),WT(l,"click",f)],u=!0)},p(e,r){t=e,2&r&&(n.disabled=t[1]),1&r&&o!==(o=t[12])&&s.value!==o&&(s.value=o),2&r&&(s.disabled=t[1]),2&r&&(l.disabled=t[1])},d(t){t&&DT(e),u=!1,fT(h)}}}function CM(t){let e,n=t[0]&&Array.isArray(t[0]),r=n&&EM(t);return{c(){r&&r.c(),e=jT()},m(t,n){r&&r.m(t,n),LT(t,e,n)},p(t,[i]){1&i&&(n=t[0]&&Array.isArray(t[0])),n?r?r.p(t,i):(r=EM(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:uT,o:uT,d(t){r&&r.d(t),t&&DT(e)}}}function AM(t,e,n){let{disabled:r=!1}=e,{value:i}=e;function s(t,e){const r=t.target,s=parseFloat(r.value);Number.isNaN(s)?r.value=i[e].toString():n(0,i[e]=s,i)}function o(t){const e=i.slice();e[t]-=1,n(0,i=e)}function a(t){const e=i.slice();e[t]+=1,n(0,i=e)}function l(){const t=i.slice();t.push(t.length?t[t.length-1]:0),n(0,i=t)}function c(){n(0,i=i.slice(0,i.length-1))}return t.$$set=t=>{"disabled"in t&&n(1,r=t.disabled),"value"in t&&n(0,i=t.value)},[i,r,s,o,a,l,c,t=>o(t),(t,e)=>s(e,t),t=>a(t),()=>c(),()=>l()]}class NM extends QE{constructor(t){super(),JE(this,t,AM,CM,gT,{disabled:1,value:0})}}function IM(t,e,n){const r=t.slice();return r[7]=e[n],r}function $M(t){let e,n;return{c(){e=BT("svg"),n=BT("path"),GT(n,"d","M10 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0-6a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"),GT(e,"class","fill-current inline-block h-5 w-5"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"viewBox","0 0 20 20")},m(t,r){LT(t,e,r),RT(e,n)},p:uT,d(t){t&&DT(e)}}}function RM(t){let e,n,r,i,s,o=t[0],a=[];for(let e=0;e<o.length;e+=1)a[e]=OM(IM(t,o,e));return{c(){e=zT("div"),n=zT("div"),r=zT("div");for(let t=0;t<a.length;t+=1)a[t].c();GT(r,"class","py-1"),GT(r,"role","menu"),GT(r,"aria-orientation","vertical"),GT(r,"aria-labelledby","options-menu"),GT(n,"class","origin-top-right absolute right-0 mt-1 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"),GT(e,"class","origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg z-50"),tE(e,"hidden",!1)},m(t,i){LT(t,e,i),RT(e,n),RT(n,r);for(let t=0;t<a.length;t+=1)a[t].m(r,null);s=!0},p(t,e){if(9&e){let n;for(o=t[0],n=0;n<o.length;n+=1){const i=IM(t,o,n);a[n]?a[n].p(i,e):(a[n]=OM(i),a[n].c(),a[n].m(r,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}},i(t){s||(TE((()=>{i||(i=UE(e,dM,{duration:100},!0)),i.run(1)})),s=!0)},o(t){i||(i=UE(e,dM,{duration:100},!1)),i.run(0),s=!1},d(t){t&&DT(e),FT(a,t),t&&i&&i.end()}}}function OM(t){let e,n,r,i,s,o=t[7].text+"";function a(){return t[5](t[7])}return{c(){e=zT("button"),n=UT(o),r=VT(),GT(e,"class","text-sm py-2 px-4 font-normal block w-full whitespace-no-wrap bg-transparent text-gray-800 hover:bg-gray-100 border-0 cursor-pointer")},m(t,o){LT(t,e,o),RT(e,n),RT(e,r),i||(s=WT(e,"click",a),i=!0)},p(e,r){t=e,1&r&&o!==(o=t[7].text+"")&&XT(n,o)},d(t){t&&DT(e),i=!1,s()}}}function PM(t){let e,n,r,i,s,o,a;r=new nM({props:{size:"small",round:!0,$$slots:{default:[$M]},$$scope:{ctx:t}}}),r.$on("click",t[2]);let l=t[1]&&RM(t);return{c(){e=VT(),n=zT("div"),YE(r.$$.fragment),i=VT(),l&&l.c(),GT(n,"class","relative")},m(c,u){LT(c,e,u),LT(c,n,u),KE(r,n,null),RT(n,i),l&&l.m(n,null),s=!0,o||(a=WT(document.body,"click",t[4]),o=!0)},p(t,[e]){const i={};1024&e&&(i.$$scope={dirty:e,ctx:t}),r.$set(i),t[1]?l?(l.p(t,e),2&e&&FE(l,1)):(l=RM(t),l.c(),FE(l,1),l.m(n,null)):l&&(LE(),zE(l,1,1,(()=>{l=null})),DE())},i(t){s||(FE(r.$$.fragment,t),FE(l),s=!0)},o(t){zE(r.$$.fragment,t),zE(l),s=!1},d(t){t&&DT(e),t&&DT(n),ZE(r),l&&l.d(),o=!1,a()}}}function LM(t,e,n){let{actions:r=[]}=e;const i=fE();let s=!1;function o(t){i("select",t)}return t.$$set=t=>{"actions"in t&&n(0,r=t.actions)},[r,s,function(t){t.stopPropagation(),n(1,s=!s)},o,()=>{n(1,s=!1)},t=>o(t.code)]}class DM extends QE{constructor(t){super(),JE(this,t,LM,PM,gT,{actions:0})}}function FM(t){let e,n;return{c(){e=zT("div"),GT(e,"class","progress-line svelte-1w3676e"),GT(e,"style",n=t[0]>=0?`--bar-mr: ${100-Math.floor(100*t[0])}%;`:"--bar-mr: 0px"),tE(e,"thin",t[2]),tE(e,"indeterminate",void 0===t[0]||null===t[0]||t[0]<0),tE(e,"gray","idle"===t[1]),tE(e,"green","success"===t[1]),tE(e,"red","danger"===t[1])},m(t,n){LT(t,e,n)},p(t,[r]){1&r&&n!==(n=t[0]>=0?`--bar-mr: ${100-Math.floor(100*t[0])}%;`:"--bar-mr: 0px")&&GT(e,"style",n),4&r&&tE(e,"thin",t[2]),1&r&&tE(e,"indeterminate",void 0===t[0]||null===t[0]||t[0]<0),2&r&&tE(e,"gray","idle"===t[1]),2&r&&tE(e,"green","success"===t[1]),2&r&&tE(e,"red","danger"===t[1])},i:uT,o:uT,d(t){t&&DT(e)}}}function zM(t,e,n){let{progress:r}=e,{type:i="default"}=e,{thin:s=!1}=e;return t.$$set=t=>{"progress"in t&&n(0,r=t.progress),"type"in t&&n(1,i=t.type),"thin"in t&&n(2,s=t.thin)},[r,i,s]}class BM extends QE{constructor(t){super(),JE(this,t,zM,FM,gT,{progress:0,type:1,thin:2})}}function UM(t,e,n){const r=t.slice();return r[7]=e[n],r}function VM(t){let e,n;return{c(){e=zT("option"),n=UT(t[2]),e.__value="",e.value=e.__value,e.disabled=!0,GT(e,"class","svelte-g3sqa4")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){4&e&&XT(n,t[2])},d(t){t&&DT(e)}}}function jM(t){let e,n,r,i=t[7]+"";return{c(){e=zT("option"),n=UT(i),e.__value=r=t[7],e.value=e.__value,GT(e,"class","svelte-g3sqa4")},m(t,r){LT(t,e,r),RT(e,n)},p(t,s){2&s&&i!==(i=t[7]+"")&&XT(n,i),2&s&&r!==(r=t[7])&&(e.__value=r,e.value=e.__value)},d(t){t&&DT(e)}}}function WM(t){let e,n,r,i,s,o,a,l=t[2]&&VM(t),c=t[1],u=[];for(let e=0;e<c.length;e+=1)u[e]=jM(UM(t,c,e));return{c(){e=zT("div"),n=zT("select"),l&&l.c(),r=jT();for(let t=0;t<u.length;t+=1)u[t].c();i=VT(),s=zT("div"),s.innerHTML='<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path></svg>',GT(n,"class","svelte-g3sqa4"),void 0===t[0]&&TE((()=>t[5].call(n))),tE(n,"small","small"===t[3]),GT(s,"class","pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"),GT(e,"class","select-container svelte-g3sqa4")},m(c,h){LT(c,e,h),RT(e,n),l&&l.m(n,null),RT(n,r);for(let t=0;t<u.length;t+=1)u[t].m(n,null);ZT(n,t[0]),RT(e,i),RT(e,s),o||(a=[WT(n,"change",t[5]),WT(n,"change",t[6])],o=!0)},p(t,[e]){if(t[2]?l?l.p(t,e):(l=VM(t),l.c(),l.m(n,r)):l&&(l.d(1),l=null),2&e){let r;for(c=t[1],r=0;r<c.length;r+=1){const i=UM(t,c,r);u[r]?u[r].p(i,e):(u[r]=jM(i),u[r].c(),u[r].m(n,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=c.length}3&e&&ZT(n,t[0]),8&e&&tE(n,"small","small"===t[3])},i:uT,o:uT,d(t){t&&DT(e),l&&l.d(),FT(u,t),o=!1,fT(a)}}}function HM(t,e,n){let{options:r}=e,{value:i=""}=e,{placeholder:s="Select an Option"}=e,{size:o="normal"}=e;const a=fE();return t.$$set=t=>{"options"in t&&n(1,r=t.options),"value"in t&&n(0,i=t.value),"placeholder"in t&&n(2,s=t.placeholder),"size"in t&&n(3,o=t.size)},[i,r,s,o,a,function(){i=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(0,i),n(1,r)},t=>a("change",t.currentTarget.value)]}class GM extends QE{constructor(t){super(),JE(this,t,HM,WM,gT,{options:1,value:0,placeholder:2,size:3})}}function qM(t){let e;return{c(){e=zT("span"),e.innerHTML='<span class="spinner svelte-l56ytt"><span class="dot1 svelte-l56ytt"></span>  <span class="dot2 svelte-l56ytt"></span></span>',GT(e,"class","spinner-container svelte-l56ytt")},m(t,n){LT(t,e,n)},p:uT,i:uT,o:uT,d(t){t&&DT(e)}}}class XM extends QE{constructor(t){super(),JE(this,t,null,qM,gT,{})}}function YM(t){let e,n,r,i,s,o,a,l,c;return{c(){e=zT("label"),n=zT("input"),r=VT(),i=zT("span"),i.innerHTML='<span class="track svelte-16fu7e0"></span> \n    <span class="thumb svelte-16fu7e0"></span>',s=VT(),o=zT("span"),a=UT(t[1]),GT(n,"type","checkbox"),n.disabled=t[2],GT(n,"class","svelte-16fu7e0"),GT(i,"class","switch svelte-16fu7e0"),GT(o,"class","ml-2 cursor-pointer"),GT(e,"class","marcelle")},m(u,h){LT(u,e,h),RT(e,n),n.checked=t[0],RT(e,r),RT(e,i),RT(e,s),RT(e,o),RT(o,a),l||(c=WT(n,"change",t[3]),l=!0)},p(t,[e]){4&e&&(n.disabled=t[2]),1&e&&(n.checked=t[0]),2&e&&XT(a,t[1])},i:uT,o:uT,d(t){t&&DT(e),l=!1,c()}}}function KM(t,e,n){let{text:r=""}=e,{checked:i=!1}=e,{disabled:s=!1}=e;return t.$$set=t=>{"text"in t&&n(1,r=t.text),"checked"in t&&n(0,i=t.checked),"disabled"in t&&n(2,s=t.disabled)},[i,r,s,function(){i=this.checked,n(0,i)}]}class ZM extends QE{constructor(t){super(),JE(this,t,KM,YM,gT,{text:1,checked:0,disabled:2})}}const JM=[];function QM(t,e=uT){let n;const r=new Set;function i(e){if(gT(t,e)&&(t=e,n)){const e=!JM.length;for(const e of r)e[1](),JM.push(e,t);if(e){for(let t=0;t<JM.length;t+=2)JM[t][0](JM[t+1]);JM.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,o=uT){const a=[s,o];return r.add(a),1===r.size&&(n=e(i)||uT),s(t),()=>{r.delete(a),0===r.size&&(n(),n=null)}}}}function tC(t){let e,n;const r=t[1].default,i=ST(r,t,t[0],null);return{c(){e=zT("div"),i&&i.c(),GT(e,"class","tabs")},m(t,r){LT(t,e,r),i&&i.m(e,null),n=!0},p(t,[e]){i&&i.p&&(!n||1&e)&&TT(i,r,t,t[0],n?kT(r,t[0],e,null):ET(t[0]),null)},i(t){n||(FE(i,t),n=!0)},o(t){zE(i,t),n=!1},d(t){t&&DT(e),i&&i.d(t)}}}const eC={};function nC(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=[],o=[],a=QM(null),l=QM(null);var c,u;return c=eC,u={registerTab:t=>{s.push(t),a.update((e=>e||t)),pE((()=>{const e=s.indexOf(t);s.splice(e,1),a.update((n=>n===t?s[e]||s[s.length-1]:n))}))},registerPanel:t=>{o.push(t),l.update((e=>e||t)),pE((()=>{const e=o.indexOf(t);o.splice(e,1),l.update((n=>n===t?o[e]||o[o.length-1]:n))}))},selectTab:t=>{const e=s.indexOf(t);a.set(t),l.set(o[e])},selectedTab:a,selectedPanel:l},uE().$$.context.set(c,u),t.$$set=t=>{"$$scope"in t&&n(0,i=t.$$scope)},[i,r]}class rC extends QE{constructor(t){super(),JE(this,t,nC,tC,gT,{})}}function iC(t){let e,n,r,i;const s=t[5].default,o=ST(s,t,t[4],null);return{c(){e=zT("div"),o&&o.c(),GT(e,"class","text-sm font-semibold text-gray-600 cursor-pointer mx-4 p-2 hover:text-gray-800 svelte-13dez5h"),GT(e,"role","tab"),tE(e,"selected",t[0]===t[1])},m(s,a){LT(s,e,a),o&&o.m(e,null),n=!0,r||(i=WT(e,"click",t[6]),r=!0)},p(t,[r]){o&&o.p&&(!n||16&r)&&TT(o,s,t,t[4],n?kT(s,t[4],r,null):ET(t[4]),null),(!n||3&r)&&tE(e,"selected",t[0]===t[1])},i(t){n||(FE(o,t),n=!0)},o(t){zE(o,t),n=!1},d(t){t&&DT(e),o&&o.d(t),r=!1,i()}}}function sC(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerTab:a,selectTab:l,selectedTab:c}=mE(eC);wT(t,c,(t=>n(0,r=t))),a(o);return t.$$set=t=>{"$$scope"in t&&n(4,s=t.$$scope)},[r,o,l,c,s,i,()=>l(o)]}class oC extends QE{constructor(t){super(),JE(this,t,sC,iC,gT,{})}}function aC(t){let e;const n=t[4].default,r=ST(n,t,t[3],null);return{c(){r&&r.c()},m(t,n){r&&r.m(t,n),e=!0},p(t,i){r&&r.p&&(!e||8&i)&&TT(r,n,t,t[3],e?kT(n,t[3],i,null):ET(t[3]),null)},i(t){e||(FE(r,t),e=!0)},o(t){zE(r,t),e=!1},d(t){r&&r.d(t)}}}function lC(t){let e,n,r=t[0]===t[1]&&aC(t);return{c(){r&&r.c(),e=jT()},m(t,i){r&&r.m(t,i),LT(t,e,i),n=!0},p(t,[n]){t[0]===t[1]?r?(r.p(t,n),1&n&&FE(r,1)):(r=aC(t),r.c(),FE(r,1),r.m(e.parentNode,e)):r&&(LE(),zE(r,1,1,(()=>{r=null})),DE())},i(t){n||(FE(r),n=!0)},o(t){zE(r),n=!1},d(t){r&&r.d(t),t&&DT(e)}}}function cC(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerPanel:a,selectedPanel:l}=mE(eC);return wT(t,l,(t=>n(0,r=t))),a(o),t.$$set=t=>{"$$scope"in t&&n(3,s=t.$$scope)},[r,o,l,s,i]}class uC extends QE{constructor(t){super(),JE(this,t,cC,lC,gT,{})}}function hC(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function dC(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function pC(t){return pC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pC(t)}function fC(t){dC(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"===pC(t)&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}var mC={};function gC(){return mC}function yC(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function bC(t,e){dC(2,arguments);var n=fC(t),r=fC(e),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function vC(t,e){dC(2,arguments);var n=fC(t),r=fC(e),i=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return 12*i+s}function xC(t,e){return dC(2,arguments),fC(t).getTime()-fC(e).getTime()}var wC={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}};function SC(t){return t?wC[t]:wC.trunc}function _C(t){dC(1,arguments);var e=fC(t);return e.setHours(23,59,59,999),e}function kC(t){dC(1,arguments);var e=fC(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function TC(t){dC(1,arguments);var e=fC(t);return _C(e).getTime()===kC(e).getTime()}function EC(t,e){dC(2,arguments);var n,r=fC(t),i=fC(e),s=bC(r,i),o=Math.abs(vC(r,i));if(o<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*o);var a=bC(r,i)===-s;TC(fC(t))&&1===o&&1===bC(t,i)&&(a=!1),n=s*(o-Number(a))}return 0===n?0:n}function MC(t,e,n){dC(2,arguments);var r=xC(t,e)/1e3;return SC(null==n?void 0:n.roundingMethod)(r)}function CC(t){dC(1,arguments);var e=1,n=fC(t),r=n.getUTCDay(),i=(r<e?7:0)+r-e;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function AC(t){dC(1,arguments);var e=fC(t),n=e.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=CC(r),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var o=CC(s);return e.getTime()>=i.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}function NC(t){dC(1,arguments);var e=AC(t),n=new Date(0);n.setUTCFullYear(e,0,4),n.setUTCHours(0,0,0,0);var r=CC(n);return r}function IC(t){dC(1,arguments);var e=fC(t),n=CC(e).getTime()-NC(e).getTime();return Math.round(n/6048e5)+1}function $C(t,e){var n,r,i,s,o,a,l,c;dC(1,arguments);var u=gC(),h=hC(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.weekStartsOn)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==n?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var d=fC(t),p=d.getUTCDay(),f=(p<h?7:0)+p-h;return d.setUTCDate(d.getUTCDate()-f),d.setUTCHours(0,0,0,0),d}function RC(t,e){var n,r,i,s,o,a,l,c;dC(1,arguments);var u=fC(t),h=u.getUTCFullYear(),d=gC(),p=hC(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.firstWeekContainsDate)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:d.firstWeekContainsDate)&&void 0!==r?r:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setUTCFullYear(h+1,0,p),f.setUTCHours(0,0,0,0);var m=$C(f,e),g=new Date(0);g.setUTCFullYear(h,0,p),g.setUTCHours(0,0,0,0);var y=$C(g,e);return u.getTime()>=m.getTime()?h+1:u.getTime()>=y.getTime()?h:h-1}function OC(t,e){var n,r,i,s,o,a,l,c;dC(1,arguments);var u=gC(),h=hC(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.firstWeekContainsDate)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1),d=RC(t,e),p=new Date(0);p.setUTCFullYear(d,0,h),p.setUTCHours(0,0,0,0);var f=$C(p,e);return f}function PC(t,e){dC(1,arguments);var n=fC(t),r=$C(n,e).getTime()-OC(n,e).getTime();return Math.round(r/6048e5)+1}var LC={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function DC(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width?String(e.width):t.defaultWidth,r=t.formats[n]||t.formats[t.defaultWidth];return r}}var FC={date:DC({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:DC({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:DC({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},zC={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function BC(t){return function(e,n){var r;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&t.formattingValues){var i=t.defaultFormattingWidth||t.defaultWidth,s=null!=n&&n.width?String(n.width):i;r=t.formattingValues[s]||t.formattingValues[i]}else{var o=t.defaultWidth,a=null!=n&&n.width?String(n.width):t.defaultWidth;r=t.values[a]||t.values[o]}return r[t.argumentCallback?t.argumentCallback(e):e]}}var UC={ordinalNumber:function(t,e){var n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:BC({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:BC({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:BC({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:BC({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:BC({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function VC(t){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;var o,a=s[0],l=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?WC(l,(function(t){return t.test(a)})):jC(l,(function(t){return t.test(a)}));o=t.valueCallback?t.valueCallback(c):c,o=n.valueCallback?n.valueCallback(o):o;var u=e.slice(a.length);return{value:o,rest:u}}}function jC(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n]))return n}function WC(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n}var HC,GC={ordinalNumber:(HC={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(t){return parseInt(t,10)}},function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.match(HC.matchPattern);if(!n)return null;var r=n[0],i=t.match(HC.parsePattern);if(!i)return null;var s=HC.valueCallback?HC.valueCallback(i[0]):i[0];s=e.valueCallback?e.valueCallback(s):s;var o=t.slice(r.length);return{value:s,rest:o}}),era:VC({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:VC({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:VC({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:VC({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:VC({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},qC={code:"en-US",formatDistance:function(t,e,n){var r,i=LC[t];return r="string"==typeof i?i:1===e?i.one:i.other.replace("{{count}}",e.toString()),null!=n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:FC,formatRelative:function(t,e,n,r){return zC[t]},localize:UC,match:GC,options:{weekStartsOn:0,firstWeekContainsDate:1}};function XC(t,e){if(null==t)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function YC(t){return XC({},t)}function KC(t,e,n){var r,i;dC(2,arguments);var s=gC(),o=null!==(r=null!==(i=null==n?void 0:n.locale)&&void 0!==i?i:s.locale)&&void 0!==r?r:qC;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var a=bC(t,e);if(isNaN(a))throw new RangeError("Invalid time value");var l,c,u=XC(YC(n),{addSuffix:Boolean(null==n?void 0:n.addSuffix),comparison:a});a>0?(l=fC(e),c=fC(t)):(l=fC(t),c=fC(e));var h,d=MC(c,l),p=(yC(c)-yC(l))/1e3,f=Math.round((d-p)/60);if(f<2)return null!=n&&n.includeSeconds?d<5?o.formatDistance("lessThanXSeconds",5,u):d<10?o.formatDistance("lessThanXSeconds",10,u):d<20?o.formatDistance("lessThanXSeconds",20,u):d<40?o.formatDistance("halfAMinute",0,u):d<60?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",1,u):0===f?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",f,u);if(f<45)return o.formatDistance("xMinutes",f,u);if(f<90)return o.formatDistance("aboutXHours",1,u);if(f<1440){var m=Math.round(f/60);return o.formatDistance("aboutXHours",m,u)}if(f<2520)return o.formatDistance("xDays",1,u);if(f<43200){var g=Math.round(f/1440);return o.formatDistance("xDays",g,u)}if(f<86400)return h=Math.round(f/43200),o.formatDistance("aboutXMonths",h,u);if((h=EC(c,l))<12){var y=Math.round(f/43200);return o.formatDistance("xMonths",y,u)}var b=h%12,v=Math.floor(h/12);return b<3?o.formatDistance("aboutXYears",v,u):b<9?o.formatDistance("overXYears",v,u):o.formatDistance("almostXYears",v+1,u)}function ZC(t){return ZC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZC(t)}function JC(t,e){return JC=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},JC(t,e)}function QC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=eA(t);if(e){var i=eA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return tA(this,n)}}function tA(t,e){return!e||"object"!==ZC(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function eA(t){return eA=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},eA(t)}function nA(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function iA(t,e,n){return e&&rA(t.prototype,e),n&&rA(t,n),t}var sA=function(){function t(){var e,n,r;nA(this,t),r=0,(n="subPriority")in(e=this)?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r}return iA(t,[{key:"validate",value:function(t,e){return!0}}]),t}(),oA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&JC(t,e)}(n,sA);var e=QC(n);function n(t,r,i,s,o){var a;return nA(this,n),(a=e.call(this)).value=t,a.validateValue=r,a.setValue=i,a.priority=s,o&&(a.subPriority=o),a}return iA(n,[{key:"validate",value:function(t,e){return this.validateValue(t,this.value,e)}},{key:"set",value:function(t,e,n){return this.setValue(t,e,this.value,n)}}]),n}();function aA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var lA=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,n=[{key:"run",value:function(t,e,n,r){var i=this.parse(t,e,n,r);return i?{setter:new oA(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}},{key:"validate",value:function(t,e,n){return!0}}],n&&aA(e.prototype,n),r&&aA(e,r),t}();function cA(t){return cA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cA(t)}function uA(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dA(t,e){return dA=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},dA(t,e)}function pA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gA(t);if(e){var i=gA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fA(this,n)}}function fA(t,e){return!e||"object"!==cA(e)&&"function"!=typeof e?mA(t):e}function mA(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gA(t){return gA=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gA(t)}function yA(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dA(t,e)}(s,lA);var e,n,r,i=pA(s);function s(){var t;uA(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return yA(mA(t=i.call.apply(i,[this].concat(n))),"priority",140),yA(mA(t),"incompatibleTokens",["R","u","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"G":case"GG":case"GGG":return n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"});case"GGGGG":return n.era(t,{width:"narrow"});default:return n.era(t,{width:"wide"})||n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"})}}},{key:"set",value:function(t,e,n){return e.era=n,t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t}}],n&&hA(e.prototype,n),r&&hA(e,r),s}(),vA=/^(1[0-2]|0?\d)/,xA=/^(3[0-1]|[0-2]?\d)/,wA=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,SA=/^(5[0-3]|[0-4]?\d)/,_A=/^(2[0-3]|[0-1]?\d)/,kA=/^(2[0-4]|[0-1]?\d)/,TA=/^(1[0-1]|0?\d)/,EA=/^(1[0-2]|0?\d)/,MA=/^[0-5]?\d/,CA=/^[0-5]?\d/,AA=/^\d/,NA=/^\d{1,2}/,IA=/^\d{1,3}/,$A=/^\d{1,4}/,RA=/^-?\d+/,OA=/^-?\d/,PA=/^-?\d{1,2}/,LA=/^-?\d{1,3}/,DA=/^-?\d{1,4}/,FA=/^([+-])(\d{2})(\d{2})?|Z/,zA=/^([+-])(\d{2})(\d{2})|Z/,BA=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,UA=/^([+-])(\d{2}):(\d{2})|Z/,VA=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function jA(t,e){return t?{value:e(t.value),rest:t.rest}:t}function WA(t,e){var n=e.match(t);return n?{value:parseInt(n[0],10),rest:e.slice(n[0].length)}:null}function HA(t,e){var n=e.match(t);return n?"Z"===n[0]?{value:0,rest:e.slice(1)}:{value:("+"===n[1]?1:-1)*(36e5*(n[2]?parseInt(n[2],10):0)+6e4*(n[3]?parseInt(n[3],10):0)+1e3*(n[5]?parseInt(n[5],10):0)),rest:e.slice(n[0].length)}:null}function GA(t){return WA(RA,t)}function qA(t,e){switch(t){case 1:return WA(AA,e);case 2:return WA(NA,e);case 3:return WA(IA,e);case 4:return WA($A,e);default:return WA(new RegExp("^\\d{1,"+t+"}"),e)}}function XA(t,e){switch(t){case 1:return WA(OA,e);case 2:return WA(PA,e);case 3:return WA(LA,e);case 4:return WA(DA,e);default:return WA(new RegExp("^-?\\d{1,"+t+"}"),e)}}function YA(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function KA(t,e){var n,r=e>0,i=r?e:1-e;if(i<=50)n=t||100;else{var s=i+50;n=t+100*Math.floor(s/100)-(t>=s%100?100:0)}return r?n:1-n}function ZA(t){return t%400==0||t%4==0&&t%100!=0}function JA(t){return JA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},JA(t)}function QA(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function eN(t,e){return eN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},eN(t,e)}function nN(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=sN(t);if(e){var i=sN(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return rN(this,n)}}function rN(t,e){return!e||"object"!==JA(e)&&"function"!=typeof e?iN(t):e}function iN(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sN(t){return sN=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},sN(t)}function oN(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var aN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&eN(t,e)}(s,lA);var e,n,r,i=nN(s);function s(){var t;QA(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return oN(iN(t=i.call.apply(i,[this].concat(n))),"priority",130),oN(iN(t),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return{year:t,isTwoDigitYear:"yy"===e}};switch(e){case"y":return jA(qA(4,t),r);case"yo":return jA(n.ordinalNumber(t,{unit:"year"}),r);default:return jA(qA(e.length,t),r)}}},{key:"validate",value:function(t,e){return e.isTwoDigitYear||e.year>0}},{key:"set",value:function(t,e,n){var r=t.getUTCFullYear();if(n.isTwoDigitYear){var i=KA(n.year,r);return t.setUTCFullYear(i,0,1),t.setUTCHours(0,0,0,0),t}var s="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(s,0,1),t.setUTCHours(0,0,0,0),t}}],n&&tN(e.prototype,n),r&&tN(e,r),s}();function lN(t){return lN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lN(t)}function cN(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hN(t,e){return hN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hN(t,e)}function dN(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=mN(t);if(e){var i=mN(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return pN(this,n)}}function pN(t,e){return!e||"object"!==lN(e)&&"function"!=typeof e?fN(t):e}function fN(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mN(t){return mN=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mN(t)}function gN(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var yN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hN(t,e)}(s,lA);var e,n,r,i=dN(s);function s(){var t;cN(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return gN(fN(t=i.call.apply(i,[this].concat(n))),"priority",130),gN(fN(t),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return{year:t,isTwoDigitYear:"YY"===e}};switch(e){case"Y":return jA(qA(4,t),r);case"Yo":return jA(n.ordinalNumber(t,{unit:"year"}),r);default:return jA(qA(e.length,t),r)}}},{key:"validate",value:function(t,e){return e.isTwoDigitYear||e.year>0}},{key:"set",value:function(t,e,n,r){var i=RC(t,r);if(n.isTwoDigitYear){var s=KA(n.year,i);return t.setUTCFullYear(s,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),$C(t,r)}var o="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(o,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),$C(t,r)}}],n&&uN(e.prototype,n),r&&uN(e,r),s}();function bN(t){return bN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bN(t)}function vN(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wN(t,e){return wN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wN(t,e)}function SN(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=TN(t);if(e){var i=TN(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _N(this,n)}}function _N(t,e){return!e||"object"!==bN(e)&&"function"!=typeof e?kN(t):e}function kN(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function TN(t){return TN=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},TN(t)}function EN(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var MN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wN(t,e)}(s,lA);var e,n,r,i=SN(s);function s(){var t;vN(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return EN(kN(t=i.call.apply(i,[this].concat(n))),"priority",130),EN(kN(t),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return XA("R"===e?4:e.length,t)}},{key:"set",value:function(t,e,n){var r=new Date(0);return r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0),CC(r)}}])&&xN(e.prototype,n),r&&xN(e,r),s}();function CN(t){return CN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CN(t)}function AN(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function NN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function IN(t,e){return IN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},IN(t,e)}function $N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=PN(t);if(e){var i=PN(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return RN(this,n)}}function RN(t,e){return!e||"object"!==CN(e)&&"function"!=typeof e?ON(t):e}function ON(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function PN(t){return PN=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},PN(t)}function LN(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var DN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&IN(t,e)}(s,lA);var e,n,r,i=$N(s);function s(){var t;AN(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return LN(ON(t=i.call.apply(i,[this].concat(n))),"priority",130),LN(ON(t),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return XA("u"===e?4:e.length,t)}},{key:"set",value:function(t,e,n){return t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t}}])&&NN(e.prototype,n),r&&NN(e,r),s}();function FN(t){return FN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},FN(t)}function zN(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function BN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function UN(t,e){return UN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},UN(t,e)}function VN(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=HN(t);if(e){var i=HN(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return jN(this,n)}}function jN(t,e){return!e||"object"!==FN(e)&&"function"!=typeof e?WN(t):e}function WN(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function HN(t){return HN=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},HN(t)}function GN(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&UN(t,e)}(s,lA);var e,n,r,i=VN(s);function s(){var t;zN(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return GN(WN(t=i.call.apply(i,[this].concat(n))),"priority",120),GN(WN(t),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"Q":case"QQ":return qA(e.length,t);case"Qo":return n.ordinalNumber(t,{unit:"quarter"});case"QQQ":return n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(t,{width:"narrow",context:"formatting"});default:return n.quarter(t,{width:"wide",context:"formatting"})||n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=1&&e<=4}},{key:"set",value:function(t,e,n){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t}}],n&&BN(e.prototype,n),r&&BN(e,r),s}();function XN(t){return XN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XN(t)}function YN(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function KN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ZN(t,e){return ZN=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ZN(t,e)}function JN(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=eI(t);if(e){var i=eI(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return QN(this,n)}}function QN(t,e){return!e||"object"!==XN(e)&&"function"!=typeof e?tI(t):e}function tI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eI(t){return eI=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},eI(t)}function nI(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var rI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ZN(t,e)}(s,lA);var e,n,r,i=JN(s);function s(){var t;YN(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return nI(tI(t=i.call.apply(i,[this].concat(n))),"priority",120),nI(tI(t),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"q":case"qq":return qA(e.length,t);case"qo":return n.ordinalNumber(t,{unit:"quarter"});case"qqq":return n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(t,{width:"narrow",context:"standalone"});default:return n.quarter(t,{width:"wide",context:"standalone"})||n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=1&&e<=4}},{key:"set",value:function(t,e,n){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t}}],n&&KN(e.prototype,n),r&&KN(e,r),s}();function iI(t){return iI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iI(t)}function sI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function aI(t,e){return aI=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},aI(t,e)}function lI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=hI(t);if(e){var i=hI(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return cI(this,n)}}function cI(t,e){return!e||"object"!==iI(e)&&"function"!=typeof e?uI(t):e}function uI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hI(t){return hI=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hI(t)}function dI(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&aI(t,e)}(s,lA);var e,n,r,i=lI(s);function s(){var t;sI(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return dI(uI(t=i.call.apply(i,[this].concat(n))),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),dI(uI(t),"priority",110),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return t-1};switch(e){case"M":return jA(WA(vA,t),r);case"MM":return jA(qA(2,t),r);case"Mo":return jA(n.ordinalNumber(t,{unit:"month"}),r);case"MMM":return n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(t,{width:"narrow",context:"formatting"});default:return n.month(t,{width:"wide",context:"formatting"})||n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t}}],n&&oI(e.prototype,n),r&&oI(e,r),s}();function fI(t){return fI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fI(t)}function mI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yI(t,e){return yI=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yI(t,e)}function bI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wI(t);if(e){var i=wI(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return vI(this,n)}}function vI(t,e){return!e||"object"!==fI(e)&&"function"!=typeof e?xI(t):e}function xI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wI(t){return wI=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wI(t)}function SI(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yI(t,e)}(s,lA);var e,n,r,i=bI(s);function s(){var t;mI(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return SI(xI(t=i.call.apply(i,[this].concat(n))),"priority",110),SI(xI(t),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return t-1};switch(e){case"L":return jA(WA(vA,t),r);case"LL":return jA(qA(2,t),r);case"Lo":return jA(n.ordinalNumber(t,{unit:"month"}),r);case"LLL":return n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(t,{width:"narrow",context:"standalone"});default:return n.month(t,{width:"wide",context:"standalone"})||n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t}}],n&&gI(e.prototype,n),r&&gI(e,r),s}();function kI(t){return kI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kI(t)}function TI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function EI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function MI(t,e){return MI=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},MI(t,e)}function CI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=II(t);if(e){var i=II(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return AI(this,n)}}function AI(t,e){return!e||"object"!==kI(e)&&"function"!=typeof e?NI(t):e}function NI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function II(t){return II=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},II(t)}function $I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var RI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&MI(t,e)}(s,lA);var e,n,r,i=CI(s);function s(){var t;TI(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return $I(NI(t=i.call.apply(i,[this].concat(n))),"priority",100),$I(NI(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"w":return WA(SA,t);case"wo":return n.ordinalNumber(t,{unit:"week"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=53}},{key:"set",value:function(t,e,n,r){return $C(function(t,e,n){dC(2,arguments);var r=fC(t),i=hC(e),s=PC(r,n)-i;return r.setUTCDate(r.getUTCDate()-7*s),r}(t,n,r),r)}}],n&&EI(e.prototype,n),r&&EI(e,r),s}();function OI(t){return OI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},OI(t)}function PI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function LI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function DI(t,e){return DI=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},DI(t,e)}function FI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=UI(t);if(e){var i=UI(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return zI(this,n)}}function zI(t,e){return!e||"object"!==OI(e)&&"function"!=typeof e?BI(t):e}function BI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function UI(t){return UI=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},UI(t)}function VI(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var jI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&DI(t,e)}(s,lA);var e,n,r,i=FI(s);function s(){var t;PI(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return VI(BI(t=i.call.apply(i,[this].concat(n))),"priority",100),VI(BI(t),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"I":return WA(SA,t);case"Io":return n.ordinalNumber(t,{unit:"week"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=53}},{key:"set",value:function(t,e,n){return CC(function(t,e){dC(2,arguments);var n=fC(t),r=hC(e),i=IC(n)-r;return n.setUTCDate(n.getUTCDate()-7*i),n}(t,n))}}],n&&LI(e.prototype,n),r&&LI(e,r),s}();function WI(t){return WI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WI(t)}function HI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qI(t,e){return qI=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qI(t,e)}function XI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ZI(t);if(e){var i=ZI(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return YI(this,n)}}function YI(t,e){return!e||"object"!==WI(e)&&"function"!=typeof e?KI(t):e}function KI(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ZI(t){return ZI=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ZI(t)}function JI(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var QI=[31,28,31,30,31,30,31,31,30,31,30,31],t$=[31,29,31,30,31,30,31,31,30,31,30,31],e$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qI(t,e)}(s,lA);var e,n,r,i=XI(s);function s(){var t;HI(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return JI(KI(t=i.call.apply(i,[this].concat(n))),"priority",90),JI(KI(t),"subPriority",1),JI(KI(t),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"d":return WA(xA,t);case"do":return n.ordinalNumber(t,{unit:"date"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){var n=ZA(t.getUTCFullYear()),r=t.getUTCMonth();return n?e>=1&&e<=t$[r]:e>=1&&e<=QI[r]}},{key:"set",value:function(t,e,n){return t.setUTCDate(n),t.setUTCHours(0,0,0,0),t}}],n&&GI(e.prototype,n),r&&GI(e,r),s}();function n$(t){return n$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n$(t)}function r$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s$(t,e){return s$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s$(t,e)}function o$(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c$(t);if(e){var i=c$(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a$(this,n)}}function a$(t,e){return!e||"object"!==n$(e)&&"function"!=typeof e?l$(t):e}function l$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c$(t){return c$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c$(t)}function u$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s$(t,e)}(s,lA);var e,n,r,i=o$(s);function s(){var t;r$(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return u$(l$(t=i.call.apply(i,[this].concat(n))),"priority",90),u$(l$(t),"subpriority",1),u$(l$(t),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"D":case"DD":return WA(wA,t);case"Do":return n.ordinalNumber(t,{unit:"date"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return ZA(t.getUTCFullYear())?e>=1&&e<=366:e>=1&&e<=365}},{key:"set",value:function(t,e,n){return t.setUTCMonth(0,n),t.setUTCHours(0,0,0,0),t}}],n&&i$(e.prototype,n),r&&i$(e,r),s}();function d$(t,e,n){var r,i,s,o,a,l,c,u;dC(2,arguments);var h=gC(),d=hC(null!==(r=null!==(i=null!==(s=null!==(o=null==n?void 0:n.weekStartsOn)&&void 0!==o?o:null==n||null===(a=n.locale)||void 0===a||null===(l=a.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==s?s:h.weekStartsOn)&&void 0!==i?i:null===(c=h.locale)||void 0===c||null===(u=c.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==r?r:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=fC(t),f=hC(e),m=p.getUTCDay(),g=f%7,y=(g+7)%7,b=(y<d?7:0)+f-m;return p.setUTCDate(p.getUTCDate()+b),p}function p$(t){return p$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p$(t)}function f$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g$(t,e){return g$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},g$(t,e)}function y$(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=x$(t);if(e){var i=x$(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b$(this,n)}}function b$(t,e){return!e||"object"!==p$(e)&&"function"!=typeof e?v$(t):e}function v$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x$(t){return x$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},x$(t)}function w$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var S$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g$(t,e)}(s,lA);var e,n,r,i=y$(s);function s(){var t;f$(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return w$(v$(t=i.call.apply(i,[this].concat(n))),"priority",90),w$(v$(t),"incompatibleTokens",["D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"E":case"EE":case"EEE":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=d$(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&m$(e.prototype,n),r&&m$(e,r),s}();function _$(t){return _$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_$(t)}function k$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function E$(t,e){return E$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},E$(t,e)}function M$(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=N$(t);if(e){var i=N$(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return C$(this,n)}}function C$(t,e){return!e||"object"!==_$(e)&&"function"!=typeof e?A$(t):e}function A$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N$(t){return N$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},N$(t)}function I$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E$(t,e)}(s,lA);var e,n,r,i=M$(s);function s(){var t;k$(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return I$(A$(t=i.call.apply(i,[this].concat(n))),"priority",90),I$(A$(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n,r){var i=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"e":case"ee":return jA(qA(e.length,t),i);case"eo":return jA(n.ordinalNumber(t,{unit:"day"}),i);case"eee":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"eeeee":return n.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=d$(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&T$(e.prototype,n),r&&T$(e,r),s}();function R$(t){return R$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R$(t)}function O$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L$(t,e){return L$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},L$(t,e)}function D$(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=B$(t);if(e){var i=B$(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return F$(this,n)}}function F$(t,e){return!e||"object"!==R$(e)&&"function"!=typeof e?z$(t):e}function z$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B$(t){return B$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},B$(t)}function U$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L$(t,e)}(s,lA);var e,n,r,i=D$(s);function s(){var t;O$(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return U$(z$(t=i.call.apply(i,[this].concat(n))),"priority",90),U$(z$(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n,r){var i=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"c":case"cc":return jA(qA(e.length,t),i);case"co":return jA(n.ordinalNumber(t,{unit:"day"}),i);case"ccc":return n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});case"ccccc":return n.day(t,{width:"narrow",context:"standalone"});case"cccccc":return n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});default:return n.day(t,{width:"wide",context:"standalone"})||n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=d$(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&P$(e.prototype,n),r&&P$(e,r),s}();function j$(t){return j$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j$(t)}function W$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G$(t,e){return G$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},G$(t,e)}function q$(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=K$(t);if(e){var i=K$(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return X$(this,n)}}function X$(t,e){return!e||"object"!==j$(e)&&"function"!=typeof e?Y$(t):e}function Y$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function K$(t){return K$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},K$(t)}function Z$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var J$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G$(t,e)}(s,lA);var e,n,r,i=q$(s);function s(){var t;W$(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Z$(Y$(t=i.call.apply(i,[this].concat(n))),"priority",90),Z$(Y$(t),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return 0===t?7:t};switch(e){case"i":case"ii":return qA(e.length,t);case"io":return n.ordinalNumber(t,{unit:"day"});case"iii":return jA(n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r);case"iiiii":return jA(n.day(t,{width:"narrow",context:"formatting"}),r);case"iiiiii":return jA(n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r);default:return jA(n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r)}}},{key:"validate",value:function(t,e){return e>=1&&e<=7}},{key:"set",value:function(t,e,n){return t=function(t,e){dC(2,arguments);var n=hC(e);n%7==0&&(n-=7);var r=1,i=fC(t),s=i.getUTCDay(),o=((n%7+7)%7<r?7:0)+n-s;return i.setUTCDate(i.getUTCDate()+o),i}(t,n),t.setUTCHours(0,0,0,0),t}}],n&&H$(e.prototype,n),r&&H$(e,r),s}();function Q$(t){return Q$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q$(t)}function tR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function eR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nR(t,e){return nR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nR(t,e)}function rR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=oR(t);if(e){var i=oR(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return iR(this,n)}}function iR(t,e){return!e||"object"!==Q$(e)&&"function"!=typeof e?sR(t):e}function sR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oR(t){return oR=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},oR(t)}function aR(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var lR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nR(t,e)}(s,lA);var e,n,r,i=rR(s);function s(){var t;tR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return aR(sR(t=i.call.apply(i,[this].concat(n))),"priority",80),aR(sR(t),"incompatibleTokens",["b","B","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"a":case"aa":case"aaa":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(YA(n),0,0,0),t}}],n&&eR(e.prototype,n),r&&eR(e,r),s}();function cR(t){return cR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cR(t)}function uR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dR(t,e){return dR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},dR(t,e)}function pR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gR(t);if(e){var i=gR(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fR(this,n)}}function fR(t,e){return!e||"object"!==cR(e)&&"function"!=typeof e?mR(t):e}function mR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gR(t){return gR=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gR(t)}function yR(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dR(t,e)}(s,lA);var e,n,r,i=pR(s);function s(){var t;uR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return yR(mR(t=i.call.apply(i,[this].concat(n))),"priority",80),yR(mR(t),"incompatibleTokens",["a","B","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"b":case"bb":case"bbb":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(YA(n),0,0,0),t}}],n&&hR(e.prototype,n),r&&hR(e,r),s}();function vR(t){return vR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vR(t)}function xR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function SR(t,e){return SR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},SR(t,e)}function _R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ER(t);if(e){var i=ER(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kR(this,n)}}function kR(t,e){return!e||"object"!==vR(e)&&"function"!=typeof e?TR(t):e}function TR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ER(t){return ER=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ER(t)}function MR(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var CR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&SR(t,e)}(s,lA);var e,n,r,i=_R(s);function s(){var t;xR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return MR(TR(t=i.call.apply(i,[this].concat(n))),"priority",80),MR(TR(t),"incompatibleTokens",["a","b","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"B":case"BB":case"BBB":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(YA(n),0,0,0),t}}],n&&wR(e.prototype,n),r&&wR(e,r),s}();function AR(t){return AR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AR(t)}function NR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function IR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $R(t,e){return $R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$R(t,e)}function RR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=LR(t);if(e){var i=LR(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return OR(this,n)}}function OR(t,e){return!e||"object"!==AR(e)&&"function"!=typeof e?PR(t):e}function PR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function LR(t){return LR=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},LR(t)}function DR(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var FR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$R(t,e)}(s,lA);var e,n,r,i=RR(s);function s(){var t;NR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return DR(PR(t=i.call.apply(i,[this].concat(n))),"priority",70),DR(PR(t),"incompatibleTokens",["H","K","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"h":return WA(EA,t);case"ho":return n.ordinalNumber(t,{unit:"hour"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=12}},{key:"set",value:function(t,e,n){var r=t.getUTCHours()>=12;return r&&n<12?t.setUTCHours(n+12,0,0,0):r||12!==n?t.setUTCHours(n,0,0,0):t.setUTCHours(0,0,0,0),t}}],n&&IR(e.prototype,n),r&&IR(e,r),s}();function zR(t){return zR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zR(t)}function BR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function UR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function VR(t,e){return VR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},VR(t,e)}function jR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=GR(t);if(e){var i=GR(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return WR(this,n)}}function WR(t,e){return!e||"object"!==zR(e)&&"function"!=typeof e?HR(t):e}function HR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function GR(t){return GR=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},GR(t)}function qR(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var XR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&VR(t,e)}(s,lA);var e,n,r,i=jR(s);function s(){var t;BR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return qR(HR(t=i.call.apply(i,[this].concat(n))),"priority",70),qR(HR(t),"incompatibleTokens",["a","b","h","K","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"H":return WA(_A,t);case"Ho":return n.ordinalNumber(t,{unit:"hour"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=23}},{key:"set",value:function(t,e,n){return t.setUTCHours(n,0,0,0),t}}],n&&UR(e.prototype,n),r&&UR(e,r),s}();function YR(t){return YR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YR(t)}function KR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ZR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function JR(t,e){return JR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},JR(t,e)}function QR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=nO(t);if(e){var i=nO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return tO(this,n)}}function tO(t,e){return!e||"object"!==YR(e)&&"function"!=typeof e?eO(t):e}function eO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nO(t){return nO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nO(t)}function rO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var iO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&JR(t,e)}(s,lA);var e,n,r,i=QR(s);function s(){var t;KR(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return rO(eO(t=i.call.apply(i,[this].concat(n))),"priority",70),rO(eO(t),"incompatibleTokens",["h","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"K":return WA(TA,t);case"Ko":return n.ordinalNumber(t,{unit:"hour"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.getUTCHours()>=12&&n<12?t.setUTCHours(n+12,0,0,0):t.setUTCHours(n,0,0,0),t}}],n&&ZR(e.prototype,n),r&&ZR(e,r),s}();function sO(t){return sO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sO(t)}function oO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function aO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lO(t,e){return lO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lO(t,e)}function cO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=dO(t);if(e){var i=dO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return uO(this,n)}}function uO(t,e){return!e||"object"!==sO(e)&&"function"!=typeof e?hO(t):e}function hO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dO(t){return dO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dO(t)}function pO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var fO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lO(t,e)}(s,lA);var e,n,r,i=cO(s);function s(){var t;oO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return pO(hO(t=i.call.apply(i,[this].concat(n))),"priority",70),pO(hO(t),"incompatibleTokens",["a","b","h","H","K","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"k":return WA(kA,t);case"ko":return n.ordinalNumber(t,{unit:"hour"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=24}},{key:"set",value:function(t,e,n){var r=n<=24?n%24:n;return t.setUTCHours(r,0,0,0),t}}],n&&aO(e.prototype,n),r&&aO(e,r),s}();function mO(t){return mO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mO(t)}function gO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bO(t,e){return bO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bO(t,e)}function vO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=SO(t);if(e){var i=SO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return xO(this,n)}}function xO(t,e){return!e||"object"!==mO(e)&&"function"!=typeof e?wO(t):e}function wO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function SO(t){return SO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},SO(t)}function _O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var kO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bO(t,e)}(s,lA);var e,n,r,i=vO(s);function s(){var t;gO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return _O(wO(t=i.call.apply(i,[this].concat(n))),"priority",60),_O(wO(t),"incompatibleTokens",["t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"m":return WA(MA,t);case"mo":return n.ordinalNumber(t,{unit:"minute"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=59}},{key:"set",value:function(t,e,n){return t.setUTCMinutes(n,0,0),t}}],n&&yO(e.prototype,n),r&&yO(e,r),s}();function TO(t){return TO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},TO(t)}function EO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function MO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function CO(t,e){return CO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},CO(t,e)}function AO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=$O(t);if(e){var i=$O(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return NO(this,n)}}function NO(t,e){return!e||"object"!==TO(e)&&"function"!=typeof e?IO(t):e}function IO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $O(t){return $O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$O(t)}function RO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var OO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&CO(t,e)}(s,lA);var e,n,r,i=AO(s);function s(){var t;EO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return RO(IO(t=i.call.apply(i,[this].concat(n))),"priority",50),RO(IO(t),"incompatibleTokens",["t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"s":return WA(CA,t);case"so":return n.ordinalNumber(t,{unit:"second"});default:return qA(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=59}},{key:"set",value:function(t,e,n){return t.setUTCSeconds(n,0),t}}],n&&MO(e.prototype,n),r&&MO(e,r),s}();function PO(t){return PO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PO(t)}function LO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function DO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function FO(t,e){return FO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},FO(t,e)}function zO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=VO(t);if(e){var i=VO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return BO(this,n)}}function BO(t,e){return!e||"object"!==PO(e)&&"function"!=typeof e?UO(t):e}function UO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function VO(t){return VO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},VO(t)}function jO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var WO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&FO(t,e)}(s,lA);var e,n,r,i=zO(s);function s(){var t;LO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return jO(UO(t=i.call.apply(i,[this].concat(n))),"priority",30),jO(UO(t),"incompatibleTokens",["t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return jA(qA(e.length,t),(function(t){return Math.floor(t*Math.pow(10,3-e.length))}))}},{key:"set",value:function(t,e,n){return t.setUTCMilliseconds(n),t}}])&&DO(e.prototype,n),r&&DO(e,r),s}();function HO(t){return HO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HO(t)}function GO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function XO(t,e){return XO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},XO(t,e)}function YO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=JO(t);if(e){var i=JO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return KO(this,n)}}function KO(t,e){return!e||"object"!==HO(e)&&"function"!=typeof e?ZO(t):e}function ZO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function JO(t){return JO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},JO(t)}function QO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var tP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&XO(t,e)}(s,lA);var e,n,r,i=YO(s);function s(){var t;GO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return QO(ZO(t=i.call.apply(i,[this].concat(n))),"priority",10),QO(ZO(t),"incompatibleTokens",["t","T","x"]),t}return e=s,(n=[{key:"parse",value:function(t,e){switch(e){case"X":return HA(FA,t);case"XX":return HA(zA,t);case"XXXX":return HA(BA,t);case"XXXXX":return HA(VA,t);default:return HA(UA,t)}}},{key:"set",value:function(t,e,n){return e.timestampIsSet?t:new Date(t.getTime()-n)}}])&&qO(e.prototype,n),r&&qO(e,r),s}();function eP(t){return eP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eP(t)}function nP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function iP(t,e){return iP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},iP(t,e)}function sP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=lP(t);if(e){var i=lP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return oP(this,n)}}function oP(t,e){return!e||"object"!==eP(e)&&"function"!=typeof e?aP(t):e}function aP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lP(t){return lP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},lP(t)}function cP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var uP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&iP(t,e)}(s,lA);var e,n,r,i=sP(s);function s(){var t;nP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return cP(aP(t=i.call.apply(i,[this].concat(n))),"priority",10),cP(aP(t),"incompatibleTokens",["t","T","X"]),t}return e=s,(n=[{key:"parse",value:function(t,e){switch(e){case"x":return HA(FA,t);case"xx":return HA(zA,t);case"xxxx":return HA(BA,t);case"xxxxx":return HA(VA,t);default:return HA(UA,t)}}},{key:"set",value:function(t,e,n){return e.timestampIsSet?t:new Date(t.getTime()-n)}}])&&rP(e.prototype,n),r&&rP(e,r),s}();function hP(t){return hP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hP(t)}function dP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function fP(t,e){return fP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fP(t,e)}function mP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bP(t);if(e){var i=bP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gP(this,n)}}function gP(t,e){return!e||"object"!==hP(e)&&"function"!=typeof e?yP(t):e}function yP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bP(t){return bP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bP(t)}function vP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var xP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fP(t,e)}(s,lA);var e,n,r,i=mP(s);function s(){var t;dP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return vP(yP(t=i.call.apply(i,[this].concat(n))),"priority",40),vP(yP(t),"incompatibleTokens","*"),t}return e=s,(n=[{key:"parse",value:function(t){return GA(t)}},{key:"set",value:function(t,e,n){return[new Date(1e3*n),{timestampIsSet:!0}]}}])&&pP(e.prototype,n),r&&pP(e,r),s}();function wP(t){return wP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wP(t)}function SP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function kP(t,e){return kP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},kP(t,e)}function TP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=CP(t);if(e){var i=CP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return EP(this,n)}}function EP(t,e){return!e||"object"!==wP(e)&&"function"!=typeof e?MP(t):e}function MP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function CP(t){return CP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},CP(t)}function AP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var NP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kP(t,e)}(s,lA);var e,n,r,i=TP(s);function s(){var t;SP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return AP(MP(t=i.call.apply(i,[this].concat(n))),"priority",20),AP(MP(t),"incompatibleTokens","*"),t}return e=s,(n=[{key:"parse",value:function(t){return GA(t)}},{key:"set",value:function(t,e,n){return[new Date(n),{timestampIsSet:!0}]}}])&&_P(e.prototype,n),r&&_P(e,r),s}();function IP(t){let e;return{c(){e=UT(t[1])},m(t,n){LT(t,e,n)},p(t,n){2&n&&XT(e,t[1])},i:uT,o:uT,d(t){t&&DT(e)}}}function $P(t){let e,n=t[1].toPrecision(2)+"";return{c(){e=UT(n)},m(t,n){LT(t,e,n)},p(t,r){2&r&&n!==(n=t[1].toPrecision(2)+"")&&XT(e,n)},i:uT,o:uT,d(t){t&&DT(e)}}}function RP(t){let e,n,r,i=UP(t[1]).join(", ")+"";return{c(){e=UT("Array("),n=UT(i),r=UT(")")},m(t,i){LT(t,e,i),LT(t,n,i),LT(t,r,i)},p(t,e){2&e&&i!==(i=UP(t[1]).join(", ")+"")&&XT(n,i)},i:uT,o:uT,d(t){t&&DT(e),t&&DT(n),t&&DT(r)}}}function OP(t){let e,n=t[3](t[1])+"";return{c(){e=UT(n)},m(t,n){LT(t,e,n)},p(t,r){2&r&&n!==(n=t[3](t[1])+"")&&XT(e,n)},i:uT,o:uT,d(t){t&&DT(e)}}}function PP(t){let e;const n=t[4].default,r=ST(n,t,t[7],null);return{c(){r&&r.c()},m(t,n){r&&r.m(t,n),e=!0},p(t,i){r&&r.p&&(!e||128&i)&&TT(r,n,t,t[7],e?kT(n,t[7],i,null):ET(t[7]),null)},i(t){e||(FE(r,t),e=!0)},o(t){zE(r,t),e=!1},d(t){r&&r.d(t)}}}function LP(t){let e,n;return e=new nM({props:{size:"small",$$slots:{default:[zP]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};130&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function DP(t){let e,n,r,i,s=t[1].text+"";return{c(){e=zT("sl-button"),n=UT(s),qT(e,"type","text"),qT(e,"size","small")},m(s,o){LT(s,e,o),RT(e,n),r||(i=WT(e,"click",t[5]),r=!0)},p(t,e){2&e&&s!==(s=t[1].text+"")&&XT(n,s)},i:uT,o:uT,d(t){t&&DT(e),r=!1,i()}}}function FP(t){let e,n;return{c(){e=zT("img"),GT(e,"alt","thumbnail"),bT(e.src,n=t[1])||GT(e,"src",n),GT(e,"width","30"),GT(e,"height","30"),GT(e,"class","rounded-md")},m(t,n){LT(t,e,n)},p(t,r){2&r&&!bT(e.src,n=t[1])&&GT(e,"src",n)},i:uT,o:uT,d(t){t&&DT(e)}}}function zP(t){let e;return{c(){e=UT(t[1])},m(t,n){LT(t,e,n)},p(t,n){2&n&&XT(e,t[1])},d(t){t&&DT(e)}}}function BP(t){let e,n,r,i;const s=[FP,DP,LP,PP,OP,RP,$P,IP],o=[];function a(t,e){return"image"===t[0]?0:"link"===t[0]?1:"action"===t[0]?2:"slot"===t[0]?3:"date"===t[0]?4:"array"===t[0]?5:"number"==typeof t[1]?6:7}return n=a(t),r=o[n]=s[n](t),{c(){e=zT("td"),r.c(),GT(e,"class","svelte-1w1eb18")},m(t,r){LT(t,e,r),o[n].m(e,null),i=!0},p(t,[i]){let l=n;n=a(t),n===l?o[n].p(t,i):(LE(),zE(o[l],1,1,(()=>{o[l]=null})),DE(),r=o[n],r?r.p(t,i):(r=o[n]=s[n](t),r.c()),FE(r,1),r.m(e,null))},i(t){i||(FE(r),i=!0)},o(t){zE(r),i=!1},d(t){t&&DT(e),o[n].d()}}}function UP(t){return Array.isArray(t)?t.length>0&&Array.isArray(t[0])?[t.length,...UP(t[0])]:[t.length]:[]}function VP(t,e,n){let{$$slots:r={},$$scope:i}=e,{type:s="generic"}=e,{value:o=null}=e;const a=fE();return t.$$set=t=>{"type"in t&&n(0,s=t.type),"value"in t&&n(1,o=t.value),"$$scope"in t&&n(7,i=t.$$scope)},[s,o,a,function(t){try{return function(t,e){return dC(1,arguments),KC(t,Date.now(),e)}(Date.parse(t),{includeSeconds:!0,addSuffix:!0})}catch(e){return console.log("Date Parsing Error",t,e),t}},r,()=>{console.log("GOTO:",o.href)},()=>a("action",o),i]}new bA,new aN,new yN,new MN,new DN,new qN,new rI,new pI,new _I,new RI,new jI,new e$,new h$,new S$,new $$,new V$,new J$,new lR,new bR,new CR,new FR,new XR,new iO,new fO,new kO,new OO,new WO,new tP,new uP,new xP,new NP;class jP extends QE{constructor(t){super(),JE(this,t,VP,BP,gT,{type:0,value:1})}}function WP(t){let e,n,r,i;const s=[GP,HP],o=[];function a(t,e){return t[2]?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=jT()},m(t,n){o[e].m(t,n),LT(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(LE(),zE(o[l],1,1,(()=>{o[l]=null})),DE(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),FE(n,1),n.m(r.parentNode,r))},i(t){i||(FE(n),i=!0)},o(t){zE(n),i=!1},d(t){o[e].d(t),t&&DT(r)}}}function HP(t){let e,n;return e=new nM({props:{round:!0,size:"small",$$slots:{default:[qP]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};64&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function GP(t){let e,n;return e=new nM({props:{round:!0,size:"small",$$slots:{default:[XP]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};64&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function qP(t){let e,n;return{c(){e=BT("svg"),n=BT("path"),GT(n,"stroke-linecap","round"),GT(n,"stroke-linejoin","round"),GT(n,"stroke-width","2"),GT(n,"d","M16 17l-4 4m0 0l-4-4m4 4V3"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"class","h-6 w-6"),GT(e,"fill","none"),GT(e,"viewBox","0 0 24 24"),GT(e,"stroke","currentColor")},m(t,r){LT(t,e,r),RT(e,n)},p:uT,d(t){t&&DT(e)}}}function XP(t){let e,n;return{c(){e=BT("svg"),n=BT("path"),GT(n,"stroke-linecap","round"),GT(n,"stroke-linejoin","round"),GT(n,"stroke-width","2"),GT(n,"d","M8 7l4-4m0 0l4 4m-4-4v18"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"class","h-6 w-6"),GT(e,"fill","none"),GT(e,"viewBox","0 0 24 24"),GT(e,"stroke","currentColor")},m(t,r){LT(t,e,r),RT(e,n)},p:uT,d(t){t&&DT(e)}}}function YP(t){let e,n,r,i,s,o,a=t[1]&&WP(t);return{c(){e=zT("th"),n=zT("span"),r=zT("span"),i=UT(t[0]),s=VT(),a&&a.c(),KT(r,"margin-top","0.5rem"),KT(r,"margin-bottom","0.5rem"),KT(n,"display","flex"),KT(n,"justify-content","space-between"),KT(n,"align-items","center"),GT(e,"class","svelte-1310j1m")},m(t,l){LT(t,e,l),RT(e,n),RT(n,r),RT(r,i),RT(n,s),a&&a.m(n,null),o=!0},p(t,[e]){(!o||1&e)&&XT(i,t[0]),t[1]?a?(a.p(t,e),2&e&&FE(a,1)):(a=WP(t),a.c(),FE(a,1),a.m(n,null)):a&&(LE(),zE(a,1,1,(()=>{a=null})),DE())},i(t){o||(FE(a),o=!0)},o(t){zE(a),o=!1},d(t){t&&DT(e),a&&a.d()}}}function KP(t,e,n){let{name:r="name"}=e,{sortable:i=!1}=e,{sorting:s={col:"",ascending:!0}}=e;const o=fE();let a=!0;return t.$$set=t=>{"name"in t&&n(0,r=t.name),"sortable"in t&&n(1,i=t.sortable),"sorting"in t&&n(4,s=t.sorting)},t.$$.update=()=>{17&t.$$.dirty&&s.col===r&&n(2,a=s.ascending)},[r,i,a,function(){n(2,a=!a),o("sort",{col:r,ascending:a})},s]}class ZP extends QE{constructor(t){super(),JE(this,t,KP,YP,gT,{name:0,sortable:1,sorting:4})}}function JP(t,e,n){const r=t.slice();return r[10]=e[n].name,r[11]=e[n].multiple,r[12]=e[n].confirm,r}function QP(t){let e,n=t[10]+"";return{c(){e=UT(n)},m(t,n){LT(t,e,n)},p(t,r){2&r&&n!==(n=t[10]+"")&&XT(e,n)},d(t){t&&DT(e)}}}function tL(t){let e,n;return e=new nM({props:{size:"small",disabled:!1===t[11]&&t[0].length>1,type:"delete"===t[10]?"danger":"default",$$slots:{default:[QP]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[7](t[10],t[12])})),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(n,r){t=n;const i={};3&r&&(i.disabled=!1===t[11]&&t[0].length>1),2&r&&(i.type="delete"===t[10]?"danger":"default"),32770&r&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function eL(t){let e,n;return e=new lM({props:{$$slots:{default:[iL]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};32780&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function nL(t){let e;return{c(){e=UT("Cancel")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function rL(t){let e;return{c(){e=UT("Confirm")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function iL(t){let e,n,r,i,s,o,a,l,c,u,h,d,p;return l=new nM({props:{type:"danger",$$slots:{default:[nL]},$$scope:{ctx:t}}}),l.$on("click",t[8]),d=new nM({props:{variant:"filled",$$slots:{default:[rL]},$$scope:{ctx:t}}}),d.$on("click",t[4]),{c(){e=zT("div"),n=zT("p"),r=UT("Do you want to "),i=UT(t[2]),s=UT(" the selected items?"),o=VT(),a=zT("div"),YE(l.$$.fragment),c=VT(),u=zT("span"),h=VT(),YE(d.$$.fragment),GT(u,"class","w-2"),GT(a,"class","w-full flex justify-end"),GT(e,"class","p-8")},m(t,f){LT(t,e,f),RT(e,n),RT(n,r),RT(n,i),RT(n,s),RT(e,o),RT(e,a),KE(l,a,null),RT(a,c),RT(a,u),RT(a,h),KE(d,a,null),p=!0},p(t,e){(!p||4&e)&&XT(i,t[2]);const n={};32768&e&&(n.$$scope={dirty:e,ctx:t}),l.$set(n);const r={};32768&e&&(r.$$scope={dirty:e,ctx:t}),d.$set(r)},i(t){p||(FE(l.$$.fragment,t),FE(d.$$.fragment,t),p=!0)},o(t){zE(l.$$.fragment,t),zE(d.$$.fragment,t),p=!1},d(t){t&&DT(e),ZE(l),ZE(d)}}}function sL(t){let e,n,r,i,s=t[1],o=[];for(let e=0;e<s.length;e+=1)o[e]=tL(JP(t,s,e));const a=t=>zE(o[t],1,1,(()=>{o[t]=null}));let l=t[3]&&eL(t);return{c(){e=zT("div");for(let t=0;t<o.length;t+=1)o[t].c();n=VT(),l&&l.c(),r=jT(),GT(e,"class","actions")},m(t,s){LT(t,e,s);for(let t=0;t<o.length;t+=1)o[t].m(e,null);LT(t,n,s),l&&l.m(t,s),LT(t,r,s),i=!0},p(t,[n]){if(35&n){let r;for(s=t[1],r=0;r<s.length;r+=1){const i=JP(t,s,r);o[r]?(o[r].p(i,n),FE(o[r],1)):(o[r]=tL(i),o[r].c(),FE(o[r],1),o[r].m(e,null))}for(LE(),r=s.length;r<o.length;r+=1)a(r);DE()}t[3]?l?(l.p(t,n),8&n&&FE(l,1)):(l=eL(t),l.c(),FE(l,1),l.m(r.parentNode,r)):l&&(LE(),zE(l,1,1,(()=>{l=null})),DE())},i(t){if(!i){for(let t=0;t<s.length;t+=1)FE(o[t]);FE(l),i=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)zE(o[t]);zE(l),i=!1},d(t){t&&DT(e),FT(o,t),t&&DT(n),l&&l.d(t),t&&DT(r)}}}function oL(t,e,n){let{provider:r}=e,{actions:i}=e,{selected:s}=e;const o=fE();let a="",l=!1;async function c(){if("delete"===a)for(const t of s)await r.delete(t);else o("action",[a,s]);n(3,l=!1),n(0,s=[]),o("selected",s)}function u(t,e){n(2,a=t),a&&0!==s.length&&(e?n(3,l=!0):c())}return t.$$set=t=>{"provider"in t&&n(6,r=t.provider),"actions"in t&&n(1,i=t.actions),"selected"in t&&n(0,s=t.selected)},[s,i,a,l,c,u,r,(t,e)=>u(t,e),()=>{n(3,l=!1)}]}class aL extends QE{constructor(t){super(),JE(this,t,oL,sL,gT,{provider:6,actions:1,selected:0})}}function lL(t){let e,n,r;function i(e){t[11](e)}let s={provider:t[1],actions:t[2]};return void 0!==t[0]&&(s.selected=t[0]),e=new aL({props:s}),bE.push((()=>XE(e,"selected",i))),e.$on("selected",t[12]),e.$on("action",t[13]),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};2&r&&(i.provider=t[1]),4&r&&(i.actions=t[2]),!n&&1&r&&(n=!0,i.selected=t[0],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function cL(t){let e,n;return{c(){e=BT("svg"),n=BT("path"),GT(n,"stroke-linecap","round"),GT(n,"stroke-linejoin","round"),GT(n,"stroke-width","2"),GT(n,"d","M15 19l-7-7 7-7"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"class","h-3 w-3"),GT(e,"fill","none"),GT(e,"viewBox","0 0 24 24"),GT(e,"stroke","currentColor")},m(t,r){LT(t,e,r),RT(e,n)},p:uT,d(t){t&&DT(e)}}}function uL(t){let e,n;return{c(){e=BT("svg"),n=BT("path"),GT(n,"stroke-linecap","round"),GT(n,"stroke-linejoin","round"),GT(n,"stroke-width","2"),GT(n,"d","M9 5l7 7-7 7"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"class","h-3 w-3"),GT(e,"fill","none"),GT(e,"viewBox","0 0 24 24"),GT(e,"stroke","currentColor")},m(t,r){LT(t,e,r),RT(e,n)},p:uT,d(t){t&&DT(e)}}}function hL(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,S,_,k,T,E=t[2].length>0&&t[0].length>0&&lL(t);return l=new GM({props:{size:"small",options:["10","20","50","all"],value:t[5].toString()}}),l.$on("change",t[14]),y=new nM({props:{round:!0,disabled:1===t[3],$$slots:{default:[cL]},$$scope:{ctx:t}}}),y.$on("click",t[15]),S=new nM({props:{round:!0,disabled:t[3]===t[6],$$slots:{default:[uL]},$$scope:{ctx:t}}}),S.$on("click",t[17]),{c(){e=zT("div"),n=zT("div"),E&&E.c(),r=VT(),i=zT("div"),s=zT("div"),o=UT("Items per page:\n\t\t\t"),a=zT("div"),YE(l.$$.fragment),c=VT(),u=zT("div"),h=UT(t[7]),d=UT("-"),p=UT(t[8]),f=UT(" of "),m=UT(t[4]),g=VT(),YE(y.$$.fragment),b=VT(),v=zT("input"),w=VT(),YE(S.$$.fragment),GT(n,"class","actions"),GT(a,"class","w-12 ml-2"),GT(s,"class","flex items-center mx-4"),GT(u,"class","mx-3"),GT(v,"class","marcelle w-8 rounded mr-1 mb-1 bg-white text-gray-600 border border-solid border-gray-300 text-center focus:outline-none focus:ring-blue-400 focus:ring-2 focus:ring-opacity-50 active:ring-blue-400 active:ring-4 active:ring-opacity-50"),v.value=x=t[3].toString(),GT(i,"class","flex items-center"),GT(e,"class","table-footer svelte-13k2ee6")},m(x,M){LT(x,e,M),RT(e,n),E&&E.m(n,null),RT(e,r),RT(e,i),RT(i,s),RT(s,o),RT(s,a),KE(l,a,null),RT(i,c),RT(i,u),RT(u,h),RT(u,d),RT(u,p),RT(u,f),RT(u,m),RT(i,g),KE(y,i,null),RT(i,b),RT(i,v),RT(i,w),KE(S,i,null),_=!0,k||(T=WT(v,"blur",t[16]),k=!0)},p(t,[e]){t[2].length>0&&t[0].length>0?E?(E.p(t,e),5&e&&FE(E,1)):(E=lL(t),E.c(),FE(E,1),E.m(n,null)):E&&(LE(),zE(E,1,1,(()=>{E=null})),DE());const r={};32&e&&(r.value=t[5].toString()),l.$set(r),(!_||128&e)&&XT(h,t[7]),(!_||256&e)&&XT(p,t[8]),(!_||16&e)&&XT(m,t[4]);const i={};8&e&&(i.disabled=1===t[3]),262144&e&&(i.$$scope={dirty:e,ctx:t}),y.$set(i),(!_||8&e&&x!==(x=t[3].toString())&&v.value!==x)&&(v.value=x);const s={};72&e&&(s.disabled=t[3]===t[6]),262144&e&&(s.$$scope={dirty:e,ctx:t}),S.$set(s)},i(t){_||(FE(E),FE(l.$$.fragment,t),FE(y.$$.fragment,t),FE(S.$$.fragment,t),_=!0)},o(t){zE(E),zE(l.$$.fragment,t),zE(y.$$.fragment,t),zE(S.$$.fragment,t),_=!1},d(t){t&&DT(e),E&&E.d(),ZE(l),ZE(y),ZE(S),k=!1,T()}}}function dL(t,e,n){let r,{provider:i}=e,{actions:s}=e,{selected:o}=e,a=1,l=1,c=0,u=0,h=0,d=()=>{};function p(t){n(3,a=t),i.page(t)}return t.$$set=t=>{"provider"in t&&n(1,i=t.provider),"actions"in t&&n(2,s=t.actions),"selected"in t&&n(0,o=t.selected)},t.$$.update=()=>{2&t.$$.dirty&&n(5,r=i.options.itemsPerPage),1082&t.$$.dirty&&(d(),n(10,d=i.total.subscribe((t=>{void 0===t||0===t?(n(6,l=1),n(7,c=0),n(8,u=0),n(4,h=0)):(n(6,l=Math.ceil(h/r)),n(7,c=(a-1)*r+1),n(8,u=Math.min(h||0,a*r)),n(4,h=t))}))))},[o,i,s,a,h,r,l,c,u,p,d,function(t){o=t,n(0,o)},function(e){gE.call(this,t,e)},function(e){gE.call(this,t,e)},({detail:t})=>{const e="all"===t?h:parseInt(t);i.paginate(e),n(5,r=e)},()=>{p(a-1)},t=>{let e=parseInt(t.currentTarget.value);isNaN(e)||p(Math.max(1,Math.min(l,e)))},()=>{p(a+1)}]}class pL extends QE{constructor(t){super(),JE(this,t,dL,hL,gT,{provider:1,actions:2,selected:0})}}function fL(t,e,n){const r=t.slice();return r[22]=e[n],r[24]=n,r}function mL(t,e,n){const r=t.slice();return r[25]=e[n].type,r[26]=e[n].name,r}function gL(t,e,n){const r=t.slice();return r[26]=e[n].name,r[29]=e[n].sortable,r}function yL(t){let e,n,r,i,s,o,a,l;return{c(){e=zT("div"),n=zT("sl-alert"),r=zT("sl-icon"),i=VT(),s=zT("strong"),s.textContent="Table Data Error",o=zT("br"),a=VT(),l=UT(t[9]),qT(r,"slot","icon"),qT(r,"name","check2-circle"),qT(n,"type","danger"),qT(n,"open",""),GT(e,"class","service-error")},m(t,c){LT(t,e,c),RT(e,n),RT(n,r),RT(n,i),RT(n,s),RT(n,o),RT(n,a),RT(n,l)},p(t,e){512&e[0]&&XT(l,t[9])},d(t){t&&DT(e)}}}function bL(t){let e,n=!t[4]&&vL(t);return{c(){e=zT("th"),n&&n.c(),GT(e,"class","svelte-12gp9na")},m(t,r){LT(t,e,r),n&&n.m(e,null)},p(t,r){t[4]?n&&(n.d(1),n=null):n?n.p(t,r):(n=vL(t),n.c(),n.m(e,null))},d(t){t&&DT(e),n&&n.d()}}}function vL(t){let e,n,r,i;return{c(){e=zT("input"),GT(e,"type","checkbox"),e.checked=n=t[6].length>0&&t[6].length===t[10].length},m(n,s){LT(n,e,s),r||(i=WT(e,"click",t[12]),r=!0)},p(t,r){1088&r[0]&&n!==(n=t[6].length>0&&t[6].length===t[10].length)&&(e.checked=n)},d(t){t&&DT(e),r=!1,i()}}}function xL(t){let e,n;return e=new ZP({props:{name:t[26],sortable:t[29],sorting:t[7]}}),e.$on("sort",t[11]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};1&n[0]&&(r.name=t[26]),1&n[0]&&(r.sortable=t[29]),128&n[0]&&(r.sorting=t[7]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function wL(t){let e,n;return e=new jP({props:{type:"slot",$$slots:{default:[SL]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};64&n[0]|2&n[1]&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function SL(t){let e,n,r,i;function s(...e){return t[16](t[24],...e)}return{c(){e=zT("input"),GT(e,"type","checkbox"),e.checked=n=t[6].includes(t[24])},m(t,n){LT(t,e,n),r||(i=WT(e,"click",s),r=!0)},p(r,i){t=r,64&i[0]&&n!==(n=t[6].includes(t[24]))&&(e.checked=n)},d(t){t&&DT(e),r=!1,i()}}}function _L(t){let e,n;return e=new jP({props:{type:t[25],value:t[22][t[26]]}}),e.$on("action",(function(...e){return t[17](t[24],...e)})),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(n,r){t=n;const i={};1&r[0]&&(i.type=t[25]),1025&r[0]&&(i.value=t[22][t[26]]),e.$set(i)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function kL(t){let e,n,r,i,s=t[3]&&wL(t),o=t[0],a=[];for(let e=0;e<o.length;e+=1)a[e]=_L(mL(t,o,e));const l=t=>zE(a[t],1,1,(()=>{a[t]=null}));return{c(){e=zT("tr"),s&&s.c(),n=VT();for(let t=0;t<a.length;t+=1)a[t].c();r=VT(),GT(e,"class","svelte-12gp9na")},m(t,o){LT(t,e,o),s&&s.m(e,null),RT(e,n);for(let t=0;t<a.length;t+=1)a[t].m(e,null);RT(e,r),i=!0},p(t,i){if(t[3]?s?(s.p(t,i),8&i[0]&&FE(s,1)):(s=wL(t),s.c(),FE(s,1),s.m(e,n)):s&&(LE(),zE(s,1,1,(()=>{s=null})),DE()),17409&i[0]){let n;for(o=t[0],n=0;n<o.length;n+=1){const s=mL(t,o,n);a[n]?(a[n].p(s,i),FE(a[n],1)):(a[n]=_L(s),a[n].c(),FE(a[n],1),a[n].m(e,r))}for(LE(),n=o.length;n<a.length;n+=1)l(n);DE()}},i(t){if(!i){FE(s);for(let t=0;t<o.length;t+=1)FE(a[t]);i=!0}},o(t){zE(s),a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)zE(a[t]);i=!1},d(t){t&&DT(e),s&&s.d(),FT(a,t)}}}function TL(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[9]&&yL(t),f=t[3]&&bL(t),m=t[0],g=[];for(let e=0;e<m.length;e+=1)g[e]=xL(gL(t,m,e));const y=t=>zE(g[t],1,1,(()=>{g[t]=null}));let b=t[10],v=[];for(let e=0;e<b.length;e+=1)v[e]=kL(fL(t,b,e));const x=t=>zE(v[t],1,1,(()=>{v[t]=null}));function w(e){t[18](e)}let S={provider:t[1],actions:t[2]};return void 0!==t[6]&&(S.selected=t[6]),u=new pL({props:S}),bE.push((()=>XE(u,"selected",w))),u.$on("action",t[19]),{c(){p&&p.c(),e=VT(),n=zT("div"),r=zT("table"),i=zT("thead"),s=zT("tr"),f&&f.c(),o=VT();for(let t=0;t<g.length;t+=1)g[t].c();a=VT(),l=zT("tbody");for(let t=0;t<v.length;t+=1)v[t].c();c=VT(),YE(u.$$.fragment),GT(s,"class","svelte-12gp9na"),GT(i,"class","svelte-12gp9na"),GT(l,"class","svelte-12gp9na"),GT(r,"class","svelte-12gp9na"),GT(n,"class","marcelle table-container svelte-12gp9na")},m(t,h){p&&p.m(t,h),LT(t,e,h),LT(t,n,h),RT(n,r),RT(r,i),RT(i,s),f&&f.m(s,null),RT(s,o);for(let t=0;t<g.length;t+=1)g[t].m(s,null);RT(r,a),RT(r,l);for(let t=0;t<v.length;t+=1)v[t].m(l,null);RT(n,c),KE(u,n,null),d=!0},p(t,n){if(t[9]?p?p.p(t,n):(p=yL(t),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null),t[3]?f?f.p(t,n):(f=bL(t),f.c(),f.m(s,o)):f&&(f.d(1),f=null),2177&n[0]){let e;for(m=t[0],e=0;e<m.length;e+=1){const r=gL(t,m,e);g[e]?(g[e].p(r,n),FE(g[e],1)):(g[e]=xL(r),g[e].c(),FE(g[e],1),g[e].m(s,null))}for(LE(),e=m.length;e<g.length;e+=1)y(e);DE()}if(25673&n[0]){let e;for(b=t[10],e=0;e<b.length;e+=1){const r=fL(t,b,e);v[e]?(v[e].p(r,n),FE(v[e],1)):(v[e]=kL(r),v[e].c(),FE(v[e],1),v[e].m(l,null))}for(LE(),e=b.length;e<v.length;e+=1)x(e);DE()}const r={};2&n[0]&&(r.provider=t[1]),4&n[0]&&(r.actions=t[2]),!h&&64&n[0]&&(h=!0,r.selected=t[6],EE((()=>h=!1))),u.$set(r)},i(t){if(!d){for(let t=0;t<m.length;t+=1)FE(g[t]);for(let t=0;t<b.length;t+=1)FE(v[t]);FE(u.$$.fragment,t),d=!0}},o(t){g=g.filter(Boolean);for(let t=0;t<g.length;t+=1)zE(g[t]);v=v.filter(Boolean);for(let t=0;t<v.length;t+=1)zE(v[t]);zE(u.$$.fragment,t),d=!1},d(t){p&&p.d(t),t&&DT(e),t&&DT(n),f&&f.d(),FT(g,t),FT(v,t),ZE(u)}}}function EL(t,e,n){let r,i,s,o,a=uT,l=uT;t.$$.on_destroy.push((()=>a())),t.$$.on_destroy.push((()=>l()));let{columns:c}=e,{provider:u}=e,{actions:h=[]}=e,{selectable:d=!0}=e,{singleSelection:p=!1}=e,{selection:f=[]}=e,m=[];const g=fE();let y={col:"",ascending:!0};async function b(){n(15,f=await Promise.all(m.map(u.get.bind(u)))),g("selection",f)}function v(t,e){p?(n(6,m=e.currentTarget.checked?[t]:[]),b()):e.currentTarget.checked?m.includes(t)||(n(6,m=m.concat([t])),b()):(n(6,m=m.filter((e=>e!==t))),b())}async function x([t,e]){const n=Array.isArray(e)?await Promise.all(e.map(u.get.bind(u))):await u.get(e);g(t,n)}return t.$$set=t=>{"columns"in t&&n(0,c=t.columns),"provider"in t&&n(1,u=t.provider),"actions"in t&&n(2,h=t.actions),"selectable"in t&&n(3,d=t.selectable),"singleSelection"in t&&n(4,p=t.singleSelection),"selection"in t&&n(15,f=t.selection)},t.$$.update=()=>{2&t.$$.dirty[0]&&(n(5,r=u.data),l(),l=vT(r,(t=>n(10,o=t)))),2&t.$$.dirty[0]&&(n(8,i=u.error),a(),a=vT(i,(t=>n(9,s=t)))),32800&t.$$.dirty[0]&&n(6,m=f.map((t=>xT(r).indexOf(t))))},[c,u,h,d,p,r,m,y,i,s,o,function({detail:t}){n(7,y=t),u.sort(t)},function(){m.length===xT(r).length?n(6,m=[]):n(6,m=xT(r).map(((t,e)=>e))),b()},v,x,f,(t,e)=>v(t,e),(t,{detail:e})=>{x([e,t])},function(t){m=t,n(6,m),n(15,f),n(5,r),n(1,u)},({detail:t})=>x(t)]}class ML extends QE{constructor(t){super(),JE(this,t,EL,TL,gT,{columns:0,provider:1,actions:2,selectable:3,singleSelection:4,selection:15},null,[-1,-1])}}function CL(t){let e,n;const r=t[1].default,i=ST(r,t,t[0],null);return{c(){e=zT("div"),i&&i.c(),GT(e,"class","flex border-solid border-0 border-b border-gray-200 mb-2")},m(t,r){LT(t,e,r),i&&i.m(e,null),n=!0},p(t,[e]){i&&i.p&&(!n||1&e)&&TT(i,r,t,t[0],n?kT(r,t[0],e,null):ET(t[0]),null)},i(t){n||(FE(i,t),n=!0)},o(t){zE(i,t),n=!1},d(t){t&&DT(e),i&&i.d(t)}}}function AL(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=t=>{"$$scope"in t&&n(0,i=t.$$scope)},[i,r]}class NL extends QE{constructor(t){super(),JE(this,t,AL,CL,gT,{})}}const IL={itemsPerPage:10};class $L{options;data=QM([]);total=QM(0);error=QM(null);constructor(t=IL){this.options={...IL,...t}}paginate(t){this.options.itemsPerPage=t,this.update()}async get(t){const e=xT(this.data);return t>=0&&t<e.length?e[t]:null}}class RL extends $L{rawData;currentPage=1;constructor({data:t,...e}){super(e),this.rawData=t,this.total.set(t.length),this.data.set(this.rawData.slice(0,this.options.itemsPerPage))}async update(){this.page(this.currentPage)}async page(t){this.data.set(this.rawData.slice((t-1)*this.options.itemsPerPage,Math.min(t*this.options.itemsPerPage,this.rawData.length))),this.currentPage=t}async sort(t){this.rawData.sort(((e,n)=>e[t.col]>n[t.col]?t.ascending?1:-1:e[t.col]<n[t.col]?t.ascending?-1:1:0)),this.page(this.currentPage)}async delete(t){return this.rawData.splice(t,1),this.page(this.currentPage),null}}class OL extends $L{service;query;transform;constructor({service:t,columns:e,transform:n,...r}){super(r),this.service=t,this.transform=n||{},this.query={$sort:{updatedAt:-1},$limit:this.options.itemsPerPage},e&&(this.query.$select=e.map((t=>t.name)).concat(["id"])),this.update(),this.service.on("created",this.update.bind(this)),this.service.on("patched",this.update.bind(this)),this.service.on("updated",this.update.bind(this)),this.service.on("removed",this.update.bind(this))}paginate(t){super.paginate(t),this.query.$limit=this.options.itemsPerPage,this.update()}async update(){try{const t=await this.service.find({query:this.query}),e=t.data.map(((t,e)=>{const n=Object.entries(this.transform).map((([n,r])=>{try{return{[n]:r(t,e)}}catch(t){return{[n]:"transform error"}}})).reduce(((t,e)=>({...t,...e})),{});return{...t,...n}}));this.data.set(e),this.total.set(t.total),this.error.set(null)}catch(t){this.data.set([]),this.total.set(0),this.error.set(t)}}async page(t){this.query.$skip=(t-1)*this.query.$limit,this.update()}async sort(t){const{col:e,ascending:n}=t;e?this.query.$sort={[e]:n?1:-1}:delete this.query.$sort,this.update()}async delete(t){const e=xT(this.data)[t];return await this.service.remove(e.id),this.update(),e}}function PL(t){let e,n,r;return n=new BM({props:{progress:t[2],thin:!0}}),{c(){e=zT("div"),YE(n.$$.fragment),GT(e,"class","absolute top-0 left-0 right-0")},m(t,i){LT(t,e,i),KE(n,e,null),r=!0},p(t,e){const r={};4&e&&(r.progress=t[2]),n.$set(r)},i(t){r||(FE(n.$$.fragment,t),r=!0)},o(t){zE(n.$$.fragment,t),r=!1},d(t){t&&DT(e),ZE(n)}}}function LL(t){let e,n;return e=new XM({}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function DL(t){let e,n,r,i,s,o,a,l=!1!==t[2]&&PL(t),c=t[1]&&LL();const u=t[4].default,h=ST(u,t,t[3],null);return{c(){e=zT("div"),l&&l.c(),n=VT(),r=zT("span"),i=UT(t[0]),s=VT(),c&&c.c(),o=VT(),h&&h.c(),GT(r,"class","card-title"),GT(e,"class","card-container svelte-xnhseh")},m(t,u){LT(t,e,u),l&&l.m(e,null),RT(e,n),RT(e,r),RT(r,i),RT(e,s),c&&c.m(e,null),RT(e,o),h&&h.m(e,null),a=!0},p(t,[r]){!1!==t[2]?l?(l.p(t,r),4&r&&FE(l,1)):(l=PL(t),l.c(),FE(l,1),l.m(e,n)):l&&(LE(),zE(l,1,1,(()=>{l=null})),DE()),(!a||1&r)&&XT(i,t[0]),t[1]?c?2&r&&FE(c,1):(c=LL(),c.c(),FE(c,1),c.m(e,o)):c&&(LE(),zE(c,1,1,(()=>{c=null})),DE()),h&&h.p&&(!a||8&r)&&TT(h,u,t,t[3],a?kT(u,t[3],r,null):ET(t[3]),null)},i(t){a||(FE(l),FE(c),FE(h,t),a=!0)},o(t){zE(l),zE(c),zE(h,t),a=!1},d(t){t&&DT(e),l&&l.d(),c&&c.d(),h&&h.d(t)}}}function FL(t,e,n){let{$$slots:r={},$$scope:i}=e,{title:s}=e,{loading:o=!1}=e,{progress:a=!1}=e;return t.$$set=t=>{"title"in t&&n(0,s=t.title),"loading"in t&&n(1,o=t.loading),"progress"in t&&n(2,a=t.progress),"$$scope"in t&&n(3,i=t.$$scope)},[s,o,a,i,r]}class zL extends QE{constructor(t){super(),JE(this,t,FL,DL,gT,{title:0,loading:1,progress:2})}}let BL,UL;function VL({title:t,message:e,duration:n=3e3,type:r="default"}){BL||(BL=document.createElement("div"),BL.id="notification-container",document.body.appendChild(BL),UL=new wM({target:BL})),null==UL||UL.add({title:t,message:e,duration:n,type:r})}
/** @license MIT License (c) copyright 2010-2016 original author or authors */function jL(t,e){for(var n=e.length,r=new Array(n+1),i=0;i<n;++i)r[i]=e[i];return r[n]=t,r}function WL(t,e,n){for(var r=e,i=0,s=n.length;i<s;++i)r=t(r,n[i],i);return r}function HL(t,e){if(t<0)throw new TypeError("i must be >= 0");var n=e.length;return 0===n||t>=n?e:1===n?[]:function(t,e,n){var r,i=new Array(n);for(r=0;r<t;++r)i[r]=e[r];for(r=t;r<n;++r)i[r]=e[r+1];return i}(t,e,n-1)}function GL(t,e){for(var n=0,r=e.length;n<r;++n)if(t===e[n])return n;return-1}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var qL=function(t){return t},XL=function(t,e){return t(e)};function YL(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return function(e){return t(n,e)};default:return t(n,r)}}}function KL(t){return function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return YL((function(e,r){return t(n,e,r)}));case 2:return function(e){return t(n,r,e)};default:return t(n,r,i)}}}var ZL=function(){function t(t,e,n,r,i){this.time=t,this.localOffset=e,this.period=n,this.task=r,this.scheduler=i,this.active=!0}return t.prototype.run=function(){return this.task.run(this.time-this.localOffset)},t.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},t.prototype.dispose=function(){return this.active=!1,this.scheduler.cancel(this),this.task.dispose()},t}(),JL=function(){function t(t,e){this.origin=t,this.scheduler=e}return t.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},t.prototype.scheduleTask=function(t,e,n,r){return this.scheduler.scheduleTask(t+this.origin,e,n,r)},t.prototype.relative=function(e){return new t(e+this.origin,this.scheduler)},t.prototype.cancel=function(t){return this.scheduler.cancel(t)},t.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)},t}();function QL(t){try{return t.run()}catch(e){return t.error(e)}}
/** @license MIT License (c) copyright 2010-2017 original author or authors */var tD=function(){function t(t,e){var n=this;this._runReadyTasksBound=function(){return n._runReadyTasks()},this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0}return t.prototype.currentTime=function(){return this.timer.now()},t.prototype.scheduleTask=function(t,e,n,r){var i=this.currentTime()+Math.max(0,e),s=new ZL(i,t,n,r,this);return this.timeline.add(s),this._scheduleNextRun(),s},t.prototype.relative=function(t){return new JL(t,this)},t.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},t.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},t.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun()},t.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},t.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},t.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},t.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),QL),this._scheduleNextRun()},t}(),eD=function(){function t(){this.tasks=[]}return t.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},t.prototype.isEmpty=function(){return 0===this.tasks.length},t.prototype.add=function(t){rD(t,this.tasks)},t.prototype.remove=function(t){var e=oD(iD(t),this.tasks);if(e>=0&&e<this.tasks.length){var n=this.tasks[e].events,r=GL(t,n);if(r>=0)return n.splice(r,1),0===n.length&&this.tasks.splice(e,1),!0}return!1},t.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)sD(t,this.tasks[e])},t.prototype.runTasks=function(t,e){for(var n=this.tasks,r=n.length,i=0;i<r&&n[i].time<=t;)++i;this.tasks=n.slice(i);for(var s=0;s<i;++s)this.tasks=nD(e,n[s].events,this.tasks)},t}();
/** @license MIT License (c) copyright 2010-2017 original author or authors */function nD(t,e,n){for(var r=0;r<e.length;++r){var i=e[r];i.active&&(t(i),i.period>=0&&i.active&&(i.time=i.time+i.period,rD(i,n)))}return n}function rD(t,e){var n=e.length,r=iD(t);if(0!==n){var i=oD(r,e);i>=n?e.push(aD(r,[t])):function(t,e,n,r){var i=e[r];n===i.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var n=0;n<e.length;n++)if(t.time<e[n].time){e.splice(n,0,t);break}}(t,e)}(t,i.events):e.splice(r,0,aD(n,[t]))}(t,e,r,i)}else e.push(aD(r,[t]))}function iD(t){return Math.floor(t.time)}function sD(t,e){e.events=function(t,e){for(var n=e.length,r=new Array(n),i=0,s=void 0,o=0;o<n;++o)t(s=e[o])||(r[i]=s,++i);return r.length=i,r}(t,e.events)}function oD(t,e){for(var n,r,i=0,s=e.length;i<s;){if(t===(r=e[n=Math.floor((i+s)/2)]).time)return n;t<r.time?s=n:i=n+1}return s}var aD=function(t,e){return{time:t,events:e}},lD=function(){function t(t){this._clock=t}return t.prototype.now=function(){return this._clock.now()},t.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new cD(t);return function(t){Promise.resolve(t).then(QL)}(e),e}(t):setTimeout(t,e)},t.prototype.clearTimer=function(t){return t instanceof cD?t.cancel():clearTimeout(t)},t}(),cD=function(){function t(t){this.f=t,this.active=!0}return t.prototype.run=function(){if(this.active)return this.f()},t.prototype.error=function(t){throw t},t.prototype.cancel=function(){this.active=!1},t}();
/** @license MIT License (c) copyright 2010-2017 original author or authors */var uD=function(){function t(t,e){this.origin=e,this.clock=t}return t.prototype.now=function(){return this.clock.now()-this.origin},t}(),hD=function(){function t(t,e){this.origin=e,this.hrtime=t}return t.prototype.now=function(){var t=this.hrtime(this.origin);return(1e9*t[0]+t[1])/1e6},t}(),dD=function(t){return new uD(t,t.now())},pD=function(){return"undefined"!=typeof performance&&"function"==typeof performance.now?dD(performance):"undefined"!=typeof process&&"function"==typeof process.hrtime?new hD(process.hrtime,process.hrtime()):dD(Date)},fD=function(t){return t.currentTime()},mD=YL((function(t,e){return e.scheduleTask(0,0,-1,t)})),gD=KL((function(t,e,n){return n.scheduleTask(0,t,-1,e)})),yD=KL((function(t,e,n){return n.scheduleTask(0,0,t,e)})),bD=function(t){return t.dispose()},vD=YL((function(t,e){return new JL(t,e)})),xD=function(){return new lD(pD())},wD=function(){return SD},SD=new(function(){function t(){}return t.prototype.dispose=function(){},t}()),_D=function(t){return new kD(t)},kD=function(){function t(t){this.disposed=!1,this.disposable=t}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable&&(this.disposable.dispose(),this.disposable=void 0))},t}(),TD=function(t){var e=WL(MD,[],t);return 0===e.length?wD():new CD(e)},ED=YL((function(t,e){return TD([t,e])})),MD=function(t,e){return function(t){return t===SD}(e)?t:e instanceof CD?function(t,e){var n=t.length,r=e.length,i=new Array(n+r),s=0;for(s=0;s<n;s++)i[s]=t[s];for(var o=0;o<r;o++)i[s++]=e[o];return i}(t,e.disposables):jL(e,t)},CD=function(){function t(t){this.disposables=t}return t.prototype.dispose=function(){ID(AD(this.disposables))},t}(),AD=function(t){return WL(ND,[],t)},ND=function(t,e){try{e.dispose()}catch(e){t.push(e)}return t},ID=function(t){if(t.length>0)throw new $D(t.length+" errors",t)},$D=function t(e,n){this.name="DisposeAllError",this.message=e,this.errors=n,Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.stack=""+this.stack+RD(this.errors)};$D.prototype=Object.create(Error.prototype);var RD=function(t){return WL(OD,"",t)},OD=function(t,e,n){return t+"\n["+(n+1)+"] "+e.stack},PD=KL((function(t,e,n){try{e.dispose()}catch(e){n.error(t,e)}})),LD=function(t,e){return LD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},LD(t,e)};function DD(t,e){function n(){this.constructor=t}LD(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}
/** @license MIT License (c) copyright 2010-2016 original author or authors */function FD(t){setTimeout(zD,0,t)}function zD(t){throw t}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var BD=function(t,e){return new WD(t,e)},UD=function(t){return new HD(t)},VD=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.dispose=function(){this.active=!1},t.prototype.run=function(t){this.active&&this.runIfActive(t)},t.prototype.error=function(t,e){if(!this.active)return FD(e);this.sink.error(t,e)},t}(),jD=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.runEvent=e,i.value=n,i}return DD(e,t),e.prototype.runIfActive=function(t){this.runEvent(t,this.value,this.sink)},e}(VD),WD=function(t){function e(e,n){var r=t.call(this,n)||this;return r.value=e,r}return DD(e,t),e.prototype.runIfActive=function(t){this.sink.event(t,this.value)},e}(VD),HD=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return DD(e,t),e.prototype.runIfActive=function(t){this.sink.end(t)},e}(VD),GD=function(t){function e(e,n){var r=t.call(this,n)||this;return r.value=e,r}return DD(e,t),e.prototype.runIfActive=function(t){this.sink.error(t,this.value)},e}(VD),qD=function(){return ZD},XD=function(t){return t===ZD},YD=function(t){return t.some(XD)},KD=function(){function t(){}return t.prototype.run=function(t,e){return mD(UD(t),e)},t}(),ZD=new KD,JD=function(){return QD},QD=new(function(){function t(){}return t.prototype.run=function(){return wD()},t}()),tF=function(t,e){return new eF(t,e)},eF=function(){function t(t,e){this.time=t,this.value=e}return t.prototype.run=function(t,e){return gD(this.time,function(t,e,n){return new jD(t,e,n)}(nF,this.value,t),e)},t}();function nF(t,e,n){n.event(t,e),n.end(t)}
/** @license MIT License (c) copyright 2010-2017 original author or authors */var rF=function(t){return tF(0,t)},iF=function(){function t(t){this.period=t}return t.prototype.run=function(t,e){return yD(this.period,BD(void 0,t),e)},t}(),sF=function(){function t(){this.disposable=void 0,this.disposed=!1}return t.prototype.setDisposable=function(t){if(void 0!==this.disposable)throw new Error("setDisposable called more than once");this.disposable=t,this.disposed&&t.dispose()},t.prototype.dispose=function(){this.disposed||(this.disposed=!0,void 0!==this.disposable&&this.disposable.dispose())},t}(),oF=YL((function(t,e){return new Promise((function(n,r){return function(t,e,n,r){var i=new sF,s=new aF(n,r,i);i.setDisposable(t.run(s,e))}(t,e,n,r)}))}));
/** @license MIT License (c) copyright 2010-2016 original author or authors */var aF=function(){function t(t,e,n){this._end=t,this._error=e,this._disposable=n,this.active=!0}return t.prototype.event=function(){},t.prototype.end=function(){this.active&&this.dispose(this._error,this._end,void 0)},t.prototype.error=function(t,e){this.dispose(this._error,this._error,e)},t.prototype.dispose=function(t,e,n){this.active=!1,function(t,e,n,r){try{r.dispose()}catch(e){return void t(e)}e(n)}(t,e,n,this._disposable)},t}();var lF=function(t,e,n){return n.run(t,e)},cF=function(){function t(t,e){this.sink=e,this.offset=t}return t.prototype.event=function(t,e){this.sink.event(t+this.offset,e)},t.prototype.error=function(t,e){this.sink.error(t+this.offset,e)},t.prototype.end=function(t){this.sink.end(t+this.offset)},t}(),uF=function(t,e){return new hF(t,e)},hF=function(){function t(t,e){this.origin=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(dF(this.origin,t),vD(this.origin,e))},t}(),dF=function(t,e){return e instanceof cF?new cF(t+e.offset,e.sink):new cF(t,e)},pF=function(){function t(t){this.sink=t}return t.prototype.end=function(t){return this.sink.end(t)},t.prototype.error=function(t,e){return this.sink.error(t,e)},t}(),fF=function(){function t(t,e,n){this.step=t,this.seed=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new mF(this.step,this.seed,t),e)},t}(),mF=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.step=e,i.seed=n,i}return DD(e,t),e.prototype.event=function(t,e){var n=this.step(this.seed,e);this.seed=n.seed,this.sink.event(t,n.value)},e}(pF),gF=function(){function t(t,e,n){this.source=n,this.f=t,this.value=e}return t.prototype.run=function(t,e){var n=mD(BD(this.value,t),e),r=this.source.run(new yF(this.f,this.value,t),e);return ED(n,r)},t}(),yF=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.f=e,i.value=n,i}return DD(e,t),e.prototype.event=function(t,e){var n=this.f;this.value=n(this.value,e),this.sink.event(t,this.value)},e}(pF),bF=function(t,e){return new vF(t,e)},vF=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new xF(this.f,this.source,t,e)},t}(),xF=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.f=e,s.scheduler=i,s.active=!0,s.disposable=_D(n.run(s,i)),s}return DD(e,t),e.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},e.prototype.end=function(t){this.active&&(PD(t,this.disposable,this.sink),this.startNext(t,this.sink))},e.prototype.startNext=function(t,e){try{this.disposable=this.continue(this.f,t,e)}catch(n){e.error(t,n)}},e.prototype.continue=function(t,e,n){return lF(n,this.scheduler,uF(e,t()))},e.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()},e}(pF),wF=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new SF(this.p,t),e)},t.create=function(e,n){return XD(n)?n:n instanceof t?new t(_F(n.p,e),n.source):new t(e,n)},t}(),SF=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r}return DD(e,t),e.prototype.event=function(t,e){(0,this.p)(e)&&this.sink.event(t,e)},e}(pF),_F=function(t,e){return function(n){return t(n)&&e(n)}},kF=function(){function t(t,e,n){this.p=t,this.f=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new TF(this.p,this.f,t),e)},t}(),TF=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.p=e,i.f=n,i}return DD(e,t),e.prototype.event=function(t,e){var n=this.f;(0,this.p)(e)&&this.sink.event(t,n(e))},e}(pF),EF=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new MF(this.f,t),e)},t.create=function(e,n){return XD(n)?qD():n instanceof t?new t(function(t,e){return function(n){return t(e(n))}}(e,n.f),n.source):n instanceof wF?new kF(n.p,e,n.source):new t(e,n)},t}(),MF=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r}return DD(e,t),e.prototype.event=function(t,e){var n=this.f;this.sink.event(t,n(e))},e}(pF),CF=function(t,e){return EF.create(t,e)},AF=function(){function t(t,e){this.source=e,this.f=t}return t.prototype.run=function(t,e){return this.source.run(new NF(this.f,t),e)},t}(),NF=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r}return DD(e,t),e.prototype.event=function(t,e){(0,this.f)(e),this.sink.event(t,e)},e}(pF),IF=function(t){function e(e,n){var r=t.call(this,n)||this;return r.index=e,r.active=!0,r.value=void 0,r}return DD(e,t),e.prototype.event=function(t,e){this.active&&(this.value=e,this.sink.event(t,this))},e.prototype.end=function(t){this.active&&(this.active=!1,this.sink.event(t,this))},e}(pF);
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function $F(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}
/** @license MIT License (c) copyright 2010 original author or authors */var RF=function(t,e,n){return OF(t,[e,n])},OF=function(t,e){return 0===e.length||YD(e)?qD():1===e.length?CF(t,e[0]):new PF(t,e)},PF=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new LF(r,i.length,t,this.f),o=void 0,a=0;a<n;++a)o=i[a]=new IF(a,s),r[a]=this.sources[a].run(o,e);return TD(r)},t}(),LF=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.disposables=e,s.f=i,s.awaiting=n,s.values=new Array(n),s.hasValue=new Array(n).fill(!1),s.activeCount=n,s}return DD(e,t),e.prototype.event=function(t,e){if(e.active){var n=e.index,r=this.updateReady(n);this.values[n]=e.value,0===r&&this.sink.event(t,$F(this.f,this.values))}else this.dispose(t,e.index)},e.prototype.updateReady=function(t){return this.awaiting>0&&(this.hasValue[t]||(this.hasValue[t]=!0,this.awaiting-=1)),this.awaiting},e.prototype.dispose=function(t,e){PD(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(pF);
/** @license MIT License (c) copyright 2010 original author or authors */
var DF=function(t,e){return FF(qL,t,e)},FF=function(t,e,n){return XD(n)?qD():new zF(t,e,n)},zF=function(){function t(t,e,n){this.f=t,this.concurrency=e,this.source=n}return t.prototype.run=function(t,e){return new BF(this.f,this.concurrency,this.source,t,e)},t}(),BF=function(){function t(t,e,n,r,i){this.f=t,this.concurrency=e,this.sink=r,this.scheduler=i,this.pending=[],this.current=[],this.disposable=_D(n.run(this,i)),this.active=!0}return t.prototype.event=function(t,e){this.addInner(t,e)},t.prototype.addInner=function(t,e){this.current.length<this.concurrency?this.startInner(t,e):this.pending.push(e)},t.prototype.startInner=function(t,e){try{this.initInner(t,e)}catch(e){this.error(t,e)}},t.prototype.initInner=function(t,e){var n=new VF(t,this,this.sink);n.disposable=UF(this.f,t,e,n,this.scheduler),this.current.push(n)},t.prototype.end=function(t){this.active=!1,PD(t,this.disposable,this.sink),this.checkEnd(t)},t.prototype.error=function(t,e){this.active=!1,this.sink.error(t,e)},t.prototype.dispose=function(){this.active=!1,this.pending.length=0,this.disposable.dispose(),TD(this.current).dispose()},t.prototype.endInner=function(t,e){var n=this.current.indexOf(e);n>=0&&this.current.splice(n,1),PD(t,e,this);var r=this.pending;r.length>0?this.startInner(t,r.shift()):this.checkEnd(t)},t.prototype.checkEnd=function(t){this.active||0!==this.current.length||this.sink.end(t)},t}(),UF=function(t,e,n,r,i){return t(n).run(r,vD(e,i))},VF=function(){function t(t,e,n){this.time=t,this.outer=e,this.sink=n,this.disposable=wD()}return t.prototype.event=function(t,e){this.sink.event(t+this.time,e)},t.prototype.end=function(t){this.outer.endInner(t+this.time,this)},t.prototype.error=function(t,e){this.outer.error(t+this.time,e)},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),jF=function(t){return DF(1/0,t)};var WF=function(t){return HF(GF(t))},HF=function(t){return 0===t.length?qD():1===t.length?t[0]:new YF(WL(XF,[],t))},GF=function(t){return t.filter(qF)},qF=function(t){return!XD(t)},XF=function(t,e){return t.concat(e instanceof YF?e.sources:e)},YF=function(){function t(t){this.sources=t}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new KF(r,i,t),o=void 0,a=0;a<n;++a)o=i[a]=new IF(a,s),r[a]=this.sources[a].run(o,e);return TD(r)},t}(),KF=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.disposables=e,i.activeCount=n.length,i}return DD(e,t),e.prototype.event=function(t,e){e.active?this.sink.event(t,e.value):this.dispose(t,e.index)},e.prototype.dispose=function(t,e){PD(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(pF),ZF=function(t,e,n){return XD(n)||XD(e)?qD():new JF(t,e,n)},JF=function(){function t(t,e,n){this.f=t,this.values=e,this.sampler=n}return t.prototype.run=function(t,e){var n=new QF(this.f,t),r=this.values.run(n.latest,e),i=this.sampler.run(n,e);return ED(i,r)},t}(),QF=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r.latest=new tz(r),r}return DD(e,t),e.prototype.event=function(t,e){if(this.latest.hasValue){var n=this.f;this.sink.event(t,n(this.latest.value,e))}},e}(pF),tz=function(t){function e(e){var n=t.call(this,e)||this;return n.hasValue=!1,n}return DD(e,t),e.prototype.event=function(t,e){this.value=e,this.hasValue=!0},e.prototype.end=function(){},e}(pF),ez=function(t,e){var n=Math.max(0,t);return{min:n,max:Math.max(n,e)}},nz=function(t,e){return rz(0,t,e)},rz=function(t,e,n){return iz(ez(t,e),n)},iz=function(t,e){return sz(t,e)?qD():e instanceof EF?az(t,e):e instanceof cz?lz(t,e):oz(t,e)},sz=function(t,e){return XD(e)||(n=t).min>=n.max;var n},oz=function(t,e){return(n=t).min<=0&&n.max===1/0?e:new cz(t,e);var n},az=function(t,e){return EF.create(e.f,iz(t,e.source))},lz=function(t,e){return iz((n=e.bounds,r=t,ez(n.min+r.min,Math.min(n.max,n.min+r.max))),e.source);var n,r},cz=function(){function t(t,e){this.source=e,this.bounds=t}return t.prototype.run=function(t,e){var n=new sF,r=new uz(this.bounds.min,this.bounds.max-this.bounds.min,t,n);return n.setDisposable(this.source.run(r,e)),n},t}(),uz=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.skip=e,s.take=n,s.disposable=i,s}return DD(e,t),e.prototype.event=function(t,e){this.skip>0?this.skip-=1:0!==this.take&&(this.take-=1,this.sink.event(t,e),0===this.take&&(this.disposable.dispose(),this.sink.end(t)))},e}(pF),hz=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){var n=new sF,r=new dz(this.p,t,n);return n.setDisposable(this.source.run(r,e)),n},t}(),dz=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.p=e,i.active=!0,i.disposable=r,i}return DD(e,t),e.prototype.event=function(t,e){if(this.active){var n=this.p;this.active=n(e),this.active?this.sink.event(t,e):(this.disposable.dispose(),this.sink.end(t))}},e}(pF),pz=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new fz(this.p,t),e)},t}(),fz=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r.skipping=!0,r}return DD(e,t),e.prototype.event=function(t,e){if(this.skipping){var n=this.p;if(this.skipping=n(e),this.skipping)return}this.sink.event(t,e)},e}(pF),mz=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new gz(this.p,t),e)},t}(),gz=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r.skipping=!1,r}return DD(e,t),e.prototype.event=function(t,e){if(!this.skipping){var n=this.p;this.skipping=n(e),this.sink.event(t,e),this.skipping&&this.sink.end(t)}},e}(pF),yz=function(t,e,n){return XD(n)||0===e.length?qD():new vz(t,e,nz(e.length,n))},bz=function(t){return t},vz=function(){function t(t,e,n){this.f=t,this.items=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new xz(this.f,this.items,t),e)},t}(),xz=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.f=e,i.items=n,i.index=0,i}return DD(e,t),e.prototype.event=function(t,e){var n=this.f;this.sink.event(t,n(this.items[this.index],e)),this.index+=1},e}(pF),wz=function(){function t(){this.head=0,this.tail=0,this.capacityMask=3,this.list=new Array(4)}return t.prototype.push=function(t){var e=this.tail;return this.list[e]=t,this.tail=e+1&this.capacityMask,this.tail===this.head&&this.growArray(),this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.shift=function(){var t=this.head;if(t!==this.tail){var e=this.list[t];return this.list[t]=void 0,this.head=t+1&this.capacityMask,t<2&&this.tail>1e4&&this.tail<=this.list.length>>>2&&this.shrinkArray(),e}},t.prototype.isEmpty=function(){return this.head===this.tail},t.prototype.length=function(){return this.head===this.tail?0:this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.growArray=function(){this.head&&(this.list=this.copyArray(),this.head=0),this.tail=this.list.length,this.list.length*=2,this.capacityMask=this.capacityMask<<1|1},t.prototype.shrinkArray=function(){this.list.length>>>=1,this.capacityMask>>>=1},t.prototype.copyArray=function(){var t,e=[],n=this.list,r=n.length;for(t=this.head;t<r;t++)e.push(n[t]);for(t=0;t<this.tail;t++)e.push(n[t]);return e},t}();var Sz=function(t,e){return 0===e.length||YD(e)?qD():1===e.length?CF(t,e[0]):new _z(t,e)},_z=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new Array(n),o=new kz(this.f,s,i,t),a=void 0,l=0;l<n;++l)s[l]=new wz,a=i[l]=new IF(l,o),r[l]=this.sources[l].run(a,e);return TD(r)},t}(),kz=function(t){function e(e,n,r,i){var s=t.call(this,i)||this;return s.f=e,s.sinks=r,s.buffers=n,s}return DD(e,t),e.prototype.event=function(t,e){if(e.active){var n=this.buffers,r=n[e.index];if(r.push(e.value),1===r.length()){if(!function(t){for(var e=0,n=t.length;e<n;++e)if(t[e].isEmpty())return!1;return!0}
/** @license MIT License (c) copyright 2010-2016 original author or authors */(n))return;Tz(this.f,t,n,this.sink),function(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n].isEmpty()&&!e[n].active)return!0;return!1}(this.buffers,this.sinks)&&this.sink.end(t)}}else this.dispose(t,e.index)},e.prototype.dispose=function(t,e){this.buffers[e].isEmpty()&&this.sink.end(t)},e}(pF),Tz=function(t,e,n,r){return r.event(e,$F(t,function(t,e){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=t(e[i]);return r}(Ez,n)))},Ez=function(t){return t.shift()};var Mz=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){var n=new Cz(t,e);return ED(n,this.source.run(n,e))},t}(),Cz=function(){function t(t,e){this.sink=t,this.scheduler=e,this.current=null,this.ended=!1}return t.prototype.event=function(t,e){this.disposeCurrent(t),this.current=new Az(e,t,1/0,this,this.sink,this.scheduler)},t.prototype.end=function(t){this.ended=!0,this.checkEnd(t)},t.prototype.error=function(t,e){this.ended=!0,this.sink.error(t,e)},t.prototype.dispose=function(){return this.disposeCurrent(fD(this.scheduler))},t.prototype.disposeCurrent=function(t){if(null!==this.current)return this.current.dispose(t)},t.prototype.disposeInner=function(t,e){e.dispose(t),e===this.current&&(this.current=null)},t.prototype.checkEnd=function(t){this.ended&&null===this.current&&this.sink.end(t)},t.prototype.endInner=function(t,e){this.disposeInner(t,e),this.checkEnd(t)},t.prototype.errorInner=function(t,e,n){this.disposeInner(t,n),this.sink.error(t,e)},t}(),Az=function(){function t(t,e,n,r,i,s){this.min=e,this.max=n,this.outer=r,this.sink=i,this.disposable=t.run(this,vD(e,s))}return t.prototype.event=function(t,e){var n=Math.max(0,t+this.min);n<this.max&&this.sink.event(n,e)},t.prototype.end=function(t){this.outer.endInner(t+this.min,this)},t.prototype.error=function(t,e){this.outer.errorInner(t+this.min,e,this)},t.prototype.dispose=function(t){PD(t,this.disposable,this.sink)},t}();var Nz=function(t,e){return XD(e)?qD():new Iz(t,e)},Iz=function(){function t(t,e){this.equals=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new $z(this.equals,t),e)},t}(),$z=function(t){function e(e,n){var r=t.call(this,n)||this;return r.equals=e,r.value=void 0,r.init=!0,r}return DD(e,t),e.prototype.event=function(t,e){this.init?(this.init=!1,this.value=e,this.sink.event(t,e)):this.equals(this.value,e)||(this.value=e,this.sink.event(t,e))},e}(pF);function Rz(t,e){return t===e}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var Oz=function(t,e){return new Lz(t,e)},Pz=function(t,e){return new Dz(t,e)},Lz=function(){function t(t,e){this.maxSignal=t,this.source=e}return t.prototype.run=function(t,e){var n=new sF,r=this.source.run(t,e),i=this.maxSignal.run(new Bz(t,n),e);return n.setDisposable(ED(r,i)),n},t}(),Dz=function(){function t(t,e){this.minSignal=t,this.source=e}return t.prototype.run=function(t,e){var n=new zz(this.minSignal,t,e),r=this.source.run(new Fz(n,t),e);return ED(n,r)},t}(),Fz=function(t){function e(e,n){var r=t.call(this,n)||this;return r.min=e,r}return DD(e,t),e.prototype.event=function(t,e){this.min.allow&&this.sink.event(t,e)},e}(pF),zz=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.allow=!1,i.disposable=e.run(i,r),i}return DD(e,t),e.prototype.event=function(){this.allow=!0,this.dispose()},e.prototype.end=function(){},e.prototype.dispose=function(){this.disposable.dispose()},e}(pF),Bz=function(t){function e(e,n){var r=t.call(this,e)||this;return r.disposable=n,r}return DD(e,t),e.prototype.event=function(t){this.disposable.dispose(),this.sink.end(t)},e.prototype.end=function(){},e}(pF),Uz=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){var n=new Vz(this.dt,t,e);return ED(n,this.source.run(n,e))},t}(),Vz=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.dt=e,i.scheduler=r,i.tasks=[],i}return DD(e,t),e.prototype.dispose=function(){this.tasks.forEach(bD)},e.prototype.event=function(t,e){this.tasks.push(gD(this.dt,BD(e,this.sink),this.scheduler))},e.prototype.end=function(){this.tasks.push(gD(this.dt,UD(this.sink),this.scheduler))},e}(pF),jz=function(t,e){return XD(e)?qD():e instanceof EF?Wz(t,e):e instanceof Gz?Hz(t,e):new Gz(t,e)},Wz=function(t,e){return EF.create(e.f,jz(t,e.source))},Hz=function(t,e){return new Gz(Math.max(t,e.period),e.source)},Gz=function(){function t(t,e){this.period=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new qz(this.period,t),e)},t}(),qz=function(t){function e(e,n){var r=t.call(this,n)||this;return r.time=0,r.period=e,r}return DD(e,t),e.prototype.event=function(t,e){t>=this.time&&(this.time=t+this.period,this.sink.event(t,e))},e}(pF),Xz=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){return new Yz(this.dt,this.source,t,e)},t}(),Yz=function(){function t(t,e,n,r){this.dt=t,this.sink=n,this.scheduler=r,this.timer=null,this.disposable=e.run(this,r)}return t.prototype.event=function(t,e){this.clearTimer(),this.value=e,this.timer=gD(this.dt,new Kz(this,e),this.scheduler)},t.prototype.handleEventFromTask=function(t,e){this.clearTimer(),this.sink.event(t,e)},t.prototype.end=function(t){this.clearTimer()&&(this.sink.event(t,this.value),this.value=void 0),this.sink.end(t)},t.prototype.error=function(t,e){this.clearTimer(),this.sink.error(t,e)},t.prototype.dispose=function(){this.clearTimer(),this.disposable.dispose()},t.prototype.clearTimer=function(){return null!==this.timer&&(this.timer.dispose(),this.timer=null,!0)},t}(),Kz=function(){function t(t,e){this.sink=t,this.value=e}return t.prototype.run=function(t){this.sink.handleEventFromTask(t,this.value)},t.prototype.error=function(t,e){this.sink.error(t,e)},t.prototype.dispose=function(){},t}(),Zz=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){return this.source.run(new Jz(t,e),e)},t}(),Jz=function(){function t(t,e){var n=this;this.eventBound=function(t){return n.sink.event(fD(n.scheduler),t)},this.endBound=function(){return n.sink.end(fD(n.scheduler))},this.errorBound=function(t){return n.sink.error(fD(n.scheduler),t)},this.sink=t,this.scheduler=e,this.queue=Promise.resolve()}return t.prototype.event=function(t,e){var n=this;this.queue=this.queue.then((function(){return n.handlePromise(e)})).catch(this.errorBound)},t.prototype.end=function(){this.queue=this.queue.then(this.endBound).catch(this.errorBound)},t.prototype.error=function(t,e){var n=this;this.queue=this.queue.then((function(){return n.errorBound(e)})).catch(FD)},t.prototype.handlePromise=function(t){return t.then(this.eventBound)},t}(),Qz=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},t.prototype.end=function(t){this.active&&(this.disable(),this.sink.end(t))},t.prototype.error=function(t,e){this.disable(),this.sink.error(t,e)},t.prototype.disable=function(){return this.active=!1,this.sink},t}();
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function tB(t,e,n){try{n.event(t,e)}catch(e){n.error(t,e)}}function eB(t,e){try{e.end(t)}catch(n){e.error(t,n)}}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var nB=function(){function t(t){this.value=t}return t.prototype.run=function(t,e){return mD(function(t,e){return new GD(t,e)}(this.value,t),e)},t}(),rB=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new iB(this.f,this.source,t,e)},t}(),iB=function(){function t(t,e,n,r){this.f=t,this.sink=new Qz(n),this.scheduler=r,this.disposable=e.run(this,r)}return t.prototype.event=function(t,e){tB(t,e,this.sink)},t.prototype.end=function(t){eB(t,this.sink)},t.prototype.error=function(t,e){var n=this.sink.disable();PD(t,this.disposable,this.sink),this._startNext(t,e,n)},t.prototype._startNext=function(t,e,n){try{this.disposable=this._continue(this.f,t,e,n)}catch(e){n.error(t,e)}},t.prototype._continue=function(t,e,n,r){return lF(r,this.scheduler,uF(e,t(n)))},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),sB=function(){function t(t){this.source=new oB(t)}return t.prototype.run=function(t,e){return this.source.run(t,e)},t}(),oB=function(){function t(t){this.source=t,this.sinks=[],this.disposable=wD()}return t.prototype.run=function(t,e){return 1===this.add(t)&&(this.disposable=this.source.run(this,e)),_D(new aB(this,t))},t.prototype.dispose=function(){var t=this.disposable;return this.disposable=wD(),t.dispose()},t.prototype.add=function(t){return this.sinks=jL(t,this.sinks),this.sinks.length},t.prototype.remove=function(t){var e=GL(t,this.sinks);return e>=0&&(this.sinks=HL(e,this.sinks)),this.sinks.length},t.prototype.event=function(t,e){var n=this.sinks;if(1===n.length)return n[0].event(t,e);for(var r=0;r<n.length;++r)tB(t,e,n[r])},t.prototype.end=function(t){for(var e=this.sinks,n=0;n<e.length;++n)eB(t,e[n])},t.prototype.error=function(t,e){for(var n=this.sinks,r=0;r<n.length;++r)n[r].error(t,e)},t}(),aB=function(){function t(t,e){this.source=t,this.sink=e}return t.prototype.dispose=function(){0===this.source.remove(this.sink)&&this.source.dispose()},t}(),lB=YL(uF),cB=KL((function(t,e,n){return XD(n)?qD():new fF(t,e,n)})),uB=KL((function(t,e,n){return new gF(t,e,n)})),hB=YL((function(t,e){return bF((function(){return e}),rF(t))})),dB=YL(CF),pB=YL((function(t,e){return CF((function(){return t}),e)})),fB=YL((function(t,e){return new AF(t,e)})),mB=YL((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return RF(XL,t,e)})),gB=YL((function(t,e){return FF(t,1/0,e)})),yB=YL(bF),bB=YL((function(t,e){return FF(t,1,e)})),vB=YL(DF),xB=KL(FF),wB=YL((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return WF([t,e])})),SB=KL(RF),_B=YL((function(t,e){return ZF((function(t){return t}),t,e)})),kB=KL(ZF),TB=KL(yz),EB=YL((function(t,e){return yz(bz,t,e)})),MB=KL((
/** @license MIT License (c) copyright 2010 original author or authors */
function(t,e,n){return Sz(t,[e,n])})),CB=YL((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return wF.create(t,e)})),AB=YL(Nz),NB=YL(nz),IB=YL((function(t,e){return rz(t,1/0,e)})),$B=KL(rz),RB=YL((function(t,e){return XD(e)?qD():new hz(t,e)})),OB=YL((function(t,e){return XD(e)?qD():new pz(t,e)})),PB=YL((function(t,e){return XD(e)?qD():new mz(t,e)})),LB=YL(Oz),DB=YL(Pz),FB=YL((function(t,e){return Oz(jF(t),Pz(t,e))})),zB=YL((function(t,e){return t<=0?e:new Uz(t,e)})),BB=YL(jz),UB=YL((function(t,e){return XD(e)?qD():new Xz(t,e)})),VB=YL((function(t,e){return XD(e)?qD():new rB(t,e)}));function jB(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function WB(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function HB(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n}var GB,qB,XB,YB=function(){var t=[];return[function(e){return KB(t,e)},new ZB(t)]},KB=function(t,e){return t.forEach((function(t){var n=t.sink;return function(t,e,n){try{n.event(t,e)}catch(e){n.error(t,e)}}(t.scheduler.currentTime(),e,n)}))},ZB=function(){function t(t){this.sinks=t}return t.prototype.run=function(t,e){var n={sink:t,scheduler:e};return this.sinks.push(n),new JB(n,this.sinks)},t}(),JB=function(){function t(t,e){this.sink=t,this.sinks=e}return t.prototype.dispose=function(){var t=this.sinks.indexOf(this.sink);t>=0&&this.sinks.splice(t,1)},t}();function QB(){}function tU(t){}const eU=new tD(xD(),new eD);function nU(t){return t&&"object"==typeof t&&void 0!==t.run&&void 0!==t.id}class rU{constructor(t,e){this.id=rU.nextId++,this.subscribers=[],this.value=void 0,this.ready=!1,GB.set(this,void 0),qB.set(this,!1),XB.set(this,void 0),HB(this,GB,!!e,"f");const[n,r]=YB(),[i,s]=YB();let o;this.stopStream=n,this.set=t=>{this.value=t,i(t)},nU(t)?(o=t,void 0===e&&HB(this,GB,t.holding,"f"),t.holding&&(this.value=t.value)):!function(t){return t&&"object"==typeof t&&void 0!==t.run}(t)?(o=dB((()=>this.value),rF(t)),this.value=t):o=t,this.stream=function(t){return t instanceof sB||XD(t)?t:new sB(t)}(fB(this.runListeners.bind(this),LB(r,wB(o,s))))}get(){return this.value}get holding(){return WB(this,GB,"f")}run(t,e){return this.stream.run(t,e)}runListeners(t){this.value=t;for(const e of this.subscribers)e(t)}subscribe(t=tU,e=QB){WB(this,GB,"f")&&WB(this,qB,"f")&&t(this.value);const n=n=>{e(),t(n)};return this.subscribers.push(n),WB(this,qB,"f")||this.start(),()=>{const t=this.subscribers.indexOf(n);-1!==t&&this.subscribers.splice(t,1)}}async start(){return WB(this,qB,"f")||(rU.numActive++,oF(this.stream,eU).then((()=>{rU.numActive--})),HB(this,qB,!0,"f"),HB(this,XB,new Promise(((t,e)=>{mD({run:()=>{this.ready=!0,t()},error(t){e(t)},dispose(){}},eU)})),"f")),WB(this,XB,"f")}stop(){this.stopStream(void 0),HB(this,qB,!1,"f")}hold(t=!0){return HB(this,GB,t,"f"),this}thru(t){return new rU(t(this))}startWith(t){const e=new rU(hB(t,this));return this.holding&&(e.value=t),e}continueWith(t){const e=new rU(yB(t,this));return this.holding&&(e.value=this.value),e}map(t){const e=new rU(dB(t,this));return this.holding&&(e.value=t(this.value)),e}constant(t){const e=new rU(pB(t,this));return this.holding&&(e.value=t),e}tap(t){const e=new rU(fB(t,this));return this.holding&&(e.value=this.value),e}ap(t){const e=new rU(mB(t,this));return this.holding&&t.holding&&(e.value=t.get()(this.value)),e}scan(t,e){const n=new rU(uB(t,e,this));return this.holding&&(n.value=e),n}loop(t,e){return new rU(cB(t,e,this))}withItems(t){return new rU(EB(t,this))}zipItems(t,e){return new rU(TB(t,e,this))}switchLatest(){return new rU(XD(t=this)?qD():new Mz(t));var t}join(){return new rU(jF(this))}chain(t){return new rU(gB(t,this))}concatMap(t){return new rU(bB(t,this))}mergeConcurrently(t){return new rU(vB(t,this))}mergeMapConcurrently(t,e){return new rU(xB(t,e,this))}merge(t){const e=new rU(wB(t,this));return this.holding&&(e.value=this.value),e}combine(t,e){const n=new rU(SB(t,e,this));return this.holding&&(n.value=t(e.value,this.value)),n}zip(t,e){const n=new rU(MB(t,e,this));return this.holding&&(n.value=t(e.value,this.value)),n}resample(t){return new rU(_B(this,t))}sample(t){return new rU(_B(t,this))}snapshot(t,e){return new rU(kB(t,e,this))}filter(t){const e=new rU(CB(t,this));return this.holding&&t(this.value)&&(e.value=this.value),e}skipRepeats(){const t=new rU(Nz(Rz,this));return this.holding&&(t.value=this.value),t}skipRepeatsWith(t){return new rU(AB(t,this))}slice(t,e){return new rU($B(t,e,this))}take(t){return new rU(NB(t,this))}skip(t){return new rU(IB(t,this))}takeWhile(t){return new rU(RB(t,this))}skipWhile(t){return new rU(OB(t,this))}skipAfter(t){return new rU(PB(t,this))}until(t){return new rU(LB(t,this))}since(t){return new rU(DB(t,this))}during(t){return new rU(FB(t,this))}delay(t){return new rU(zB(t,this))}withLocalTime(t){return new rU(lB(t,this))}throttle(t){return new rU(BB(t,this))}debounce(t){return new rU(UB(t,this))}awaitPromises(){return new rU(XD(t=this)?qD():new Zz(t));var t}recoverWith(t){return new rU(VB(t,this))}static empty(){return new rU(qD())}static never(){return new rU(JD())}static now(t){return new rU(rF(t))}static at(t,e){return new rU(tF(t,e))}static periodic(t){return new rU(function(t){return new iF(t)}(t))}static throwError(t){return new rU(function(t){return new nB(t)}(t))}}function iU(t,e=!1){return new rU(t,e)}var sU;GB=new WeakMap,qB=new WeakMap,XB=new WeakMap,rU.nextId=0,rU.numActive=0,function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warning=2]="Warning",t[t.Error=3]="Error"}(sU||(sU={}));const oU=new rU(JD()),aU={log(...t){console.log(...t),oU.set([sU.Info,t.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},debug(...t){oU.set([sU.Debug,t.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},info(...t){this.log(...t)},warning(...t){oU.set([sU.Warning,t.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},error(...t){console.error(...t),oU.set([sU.Error,t.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])}};function lU(){return oU}function cU(t,e,n){const r=n.value;return n.value=function(...t){try{return r.apply(this,t)}catch(t){return aU.error(t),VL({title:t.name,message:t.message,type:"danger"}),t}},n}class uU extends Error{constructor(t){super(t),this.name="Training Error"}}function hU(t,{duration:e=3e3}={}){aU.error(`${t.name}: ${t.message}`,t),VL({title:t.name,message:t.message,type:"danger",duration:e})}function dU(t,e){return async function*(){let n=0;for await(const r of t())e(r,n++)&&(yield await r)}}function pU(t,e){return async function*(){let n=0;for await(const r of t())yield await e(r,n++)}}function fU(t,e){return async function*(){yield*await t(),yield*await e}}class mU{constructor(t){this.source=t}[Symbol.asyncIterator](){return this.source()[Symbol.asyncIterator]()}entries(){return new mU(pU(this.source,((t,e)=>[e,t])))}keys(){return new mU(pU(this.source,((t,e)=>e)))}values(){return new mU(this.source)}forEach(t){return async function(t,e){let n=0;for await(const r of t())e(r,n++)}(this.source,t)}concat(t){return"function"==typeof t[Symbol.iterator]?new mU(fU(this.source,async function*(t){yield*t}(t))):function(t){return"function"==typeof t[Symbol.asyncIterator]}(t)?new mU(fU(this.source,t)):new mU(fU(this.source,async function*(t){yield t}(t)))}reduce(t,e){return async function(t,e,n){let[r,i]=[-1,n];for await(const s of t())i=0==++r&&void 0===n?s:e(i,s,r);if(void 0===n&&-1===r)throw new Error("Sequence contains no elements.");return i}(this.source,t,e)}filter(t){return new mU(dU(this.source,t))}take(t){return new mU(function(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){let n=e;for await(const e of t()){if(0==n--)return;yield await e}}}(this.source,t))}skip(t){return new mU(function(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){yield*dU(t,((t,n)=>n>=e))()}}(this.source,t))}map(t){return new mU(pU(this.source,t))}zip(t){return new mU((e=this.source,n=t,async function*(){const t=n()[Symbol.asyncIterator]();for await(const n of e()){const e=await t.next();if(e.done)return;yield[n,e.value]}}));var e,n}toArray(){return async function(t){const e=[];for await(const n of t())e.push(n);return e}(this.source)}}class gU extends mU{constructor(t){super((async function*(){for(const e of t)yield e}))}}function yU(t){return new gU(t)}function bU(t){return t&&"object"==typeof t&&!Array.isArray(t)}function vU(t,...e){if(!e.length)return t;const n=e.shift(),r={...t};if(bU(t)&&bU(n))for(const t in n)bU(n[t])?(r[t]||Object.assign(r,{[t]:{}}),r[t]=vU(r[t],n[t])):Object.assign(r,{[t]:n[t]});return vU(r,...e)}window&&(window.onerror=t=>{"string"==typeof t&&VL({title:"An error occurred",message:t,type:"danger"})},window.addEventListener("unhandledrejection",(t=>{VL({title:"An error occurred",message:t.reason,type:"danger"})})));function xU(t,{include:e,exclude:n}={}){const r=t=>{const r=e=>"string"==typeof e?t===e:e.test(t);return e?e.some(r):!n||!n.some(r)};for(const[e,n]of(t=>{const e=new Set;do{for(const n of Reflect.ownKeys(t))e.add([t,n])}while((t=Reflect.getPrototypeOf(t))&&t!==Object.prototype);return e})(t.constructor.prototype)){if("constructor"===n||!r(n))continue;const i=Reflect.getOwnPropertyDescriptor(e,n);i&&"function"==typeof i.value&&(t[n]=t[n].bind(t))}return t}let wU=0;class SU{constructor(){this.id=`component-${String(wU++).padStart(3,"0")}`,this.$$={streams:[],app:void 0},xU(this)}destroy(){var t;null===(t=this.$$.app)||void 0===t||t.$destroy(),this.$$.app=void 0}start(){this.$$.streams=Object.entries(this).filter((([t,e])=>"$"===t[0]&&nU(e))).map((([,t])=>(t.start(),t)))}stop(){for(const t of this.$$.streams)t.stop()}dispose(){this.destroy(),this.stop()}}var _U={exports:{}},kU=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,TU=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],EU=function(t){var e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var i=kU.exec(t||""),s={},o=14;o--;)s[TU[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(t,e){var n=/\/{2,9}/g,r=e.replace(n,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||r.splice(0,1);"/"==e.substr(e.length-1,1)&&r.splice(r.length-1,1);return r}(0,s.path),s.queryKey=function(t,e){var n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}(0,s.query),s};var MU={exports:{}},CU={exports:{}},AU=6e4,NU=60*AU,IU=24*NU,$U=365.25*IU,RU=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*$U;case"days":case"day":case"d":return n*IU;case"hours":case"hour":case"hrs":case"hr":case"h":return n*NU;case"minutes":case"minute":case"mins":case"min":case"m":return n*AU;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===n&&!1===isNaN(t))return e.long?function(t){return OU(t,IU,"day")||OU(t,NU,"hour")||OU(t,AU,"minute")||OU(t,1e3,"second")||t+" ms"}(t):function(t){if(t>=IU)return Math.round(t/IU)+"d";if(t>=NU)return Math.round(t/NU)+"h";if(t>=AU)return Math.round(t/AU)+"m";if(t>=1e3)return Math.round(t/1e3)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function OU(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}!function(t,e){function n(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,s=r-(n||r);t.diff=s,t.prev=n,t.curr=r,n=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var l=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;l++;var i=e.formatters[r];if("function"==typeof i){var s=o[l];n=i.call(t,s),o.splice(l,1),l--}return n})),e.formatArgs.call(t,o);var c=i.log||e.log||console.log.bind(console);c.apply(t,o)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),i.destroy=r,"function"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=CU.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var s=e.instances[n];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=RU,e.instances=[],e.names=[],e.skips=[],e.formatters={}}(0,CU.exports),function(t,e){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=CU.exports).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(s=i))})),t.splice(s,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())}(MU,MU.exports);var PU=EU,LU=MU.exports("socket.io-client:url"),DU=function(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(LU("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),LU("parse %s",t),n=PU(t));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(e&&e.port===n.port?"":":"+n.port),n};var FU={},zU={exports:{}};!function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}zU.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}();var BU={},UU={}.toString,VU=Array.isArray||function(t){return"[object Array]"==UU.call(t)},jU=function(t){return WU&&Buffer.isBuffer(t)||HU&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))},WU="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,HU="function"==typeof ArrayBuffer;var GU=VU,qU=jU,XU=Object.prototype.toString,YU="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===XU.call(Blob),KU="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===XU.call(File);function ZU(t,e){if(!t)return t;if(qU(t)){var n={_placeholder:!0,num:e.length};return e.push(t),n}if(GU(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=ZU(t[i],e);return r}if("object"==typeof t&&!(t instanceof Date)){r={};for(var s in t)r[s]=ZU(t[s],e);return r}return t}function JU(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(GU(t))for(var n=0;n<t.length;n++)t[n]=JU(t[n],e);else if("object"==typeof t)for(var r in t)t[r]=JU(t[r],e);return t}BU.deconstructPacket=function(t){var e=[],n=t.data,r=t;return r.data=ZU(n,e),r.attachments=e.length,{packet:r,buffers:e}},BU.reconstructPacket=function(t,e){return t.data=JU(t.data,e),t.attachments=void 0,t},BU.removeBlobs=function(t,e){var n=0,r=t;!function t(i,s,o){if(!i)return i;if(YU&&i instanceof Blob||KU&&i instanceof File){n++;var a=new FileReader;a.onload=function(){o?o[s]=this.result:r=this.result,--n||e(r)},a.readAsArrayBuffer(i)}else if(GU(i))for(var l=0;l<i.length;l++)t(i[l],l,i);else if("object"==typeof i&&!qU(i))for(var c in i)t(i[c],c,i)}(r),n||e(r)},function(t){var e=MU.exports("socket.io-parser"),n=zU.exports,r=BU,i=VU,s=jU;function o(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=o,t.Decoder=c;var a=t.ERROR+'"encode error"';function l(n){var r=""+n.type;if(t.BINARY_EVENT!==n.type&&t.BINARY_ACK!==n.type||(r+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(r+=n.nsp+","),null!=n.id&&(r+=n.id),null!=n.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(n.data);if(!1===i)return a;r+=i}return e("encoded %j as %s",n,r),r}function c(){this.reconstructor=null}function u(t){this.reconPack=t,this.buffers=[]}function h(e){return{type:t.ERROR,data:"parser error: "+e}}o.prototype.encode=function(n,i){(e("encoding packet %j",n),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type)?function(t,e){function n(t){var n=r.deconstructPacket(t),i=l(n.packet),s=n.buffers;s.unshift(i),e(s)}r.removeBlobs(t,n)}(n,i):i([l(n)])},n(c.prototype),c.prototype.add=function(n){var r;if("string"==typeof n)r=function(n){var r=0,s={type:Number(n.charAt(0))};if(null==t.types[s.type])return h("unknown packet type "+s.type);if(t.BINARY_EVENT===s.type||t.BINARY_ACK===s.type){for(var o=r+1;"-"!==n.charAt(++r)&&r!=n.length;);var a=n.substring(o,r);if(a!=Number(a)||"-"!==n.charAt(r))throw new Error("Illegal attachments");s.attachments=Number(a)}if("/"===n.charAt(r+1)){for(o=r+1;++r;){if(","===(c=n.charAt(r)))break;if(r===n.length)break}s.nsp=n.substring(o,r)}else s.nsp="/";var l=n.charAt(r+1);if(""!==l&&Number(l)==l){for(o=r+1;++r;){var c;if(null==(c=n.charAt(r))||Number(c)!=c){--r;break}if(r===n.length)break}s.id=Number(n.substring(o,r+1))}if(n.charAt(++r)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(n.substr(r));if(!(!1!==u&&(s.type===t.ERROR||i(u))))return h("invalid payload");s.data=u}return e("decoded %s as %j",n,s),s}(n),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new u(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!s(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(n))&&(this.reconstructor=null,this.emit("decoded",r))}},c.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=r.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}(FU);var QU={exports:{}},tV={},eV={exports:{}};try{eV.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){eV.exports=!1}var nV,rV,iV="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),sV=eV.exports,oV=iV,aV=function(t){var e=t.xdomain,n=t.xscheme,r=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||sV))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(t){}if(!e)try{return new(oV[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}},lV={exports:{}},cV={},uV=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e};function hV(){if(rV)return nV;rV=1;var t=VU,e=Object.prototype.toString,n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===e.call(Blob),r="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===e.call(File);return nV=function e(i){if(!i||"object"!=typeof i)return!1;if(t(i)){for(var s=0,o=i.length;s<o;s++)if(e(i[s]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(i)||"function"==typeof ArrayBuffer&&i instanceof ArrayBuffer||n&&i instanceof Blob||r&&i instanceof File)return!0;if(i.toJSON&&"function"==typeof i.toJSON&&1===arguments.length)return e(i.toJSON(),!0);for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&e(i[a]))return!0;return!1},nV}var dV=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(n-e),o=e,a=0;o<n;o++,a++)s[a]=i[o];return s.buffer},pV=function(t,e,n){var r=!1;return n=n||fV,i.count=t,0===t?e():i;function i(t,s){if(i.count<=0)throw new Error("after called too many times");--i.count,t?(r=!0,e(t),e=n):0!==i.count||r||e(null,s)}};function fV(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var mV,gV,yV,bV=String.fromCharCode;function vV(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function xV(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function wV(t,e){return bV(t>>e&63|128)}function SV(t,e){if(0==(4294967168&t))return bV(t);var n="";return 0==(4294965248&t)?n=bV(t>>6&31|192):0==(4294901760&t)?(xV(t,e)||(t=65533),n=bV(t>>12&15|224),n+=wV(t,6)):0==(4292870144&t)&&(n=bV(t>>18&7|240),n+=wV(t,12),n+=wV(t,6)),n+=bV(63&t|128)}function _V(){if(yV>=gV)throw Error("Invalid byte index");var t=255&mV[yV];if(yV++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function kV(t){var e,n;if(yV>gV)throw Error("Invalid byte index");if(yV==gV)return!1;if(e=255&mV[yV],yV++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|_V())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|_V()<<6|_V())>=2048)return xV(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|_V()<<12|_V()<<6|_V())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var TV,EV,MV,CV,AV,NV={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=vV(t),i=r.length,s=-1,o="";++s<i;)o+=SV(r[s],n);return o},decode:function(t,e){var n=!1!==(e=e||{}).strict;mV=vV(t),gV=mV.length,yV=0;for(var r,i=[];!1!==(r=kV(n));)i.push(r);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=bV((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=bV(e);return i}(i)}},IV={};function $V(){if(MV)return EV;MV=1;var t=void 0!==t?t:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,e=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),n=e&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),r=t&&t.prototype.append&&t.prototype.getBlob;function i(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t}))}function s(e,n){n=n||{};var r=new t;return i(e).forEach((function(t){r.append(t)})),n.type?r.getBlob(n.type):r.getBlob()}function o(t,e){return new Blob(i(t),e||{})}return"undefined"!=typeof Blob&&(s.prototype=Blob.prototype,o.prototype=Blob.prototype),EV=e?n?Blob:o:r?s:void 0}function RV(){if(AV)return CV;AV=1;var t=cV;function e(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}return CV=e,(0,zU.exports)(e.prototype),e.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},e.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},e.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},e.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},e.prototype.onData=function(e){var n=t.decodePacket(e,this.socket.binaryType);this.onPacket(n)},e.prototype.onPacket=function(t){this.emit("packet",t)},e.prototype.onClose=function(){this.readyState="closed",this.emit("close")},CV}!function(t){var e,n,r=uV,i=hV(),s=dV,o=pV,a=NV;"undefined"!=typeof ArrayBuffer&&(TV||(TV=1,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",IV.encode=function(t){var e,r=new Uint8Array(t),i=r.length,s="";for(e=0;e<i;e+=3)s+=n[r[e]>>2],s+=n[(3&r[e])<<4|r[e+1]>>4],s+=n[(15&r[e+1])<<2|r[e+2]>>6],s+=n[63&r[e+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},IV.decode=function(t){var e,r,i,s,o,a=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(e=0;e<l;e+=4)r=n.indexOf(t[e]),i=n.indexOf(t[e+1]),s=n.indexOf(t[e+2]),o=n.indexOf(t[e+3]),h[c++]=r<<2|i>>4,h[c++]=(15&i)<<4|s>>2,h[c++]=(3&s)<<6|63&o;return u}),e=IV);var l="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),c="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=l||c;t.protocol=3;var h=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=r(h),p={type:"error",data:"parser error"},f=$V();function m(t,e,n){for(var r=new Array(t.length),i=o(t.length,n),s=function(t,n,i){e(n,(function(e,n){r[t]=n,i(e,r)}))},a=0;a<t.length;a++)s(a,t[a],i)}t.encodePacket=function(e,n,r,i){"function"==typeof n&&(i=n,n=!1),"function"==typeof r&&(i=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=h[e.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return r(o.buffer)}(e,n,i);if(void 0!==f&&s instanceof f)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(u)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);i[0]=h[e.type];var s=new f([i.buffer,e.data]);return r(s)}(e,n,i);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,i);var o=h[e.type];return void 0!==e.data&&(o+=r?a.encode(String(e.data),{strict:!1}):String(e.data)),i(""+o)},t.encodeBase64Packet=function(e,n){var r,i="b"+t.packets[e.type];if(void 0!==f&&e.data instanceof f){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];n(i+t)},s.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var o=new Uint8Array(e.data),a=new Array(o.length),l=0;l<o.length;l++)a[l]=o[l];r=String.fromCharCode.apply(null,a)}return i+=btoa(r),n(i)},t.decodePacket=function(e,n,r){if(void 0===e)return p;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(t){try{t=a.decode(t,{strict:!1})}catch(t){return!1}return t}(e)))return p;var i=e.charAt(0);return Number(i)==i&&d[i]?e.length>1?{type:d[i],data:e.substring(1)}:{type:d[i]}:p}i=new Uint8Array(e)[0];var o=s(e,1);return f&&"blob"===n&&(o=new f([o])),{type:d[i],data:o}},t.decodeBase64Packet=function(t,n){var r=d[t.charAt(0)];if(!e)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=e.decode(t.substr(1));return"blob"===n&&f&&(i=new f([i])),{type:r,data:i}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var s=i(e);if(n&&s)return f&&!u?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");m(e,(function(e,r){t.encodePacket(e,!!s&&n,!1,(function(t){r(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return r(e.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===e)return r(p,0,1);for(var s,o,a="",l=0,c=e.length;l<c;l++){var u=e.charAt(l);if(":"===u){if(""===a||a!=(s=Number(a)))return r(p,0,1);if(a!=(o=e.substr(l+1,s)).length)return r(p,0,1);if(o.length){if(i=t.decodePacket(o,n,!1),p.type===i.type&&p.data===i.data)return r(p,0,1);if(!1===r(i,l+s,c))return}l+=s,a=""}else a+=u}return""!==a?r(p,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(t){return n(null,t)}))}),(function(t,e){var r=e.reduce((function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2}),0),i=new Uint8Array(r),s=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);n=r.buffer}i[s++]=e?0:1;var a=n.byteLength.toString();for(o=0;o<a.length;o++)i[s++]=parseInt(a[o]);i[s++]=255;for(r=new Uint8Array(n),o=0;o<r.length;o++)i[s++]=r[o]})),n(i.buffer)}))},t.encodePayloadAsBlob=function(e,n){m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)o[i]=parseInt(s[i]);if(o[s.length]=255,f){var a=new f([e.buffer,o.buffer,t]);n(null,a)}}))}),(function(t,e){return n(new f(e))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),l=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return r(p,0,1);c+=a[u]}i=s(i,2+c.length),c=parseInt(c);var h=s(i,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);h="";for(u=0;u<d.length;u++)h+=String.fromCharCode(d[u])}o.push(h),i=s(i,c)}var f=o.length;o.forEach((function(e,i){r(t.decodePacket(e,n,!0),i,f)}))}}(cV);var OV,PV={};function LV(){return OV||(OV=1,PV.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},PV.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}),PV}var DV,FV=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},zV="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),BV={},UV=0,VV=0;function jV(t){var e="";do{e=zV[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function WV(){var t=jV(+new Date);return t!==DV?(UV=0,DV=t):t+"."+jV(UV++)}for(;VV<64;VV++)BV[zV[VV]]=VV;WV.encode=jV,WV.decode=function(t){var e=0;for(VV=0;VV<t.length;VV++)e=64*e+BV[t.charAt(VV)];return e};var HV=WV,GV=RV(),qV=LV(),XV=cV,YV=FV,KV=HV,ZV=MU.exports("engine.io-client:polling"),JV=tj,QV=null!=new aV({xdomain:!1}).responseType;function tj(t){var e=t&&t.forceBase64;QV&&!e||(this.supportsBinary=!1),GV.call(this,t)}YV(tj,GV),tj.prototype.name="polling",tj.prototype.doOpen=function(){this.poll()},tj.prototype.pause=function(t){var e=this;function n(){ZV("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ZV("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){ZV("pre-pause polling complete"),--r||n()}))),this.writable||(ZV("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){ZV("pre-pause writing complete"),--r||n()})))}else n()},tj.prototype.poll=function(){ZV("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},tj.prototype.onData=function(t){var e=this;ZV("polling got data %s",t);XV.decodePayload(t,this.socket.binaryType,(function(t,n,r){if("opening"===e.readyState&&"open"===t.type&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ZV('ignoring poll - transport state "%s"',this.readyState))},tj.prototype.doClose=function(){var t=this;function e(){ZV("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(ZV("transport open - closing"),e()):(ZV("transport not open - deferring close"),this.once("open",e))},tj.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};XV.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},tj.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=KV()),this.supportsBinary||t.sid||(t.b64=1),t=qV.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t};var ej=aV,nj=JV,rj=zU.exports,ij=FV,sj=MU.exports("engine.io-client:polling-xhr"),oj=iV;function aj(){}function lj(t){if(nj.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function cj(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(lV.exports=lj,lV.exports.Request=cj,ij(lj,nj),lj.prototype.supportsBinary=!0,lj.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new cj(t)},lj.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=r},lj.prototype.doPoll=function(){sj("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},rj(cj.prototype),cj.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new ej(t),n=this;try{sj("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof e.status?e.status:0)}),0))},sj("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){n.onError(t)}),0)}"undefined"!=typeof document&&(this.index=cj.requestsCount++,cj.requests[this.index]=this)},cj.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},cj.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},cj.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},cj.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=aj:this.xhr.onreadystatechange=aj,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete cj.requests[this.index],this.xhr=null}},cj.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},cj.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},cj.prototype.abort=function(){this.cleanup()},cj.requestsCount=0,cj.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",uj);else if("function"==typeof addEventListener){addEventListener("onpagehide"in oj?"pagehide":"unload",uj,!1)}function uj(){for(var t in cj.requests)cj.requests.hasOwnProperty(t)&&cj.requests[t].abort()}var hj,dj=JV,pj=iV,fj=bj,mj=/\n/g,gj=/\\n/g;function yj(){}function bj(t){dj.call(this,t),this.query=this.query||{},hj||(hj=pj.___eio=pj.___eio||[]),this.index=hj.length;var e=this;hj.push((function(t){e.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){e.script&&(e.script.onerror=yj)}),!1)}FV(bj,dj),bj.prototype.supportsBinary=!1,bj.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),dj.prototype.doClose.call(this)},bj.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},bj.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function a(){l(),e()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(t)}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),t=t.replace(gj,"\\\n"),this.area.value=t.replace(mj,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var vj,xj,wj=RV(),Sj=cV,_j=LV(),kj=FV,Tj=HV,Ej=MU.exports("engine.io-client:websocket");if("undefined"!=typeof WebSocket?vj=WebSocket:"undefined"!=typeof self&&(vj=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{xj=ka}catch(t){}var Mj=vj||xj,Cj=Aj;function Aj(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=vj&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(Mj=xj),wj.call(this,t)}kj(Aj,wj),Aj.prototype.name="websocket",Aj.prototype.supportsBinary=!0,Aj.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new Mj(t,e):new Mj(t):new Mj(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Aj.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},Aj.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,i=n;r<i;r++)!function(t){Sj.encodePacket(t,e.supportsBinary,(function(r){if(!e.usingBrowserWebSocket){var i={};if(t.options&&(i.compress=t.options.compress),e.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<e.perMessageDeflate.threshold&&(i.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(r):e.ws.send(r,i)}catch(t){Ej("websocket closed before onclose event")}--n||s()}))}(t[r]);function s(){e.emit("flush"),setTimeout((function(){e.writable=!0,e.emit("drain")}),0)}},Aj.prototype.onClose=function(){wj.prototype.onClose.call(this)},Aj.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Aj.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=Tj()),this.supportsBinary||(t.b64=1),(t=_j.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},Aj.prototype.check=function(){return!(!Mj||"__initialize"in Mj&&this.name===Aj.prototype.name)};var Nj=aV,Ij=lV.exports,$j=fj,Rj=Cj;tV.polling=function(t){var e=!1,n=!1,r=!1!==t.jsonp;if("undefined"!=typeof location){var i="https:"===location.protocol,s=location.port;s||(s=i?443:80),e=t.hostname!==location.hostname||s!==t.port,n=t.secure!==i}if(t.xdomain=e,t.xscheme=n,"open"in new Nj(t)&&!t.forceJSONP)return new Ij(t);if(!r)throw new Error("JSONP disabled");return new $j(t)},tV.websocket=Rj;var Oj=[].indexOf,Pj=function(t,e){if(Oj)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},Lj=tV,Dj=zU.exports,Fj=MU.exports("engine.io-client:socket"),zj=Pj,Bj=cV,Uj=EU,Vj=LV(),jj=Wj;function Wj(t,e){if(!(this instanceof Wj))return new Wj(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=Uj(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Uj(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=Vj.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||void 0,this.key=e.key||void 0,this.passphrase=e.passphrase||void 0,this.cert=e.cert||void 0,this.ca=e.ca||void 0,this.ciphers=e.ciphers||void 0,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Wj.priorWebsocketSuccess=!1,Dj(Wj.prototype),Wj.protocol=Bj.protocol,Wj.Socket=Wj,Wj.Transport=RV(),Wj.transports=tV,Wj.parser=cV,Wj.prototype.createTransport=function(t){Fj('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=Bj.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new Lj[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Wj.prototype.open=function(){var t;if(this.rememberUpgrade&&Wj.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},Wj.prototype.setTransport=function(t){Fj("setting transport %s",t.name);var e=this;this.transport&&(Fj("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},Wj.prototype.probe=function(t){Fj('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(Fj('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(Fj('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;Wj.priorWebsocketSuccess="websocket"===e.name,Fj('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(Fj("changing transport and sending upgrade packet"),u(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())}))}else{Fj('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=e.name,r.emit("upgradeError",s)}})))}function s(){n||(n=!0,u(),e.close(),e=null)}function o(n){var i=new Error("probe error: "+n);i.transport=e.name,s(),Fj('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",i)}function a(){o("transport closed")}function l(){o("socket closed")}function c(t){e&&t.name!==e.name&&(Fj('"%s" works - aborting "%s"',t.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",a),r.removeListener("close",l),r.removeListener("upgrading",c)}Wj.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",o),e.once("close",a),this.once("close",l),this.once("upgrading",c),e.open()},Wj.prototype.onOpen=function(){if(Fj("socket open"),this.readyState="open",Wj.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Fj("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},Wj.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Fj('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else Fj('packet received with socket readyState "%s"',this.readyState)},Wj.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Wj.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},Wj.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){Fj("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},Wj.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},Wj.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Wj.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Fj("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Wj.prototype.write=Wj.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},Wj.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},Wj.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():e()})):this.upgrading?r():e()}function e(){t.onClose("forced close"),Fj("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},Wj.prototype.onError=function(t){Fj("socket error %j",t),Wj.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},Wj.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Fj('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},Wj.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~zj(this.transports,t[n])&&e.push(t[n]);return e},function(t){t.exports=jj,t.exports.parser=cV}(QU);var Hj,Gj,qj={exports:{}};var Xj=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}};var Yj,Kj=[].slice,Zj=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=Kj.call(arguments,2);return function(){return e.apply(t,n.concat(Kj.call(arguments)))}};function Jj(){return Yj||(Yj=1,function(t,e){var n=FU,r=zU.exports,i=(Gj||(Gj=1,Hj=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}),Hj),s=Xj,o=Zj,a=MU.exports("socket.io-client:socket"),l=LV(),c=hV();t.exports=d;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=r.prototype.emit;function d(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[s(t,"open",o(this,"onopen")),s(t,"packet",o(this,"onpacket")),s(t,"close",o(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.reconnecting||this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var t=i(arguments);return t.unshift("message"),this.emit.apply(this,t),this},d.prototype.emit=function(t){if(u.hasOwnProperty(t))return h.apply(this,arguments),this;var e=i(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:c(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},d.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},d.prototype.onopen=function(){if(a("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?l.encode(this.query):this.query;a("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},d.prototype.onclose=function(t){a("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},d.prototype.onpacket=function(t){var e=t.nsp===this.nsp,r=t.type===n.ERROR&&"/"===t.nsp;if(e||r)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},d.prototype.onevent=function(t){var e=t.data||[];a("emitting event %j",e),null!=t.id&&(a("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?h.apply(this,e):this.receiveBuffer.push(e)},d.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var s=i(arguments);a("sending ack %j",s),e.packet({type:c(s)?n.BINARY_ACK:n.ACK,id:t,data:s})}}},d.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(a("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):a("bad ack %s",t.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emit("connect")},d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)h.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(t){return this.flags.compress=t,this},d.prototype.binary=function(t){return this.flags.binary=t,this}}(qj)),qj.exports}var Qj=tW;function tW(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}tW.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},tW.prototype.reset=function(){this.attempts=0},tW.prototype.setMin=function(t){this.ms=t},tW.prototype.setMax=function(t){this.max=t},tW.prototype.setJitter=function(t){this.jitter=t};var eW=QU.exports,nW=Jj(),rW=zU.exports,iW=FU,sW=Xj,oW=Zj,aW=MU.exports("socket.io-client:manager"),lW=Pj,cW=Qj,uW=Object.prototype.hasOwnProperty,hW=dW;function dW(t,e){if(!(this instanceof dW))return new dW(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new cW({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||iW;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}dW.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)uW.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},dW.prototype.updateSocketIds=function(){for(var t in this.nsps)uW.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},dW.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},rW(dW.prototype),dW.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},dW.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},dW.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},dW.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},dW.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},dW.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},dW.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},dW.prototype.open=dW.prototype.connect=function(t,e){if(aW("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;aW("opening %s",this.uri),this.engine=eW(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=sW(n,"open",(function(){r.onopen(),t&&t()})),s=sW(n,"error",(function(e){if(aW("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var o=this._timeout;aW("connect attempt will timeout after %d",o),0===o&&i.destroy();var a=setTimeout((function(){aW("connect attempt timed out after %d",o),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",o)}),o);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(i),this.subs.push(s),this},dW.prototype.onopen=function(){aW("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(sW(t,"data",oW(this,"ondata"))),this.subs.push(sW(t,"ping",oW(this,"onping"))),this.subs.push(sW(t,"pong",oW(this,"onpong"))),this.subs.push(sW(t,"error",oW(this,"onerror"))),this.subs.push(sW(t,"close",oW(this,"onclose"))),this.subs.push(sW(this.decoder,"decoded",oW(this,"ondecoded")))},dW.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},dW.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},dW.prototype.ondata=function(t){this.decoder.add(t)},dW.prototype.ondecoded=function(t){this.emit("packet",t)},dW.prototype.onerror=function(t){aW("error",t),this.emitAll("error",t)},dW.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new nW(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",i),n.on("connect",(function(){n.id=r.generateId(t)})),this.autoConnect&&i()}function i(){~lW(r.connecting,n)||r.connecting.push(n)}return n},dW.prototype.destroy=function(t){var e=lW(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},dW.prototype.packet=function(t){aW("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()})))},dW.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},dW.prototype.cleanup=function(){aW("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},dW.prototype.close=dW.prototype.disconnect=function(){aW("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},dW.prototype.onclose=function(t){aW("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},dW.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)aW("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();aW("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(aW("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(aW("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(aW("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},dW.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)},function(t,e){var n=DU,r=FU,i=hW,s=MU.exports("socket.io-client");t.exports=e=a;var o=e.managers={};function a(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,a=n(t),l=a.source,c=a.id,u=a.path,h=o[c]&&u in o[c].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||h?(s("ignoring socket cache for %s",l),r=i(l,e)):(o[c]||(s("new io instance for %s",l),o[c]=i(l,e)),r=o[c]),a.query&&!e.query&&(e.query=a.query),r.socket(a.path,e)}e.protocol=r.protocol,e.connect=a,e.Manager=hW,e.Socket=Jj()}(_U,_U.exports);var pW,fW,mW=_U.exports,gW={exports:{}},yW={},bW={exports:{}};function vW(){if(fW)return pW;fW=1;var t=1e3,e=60*t,n=60*e,r=24*n,i=7*r,s=365.25*r;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}return pW=function(a,l){l=l||{};var c=typeof a;if("string"===c&&a.length>0)return function(o){if((o=String(o)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!a)return;var l=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*r;case"hours":case"hour":case"hrs":case"hr":case"h":return l*n;case"minutes":case"minute":case"mins":case"min":case"m":return l*e;case"seconds":case"second":case"secs":case"sec":case"s":return l*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(a);if("number"===c&&isFinite(a))return l.long?function(i){var s=Math.abs(i);if(s>=r)return o(i,s,r,"day");if(s>=n)return o(i,s,n,"hour");if(s>=e)return o(i,s,e,"minute");if(s>=t)return o(i,s,t,"second");return i+" ms"}(a):function(i){var s=Math.abs(i);if(s>=r)return Math.round(i/r)+"d";if(s>=n)return Math.round(i/n)+"h";if(s>=e)return Math.round(i/e)+"m";if(s>=t)return Math.round(i/t)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},pW}var xW=function(t){function e(t){let r,i,s,o=null;function a(...t){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=e.formatters[i];if("function"==typeof s){const e=t[o];r=s.call(n,e),t.splice(o,1),o--}return r})),e.formatArgs.call(n,t);(n.log||e.log).apply(n,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){const r=e(this.namespace+(void 0===n?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=vW(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e};!function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=xW(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(bW,bW.exports);const wW=bW.exports("@feathersjs/errors");function SW(t,e,n,r,i){let s,o,a;(t=t||"Error")instanceof Error?(o=t.message||"Error",t.errors&&(s=t.errors)):"object"==typeof t?(o=t.message||"Error",i=t):o=t,i&&(a=JSON.parse(JSON.stringify(i)),a.errors?(s=a.errors,delete a.errors):i.errors&&(s=JSON.parse(JSON.stringify(i.errors)))),this.type="FeathersError",this.name=e,this.message=o,this.code=n,this.className=r,this.data=a,this.errors=s||{},wW(`${this.name}(${this.code}): ${this.message}`),wW(this.errors),Error.captureStackTrace?Error.captureStackTrace(this,SW):this.stack=(new Error).stack}function _W(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function kW(t,e){SW.call(this,t,"BadRequest",400,"bad-request",e)}function TW(t,e){SW.call(this,t,"NotAuthenticated",401,"not-authenticated",e)}function EW(t,e){SW.call(this,t,"PaymentError",402,"payment-error",e)}function MW(t,e){SW.call(this,t,"Forbidden",403,"forbidden",e)}function CW(t,e){SW.call(this,t,"NotFound",404,"not-found",e)}function AW(t,e){SW.call(this,t,"MethodNotAllowed",405,"method-not-allowed",e)}function NW(t,e){SW.call(this,t,"NotAcceptable",406,"not-acceptable",e)}function IW(t,e){SW.call(this,t,"Timeout",408,"timeout",e)}function $W(t,e){SW.call(this,t,"Conflict",409,"conflict",e)}function RW(t,e){SW(this,t,"Gone",410,"gone")}function OW(t,e){SW.call(this,t,"LengthRequired",411,"length-required",e)}function PW(t,e){SW.call(this,t,"Unprocessable",422,"unprocessable",e)}function LW(t,e){SW.call(this,t,"TooManyRequests",429,"too-many-requests",e)}function DW(t,e){SW.call(this,t,"GeneralError",500,"general-error",e)}function FW(t,e){SW.call(this,t,"NotImplemented",501,"not-implemented",e)}function zW(t,e){SW.call(this,t,"BadGateway",502,"bad-gateway",e)}function BW(t,e){SW.call(this,t,"Unavailable",503,"unavailable",e)}_W(SW,Error),Object.defineProperty(SW.prototype,"toJSON",{value:function(){return{name:this.name,message:this.message,code:this.code,className:this.className,data:this.data,errors:this.errors}}}),_W(kW,SW),_W(TW,SW),_W(EW,SW),_W(MW,SW),_W(CW,SW),_W(AW,SW),_W(NW,SW),_W(IW,SW),_W($W,SW),_W(RW,SW),_W(OW,SW),_W(PW,SW),_W(LW,SW),_W(DW,SW),_W(FW,SW),_W(zW,SW),_W(BW,SW);const UW={FeathersError:SW,BadRequest:kW,NotAuthenticated:TW,PaymentError:EW,Forbidden:MW,NotFound:CW,MethodNotAllowed:AW,NotAcceptable:NW,Timeout:IW,Conflict:$W,Gone:RW,LengthRequired:OW,Unprocessable:PW,TooManyRequests:LW,GeneralError:DW,NotImplemented:FW,BadGateway:zW,Unavailable:BW,400:kW,401:TW,402:EW,403:MW,404:CW,405:AW,406:NW,408:IW,409:$W,410:RW,411:OW,422:PW,429:LW,500:DW,501:FW,502:zW,503:BW};var VW=Object.assign({convert:function(t){if(!t)return t;const e=UW[t.name],n=e?new e(t.message,t.data):new Error(t.message||t);return"object"==typeof t&&Object.assign(n,t),n}},UW),jW={};Object.defineProperty(jW,"__esModule",{value:!0}),jW.StorageWrapper=jW.MemoryStorage=void 0;jW.MemoryStorage=class{constructor(){this.store={}}getItem(t){return Promise.resolve(this.store[t])}setItem(t,e){return Promise.resolve(this.store[t]=e)}removeItem(t){const e=this.store[t];return delete this.store[t],Promise.resolve(e)}};jW.StorageWrapper=class{constructor(t){this.storage=t}getItem(t){return Promise.resolve(this.storage.getItem(t))}setItem(t,e){return Promise.resolve(this.storage.setItem(t,e))}removeItem(t){return Promise.resolve(this.storage.removeItem(t))}},Object.defineProperty(yW,"__esModule",{value:!0}),yW.AuthenticationClient=void 0;const WW=VW,HW=jW,GW=(t,e)=>{const n=new RegExp(`(?:&?)${e}=([^&]*)`),r=t.hash?t.hash.match(n):null;if(null!==r){const[,t]=r;return[t,n]}return[null,n]};yW.AuthenticationClient=class{constructor(t,e){const n=t.io||t.primus,r=new HW.StorageWrapper(t.get("storage")||e.storage);this.app=t,this.options=e,this.authenticated=!1,this.app.set("storage",r),n&&this.handleSocket(n)}get service(){return this.app.service(this.options.path)}get storage(){return this.app.get("storage")}handleSocket(t){const e=this.app.io?"connect":"open",n=this.app.io?"disconnect":"disconnection";t.on(n,(()=>{const n=new Promise((n=>t.once(e,(t=>n(t))))).then((()=>this.authenticated?this.reAuthenticate(!0):null));this.app.set("authentication",n)}))}getFromLocation(t){const[e,n]=GW(t,this.options.locationKey);if(null!==e)return t.hash=t.hash.replace(n,""),Promise.resolve(e);const[r,i]=GW(t,this.options.locationErrorKey);return null!==r?(t.hash=t.hash.replace(i,""),Promise.reject(new WW.NotAuthenticated(decodeURIComponent(r)))):Promise.resolve(null)}setAccessToken(t){return this.storage.setItem(this.options.storageKey,t)}getAccessToken(){return this.storage.getItem(this.options.storageKey).then((t=>!t&&"undefined"!=typeof window&&window.location?this.getFromLocation(window.location):t||null))}removeAccessToken(){return this.storage.removeItem(this.options.storageKey)}reset(){return this.app.set("authentication",null),this.authenticated=!1,Promise.resolve(null)}handleError(t,e){if(401===t.code||403===t.code){const n=this.removeAccessToken().then((()=>this.reset()));return"logout"===e?n:n.then((()=>Promise.reject(t)))}return Promise.reject(t)}reAuthenticate(t=!1,e){const n=this.app.get("authentication");return n&&!0!==t?n:this.getAccessToken().then((t=>{if(!t)throw new WW.NotAuthenticated("No accessToken found in storage");return this.authenticate({strategy:e||this.options.jwtStrategy,accessToken:t})}))}authenticate(t,e){if(!t)return this.reAuthenticate();const n=this.service.create(t,e).then((t=>{const{accessToken:e}=t;return this.authenticated=!0,this.app.emit("login",t),this.app.emit("authenticated",t),this.setAccessToken(e).then((()=>t))})).catch((t=>this.handleError(t,"authenticate")));return this.app.set("authentication",n),n}logout(){return Promise.resolve(this.app.get("authentication")).then((()=>this.service.remove(null).then((t=>this.removeAccessToken().then((()=>this.reset())).then((()=>(this.app.emit("logout",t),t))))))).catch((t=>this.handleError(t,"logout")))}};var qW,XW={},YW={},KW={},ZW={},JW={};qW=JW,Object.defineProperty(qW,"__esModule",{value:!0}),qW.createSymbol=qW.makeUrl=qW.isPromise=qW._=qW.stripSlashes=void 0,qW.stripSlashes=function(t){return t.replace(/^(\/+)|(\/+)$/g,"")},qW._={each(t,e){t&&"function"==typeof t.forEach?t.forEach(e):qW._.isObject(t)&&Object.keys(t).forEach((n=>e(t[n],n)))},some:(t,e)=>Object.keys(t).map((e=>[t[e],e])).some((([t,n])=>e(t,n))),every:(t,e)=>Object.keys(t).map((e=>[t[e],e])).every((([t,n])=>e(t,n))),keys:t=>Object.keys(t),values:t=>qW._.keys(t).map((e=>t[e])),isMatch:(t,e)=>qW._.keys(e).every((n=>t[n]===e[n])),isEmpty:t=>0===qW._.keys(t).length,isObject:t=>"object"==typeof t&&!Array.isArray(t)&&null!==t,isObjectOrArray:t=>"object"==typeof t&&null!==t,extend:(t,...e)=>Object.assign(t,...e),omit(t,...e){const n=qW._.extend({},t);return e.forEach((t=>delete n[t])),n},pick:(t,...e)=>e.reduce(((e,n)=>(void 0!==t[n]&&(e[n]=t[n]),e)),{}),merge:(t,e)=>(qW._.isObject(t)&&qW._.isObject(e)&&Object.keys(e).forEach((n=>{qW._.isObject(e[n])?(t[n]||Object.assign(t,{[n]:{}}),qW._.merge(t[n],e[n])):Object.assign(t,{[n]:e[n]})})),t)},qW.isPromise=function(t){return qW._.isObject(t)&&"function"==typeof t.then},qW.makeUrl=function(t,e={}){const n="function"==typeof e.get?e.get.bind(e):()=>{},r=n("env")||"production",i=n("host")||process.env.HOST_NAME||"localhost",s="development"===r||"test"===r||void 0===r?"http":"https",o=n("port")||process.env.PORT||3030;return t=t||"",`${s}://${i}${"development"===r||"test"===r||void 0===r?`:${o}`:""}/${qW.stripSlashes(t)}`},qW.createSymbol=function(t){return"undefined"!=typeof Symbol?Symbol(t):t},Object.defineProperty(ZW,"__esModule",{value:!0}),ZW.enableHooks=ZW.processHooks=ZW.getHooks=ZW.isHookObject=ZW.convertHookData=ZW.makeArguments=ZW.defaultMakeArguments=ZW.createHookObject=ZW.ACTIVATE_HOOKS=void 0;const QW=JW,{each:tH,pick:eH}=QW._;function nH(t){const e=[];return void 0!==t.id&&e.push(t.id),t.data&&e.push(t.data),e.push(t.params||{}),e}function rH(t){let e={};return Array.isArray(t)?e={all:t}:"object"!=typeof t?e={all:[t]}:tH(t,(function(t,n){e[n]=Array.isArray(t)?t:[t]})),e}function iH(t){return"object"==typeof t&&"string"==typeof t.method&&"string"==typeof t.type}ZW.ACTIVATE_HOOKS=(0,QW.createSymbol)("__feathersActivateHooks"),ZW.createHookObject=function(t,e={}){const n={};return Object.defineProperty(n,"toJSON",{value(){return eH(this,"type","method","path","params","id","data","result","error")}}),Object.assign(n,e,{method:t,get path(){const{app:t,service:n}=e;return n&&t&&t.services?Object.keys(t.services).find((e=>t.services[e]===n)):null}})},ZW.defaultMakeArguments=nH,ZW.makeArguments=function(t){switch(t.method){case"find":return[t.params];case"get":case"remove":return[t.id,t.params];case"update":case"patch":return[t.id,t.data,t.params];case"create":return[t.data,t.params]}return nH(t)},ZW.convertHookData=rH,ZW.isHookObject=iH,ZW.getHooks=function(t,e,n,r,i=!1){const s=t.__hooks[n][r]||[],o=e.__hooks[n][r]||[];return i?o.concat(s):s.concat(o)},ZW.processHooks=function(t,e){let n=e;const r=t=>{if(t){if(!iH(t))throw new Error(`${n.type} hook for '${n.method}' method returned invalid hook object`);n=t}return n};return t.reduce(((t,e)=>{const n=e.bind(this);return t.then((t=>n(t))).then(r)}),Promise.resolve(n)).then((()=>n)).catch((t=>{throw t.hook=n,t}))},ZW.enableHooks=function(t,e,n){if("function"==typeof t.hooks)return t;const r={};return n.forEach((t=>{r[t]={}})),Object.defineProperty(t,"__hooks",{configurable:!0,value:r,writable:!0}),Object.assign(t,{hooks(t){return tH(t,((t,n)=>{if(!this.__hooks[n])throw new Error(`'${n}' is not a valid hook type`);const r=rH(t);tH(r,((t,n)=>{if("all"!==n&&-1===e.indexOf(n))throw new Error(`'${n}' is not a valid hook method`)})),e.forEach((t=>{const e=this.__hooks[n][t]||(this.__hooks[n][t]=[]);r.all&&e.push.apply(e,r.all),r[t]&&e.push.apply(e,r[t])}))})),this}})},function(t){var e=yt&&yt.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),n=yt&&yt.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&e(r,t,i);return n(r,t),r},i=yt&&yt.__exportStar||function(t,n){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||e(n,t,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.hooks=void 0;const s=r(ZW);i(JW,t),t.hooks=s}(KW),Object.defineProperty(YW,"__esModule",{value:!0}),YW.authentication=void 0;const sH=KW;YW.authentication=()=>t=>{const{app:e,params:n,path:r,method:i,app:{authentication:s}}=t;return(0,sH.stripSlashes)(s.options.path)===r&&"create"===i?t:Promise.resolve(e.get("authentication")).then((e=>(e&&(t.params=Object.assign({},e,n)),t)))};var oH={};Object.defineProperty(oH,"__esModule",{value:!0}),oH.populateHeader=void 0;oH.populateHeader=()=>t=>{const{app:e,params:{accessToken:n}}=t,r=e.authentication;if(e.rest&&n){const{scheme:e,header:i}=r.options,s=`${e} ${n}`;t.params.headers=Object.assign({},{[i]:s},t.params.headers)}return t},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.populateHeader=t.authentication=void 0;var e=YW;Object.defineProperty(t,"authentication",{enumerable:!0,get:function(){return e.authentication}});var n=oH;Object.defineProperty(t,"populateHeader",{enumerable:!0,get:function(){return n.populateHeader}})}(XW),function(t,e){var n=yt&&yt.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=yt&&yt.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=e.defaultStorage=e.hooks=e.MemoryStorage=e.AuthenticationClient=e.getDefaultStorage=void 0;const s=yW;Object.defineProperty(e,"AuthenticationClient",{enumerable:!0,get:function(){return s.AuthenticationClient}});const o=i(XW);e.hooks=o;const a=jW;Object.defineProperty(e,"MemoryStorage",{enumerable:!0,get:function(){return a.MemoryStorage}});e.getDefaultStorage=()=>{try{return new a.StorageWrapper(window.localStorage)}catch(t){}return new a.MemoryStorage},e.defaultStorage=(0,e.getDefaultStorage)(),e.defaults={header:"Authorization",scheme:"Bearer",storageKey:"feathers-jwt",locationKey:"access_token",locationErrorKey:"error",jwtStrategy:"jwt",path:"/authentication",Authentication:s.AuthenticationClient,storage:e.defaultStorage};const l=(t={})=>{const n=Object.assign({},e.defaults,t),{Authentication:r}=n;return t=>{const e=new r(t,n);t.authentication=e,t.authenticate=e.authenticate.bind(e),t.reAuthenticate=e.reAuthenticate.bind(e),t.logout=e.logout.bind(e),t.hooks({before:{all:[o.authentication(),o.populateHeader()]}})}};e.default=l,t.exports=Object.assign(l,t.exports)}(gW,gW.exports);var aH=bt(gW.exports),lH={exports:{}},cH={exports:{}};cH.exports=function(){var t="function"==typeof Object.getOwnPropertySymbols;function e(e,n,r,i){var s="function"==typeof n,o=function(){var t=this._super;this._super=s?n:e[r];var o=i.apply(this,arguments);return this._super=t,o};return s&&(Object.keys(n).forEach((function(t){o[t]=n[t]})),t&&Object.getOwnPropertySymbols(n).forEach((function(t){o[t]=n[t]}))),o}return{create:function(){var t=Object.create(this),e="string"==typeof t.__init?t.__init:"init";return"function"==typeof t[e]&&t[e].apply(t,arguments),t},mixin:function(n,r){var i=r||this,s=/\b_super\b/,o=Object.getPrototypeOf(i)||i.prototype,a={},l=n,c=function(t){var e=Object.getOwnPropertyDescriptor(l,t);!a[t]&&e&&(a[t]=e)};do{Object.getOwnPropertyNames(l).forEach(c),t&&Object.getOwnPropertySymbols(l).forEach(c)}while((l=Object.getPrototypeOf(l))&&Object.getPrototypeOf(l));var u=function(t){var n=a[t];"function"==typeof n.value&&s.test(n.value)&&(n.value=e(o,i[t],t,n.value)),Object.defineProperty(i,t,n)};return Object.keys(a).forEach(u),t&&Object.getOwnPropertySymbols(a).forEach(u),i},extend:function(t,e){return this.mixin(t,Object.create(e||this))},proxy:function(t){var e=this[t],n=Array.prototype.slice.call(arguments,1);return n.unshift(this),e.bind.apply(e,n)}}}();var uH,hH={exports:{}},dH={exports:{}},pH="object"==typeof Reflect?Reflect:null,fH=pH&&"function"==typeof pH.apply?pH.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};uH=pH&&"function"==typeof pH.ownKeys?pH.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var mH=Number.isNaN||function(t){return t!=t};function gH(){gH.init.call(this)}dH.exports=gH,dH.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}EH(t,e,s,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&EH(t,"error",e,n)}(t,i,{once:!0})}))},gH.EventEmitter=gH,gH.prototype._events=void 0,gH.prototype._eventsCount=0,gH.prototype._maxListeners=void 0;var yH=10;function bH(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function vH(t){return void 0===t._maxListeners?gH.defaultMaxListeners:t._maxListeners}function xH(t,e,n,r){var i,s,o,a;if(bH(n),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),void 0===o)o=s[e]=n,++t._eventsCount;else if("function"==typeof o?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=vH(t))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return t}function wH(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function SH(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=wH.bind(r);return i.listener=n,r.wrapFn=i,i}function _H(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):TH(i,i.length)}function kH(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function TH(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function EH(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}Object.defineProperty(gH,"defaultMaxListeners",{enumerable:!0,get:function(){return yH},set:function(t){if("number"!=typeof t||t<0||mH(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yH=t}}),gH.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},gH.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||mH(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},gH.prototype.getMaxListeners=function(){return vH(this)},gH.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[t];if(void 0===a)return!1;if("function"==typeof a)fH(a,this,e);else{var l=a.length,c=TH(a,l);for(n=0;n<l;++n)fH(c[n],this,e)}return!0},gH.prototype.addListener=function(t,e){return xH(this,t,e,!1)},gH.prototype.on=gH.prototype.addListener,gH.prototype.prependListener=function(t,e){return xH(this,t,e,!0)},gH.prototype.once=function(t,e){return bH(e),this.on(t,SH(this,t,e)),this},gH.prototype.prependOnceListener=function(t,e){return bH(e),this.prependListener(t,SH(this,t,e)),this},gH.prototype.removeListener=function(t,e){var n,r,i,s,o;if(bH(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},gH.prototype.off=gH.prototype.removeListener,gH.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},gH.prototype.listeners=function(t){return _H(this,t,!0)},gH.prototype.rawListeners=function(t){return _H(this,t,!1)},gH.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):kH.call(t,e)},gH.prototype.listenerCount=kH,gH.prototype.eventNames=function(){return this._eventsCount>0?uH(this._events):[]},function(t,e){const{EventEmitter:n}=dH.exports,r=cH.exports,i=e.eventHook=function(){return function(t){const{app:e,service:n}=t,r=null===t.event?t.event:e.eventMappings[t.method],i=n._hookEvents&&-1!==n._hookEvents.indexOf(r);if(r&&i&&"error"!==t.type){(Array.isArray(t.result)?t.result:[t.result]).forEach((e=>n.emit(r,e,t)))}}},s=e.eventMixin=function(t){if(t._serviceEvents)return;const e=this,r="function"==typeof t.on&&"function"==typeof t.emit;"function"!=typeof t.mixin||r||t.mixin(n.prototype),Object.defineProperties(t,{_serviceEvents:{value:Array.isArray(t.events)?t.events.slice():[]},_hookEvents:{value:[]}}),Object.keys(e.eventMappings).forEach((n=>{const r=e.eventMappings[n],i=-1!==t._serviceEvents.indexOf(r);"function"!=typeof t[n]||i||(t._serviceEvents.push(r),t._hookEvents.push(r))}))};t.exports=function(){return function(t){Object.assign(t,{eventMappings:{create:"created",update:"updated",remove:"removed",patch:"patched"}}),t.hooks({finally:i()}),r.mixin(n.prototype,t),t.mixins.push(s)}}}(hH,hH.exports);var MH={exports:{}};const{_:CH}=KW;var AH=[t=>{const{service:e,method:n}=t,r=e.methods[n];return t.arguments.forEach(((e,n)=>{t[r[n]]=e})),t.params||(t.params={}),t},t=>{const{service:e,method:n,path:r}=t,i=e.methods[n];if(i.includes("id")&&void 0===t.id)throw new Error(`An id must be provided to the '${r}.${n}' method`);if(i.includes("data")&&!CH.isObjectOrArray(t.data))throw new Error(`A data object must be provided to the '${r}.${n}' method`);return t}];!function(t,e){const{hooks:n,isPromise:r}=KW,i=AH,{createHookObject:s,getHooks:o,processHooks:a,enableHooks:l,ACTIVATE_HOOKS:c}=n,u=function({app:t,service:e,method:n,original:o}){return(l={})=>{const c=t.hookTypes.reduce(((t,e)=>{const n=l[e]||[];return t[e]=Array.isArray(n)?n:[n],t}),{});return function(...l){const u=!0===l[l.length-1]&&l.pop(),h=s(n,{type:"before",arguments:l,service:e,app:t});return Promise.resolve(h).then((t=>a.call(e,i.concat(c.before),t))).then((t=>{if(void 0!==t.result)return t;const i=new Promise((i=>{const s=o||e[n],a=e.methods[n].map((e=>t[e])),l=s.apply(e,a);if(!r(l))throw new Error(`Service method '${t.method}' for '${t.path}' service must return a promise`);i(l)}));return i.then((e=>(t.result=e,t))).catch((e=>{throw e.hook=t,e}))})).then((t=>{const n=Object.assign({},t,{type:"after"});return a.call(e,c.after,n)})).catch((t=>{const n=Object.assign({},t.hook,{type:"error",original:t.hook,error:t,result:void 0});return a.call(e,c.error,n).catch((t=>Object.assign({},t.hook,{error:t,result:void 0})))})).then((t=>a.call(e,c.finally,t).catch((t=>Object.assign({},t.hook,{error:t,result:void 0}))))).then((t=>void 0!==t.error&&void 0===t.result?Promise.reject(u?t:t.error):u?t:t.result))}}},h=e.hookMixin=function(t){if("function"==typeof t.hooks)return;t.methods=Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&t[e][c])).reduce(((e,n)=>(e[n]=t[n][c],e)),t.methods||{}),Object.assign(t.methods,{find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]});const e=this,n=Object.keys(t.methods),r=n.reduce(((n,r)=>("function"!=typeof t[r]||(n[r]=function(){const t=this,n=Array.from(arguments),i=t._super.bind(t);return u({app:e,service:t,method:r,original:i})({before:o(e,t,"before",r),after:o(e,t,"after",r,!0),error:o(e,t,"error",r,!0),finally:o(e,t,"finally",r,!0)})(...n)}),n)),{});l(t,n,e.hookTypes),t.mixin(r)};t.exports=function(){return function(t){Object.assign(t,{hookTypes:["before","after","error","finally"]}),l(t,t.methods,t.hookTypes),t.mixins.push(h)}},t.exports.withHooks=u,t.exports.ACTIVATE_HOOKS=c,t.exports.activateHooks=function(t){return e=>(Object.defineProperty(e,c,{value:t}),e)}}(MH,MH.exports);const NH=bW.exports("feathers:application"),{stripSlashes:IH}=KW,$H=hH.exports,RH=MH.exports,OH=cH.exports.extend({create:null}),PH={init(){Object.assign(this,{version:"4.5.15",methods:["find","get","create","update","patch","remove"],mixins:[],services:{},providers:[],_setup:!1,settings:{}}),this.configure(RH()),this.configure($H())},get(t){return this.settings[t]},set(t,e){return this.settings[t]=e,this},disable(t){return this.settings[t]=!1,this},disabled(t){return!this.settings[t]},enable(t){return this.settings[t]=!0,this},enabled(t){return!!this.settings[t]},configure(t){return t.call(this,this),this},service(t,e){if(void 0!==e)throw new Error("Registering a new service with `app.service(path, service)` is no longer supported. Use `app.use(path, service)` instead.");const n=IH(t)||"/",r=this.services[n];return void 0===r&&"function"==typeof this.defaultService?this.use(n,this.defaultService(n)).service(n):r},use(t,e,n={}){if("string"!=typeof t)throw new Error(`'${t}' is not a valid service path.`);const r=IH(t)||"/",i="function"==typeof e.service&&e.services,s=this.methods.concat("setup").some((t=>"function"==typeof e[t]));if(i){const t=e;return Object.keys(t.services).forEach((e=>this.use(`${r}/${e}`,t.service(e)))),this}if(!s)throw new Error(`Invalid service object passed for path \`${r}\``);const o=OH.isPrototypeOf(e)?e:OH.extend(e);return NH(`Registering new service at \`${r}\``),this.mixins.forEach((t=>t.call(this,o,r,n))),"function"==typeof o._setup&&o._setup(this,r),this.providers.forEach((t=>t.call(this,o,r,n))),this._isSetup&&"function"==typeof o.setup&&(NH(`Setting up service for \`${r}\``),o.setup(this,r)),this.services[r]=o,this},setup(){return Object.keys(this.services).forEach((t=>{const e=this.services[t];NH(`Setting up service for \`${t}\``),"function"==typeof e.setup&&e.setup(this,t)})),this._isSetup=!0,this}};const LH=cH.exports,DH=PH,{ACTIVATE_HOOKS:FH,activateHooks:zH}=MH.exports,BH=Object.create(null);function UH(){const t=Object.create(BH);return LH.mixin(DH,t),t.init(),t}UH.version="4.5.15",UH.ACTIVATE_HOOKS=FH,UH.activateHooks=zH,lH.exports=UH,lH.exports.default=UH;var VH={exports:{}},jH={},WH=yt&&yt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(jH,"__esModule",{value:!0}),jH.Service=void 0;const HH=WH(bW.exports),GH=VW,qH=(0,HH.default)("@feathersjs/transport-commons/client"),XH=["addListener","emit","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeListener"],YH=["eventNames","getMaxListeners","setMaxListeners"],KH=t=>{YH.forEach((e=>{t[e]=function(...t){if("function"!=typeof this.connection[e])throw new Error(`Can not call '${e}' on the client service connection`);return this.connection[e](...t)}})),XH.forEach((e=>{t[e]=function(t,...n){if("function"!=typeof this.connection[e])throw new Error(`Can not call '${e}' on the client service connection`);const r=`${this.path} ${t}`;qH(`Calling emitter method ${e} with namespaced event '${r}'`);const i=this.connection[e](r,...n);return i===this.connection?this:i}}))};jH.Service=class{constructor(t){this.events=t.events,this.path=t.name,this.connection=t.connection,this.method=t.method,this.timeout=t.timeout||5e3,KH(this)}send(t,...e){return new Promise(((n,r)=>{const i=setTimeout((()=>r(new GH.Timeout(`Timeout of ${this.timeout}ms exceeded calling ${t} on ${this.path}`,{timeout:this.timeout,method:t,path:this.path}))),this.timeout);e.unshift(t,this.path),e.push((function(t,e){return t=(0,GH.convert)(t),clearTimeout(i),t?r(t):n(e)})),qH(`Sending socket.${this.method}`,e),this.connection[this.method](...e)}))}find(t={}){return this.send("find",t.query||{})}get(t,e={}){return this.send("get",t,e.query||{})}create(t,e={}){return this.send("create",t,e.query||{})}update(t,e,n={}){return this.send("update",t,e,n.query||{})}patch(t,e,n={}){return this.send("patch",t,e,n.query||{})}remove(t,e={}){return this.send("remove",t,e.query||{})}off(t,...e){if("function"==typeof this.connection.off){const n=this.connection.off(`${this.path} ${t}`,...e);return n===this.connection?this:n}return 0===e.length?this.removeAllListeners(t):this.removeListener(t,...e)}};const ZH=jH.Service;function JH(t,e){if(!t)throw new Error("Socket.io connection needs to be provided");if(t&&t.io&&t.io.engine&&t.io.engine.transport&&t.io.engine.transport.query&&t.io.engine.transport.query.EIO>3)throw console.error("You are trying to use the Socket.io client version 3 or later with Feathers v4 which only supports Socket.io version 2. Please use socket.io-client version 2 instead."),new Error("socket.io-client must be version 2.x");const n=function(n){const r=Object.keys(this.eventMappings||{}).map((t=>this.eventMappings[t])),i=Object.assign({},e,{events:r,name:n,connection:t,method:"emit"});return new ZH(i)},r=function(e){if("function"==typeof e.defaultService)throw new Error("Only one default client provider can be configured");e.io=t,e.defaultService=n};return r.Service=ZH,r.service=n,r}VH.exports=JH,VH.exports.default=JH;var QH={exports:{}},tG={},eG={},nG={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.OPERATORS=e.FILTERS=void 0;const n=KW,r=VW;function i(t){if(void 0!==t)return Math.abs(parseInt(t,10))}function s(t,e,i){if(Array.isArray(t))return t.map((t=>s(t,e,i)));if(n._.isObject(t)&&t.constructor==={}.constructor){const o={};return n._.each(t,((n,a)=>{if("$"===a[0]){if(void 0!==i[a])return;if(!e.includes(a))throw new r.BadRequest(`Invalid query parameter ${a}`,t)}o[a]=s(n,e,i)})),Object.getOwnPropertySymbols(t).forEach((e=>{o[e]=t[e]})),o}return t}function o(t,e,r,i){return Array.isArray(r)?n._.each(r,(n=>{void 0!==e[n]&&(t[n]=e[n])})):n._.each(r,((n,r)=>{const s=n(e[r],i);void 0!==s&&(t[r]=s)})),t}function a(t,n={}){const{filters:r={},operators:i=[]}=n,a={};return a.filters=o({},t,e.FILTERS,n),a.filters=o(a.filters,t,r,n),a.query=s(t,e.OPERATORS.concat(i),a.filters),a}e.FILTERS={$sort:t=>function(t){return"object"!=typeof t||Array.isArray(t)?t:Object.keys(t).reduce(((e,n)=>(e[n]="object"==typeof t[n]?t[n]:parseInt(t[n],10),e)),{})}(t),$limit:(t,e)=>function(t,e){if(e&&e.default){const n="number"!=typeof t||isNaN(t)?e.default:t,r="number"==typeof e.max?e.max:Number.MAX_VALUE;return Math.min(n,r)}return t}(i(t),e.paginate),$skip:t=>i(t),$select:t=>t},e.OPERATORS=["$in","$nin","$lt","$lte","$gt","$gte","$ne","$or"],e.default=a,t.exports=Object.assign(a,t.exports)}(nG,nG.exports);var rG=yt&&yt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eG,"__esModule",{value:!0}),eG.AdapterService=void 0;const iG=VW,sG=rG(nG.exports),oG=(t,e,...n)=>"function"!=typeof t[e]?Promise.reject(new iG.NotImplemented(`Method ${e} not available`)):t[e](...n),aG={find:!0,get:!1,update:!1};eG.AdapterService=class{constructor(t){this.options=Object.assign({id:"id",events:[],paginate:{},multi:!1,filters:[],whitelist:[]},t)}get id(){return this.options.id}get events(){return this.options.events}filterQuery(t={},e={}){const n=void 0!==t.paginate?t.paginate:this.options.paginate,{query:r={}}=t,i=Object.assign({operators:this.options.whitelist||[],filters:this.options.filters,paginate:n},e),s=(0,sG.default)(r,i);return Object.assign(s,{paginate:n})}allowsMulti(t){const e=aG[t];if(void 0!==e)return e;const n=this.options.multi;return!0===n||!1===n?n:n.includes(t)}find(t){return oG(this,"_find",t)}get(t,e){return oG(this,"_get",t,e)}create(t,e){return Array.isArray(t)&&!this.allowsMulti("create")?Promise.reject(new iG.MethodNotAllowed("Can not create multiple entries")):oG(this,"_create",t,e)}update(t,e,n){return null===t||Array.isArray(e)?Promise.reject(new iG.BadRequest("You can not replace multiple instances. Did you mean 'patch'?")):oG(this,"_update",t,e,n)}patch(t,e,n){return null!==t||this.allowsMulti("patch")?oG(this,"_patch",t,e,n):Promise.reject(new iG.MethodNotAllowed("Can not patch multiple entries"))}remove(t,e){return null!==t||this.allowsMulti("remove")?oG(this,"_remove",t,e):Promise.reject(new iG.MethodNotAllowed("Can not remove multiple entries"))}};var lG={};function cG(t){var e="[object "+t+"]";return function(t){return Object.prototype.toString.call(t)===e}}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sorter=t.compare=t.compareArrays=t.compareNSB=void 0,t.compareNSB=function(t,e){return t<e?-1:t>e?1:0},t.compareArrays=function(e,n){let r,i;for(r=0;r<Math.min(e.length,n.length);r+=1)if(i=t.compare(e[r],n[r]),0!==i)return i;return t.compareNSB(e.length,n.length)},t.compare=function(e,n,r=t.compareNSB){const{compareNSB:i,compare:s,compareArrays:o}=t;if(void 0===e)return void 0===n?0:-1;if(void 0===n)return void 0===e?0:1;if(null===e)return null===n?0:-1;if(null===n)return null===e?0:1;if("number"==typeof e)return"number"==typeof n?i(e,n):-1;if("number"==typeof n)return"number"==typeof e?i(e,n):1;if("string"==typeof e)return"string"==typeof n?r(e,n):-1;if("string"==typeof n)return"string"==typeof e?r(e,n):1;if("boolean"==typeof e)return"boolean"==typeof n?i(e,n):-1;if("boolean"==typeof n)return"boolean"==typeof e?i(e,n):1;if(e instanceof Date)return n instanceof Date?i(e.getTime(),n.getTime()):-1;if(n instanceof Date)return e instanceof Date?i(e.getTime(),n.getTime()):1;if(Array.isArray(e))return Array.isArray(n)?o(e,n):-1;if(Array.isArray(n))return Array.isArray(e)?o(e,n):1;const a=Object.keys(e).sort(),l=Object.keys(n).sort();let c=0;for(let t=0;t<Math.min(a.length,l.length);t+=1)if(c=s(e[a[t]],n[l[t]]),0!==c)return c;return i(a.length,l.length)},t.sorter=function(e){const n=Object.keys(e).map((t=>({key:t,direction:e[t]})));return function(e,r){let i;for(const s of n)if(i=s.direction*t.compare(e[s.key],r[s.key]),0!==i)return i;return 0}}}(lG),function(t){var e=yt&&yt.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),n=yt&&yt.__exportStar||function(t,n){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||e(n,t,r)},r=yt&&yt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.select=t.OPERATORS=t.FILTERS=t.filterQuery=t.AdapterService=void 0;const i=KW;var s=eG;Object.defineProperty(t,"AdapterService",{enumerable:!0,get:function(){return s.AdapterService}});var o=nG.exports;Object.defineProperty(t,"filterQuery",{enumerable:!0,get:function(){return r(o).default}}),Object.defineProperty(t,"FILTERS",{enumerable:!0,get:function(){return o.FILTERS}}),Object.defineProperty(t,"OPERATORS",{enumerable:!0,get:function(){return o.OPERATORS}}),n(lG,t),t.select=function(t,...e){const n=t&&t.query&&t.query.$select;Array.isArray(n)&&e.length&&n.push(...e);const r=t=>Array.isArray(n)?i._.pick(t,...n):t;return t=>Array.isArray(t)?t.map(r):r(t)}}(tG);var uG=cG("Array"),hG=cG("Object"),dG=cG("Function");function pG(t,e){return dG(t.get)?t.get(e):t[e]}const fG=(mG=t=>function(e,n,r,i,s){if(!uG(n)||!n.length)return t(e,n);for(var o=0,a=n.length;o<a;o++)if(t(e,pG(n,o)))return!0;return!1},(t,e,n,r,i)=>i?Boolean(i.find((([e,n,r])=>mG(t,n,r)))):mG(t,e,n,r));var mG;function gG(t){return function(e,n,r,i){if(!uG(n)||!n.length)return t(e,n,r,i);for(var s=0,o=n.length;s<o;s++)if(!t(e,pG(n,s),n,i))return!1;return!0}}function yG(t,e,n,r,i){return t.validate(t.options,e,n,r,i)}var bG={$eq:fG((function(t,e){return t(e)})),$ne:gG((function(t,e){return t(e)})),$gt:fG((function(t,e){return t(e)})),$gte:fG((function(t,e){return t(e)})),$lt:fG((function(t,e){return t(e)})),$lte:fG((function(t,e){return t(e)})),$mod:fG((function(t,e){return t(e)})),$in:(t,e)=>t(e),$nin:function(t,e){return t(e)},$not:function(t,e,n,r){return t(e,n,r)},$type:function(t,e){return t(e)},$all:function(t,e,n,r,i){return bG.$and(t,e,n,r,i)},$size:function(t,e){return!!e&&t===e.length},$or:function(t,e,n,r){for(var i=0,s=t.length;i<s;i++)if(yG(pG(t,i),e,n,r))return!0;return!1},$nor:function(t,e,n,r){return!bG.$or(t,e,n,r)},$and:function(t,e,n,r,i){if(i){for(var s=0,o=t.length;s<o;s++)if(!yG(pG(t,s),e,n,r,i))return!1}else for(s=0,o=t.length;s<o;s++)if(!yG(pG(t,s),e,n,r,i))return!1;return!0},$regex:fG((function(t,e){return"string"==typeof e&&t.test(e)})),$where:function(t,e,n,r){return t.call(e,e,n,r)},$elemMatch:function(t,e,n,r){return uG(e)?!!~function(t,e){for(var n=0;n<t.length;n++)if(pG(t,n),yG(e,pG(t,n)))return n;return-1}(e,t):yG(t,e,n,r)},$exists:function(t,e,n,r){return r.hasOwnProperty(n)===t}},vG={$eq:function(t,e,{comparable:n,compare:r}){return t instanceof RegExp?fG((function(e){return"string"==typeof e&&t.test(e)})):t instanceof Function?fG(t):uG(t)&&!t.length?fG((function(t){return uG(t)&&!t.length})):fG(null===t?function(t){return null==t}:function(e){return 0===r(n(e),n(t))})},$gt:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))>0}},$gte:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))>=0}},$lt:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))<0}},$lte:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))<=0}},$in:function(t,e,n){const{comparable:r}=n;return function(e){if(!(e instanceof Array)){var i=r(e);if(i===e&&"object"==typeof e)for(o=t.length;o--;)if(String(t[o])===String(e)&&"[object Object]"!==String(e))return!0;if(void 0===i)for(o=t.length;o--;)if(null==t[o])return!0;for(o=t.length;o--;){var s=yG(MG(pG(t,o),n),i,o,t);if(s&&"[object Object]"!==String(s)&&"[object Object]"!==String(i))return!0}return!!~t.indexOf(i)}for(var o=e.length;o--;)if(~t.indexOf(r(pG(e,o))))return!0;return!1}},$nin:function(t,e,n){const r=vG.$in(t,e,n);return function(t,e,n,i){return!r(t,e,n,i)}},$mod:function(t){return function(e){return e%t[0]==t[1]}},$ne:function(t,e,n){const r=vG.$eq(t,e,n);return gG((function(t,e,n,i){return!r(t,e,n,i)}))},$and:function(t,e,n){return t.map(kG(n))},$all:function(t,e,n){return vG.$and(t,e,n)},$or:function(t,e,n){return t.map(kG(n))},$nor:function(t,e,n){return t.map(kG(n))},$not:function(t,e,n){const r=kG(n)(t);return function(t,e,n){return!yG(r,t,e,n)}},$type:function(t){return function(e,n,r){return null!=e&&(e instanceof t||e.constructor==t)}},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return"string"==typeof t?new Function("obj","return "+t):t},$elemMatch:function(t,e,n){return kG(n)(t)},$exists:function(t){return!!t}};function xG(t,e){return{options:t,validate:e}}function wG({keyPath:t,child:e,query:n},r){const i=[];if(SG(r,t,0,r,i),1===i.length){const[t,n,r]=i[0];return yG(e,t,n,r)}return n&&n.$ne,i.map((([t])=>t)),yG(e,void 0,void 0,void 0,i)}function SG(t,e,n,r,i){if(n!==e.length&&null!=t){var s=pG(e,n);if(uG(t)&&isNaN(Number(s)))for(var o=0,a=t.length;o<a;o++)SG(pG(t,o),e,n,t,i);else SG(pG(t,s),e,n+1,t,i)}else i.push([t,e[n-1],r])}function _G(t,e,n){return xG({keyPath:t,child:e,query:n},wG)}function kG(t){const{comparable:e,expressions:n}=t;var r=function(t){var e;return t&&((e=t)&&(e.constructor===Object||e.constructor===Array||"function Object() { [native code] }"===e.constructor.toString()||"function Array() { [native code] }"===e.constructor.toString()))||(t={$eq:t}),t},i=function(r){r=e(r);var i=[];for(var o in r){var a=r[o];if("$options"!==o){var l=bG[o]||t&&n&&n[o];if(l)vG[o]&&(a=vG[o](a,r,t)),i.push(xG(e(a),l));else{if(36===o.charCodeAt(0))throw new Error("Unknown operation "+o);var c=o.split(".");i.push(_G(c,s(a),a))}}}return 1===i.length?i[0]:xG(i,bG.$and)},s=function(t){return t=r(t),-1===EG(t,[]).join(",").search(/[$.]/)?xG(t,TG):i(t)};return function(t){return i(r(t))}}function TG(t,e){if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(hG(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!TG(t[n],e[n]))return!1;return!0}if(uG(t)){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(!TG(t[r],e[r]))return!1;return!0}return t===e}function EG(t,e){if(!hG(t))return e;for(var n in t)e.push(n),EG(t[n],e);return e}function MG(t,e){var n=kG(e)(t);return e&&e.select&&(n={options:n,validate:function(t,n,r,i){return yG(t,n&&e.select(n),r,i)}}),n}function CG(t,e){if(TG(t,e))return 0;if(typeof t==typeof e){if(t>e)return 1;if(t<e)return-1}}function AG(t){return t instanceof Date?t.getTime():uG(t)?t.map(AG):t&&"function"==typeof t.toJSON?t.toJSON():t}var NG=Object.freeze({__proto__:null,default:function(t,e){var n=MG(t,e=Object.assign({compare:CG,comparable:AG},e));return function(t,e,r){return yG(n,t,e,r)}},compare:CG,comparable:AG}),IG=vt(NG);const $G=VW,{_:RG}=KW,{sorter:OG,select:PG,AdapterService:LG}=tG,DG=IG.default,FG=(t,...e)=>PG(...e)(JSON.parse(JSON.stringify(t)));class zG extends LG{constructor(t={}){super(RG.extend({id:"id",matcher:DG,sorter:OG},t)),this._uId=t.startId||0,this.store=t.store||{}}async getEntries(t={}){const{query:e}=this.filterQuery(t);return this._find(Object.assign({},t,{paginate:!1,query:e}))}async _find(t={}){const{query:e,filters:n,paginate:r}=this.filterQuery(t);let i=RG.values(this.store).filter(this.options.matcher(e));const s=i.length;void 0!==n.$sort&&i.sort(this.options.sorter(n.$sort)),void 0!==n.$skip&&(i=i.slice(n.$skip)),void 0!==n.$limit&&(i=i.slice(0,n.$limit));const o={total:s,limit:n.$limit,skip:n.$skip||0,data:i.map((e=>FG(e,t)))};return r&&r.default?o:o.data}async _get(t,e={}){if(t in this.store){const{query:n}=this.filterQuery(e),r=this.store[t];if(this.options.matcher(n)(r))return FG(r,e,this.id)}throw new $G.NotFound(`No record found for id '${t}'`)}async _create(t,e={}){if(Array.isArray(t))return Promise.all(t.map((t=>this._create(t,e))));const n=t[this.id]||this._uId++,r=RG.extend({},t,{[this.id]:n}),i=this.store[n]=r;return FG(i,e,this.id)}async _update(t,e,n={}){const r=(await this._get(t))[this.id];return t=r==t?r:t,this.store[t]=RG.extend({},e,{[this.id]:t}),this._get(t,n)}async _patch(t,e,n={}){const r=t=>{const r=t[this.id];return this.store[r]=RG.extend(this.store[r],RG.omit(e,this.id)),FG(this.store[r],n,this.id)};if(null===t){return(await this.getEntries(n)).map(r)}return r(await this._get(t,n))}async _remove(t,e={}){if(null===t){const t=await this.getEntries(e);return Promise.all(t.map((t=>this._remove(t[this.id],e))))}const n=await this._get(t,e);return delete this.store[t],n}}QH.exports=t=>new zG(t),QH.exports.Service=zG;var BG={exports:{}};const{Service:UG}=QH.exports,VG=[];class jG extends UG{constructor(t={}){if(super(t),this._storageKey=t.name||"feathers",this._storage=t.storage||"undefined"!=typeof window&&window.localStorage,this._throttle=t.throttle||200,this._reuseKeys=t.reuseKeys||!1,this.store=null,!this._storage)throw new Error("The `storage` option needs to be provided");if(-1===VG.indexOf(this._storageKey))VG.push(this._storageKey);else if(!this._reuseKeys)throw new Error(`The storage name '${this._storageKey}' is already in use by another instance.`);this.ready()}ready(){return this.store?Promise.resolve(this.store):Promise.resolve(this._storage.getItem(this._storageKey)).then((t=>JSON.parse(t||"{}"))).then((t=>{const e=Object.keys(t),n=t[e[e.length-1]];return this._uId=e.length&&void 0!==n[this.id]?n[this.id]+1:this._uId,this.store=t}))}flush(t){return this._timeout||(this._timeout=setTimeout((()=>{this._storage.setItem(this._storageKey,JSON.stringify(this.store)),delete this._timeout}),this._throttle)),t}execute(t,...e){return this.ready().then((()=>super[t](...e)))}find(...t){return this.execute("find",...t)}get(...t){return this.execute("get",...t)}create(...t){return this.execute("create",...t).then((t=>this.flush(t)))}patch(...t){return this.execute("patch",...t).then((t=>this.flush(t)))}update(...t){return this.execute("update",...t).then((t=>this.flush(t)))}remove(...t){return this.execute("remove",...t).then((t=>this.flush(t)))}}BG.exports=function(t){return new jG(t)},BG.exports.Service=jG;let WG=~~(16777215*Math.random());const HG=parseInt((16777215*Math.random()).toString(),10);function GG(){const t=~~(Date.now()/1e3),e=Math.floor(1e5*Math.random());WG=(WG+1)%16777215;const n=WG,r=new Uint8Array(12);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[6]=255&HG,r[5]=HG>>8&255,r[4]=HG>>16&255,r[8]=255&e,r[7]=e>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r.reduce(((t,e)=>t+`0${e.toString(16)}`.slice(-2)),"")}const qG=document.createElement("canvas"),XG=qG.getContext("2d"),YG=new Image;function KG(t){return new Promise(((e,n)=>{t?(YG.addEventListener("load",(()=>{qG.width=YG.width,qG.height=YG.height,null==XG||XG.drawImage(YG,0,0,qG.width,qG.height),e(null==XG?void 0:XG.getImageData(0,0,qG.width,qG.height))}),!1),YG.src=t):n()}))}function ZG(t){const{data:e,service:n}=t;return t.data={[n.id]:GG(),...e},t}function JG(t){const{result:e,params:n}=t;if(e){if(e._id)e.id=e._id,delete e._id;else if(e.total&&Array.isArray(e.data))for(const[t,n]of e.data.entries())n._id&&(e.data[t].id=e.data[t]._id,delete e.data[t]._id)}else n&&n.query&&(n.query.id&&(t.params.query._id=t.params.query.id,delete t.params.query.id),n.query.$select&&n.query.$select.includes("id")&&!n.query.$select.includes("_id")&&t.params.query.$select.push("_id"));return t}function QG(t){return t.data||(t.data={}),t.data.createdAt=new Date,t.data.updatedAt=t.data.createdAt,t}function tq(t){return t.data&&t.data.createdAt?(t.data.updatedAt=new Date,t):t}function eq(t,e){return n=>(n.params=n.params||{},n.params.query=n.params.query||{},n.params.query[t]=e,n)}const nq=document.createElement("canvas"),rq=nq.getContext("2d");async function iq(t){const{data:e}=t;for(const[n,r]of Object.entries(e))if(r instanceof ImageData){const e=r.width,i=r.height;nq.width=e,nq.height=i,rq.putImageData(r,0,0),t.data[n]=nq.toDataURL("image/jpeg")}return t}async function sq(t){if(!t.result)return t;const{result:e}=t,n=t=>t&&"string"==typeof t&&"data:image/jpeg;base64"===t.slice(0,22);if(e._id)for(const[t,r]of Object.entries(e).filter((([t])=>"thumbnail"!==t)))n(r)&&(e[t]=await KG(r));else if(e.total&&Array.isArray(e.data))for(const[t,r]of e.data.entries())for(const[i,s]of Object.entries(r).filter((([t])=>"thumbnail"!==t)))n(s)&&(e.data[t][i]=await KG(s));return t}async function oq(t){var e,n;if(!(null===(n=null===(e=t.params)||void 0===e?void 0:e.query)||void 0===n?void 0:n.$distinct)||"before"!==t.type||"find"!==t.method)return t;const{$distinct:r,...i}=t.params.query;i.$select=[r],i.$skip=0;let s=1;const o=new Set;for(;i.$skip<s;){const e=await t.service.find({query:i});for(const t of e.data)o.add(t[r]);i.$skip+=e.limit,s=e.total}return t.result=Array.from(o),t}function aq(t){let e;return{c(){e=UT("Register")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function lq(t){let e;return{c(){e=UT("Log In")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function cq(t){let e,n,r,i,s,o,a,l,c;return{c(){e=zT("div"),n=zT("span"),n.innerHTML='<i class="fas fa-bell"></i>',r=VT(),i=zT("span"),s=zT("b"),s.textContent="Login Error",o=VT(),a=UT(t[1]),l=VT(),c=zT("button"),c.innerHTML="<span></span>",GT(n,"class","text-xl inline-block mr-5 align-middle"),GT(s,"class","capitalize"),GT(i,"class","inline-block align-middle mr-8"),GT(c,"class","absolute bg-transparent text-2xl font-semibold leading-none right-0 top-0 mt-4 mr-6 outline-none focus:outline-none"),GT(e,"class","text-white px-6 py-4 border-0 rounded relative mb-4 bg-red-500")},m(t,u){LT(t,e,u),RT(e,n),RT(e,r),RT(e,i),RT(i,s),RT(i,o),RT(i,a),RT(e,l),RT(e,c)},p(t,e){2&e&&XT(a,t[1])},d(t){t&&DT(e)}}}function uq(t){let e;return{c(){e=UT("Register")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function hq(t){let e;return{c(){e=UT("Log In")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function dq(t){let e,n,r,i;return{c(){e=UT("Already have an account?\n        "),n=zT("button"),n.textContent="Log In",GT(n,"class","text-blue-500")},m(s,o){LT(s,e,o),LT(s,n,o),r||(i=WT(n,"click",t[2]),r=!0)},p:uT,d(t){t&&DT(e),t&&DT(n),r=!1,i()}}}function pq(t){let e,n,r,i;return{c(){e=UT("Don't have an account?\n        "),n=zT("button"),n.textContent="Register Here",GT(n,"class","text-blue-500")},m(s,o){LT(s,e,o),LT(s,n,o),r||(i=WT(n,"click",t[2]),r=!0)},p:uT,d(t){t&&DT(e),t&&DT(n),r=!1,i()}}}function fq(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b;function v(t,e){return"login"===t[0]?lq:aq}let x=v(t),w=x(t),S=t[1]&&cq(t);function _(t,e){return"login"===t[0]?hq:uq}let k=_(t),T=k(t);function E(t,e){return"login"===t[0]?pq:dq}let M=E(t),C=M(t);return{c(){e=zT("div"),n=zT("div"),r=zT("h2"),w.c(),i=VT(),s=zT("p"),s.textContent="This Marcelle application requires authentication.",o=VT(),S&&S.c(),a=VT(),l=zT("form"),c=zT("div"),c.innerHTML='<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Email</label> \n        <input type="email" name="email" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Email" style="transition: all 0.15s ease 0s;"/>',u=VT(),h=zT("div"),h.innerHTML='<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Password</label> \n        <input type="password" name="password" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Password" style="transition: all 0.15s ease 0s;"/>',d=VT(),p=zT("div"),f=zT("button"),T.c(),m=VT(),g=zT("p"),C.c(),GT(r,"class","text-xl"),GT(s,"class","text-gray-600"),GT(n,"class","p-4 text-center"),GT(c,"class","relative w-full mb-3"),GT(h,"class","relative w-full mb-3"),GT(f,"class","bg-gray-900 text-white active:bg-gray-700 text-sm font-bold uppercase px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 w-full"),GT(f,"type","submit"),KT(f,"transition","all 0.15s ease 0s"),GT(p,"class","text-center mt-6"),GT(g,"class","my-4"),GT(e,"class","marcelle p-12")},m(v,x){LT(v,e,x),RT(e,n),RT(n,r),w.m(r,null),RT(n,i),RT(n,s),RT(e,o),S&&S.m(e,null),RT(e,a),RT(e,l),RT(l,c),RT(l,u),RT(l,h),RT(l,d),RT(l,p),RT(p,f),T.m(f,null),RT(e,m),RT(e,g),C.m(g,null),y||(b=WT(l,"submit",HT(t[7])),y=!0)},p(t,n){x!==(x=v(t))&&(w.d(1),w=x(t),w&&(w.c(),w.m(r,null))),t[1]?S?S.p(t,n):(S=cq(t),S.c(),S.m(e,a)):S&&(S.d(1),S=null),k!==(k=_(t))&&(T.d(1),T=k(t),T&&(T.c(),T.m(f,null))),M===(M=E(t))&&C?C.p(t,n):(C.d(1),C=M(t),C&&(C.c(),C.m(g,null)))},d(t){t&&DT(e),w.d(),S&&S.d(),T.d(),C.d(),y=!1,b()}}}function mq(t){let e,n;return e=new lM({props:{$$slots:{default:[fq]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};515&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function gq(t,e,n){const r=fE();let i,{dataStore:s}=e,{mode:o="login"}=e;function a(t){r("terminate",t)}async function l(t){const e=new FormData(t.target);try{a(await s.login(e.get("email"),e.get("password")))}catch(t){n(1,i=t)}}async function c(t){const e=new FormData(t.target);try{a(await s.signup(e.get("email"),e.get("password")))}catch(t){a(null)}}return t.$$set=t=>{"dataStore"in t&&n(5,s=t.dataStore),"mode"in t&&n(0,o=t.mode)},[o,i,function(){n(0,o="login"===o?"register":"login")},l,c,s,a,t=>"login"===o?l(t):c(t)]}class yq extends QE{constructor(t){super(),JE(this,t,gq,mq,gT,{dataStore:5,mode:0,terminate:6})}get terminate(){return this.$$.ctx[6]}}var bq,vq,xq,wq,Sq,_q,kq={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],g="[object Arguments]",y="[object Array]",b="[object Boolean]",v="[object Date]",x="[object Error]",w="[object Function]",S="[object GeneratorFunction]",_="[object Map]",k="[object Number]",T="[object Object]",E="[object Promise]",M="[object RegExp]",C="[object Set]",A="[object String]",N="[object Symbol]",I="[object WeakMap]",$="[object ArrayBuffer]",R="[object DataView]",O="[object Float32Array]",P="[object Float64Array]",L="[object Int8Array]",D="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",V="[object Uint32Array]",j=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,X=RegExp(G.source),Y=RegExp(q.source),K=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/[\\^$.*+?()[\]{}|]/g,rt=RegExp(nt.source),it=/^\s+/,st=/\s/,ot=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,at=/\{\n\/\* \[wrapped with (.+)\] \*/,lt=/,? & /,ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ut=/[()=,{}\[\]\/\s]/,ht=/\\(\\)?/g,dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,gt=/^\[object .+?Constructor\]$/,bt=/^0o[0-7]+$/i,vt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,_t="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",kt="\\u2700-\\u27bf",Tt="a-z\\xdf-\\xf6\\xf8-\\xff",Et="A-Z\\xc0-\\xd6\\xd8-\\xde",Mt="\\ufe0e\\ufe0f",Ct="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",At="[']",Nt="[\\ud800-\\udfff]",It="["+Ct+"]",$t="["+_t+"]",Rt="\\d+",Ot="[\\u2700-\\u27bf]",Pt="["+Tt+"]",Lt="[^\\ud800-\\udfff"+Ct+Rt+kt+Tt+Et+"]",Dt="\\ud83c[\\udffb-\\udfff]",Ft="[^\\ud800-\\udfff]",zt="(?:\\ud83c[\\udde6-\\uddff]){2}",Bt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ut="["+Et+"]",Vt="(?:"+Pt+"|"+Lt+")",jt="(?:"+Ut+"|"+Lt+")",Wt="(?:['](?:d|ll|m|re|s|t|ve))?",Ht="(?:['](?:D|LL|M|RE|S|T|VE))?",Gt="(?:"+$t+"|"+Dt+")"+"?",qt="[\\ufe0e\\ufe0f]?",Xt=qt+Gt+("(?:\\u200d(?:"+[Ft,zt,Bt].join("|")+")"+qt+Gt+")*"),Yt="(?:"+[Ot,zt,Bt].join("|")+")"+Xt,Kt="(?:"+[Ft+$t+"?",$t,zt,Bt,Nt].join("|")+")",Zt=RegExp(At,"g"),Jt=RegExp($t,"g"),Qt=RegExp(Dt+"(?="+Dt+")|"+Kt+Xt,"g"),te=RegExp([Ut+"?"+Pt+"+"+Wt+"(?="+[It,Ut,"$"].join("|")+")",jt+"+"+Ht+"(?="+[It,Ut+Vt,"$"].join("|")+")",Ut+"?"+Vt+"+"+Wt,Ut+"+"+Ht,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rt,Yt].join("|"),"g"),ee=RegExp("[\\u200d\\ud800-\\udfff"+_t+Mt+"]"),ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,re=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ie=-1,se={};se[O]=se[P]=se[L]=se[D]=se[F]=se[z]=se[B]=se[U]=se[V]=!0,se[g]=se[y]=se[$]=se[b]=se[R]=se[v]=se[x]=se[w]=se[_]=se[k]=se[T]=se[M]=se[C]=se[A]=se[I]=!1;var oe={};oe[g]=oe[y]=oe[$]=oe[R]=oe[b]=oe[v]=oe[O]=oe[P]=oe[L]=oe[D]=oe[F]=oe[_]=oe[k]=oe[T]=oe[M]=oe[C]=oe[A]=oe[N]=oe[z]=oe[B]=oe[U]=oe[V]=!0,oe[x]=oe[w]=oe[I]=!1;var ae={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},le=parseFloat,ce=parseInt,ue="object"==typeof yt&&yt&&yt.Object===Object&&yt,he="object"==typeof self&&self&&self.Object===Object&&self,de=ue||he||Function("return this")(),pe=e&&!e.nodeType&&e,fe=pe&&t&&!t.nodeType&&t,me=fe&&fe.exports===pe,ge=me&&ue.process,ye=function(){try{var t=fe&&fe.require&&fe.require("util").types;return t||ge&&ge.binding&&ge.binding("util")}catch(t){}}(),be=ye&&ye.isArrayBuffer,ve=ye&&ye.isDate,xe=ye&&ye.isMap,we=ye&&ye.isRegExp,Se=ye&&ye.isSet,_e=ye&&ye.isTypedArray;function ke(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Te(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Ee(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Me(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ce(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ae(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&Be(t,e,0)>-1}function Ie(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function $e(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function Re(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Oe(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Pe(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Le(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var De=We("length");function Fe(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function ze(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function Be(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):ze(t,Ve,n)}function Ue(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ve(t){return t!=t}function je(t,e){var n=null==t?0:t.length;return n?qe(t,e)/n:p}function We(t){return function(e){return null==e?n:e[t]}}function He(t){return function(e){return null==t?n:t[e]}}function Ge(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function qe(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Xe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ye(t){return t?t.slice(0,fn(t)+1).replace(it,""):t}function Ke(t){return function(e){return t(e)}}function Ze(t,e){return $e(e,(function(e){return t[e]}))}function Je(t,e){return t.has(e)}function Qe(t,e){for(var n=-1,r=t.length;++n<r&&Be(e,t[n],0)>-1;);return n}function tn(t,e){for(var n=t.length;n--&&Be(e,t[n],0)>-1;);return n}function en(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}var nn=He({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),rn=He({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function sn(t){return"\\"+ae[t]}function on(t){return ee.test(t)}function an(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function ln(t,e){return function(n){return t(e(n))}}function cn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==s||(t[n]=s,o[i++]=n)}return o}function un(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function hn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function dn(t){return on(t)?function(t){var e=Qt.lastIndex=0;for(;Qt.test(t);)++e;return e}(t):De(t)}function pn(t){return on(t)?function(t){return t.match(Qt)||[]}(t):function(t){return t.split("")}(t)}function fn(t){for(var e=t.length;e--&&st.test(t.charAt(e)););return e}var mn=He({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var gn=function t(e){var st=(e=null==e?de:gn.defaults(de.Object(),e,gn.pick(de,re))).Array,yt=e.Date,_t=e.Error,kt=e.Function,Tt=e.Math,Et=e.Object,Mt=e.RegExp,Ct=e.String,At=e.TypeError,Nt=st.prototype,It=kt.prototype,$t=Et.prototype,Rt=e["__core-js_shared__"],Ot=It.toString,Pt=$t.hasOwnProperty,Lt=0,Dt=function(){var t=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ft=$t.toString,zt=Ot.call(Et),Bt=de._,Ut=Mt("^"+Ot.call(Pt).replace(nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=me?e.Buffer:n,jt=e.Symbol,Wt=e.Uint8Array,Ht=Vt?Vt.allocUnsafe:n,Gt=ln(Et.getPrototypeOf,Et),qt=Et.create,Xt=$t.propertyIsEnumerable,Yt=Nt.splice,Kt=jt?jt.isConcatSpreadable:n,Qt=jt?jt.iterator:n,ee=jt?jt.toStringTag:n,ae=function(){try{var t=ds(Et,"defineProperty");return t({},"",{}),t}catch(t){}}(),ue=e.clearTimeout!==de.clearTimeout&&e.clearTimeout,he=yt&&yt.now!==de.Date.now&&yt.now,pe=e.setTimeout!==de.setTimeout&&e.setTimeout,fe=Tt.ceil,ge=Tt.floor,ye=Et.getOwnPropertySymbols,De=Vt?Vt.isBuffer:n,He=e.isFinite,yn=Nt.join,bn=ln(Et.keys,Et),vn=Tt.max,xn=Tt.min,wn=yt.now,Sn=e.parseInt,_n=Tt.random,kn=Nt.reverse,Tn=ds(e,"DataView"),En=ds(e,"Map"),Mn=ds(e,"Promise"),Cn=ds(e,"Set"),An=ds(e,"WeakMap"),Nn=ds(Et,"create"),In=An&&new An,$n={},Rn=zs(Tn),On=zs(En),Pn=zs(Mn),Ln=zs(Cn),Dn=zs(An),Fn=jt?jt.prototype:n,zn=Fn?Fn.valueOf:n,Bn=Fn?Fn.toString:n;function Un(t){if(ra(t)&&!Go(t)&&!(t instanceof Hn)){if(t instanceof Wn)return t;if(Pt.call(t,"__wrapped__"))return Bs(t)}return new Wn(t)}var Vn=function(){function t(){}return function(e){if(!na(e))return{};if(qt)return qt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Yn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Kn(t){var e=this.__data__=new qn(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Ho(t),i=!n&&!r&&Ko(t),s=!n&&!r&&!i&&ha(t),o=n||r||i||s,a=o?Xe(t.length,Ct):[],l=a.length;for(var c in t)!e&&!Pt.call(t,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||vs(c,l))||a.push(c);return a}function Jn(t){var e=t.length;return e?t[Yr(0,e-1)]:n}function Qn(t,e){return Ls(Ni(t),lr(e,0,t.length))}function tr(t){return Ls(Ni(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];Pt.call(t,e)&&Vo(i,r)&&(r!==n||e in t)||or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ii(e,Ra(e),t)}function or(t,e,n){"__proto__"==e&&ae?ae(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=st(i),o=null==t;++r<i;)s[r]=o?n:Ca(t,e[r]);return s}function lr(t,e,r){return t==t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!na(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&Pt.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!l)return Ni(t,a)}else{var d=ms(t),p=d==w||d==S;if(Ko(t))return ki(t,l);if(d==T||d==g||p&&!s){if(a=c||p?{}:ys(t),!l)return c?function(t,e){return Ii(t,fs(t),e)}(t,function(t,e){return t&&Ii(e,Oa(e),t)}(a,t)):function(t,e){return Ii(t,ps(t),e)}(t,sr(a,t))}else{if(!oe[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case $:return Ti(t);case b:case v:return new r(+t);case R:return function(t,e){var n=e?Ti(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case O:case P:case L:case D:case F:case z:case B:case U:case V:return Ei(t,n);case _:return new r;case k:case A:return new r(t);case M:return function(t){var e=new t.constructor(t.source,pt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case C:return new r;case N:return i=t,zn?Et(zn.call(i)):{}}var i}(t,d,l)}}o||(o=new Kn);var f=o.get(t);if(f)return f;o.set(t,a),la(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ia(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Oa:Ra)(t);return Ee(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Et(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new At(r);return $s((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=$e(e,Ke(n))),r?(s=Ie,o=!1):e.length>=200&&(s=Je,o=!1,e=new Yn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h==h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Un.templateSettings={escape:K,evaluate:Z,interpolate:J,variable:"",imports:{_:Un}},Un.prototype=jn.prototype,Un.prototype.constructor=Un,Wn.prototype=Vn(jn.prototype),Wn.prototype.constructor=Wn,Hn.prototype=Vn(jn.prototype),Hn.prototype.constructor=Hn,Gn.prototype.clear=function(){this.__data__=Nn?Nn(null):{},this.size=0},Gn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Gn.prototype.get=function(t){var e=this.__data__;if(Nn){var r=e[t];return r===i?n:r}return Pt.call(e,t)?e[t]:n},Gn.prototype.has=function(t){var e=this.__data__;return Nn?e[t]!==n:Pt.call(e,t)},Gn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Nn&&e===n?i:e,this},qn.prototype.clear=function(){this.__data__=[],this.size=0},qn.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Yt.call(e,n,1),--this.size,!0)},qn.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},qn.prototype.has=function(t){return rr(this.__data__,t)>-1},qn.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new Gn,map:new(En||qn),string:new Gn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Yn.prototype.add=Yn.prototype.push=function(t){return this.__data__.set(t,i),this},Yn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.clear=function(){this.__data__=new qn,this.size=0},Kn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Kn.prototype.get=function(t){return this.__data__.get(t)},Kn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof qn){var r=n.__data__;if(!En||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(wr),fr=Oi(Sr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a==a&&!ua(a):r(a,l)))var l=a,c=o}return c}function yr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function br(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=bs),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?br(a,e-1,n,r,i):Re(i,a):r||(i[i.length]=a)}return i}var vr=Pi(),xr=Pi(!0);function wr(t,e){return t&&vr(t,e,Ra)}function Sr(t,e){return t&&xr(t,e,Ra)}function _r(t,e){return Ae(e,(function(e){return Qo(t[e])}))}function kr(t,e){for(var r=0,i=(e=xi(e,t)).length;null!=t&&r<i;)t=t[Fs(e[r++])];return r&&r==i?t:n}function Tr(t,e,n){var r=e(t);return Go(t)?r:Re(r,n(t))}function Er(t){return null==t?t===n?"[object Undefined]":"[object Null]":ee&&ee in Et(t)?function(t){var e=Pt.call(t,ee),r=t[ee];try{t[ee]=n;var i=!0}catch(t){}var s=Ft.call(t);i&&(e?t[ee]=r:delete t[ee]);return s}(t):function(t){return Ft.call(t)}(t)}function Mr(t,e){return t>e}function Cr(t,e){return null!=t&&Pt.call(t,e)}function Ar(t,e){return null!=t&&e in Et(t)}function Nr(t,e,r){for(var i=r?Ie:Ne,s=t[0].length,o=t.length,a=o,l=st(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=$e(h,Ke(e))),c=xn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Yn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?Je(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?Je(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Ir(t,e,r){var i=null==(t=Cs(t,e=xi(e,t)))?t:t[Fs(Zs(e))];return null==i?n:ke(i,t,r)}function $r(t){return ra(t)&&Er(t)==g}function Rr(t,e,r,i,s){return t===e||(null==t||null==e||!ra(t)&&!ra(e)?t!=t&&e!=e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?y:ms(t),u=l?y:ms(e),h=(c=c==g?T:c)==T,d=(u=u==g?T:u)==T,p=c==u;if(p&&Ko(t)){if(!Ko(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Kn),a||ha(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case R:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $:return!(t.byteLength!=e.byteLength||!s(new Wt(t),new Wt(e)));case b:case v:case k:return Vo(+t,+e);case x:return t.name==e.name&&t.message==e.message;case M:case A:return t==e+"";case _:var a=an;case C:var l=1&r;if(a||(a=un),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case N:if(zn)return zn.call(t)==zn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&Pt.call(t,"__wrapped__"),m=d&&Pt.call(e,"__wrapped__");if(f||m){var w=f?t.value():t,S=m?e.value():e;return o||(o=new Kn),s(w,S,r,i,o)}}if(!p)return!1;return o||(o=new Kn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e).length;if(c!=u&&!a)return!1;var h=c;for(;h--;){var d=l[h];if(!(a?d in e:Pt.call(e,d)))return!1}var p=o.get(t),f=o.get(e);if(p&&f)return p==e&&f==t;var m=!0;o.set(t,e),o.set(e,t);var g=a;for(;++h<c;){var y=t[d=l[h]],b=e[d];if(i)var v=a?i(b,y,d,e,t,o):i(y,b,d,t,e,o);if(!(v===n?y===b||s(y,b,r,i,o):v)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,w=e.constructor;x==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w||(m=!1)}return o.delete(t),o.delete(e),m}(t,e,r,i,s,o)}(t,e,r,i,Rr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Et(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Kn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Rr(h,u,3,i,d):p))return!1}}return!0}function Pr(t){return!(!na(t)||function(t){return!!Dt&&Dt in t}(t))&&(Qo(t)?Ut:gt).test(zs(t))}function Lr(t){return"function"==typeof t?t:null==t?sl:"object"==typeof t?Go(t)?Vr(t[0],t[1]):Ur(t):fl(t)}function Dr(t){if(!ks(t))return bn(t);var e=[];for(var n in Et(t))Pt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Fr(t){if(!na(t))return function(t){var e=[];if(null!=t)for(var n in Et(t))e.push(n);return e}(t);var e=ks(t),n=[];for(var r in t)("constructor"!=r||!e&&Pt.call(t,r))&&n.push(r);return n}function zr(t,e){return t<e}function Br(t,e){var n=-1,r=Xo(t)?st(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Ur(t){var e=hs(t);return 1==e.length&&e[0][2]?Es(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Vr(t,e){return ws(t)&&Ts(e)?Es(Fs(t),e):function(r){var i=Ca(r,t);return i===n&&i===e?Aa(r,t):Rr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&vr(e,(function(o,a){if(s||(s=new Kn),na(o))!function(t,e,r,i,s,o,a){var l=Ns(t,r),c=Ns(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Ko(c),m=!p&&!f&&ha(c);h=c,p||f||m?Go(l)?h=l:Yo(l)?h=Ni(l):f?(d=!1,h=ki(c,!0)):m?(d=!1,h=Ei(c,!0)):h=[]:oa(c)||Ho(c)?(h=l,Ho(l)?h=va(l):na(l)&&!Qo(l)||(h=ys(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c));er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ns(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Oa)}function Wr(t,e){var r=t.length;if(r)return vs(e+=e<0?r:0,r)?t[e]:n}function Hr(t,e,n){e=e.length?$e(e,(function(t){return Go(t)?function(e){return kr(e,1===t.length?t[0]:t)}:t})):[sl];var r=-1;e=$e(e,Ke(cs()));var i=Br(t,(function(t,n,i){var s=$e(e,(function(e){return e(t)}));return{criteria:s,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;for(;++r<o;){var l=Mi(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Gr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=kr(t,o);n(a,o)&&ti(s,xi(o,t),a)}return s}function qr(t,e,n,r){var i=r?Ue:Be,s=-1,o=e.length,a=t;for(t===e&&(e=Ni(e)),n&&(a=$e(t,Ke(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Yt.call(a,l,1),Yt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;vs(i)?Yt.call(t,i,1):di(t,i)}}return t}function Yr(t,e){return t+ge(_n()*(e-t+1))}function Kr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Rs(Ms(t,e,sl),t+"")}function Jr(t){return Jn(Va(t))}function Qr(t,e){var n=Va(t);return Ls(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!na(t))return t;for(var s=-1,o=(e=xi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=Fs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=na(h)?h:vs(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=In?function(t,e){return In.set(t,e),t}:sl,ni=ae?function(t,e){return ae(t,"toString",{configurable:!0,enumerable:!1,value:nl(e),writable:!0})}:sl;function ri(t){return Ls(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=st(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ua(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,sl,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!=e,l=null===e,c=ua(e),u=e===n;s<o;){var h=ge((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,m=d==d,g=ua(d);if(a)var y=i||m;else y=u?m&&(i||p):l?m&&p&&(i||!f):c?m&&p&&!f&&(i||!g):!f&&!g&&(i?d<=e:d<e);y?s=h+1:o=h}return xn(o,4294967294)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ua(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return $e(t,ui)+"";if(ua(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Ie;else if(s>=200){var c=e?null:Ki(t);if(c)return un(c);o=!1,i=Je,l=new Yn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=xi(e,t)))||delete t[Fs(Zs(e))]}function pi(t,e,n,r){return ti(t,e,n(kr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Hn&&(n=n.value()),Oe(e,(function(t,e){return e.func.apply(e.thisArg,Re([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=st(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(br(s,1),e,n)}function yi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function bi(t){return Yo(t)?t:[]}function vi(t){return"function"==typeof t?t:sl}function xi(t,e){return Go(t)?t:ws(t,e)?[t]:Ds(xa(t))}var wi=Zr;function Si(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var _i=ue||function(t){return de.clearTimeout(t)};function ki(t,e){if(e)return t.slice();var n=t.length,r=Ht?Ht(n):new t.constructor(n);return t.copy(r),r}function Ti(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function Ei(t,e){var n=e?Ti(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Mi(t,e){if(t!==e){var r=t!==n,i=null===t,s=t==t,o=ua(t),a=e!==n,l=null===e,c=e==e,u=ua(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=vn(s-o,0),u=st(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Ai(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=vn(s-a,0),h=st(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ni(t,e){var n=-1,r=t.length;for(e||(e=st(r));++n<r;)e[n]=t[n];return e}function Ii(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function $i(t,e){return function(n,r){var i=Go(n)?Te:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ri(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&xs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Et(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!Xo(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Et(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Pi(t){return function(e,n,r){for(var i=-1,s=Et(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Li(t){return function(e){var r=on(e=xa(e))?pn(e):n,i=r?r[0]:e.charAt(0),s=r?Si(r,1).join(""):e.slice(1);return i[t]()+s}}function Di(t){return function(e){return Oe(Qa(Ha(e).replace(Zt,"")),t,"")}}function Fi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Vn(t.prototype),r=t.apply(n,e);return na(r)?r:n}}function zi(t){return function(e,r,i){var s=Et(e);if(!Xo(e)){var o=cs(r,3);e=Ra(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new At(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&Ss(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&Ss(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Ui(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,y=f?n:Fi(t);return function n(){for(var c=arguments.length,b=st(c),v=c;v--;)b[v]=arguments[v];if(m)var x=ls(n),w=en(b,x);if(i&&(b=Ci(b,i,s,m)),o&&(b=Ai(b,o,a,m)),c-=w,m&&c<h){var S=cn(b,x);return Xi(t,e,Ui,n.placeholder,r,b,S,l,u,h-c)}var _=p?r:this,k=f?_[t]:t;return c=b.length,l?b=As(b,l):g&&c>1&&b.reverse(),d&&u<c&&(b.length=u),this&&this!==de&&this instanceof n&&(k=y||Fi(k)),k.apply(_,b)}}function Vi(t,e){return function(n,r){return function(t,e,n,r){return wr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=$e(e,Ke(cs())),Zr((function(n){var r=this;return t(e,(function(t){return ke(t,r,n)}))}))}))}function Hi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Kr(e,t):e;var i=Kr(e,fe(t/dn(e)));return on(e)?Si(pn(i),0,t).join(""):i.slice(0,t)}function Gi(t){return function(e,r,i){return i&&"number"!=typeof i&&xs(e,r,i)&&(r=i=n),e=ma(e),r===n?(r=e,e=0):r=ma(r),function(t,e,n,r){for(var i=-1,s=vn(fe((e-t)/(n||1)),0),o=st(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:ma(i),t)}}function qi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=ba(e),n=ba(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return Ss(t)&&Is(m,f),m.placeholder=i,Os(m,t,e)}function Yi(t){var e=Tt[t];return function(t,n){if(t=ba(t),(n=null==n?0:xn(ga(n),292))&&He(t)){var r=(xa(t)+"e").split("e");return+((r=(xa(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Ki=Cn&&1/un(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:ul;function Zi(t){return function(e){var n=ms(e);return n==_?an(e):n==C?hn(e):function(t,e){return $e(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ji(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new At(r);var y=h?h.length:0;if(y||(e&=-97,h=d=n),f=f===n?f:vn(ga(f),0),m=m===n?m:ga(m),y-=d?d.length:0,e&l){var b=h,v=d;h=d=n}var x=g?n:os(t),w=[t,e,i,h,d,b,v,p,f,m];if(x&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?cn(t[3],s):e[4]}(l=e[5])&&(h=t[5],t[5]=h?Ai(h,l,e[6]):l,t[6]=h?cn(t[5],s):e[6]);(l=e[7])&&(t[7]=l);r&c&&(t[8]=null==t[8]?e[8]:xn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(w,x),t=w[0],e=w[1],i=w[2],h=w[3],d=w[4],!(m=w[9]=w[9]===n?g?0:t.length:vn(w[9]-y,0))&&24&e&&(e&=-25),e&&1!=e)S=8==e||e==o?function(t,e,r){var i=Fi(t);return function s(){for(var o=arguments.length,a=st(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:cn(a,c);return(o-=u.length)<r?Xi(t,e,Ui,s.placeholder,n,a,u,n,n,r-o):ke(this&&this!==de&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Ui.apply(n,w):function(t,e,n,r){var i=1&e,s=Fi(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=st(c+a),h=this&&this!==de&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return ke(h,i?n:this,u)}}(t,e,i,h);else var S=function(t,e,n){var r=1&e,i=Fi(t);return function e(){return(this&&this!==de&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Os((x?ei:Is)(S,w),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,$t[r])&&!Pt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return na(t)&&na(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return oa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Yn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var y=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(y!==n){if(y)continue;p=!1;break}if(f){if(!Le(e,(function(t,e){if(!Je(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Rs(Ms(t,n,Gs),t+"")}function is(t){return Tr(t,Ra,ps)}function ss(t){return Tr(t,Oa,fs)}var os=In?function(t){return In.get(t)}:ul;function as(t){for(var e=t.name+"",n=$n[e],r=Pt.call($n,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(Pt.call(Un,"placeholder")?Un:t).placeholder}function cs(){var t=Un.iteratee||ol;return t=t===ol?Lr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function hs(t){for(var e=Ra(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ts(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return Pr(r)?r:n}var ps=ye?function(t){return null==t?[]:(t=Et(t),Ae(ye(t),(function(e){return Xt.call(t,e)})))}:yl,fs=ye?function(t){for(var e=[];t;)Re(e,ps(t)),t=Gt(t);return e}:yl,ms=Er;function gs(t,e,n){for(var r=-1,i=(e=xi(e,t)).length,s=!1;++r<i;){var o=Fs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ea(i)&&vs(o,i)&&(Go(t)||Ho(t))}function ys(t){return"function"!=typeof t.constructor||ks(t)?{}:Vn(Gt(t))}function bs(t){return Go(t)||Ho(t)||!!(Kt&&t&&t[Kt])}function vs(t,e){var n=typeof t;return!!(e=null==e?d:e)&&("number"==n||"symbol"!=n&&vt.test(t))&&t>-1&&t%1==0&&t<e}function xs(t,e,n){if(!na(n))return!1;var r=typeof e;return!!("number"==r?Xo(n)&&vs(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function ws(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ua(t))||(tt.test(t)||!Q.test(t)||null!=e&&t in Et(e))}function Ss(t){var e=as(t),n=Un[e];if("function"!=typeof n||!(e in Hn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(Tn&&ms(new Tn(new ArrayBuffer(1)))!=R||En&&ms(new En)!=_||Mn&&ms(Mn.resolve())!=E||Cn&&ms(new Cn)!=C||An&&ms(new An)!=I)&&(ms=function(t){var e=Er(t),r=e==T?t.constructor:n,i=r?zs(r):"";if(i)switch(i){case Rn:return R;case On:return _;case Pn:return E;case Ln:return C;case Dn:return I}return e});var _s=Rt?Qo:bl;function ks(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$t)}function Ts(t){return t==t&&!na(t)}function Es(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Et(r)))}}function Ms(t,e,r){return e=vn(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=vn(n.length-e,0),o=st(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=st(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),ke(t,this,a)}}function Cs(t,e){return e.length<2?t:kr(t,ii(e,0,-1))}function As(t,e){for(var r=t.length,i=xn(e.length,r),s=Ni(t);i--;){var o=e[i];t[i]=vs(o,r)?s[o]:n}return t}function Ns(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Ps(ei),$s=pe||function(t,e){return de.setTimeout(t,e)},Rs=Ps(ni);function Os(t,e,n){var r=e+"";return Rs(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(ot,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Ee(m,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(at);return e?e[1].split(lt):[]}(r),n)))}function Ps(t){var e=0,r=0;return function(){var i=wn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function Ls(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Yr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=Lo(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,(function(t,n,r,i){e.push(r?i.replace(ht,"$1"):n||t)})),e}));function Fs(t){if("string"==typeof t||ua(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function zs(t){if(null!=t){try{return Ot.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Bs(t){if(t instanceof Hn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ni(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Us=Zr((function(t,e){return Yo(t)?dr(t,br(e,1,Yo,!0)):[]})),Vs=Zr((function(t,e){var r=Zs(e);return Yo(r)&&(r=n),Yo(t)?dr(t,br(e,1,Yo,!0),cs(r,2)):[]})),js=Zr((function(t,e){var r=Zs(e);return Yo(r)&&(r=n),Yo(t)?dr(t,br(e,1,Yo,!0),n,r):[]}));function Ws(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ga(n);return i<0&&(i=vn(r+i,0)),ze(t,cs(e,3),i)}function Hs(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ga(r),s=r<0?vn(i+s,0):xn(s,i-1)),ze(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?br(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var Xs=Zr((function(t){var e=$e(t,bi);return e.length&&e[0]===t[0]?Nr(e):[]})),Ys=Zr((function(t){var e=Zs(t),r=$e(t,bi);return e===Zs(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Nr(r,cs(e,2)):[]})),Ks=Zr((function(t){var e=Zs(t),r=$e(t,bi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Nr(r,n,e):[]}));function Zs(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Js=Zr(Qs);function Qs(t,e){return t&&t.length&&e&&e.length?qr(t,e):t}var to=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,$e(e,(function(t){return vs(t,n)?+t:t})).sort(Mi)),r}));function eo(t){return null==t?t:kn.call(t)}var no=Zr((function(t){return hi(br(t,1,Yo,!0))})),ro=Zr((function(t){var e=Zs(t);return Yo(e)&&(e=n),hi(br(t,1,Yo,!0),cs(e,2))})),io=Zr((function(t){var e=Zs(t);return e="function"==typeof e?e:n,hi(br(t,1,Yo,!0),n,e)}));function so(t){if(!t||!t.length)return[];var e=0;return t=Ae(t,(function(t){if(Yo(t))return e=vn(t.length,e),!0})),Xe(e,(function(e){return $e(t,We(e))}))}function oo(t,e){if(!t||!t.length)return[];var r=so(t);return null==e?r:$e(r,(function(t){return ke(e,n,t)}))}var ao=Zr((function(t,e){return Yo(t)?dr(t,e):[]})),lo=Zr((function(t){return gi(Ae(t,Yo))})),co=Zr((function(t){var e=Zs(t);return Yo(e)&&(e=n),gi(Ae(t,Yo),cs(e,2))})),uo=Zr((function(t){var e=Zs(t);return e="function"==typeof e?e:n,gi(Ae(t,Yo),n,e)})),ho=Zr(so);var po=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,oo(t,r)}));function fo(t){var e=Un(t);return e.__chain__=!0,e}function mo(t,e){return e(t)}var go=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Hn&&vs(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:mo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var yo=$i((function(t,e,n){Pt.call(t,n)?++t[n]:or(t,n,1)}));var bo=zi(Ws),vo=zi(Hs);function xo(t,e){return(Go(t)?Ee:pr)(t,cs(e,3))}function wo(t,e){return(Go(t)?Me:fr)(t,cs(e,3))}var So=$i((function(t,e,n){Pt.call(t,n)?t[n].push(e):or(t,n,[e])}));var _o=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=Xo(t)?st(t.length):[];return pr(t,(function(t){s[++r]=i?ke(e,t,n):Ir(t,e,n)})),s})),ko=$i((function(t,e,n){or(t,n,e)}));function To(t,e){return(Go(t)?$e:Br)(t,cs(e,3))}var Eo=$i((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Mo=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&xs(t,e[0],e[1])?e=[]:n>2&&xs(e[0],e[1],e[2])&&(e=[e[0]]),Hr(t,br(e,1),[])})),Co=he||function(){return de.Date.now()};function Ao(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ji(t,c,n,n,n,n,e)}function No(t,e){var i;if("function"!=typeof e)throw new At(r);return t=ga(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=cn(n,ls(Io));r|=a}return Ji(t,r,e,n,i)})),$o=Zr((function(t,e,n){var r=3;if(n.length){var i=cn(n,ls($o));r|=a}return Ji(e,r,t,n,i)}));function Ro(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new At(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){return h=t,c=$s(b,e),d?m(t):l}function y(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function b(){var t=Co();if(y(t))return v(t);c=$s(b,function(t){var n=e-(t-u);return p?xn(n,a-(t-h)):n}(t))}function v(t){return c=n,f&&s?m(t):(s=o=n,l)}function x(){var t=Co(),r=y(t);if(s=arguments,o=this,u=t,r){if(c===n)return g(u);if(p)return _i(c),c=$s(b,e),m(u)}return c===n&&(c=$s(b,e)),l}return e=ba(e)||0,na(i)&&(d=!!i.leading,a=(p="maxWait"in i)?vn(ba(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),x.cancel=function(){c!==n&&_i(c),h=0,s=u=o=c=n},x.flush=function(){return c===n?l:v(Co())},x}var Oo=Zr((function(t,e){return hr(t,1,e)})),Po=Zr((function(t,e,n){return hr(t,ba(e)||0,n)}));function Lo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new At(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Lo.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new At(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Lo.Cache=Xn;var Fo=wi((function(t,e){var n=(e=1==e.length&&Go(e[0])?$e(e[0],Ke(cs())):$e(br(e,1),Ke(cs()))).length;return Zr((function(r){for(var i=-1,s=xn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return ke(t,this,r)}))})),zo=Zr((function(t,e){var r=cn(e,ls(zo));return Ji(t,a,n,e,r)})),Bo=Zr((function(t,e){var r=cn(e,ls(Bo));return Ji(t,l,n,e,r)})),Uo=rs((function(t,e){return Ji(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!=t&&e!=e}var jo=qi(Mr),Wo=qi((function(t,e){return t>=e})),Ho=$r(function(){return arguments}())?$r:function(t){return ra(t)&&Pt.call(t,"callee")&&!Xt.call(t,"callee")},Go=st.isArray,qo=be?Ke(be):function(t){return ra(t)&&Er(t)==$};function Xo(t){return null!=t&&ea(t.length)&&!Qo(t)}function Yo(t){return ra(t)&&Xo(t)}var Ko=De||bl,Zo=ve?Ke(ve):function(t){return ra(t)&&Er(t)==v};function Jo(t){if(!ra(t))return!1;var e=Er(t);return e==x||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!oa(t)}function Qo(t){if(!na(t))return!1;var e=Er(t);return e==w||e==S||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ta(t){return"number"==typeof t&&t==ga(t)}function ea(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function na(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ra(t){return null!=t&&"object"==typeof t}var ia=xe?Ke(xe):function(t){return ra(t)&&ms(t)==_};function sa(t){return"number"==typeof t||ra(t)&&Er(t)==k}function oa(t){if(!ra(t)||Er(t)!=T)return!1;var e=Gt(t);if(null===e)return!0;var n=Pt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Ot.call(n)==zt}var aa=we?Ke(we):function(t){return ra(t)&&Er(t)==M};var la=Se?Ke(Se):function(t){return ra(t)&&ms(t)==C};function ca(t){return"string"==typeof t||!Go(t)&&ra(t)&&Er(t)==A}function ua(t){return"symbol"==typeof t||ra(t)&&Er(t)==N}var ha=_e?Ke(_e):function(t){return ra(t)&&ea(t.length)&&!!se[Er(t)]};var da=qi(zr),pa=qi((function(t,e){return t<=e}));function fa(t){if(!t)return[];if(Xo(t))return ca(t)?pn(t):Ni(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==_?an:e==C?un:Va)(t)}function ma(t){return t?(t=ba(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ga(t){var e=ma(t),n=e%1;return e==e?n?e-n:e:0}function ya(t){return t?lr(ga(t),0,f):0}function ba(t){if("number"==typeof t)return t;if(ua(t))return p;if(na(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=na(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ye(t);var n=mt.test(t);return n||bt.test(t)?ce(t.slice(2),n?2:8):ft.test(t)?p:+t}function va(t){return Ii(t,Oa(t))}function xa(t){return null==t?"":ui(t)}var wa=Ri((function(t,e){if(ks(e)||Xo(e))Ii(e,Ra(e),t);else for(var n in e)Pt.call(e,n)&&nr(t,n,e[n])})),Sa=Ri((function(t,e){Ii(e,Oa(e),t)})),_a=Ri((function(t,e,n,r){Ii(e,Oa(e),t,r)})),ka=Ri((function(t,e,n,r){Ii(e,Ra(e),t,r)})),Ta=rs(ar);var Ea=Zr((function(t,e){t=Et(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&xs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Oa(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,$t[u])&&!Pt.call(t,u))&&(t[u]=o[u])}return t})),Ma=Zr((function(t){return t.push(n,ts),ke(La,n,t)}));function Ca(t,e,r){var i=null==t?n:kr(t,e);return i===n?r:i}function Aa(t,e){return null!=t&&gs(t,e,Ar)}var Na=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ft.call(e)),t[e]=n}),nl(sl)),Ia=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ft.call(e)),Pt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),$a=Zr(Ir);function Ra(t){return Xo(t)?Zn(t):Dr(t)}function Oa(t){return Xo(t)?Zn(t,!0):Fr(t)}var Pa=Ri((function(t,e,n){jr(t,e,n)})),La=Ri((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=$e(e,(function(e){return e=xi(e,t),r||(r=e.length>1),e})),Ii(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var Fa=rs((function(t,e){return null==t?{}:function(t,e){return Gr(t,e,(function(e,n){return Aa(t,n)}))}(t,e)}));function za(t,e){if(null==t)return{};var n=$e(ss(t),(function(t){return[t]}));return e=cs(e),Gr(t,n,(function(t,n){return e(t,n[0])}))}var Ba=Zi(Ra),Ua=Zi(Oa);function Va(t){return null==t?[]:Ze(t,Ra(t))}var ja=Di((function(t,e,n){return e=e.toLowerCase(),t+(n?Wa(e):e)}));function Wa(t){return Ja(xa(t).toLowerCase())}function Ha(t){return(t=xa(t))&&t.replace(xt,nn).replace(Jt,"")}var Ga=Di((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=Di((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Xa=Li("toLowerCase");var Ya=Di((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ka=Di((function(t,e,n){return t+(n?" ":"")+Ja(e)}));var Za=Di((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Ja=Li("toUpperCase");function Qa(t,e,r){return t=xa(t),(e=r?n:e)===n?function(t){return ne.test(t)}(t)?function(t){return t.match(te)||[]}(t):function(t){return t.match(ct)||[]}(t):t.match(e)||[]}var tl=Zr((function(t,e){try{return ke(t,n,e)}catch(t){return Jo(t)?t:new _t(t)}})),el=rs((function(t,e){return Ee(e,(function(e){e=Fs(e),or(t,e,Io(t[e],t))})),t}));function nl(t){return function(){return t}}var rl=Bi(),il=Bi(!0);function sl(t){return t}function ol(t){return Lr("function"==typeof t?t:cr(t,1))}var al=Zr((function(t,e){return function(n){return Ir(n,t,e)}})),ll=Zr((function(t,e){return function(n){return Ir(t,n,e)}}));function cl(t,e,n){var r=Ra(e),i=_r(e,r);null!=n||na(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=_r(e,Ra(e)));var s=!(na(n)&&"chain"in n&&!n.chain),o=Qo(t);return Ee(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__),i=n.__actions__=Ni(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Re([this.value()],arguments))})})),t}function ul(){}var hl=Wi($e),dl=Wi(Ce),pl=Wi(Le);function fl(t){return ws(t)?We(Fs(t)):function(t){return function(e){return kr(e,t)}}(t)}var ml=Gi(),gl=Gi(!0);function yl(){return[]}function bl(){return!1}var vl=ji((function(t,e){return t+e}),0),xl=Yi("ceil"),wl=ji((function(t,e){return t/e}),1),Sl=Yi("floor");var _l,kl=ji((function(t,e){return t*e}),1),Tl=Yi("round"),El=ji((function(t,e){return t-e}),0);return Un.after=function(t,e){if("function"!=typeof e)throw new At(r);return t=ga(t),function(){if(--t<1)return e.apply(this,arguments)}},Un.ary=Ao,Un.assign=wa,Un.assignIn=Sa,Un.assignInWith=_a,Un.assignWith=ka,Un.at=Ta,Un.before=No,Un.bind=Io,Un.bindAll=el,Un.bindKey=$o,Un.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Un.chain=fo,Un.chunk=function(t,e,r){e=(r?xs(t,e,r):e===n)?1:vn(ga(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=st(fe(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Un.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Un.concat=function(){var t=arguments.length;if(!t)return[];for(var e=st(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Re(Go(n)?Ni(n):[n],br(e,1))},Un.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?$e(t,(function(t){if("function"!=typeof t[1])throw new At(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(ke(i[0],this,n))return ke(i[1],this,n)}}))},Un.conforms=function(t){return function(t){var e=Ra(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Un.constant=nl,Un.countBy=yo,Un.create=function(t,e){var n=Vn(t);return null==e?n:sr(n,e)},Un.curry=function t(e,r,i){var s=Ji(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Un.curryRight=function t(e,r,i){var s=Ji(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Un.debounce=Ro,Un.defaults=Ea,Un.defaultsDeep=Ma,Un.defer=Oo,Un.delay=Po,Un.difference=Us,Un.differenceBy=Vs,Un.differenceWith=js,Un.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ga(e))<0?0:e,i):[]},Un.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ga(e)))<0?0:e):[]},Un.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Un.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Un.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&xs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ga(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ga(i))<0&&(i+=s),i=r>i?0:ya(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Un.filter=function(t,e){return(Go(t)?Ae:yr)(t,cs(e,3))},Un.flatMap=function(t,e){return br(To(t,e),1)},Un.flatMapDeep=function(t,e){return br(To(t,e),h)},Un.flatMapDepth=function(t,e,r){return r=r===n?1:ga(r),br(To(t,e),r)},Un.flatten=Gs,Un.flattenDeep=function(t){return(null==t?0:t.length)?br(t,h):[]},Un.flattenDepth=function(t,e){return(null==t?0:t.length)?br(t,e=e===n?1:ga(e)):[]},Un.flip=function(t){return Ji(t,512)},Un.flow=rl,Un.flowRight=il,Un.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Un.functions=function(t){return null==t?[]:_r(t,Ra(t))},Un.functionsIn=function(t){return null==t?[]:_r(t,Oa(t))},Un.groupBy=So,Un.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Un.intersection=Xs,Un.intersectionBy=Ys,Un.intersectionWith=Ks,Un.invert=Na,Un.invertBy=Ia,Un.invokeMap=_o,Un.iteratee=ol,Un.keyBy=ko,Un.keys=Ra,Un.keysIn=Oa,Un.map=To,Un.mapKeys=function(t,e){var n={};return e=cs(e,3),wr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Un.mapValues=function(t,e){var n={};return e=cs(e,3),wr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Un.matches=function(t){return Ur(cr(t,1))},Un.matchesProperty=function(t,e){return Vr(t,cr(e,1))},Un.memoize=Lo,Un.merge=Pa,Un.mergeWith=La,Un.method=al,Un.methodOf=ll,Un.mixin=cl,Un.negate=Do,Un.nthArg=function(t){return t=ga(t),Zr((function(e){return Wr(e,t)}))},Un.omit=Da,Un.omitBy=function(t,e){return za(t,Do(cs(e)))},Un.once=function(t){return No(2,t)},Un.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Hr(t,e,r))},Un.over=hl,Un.overArgs=Fo,Un.overEvery=dl,Un.overSome=pl,Un.partial=zo,Un.partialRight=Bo,Un.partition=Eo,Un.pick=Fa,Un.pickBy=za,Un.property=fl,Un.propertyOf=function(t){return function(e){return null==t?n:kr(t,e)}},Un.pull=Js,Un.pullAll=Qs,Un.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?qr(t,e,cs(n,2)):t},Un.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?qr(t,e,n,r):t},Un.pullAt=to,Un.range=ml,Un.rangeRight=gl,Un.rearg=Uo,Un.reject=function(t,e){return(Go(t)?Ae:yr)(t,Do(cs(e,3)))},Un.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Un.rest=function(t,e){if("function"!=typeof t)throw new At(r);return Zr(t,e=e===n?e:ga(e))},Un.reverse=eo,Un.sampleSize=function(t,e,r){return e=(r?xs(t,e,r):e===n)?1:ga(e),(Go(t)?Qn:Qr)(t,e)},Un.set=function(t,e,n){return null==t?t:ti(t,e,n)},Un.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Un.shuffle=function(t){return(Go(t)?tr:ri)(t)},Un.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&xs(t,e,r)?(e=0,r=i):(e=null==e?0:ga(e),r=r===n?i:ga(r)),ii(t,e,r)):[]},Un.sortBy=Mo,Un.sortedUniq=function(t){return t&&t.length?li(t):[]},Un.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Un.split=function(t,e,r){return r&&"number"!=typeof r&&xs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=xa(t))&&("string"==typeof e||null!=e&&!aa(e))&&!(e=ui(e))&&on(t)?Si(pn(t),0,r):t.split(e,r):[]},Un.spread=function(t,e){if("function"!=typeof t)throw new At(r);return e=null==e?0:vn(ga(e),0),Zr((function(n){var r=n[e],i=Si(n,0,e);return r&&Re(i,r),ke(t,this,i)}))},Un.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Un.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ga(e))<0?0:e):[]},Un.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ga(e)))<0?0:e,i):[]},Un.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Un.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Un.tap=function(t,e){return e(t),t},Un.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new At(r);return na(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Ro(t,e,{leading:i,maxWait:e,trailing:s})},Un.thru=mo,Un.toArray=fa,Un.toPairs=Ba,Un.toPairsIn=Ua,Un.toPath=function(t){return Go(t)?$e(t,Fs):ua(t)?[t]:Ni(Ds(xa(t)))},Un.toPlainObject=va,Un.transform=function(t,e,n){var r=Go(t),i=r||Ko(t)||ha(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:na(t)&&Qo(s)?Vn(Gt(t)):{}}return(i?Ee:wr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Un.unary=function(t){return Ao(t,1)},Un.union=no,Un.unionBy=ro,Un.unionWith=io,Un.uniq=function(t){return t&&t.length?hi(t):[]},Un.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Un.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Un.unset=function(t,e){return null==t||di(t,e)},Un.unzip=so,Un.unzipWith=oo,Un.update=function(t,e,n){return null==t?t:pi(t,e,vi(n))},Un.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,vi(r),i)},Un.values=Va,Un.valuesIn=function(t){return null==t?[]:Ze(t,Oa(t))},Un.without=ao,Un.words=Qa,Un.wrap=function(t,e){return zo(vi(e),t)},Un.xor=lo,Un.xorBy=co,Un.xorWith=uo,Un.zip=ho,Un.zipObject=function(t,e){return yi(t||[],e||[],nr)},Un.zipObjectDeep=function(t,e){return yi(t||[],e||[],ti)},Un.zipWith=po,Un.entries=Ba,Un.entriesIn=Ua,Un.extend=Sa,Un.extendWith=_a,cl(Un,Un),Un.add=vl,Un.attempt=tl,Un.camelCase=ja,Un.capitalize=Wa,Un.ceil=xl,Un.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=ba(r))==r?r:0),e!==n&&(e=(e=ba(e))==e?e:0),lr(ba(t),e,r)},Un.clone=function(t){return cr(t,4)},Un.cloneDeep=function(t){return cr(t,5)},Un.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Un.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Un.conformsTo=function(t,e){return null==e||ur(t,e,Ra(e))},Un.deburr=Ha,Un.defaultTo=function(t,e){return null==t||t!=t?e:t},Un.divide=wl,Un.endsWith=function(t,e,r){t=xa(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ga(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Un.eq=Vo,Un.escape=function(t){return(t=xa(t))&&Y.test(t)?t.replace(q,rn):t},Un.escapeRegExp=function(t){return(t=xa(t))&&rt.test(t)?t.replace(nt,"\\$&"):t},Un.every=function(t,e,r){var i=Go(t)?Ce:mr;return r&&xs(t,e,r)&&(e=n),i(t,cs(e,3))},Un.find=bo,Un.findIndex=Ws,Un.findKey=function(t,e){return Fe(t,cs(e,3),wr)},Un.findLast=vo,Un.findLastIndex=Hs,Un.findLastKey=function(t,e){return Fe(t,cs(e,3),Sr)},Un.floor=Sl,Un.forEach=xo,Un.forEachRight=wo,Un.forIn=function(t,e){return null==t?t:vr(t,cs(e,3),Oa)},Un.forInRight=function(t,e){return null==t?t:xr(t,cs(e,3),Oa)},Un.forOwn=function(t,e){return t&&wr(t,cs(e,3))},Un.forOwnRight=function(t,e){return t&&Sr(t,cs(e,3))},Un.get=Ca,Un.gt=jo,Un.gte=Wo,Un.has=function(t,e){return null!=t&&gs(t,e,Cr)},Un.hasIn=Aa,Un.head=qs,Un.identity=sl,Un.includes=function(t,e,n,r){t=Xo(t)?t:Va(t),n=n&&!r?ga(n):0;var i=t.length;return n<0&&(n=vn(i+n,0)),ca(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Be(t,e,n)>-1},Un.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ga(n);return i<0&&(i=vn(r+i,0)),Be(t,e,i)},Un.inRange=function(t,e,r){return e=ma(e),r===n?(r=e,e=0):r=ma(r),function(t,e,n){return t>=xn(e,n)&&t<vn(e,n)}(t=ba(t),e,r)},Un.invoke=$a,Un.isArguments=Ho,Un.isArray=Go,Un.isArrayBuffer=qo,Un.isArrayLike=Xo,Un.isArrayLikeObject=Yo,Un.isBoolean=function(t){return!0===t||!1===t||ra(t)&&Er(t)==b},Un.isBuffer=Ko,Un.isDate=Zo,Un.isElement=function(t){return ra(t)&&1===t.nodeType&&!oa(t)},Un.isEmpty=function(t){if(null==t)return!0;if(Xo(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Ko(t)||ha(t)||Ho(t)))return!t.length;var e=ms(t);if(e==_||e==C)return!t.size;if(ks(t))return!Dr(t).length;for(var n in t)if(Pt.call(t,n))return!1;return!0},Un.isEqual=function(t,e){return Rr(t,e)},Un.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Rr(t,e,n,r):!!i},Un.isError=Jo,Un.isFinite=function(t){return"number"==typeof t&&He(t)},Un.isFunction=Qo,Un.isInteger=ta,Un.isLength=ea,Un.isMap=ia,Un.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Un.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Un.isNaN=function(t){return sa(t)&&t!=+t},Un.isNative=function(t){if(_s(t))throw new _t("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Pr(t)},Un.isNil=function(t){return null==t},Un.isNull=function(t){return null===t},Un.isNumber=sa,Un.isObject=na,Un.isObjectLike=ra,Un.isPlainObject=oa,Un.isRegExp=aa,Un.isSafeInteger=function(t){return ta(t)&&t>=-9007199254740991&&t<=d},Un.isSet=la,Un.isString=ca,Un.isSymbol=ua,Un.isTypedArray=ha,Un.isUndefined=function(t){return t===n},Un.isWeakMap=function(t){return ra(t)&&ms(t)==I},Un.isWeakSet=function(t){return ra(t)&&"[object WeakSet]"==Er(t)},Un.join=function(t,e){return null==t?"":yn.call(t,e)},Un.kebabCase=Ga,Un.last=Zs,Un.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ga(r))<0?vn(i+s,0):xn(s,i-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):ze(t,Ve,s,!0)},Un.lowerCase=qa,Un.lowerFirst=Xa,Un.lt=da,Un.lte=pa,Un.max=function(t){return t&&t.length?gr(t,sl,Mr):n},Un.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Mr):n},Un.mean=function(t){return je(t,sl)},Un.meanBy=function(t,e){return je(t,cs(e,2))},Un.min=function(t){return t&&t.length?gr(t,sl,zr):n},Un.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),zr):n},Un.stubArray=yl,Un.stubFalse=bl,Un.stubObject=function(){return{}},Un.stubString=function(){return""},Un.stubTrue=function(){return!0},Un.multiply=kl,Un.nth=function(t,e){return t&&t.length?Wr(t,ga(e)):n},Un.noConflict=function(){return de._===this&&(de._=Bt),this},Un.noop=ul,Un.now=Co,Un.pad=function(t,e,n){t=xa(t);var r=(e=ga(e))?dn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Hi(ge(i),n)+t+Hi(fe(i),n)},Un.padEnd=function(t,e,n){t=xa(t);var r=(e=ga(e))?dn(t):0;return e&&r<e?t+Hi(e-r,n):t},Un.padStart=function(t,e,n){t=xa(t);var r=(e=ga(e))?dn(t):0;return e&&r<e?Hi(e-r,n)+t:t},Un.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Sn(xa(t).replace(it,""),e||0)},Un.random=function(t,e,r){if(r&&"boolean"!=typeof r&&xs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=ma(t),e===n?(e=t,t=0):e=ma(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=_n();return xn(t+s*(e-t+le("1e-"+((s+"").length-1))),e)}return Yr(t,e)},Un.reduce=function(t,e,n){var r=Go(t)?Oe:Ge,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Un.reduceRight=function(t,e,n){var r=Go(t)?Pe:Ge,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Un.repeat=function(t,e,r){return e=(r?xs(t,e,r):e===n)?1:ga(e),Kr(xa(t),e)},Un.replace=function(){var t=arguments,e=xa(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Un.result=function(t,e,r){var i=-1,s=(e=xi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[Fs(e[i])];o===n&&(i=s,o=r),t=Qo(o)?o.call(t):o}return t},Un.round=Tl,Un.runInContext=t,Un.sample=function(t){return(Go(t)?Jn:Jr)(t)},Un.size=function(t){if(null==t)return 0;if(Xo(t))return ca(t)?dn(t):t.length;var e=ms(t);return e==_||e==C?t.size:Dr(t).length},Un.snakeCase=Ya,Un.some=function(t,e,r){var i=Go(t)?Le:si;return r&&xs(t,e,r)&&(e=n),i(t,cs(e,3))},Un.sortedIndex=function(t,e){return oi(t,e)},Un.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Un.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Un.sortedLastIndex=function(t,e){return oi(t,e,!0)},Un.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Un.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Un.startCase=Ka,Un.startsWith=function(t,e,n){return t=xa(t),n=null==n?0:lr(ga(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Un.subtract=El,Un.sum=function(t){return t&&t.length?qe(t,sl):0},Un.sumBy=function(t,e){return t&&t.length?qe(t,cs(e,2)):0},Un.template=function(t,e,r){var i=Un.templateSettings;r&&xs(t,e,r)&&(e=n),t=xa(t),e=_a({},e,i,Qi);var s,o,a=_a({},e.imports,i.imports,Qi),l=Ra(a),c=Ze(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Mt((e.escape||wt).source+"|"+h.source+"|"+(h===J?dt:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(Pt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ie+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,sn),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=Pt.call(e,"variable")&&e.variable;if(m){if(ut.test(m))throw new _t("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(j,""):d).replace(W,"$1").replace(H,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=tl((function(){return kt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Jo(g))throw g;return g},Un.times=function(t,e){if((t=ga(t))<1||t>d)return[];var n=f,r=xn(t,f);e=cs(e),t-=f;for(var i=Xe(r,e);++n<t;)e(n);return i},Un.toFinite=ma,Un.toInteger=ga,Un.toLength=ya,Un.toLower=function(t){return xa(t).toLowerCase()},Un.toNumber=ba,Un.toSafeInteger=function(t){return t?lr(ga(t),-9007199254740991,d):0===t?t:0},Un.toString=xa,Un.toUpper=function(t){return xa(t).toUpperCase()},Un.trim=function(t,e,r){if((t=xa(t))&&(r||e===n))return Ye(t);if(!t||!(e=ui(e)))return t;var i=pn(t),s=pn(e);return Si(i,Qe(i,s),tn(i,s)+1).join("")},Un.trimEnd=function(t,e,r){if((t=xa(t))&&(r||e===n))return t.slice(0,fn(t)+1);if(!t||!(e=ui(e)))return t;var i=pn(t);return Si(i,0,tn(i,pn(e))+1).join("")},Un.trimStart=function(t,e,r){if((t=xa(t))&&(r||e===n))return t.replace(it,"");if(!t||!(e=ui(e)))return t;var i=pn(t);return Si(i,Qe(i,pn(e))).join("")},Un.truncate=function(t,e){var r=30,i="...";if(na(e)){var s="separator"in e?e.separator:s;r="length"in e?ga(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=xa(t)).length;if(on(t)){var a=pn(t);o=a.length}if(r>=o)return t;var l=r-dn(i);if(l<1)return i;var c=a?Si(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),aa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Mt(s.source,xa(pt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Un.unescape=function(t){return(t=xa(t))&&X.test(t)?t.replace(G,mn):t},Un.uniqueId=function(t){var e=++Lt;return xa(t)+e},Un.upperCase=Za,Un.upperFirst=Ja,Un.each=xo,Un.eachRight=wo,Un.first=qs,cl(Un,(_l={},wr(Un,(function(t,e){Pt.call(Un.prototype,e)||(_l[e]=t)})),_l),{chain:!1}),Un.VERSION="4.17.21",Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Un[t].placeholder=Un})),Ee(["drop","take"],(function(t,e){Hn.prototype[t]=function(r){r=r===n?1:vn(ga(r),0);var i=this.__filtered__&&!e?new Hn(this):this.clone();return i.__filtered__?i.__takeCount__=xn(r,i.__takeCount__):i.__views__.push({size:xn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Hn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Ee(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Hn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Ee(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Hn.prototype[t]=function(){return this[n](1).value()[0]}})),Ee(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Hn.prototype[t]=function(){return this.__filtered__?new Hn(this):this[n](1)}})),Hn.prototype.compact=function(){return this.filter(sl)},Hn.prototype.find=function(t){return this.filter(t).head()},Hn.prototype.findLast=function(t){return this.reverse().find(t)},Hn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Hn(this):this.map((function(n){return Ir(n,t,e)}))})),Hn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Hn.prototype.slice=function(t,e){t=ga(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Hn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ga(e))<0?r.dropRight(-e):r.take(e-t)),r)},Hn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Hn.prototype.toArray=function(){return this.take(f)},wr(Hn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Un[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Un.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Hn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Un,Re([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Hn(this);var g=t.apply(e,a);return g.__actions__.push({func:mo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Ee(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Nt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Un.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),wr(Hn.prototype,(function(t,e){var n=Un[e];if(n){var r=n.name+"";Pt.call($n,r)||($n[r]=[]),$n[r].push({name:e,func:n})}})),$n[Ui(n,2).name]=[{name:"wrapper",func:n}],Hn.prototype.clone=function(){var t=new Hn(this.__wrapped__);return t.__actions__=Ni(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ni(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ni(this.__views__),t},Hn.prototype.reverse=function(){if(this.__filtered__){var t=new Hn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Hn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=xn(e,t+o);break;case"takeRight":t=vn(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=xn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var y=u[m],b=y.iteratee,v=y.type,x=b(g);if(2==v)g=x;else if(!x){if(1==v)continue t;break t}}f[d++]=g}return f},Un.prototype.at=go,Un.prototype.chain=function(){return fo(this)},Un.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Un.prototype.next=function(){this.__values__===n&&(this.__values__=fa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Un.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Bs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Un.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Hn){var e=t;return this.__actions__.length&&(e=new Hn(this)),(e=e.reverse()).__actions__.push({func:mo,args:[eo],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(eo)},Un.prototype.toJSON=Un.prototype.valueOf=Un.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Un.prototype.first=Un.prototype.head,Qt&&(Un.prototype[Qt]=function(){return this}),Un}();fe?((fe.exports=gn)._=gn,pe._=gn):de._=gn}).call(yt)}(kq,kq.exports);class Tq extends mU{constructor(t,e={}){super((async function*(){const n={query:{},skip:0,take:-1,...e},r=n.take;let i=0,s=[];const o={...n.query,$skip:n.skip,$limit:10};for(;;)try{if(r>0&&i>=r)return;if(i++,s.length>0){const t=s.shift();yield t}else{const e=await t.find({query:o});if(o.$skip=e.skip+e.limit,s=e.data,!(s.length>0))return;{const t=s.shift();yield t}}}catch(t){throw t.message=`Error thrown while iterating through a service: ${t.message}`,t}})),this.service=t,this.params={query:{},skip:0,take:-1,...e}}skip(t){return new Tq(this.service,{...this.params,skip:t})}take(t){return new Tq(this.service,{...this.params,take:t})}select(t){const e=kq.exports.cloneDeep(this.params);return e.query.$select=t,new Tq(this.service,e)}query(t){return new Tq(this.service,vU(this.params,{query:t}))}}function Eq(t){return new Tq(t)}!function(t){t[t.Memory=0]="Memory",t[t.LocalStorage=1]="LocalStorage",t[t.Remote=2]="Remote"}(_q||(_q={}));class Mq{constructor(t="memory"){if(this.requiresAuth=!1,this.apiPrefix="",this.$services=new rU([],!0),bq.set(this,void 0),vq.set(this,void 0),xq.set(this,Promise.resolve()),wq.set(this,!1),Sq.set(this,QB),this.feathers=lH.exports(),this.location=t,function(t){try{new URL(t)}catch(t){return!1}return!0}(t)){this.backend=_q.Remote;const e=new URL(t),n=e.host;this.apiPrefix=e.pathname.replace(/\/$/,"");const r=mW(n,{transports:["websocket"],reconnectionAttempts:5,path:this.apiPrefix+"/socket.io"});this.feathers.configure(VH.exports(r,{timeout:15e3})),HB(this,bq,new Promise((t=>{this.feathers.io.on("init",(({auth:e})=>{this.requiresAuth=e,e&&this.feathers.configure(aH({path:`${this.apiPrefix}/authentication`})),t()}))})),"f")}else if("localStorage"===t){this.backend=_q.LocalStorage;const t=t=>BG.exports({storage:window.localStorage,name:t,id:"_id",multi:!0,paginate:{default:100,max:200}});HB(this,Sq,(e=>{this.feathers.use(`/${e}`,t(e))}),"f")}else{if("memory"!==t)throw new Error(`Cannot process backend location '${t}'`);this.backend=_q.Memory,HB(this,Sq,(t=>{this.feathers.use(`/${t}`,QH.exports({id:"_id",paginate:{default:100,max:200}}))}),"f")}this.setupAppHooks()}async connect(){return this.backend!==_q.Remote?{email:null}:(WB(this,vq,"f")||(aU.log(`Connecting to backend ${this.location}...`),HB(this,vq,new Promise(((t,e)=>{this.feathers.io.on("connect",(()=>{aU.log(`Connected to backend ${this.location}!`),t()})),this.feathers.io.on("reconnect_failed",(()=>{const t=new Error(`Cannot reach backend at location ${this.location}. Is the server running?\n          If using locally, run 'npm run backend'`);t.name="DataStore connection error",e(),hU(t,{duration:0})}))})),"f")),await WB(this,bq,"f"),await WB(this,vq,"f"),this.authenticate())}async authenticate(){if(!this.requiresAuth)return this.user={email:null},this.user;if(this.user)return this.user;const t=()=>(HB(this,wq,!0,"f"),new Promise(((t,e)=>{this.feathers.reAuthenticate().then((({user:e})=>{HB(this,wq,!1,"f"),this.user=e,aU.log(`Authenticated as ${e.email}`),t()})).catch((t=>{HB(this,wq,!1,"f"),e(t)}))})));return HB(this,xq,WB(this,xq,"f").then((()=>WB(this,wq,"f")?null:t())),"f"),WB(this,xq,"f").then((()=>this.user))}async login(t,e){const n=await this.feathers.authenticate({strategy:"local",email:t,password:e});return this.user=n.user,this.user}async loginWithUI(){const t=new yq({target:document.body,props:{dataStore:this}});return new Promise(((e,n)=>{t.$on("terminate",(r=>{t.$destroy(),r?e(r):n()}))}))}async signup(t,e){try{return await this.service("users").create({email:t,password:e}),await this.login(t,e),this.user}catch(t){return aU.error("An error occurred during signup",t),{email:null}}}async logout(){await this.feathers.logout(),document.location.reload()}service(t){const e=Object.keys(this.feathers.services).includes(t);e||(WB(this,Sq,"f").call(this,t),this.$services.set(Object.keys(this.feathers.services)));const n=this.backend===_q.Remote?this.feathers.service(`${this.apiPrefix}/${t}`):this.feathers.service(t);return e||(n.items=()=>Eq(n)),n}setupAppHooks(){const t=this.backend!==_q.Remote?[ZG]:[],e=this.backend!==_q.Remote?[oq]:[];this.feathers.hooks({before:{find:[...e,JG],create:[...t,QG],update:[tq],patch:[tq]},after:{find:[JG],get:[JG],create:[JG],update:[JG],patch:[JG],remove:[JG]}})}}function Cq(t){return new Mq(t)}async function Aq(t,e,n){const r=document.createElement("a");r.style.display="none",document.body.appendChild(r);const i=new Blob([t],{type:n});r.href=URL.createObjectURL(i),r.download=e,r.click()}async function Nq(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=()=>{const t=JSON.parse(r.result);e(t)},r.onerror=t=>{n(t)},r.readAsText(t)}))}function Iq(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase()}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */bq=new WeakMap,vq=new WeakMap,xq=new WeakMap,wq=new WeakMap,Sq=new WeakMap;var $q=function(t,e){return $q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},$q(t,e)};function Rq(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}$q(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Oq,Pq,Lq=function(t){var e="[object "+t+"]";return function(t){return Dq(t)===e}},Dq=function(t){return Object.prototype.toString.call(t)},Fq=function(t){return t instanceof Date?t.getTime():zq(t)?t.map(Fq):t&&"function"==typeof t.toJSON?t.toJSON():t},zq=Lq("Array"),Bq=Lq("Object"),Uq=Lq("Function"),Vq=function(t,e){if(null==t&&t==e)return!0;if(t===e)return!0;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(zq(t)){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(!Vq(t[n],e[n]))return!1;return!0}if(Bq(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!Vq(t[i],e[i]))return!1;return!0}return!1},jq=function(t,e,n,r,i,s){var o=e[r];if(zq(t)&&isNaN(Number(o)))for(var a=0,l=t.length;a<l;a++)if(!jq(t[a],e,n,r,a,t))return!1;return r===e.length||null==t?n(t,i,s,0===r):jq(t[o],e,n,r+1,o,t)},Wq=function(){function t(t,e,n,r){this.params=t,this.owneryQuery=e,this.options=n,this.name=r,this.init()}return t.prototype.init=function(){},t.prototype.reset=function(){this.done=!1,this.keep=!1},t}(),Hq=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r)||this;return s.children=i,s}return Rq(e,t),e.prototype.reset=function(){this.keep=!1,this.done=!1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].reset()},e.prototype.childrenNext=function(t,e,n,r){for(var i=!0,s=!0,o=0,a=this.children.length;o<a;o++){var l=this.children[o];if(l.done||l.next(t,e,n,r),l.keep||(s=!1),l.done){if(!l.keep)break}else i=!1}this.done=i,this.keep=s},e}(Wq),Gq=function(t){function e(e,n,r,i,s){var o=t.call(this,e,n,r,i)||this;return o.name=s,o}return Rq(e,t),e}(Hq),qq=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(Hq),Xq=function(t){function e(e,n,r,i,s){var o=t.call(this,n,r,i,s)||this;return o.keyPath=e,o.propop=!0,o._nextNestedValue=function(t,e,n,r){return o.childrenNext(t,e,n,r),!o.done},o}return Rq(e,t),e.prototype.next=function(t,e,n){jq(t,this.keyPath,this._nextNestedValue,0,e,n)},e}(Hq),Yq=function(t,e){if(t instanceof Function)return t;if(t instanceof RegExp)return function(e){var n="string"==typeof e&&t.test(e);return t.lastIndex=0,n};var n=Fq(t);return function(t){return e(n,Fq(t))}},Kq=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){this._test=Yq(this.params,this.options.compare)},e.prototype.next=function(t,e,n){Array.isArray(n)&&!n.hasOwnProperty(e)||this._test(t,e,n)&&(this.done=!0,this.keep=!0)},e}(Wq),Zq=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.next=function(){this.done=!0,this.keep=!1},e}(Wq),Jq=function(t){return e=function(e,n,r,i){var s=typeof Fq(e),o=t(e);return new Kq((function(t){return typeof Fq(t)===s&&o(t)}),n,r,i)},function(t,n,r,i){return null==t?new Zq(t,n,r,i):e(t,n,r,i)};var e},Qq=function(t,e,n,r){var i=r.operations[t];return i||tX(t),i(e,n,r,t)},tX=function(t){throw new Error("Unsupported operation: "+t)},eX=function(t,e){for(var n in t)if(e.operations.hasOwnProperty(n)||"$"===n.charAt(0))return!0;return!1},nX=function(t,e,n,r,i){if(eX(e,i)){var s=iX(e,n,i),o=s[0];if(s[1].length)throw new Error("Property queries must contain only operations, or exact objects.");return new Xq(t,e,r,i,o)}return new Xq(t,e,r,i,[new Kq(e,r,i)])},rX=function(t,e,n){void 0===e&&(e=null);var r=void 0===n?{}:n,i=r.compare,s=r.operations,o={compare:i||Vq,operations:Object.assign({},s||{})},a=iX(t,null,o),l=a[0],c=a[1],u=[];return l.length&&u.push(new Xq([],t,e,o,l)),u.push.apply(u,c),1===u.length?u[0]:new qq(t,e,o,u)},iX=function(t,e,n){var r,i=[],s=[];if(!(r=t)||r.constructor!==Object&&r.constructor!==Array&&"function Object() { [native code] }"!==r.constructor.toString()&&"function Array() { [native code] }"!==r.constructor.toString()||r.toJSON)return i.push(new Kq(t,t,n)),[i,s];for(var o in t)if(n.operations.hasOwnProperty(o)){var a=Qq(o,t[o],t,n);if(a&&!a.propop&&e&&!n.operations[e])throw new Error("Malformed query. "+o+" cannot be matched against property.");null!=a&&i.push(a)}else"$"===o.charAt(0)?tX(o):s.push(nX(o.split("."),t[o],o,t,n));return[i,s]},sX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){this._test=Yq(this.params,this.options.compare)},e.prototype.reset=function(){t.prototype.reset.call(this),this.keep=!0},e.prototype.next=function(t){this._test(t)&&(this.done=!0,this.keep=!1)},e}(Wq),oX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){if(!this.params||"object"!=typeof this.params)throw new Error("Malformed query. $elemMatch must by an object.");this._queryOperation=rX(this.params,this.owneryQuery,this.options)},e.prototype.reset=function(){t.prototype.reset.call(this),this._queryOperation.reset()},e.prototype.next=function(t){if(zq(t)){for(var e=0,n=t.length;e<n;e++){this._queryOperation.reset();var r=t[e];this._queryOperation.next(r,e,t,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},e}(Wq),aX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){this._queryOperation=rX(this.params,this.owneryQuery,this.options)},e.prototype.reset=function(){t.prototype.reset.call(this),this._queryOperation.reset()},e.prototype.next=function(t,e,n,r){this._queryOperation.next(t,e,n,r),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},e}(Wq),lX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){},e.prototype.next=function(t){zq(t)&&t.length===this.params&&(this.done=!0,this.keep=!0)},e}(Wq),cX=function(t){if(0===t.length)throw new Error("$and/$or/$nor must be a nonempty array")},uX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!1,e}return Rq(e,t),e.prototype.init=function(){var t=this;cX(this.params),this._ops=this.params.map((function(e){return rX(e,null,t.options)}))},e.prototype.reset=function(){this.done=!1,this.keep=!1;for(var t=0,e=this._ops.length;t<e;t++)this._ops[t].reset()},e.prototype.next=function(t,e,n){for(var r=!1,i=!1,s=0,o=this._ops.length;s<o;s++){var a=this._ops[s];if(a.next(t,e,n),a.keep){r=!0,i=a.keep;break}}this.keep=i,this.done=r},e}(Wq),hX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!1,e}return Rq(e,t),e.prototype.next=function(e,n,r){t.prototype.next.call(this,e,n,r),this.keep=!this.keep},e}(uX),dX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.init=function(){var t=this;this._testers=this.params.map((function(e){if(eX(e,t.options))throw new Error("cannot nest $ under "+t.name.toLowerCase());return Yq(e,t.options.compare)}))},e.prototype.next=function(t,e,n){for(var r=!1,i=!1,s=0,o=this._testers.length;s<o;s++){if((0,this._testers[s])(t)){r=!0,i=!0;break}}this.keep=i,this.done=r},e}(Wq),pX=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,i)||this;return s.propop=!0,s._in=new dX(e,n,r,i),s}return Rq(e,t),e.prototype.next=function(t,e,n,r){this._in.next(t,e,n),zq(n)&&!r?this._in.keep?(this.keep=!1,this.done=!0):e==n.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},e.prototype.reset=function(){t.prototype.reset.call(this),this._in.reset()},e}(Wq),fX=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return Rq(e,t),e.prototype.next=function(t,e,n){n.hasOwnProperty(e)===this.params&&(this.done=!0,this.keep=!0)},e}(Wq),mX=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,e.map((function(t){return rX(t,n,r)})),i)||this;return s.propop=!1,cX(e),s}return Rq(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(Gq),gX=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,e.map((function(t){return rX(t,n,r)})),i)||this;return s.propop=!0,s}return Rq(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(Gq),yX=Jq((function(t){return function(e){return e<t}})),bX=Jq((function(t){return function(e){return e<=t}})),vX=Jq((function(t){return function(e){return e>t}})),xX=Jq((function(t){return function(e){return e>=t}})),wX={number:function(t){return"number"==typeof t},string:function(t){return"string"==typeof t},bool:function(t){return"boolean"==typeof t},array:function(t){return Array.isArray(t)},null:function(t){return null===t},timestamp:function(t){return t instanceof Date}},SX=Object.freeze({__proto__:null,$Size:lX,$eq:function(t,e,n){return new Kq(t,e,n)},$ne:function(t,e,n,r){return new sX(t,e,n,r)},$or:function(t,e,n,r){return new uX(t,e,n,r)},$nor:function(t,e,n,r){return new hX(t,e,n,r)},$elemMatch:function(t,e,n,r){return new oX(t,e,n,r)},$nin:function(t,e,n,r){return new pX(t,e,n,r)},$in:function(t,e,n,r){return new dX(t,e,n,r)},$lt:yX,$lte:bX,$gt:vX,$gte:xX,$mod:function(t,e,n){var r=t[0],i=t[1];return new Kq((function(t){return Fq(t)%r===i}),e,n)},$exists:function(t,e,n,r){return new fX(t,e,n,r)},$regex:function(t,e,n){return new Kq(new RegExp(t,e.$options),e,n)},$not:function(t,e,n,r){return new aX(t,e,n,r)},$type:function(t,e,n){return new Kq((function(e){if("string"==typeof t){if(!wX[t])throw new Error("Type alias does not exist");return wX[t](e)}return null!=e&&(e instanceof t||e.constructor===t)}),e,n)},$and:function(t,e,n,r){return new mX(t,e,n,r)},$all:function(t,e,n,r){return new gX(t,e,n,r)},$size:function(t,e,n){return new lX(t,e,n,"$size")},$options:function(){return null},$where:function(t,e,n){var r;if(Uq(t))r=t;else{if(process.env.CSP_ENABLED)throw new Error('In CSP mode, sift does not support strings in "$where" condition');r=new Function("obj","return "+t)}return new Kq((function(t){return r.bind(t)(t)}),e,n)}}),_X=function(t,e){void 0===e&&(e={});var n,r=function(t,e,n){var r=void 0===n?{}:n,i=r.compare,s=r.operations;return rX(t,e,{compare:i,operations:Object.assign({},SX,s||{})})}(t,null,e);return n=r,function(t,e,r){return n.reset(),n.next(t,e,r),n.keep}};class kX extends SU{constructor(t,e=Cq()){super(),this.title="dataset",this.isDataset=!0,Oq.set(this,void 0),this.query={},Pq.set(this,new Set),this.$count=new rU(0,!0),this.$changes=new rU([]),this.name=t,this.title=`dataset (${t})`,HB(this,Oq,e,"f"),this.start(),this.ready=new Promise(((e,n)=>{WB(this,Oq,"f").connect().then((()=>this.setup())).then(e).catch((e=>{const r=new Error(null==e?void 0:e.message);r.name=`Dataset Error (${t}): datastore connection failed`,hU(r,{duration:0}),n(r)}))}))}async setup(){const t=Iq(`instances-${this.name}`);var e,n;this.instanceService=WB(this,Oq,"f").service(t),void 0===this.instanceService.__hooks.before.find&&this.instanceService.hooks({before:{all:[],create:[(e="datasetName",n=this.name,t=>{const{data:r}=t;return t.data={[e]:n,...r},t}),iq],find:[eq("datasetName",this.name)],get:[eq("datasetName",this.name)],update:[eq("datasetName",this.name)],patch:[eq("datasetName",this.name)],remove:[eq("datasetName",this.name)]},after:{find:[sq],get:[sq]}}),this.instanceService.hooks({before:{update:[this.checkUpdates],patch:[this.checkUpdates]}}),await this.reset(),this.watchChanges()}async reset(){const{total:t}=await this.find({query:{$limit:0}});this.$count.set(t),this.$changes.set([{level:"dataset",type:"created"}])}async checkUpdates(t){if(0===Object.keys(this.query).length)return;const e=_X(this.query),n=e(t.data);try{const r=await this.get(t.id);e(r)&&!n&&(this.$count.set(this.$count.get()-1),this.$changes.set([{level:"instance",type:"removed",data:r}]))}catch(e){WB(this,Pq,"f").add(t.id)}}watchChanges(){const t=_X(this.query);this.instanceService.on("created",(e=>{if(!t(e))return;const n={...e,id:e.id||e._id};this.$count.set(this.$count.get()+1),this.$changes.set([{level:"instance",type:"created",data:n}])}));const e=e=>{if(!t(e))return;const n={...e,id:e.id||e._id};WB(this,Pq,"f").has(n.id)?(this.$count.set(this.$count.get()+1),this.$changes.set([{level:"instance",type:"created",data:n}]),WB(this,Pq,"f").delete(n.id)):this.$changes.set([{level:"instance",type:"updated",data:n}])};this.instanceService.on("updated",e),this.instanceService.on("patched",e),this.instanceService.on("removed",(e=>{if(!t(e))return;this.$count.set(this.$count.get()-1);const n={...e,id:e.id||e._id};this.$changes.set([{level:"instance",type:"removed",data:n}])}))}async sift(t={}){return this.query=t,this.ready.then((()=>this.reset()))}items(){return this.instanceService.items().query(this.query)}async find(t){const e=vU(t||{},{query:this.query});return this.instanceService.find(e)}async get(t,e){const n=vU(e||{},{query:this.query});return this.instanceService.get(t,n)}async create(t,e){const n=vU(e||{},{query:this.query});return this.instanceService.create(t,n)}async update(t,e,n){const r=vU(n||{},{query:this.query});return this.instanceService.update(t,e,r)}async patch(t,e,n){const r=vU(n||{},{query:this.query});return this.instanceService.patch(t,e,r)}async remove(t,e){const n=vU(e||{},{query:this.query});return this.instanceService.remove(t,n)}async clear(){await this.remove(null,{query:{}})}async distinct(t){const e={$distinct:t,...this.query};return this.instanceService.find({query:e})}async download(){const t={marcelleMeta:{type:"dataset"},instances:(await this.find()).data},e=new Date(Date.now()),n=`${this.title}-${e.toISOString()}.json`;await Aq(JSON.stringify(t),n,"text/plain")}async upload(t){const e=t.filter((t=>"application/json"===t.type)).map((t=>Nq(t))),n=(await Promise.all(e)).map((t=>t.instances.map((t=>{const{id:e,...n}=t;return this.create(n).catch((t=>{hU(t)}))}))));await Promise.all(n)}mount(){}}function TX(t,e){return new kX(t,e)}function EX(t){return"object"==typeof t&&null!==t&&t.isDataset}Oq=new WeakMap,Pq=new WeakMap;class MX extends SU{constructor(){super(),this.ready=!1,this.$training=new rU({status:"idle"},!0),this.$training.start(),this.$training.subscribe((({status:t})=>{"success"!==t&&"loaded"!==t||(this.ready=!0)}))}sync(t,e){return this.syncData={name:e,store:t},this.syncData.store.connect().then((()=>{this.syncData.service=this.syncData.store.service(this.serviceName),this.setupSync()})).catch((t=>{const n=new Error(null==t?void 0:t.message);n.name=`Model Sync Error (${e}): datastore connection failed`,hU(n,{duration:0})})),this}async setupSync(){if(!this.syncData.service)return;const{data:t}=await this.syncData.service.find({query:{name:this.syncData.name,$select:["id"],$limit:1,$sort:{updatedAt:-1}}});let e=null;1===t.length&&(e=t[0].id,this.load(this.syncData.store,e));let n=!1;this.$training.subscribe((({status:t,data:r})=>{("success"===t||"loaded"===t&&"datastore"!==(null==r?void 0:r.source))&&(n=!0,this.save(this.syncData.store,this.syncData.name,{},e).then((t=>{e=t})))}));const r=t=>{(t._id===e||!e&&t.name===this.syncData.name)&&(e=t._id,n||this.load(this.syncData.store,e),n=!1)};this.syncData.service.on("created",r),this.syncData.service.on("updated",r),this.syncData.service.on("patched",r)}async saveToDatastore(t,e,n=null){await t.connect();const r=t.service(this.serviceName);if(!r)return null;if(!e)return null;let i=n;if(n)await r.update(n,e);else{i=(await r.create(e)).id}return aU.info(`Model was saved to data store at location ${t.location}`),i}async loadFromDatastore(t,e){await t.connect();const n=t.service(this.serviceName);if(!n||!e)return null;let r;try{r=await n.get(e)}catch(t){const{data:i}=await n.find({query:{name:e,$limit:1,$sort:{updatedAt:-1}}});1===i.length&&(r=i[0])}if(r){const e=r.name;aU.info(`Model ${e} was loaded from data store at location ${t.location}`)}return r}mount(){}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var CX,AX;X().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(CX||(CX={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(AX||(AX={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const NX={};function IX(t){return NX[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $X(t,e,n,r,i){const s=e.inputParams[t];if(s&&void 0!==s.inputIndexStart){const t=s.inputIndexStart,o=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?t+1:s.inputIndexEnd;if("tensor"===s.type)return RX(e.inputNames[s.inputIndexStart],n,r,i);if("tensors"===s.type){return e.inputNames.slice(t,o).map((t=>RX(t,n,r,i)))}const a=RX(e.inputNames.slice(t)[0],n,r,i),l=a.dataSync();return"number"===s.type?l[0]:F(a.shape,l)}const o=e.attrParams[t];return o&&o.value}function RX(t,e,n,r){const[i,s]=LX(t);if(null!=r){const t=r.getHashTableHandleByName(i);if(null!=t)return t}const o=n.currentContextIds.find((t=>!!e[PX(i,t)]));return void 0!==o?e[PX(i,o)][s]:void 0}function OX(t,e){const[n,r,i]=LX(t);return[PX(n,e&&e.currentContextId),r,i]}function PX(t,e){return e?`${t}-${e}`:t}function LX(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function DX(t,e,n){let r=$X("pad",t,e,n);if("explicit"===r){r=$X("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)i[t][0]=r[2*t],i[t][1]=r[2*t+1];return i}return r}function FX(t){return t.kept?t:Kn(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zX=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var BX=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var UX=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var VX=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jX=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var WX=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var HX=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var GX=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qX=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var XX=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var YX=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var KX=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZX=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var JX=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var QX=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tY=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var eY=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nY=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rY=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iY{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[zX,BX,UX,VX,jX,WX,HX,GX,qX,XX,YX,KX,ZX,JX,QX,tY,eY,nY,rY].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],i=[],s=[],o=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?i.push(t[e.name]):null!=e.input&&0!==e.input.length||s.push(t[e.name]),t)),{});let a=[];const l=[];let c={},u={};null!=e&&(c=this.mapSignatureEntries(e.inputs),u=this.mapSignatureEntries(e.outputs));const h=Object.keys(o);h.forEach((t=>{const e=o[t];e.inputNames.forEach(((t,n)=>{const[r,,i]=OX(t),s=o[r];if(null!=s.outputs){const t=s.outputs.indexOf(i);if(-1!==t){const i=`${r}:${t}`;e.inputNames[n]=i}}e.inputs.push(s),s.children.push(e)}))})),0===Object.keys(u).length?h.forEach((t=>{const e=o[t];0===e.children.length&&l.push(e)})):Object.keys(u).forEach((t=>{const[e]=OX(t),n=o[e];null!=n&&(n.signatureKey=u[t],l.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=OX(t),n=o[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let d={};null!=t.library&&null!=t.library.function&&(d=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:o,inputs:a,outputs:l,weights:i,placeholders:r,signature:e,functions:d};return s.length>0&&(p.initNodes=s),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=IX(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let i;switch(n.type){case"string":i=oY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=oY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=gY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=gY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=lY(t.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=lY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=mY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=mY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=aY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=aY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=bY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=bY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=fY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=fY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=yY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=yY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=hY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=hY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=dY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=dY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=uY(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=uY(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:i,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const i=[],s=[];t.signature.inputArg.forEach((t=>{const[e]=OX(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:cY(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,i.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[i,,s]=OX(t),o=r[i];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const r=`${i}:${t}`;e.inputNames[n]=r}}e.inputs.push(o),o.children.push(e)}))}));const o=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=OX(o[t.name]),i=r[e];null!=i&&(i.defaultOutput=n,s.push(i))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:i,outputs:s,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function sY(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=X().global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return e?n:n.toLowerCase()}function oY(t,e,n,r=!1){const i=t[e];return null!=i?sY(i.s,r):n}function aY(t,e,n){const r=t[e];return r?r.b:n}function lY(t,e,n){const r=t[e]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function cY(t){switch("string"==typeof t&&(t=CX[t]),t){case CX.DT_FLOAT:case CX.DT_HALF:return"float32";case CX.DT_INT32:case CX.DT_INT64:case CX.DT_INT8:case CX.DT_UINT8:return"int32";case CX.DT_BOOL:return"bool";case CX.DT_DOUBLE:return"float32";case CX.DT_STRING:return"string";default:return null}}function uY(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function hY(t,e,n){const r=t[e];return r&&r.type?cY(r.type):n}function dY(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>cY(t))):n}function pY(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function fY(t,e,n){const r=t[e];return r&&r.shape?pY(r.shape):n}function mY(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function gY(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map((t=>sY(t,r))):n}function yY(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>pY(t))):n}function bY(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vY{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return RX(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return RX(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return lY(this.node.rawAttrs,t,e);if(null!=n.s)return oY(this.node.rawAttrs,t,e);if(null!=n.b)return aY(this.node.rawAttrs,t,e);if(null!=n.shape)return fY(this.node.rawAttrs,t,e);if(null!=n.type)return hY(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return mY(this.node.rawAttrs,t,e);if(null!=n.list.s)return gY(this.node.rawAttrs,t,e);if(null!=n.list.shape)return yY(this.node.rawAttrs,t,e);if(null!=n.list.b)return bY(this.node.rawAttrs,t,e);if(null!=n.list.type)return dY(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xY=Object.freeze({__proto__:null,abs:_i,acos:ki,acosh:Ti,add:vi,addN:Ei,all:Mi,any:Ci,argMax:Ai,argMin:Ni,asin:Ii,asinh:$i,atan:Ri,atan2:Oi,atanh:Pi,avgPool:Zi,avgPool3d:Ji,basicLSTMCell:rs,batchToSpaceND:is,batchNorm:ss,batchNorm2d:os,batchNorm3d:as,batchNorm4d:ls,bincount:cs,broadcastArgs:us,broadcastTo:hs,buffer:Xn,cast:Yn,ceil:ds,clipByValue:fs,clone:Kn,complex:en,concat:Qi,concat1d:ms,concat2d:gs,concat3d:ys,concat4d:bs,conv1d:xs,conv2d:vs,conv2dTranspose:Ss,conv3d:_s,conv3dTranspose:Ts,cos:Es,cosh:Ms,cumprod:Cs,cumsum:As,denseBincount:Ns,depthToSpace:Is,depthwiseConv2d:$s,diag:Rs,dilation2d:Os,div:wi,divNoNan:Fs,dot:zs,einsum:Bs,elu:Us,equal:Ps,erf:Vs,euclideanNorm:oo,exp:ao,expandDims:lo,expm1:co,eye:ho,fill:ps,floor:po,floorDiv:xi,gather:fo,greater:mo,greaterEqual:go,imag:Er,isFinite:yo,isInf:bo,isNaN:vo,leakyRelu:xo,less:wo,lessEqual:So,linspace:_o,localResponseNormalization:ko,log:To,log1p:Eo,logSigmoid:Io,logSoftmax:Ro,logSumExp:Oo,logicalAnd:Po,logicalNot:Lo,logicalOr:Do,logicalXor:Fo,lowerBound:Bo,matMul:gr,max:Zs,maxPool:Uo,maxPool3d:Vo,maxPoolWithArgmax:jo,maximum:Wo,mean:Ho,meshgrid:Xo,min:Js,minimum:Yo,mirrorPad:Ko,mod:Zo,moments:Jo,mul:Si,multiRNNCell:Qo,multinomial:ta,neg:Mr,notEqual:ea,oneHot:yr,ones:qo,onesLike:na,outerProduct:ra,pad:ia,pad1d:sa,pad2d:oa,pad3d:aa,pad4d:la,pool:ua,pow:Qs,prelu:ha,print:Zn,prod:da,raggedGather:pa,raggedTensorToTensor:fa,rand:ma,randomGamma:La,randomNormal:Da,randomStandardNormal:Fa,randomUniform:za,range:Ba,real:Cr,reciprocal:Ua,relu:Va,relu6:ja,reshape:Ki,reverse:Wa,reverse1d:Ha,reverse2d:Ga,reverse3d:qa,reverse4d:Xa,round:Ya,rsqrt:Ka,scalar:to,selu:Za,separableConv2d:Ja,setdiff1dAsync:Qa,sigmoid:ts,sign:tl,sin:el,sinh:nl,slice:es,slice1d:rl,slice2d:il,slice3d:sl,slice4d:ol,softmax:al,softplus:No,spaceToBatchND:ca,fft:ll,ifft:cl,irfft:ul,rfft:dl,split:hl,sqrt:eo,square:no,squaredDifference:pl,squeeze:fl,stack:ml,step:gl,stridedSlice:yl,sub:$o,sum:ro,tan:bl,tanh:ns,tensor:rn,tensor1d:vl,tensor2d:xl,tensor3d:Lr,tensor4d:wl,tensor5d:Sl,tensor6d:_l,tile:uo,topk:kl,truncatedNormal:Tl,unique:El,unsortedSegmentSum:Ml,unstack:Cl,upperBound:Al,variable:Nl,where:Ls,whereAsync:$l,zeros:Go,zerosLike:Ds,op:tn,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:Rl,transpose:Ar,norm:so,movingAverage:Ol,scatterND:Pl,searchSorted:zo,sparseToDense:Ll,gatherND:Dl,dropout:Fl,enclosingPowerOfTwo:zl,cosineWindow:Bl,inTopKAsync:Ul,image:Kc,linalg:Zc,losses:Jc,spectral:Xc,fused:Jl,signal:Yc,sparse:Qc,string:tu});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wY(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){c(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const i=t[r],s=e[r];c(i<0||s<0||i===s,(()=>n+` Shapes ${t} and ${e} must match`))}}}function SY(t){return"number"!=typeof t&&!t.some((t=>t<0))}function _Y(t,e,n){let r=kY(t,n);const i=!SY(r);if(i&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(i&&e.forEach((t=>{r=kY(t.shape,r)})),!SY(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function kY(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const i=t[r],s=e[r];if(i>=0&&s>=0&&i!==s)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=i>=0?i:s}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TY{constructor(t,e,n,r,i,s,o){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=to(0),Sr(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),wY(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,Sr(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return rn([],[0].concat(this.elementShape));const n=this.readMany(t);return wY(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),ml(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return rn([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return wY(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Qi(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,Cl(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:e.size/n,s=[];xr((()=>{e=Ki(e,[1,n,i]);for(let n=0;n<t.length;++n){const o=[0,0===n?0:r[n-1],0],a=[1,t[n],i];s[n]=Ki(es(e,o,a),this.elementShape)}return s}));const o=[];for(let e=0;e<t.length;e++)o[e]=e;this.writeMany(o,s)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EY{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);wY(e,t.shape,"TensorList shape mismatch: "),Sr(t)})),this.idTensor=to(0),this.maxNumElements=r,Sr(this.idTensor)}get id(){return this.idTensor.id}copy(){return new EY([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);wY(t,this.elementShape,"TensorList shape mismatch: ");const r=_Y(this.elementShape,this.tensors,t);return xr((()=>{const t=this.tensors.map((t=>Ki(t,r)));return ml(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=_Y(this.elementShape,this.tensors,t),r=this.tensors.pop();return r.kept=!1,wY(r.shape,t,"TensorList shape mismatch: "),Ki(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(wY(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Sr(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new EY([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);wY(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=_Y(this.elementShape,this.tensors,e);return Ki(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);wY(this.elementShape,e.shape,"TensorList shape mismatch: "),Sr(e),null!=this.tensors[t]&&(this.tensors[t].kept=!1),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);wY(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=_Y(this.elementShape,this.tensors,n);return 0===t.length?rn([],[0].concat(r)):xr((()=>{const e=t.map((t=>Ki(this.tensors[t],r)));return ml(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);wY(this.elementShape,e,"TensorList shape mismatch: ");const n=_Y(this.elementShape,this.tensors,e);return 0===this.size()?rn([],[0].concat(n)):xr((()=>{const t=this.tensors.map((t=>Ki(t,n)));return Qi(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const MY=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=$X("thenBranch",t,e,n),i=$X("elseBranch",t,e,n),s=$X("cond",t,e,n),o=$X("args",t,e,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=$X("body",t,e,n),i=$X("cond",t,e,n),s=$X("args",t,e,n),o=await n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),a=s.map((t=>t.id));let l=await o[0].data();o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=s;for(;l[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const s=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await s[0].data(),s.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[FX($X("pred",t,e,n))];case"Switch":{const r=$X("pred",t,e,n);let i=$X("data",t,e,n);return i.kept||(i=FX(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==RX(t,e,n)));if(r){return[FX(RX(r,e,n))]}return}case"Enter":{const r=$X("frameName",t,e,n),i=$X("tensor",t,e,n);return n.enterFrame(r),[FX(i)]}case"Exit":{const r=$X("tensor",t,e,n);return n.exitFrame(),[FX(r)]}case"NextIteration":{const r=$X("tensor",t,e,n);return n.nextIteration(),[FX(r)]}case"TensorArrayV3":{const r=$X("size",t,e,n),i=$X("dtype",t,e,n),s=$X("elementShape",t,e,n),o=$X("dynamicSize",t,e,n),a=$X("clearAfterRead",t,e,n),l=$X("identicalElementShapes",t,e,n),c=$X("name",t,e,n),u=new TY(c,i,r,s,l,o,a);return n.addTensorArray(u),[u.idTensor,to(1)]}case"TensorArrayWriteV3":{const r=$X("tensorArrayId",t,e,n),i=$X("index",t,e,n),s=$X("tensor",t,e,n),o=n.getTensorArray(r.id);return o.write(i,s),[o.idTensor]}case"TensorArrayReadV3":{const r=$X("tensorArrayId",t,e,n),i=$X("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=$X("tensorArrayId",t,e,n),i=$X("indices",t,e,n),s=$X("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,s)]}case"TensorArrayScatterV3":{const r=$X("tensorArrayId",t,e,n),i=$X("indices",t,e,n),s=$X("tensor",t,e,n),o=n.getTensorArray(r.id);return o.scatter(i,s),[o.idTensor]}case"TensorArrayConcatV3":{const r=$X("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),s=$X("dtype",t,e,n);return[i.concat(s)]}case"TensorArraySplitV3":{const r=$X("tensorArrayId",t,e,n),i=$X("tensor",t,e,n),s=$X("lengths",t,e,n),o=n.getTensorArray(r.id);return o.split(s,i),[o.idTensor]}case"TensorArraySizeV3":{const r=$X("tensorArrayId",t,e,n);return[to(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=$X("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=$X("tensorListId",t,e,n),i=$X("index",t,e,n),s=$X("tensor",t,e,n),o=n.getTensorList(r.id);return o.setItem(i,s),[o.idTensor]}case"TensorListGetItem":{const r=$X("tensorListId",t,e,n),i=$X("index",t,e,n),s=$X("elementShape",t,e,n),o=$X("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=$X("indices",t,e,n),i=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const s=new EY([],n,t.dtype,r),o=Cl(t,0);return e.forEach(((t,e)=>{s.setItem(t,o[e])})),s}($X("tensor",t,e,n),r,$X("elementShape",t,e,n),$X("numElements",t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=$X("elementShape",t,e,n),i=$X("elementDType",t,e,n);let s;s="TensorListReserve"===t.op?"numElements":"maxNumElements";const o=$X(s,t,e,n),a=function(t,e,n,r){return new EY([],t,e,r)}(r,i,0,"TensorListReserve"===t.op?-1:o);return n.addTensorList(a),[a.idTensor]}case"TensorListGather":{const r=$X("tensorListId",t,e,n),i=$X("indices",t,e,n),s=$X("elementShape",t,e,n),o=$X("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,o,s)]}case"TensorListStack":{const r=$X("tensorListId",t,e,n),i=$X("elementShape",t,e,n),s=$X("elementDType",t,e,n),o=$X("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,s,o)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);wY(t.shape.slice(1),e,"TensorList shape mismatch: ");const i=Cl(t);return new EY(i,e,r)}($X("tensor",t,e,n),$X("elementShape",t,e,n),$X("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=$X("tensorListId",t,e,n),i=n.getTensorList(r.id),s=$X("dtype",t,e,n),o=$X("elementShape",t,e,n);return[i.concat(s,o)]}case"TensorListPushBack":{const r=$X("tensorListId",t,e,n),i=$X("tensor",t,e,n),s=n.getTensorList(r.id);return s.pushBack(i),[s.idTensor]}case"TensorListPopBack":{const r=$X("tensorListId",t,e,n),i=$X("elementShape",t,e,n),s=$X("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,s)]}case"TensorListSplit":{const r=$X("tensor",t,e,n),i=$X("elementShape",t,e,n),s=function(t,e,n){let r=0;const i=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const s=kY(t.shape.slice(1),n),o=0===r?0:t.size/r,a=xr((()=>{const n=[];t=Ki(t,[1,r,o]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:i[r-1],0],l=[1,e[r],o];n[r]=Ki(es(t,a,l),s)}return t.dispose(),n})),l=new EY([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)l.setItem(t,a[t]);return l}(r,$X("lengths",t,e,n),i);return n.addTensorList(s),[s.idTensor]}case"TensorListLength":{const r=$X("tensorListId",t,e,n);return[to(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=$X("tensorListId",t,e,n),i=$X("size",t,e,n),s=n.getTensorList(r.id).resize(i);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(t,e,n){const[r,i]=$X("fusedOps",t,e,n),s="biasadd"===r,o=!s,a="prelu"===i,l="fusedbatchnorm"===r,c=$X("numArgs",t,e,n);if(s){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&s&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=$X("strides",t,e,n),h=DX(t,e,n),d=$X("dataFormat",t,e,n).toUpperCase(),p=$X("dilations",t,e,n);let[f,m]=$X("args",t,e,n);o&&(m=f,f=void 0);return{stride:u,pad:h,dataFormat:d,dilations:p,biasArg:f,preluArg:m,activationFunc:i,leakyreluAlpha:$X("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AY(t,e,n){return{boxes:$X("boxes",t,e,n),scores:$X("scores",t,e,n),maxOutputSize:$X("maxOutputSize",t,e,n),iouThreshold:$X("iouThreshold",t,e,n),scoreThreshold:$X("scoreThreshold",t,e,n),softNmsSigma:$X("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class NY{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=to(0),this.tensorMap=new Map,Sr(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return to(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),xr((()=>{const t=Cl(e),r=n.length,i=t.length;c(r===i,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${i} elements.`));for(let e=0;e<r;e++){const r=n[e],i=t[e];Sr(i),this.tensorMap.set(r,i)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return xr((()=>{const t=[];for(let r=0;r<n.length;r++){const i=n[r],s=this.findWithDefault(i,e);t.push(s)}return ml(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IY(t,e,n,r,i=xr){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[r.add($X("a",t,e,n),$X("b",t,e,n))];case"AddN":return[r.addN($X("tensors",t,e,n))];case"FloorMod":case"Mod":return[r.mod($X("a",t,e,n),$X("b",t,e,n))];case"Mul":return[r.mul($X("a",t,e,n),$X("b",t,e,n))];case"RealDiv":case"Div":return[r.div($X("a",t,e,n),$X("b",t,e,n))];case"DivNoNan":return[r.divNoNan($X("a",t,e,n),$X("b",t,e,n))];case"FloorDiv":return[r.floorDiv($X("a",t,e,n),$X("b",t,e,n))];case"Sub":return[r.sub($X("a",t,e,n),$X("b",t,e,n))];case"Minimum":return[r.minimum($X("a",t,e,n),$X("b",t,e,n))];case"Maximum":return[r.maximum($X("a",t,e,n),$X("b",t,e,n))];case"Pow":return[r.pow($X("a",t,e,n),$X("b",t,e,n))];case"SquaredDifference":return[r.squaredDifference($X("a",t,e,n),$X("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Abs":case"ComplexAbs":return[r.abs($X("x",t,e,n))];case"Acos":return[r.acos($X("x",t,e,n))];case"Acosh":return[r.acosh($X("x",t,e,n))];case"Asin":return[r.asin($X("x",t,e,n))];case"Asinh":return[r.asinh($X("x",t,e,n))];case"Atan":return[r.atan($X("x",t,e,n))];case"Atan2":return[r.atan2($X("x",t,e,n),$X("y",t,e,n))];case"Atanh":return[r.atanh($X("x",t,e,n))];case"Ceil":return[r.ceil($X("x",t,e,n))];case"Complex":return[r.complex($X("real",t,e,n),$X("imag",t,e,n))];case"Cos":return[r.cos($X("x",t,e,n))];case"Cosh":return[r.cosh($X("x",t,e,n))];case"Elu":return[r.elu($X("x",t,e,n))];case"Erf":return[r.erf($X("x",t,e,n))];case"Exp":return[r.exp($X("x",t,e,n))];case"Expm1":return[r.expm1($X("x",t,e,n))];case"Floor":return[r.floor($X("x",t,e,n))];case"Log":return[r.log($X("x",t,e,n))];case"Log1p":return[r.log1p($X("x",t,e,n))];case"Imag":return[r.imag($X("x",t,e,n))];case"Neg":return[r.neg($X("x",t,e,n))];case"Reciprocal":return[r.reciprocal($X("x",t,e,n))];case"Real":return[r.real($X("x",t,e,n))];case"Relu":return[r.relu($X("x",t,e,n))];case"Round":return[r.round($X("x",t,e,n))];case"Selu":return[r.selu($X("x",t,e,n))];case"Sigmoid":return[r.sigmoid($X("x",t,e,n))];case"Sin":return[r.sin($X("x",t,e,n))];case"Sign":return[r.sign($X("x",t,e,n))];case"Sinh":return[r.sinh($X("x",t,e,n))];case"Softplus":return[r.softplus($X("x",t,e,n))];case"Sqrt":return[r.sqrt($X("x",t,e,n))];case"Square":return[r.square($X("x",t,e,n))];case"Tanh":return[r.tanh($X("x",t,e,n))];case"Tan":return[r.tan($X("x",t,e,n))];case"ClipByValue":return[r.clipByValue($X("x",t,e,n),$X("clipValueMin",t,e,n),$X("clipValueMax",t,e,n))];case"Relu6":return[r.relu6($X("x",t,e,n))];case"Rsqrt":return[r.rsqrt(RX(t.inputNames[0],e,n))];case"Prod":return[r.prod($X("x",t,e,n),$X("axes",t,e,n))];case"LeakyRelu":return[r.leakyRelu($X("x",t,e,n),$X("alpha",t,e,n))];case"Prelu":return[r.prelu($X("x",t,e,n),$X("alpha",t,e,n))];case"IsNan":return[r.isNaN(RX(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return MY(t,e,n);case"convolution":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Conv1D":{const i=$X("stride",t,e,n),s=$X("pad",t,e,n),o=$X("dataFormat",t,e,n).toUpperCase(),a=$X("dilation",t,e,n);return[r.conv1d($X("x",t,e,n),$X("filter",t,e,n),i,s,o,a)]}case"Conv2D":{const i=$X("strides",t,e,n),s=DX(t,e,n),o=$X("dataFormat",t,e,n).toUpperCase(),a=$X("dilations",t,e,n);return[r.conv2d($X("x",t,e,n),$X("filter",t,e,n),[i[1],i[2]],s,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:i,pad:s,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=CY(t,e,n);return[r.fused.conv2d({x:$X("x",t,e,n),filter:$X("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:s,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=CY(t,e,n);return[r.fused.depthwiseConv2d({x:$X("x",t,e,n),filter:$X("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=$X("outputShape",t,e,n),s=$X("strides",t,e,n),o=DX(t,e,n);return[r.conv2dTranspose($X("x",t,e,n),$X("filter",t,e,n),i,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=$X("strides",t,e,n),s=DX(t,e,n),o=$X("dilations",t,e,n),a=$X("dataFormat",t,e,n).toUpperCase();return[r.depthwiseConv2d($X("input",t,e,n),$X("filter",t,e,n),[i[1],i[2]],s,a,[o[1],o[2]])]}case"Conv3D":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("dataFormat",t,e,n).toUpperCase(),a=$X("dilations",t,e,n);return[r.conv3d($X("x",t,e,n),$X("filter",t,e,n),[i[1],i[2],i[3]],s,o,[a[1],a[2],a[3]])]}case"AvgPool":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("kernelSize",t,e,n);return[r.avgPool($X("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s)]}case"MaxPool":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("kernelSize",t,e,n);return[r.maxPool($X("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s)]}case"MaxPoolWithArgmax":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("kernelSize",t,e,n),a=$X("includeBatchInIndex",t,e,n),{result:l,indexes:c}=r.maxPoolWithArgmax($X("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s,a);return[l,c]}case"AvgPool3D":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("kernelSize",t,e,n);return[r.avgPool3d($X("x",t,e,n),[o[1],o[2],o[3]],[i[1],i[2],i[3]],s)]}case"MaxPool3D":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("kernelSize",t,e,n);return[r.maxPool3d($X("x",t,e,n),[o[1],o[2],o[3]],[i[1],i[2],i[3]],s)]}case"Dilation2D":{const i=$X("strides",t,e,n),s=$X("pad",t,e,n),o=$X("dilations",t,e,n),a=i[1],l=i[2],c=o[1],u=o[2];return[r.dilation2d($X("x",t,e,n),$X("filter",t,e,n),[a,l],s,[c,u],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Fill":{const i=$X("shape",t,e,n),s=$X("dtype",t,e,n),o=$X("value",t,e,n);return[r.fill(i,o,s)]}case"LinSpace":{const i=$X("start",t,e,n),s=$X("stop",t,e,n),o=$X("num",t,e,n);return[r.linspace(i,s,o)]}case"Multinomial":{const i=$X("logits",t,e,n),s=$X("numSamples",t,e,n),o=$X("seed",t,e,n);return[r.multinomial(i,s,o)]}case"OneHot":{const i=$X("indices",t,e,n),s=$X("depth",t,e,n),o=$X("onValue",t,e,n),a=$X("offValue",t,e,n),l=$X("dtype",t,e,n);return[r.oneHot(i,s,o,a,l)]}case"Ones":return[r.ones($X("shape",t,e,n),$X("dtype",t,e,n))];case"OnesLike":return[r.onesLike($X("x",t,e,n))];case"RandomStandardNormal":return[r.randomStandardNormal($X("shape",t,e,n),$X("dtype",t,e,n),$X("seed",t,e,n))];case"RandomUniform":return[r.randomUniform($X("shape",t,e,n),$X("minval",t,e,n),$X("maxval",t,e,n),$X("dtype",t,e,n))];case"Range":{const i=$X("start",t,e,n),s=$X("stop",t,e,n),o=$X("step",t,e,n);return[r.range(i,s,o,$X("dtype",t,e,n))]}case"TruncatedNormal":{const i=$X("shape",t,e,n),s=$X("mean",t,e,n),o=$X("stdDev",t,e,n),a=$X("seed",t,e,n);return[r.truncatedNormal(i,s,o,$X("dtype",t,e,n),a)]}case"Zeros":return[r.zeros($X("shape",t,e,n),$X("dtype",t,e,n))];case"ZerosLike":return[r.zerosLike($X("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n,r,i=xY)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=AY(t,e,n),u=await i.image.nonMaxSuppressionWithScoreAsync(r,s,o,a,l,c);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=AY(t,e,n),c=$X("padToMaxOutputSize",t,e,n),u=await i.image.nonMaxSuppressionPaddedAsync(r,s,o,a,l,c);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=AY(t,e,n);return[await i.image.nonMaxSuppressionAsync(r,s,o,a,l)]}case"Where":{const r=i.cast($X("condition",t,e,n),"bool"),s=[await i.whereAsync(r)];return r.dispose(),s}case"ListDiff":return i.setdiff1dAsync($X("x",t,e,n),$X("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"LowerBound":{const i=$X("sortedSequence",t,e,n),s=$X("values",t,e,n);return[r.lowerBound(i,s)]}case"TopKV2":{const i=$X("x",t,e,n),s=$X("k",t,e,n),o=$X("sorted",t,e,n),a=r.topk(i,s,o);return[a.values,a.indices]}case"UpperBound":{const i=$X("sortedSequence",t,e,n),s=$X("values",t,e,n);return[r.upperBound(i,s)]}case"Unique":{const i=$X("x",t,e,n),s=r.unique(i);return[s.values,s.indices]}case"UniqueV2":{const i=$X("x",t,e,n),s=$X("axis",t,e,n),o=r.unique(i,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"ResizeBilinear":{const i=$X("images",t,e,n),s=$X("size",t,e,n),o=$X("alignCorners",t,e,n),a=$X("halfPixelCenters",t,e,n);return[r.image.resizeBilinear(i,[s[0],s[1]],o,a)]}case"ResizeNearestNeighbor":{const i=$X("images",t,e,n),s=$X("size",t,e,n),o=$X("alignCorners",t,e,n),a=$X("halfPixelCenters",t,e,n);return[r.image.resizeNearestNeighbor(i,[s[0],s[1]],o,a)]}case"CropAndResize":{const i=$X("image",t,e,n),s=$X("boxes",t,e,n),o=$X("boxInd",t,e,n),a=$X("cropSize",t,e,n),l=$X("method",t,e,n),c=$X("extrapolationValue",t,e,n);return[r.image.cropAndResize(i,s,o,a,l,c)]}case"ImageProjectiveTransformV3":{const i=$X("images",t,e,n),s=$X("transforms",t,e,n),o=$X("outputShape",t,e,n),a=$X("fillValue",t,e,n),l=$X("interpolation",t,e,n),c=$X("fillMode",t,e,n);return[r.image.transform(i,s,l.toLowerCase(),c.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const i=$X("default",t,e,n);return[RX(t.name,e,n)||i];case"Placeholder":return[RX(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[FX($X("x",t,e,n))];case"IdentityN":return $X("x",t,e,n).map((t=>FX(t)));case"Shape":return[r.tensor1d($X("x",t,e,n).shape,"int32")];case"ShapeN":return $X("x",t,e,n).map((t=>r.tensor1d(t.shape)));case"Size":return[r.scalar($X("x",t,e,n).size,"int32")];case"Rank":return[r.scalar($X("x",t,e,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const s=$X("x",t,e,n),o=$X("data",t,e,n),a=$X("message",t,e,n),l=$X("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,l));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Equal":return[r.equal($X("a",t,e,n),$X("b",t,e,n))];case"NotEqual":return[r.notEqual($X("a",t,e,n),$X("b",t,e,n))];case"Greater":return[r.greater($X("a",t,e,n),$X("b",t,e,n))];case"GreaterEqual":return[r.greaterEqual($X("a",t,e,n),$X("b",t,e,n))];case"Less":return[r.less($X("a",t,e,n),$X("b",t,e,n))];case"LessEqual":return[r.lessEqual($X("a",t,e,n),$X("b",t,e,n))];case"LogicalAnd":return[r.logicalAnd($X("a",t,e,n),$X("b",t,e,n))];case"LogicalNot":return[r.logicalNot($X("a",t,e,n))];case"LogicalOr":return[r.logicalOr($X("a",t,e,n),$X("b",t,e,n))];case"Select":case"SelectV2":return[r.where($X("condition",t,e,n),$X("a",t,e,n),$X("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul($X("a",t,e,n),$X("b",t,e,n),$X("transposeA",t,e,n),$X("transposeB",t,e,n))];case"Einsum":return[r.einsum($X("equation",t,e,n),...$X("tensors",t,e,n))];case"Transpose":return[r.transpose($X("x",t,e,n),$X("perm",t,e,n))];case"_FusedMatMul":const[i,s]=$X("fusedOps",t,e,n),o="biasadd"===i,a="prelu"===s,l=$X("numArgs",t,e,n),c=$X("leakyreluAlpha",t,e,n);if(o){if(a&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,h]=$X("args",t,e,n);return[r.fused.matMul({a:$X("a",t,e,n),b:$X("b",t,e,n),transposeA:$X("transposeA",t,e,n),transposeB:$X("transposeB",t,e,n),bias:u,activation:s,preluActivationWeights:h,leakyreluAlpha:c})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"EuclideanNorm":return[r.euclideanNorm($X("x",t,e,n),$X("axis",t,e,n),$X("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm($X("x",t,e,n),$X("mean",t,e,n),$X("variance",t,e,n),$X("offset",t,e,n),$X("scale",t,e,n),$X("epsilon",t,e,n))];case"LRN":return[r.localResponseNormalization($X("x",t,e,n),$X("radius",t,e,n),$X("bias",t,e,n),$X("alpha",t,e,n),$X("beta",t,e,n))];case"Softmax":return[r.softmax($X("x",t,e,n))];case"LogSoftmax":return[r.logSoftmax($X("x",t,e,n))];case"SparseToDense":return[r.sparseToDense($X("sparseIndices",t,e,n),$X("outputShape",t,e,n),$X("sparseValues",t,e,n),$X("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Max":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.max($X("x",t,e,n),i,s)]}case"Mean":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.mean($X("x",t,e,n),i,s)]}case"Min":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.min($X("x",t,e,n),i,s)]}case"Sum":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.sum($X("x",t,e,n),i,s)]}case"All":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.all($X("x",t,e,n),i,s)]}case"Any":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.any($X("x",t,e,n),i,s)]}case"ArgMax":{const i=$X("axis",t,e,n);return[r.argMax($X("x",t,e,n),i)]}case"ArgMin":{const i=$X("axis",t,e,n);return[r.argMin($X("x",t,e,n),i)]}case"Prod":{const i=$X("axis",t,e,n),s=$X("keepDims",t,e,n);return[r.prod($X("x",t,e,n),i,s)]}case"Cumprod":{const i=$X("axis",t,e,n),s=$X("exclusive",t,e,n),o=$X("reverse",t,e,n);return[r.cumprod($X("x",t,e,n),i,s,o)]}case"Cumsum":{const i=$X("axis",t,e,n),s=$X("exclusive",t,e,n),o=$X("reverse",t,e,n);return[r.cumsum($X("x",t,e,n),i,s,o)]}case"Bincount":const i=$X("x",t,e,n),s=$X("weights",t,e,n),o=$X("size",t,e,n);return[r.bincount(i,s,o)];case"DenseBincount":{const i=$X("x",t,e,n),s=$X("weights",t,e,n),o=$X("size",t,e,n),a=$X("binaryOutput",t,e,n);return[r.denseBincount(i,s,o,a)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"ConcatV2":case"Concat":{const i=$X("n",t,e,n),s=$X("axis",t,e,n);let o=$X("tensors",t,e,n);return o=o.slice(0,i),[r.concat(o,s)]}case"Gather":{const i=$X("x",t,e,n),s=$X("indices",t,e,n);return[r.gather(i,r.cast(s,"int32"),0)]}case"GatherV2":{const i=$X("axis",t,e,n),s=$X("batchDims",t,e,n),o=$X("x",t,e,n),a=$X("indices",t,e,n);return[r.gather(o,r.cast(a,"int32"),i,s)]}case"Reverse":{const i=$X("dims",t,e,n),s=[];for(let t=0;t<i.length;t++)i[t]&&s.push(t);const o=$X("x",t,e,n);return[r.reverse(o,s)]}case"ReverseV2":{const i=$X("axis",t,e,n),s=$X("x",t,e,n);return[r.reverse(s,i)]}case"Slice":{const i=$X("begin",t,e,n),s=$X("size",t,e,n);return[r.slice($X("x",t,e,n),i,s)]}case"StridedSlice":{const i=$X("begin",t,e,n),s=$X("end",t,e,n),o=$X("strides",t,e,n),a=$X("beginMask",t,e,n),l=$X("endMask",t,e,n),c=$X("ellipsisMask",t,e,n),u=$X("newAxisMask",t,e,n),h=$X("shrinkAxisMask",t,e,n),d=$X("x",t,e,n);return[r.stridedSlice(d,i,s,o,a,l,c,u,h)]}case"Pack":return xr((()=>{const i=$X("axis",t,e,n),s=$X("tensors",t,e,n),o=s[0].shape,a=r.squeeze(s[0]).shape,l=s.map((t=>{const e=f(t.shape,o);if(!e&&!f(r.squeeze(t).shape,a))throw new Error("the input tensors shape does not match");return e?t:r.reshape(t,o)}));return[r.stack(l,i)]}));case"Unpack":{const i=$X("axis",t,e,n),s=$X("tensor",t,e,n);return r.unstack(s,i)}case"Tile":{const i=$X("reps",t,e,n);return[r.tile($X("x",t,e,n),i)]}case"Split":case"SplitV":{const i=$X("axis",t,e,n),s=$X("numOrSizeSplits",t,e,n),o=$X("x",t,e,n);return r.split(o,s,i)}case"ScatterNd":{const i=$X("indices",t,e,n),s=$X("values",t,e,n),o=$X("shape",t,e,n);return[r.scatterND(i,s,o)]}case"GatherNd":{const i=$X("x",t,e,n),s=$X("indices",t,e,n);return[r.gatherND(i,s)]}case"SparseToDense":{const i=$X("sparseIndices",t,e,n),s=$X("outputShape",t,e,n),o=$X("sparseValues",t,e,n),a=$X("defaultValue",t,e,n);return[r.sparseToDense(i,o,s,o.dtype===a.dtype?a:r.cast(a,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:s,emptyRowIndicator:o,reverseIndexMap:a}=r.sparse.sparseFillEmptyRows($X("indices",t,e,n),$X("values",t,e,n),$X("denseShape",t,e,n),$X("defaultValue",t,e,n));return[i,s,o,a]}case"SparseReshape":{const{outputIndices:i,outputShape:s}=r.sparse.sparseReshape($X("inputIndices",t,e,n),$X("inputShape",t,e,n),$X("newShape",t,e,n));return[i,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean($X("data",t,e,n),$X("indices",t,e,n),$X("segmentIds",t,e,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum($X("data",t,e,n),$X("indices",t,e,n),$X("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"FFT":return[r.fft($X("x",t,e,n))];case"IFFT":return[r.ifft($X("x",t,e,n))];case"RFFT":return[r.rfft($X("x",t,e,n))];case"IRFFT":return[r.irfft($X("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"StringNGrams":{const{nGrams:i,nGramsSplits:s}=r.string.stringNGrams($X("data",t,e,n),$X("dataSplits",t,e,n),$X("separator",t,e,n),$X("nGramWidths",t,e,n),$X("leftPad",t,e,n),$X("rightPad",t,e,n),$X("padWidth",t,e,n),$X("preserveShortSequences",t,e,n));return[i,s]}case"StringSplit":{const{indices:i,values:s,shape:o}=r.string.stringSplit($X("input",t,e,n),$X("delimiter",t,e,n),$X("skipEmpty",t,e,n));return[i,s,o]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast($X("input",t,e,n),$X("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return i((()=>((t,e,n,r=xY)=>{switch(t.op){case"Cast":return[r.cast($X("x",t,e,n),$X("dtype",t,e,n))];case"ExpandDims":{const i=$X("axis",t,e,n);return[r.expandDims($X("x",t,e,n),i)]}case"Squeeze":{const i=$X("axis",t,e,n);return[r.squeeze($X("x",t,e,n),i)]}case"Reshape":return[r.reshape($X("x",t,e,n),$X("shape",t,e,n))];case"MirrorPad":return[r.mirrorPad($X("x",t,e,n),$X("padding",t,e,n),$X("mode",t,e,n))];case"PadV2":case"Pad":return[r.pad($X("x",t,e,n),$X("padding",t,e,n),$X("constantValue",t,e,n))];case"SpaceToBatchND":{const i=$X("blockShape",t,e,n),s=$X("paddings",t,e,n);return[r.spaceToBatchND($X("x",t,e,n),i,s)]}case"BatchToSpaceND":{const i=$X("blockShape",t,e,n),s=$X("crops",t,e,n);return[r.batchToSpaceND($X("x",t,e,n),i,s)]}case"DepthToSpace":{const i=$X("blockSize",t,e,n),s=$X("dataFormat",t,e,n).toUpperCase();return[r.depthToSpace($X("x",t,e,n),i,s)]}case"BroadcastTo":return[r.broadcastTo($X("x",t,e,n),$X("shape",t,e,n))];case"BroadcastArgs":return[r.broadcastArgs($X("s0",t,e,n),$X("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=$X("keyDType",t,e,n),s=$X("valueDType",t,e,n),o=new NY(i,s);return r.addHashTable(t.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=$X("tableHandle",t,e,n,r),s=$X("keys",t,e,n),o=$X("values",t,e,n),a=r.getHashTableById(i.id);return[await a.import(s,o)]}case"LookupTableFind":case"LookupTableFindV2":{const i=$X("tableHandle",t,e,n,r),s=$X("keys",t,e,n),o=$X("defaultValue",t,e,n),a=r.getHashTableById(i.id);return[await a.find(s,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=$X("tableHandle",t,e,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=IX(t.op);if(s&&s.customExecutor)return s.customExecutor(new vY(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return H(s)?s.then((t=>[].concat(t))):[].concat(s)}class $Y{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(t,e,n,r){const i=new Set,s=[];let o=null,a=null;const l=new Set,c=Object.keys(t).map((t=>LX(t)[0]));let u=[];null!=r&&(u=r.map((t=>LX(t.name)[0])));const h=[...e];for(;h.length>0;){const t=h.pop();(DY(t)||FY(t)||zY(t))&&null==o&&(o=t,a=o.children.map((t=>t.name)).filter((t=>i.has(t)))),i.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===u.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{l.has(t.name)||(l.add(t.name),h.push(t))})):s.push(t.name)))}return{inputs:t,outputs:e,usedNodes:i,missingInputs:s,dynamicNode:o,syncInputs:a}}const OY=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],PY=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],LY=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function DY(t){return OY.indexOf(t.op)>=0}function FY(t){return PY.indexOf(t.op)>=0}function zY(t){return LY.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BY{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new BY(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=RY(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:s}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(r.length>0){const n=e.map((t=>t.name)),i=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:i}=n,s=[],o=Object.keys(i).map((t=>LX(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;o.forEach((t=>{r.has(t.name)&&s.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&s.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&s.push(t)}));const l=new Set,c=[];for(;s.length>0;){const t=s.pop();l.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!l.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>l.has(t.name)))&&s.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[LX(t)[0]])),i=e.map((t=>LX(t)[0]));let s=i.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let a=this.compiledMap.get(o);null==a&&(a=this.compile(t,s),this.compiledMap.set(o,a));const l={},c={};return xr((()=>{const n=new $Y(this.weightMap,l,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,i]=LX(e),s=[];s[i]=t[e],r[n]=s}));const s=this.getFrozenTensorIds(r),o={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=IY(e,r,n,this._resourceManager);if(H(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,s,i,o)}}return null==this.parent&&n.dispose(s),e.map((t=>RX(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,i,s,o){"control"!==e.category&&-1===s.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(o[t.id]=(o[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const s=function(t,e,n){return e[PX(t,n.currentContextId)]}(t.name,n,r);null!=s&&s.forEach((t=>{if(t&&!t.kept&&!i.has(t.id)){const n=o[t.id];if(1===n){if(this.keepTensorForDebug){const[n,i]=OX(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][i]=t}else t.dispose();delete o[t.id]}else null!=n&&o[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},i={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=X().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const s=new $Y(this.weightMap,r,i,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,s,e,n);const o=e.map((t=>RX(t,this.tensorsMap,s))),a=o.map((t=>t.id)),l=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...l,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&s.dispose(this.keepIds),o}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const i=Object.keys(t),s=i.map((t=>this.graph.nodes[LX(t)[0]])),o=n.map((t=>LX(t)[0]));let a=o.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:l,missingInputs:c,dynamicNode:u,syncInputs:h}=RY(t,a,this.weightMap,this._initNodes),d=[...s,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=LX(e),i=[];i[r]=t[e],p[n]=i}));const f={},m=this.getFrozenTensorIds(p),g={};for(;d.length>0;){const t=this.processStack(s,d,e,p,g,m,o,f,l);await Promise.all(t)}null!=u||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=a.filter((t=>!DY(t)&&!RX(t.name,p,e))).map((t=>t.name));if(y.length>0){let t="";throw null!=u&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${y}] from the provided inputs [${i}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,i,s,o,a,l){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let u="";if("Enter"===t.node.op&&$X("isConstant",t.node,r,n)&&([u]=OX(t.node.name,n)),null==r[t.node.name]){const h=IY(t.node,r,n,this._resourceManager);u||([u]=OX(t.node.name,n));const d=n.currentContext;H(h)?c.push(h.then((c=>(r[u]=c,n.currentContext=d,this.checkTensorForDisposal(u,t.node,r,n,s,o,a),this.processChildNodes(t.node,e,n,r,i,l),c)))):(r[u]=h,this.checkTensorForDisposal(u,t.node,r,n,s,o,a),this.processChildNodes(t.node,e,n,r,i,l))}else this.processChildNodes(t.node,e,n,r,i,l)}return c}processChildNodes(t,e,n,r,i,s){t.children.forEach((t=>{const[o]=OX(t.name,n);!i[o]&&s.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!RX(t,r,n)))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!RX(t,r,n)))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=LX(e),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const t=i.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));c(e,(()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}i.attrParams.dtype&&i.attrParams.dtype.value&&c(n.dtype===i.attrParams.dtype.value,(()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=LX(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=LX(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class UY{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VY{constructor(t,e={},n=mr){this.modelUrl=t,this.loadOptions=e,this.version="n/a",this.io=n,null==e&&(this.loadOptions={}),this.resourceManager=new UY}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{const e=this.io.getLoadHandlers(t,this.loadOptions);if(0===e.length)e.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return H(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const t=this.artifacts.userDefinedMetadata;null!=t.signature&&(n=t.signature),null!=t.structuredOutputKeys&&(this.structuredOutputKeys=t.structuredOutputKeys)}this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new BY(iY.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=iY.Instance.transformGraph(t.modelInitializer);this.initializer=new BY(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=this.io.getSaveHandlers(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){const n=this.execute(t,this.outputNodes);if(this.structuredOutputKeys){const t={};return(n instanceof we?[n]:n).forEach(((e,n)=>t[this.structuredOutputKeys[n]]=e)),t}return n}normalizeInputs(t){if(!(t instanceof we||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function jY(t,e={},n=mr){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const r=new VY(t,e,n);return await r.load(),r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var WY=Object.freeze({__proto__:null,GraphModel:VY,loadGraphModel:jY,loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[n,r]=t;if(!n)throw new Error("modelJSON must be the first element of the array");if(!(r&&r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");e=pr(fn(n,yn(n.weightsManifest),r))}else if("load"in t)e=t;else{if(!("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t))throw new Error("Unknown model format");e=pr(t)}const n=new VY(e);return n.load(),n},deregisterOp:function(t){delete NX[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};NX[t]=n},version_converter:"3.21.0"});
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class HY extends Error{constructor(t){super(t),Object.setPrototypeOf(this,HY.prototype)}}class GY extends Error{constructor(t){super(t),Object.setPrototypeOf(this,GY.prototype)}}class qY extends Error{constructor(t){super(t),Object.setPrototypeOf(this,qY.prototype)}}class XY extends Error{constructor(t){super(t),Object.setPrototypeOf(this,XY.prototype)}}class YY extends Error{constructor(t){super(t),Object.setPrototypeOf(this,YY.prototype)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KY{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const t=this.cache.keys().next().value;this.cache.delete(t)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const t=this.cache.keys().next().value;this.cache.delete(t)}this.maxEntries=t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ZY(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function JY(t,e){if(!t)throw new YY(e)}function QY(t,e){let n=0;for(const r of t)r===e&&n++;return n}function tK(t){return 1===t.length?t[0]:t}function eK(t){return Array.isArray(t)?t:[t]}function nK(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function rK(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let iK={};function sK(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function oK(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>oK(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?oK(e):t[n]=e.value)}}}function aK(t,e={},n={},r="object",i=!1){if("string"==typeof t){const i=t;let s;if(i in n)s=n[i];else if(i in iK)s=iK[i];else if(s=e[i],null==s)throw new qY(`Unknown ${r}: ${t}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new qY(`${r}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const o=s.className;let a,l;if(o in n?[a,l]=n[o]:o in iK?[a,l]=iK.className:o in e&&([a,l]=e[o]),null==a)throw new qY(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const t={};for(const e of Object.keys(iK))t[e]=iK[e];for(const e of Object.keys(n))t[e]=n[e];s.config.customObjects=t;const e=Object.assign({},iK);for(const t of Object.keys(n))iK[t]=n[t];oK(s.config);const r=l(a,s.config,n,i);return iK=Object.assign({},e),r}{const t=Object.assign({},iK);for(const t of Object.keys(n))iK[t]=n[t];const e=new a(s.config);return iK=Object.assign({},t),e}}}function lK(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function cK(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function uK(t){if(null==t)throw new qY(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function hK(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new qY(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function dK(t,e,n=0,r=1/0){return JY(n>=0),JY(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((t=>typeof t===e))}function pK(t,e){Array.isArray(t)?(c(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>pK(t,`element ${n+1} of ${e}`)))):c(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${fK(t)}.`))}function fK(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>fK(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function mK(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let gK=0;function yK(){return gK++}const bK={};function vK(t=""){return t in bK||(bK[t]=0),bK[t]+=1,t+bK[t].toString()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xK=["channelsFirst","channelsLast"],wK=["nearest","bilinear"],SK=["valid","same","causal"],_K=["max","avg"],kK=["sum","mul","concat","ave"],TK=new Map;function EK(t){hK(xK,"DataFormat",t)}function MK(t){hK(SK,"PaddingMode",t)}function CK(t){hK(_K,"PoolMode",t)}const AK=[];function NK(t,e){AK.push(t);try{const t=e();return AK.pop(),t}catch(t){throw AK.pop(),t}}function IK(t){if(!OK(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===AK.length?"":AK.join("/")+"/")+t}function $K(t){if(!OK(t))throw new Error("Not a valid tensor name: '"+t+"'");TK.has(t)||TK.set(t,0);const e=TK.get(t);if(TK.set(t,TK.get(t)+1),e>0){const n=`${t}_${e}`;return TK.set(n,1),n}return t}const RK=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function OK(t){return!!t.match(RK)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PK(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function LK(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function DK(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function FK(t,e){if(e<t)throw new qY(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let zK;function BK(){return null==zK&&(zK=Tr().epsilon()),zK}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function UK(t,e){return Yn(t,e)}function VK(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),Ki(t,n)}function jK(t,e,n){return xr((()=>{switch(t.rank){case 1:return rl(t,e,n);case 2:return il(t,[e,0],[n,t.shape[1]]);case 3:return sl(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return ol(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return es(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return es(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new qY(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function WK(t,e,n){return xr((()=>{switch(t.rank){case 1:return rl(t,e,n);case 2:return il(t,[0,e],[t.shape[0],n]);case 3:return sl(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return ol(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new qY(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function HK(t,e,n,r){return xr((()=>{switch(t.rank){case 1:return rl(t,e,n);case 2:switch(r){case 1:return jK(t,e,n);case 2:return WK(t,e,n);default:throw new qY(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return jK(t,e,n);case 2:return sl(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return WK(t,e,n);default:throw new qY(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return jK(t,e,n);case 2:return ol(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return ol(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return WK(t,e,n);default:throw new qY(`The axis is not within the rank of the tensor ${r}`)}default:throw new qY(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function GK(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),Qi(t,e)}function qK(t,e){switch(t.rank){case 1:return ms([t,e]);case 2:return gs([t,e],0);case 3:return ys([t,e],0);case 4:return bs([t,e],0);default:throw new qY(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function XK(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new qY(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return uo(t,e)}function YK(t,e=0,n=1,r,i){return Da(t,e,n,r,i)}function KK(t,e,n,r){if(t.rank<2||e.rank<2)throw new XY(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){if(t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new XY(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){return Zl({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?QK(t.rank,r,"channelsLast"):null,activation:n})}{const i=t.shape.slice(),s=i.pop();t=Ki(t,[-1,s]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=Ki(Ar(e,u),[l,-1]);const h=[...i,...c];return Ki(Zl({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?QK(t.rank,r,"channelsLast"):null,activation:n}),h)}}function ZK(t,e,n){return xr((()=>(e=Array.isArray(e)?vl(e,"int32"):Yn(e,"int32"),fo(t,e,n))))}function JK(t){return Si(t,t)}function QK(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new qY(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===r.length?Ki(e,[1,r[0],1,1,1]):Ki(e,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Ki(e,[1,1,1,1,r[0]]):Ki(e,[1].concat(r))}else if(4===t){if("channelsFirst"===n)return 1===r.length?Ki(e,[1,r[0],1,1]):Ki(e,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Ki(e,[1,1,1,r[0]]):Ki(e,[1].concat(r))}else if(3===t){if("channelsFirst"===n)return 1===r.length?Ki(e,[1,r[0],1]):Ki(e,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Ki(e,[1,1,r[0]]):Ki(e,[1].concat(r))}else if(t<3)return e;throw new qY(`Unsupported input rank by biasAdd: ${e.rank}`)}function tZ(t,e,n){return xr((()=>(null==n&&(n="channelsLast"),EK(n),vi(t,QK(t.rank,e,n)))))}function eZ(t,e,n,r){return xr((()=>Fl(t,e,n,r)))}function nZ(t,e,n=!1){return n?t():e()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rZ=["fanIn","fanOut","fanAvg"],iZ=["normal","uniform","truncatedNormal"];class sZ extends hi{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class oZ extends sZ{apply(t,e){return Go(t,e)}}oZ.className="Zeros",pi(oZ);class aZ extends sZ{apply(t,e){return qo(t,e)}}aZ.className="Ones",pi(aZ);class lZ extends sZ{constructor(t){if(super(),"object"!=typeof t)throw new qY(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new qY(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return xr((()=>Si(to(this.value),qo(t,e))))}getConfig(){return{value:this.value}}}lZ.className="Constant",pi(lZ);class cZ extends sZ{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return za(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}cZ.className="RandomUniform",pi(cZ);class uZ extends sZ{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new XY(`randomNormal does not support dType ${e}.`);return YK(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}uZ.className="RandomNormal",pi(uZ);class hZ extends sZ{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new XY(`truncatedNormal does not support dType ${e}.`);return Tl(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}hZ.className="TruncatedNormal",pi(hZ);class dZ extends sZ{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return xr((()=>{if(2!==t.length||t[0]!==t[1])throw new qY("Identity matrix initializer can only be used for 2D square matrices.");return Si(this.gain,ho(t[0]))}))}getConfig(){return{gain:this.gain}}}dZ.className="Identity",pi(dZ);class pZ extends sZ{constructor(t){if(super(),t.scale<0)throw new qY(`scale must be a positive float. Got: ${t.scale}`);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,hK(rZ,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){hK(iZ,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,r;if(EK(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=PK(t,2);n=t[1]*e,r=t[0]*e}else if("channelsLast"===e){const e=PK(t,0,t.length-2);n=t[t.length-2]*e,r=t[t.length-1]*e}}else{const e=PK(t);n=Math.sqrt(e),r=Math.sqrt(e)}return[n,r]}(t),r=n[0],i=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,r):"fanOut"===this.mode?s/=Math.max(1,i):s/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new XY(`${this.getClassName()} does not support dType ${e}.`);return Tl(t,0,n,e,this.seed)}{const n=Math.sqrt(3*s);return za(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}pZ.className="VarianceScaling",pi(pZ);class fZ extends pZ{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}fZ.className="GlorotUniform",pi(fZ);class mZ extends pZ{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}mZ.className="GlorotNormal",pi(mZ);class gZ extends pZ{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}gZ.className="HeNormal",pi(gZ);class yZ extends pZ{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}yZ.className="HeUniform",pi(yZ);class bZ extends pZ{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}bZ.className="LeCunNormal",pi(bZ);class vZ extends pZ{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return pZ.className}}vZ.className="LeCunNormal",pi(vZ);class xZ extends sZ{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new XY("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return xr((()=>{if(t.length<2)throw new XY("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=YK(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32");let n=Zc.gramSchmidt(e);return t[0]>t[1]&&(n=Ar(n)),Si(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}xZ.className="Orthogonal",pi(xZ);const wZ={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function SZ(t,e={}){return aK(t,di.getMap().classNameMap,e,"initializer")}function _Z(t){return sK(t)}function kZ(t){if("string"==typeof t){const e=t in wZ?wZ[t]:t;if("GlorotNormal"===e)return new mZ;if("GlorotUniform"===e)return new fZ;if("HeNormal"===e)return new gZ;if("HeUniform"===e)return new yZ;if("LeCunNormal"===e)return new bZ;if("LeCunUniform"===e)return new vZ;{const t={};return t.className=e,t.config={},SZ(t)}}return t instanceof sZ?t:SZ(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TZ(t){return Array.isArray(t)&&Array.isArray(t[0])}function EZ(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function MZ(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new qY(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function CZ(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return t[0];throw new qY(`Expected exactly 1 Shape; got ${t.length}`)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AZ(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NZ{constructor(t,e="float32",n="Variable",r=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=yK(),n=null==n?"Variable":n,this.originalName=IK(n),this.name=$K(this.originalName),this.trainable_=r,this.constraint=i,this.val=Nl(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function IZ(t){return t.map((t=>t.read()))}function $Z(t){t.forEach((t=>{t[0].write(t[1])}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class RZ{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class OZ{constructor(t,e,n,r,i,s,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=yK(),null!=s&&(this.originalName=IK(s),this.name=$K(this.originalName)),this.rank=e.length}}let PZ=0;class LZ{constructor(t,e){this.callArgs=e,this.id=PZ++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const e of t.inboundLayers)null!=e&&e.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let DZ=0;class FZ extends hi{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=DZ++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=nK(t)+"_"+vK(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new GY(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new qY(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return tK(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return tK(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new HY(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new HY(`Layer ${this.name} is not connected, no input to return.`);return tK(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new HY(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new HY(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return tK(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=eK(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=eK(this.inputSpec);if(t.length!==e.length)throw new qY(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(null==i)continue;const s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new qY(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new qY(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new qY(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new qY(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const t=r.shape;for(const e in i.axes){const r=Number(e),s=i.axes[e],o=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(o))throw new qY(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],s=r.shape[t];if(null!=e&&null!=s&&e!==s)throw new qY(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=eK(t);let r=!0;for(const t of n)if(!(t instanceof OZ)){r=!1;break}let i=!0;for(const t of n)if(t instanceof OZ){i=!1;break}if(r===i)throw new qY("Arguments to apply() must be all SymbolicTensors or all Tensors");return NK(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of eK(t))e.push(n.shape);this.build(tK(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let r=this.call(t,e);const i=eK(r),s=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(r=tK(s),null!=this.activityRegularizer)throw new XY("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(t){t=eK(t);const e=[];for(const n of t)e.push(n.shape);return tK(e)}(t),r=this.computeOutputShape(n);let i;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new OZ(s,n,this,eK(t),e,this.name,r))):new OZ(s,r,this,eK(t),e,this.name),this.addInboundNode(t,i,null,null,n,r,e),this._refCount++,null!=this.activityRegularizer)throw new XY("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new HY(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new HY(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new GY(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return AZ(this.weights)}build(t){this.built=!0}getWeights(t=!1){return IZ(t?this.trainableWeights:this.weights)}setWeights(t){xr((()=>{const e=this.weights;if(e.length!==t.length)throw new qY(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],r=IZ(e);for(let i=0;i<r.length;++i){const s=r[i],o=e[i],a=t[i];if(!f(s.shape,a.shape))throw new qY(`Layer weight shape ${s.shape} not compatible with provided weight shape ${a.shape}`);n.push([o,a])}$Z(n)}))}addWeight(t,e,n,r,i,s,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new qY(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=a?a():kZ("zeros"));const l=r.apply(e,n),c=new NZ(l,n,t,s,o);return l.dispose(),null!=i&&this.addLoss((()=>i.apply(c.read()))),null==s&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=eK(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,r,i,s,o=null){const a=eK(t);e=eK(e),n=eK(n),r=eK(r),i=EZ(i),s=EZ(s);const l=[],c=[],u=[];for(const t of a)l.push(t.sourceLayer),c.push(t.nodeIndex),u.push(t.tensorIndex);new LZ({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},o);for(let t=0;t<e.length;t++)e[t].sourceLayer=this,e[t].nodeIndex=this.inboundNodes.length-1,e[t].tensorIndex=t}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function zZ(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const r=zZ(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of r)-1===e.indexOf(t)&&e.push(t)}return e}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BZ extends FZ{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:vK("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new qY("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new qY("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new qY("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const r=new OZ(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new LZ({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new qY(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}BZ.className="InputLayer",pi(BZ);class UZ{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof UZ)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new qY(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return Yn(e,t.dtype)}catch(n){throw new qY(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof OZ){if(null==this.id2Value[t.id])throw new qY(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new qY(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof OZ){if(null==this.id2Value[t.id])throw new qY(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new qY(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&wr(this.id2Mask)}}const VZ=new KY,jZ=new KY;function WZ(t,e,n,r){const i=null!=n&&n.training,s=Array.isArray(t),o=s?t:[t],a=o.map((t=>t.name)),l=[],u=e.names();for(const t of a)-1!==u.indexOf(t)?l.push(e.getValue(t)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const h=a.join(",")+"|"+e.names().sort().join(",");let d,p=VZ.get(h);if(null==p){const t=function(t,e){c(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===t.length){const i=GZ(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:t,recipientMap:o}=GZ(s,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:HZ(r)}}(o,e);p=t.sorted,d=t.recipientCounts,VZ.put(h,p),jZ.put(h,d)}d={},i||Object.assign(d,jZ.get(h));const f=new UZ(e);for(let t=0;t<p.length;++t){if(null!=r){const t=vr().numTensors;t>r.maxNumTensors&&(r.maxNumTensors=t),t<r.minNumTensors&&(r.minNumTensors=t)}const s=p[t],o=s.sourceLayer;if(o instanceof BZ)continue;const c=[],u=[],h=[];let m=!1;for(const t of s.inputs){const n=f.getValue(t),r=f.getMask(t);c.push(n),u.push(r),null!=r&&(m=!0),i||(d[t.name]--,0!==d[t.name]||e.hasKey(t)||-1!==a.indexOf(t.name)||n.isDisposed||!0===t.sourceLayer.stateful||h.push(n))}m&&((n=n||{}).mask=u[0]);const g=eK(o.apply(c,n));let y=null;o.supportsMasking&&(y=o.computeMask(c,u));const b=qZ(s),v=Array.isArray(b)?b:[b];for(let t=0;t<v.length;++t){f.hasKey(v[t])||f.add(v[t],g[t],Array.isArray(y)?y[0]:y);const e=a.indexOf(v[t].name);-1!==e&&(l[e]=g[t])}i||wr(h)}return f.disposeMasks(),s?l:l[0]}function HZ(t){const e={};for(const n in t)e[n]=t[n].size;return e}function GZ(t,e){const n=new Set,r=[],i={};for(const t of e.names())n.add(t);const s=[],o=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=o[o.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),r.push(t),n.add(t.name),e&&o.pop();else{o.push(s.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:r,recipientMap:i}}function qZ(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const r of t.sourceLayer.inboundNodes[e].outputTensors)if(r.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */X().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(t){null!=VZ&&VZ.setMaxEntries(t),null!=jZ&&jZ.setMaxEntries(t)}));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const XZ={kernelName:"Abs",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,gl(Yn(n,"float32"),-1))}}},YZ={kernelName:"Acos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=no(Yn(n,"float32")),r=eo($o(to(1),e));return Mr(wi(t,r))}}}},KZ={kernelName:"Acosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=eo($o(no(Yn(n,"float32")),1));return wi(t,e)}}}},ZZ={kernelName:"Add",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{let e=t;const r=Rr(n.shape,i);return r.length>0&&(e=ro(e,r)),Ki(e,n.shape)},b:()=>{let e=t;const n=Rr(r.shape,i);return n.length>0&&(e=ro(e,n)),Ki(e,r.shape)}}}},JZ={kernelName:"AddN",saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,r)=>{n[r]=()=>t.clone()})),n}},QZ={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ds(n)}}},tJ={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ds(n)}}},eJ={kernelName:"Asin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,eo($o(to(1),no(Yn(n,"float32")))))}}},nJ={kernelName:"Asinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=eo(vi(to(1),no(Yn(n,"float32"))));return wi(t,e)}}}},rJ={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{const e=vi(no(n),no(r));let s=Si(t,wi(r,e));const o=Rr(n.shape,i);return o.length>0&&(s=ro(s,o)),Ki(s,n.shape)},b:()=>{const e=vi(no(n),no(r));let s=Mr(Si(t,wi(n,e)));const o=Rr(r.shape,i);return o.length>0&&(s=ro(s,o)),Ki(s,r.shape)}}}},iJ={kernelName:"Atan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,vi(no(Yn(n,"float32")),1))}}},sJ={kernelName:"Atanh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,$o(to(1),no(Yn(n,"float32"))))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ=tn({avgPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s){const o=Je(t,"dy","avgPool3dGrad"),a=Je(e,"input","avgPool3dGrad");let l=o,u=a,h=!1;4===a.rank&&(h=!0,l=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),c(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),c(5===u.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`)),Yi("avgPool3dGrad",i,s);const d={dy:l,input:u},p={filterSize:n,strides:r,pad:i,dimRoundingMode:s},f=Ve.runKernel("AvgPool3DGrad",d,p);return h?Ki(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),aJ={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>oJ(t,r,i,s,o,a)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=tn({avgPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i){const s=Je(t,"dy","avgPoolGrad"),o=Je(e,"input","avgPoolGrad");c(o.rank===s.rank,(()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`));let a=o,l=s,u=!1;3===o.rank&&(u=!0,a=Ki(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=Ki(s,[1,s.shape[0],s.shape[1],s.shape[2]])),c(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),c(4===a.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`));const h={dy:l,input:a},d={filterSize:n,strides:r,pad:i},p=Ve.runKernel("AvgPoolGrad",h,d);return u?Ki(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),cJ={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o}=n;return{x:()=>lJ(t,r,i,s,o)}}},uJ={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:o}=n;return s||o?!s&&o?{a:()=>gr(t,i,!1,!1),b:()=>gr(t,r,!0,!1)}:s&&!o?{a:()=>gr(i,t,!1,!0),b:()=>gr(r,t,!1,!1)}:{a:()=>gr(i,t,!0,!0),b:()=>gr(t,r,!0,!0)}:{a:()=>gr(t,i,!1,!0),b:()=>gr(r,t,!0,!1)}}},hJ={kernelName:"BatchToSpaceND",gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>ca(t,r,i)}}},dJ={kernelName:"BroadcastTo",gradFunc:(t,e,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let t=i.length-1;t>=0;t--)if(i[t]===s[t])o[t]=1;else if(1!==i[t])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let t=0;t<o.length;t++)o[t]>1&&a.push(t);return{x:()=>ro(t,a,!0)}}},pJ={kernelName:"Cast",gradFunc:t=>({x:()=>t.clone()})},fJ={kernelName:"Ceil",gradFunc:t=>({x:()=>Ds(t)})},mJ={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Ls(Po(go(r,i),So(r,s)),t,Ds(t))}}},gJ={kernelName:"ComplexAbs",inputsToSave:["x"],gradFunc:XZ.gradFunc},yJ={kernelName:"Concat",saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map((t=>t.shape)),{axis:i}=n,s=x(i,e[0].shape)[0],o=r.map((t=>t[s]));return hl(t,o,s).map((t=>()=>t))}},bJ={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:o,pad:a,dataFormat:l}=n;return c(Gi(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>ws(r.shape,t,i,o,a,l),filter:()=>Vl(r,t,i.shape,o,a,l)}}},vJ={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>vs(t,i,s,o,a,1,l),filter:()=>Vl(t,r,i.shape,s,o,a,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ=tn({conv3DBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i){let s=t;4===t.rank&&(s=Ki(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;4===o.rank&&(o=Ki(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),c(5===s.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`)),c(5===o.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`)),c(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),c(s.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`)),c(o.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`));const a={x:s,dy:o},l={strides:r,pad:i,filterShape:n};return Ve.runKernel("Conv3DBackpropFilterV2",a,l)}}),wJ={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;c(Gi(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[o,a]=e;return{x:()=>ks(o.shape,t,a,i,s),filter:()=>xJ(o,t,a.shape,i,s)}}},SJ={kernelName:Q,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(Mr(el(Yn(n,"float32"))),t)}}},_J={kernelName:"Cosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(nl(Yn(n,"float32")),t)}}},kJ={kernelName:"Cumsum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const e=Xs([i],r.rank);let n=As(t,i,s,!o);return null!=e&&(n=Ar(n,e)),n}}}},TJ={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=null==r?[1,1]:r;c(Gi(a),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[l,u]=e;return c(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`)),c(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`)),c(l.shape[3]===u.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),c(qi(i,a),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`)),Yi("depthwiseConv2d",s,o),{x:()=>Yl(l.shape,t,u,i,s,a,o),filter:()=>Xl(l,t,u.shape,i,s,a,o)}}},EJ={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},o={x:r,filter:i,dy:t};return{x:()=>Ve.runKernel("Dilation2DBackpropInput",s,n),filter:()=>Ve.runKernel("Dilation2DBackpropFilter",o,n)}}},MJ={kernelName:"Elu",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>Ve.runKernel("EluGrad",r)}}},CJ={kernelName:tt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Si(ao(Mr(no(n))),2/Math.sqrt(Math.PI));return{x:()=>Si(t,r)}}},AJ={kernelName:et,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,n)}}},NJ={kernelName:"ExpandDims",inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>Ki(t,n.shape)}}},IJ={kernelName:"Expm1",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,ao(n))}}},$J={kernelName:"Floor",gradFunc:t=>({x:()=>Ds(t)})},RJ={kernelName:"FloorDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{const e=wi(t,Yn(r,"float32")),s=Rr(n.shape,i);return s.length>0?Ki(ro(e,s),n.shape):e},b:()=>{let e=Si(t,Yn(n,"float32"));const s=Rr(r.shape,i);s.length>0&&(e=Ki(ro(e,s),r.shape));const o=no(r);return Mr(wi(e,Yn(o,"float32")))}}}},OJ={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=e,l=null==a?to(1):a,c=Rr(s.shape,i.shape),u=[];if(1===s.rank){for(let t=0;t<i.shape.length-1;++t)u.push(i.shape[t]);u.push(1)}const h=$o(i,s),d=Si(t,l),p=Ka(vi(o,to(r))),f=Si(Si(Si(p,p),p),to(-.5));return{x:()=>1===s.rank?Ki(Si(Si(t,uo(Ki(p,[1,1,1,s.shape[0]]),u)),l),i.shape):Ki(Si(Si(t,p),l),i.shape),mean:()=>{let t=Si(Si(p,to(-1)),d);return 1===s.rank&&(t=ro(t,c)),Ki(t,s.shape)},variance:()=>{let t=Si(Si(f,h),d);return 1===s.rank&&(t=ro(t,c)),Ki(t,s.shape)},scale:()=>{const e=Si(h,p);let n=Si(t,e);return 1===s.rank&&(n=ro(n,c)),Ki(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=ro(e,c)),Ki(e,s.shape)}}}},PJ={kernelName:"GatherV2",inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,o=x(s,r.shape)[0];return{x:()=>{const e=r.shape,n=i.size,a=e.slice(0,o),l=a.length,c=e.slice(s,e.length).slice(1),u=c.length,h=LJ(0,l),d=LJ(l+1,l+1+u),p=DJ([a,[n],c]),f=Ki(t,p),m=Ki(i,[n]),g=DJ([[l],h,d]),y=Ar(f,g);let b=Ml(y,m,r.shape[o]);const v=Ys(g);return b=Ar(b,v),b},indices:()=>i}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function DJ(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Ds(n),b:()=>Ds(r)}}},zJ={kernelName:"Identity",gradFunc:t=>({x:()=>Yn(t,"float32")})},BJ={kernelName:"IsFinite",gradFunc:t=>({x:()=>Ds(t)})},UJ={kernelName:"IsInf",gradFunc:t=>({x:()=>Ds(t)})},VJ={kernelName:"IsNan",gradFunc:t=>({x:()=>Ds(t)})},jJ={kernelName:"LeakyRelu",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:i}=n,s=mo(r,0);return{x:()=>Ls(s,t,Si(t,i))}}},WJ={kernelName:"Log1p",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,vi(n,1))}}},HJ={kernelName:nt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,Yn(n,"float32"))}}},GJ={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const e=ao(r);return $o(t,Si(ro(t,i,!0),e))}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qJ=tn({localResponseNormalizationBackprop_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=5,i=1,s=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:r,bias:i,alpha:s,beta:o};return Ve.runKernel("LRNGrad",a,l)}}),XJ={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:o,alpha:a,beta:l}=n;return{x:()=>qJ(r,i,t,s,o,a,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YJ(t,e,n,r){return e.rank<n.rank&&(e=Ki(e,Gs(e.shape,r))),t.rank<n.rank&&(t=Ki(t,Gs(t.shape,r))),{x:()=>Si(t,Yn(Ps(n,e),t.dtype))}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,s=e[0],o=YJ(t,e[1],s,x(i,s.shape));return{x:()=>o.x()}}},ZJ={kernelName:"Maximum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Si(t,Yn(go(n,r),"float32")),b:()=>Si(t,Yn(wo(n,r),"float32"))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ=tn({maxPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s,o){const a=Je(t,"dy","maxPool3dGrad"),l=Je(e,"input","maxPool3dGrad"),u=Je(n,"output","maxPool3dGrad");let h=a,d=l,p=u,f=!1;4===l.rank&&(f=!0,h=Ki(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=Ki(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=Ki(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),c(5===h.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`)),c(5===d.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`)),c(5===p.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`)),Yi("maxPool3dGrad",s,o);const m={dy:h,input:d,output:p},g={filterSize:r,strides:i,pad:s,dimRoundingMode:o},y=Ve.runKernel("MaxPool3DGrad",m,g);return f?Ki(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),QJ={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>JJ(t,r,i,s,o,a,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tQ=tn({maxPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,i,s,o){const a=Je(t,"dy","maxPoolGrad"),l=Je(e,"input","maxPoolGrad"),u=Je(n,"output","maxPoolGrad");c(l.rank===a.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`)),c(4===a.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`)),c(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),Yi("maxPoolGrad",s,o);const h={dy:a,input:l,output:u},d={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return Ve.runKernel("MaxPoolGrad",h,d)}}),eQ={kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>tQ(t,r,i,s,o,a)}}},nQ={kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,o]=e,a=YJ(t,o,s,x(i,s.shape));return{x:()=>a.x()}}},rQ={kernelName:"MirrorPad",inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>es(t,s,r.shape)}}},iQ={kernelName:"Pack",saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return Cl(t,r).map((t=>()=>t))}},sQ={kernelName:"PadV2",inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>es(t,s,r.shape)}}},oQ={kernelName:it,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,o=r,a=Or(s.shape,o.shape);return{a:()=>{const e=Yn(o,"float32");let n=Si(t,Si(e,Qs(s,$o(e,to(1)))));const r=Rr(s.shape,a);return r.length>0&&(n=ro(n,r)),Ki(n,s.shape)},b:()=>{const e=mo(s,0),n=Ls(e,To(s),Ds(s));let r=Si(t,Si(i,n));const l=Rr(o.shape,a);return l.length>0&&(r=ro(r,l)),Ki(r,o.shape)}}}},aQ={kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=mo(n,0);return{x:()=>Ls(i,t,Si(t,r)),alpha:()=>{let e=Ls(i,Ds(t),Si(t,n));const s=Rr(r.shape,t.shape);return s.length>0&&(e=ro(e,s)),Ki(e,r.shape)}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(t,e,n){const r=t.shape.length,i=r-n.length,s=Xs(n,r);let o=t;null!=s&&(o=Ar(t,s));const a=o.shape.slice(),l=a.splice(r-n.length,n.length).reduce(((t,e)=>t*e),1);a.push(l);let c=
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=t.shape.slice();r[n]=1;const i=Ki(e,r),s=Cs(t,n,!0,!1),o=Cs(t,n,!0,!0),a=Si(s,o);return Si(i,a)}(o.reshape(a),e,i);if(c=c.reshape(o.shape),null!=s){const t=Ys(s);c=Ar(c,t)}return c}const cQ={kernelName:"Prod",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;let s=[];return s=null==i?r.shape.map(((t,e)=>e)):"number"==typeof i?[i]:i,{x:()=>lQ(r,t,s)}}},uQ={kernelName:"RealDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{const e=wi(t,Yn(r,"float32")),s=Rr(n.shape,i);return s.length>0?Ki(ro(e,s),n.shape):e},b:()=>{let e=Si(t,Yn(n,"float32"));const s=Rr(r.shape,i);s.length>0&&(e=Ki(ro(e,s),r.shape));const o=no(r);return Mr(wi(e,Yn(o,"float32")))}}}},hQ={kernelName:"Selu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=mo(n,to(0)),r=to(1.7580993408473768),i=to(Mu),s=Si(t,i),o=Si(Si(t,r),ao(Yn(n,"float32")));return Ls(e,s,o)}}}},dQ={kernelName:"Sigmoid",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,Si(n,$o(to(1),n)))}}},pQ={kernelName:"Slice",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,o=r.shape,[a,l]=ai(r,i,s),c=[];for(let e=0;e<t.rank;e++)c.push([a[e],o[e]-a[e]-l[e]]);return{x:()=>ia(t,c)}}},fQ={kernelName:"Softmax",outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=Si(t,r);return{logits:()=>$o(s,Si(ro(s,[i],true),r))}}},mQ={kernelName:"SpaceToBatchND",gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>is(t,r,i)}}},gQ={kernelName:"SplitV",gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>Qi(t,r)}}},yQ={kernelName:"Tanh",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si($o(to(1),no(n)),t)}}},bQ={kernelName:"Tile",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let e=Ds(r);if(1===r.rank)for(let n=0;n<i[0];++n)e=vi(e,es(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)e=vi(e,es(t,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)e=vi(e,es(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)for(let a=0;a<i[3];++a)e=vi(e,es(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2],a*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},vQ={kernelName:"UnsortedSegmentSum",inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=Wo(e,Ds(e)),r=fo(t,n);let i=go(e,to(0,"int32"));const s=r.rank-i.rank;for(let t=0;t<s;++t)i=lo(i,t+1);i=Po(i,qo(r.shape,"bool"));const o=Ds(r);return Ls(i,r,o)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,n)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xQ=[XZ,YZ,KZ,ZZ,JZ,QZ,tJ,eJ,nJ,rJ,iJ,sJ,aJ,cJ,uJ,hJ,dJ,pJ,fJ,mJ,gJ,yJ,vJ,bJ,wJ,SJ,_J,kJ,TJ,EJ,uQ,MJ,CJ,AJ,NJ,IJ,RJ,$J,OJ,PJ,FJ,zJ,BJ,UJ,VJ,jJ,WJ,HJ,GJ,XJ,KJ,KJ,ZJ,QJ,eQ,{kernelName:"Mean",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n,s=x(i,r.shape),o=p(Hs(r.shape,s)[1]);return{x:()=>{const e=r.shape.slice();s.forEach((t=>{e[t]=1}));const n=Ki(t,e);return wi(Si(n,qo(r.shape,"float32")),o)}}}},nQ,{kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Si(t,Yn(So(n,r),"float32")),b:()=>Si(t,Yn(mo(n,r),"float32"))}}},rQ,{kernelName:rt,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{const e=Rr(n.shape,i);return e.length>0?Ki(ro(t,e),n.shape):t},b:()=>{const e=Si(t,Mr(po(wi(n,r)))),s=Rr(r.shape,i);return s.length>0?Ki(ro(e,s),r.shape):e}}}},{kernelName:"Multiply",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{const e=Si(t,Yn(r,"float32")),s=Rr(n.shape,i);return s.length>0?Ki(ro(e,s),n.shape):e},b:()=>{const e=Si(t,Yn(n,"float32")),s=Rr(r.shape,i);return s.length>0?Ki(ro(e,s),r.shape):e}}}},{kernelName:"Neg",gradFunc:t=>({x:()=>Mr(t)})},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Go(n.shape,"float32")}}},{kernelName:"OnesLike",gradFunc:t=>({x:()=>Ds(t)})},iQ,sQ,sQ,oQ,aQ,cQ,{kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,Mr(no(n)))}}},{kernelName:"Relu6",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Si(So(n,6),gl(n));return{x:()=>Si(t,Yn(r,"float32"))}}},{kernelName:"Relu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,Yn(gl(n),"float32"))}}},{kernelName:"Reshape",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ki(t,n.shape)}}},{kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Ve.runKernel("ResizeBilinearGrad",i,n)}}},{kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Ve.runKernel("ResizeNearestNeighborGrad",i,n)}}},{kernelName:"Reverse",gradFunc:(t,e,n)=>{const{dims:r}=n,i=x(r,t.shape);return{x:()=>Wa(t,i)}}},{kernelName:"Round",gradFunc:t=>({x:()=>Ds(t)})},{kernelName:"Rsqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Mr(wi(t,Si(Qs(n,1.5),2)))}}},{kernelName:"Select",inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Yn(Ds(n),"float32"),t:()=>Si(t,Yn(n,t.dtype)),e:()=>Si(t,Yn(Lo(n),t.dtype))}}},hQ,dQ,{kernelName:"Sign",gradFunc:t=>({x:()=>Ds(t)})},{kernelName:st,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(Es(Yn(n,"float32")),t)}}},{kernelName:"Sinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(Ms(Yn(n,"float32")),t)}}},pQ,fQ,{kernelName:"Softplus",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,ts(n))}}},mQ,mQ,gQ,gQ,{kernelName:"Sqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,Si(eo(Yn(n,"float32")),2))}}},{kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=to(2);return{a:()=>Si(t,Si(i,$o(n,r))),b:()=>Si(t,Si(i,$o(r,n)))}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Si(t,Si(Yn(n,"float32"),2))}}},{kernelName:"Step",gradFunc:t=>({x:()=>Ds(t)})},{kernelName:ot,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Or(n.shape,r.shape);return{a:()=>{let e=t;const r=Rr(n.shape,i);return r.length>0&&(e=ro(e,r)),Ki(e,n.shape)},b:()=>{let e=t;const n=Rr(r.shape,i);return n.length>0&&(e=ro(e,n)),Ki(Mr(e),r.shape)}}}},{kernelName:"Sum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;x(s,r.shape).forEach((t=>{i[t]=1}));const o=Ki(t,i),a=Si(o,qo(r.shape,"float32"));return{x:()=>a}}},{kernelName:at,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>wi(t,no(Es(n)))}}},yQ,bQ,{kernelName:"Transpose",gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=Ys(i);return{x:()=>Ar(t,s)}}},{kernelName:"Unpack",gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>ml(t,i)}}},vQ,{kernelName:"ZerosLike",gradFunc:t=>({x:()=>Ds(t)})}];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of xQ)mt(t);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wQ(t,e){return xr((()=>eo(ro(Si(t,t),e,!0))))}class SQ extends hi{getConfig(){return{}}}class _Q extends SQ{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return xr((()=>{const e=wQ(t,this.axis),n=fs(e,0,this.maxValue);return Si(t,wi(n,vi(BK(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}_Q.className="MaxNorm",pi(_Q);class kQ extends SQ{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return xr((()=>wi(t,vi(BK(),wQ(t,this.axis)))))}getConfig(){return{axis:this.axis}}}kQ.className="UnitNorm",pi(kQ);class TQ extends SQ{apply(t){return Va(t)}}TQ.className="NonNeg",pi(TQ);class EQ extends SQ{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return xr((()=>{const e=wQ(t,this.axis),n=vi(Si(this.rate,fs(e,this.minValue,this.maxValue)),Si(1-this.rate,e));return Si(t,wi(n,vi(BK(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}EQ.className="MinMaxNorm",pi(EQ);const MQ={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function CQ(t){return sK(t)}function AQ(t,e={}){return aK(t,di.getMap().classNameMap,e,"constraint")}function NQ(t){if(null==t)return null;if("string"==typeof t){return AQ({className:t in MQ?MQ[t]:t,config:{}})}return t instanceof SQ?t:AQ(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function IQ(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];wr(r)}}function $Q(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var RQ;!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(RQ||(RQ={}));class OQ{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class PQ{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class LQ extends OQ{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const t in e){const r=e[t];if("number"==typeof r)this.totals.hasOwnProperty(t)||(this.totals[t]=0),this.totals[t]=this.totals[t]+r*n;else{let e;t in this.totals?e=this.totals[t]:this.totals[t]=0;const i=xr((()=>vi(this.totals[t],Si(r,n))));this.totals[t]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const t of this.params.metrics)null!=this.totals[t]&&("number"==typeof this.totals[t]?e[t]=this.totals[t]/this.seen:xr((()=>{const n=Si(wi(1,this.seen),this.totals[t]);e[t]=n,this.totals[t].dispose(),Sr(e[t])})))}}class DQ extends OQ{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const t in e)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(e[t])}async syncData(){const t=[],e=[],n=[];for(const r in this.history){const i=this.history[r];for(let s=0;s<i.length;++s)if("number"!=typeof i[s]){const o=i[s];t.push(o.data()),e.push(r),n.push(s)}}const r=await Promise.all(t);for(let t=0;t<r.length;++t){this.history[e[t]][n[t]].dispose(),this.history[e[t]][n[t]]=r[t][0]}}}class FQ extends OQ{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||du,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");$(this.yieldEvery)&&(this.maybeWait=function(t,e,n){let r,i=null!=n?n():oe();return(...s)=>{const o=null!=n?n():oe();return o-i<e||(i=o,r=t(...s)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const r=[];null!=this.yield&&(await IQ(n),r.push(this.yield(t,e,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await IQ(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await IQ(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await IQ(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await IQ(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):$(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await IQ(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await IQ(t),await this.trainEnd(t))}}function zQ(t,e){if(null==t&&(t={}),t instanceof OQ)return[t];if(Array.isArray(t)&&t[0]instanceof OQ)return t;return eK(t).map((t=>new FQ(t,e)))}class BQ{constructor(){}static registerCallbackConstructor(t,e){c(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),BQ.checkForDuplicate(e),null==BQ.constructors[t]&&(BQ.constructors[t]=[]),BQ.constructors[t].push(e)}static checkForDuplicate(t){for(const e in BQ.constructors){BQ.constructors[+e].forEach((e=>{if(e===t)throw new qY("Duplicate callback constructor.")}))}}static clear(){BQ.constructors={}}static createCallbacks(t){const e=[];for(const n in BQ.constructors){const r=+n;t>=r&&e.push(...BQ.constructors[r])}return e.map((t=>new t))}}function UQ(t,e,n,r,i,s,o,a,l){const c=new DQ,u=[new LQ,...BQ.createCallbacks(e)];null!=t&&u.push(...t),u.push(c);const h=new PQ(u);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:c}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VQ(t,e={},n=!1){return aK(t,di.getMap().classNameMap,e,"layer",n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jQ(t,e){return xr((()=>{"float32"!==t.dtype&&(t=Yn(t,"float32"));const n=ro(JK(t),e,!0),r=ps(n.shape,BK()),i=eo(Wo(n,r));return wi(t,i)}))}function WQ(t,e){return xr((()=>Ho(JK($o(e,t)),-1)))}function HQ(t,e){return xr((()=>Ho(_i($o(e,t)),-1)))}function GQ(t,e){return xr((()=>{const n=$o(t,e),r=fs(_i(t),BK(),Number.MAX_VALUE),i=_i(wi(n,r));return Si(100,Ho(i,-1))}))}function qQ(t,e,n=!1){return xr((()=>{if(n)e=al(e);else{const t=ro(e,e.shape.length-1,!0);e=wi(e,t)}return e=fs(e,BK(),1-BK()),Mr(ro(Si(Yn(t,"float32"),To(e)),e.shape.length-1))}))}function XQ(t,e,n=!1){return xr((()=>{const r=Yn(po(function(t){const e=[PK(t.shape)];return Ki(t,e)}(t)),"int32"),i=(e=fs(e,BK(),1-BK())).shape;return qQ(Ki(yr(r,i[i.length-1]),i),e,n)}))}function YQ(t,e){return xr((()=>{let n;return n=fs(e,BK(),1-BK()),n=To(wi(n,$o(1,n))),Ho(function(t,e){if(!f(t.shape,e.shape))throw new qY(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return xr((()=>{const n=Va(e),r=Mr(_i(e));return vi($o(n,Si(e,t)),Eo(ao(r)))}))}(t,n),-1)}))}function KQ(t,e){return xr((()=>{const n=jQ(t,-1),r=jQ(e,-1),i=Si(n,r);return Mr(ro(i,-1))}))}BQ.constructors={};const ZQ={meanSquaredError:WQ,meanAbsoluteError:HQ,meanAbsolutePercentageError:GQ,meanSquaredLogarithmicError:function(t,e){return xr((()=>{const n=fs(e,BK(),Number.MAX_VALUE),r=To(vi(1,n)),i=fs(t,BK(),Number.MAX_VALUE),s=To(vi(1,i));return Ho(JK($o(r,s)),-1)}))},squaredHinge:function(t,e){return xr((()=>{const n=Wo(0,$o(1,Si(t,e)));return Ho(JK(n),-1)}))},hinge:function(t,e){return xr((()=>{const n=Wo(0,$o(1,Si(t,e)));return Ho(n,-1)}))},categoricalHinge:function(t,e){return xr((()=>{const n=ro(Si(t,e),-1),r=Zs(Si($o(1,t),e),-1);return Wo(0,vi(1,$o(r,n)))}))},logcosh:function(t,e){return xr((()=>{const n=Math.log(2),r=$o(e,t),i=$o(vi(r,No(Si(-2,r))),n);return Ho(i,-1)}))},categoricalCrossentropy:qQ,sparseCategoricalCrossentropy:XQ,binaryCrossentropy:YQ,kullbackLeiblerDivergence:function(t,e){return xr((()=>{const n=fs(t,BK(),1),r=fs(e,BK(),1);return ro(Si(t,To(wi(n,r))),-1)}))},poisson:function(t,e){return xr((()=>{const n=To(vi(BK(),e));return Ho($o(e,Si(t,n)),-1)}))},cosineProximity:KQ};function JQ(t){if("string"==typeof t){if(t in ZQ)return ZQ[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new qY(e)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QQ(t,e){return xr((()=>{const n=Si(.5,na(e)),r=UK(mo(e,n),t.dtype);return Ho(Ps(t,r),-1)}))}function t0(t,e){return xr((()=>UK(Ps(Ai(t,-1),Ai(e,-1)),"float32")))}function e0(t,e){return YQ(t,e)}function n0(t,e){return t.rank===e.rank&&(t=fl(t,[t.rank-1])),(e=Ai(e,-1)).dtype!==t.dtype&&(e=Yn(e,t.dtype)),Yn(Ps(t,e),"float32")}const r0=qQ,i0=XQ,s0={binaryAccuracy:QQ,categoricalAccuracy:t0,precision:function(t,e){return xr((()=>{const n=function(t,e){return xr((()=>Yn(ro(Po(Ps(t,1),Ps(e,1))),"float32")))}(t,e),r=function(t,e){return xr((()=>Yn(ro(Po(Ps(t,0),Ps(e,1))),"float32")))}(t,e),i=vi(n,r);return Yn(Ls(mo(i,0),wi(n,i),0),"float32")}))},categoricalCrossentropy:r0,sparseCategoricalCrossentropy:i0,mse:WQ,MSE:WQ,mae:HQ,MAE:HQ,mape:GQ,MAPE:GQ,cosine:KQ};function o0(t){if("string"==typeof t&&t in s0)return s0[t];if("string"!=typeof t&&null!=t)return t;throw new qY(`Unknown metric ${t}`)}function a0(t){if(JY(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(ZQ))if(ZQ[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(s0))if(s0[n]===t){e=n;break}return void 0!==e?e:t.name}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l0(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!c0(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function c0(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!c0(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!c0(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function u0(t,e,n,r=console.log){const i=function(t){let e=!0;const n=[],r=[];for(const e in t.nodesByDepth)n.push(t.nodesByDepth[e]);for(const t of n){if(t.length>1||1===t.length&&t[0].inboundLayers.length>1){e=!1;break}r.push(...t)}if(e)for(const n of t.layers){let t=!1;for(const i of n.inboundNodes)if(-1!==r.indexOf(i)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Input Shape","Output shape","Param #"];let o;if(i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!i){s.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}r("_".repeat(e)),h0(s,n,r),r("=".repeat(e));const a=t.layers;for(let t=0;t<a.length;++t)i?d0(a[t],n,r):p0(a[t],n,o,r),r((t===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=function(t){let e;e=null!=t.collectedTrainableWeights?AZ(t.collectedTrainableWeights):AZ(t.trainableWeights);return e}(t),c=AZ(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function h0(t,e,n=console.log){let r="";for(let n=0;n<t.length;++n)n>0&&(r=r.slice(0,r.length-1)+" "),r+=t[n],r=r.slice(0,e[n]),r+=" ".repeat(e[n]-r.length);n(r)}function d0(t,e,n){let r,i;try{i=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){i="multiple"}try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}h0([`${t.name} (${t.getClassName()})`,i,r,t.countParams().toString()],e,n)}function p0(t,e,n,r){let i,s;try{s=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){s="multiple"}try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}const o=[];for(const e of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(e)))for(let t=0;t<e.inboundLayers.length;++t){const n=e.inboundLayers[t].name,r=e.nodeIndices[t],i=e.tensorIndices[t];o.push(`${n}[${r}][${i}]`)}const a=t.name,l=t.getClassName(),c=0===o.length?"":o[0];h0([`${a} (${l})`,s,i,t.countParams().toString(),c],e,r);for(let t=1;t<o.length;++t)h0(["","","","",o[t]],e,r)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function f0(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function m0(t,e){if(null===t)return null;if("string"==typeof t)return rK(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];f0(e,i,r)?n.push(r):n.push(m0(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n];if("name"===n&&"string"==typeof r)e[n]=r;else{const t=rK(n);e[t]=m0(r,t)}}return e}}function g0(t,e){if(null==t)return null;if("string"==typeof t)return nK(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];f0(e,i,r)?n.push(r):n.push(g0(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n],i=nK(n);e[i]="name"!==n&&"className"!==n||"string"!=typeof r?g0(r,n):r}return e}}
/** @license See the LICENSE file. */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class y0 extends FZ{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=vK(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],cK(this.inputs).length!==this.inputs.length)throw new qY(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);cK(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const t of this.outputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(r)}for(const t of this.inputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;JY(0===n,"input layer has >1 nodes"),JY(0===r,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(r)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e];if(!(n instanceof BZ))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${e} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const t of this.outputLayers)this.outputNames.push(t.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},r={},i={},s={},o=[],a=(t,e,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=t.sourceLayer,i=t.nodeIndex,l=t.tensorIndex);const c=r.inboundNodes[i];if(-1!==n.indexOf(c))throw new GY(`The tensor ${t.name} at layer "${r.name}" is part of a cycle.`);if(-1!==e.indexOf(c))return;this.containerNodes.add(y0.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let t=0;t<u;t++){const r=c.inputTensors[t],i=c.inboundLayers[t],s=c.nodeIndices[t],o=c.tensorIndices[t];a(r,e,n,i,s,o)}for(e.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);o.push(c)},l=[],c=[];for(const t of this.outputs)a(t,l,c);const u=o.slice().reverse();for(const t of u){n[t.id]=t,t.id in e||(e[t.id]=0);let s=e[t.id];const o=null==r[t.outboundLayer.id]?0:r[t.outboundLayer.id];s=Math.max(s,o),r[t.outboundLayer.id]=s,i[t.outboundLayer.id]=t.outboundLayer,e[t.id]=s;for(let r=0;r<t.inboundLayers.length;r++){const i=t.inboundLayers[r],o=t.nodeIndices[r],a=i.inboundNodes[o],l=null==e[a.id]?0:e[a.id];e[a.id]=Math.max(s+1,l),n[a.id]=a}}const h={};for(const t in e){const r=e[t];r in h||(h[r]=[]),h[r].push(n[t])}const d={};for(const t in r){const e=r[t];e in d||(d[e]=[]),d[e].push(i[t])}let p=Object.keys(d).map((t=>parseInt(t,10))).sort(lK);this.layers=[];for(const t of p){const e=d[t];e.sort(((t,e)=>{const n=s[t.id],r=s[e.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof y0&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map((t=>parseInt(t,10))).sort(lK);const f=this.inputs.slice(),m=[];for(const t of p)for(const e of h[t]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new GY(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${m}`);for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map((t=>t.name));for(const t of g){const e=g.filter((e=>e===t)).length;if(1!==e)throw new GY(`The name "${t}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new LZ({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new qY("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let r=0;for(const t of this.layers)for(const e of t.weights){if(null!=n[e.originalName])throw new qY(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,r++}const i=[];for(const r in t){let s=r;if(null==n[r]){const t=r.split("/");s=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[s])i.push([n[s],t[r]]);else if(e)throw new qY(`Provided weight data has no target variable: ${r}`);delete n[s]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new qY(`${t.length} of ${r} weights are not set: ${t}`)}$Z(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 3.21.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=g0(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return xr((()=>{t=eK(t);const n=new UZ;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return WZ(this.outputs,n,e)}))}computeMask(t,e){return xr((()=>{let n;return t=eK(t),n=null==e?ZY(null,t.length):eK(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=EZ(t);if(e.length!==this.inputLayers.length)throw new qY(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let t=0;t<e.length;t++){const r=this.inputLayers[t],i=e[t];n[r.name+"_0_0"]=i}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(lK);if(r.length>1)for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(e.id))continue;const r=[];for(let e=0;e<t.inboundLayers.length;e++){const i=t.inboundLayers[e],s=t.nodeIndices[e],o=t.tensorIndices[e],a=n[`${i.name}_${s}_${o}`];r.push(a)}const i=EZ(e.computeOutputShape(tK(r))),s=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++){n[`${e.name}_${s}_${t}`]=i[t]}}}const i=[],s=[];for(let t=0;t<this.outputLayers.length;t++){const e=this.outputLayers[t],n=this.outputLayersNodeIndices[t],r=this.outputLayersTensorIndices[t],i=`${e.name}_${n}_${r}`;s.push(i)}for(let t=0;t<s.length;t++){const e=s[t];JY(e in n),i.push(n[e])}return tK(i)}runInternalGraph(t,e){null==e&&(e=ZY(null,t.length));const n={};for(let r=0;r<this.inputs.length;++r){const i=this.inputs[r],s=t[r],o=e[r];n[i.id]=[s,o]}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(lK);for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,s=new Array;for(const t of r)t.id in n&&s.push(n[t.id]);if(s.length===r.length){let r,o,a,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===s.length){const[t,n]=s[0];null==c.mask&&(c.mask=n),a=eK(e.call(t,c)),l=eK(e.computeMask(t,n)),r=[t],o=[n]}else r=s.map((t=>t[0])),o=s.map((t=>t[1])),null==c.mask&&(c.mask=o),a=eK(e.call(r,c)),l=eK(e.computeMask(r,o));if(e.activityRegularizer)throw new XY("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t){const e=i[t],r=a[t],s=l[t];n[e.id]=[r,s]}}}}const i=[],s=[],o=[];for(const t of this.outputs){JY(t.id in n,`Could not compute output ${t.name} : ${t.id}`);const[e,r]=n[t.id];o.push(e.shape),i.push(e),s.push(r)}return[i,s,o]}buildNodeConversionMap(t){const e={};let n;for(const t of this.layers){n=t instanceof y0?1:0;for(let r=0;r<t.inboundNodes.length;r++){const i=y0.nodeKey(t,r);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new qY(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new qY("Provide either a layer name or layer index");for(const e of this.layers)if(e.name===t)return e;throw new qY(`No such layer: ${t}`)}calculateLosses(){return xr((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const r=y0.nodeKey(e,n);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const t of this.layers){const r=t.getClassName(),i=t.getConfig(),s=[];for(let n=0;n<t.inboundNodes.length;n++){const r=t.inboundNodes[n],i=y0.nodeKey(t,n);let o={};if(this.containerNodes.has(i)){if(r.callArgs)try{JSON.stringify(r.callArgs),o=r.callArgs}catch(e){console.warn(`Layer ${t.name} was passed non-serializable keyword arguments: ${r.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),o={}}if(r.inboundLayers.length>0){const t=[];for(let n=0;n<r.inboundLayers.length;n++){const i=r.inboundLayers[n],s=r.nodeIndices[n],a=r.tensorIndices[n];let l=e[y0.nodeKey(i,s)];null==l&&(l=0),t.push([i.name,l,a,o])}s.push(t)}}}const o={};o.name=t.name,o.className=r,o.config=i,o.inboundNodes=s,n.push(o)}t.layers=n;const r=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t],i=this.inputLayersNodeIndices[t],s=y0.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.inputLayersTensorIndices[t];r.push([n.name,o,a])}t.inputLayers=r;const i=[];for(let t=0;t<this.outputLayers.length;t++){const n=this.outputLayers[t],r=this.outputLayersNodeIndices[t],s=y0.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.outputLayersTensorIndices[t];i.push([n.name,o,a])}return t.outputLayers=i,t}static fromConfig(t,e,n={},r=!1){const i={},s={};function o(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function a(t,e){const n=[];let r;for(const s of e){const a=s[0],l=s[1],c=s[2];if(r=null==s[3]?{}:s[3],!(a in i))return void o(t,e);const u=i[a];if(u.inboundNodes.length<=l)return void o(t,e);const h=u.inboundNodes[l];n.push(h.outputTensors[c])}n.length>0&&t.apply(tK(n),r)}function l(t){const n=t.name,s=VQ(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s;t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new qY(`Corrupted configuration, expected array for nodeData: ${t}`);o(s,t)}))}const c=e.name,u=e.layers;for(const t of u)l(t);for(;!uK(s);)for(const t of u){const e=i[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)a(e,n)}}const h=[],d=[],p=e.inputLayers;for(const t of p){const e=t[0],n=t[1],r=t[2];JY(e in i);const s=i[e].inboundNodes[n].outputTensors;h.push(s[r])}const f=e.outputLayers;for(const t of f){const e=t[0],n=t[1],r=t[2];JY(e in i);const s=i[e].inboundNodes[n].outputTensors;d.push(s[r])}return new t({inputs:h,outputs:d,name:c})}get stateful(){if(this._stateful)throw new qY("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){xr((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function b0(t,e){return function(t,e,n){const r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}(t,e,"classWeight")}async function v0(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=xr((()=>{if(1===t.shape.length)return Kn(t);if(2===t.shape.length){if(t.shape[1]>1){return Ai(t,1)}if(1===t.shape[1])return Ki(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await e.data());wr(e);const i=[];return r.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])})),vl(i,"float32")}return null}function x0(t,e){return Si(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w0(t,e){let n,r;const i=e;n=i.xs,r=i.ys,c(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const s=S0("input",t.inputNames,n),o=S0("output",t.outputNames,r),a=s[0].shape[0];c(s.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),c(o.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let e=0;e<s.length;e++)c(s[e].shape[0]===a,(()=>`Batch size mismatch: input ${t.inputNames[e]} has ${s[e].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));for(let e=0;e<o.length;e++)c(o[e].shape[0]===a,(()=>`Batch size mismatch: output ${t.outputNames[e]} has ${o[e].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));return{xs:s,ys:o}}function S0(t,e,n){if(n instanceof we)return[n];if(Array.isArray(n))return c(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const r=[];for(const i of e){if(null==n[i])throw new qY(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}async function _0(t,e,n){const r=null!=n.batchesPerEpoch;if(c(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),c(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),c(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),c(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),c(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=null!=n.validationData;let s,o;if(i)if(k0(n.validationData))c(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new XY("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);s=t.xs,o=t.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;u=i?l.slice().concat(l.map((t=>"val_"+t))):l.slice();const h=zQ(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:p,history:f}=UQ(h,d,n.epochs,null,null,function(t,e){let n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,i,u);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=null==n.initialEpoch?0:n.initialEpoch,g=await e.iterator();for(;m<n.epochs;){const c={};await p.onEpochBegin(m);let u=0,h=0;for(r||(g=await e.iterator());!r||u<n.batchesPerEpoch;){const e=await g.next();if(r&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${u} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=e.value){const{xs:r,ys:i}=w0(t,e.value),s={};s.batch=h,s.size=r[0].shape[0],await p.onBatchBegin(h,s);const o=[];if(null!=n.classWeight){const e=b0(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)o.push(await v0(i[t],null,e[t]))}const c=r.concat(i).concat(o),d=a(c);wr(c);for(let t=0;t<l.length;++t){const e=l[t],n=d[t];s[e]=n,Sr(n)}await p.onBatchEnd(h,s),$Q(s),h++,u++}if(r?u>=n.batchesPerEpoch:e.done){if(i){let e;e=k0(n.validationData)?eK(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):eK(t.evaluate(s,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)c[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,c),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function k0(t){return"function"==typeof t.iterator}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function T0(t){c(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function E0(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>jK(t,e,n-e))):jK(t,e,n-e)}function M0(t,e){return xr((()=>null==t?null:Array.isArray(t)?t.map((t=>M0(t,e))):ZK(t,"int32"===e.dtype?e:Yn(e,"int32"))))}function C0(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}async function A0(t,e,n,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let s,o,a,l,c,u,h,d,p;t.isTraining=!0;try{const f=null==r.batchSize?32:r.batchSize;T0(f);const m=!1,g=await t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,m,f);s=g[0],o=g[1],p=g[2];let y,b=!1;if(null!=r.validationData&&r.validationData.length>0){if(b=!0,2!==r.validationData.length)throw 3===r.validationData.length?new XY("validationData including sample weights is not supported yet."):new qY(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);c=r.validationData[0],u=r.validationData[1];const e=!0,n=await t.standardizeUserData(c,u,null,null,e,f);h=n[0],d=n[1],y=h.concat(d)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){b=!0;const t=Math.floor(s[0].shape[0]*(1-r.validationSplit)),e=s[0].shape[0];h=E0(s,t,e),a=s,s=E0(s,0,t),d=E0(o,t,e),l=o,o=E0(o,0,t),y=h.concat(d)}else null!=r.validationSteps&&(b=!0);const v=s.concat(o).concat(p);t.checkTrainableWeightsConsistency();const x=t.makeTrainFunction(),w=t.getDedupedMetricsNames();let S,_;b?(t.makeTestFunction(),S=t.testFunction,_=w.slice().concat(w.map((t=>"val_"+t)))):(S=null,y=[],_=w.slice());const k=zQ(r.callbacks,r.yieldEvery),T=await async function(t,e,n,r,s,o,a,l,c,u,h,d,p,f,m){null==s&&(s=32),null==o&&(o=1),null==h&&(h=!0),null==p&&(p=0);let g=!1;if(null!=c&&null!=u&&(g=!0),null!=m&&(g=!0,null==f))throw new qY("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=t.checkNumSamples(n,s,f,"steps_per_epoch");let b;null!=y&&(b=FK(0,y)),null==a&&(a=1);const{callbackList:v,history:x}=UQ(l,a,o,p,y,f,s,g,d);v.setModel(t),t.history=x,await v.onTrainBegin(),t.stopTraining_=!1;for(let a=p;a<o;++a){await v.onEpochBegin(a);const o={};if(null!=f)throw new XY("stepsPerEpoch mode is not implemented yet.");{if("batch"===h)throw new XY("batch shuffling is not implemneted yet");h&&i(b);const a=vl(b),l=C0(y,s);for(let i=0;i<l.length;++i){const h={};if(await v.onBatchBegin(i,h),xr((()=>{const d=l[i][0],p=l[i][1],f=jK(a,d,p-d);h.batch=i,h.size=p-d;const m=M0(n,f),y=e(m);for(let t=0;t<r.length;++t){const e=r[t],n=y[t];h[e]=n,Sr(n)}if(i===l.length-1&&g){const e=t.testLoop(c,u,s);for(let t=0;t<r.length;++t){const n=r[t],i=e[t];Sr(i),o["val_"+n]=i}}})),await v.onBatchEnd(i,h),$Q(h),t.stopTraining_)break}a.dispose()}if(await v.onEpochEnd(a,o),t.stopTraining_)break}return await v.onTrainEnd(),await t.history.syncData(),t.history}(t,x,v,w,f,r.epochs,r.verbose,k,S,y,r.shuffle,_,r.initialEpoch,null,null);return T}finally{t.isTraining=!1,I0(s,e),I0(o,n),I0(a,e),I0(l,n),I0(h,c),I0(d,u),null!=p&&wr(p)}}function N0(t){const e=[];t instanceof we&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(1===r.rank)e.push(VK(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function I0(t,e){if(null==t)return;const n=[];if(e instanceof we)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const t in e){const r=e[t];n.push(r.id)}const r=[];if(t instanceof we)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&r.push(t)}));else if(null!=t)for(const e in t){const i=t[e];-1===n.indexOf(i.id)&&r.push(i)}r.forEach((t=>{t.isDisposed||t.dispose()}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $0(t){return Array.isArray(t)}function R0(t){return!function(t){return t instanceof we}(t)&&!$0(t)}function O0(t,e,n,r=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if($0(t)&&t.length>0)e=!0;else if(R0(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new qY(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let s;if(R0(t)){s=[];for(const n of e){if(null==t[n])throw new qY(`No data provided for "${n}". Need data for each key in: ${e}`);s.push(t[n])}}else if($0(t)){if(t.length!==e.length)throw new qY(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(e.length>1)throw new qY(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=N0(s),null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new qY(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s). but got array with shape ${o.shape}`);for(let e=0;e<n[t].length;++e){if(0===e&&!r)continue;const s=o.shape[e],a=n[t][e];if(null!=a&&a>=0&&s!==a)throw new qY(`${i} expected a batch of elements where each example has shape [${n[t].slice(1,n[t].length)}] (i.e.,tensor shape [*,${n[t].slice(1,n[t].length)}]) but the ${i} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return s}function P0(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new qY(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new qY(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new qY(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let s=0;s<n[t].length;++s){if(0===s&&!r)continue;const a=o.shape[s],l=n[t][s];if(null!=l&&l!==a)throw new qY(`Error when checking ${i}: expected ${e[t]} to have shape ${JSON.stringify(n[t])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}class L0 extends y0{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new qY("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");u0(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>uu.adagrad(.01),Adadelta:()=>uu.adadelta(1,.95,BK()),Adam:()=>uu.adam(.001,.9,.999,BK()),Adamax:()=>uu.adamax(.002,.9,.999,BK(),0),RMSProp:()=>uu.rmsprop(.001,.9,0,BK()),SGD:()=>uu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new qY(`Unknown Optimizer ${t}`)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof eu))throw new qY("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new qY(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>JQ(t)))}else{const n=JQ(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new qY(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(JQ(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let t=0;t<this.outputs.length;++t){const e=this.internalOutputShapes[t],n=this.outputNames[t];this.feedOutputNames.push(n),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[t])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],NK("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const r of e){let e=n.hasOwnProperty(r)?n[r]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};NK("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;(e=>{let n,r,s;for(const o of e){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===YQ?-1!==["accuracy","acc"].indexOf(o)?r=QQ:-1!==["crossentropy","ce"].indexOf(o)&&(r=e0):this.lossFunctions[t]===XQ?-1!==["accuracy","acc"].indexOf(o)?r=n0:-1!==["crossentropy","ce"].indexOf(o)&&(r=i0):-1!==["accuracy","acc"].indexOf(o)?r=t0:-1!==["crossentropy","ce"].indexOf(o)&&(r=r0),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),s=r,n=""+i}else{const t=o0(o);s=t,n=""+a0(o)}let e;NK(n,(()=>{e=s})),i(t,n,e)}})(r[t])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const r=null==n.batchSize?32:n.batchSize;T0(r);const i=this.standardizeUserDataXY(t,e,!0,r);try{const s=i[0].concat(i[1]);this.makeTestFunction();const o=this.testFunction;return tK(this.testLoop(o,s,r,n.verbose,n.steps))}finally{I0(i[0],t),I0(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const r=null!=(n=n||{}).batches,i=t.testFunction;let s=[];if(n.verbose>0)throw new XY("Verbose mode is not implemented yet.");c(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const o="function"==typeof e.next?e:await e.iterator();let a=0,l=0;for(;!r||l<n.batches;){const e=await o.next();if(s=xr((()=>{if(e.value){const{xs:n,ys:r}=w0(t,e.value),o=n.concat(r),c=xr((()=>i(o)));if(wr(o),0===l)for(let t=0;t<c.length;++t)s.push(to(0));const u=o[0].shape[0];for(let t=0;t<c.length;++t){const e=c[t],n=s[t];s[t]=xr((()=>vi(s[t],Si(u,e)))),l>0&&wr(n)}wr(c),a+=u,++l}return s})),e.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let t=0;t<s.length;++t){const e=s[t];s[t]=wi(s[t],a),wr(e)}return tK(s)}(this,t,e)}checkNumSamples(t,e,n,r="steps"){let i;if(null!=n){if(i=null,null!=e)throw new qY(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new qY(`Either the input data should have a defined shape, or ${r} shoud be specified.`);i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new qY("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),s=new UZ;if(t instanceof we&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new qY(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)s.add(this.inputs[e],t[e])}else for(const e of this.inputs){const n=t[e.name];if(null==n)throw new qY(`No value is provided for the model's input ${e.name}`);s.add(e,n)}const o=WZ(i,s);return n?o:o[0]}retrieveSymbolicTensors(t){const e=ZY(null,t.length);let n=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],s=i.map((t=>t.name));for(let r=0;r<t.length;++r){const o=s.indexOf(t[r]);if(-1!==o&&(e[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,r)=>{null==e&&n.push(t[r])})),new qY(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return xr((()=>{const r=this.checkNumSamples(t);if(n)throw new XY("Verbose predictLoop() is not implemented yet.");const i=C0(r,e),s=this.outputs.map((t=>[]));for(let e=0;e<i.length;++e){const n=xr((()=>{const n=i[e][0],r=i[e][1],s=E0(t,n,r),o=[];if(Array.isArray(s))for(let t=0;t<s.length;++t)o.push({key:this.inputs[t],value:s[t]});else o.push({key:this.inputs[0],value:s});const a=new UZ(o);return WZ(this.outputs,a)}));n.forEach(((t,e)=>s[e].push(t)))}return tK(s.map((t=>Qi(t,0))))}))}predict(t,e={}){const n=N0(t);P0(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==e.batchSize?32:e.batchSize;return T0(r),this.predictLoop(n,r)}finally{I0(n,t)}}predictOnBatch(t){P0(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,r){if(null==this.optimizer_)throw new GY("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let t=0;t<this.feedOutputShapes.length;++t){const e=this.feedOutputShapes[t];this.feedLossFns[t]===XQ?i.push(e.slice(0,e.length-1).concat([1])):i.push(e)}if(function(t,e,n){const r=cK(t.map((t=>t.shape[0])));r.sort();const i=cK(e.map((t=>t.shape[0])));if(i.sort(),r.length>1)throw new qY(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(i.length>1)throw new qY(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(r.length>0&&i.length>0&&!f(r,i))throw new qY(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(t=O0(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=O0(e,this.feedOutputNames,i,!1,"target")),function(t,e,n){const r=[WQ,YQ,qQ];for(let i=0;i<t.length;++i){const s=t[i],o=e[i],a=n[i];if(null!=o){if(o===qQ&&1===s.shape[s.shape.length-1])throw new qY(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const t=s.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const r=t[n],i=e[n];if(null!=i&&r!==i)throw new qY(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new qY(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,r,i=!0,s){const[o,a]=this.standardizeUserDataXY(t,e,i,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const t=b0(r,this.outputNames);l=[];for(let e=0;e<t.length;++e)l.push(await v0(a[e],null,t[e]))}return[o,a,l]}testLoop(t,e,n,r=0,i){return xr((()=>{const s=this.checkNumSamples(e,n,i,"steps"),o=[];if(r>0)throw new XY("Verbose mode is not implemented yet.");if(null!=i)throw new XY("steps mode in testLoop() is not implemented yet");{const r=C0(s,n),i=vl(FK(0,s));for(let n=0;n<r.length;++n){const s=r[n][0],a=r[n][1],l=jK(i,s,a-s),c=M0(e,l),u=t(c);if(0===n)for(let t=0;t<u.length;++t)o.push(to(0));for(let t=0;t<u.length;++t){const e=u[t];o[t]=vi(o[t],Si(a-s,e))}}for(let t=0;t<o.length;++t)o[t]=wi(o[t],s)}return o}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const r=t[n];let i=r;if(QY(t,r)>1){i+=`_${QY(t.slice(0,n),r)}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],o=this.collectedTrainableWeights.map((t=>t.read())),a=this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const o=new UZ(t),a=WZ(this.outputs,o,{training:!0});let l;for(let t=0;t<this.lossFunctions.length;++t){let n=(0,this.lossFunctions[t])(r[t],a[t]);null!=i[t]&&(n=x0(n,i[t]));const s=Ho(n);e.push(s),l=0===t?n:vi(l,n)}for(let t=0;t<this.metricsTensors.length;++t){let n;if(this.outputs.length>1&&t<this.outputs.length)n=e[t];else{const e=this.metricsTensors[t][0],i=this.metricsTensors[t][1];n=Ho(e(r[i],a[i]))}Sr(n),s.push(n)}return l=Ho(l),this.calculateLosses().forEach((t=>{l=vi(l,t)})),l}),!0,o);return[a].concat(s)}}makeTestFunction(){this.testFunction=t=>xr((()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let t=0;t<this.inputs.length;++t)s.push({key:this.inputs[t],value:r[t]});const o=new UZ(s),a=WZ(this.outputs,o);for(let t=0;t<this.lossFunctions.length;++t){const r=this.lossFunctions[t],s=Ho(r(i[t],a[t]));n=0===t?s:vi(n,s),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],r=this.metricsTensors[t][1],s=Ho(n(i[r],a[r]));e.push(s)}return e}))}async fit(t,e,n={}){return A0(this,t,e,n)}async fitDataset(t,e){return _0(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),o=[];for(const t of s){const e=await t.data();o.push(e[0])}return wr(s),I0(n[0],t),I0(n[1],e),tK(o)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let t=0;t<r.length;++t)n&&!r[t].trainable||e.push({name:r[t].originalName,tensor:i[t]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=vr().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-vr().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=nK(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>nK(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const r of e){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");t[r]=nK(n[r])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[nK(a0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>nK(a0(t))));{const t={};for(const e in this.metrics)t[e]=nK(a0(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=VQ(m0(t.optimizer_config));let n,r;if("string"==typeof t.loss)n=rK(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>rK(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=rK(t.loss[e])}if(Array.isArray(t.metrics))r=t.metrics.map((t=>rK(t)));else if(null!=t.metrics){r={};for(const e in t.metrics)r[e]=rK(t.metrics[e])}this.compile({loss:n,metrics:r,optimizer:e})}async save(t,e){if("string"==typeof t){const e=xn(t);if(0===e.length)throw new qY(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new qY(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new qY("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await on(this.getNamedWeights(e)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.21.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:i}=await on(await this.optimizer.getWeights(),t);n.specs.push(...i),n.data=hn([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;l0(this.userDefinedMetadata,this.name,t),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,t.save(r)}setUserDefinedMetadata(t){l0(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}L0.className="Model",pi(L0);class D0 extends L0{}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
async function F0(t,e){if(null==e&&(e={}),"string"==typeof t){const n=wn(t,e);if(0===n.length)n.push(cr(t,e));else if(n.length>1)throw new qY(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return async function(t,e,n){null==n&&(n={});if(null==t.load)throw new qY("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const s=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&s,a=VQ(m0(i),e,o),l=r.trainingConfig;null!=l&&a.loadTrainingConfig(l);null!=r.userDefinedMetadata&&a.setUserDefinedMetadata(r.userDefinedMetadata);if(null!=r.weightData){if(null==r.weightSpecs)throw new qY("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:t,optimizerWeights:e}=function(t,e){const n=an(t,e),r={},i=[];return e.forEach((t=>{"optimizer"===t.group?i.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]})),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);a.loadWeights(t,s),null!=a.optimizer&&e.length>0&&await a.optimizer.setWeights(e),wr(t),wr(e.map((t=>t.tensor)))}return a}(t,void 0,e)}D0.className="Functional",pi(D0);class z0 extends L0{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:vK("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new qY(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof z0||t instanceof L0;let n;if(e){if(n=t,1!==n.outputs.length)throw new qY("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new qY("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new qY("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=function(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new qY("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new BZ({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new qY(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new qY("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=zZ(this.outputs[0])}this.inboundNodes=[],new LZ({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ZY(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(CZ(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new L0({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new GY("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new GY("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new GY("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new GY("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},r=!1){let i,s={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new qY("Legacy serialization format not supported yet.");i=e}else c(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=e.layers,delete e.layers,s=e;const o=new t(s);if(!(o instanceof z0))throw new XY(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const t of i){const e=VQ(t,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),o.add(e)}return o}set stopTraining(t){if(null==this.model)throw new qY("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new qY("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function B0(t){return new z0(t)}function U0(t,e){return null==e&&(e={}),F0(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */z0.className="Sequential",pi(z0);class V0 extends hi{getConfig(){return{}}}class j0 extends V0{apply(t,e=1){return function(t,e=1){if(1!==e)throw new XY(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Us(t)}(t,e)}}j0.className="elu",pi(j0);class W0 extends V0{apply(t){return Za(t)}}W0.className="selu",pi(W0);class H0 extends V0{apply(t){return Va(t)}}H0.className="relu",pi(H0);class G0 extends V0{apply(t){return xr((()=>Yo(6,Va(t))))}}G0.className="relu6",pi(G0);class q0 extends V0{apply(t){return t}}q0.className="linear",pi(q0);class X0 extends V0{apply(t){return ts(t)}}X0.className="sigmoid",pi(X0);class Y0 extends V0{apply(t){return function(t){return xr((()=>{const e=vi(.5,Si(.2,t));return fs(e,0,1)}))}(t)}}Y0.className="hardSigmoid",pi(Y0);class K0 extends V0{apply(t){return No(t)}}K0.className="softplus",pi(K0);class Z0 extends V0{apply(t){return function(t){return xr((()=>wi(t,vi(_i(t),1))))}(t)}}Z0.className="softsign",pi(Z0);class J0 extends V0{apply(t){return ns(t)}}J0.className="tanh",pi(J0);class Q0 extends V0{apply(t,e=-1){return al(t,e)}}Q0.className="softmax",pi(Q0);class t1 extends V0{apply(t,e=-1){return Ro(t,e)}}t1.className="logSoftmax",pi(t1);class e1 extends V0{apply(t,e=1){return xr((()=>Si(ts(Si(t,e)),t)))}}e1.className="swish",pi(e1);class n1 extends V0{apply(t){return xr((()=>Si(t,ns(No(t)))))}}function r1(t){return t.getClassName()}function i1(t,e={}){return aK(t,di.getMap().classNameMap,e,"activation")}function s1(t){if(null==t){const t={className:"linear",config:{}};return i1(t)}if("string"==typeof t){const e={};return e.className=t,e.config={},i1(e)}return t instanceof V0?t:i1(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */n1.className="mish",pi(n1);class o1 extends hi{}class a1 extends o1{constructor(t){super(),function(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return xr((()=>{let e=Go([1]);return this.hasL1&&(e=vi(e,ro(Si(this.l1,_i(t))))),this.hasL2&&(e=vi(e,ro(Si(this.l2,JK(t))))),Ki(e,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}a1.className="L1L2",pi(a1);const l1={l1l2:"L1L2"};function c1(t){return sK(t)}function u1(t,e={}){return aK(t,di.getMap().classNameMap,e,"regularizer")}function h1(t){if(null==t)return null;if("string"==typeof t){return u1({className:t in l1?l1[t]:t,config:{}})}return t instanceof o1?t:u1(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class d1 extends FZ{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=MZ(t);let n=Va(t);return null!=this.maxValue&&(n=fs(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}d1.className="ReLU",pi(d1);class p1 extends FZ{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=MZ(t);return xo(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}p1.className="LeakyReLU",pi(p1);class f1 extends FZ{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=kZ(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=h1(t.alphaRegularizer),this.alphaConstraint=NQ(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new qY(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=CZ(t)).slice(1);if(null!=this.sharedAxes)for(const t of this.sharedAxes)e[t-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let e=1;e<t.length;++e)n[e]=t[e];this.inputSpec=[new RZ({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=MZ(t),ha(t,this.alpha.read())}getConfig(){const t={alphaInitializer:_Z(this.alphaInitializer),alphaRegularizer:c1(this.alphaRegularizer),alphaConstraint:CQ(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}f1.className="PReLU",pi(f1);class m1 extends FZ{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new XY(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=MZ(t);return Us(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}m1.className="ELU",pi(m1);class g1 extends FZ{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=MZ(t);return Si(n,Yn(mo(n,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}g1.className="ThresholdedReLU",pi(g1);class y1 extends FZ{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new Q0).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=MZ(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function b1(t,e,n){if("number"==typeof t)return ZY(t,e);if(t.length!==e)throw new qY(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let i=0;i<e;++i){const s=t[i];if((r=s)!==parseInt(r.toString(),10))throw new qY(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t;var r}function v1(t,e,n,r,i=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((s+r-1)/r)}function x1(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+DK([n-e,0]);else{if("same"!==r)throw new qY(`Unsupport padding mode: ${r}.`);t*=e}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w1(t,e){return xr((()=>(EK(e),"channelsFirst"===e?Ar(t,[0,2,3,1]):t)))}function S1(t,e){return xr((()=>(EK(e),"channelsFirst"===e?Ar(t,[0,2,3,4,1]):t)))}function _1(t,e,n,r=[1,1],i="valid",s,o,a=null){return xr((()=>{if(null==s&&(s="channelsLast"),EK(s),3!==t.rank&&4!==t.rank)throw new qY(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new qY(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=w1(t,s);if("causal"===i)throw new XY("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=ql({x:l,filter:e,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),"channelsFirst"===s&&(l=Ar(l,[0,3,1,2])),l}))}y1.className="Softmax",pi(y1);class k1 extends FZ{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",k1.verifyArgs(e),this.rank=t,pK(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new XY(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=b1(e.kernelSize,t,"kernelSize"),this.strides=b1(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,MK(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,EK(this.dataFormat),this.activation=s1(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=kZ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=NQ(e.biasConstraint),this.biasRegularizer=h1(e.biasRegularizer),this.activityRegularizer=h1(e.activityRegularizer),this.dilationRate=b1(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new qY(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new qY(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new qY(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(JY("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!dK(t.kernelSize,"number",1,3))throw new qY(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:r1(this.activation),useBias:this.useBias,biasInitializer:_Z(this.biasInitializer),biasRegularizer:c1(this.biasRegularizer),activityRegularizer:c1(this.activityRegularizer),biasConstraint:CQ(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class T1 extends k1{constructor(t,e){super(t,e),this.kernel=null,T1.verifyArgs(e),this.filters=e.filters,pK(this.filters,"filters"),this.kernelInitializer=kZ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=NQ(e.kernelConstraint),this.kernelRegularizer=h1(e.kernelRegularizer)}build(t){t=CZ(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new qY(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return xr((()=>{let e;t=MZ(t);const n=null==this.bias?null:this.bias.read(),r=mK(this.activation.getClassName());if(null!=r&&2===this.rank)e=_1(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=function(t,e,n,r=1,i="valid",s,o=1){return xr((()=>{if(null==s&&(s="channelsLast"),EK(s),3!==t.shape.length)throw new qY(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new qY(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new qY(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===s&&(t=Ar(t,[0,2,1])),"causal"===i)throw new XY("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=xs(t,e,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(a=tZ(a,n)),a}))}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=_1(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new XY("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r=[1,1,1],i="valid",s,o){return xr((()=>{if(null==s&&(s="channelsLast"),EK(s),4!==t.rank&&5!==t.rank)throw new qY(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new qY(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=S1(t,s);if("causal"===i)throw new XY("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=_s(a,e,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(a=tZ(a,n)),"channelsFirst"===s&&(a=Ar(a,[0,4,1,2,3])),a}))}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=CZ(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let t=0;t<n.length;++t){const r=v1(n[t],this.kernelSize[t],this.padding,this.strides[t],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[t]);e.push(r)}let r=[t[0]];return"channelsLast"===this.dataFormat?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:_Z(this.kernelInitializer),kernelRegularizer:c1(this.kernelRegularizer),kernelConstraint:CQ(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new qY(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class E1 extends T1{constructor(t){super(2,t),E1.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!dK(t.kernelSize,"number",1,2))throw new qY(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}E1.className="Conv2D",pi(E1);class M1 extends T1{constructor(t){super(3,t),M1.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new qY(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}M1.className="Conv3D",pi(M1);class C1 extends E1{constructor(t){if(super(t),this.inputSpec=[new RZ({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new qY(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=CZ(t)).length)throw new qY("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new qY("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new RZ({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return xr((()=>{let e=MZ(t);if(4!==e.shape.length)throw new qY(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s;"channelsFirst"===this.dataFormat?(i=2,s=3):(i=1,s=2);const o=n[i],a=n[s],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,x1(o,u,l,this.padding),x1(a,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Ar(e,[0,2,3,1]));let p=Ss(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=Ar(p,[0,3,1,2])),null!=this.bias&&(p=tZ(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=CZ(t)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const s=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],l=this.strides[1];return e[n]=this.filters,e[r]=x1(e[r],a,s,this.padding),e[i]=x1(e[i],l,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}C1.className="Conv2DTranspose",pi(C1);class A1 extends M1{constructor(t){if(super(t),this.inputSpec=[new RZ({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new qY(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=CZ(t)).length)throw new qY("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new qY("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new RZ({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return xr((()=>{let e=MZ(t);if(5!==e.shape.length)throw new qY(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s,o;"channelsFirst"===this.dataFormat?(o=2,i=3,s=4):(o=1,i=2,s=3);const a=n[o],l=n[i],c=n[s],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],m=this.strides[2],g=[r,x1(a,p,u,this.padding),x1(l,f,h,this.padding),x1(c,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Ar(e,[0,2,3,4,1]));let y=Ts(e,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=Ar(y,[0,4,1,2,3])),null!==this.bias&&(y=tZ(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(t){const e=(t=CZ(t)).slice();let n,r,i,s;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,s=4):(n=4,r=1,i=2,s=3);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],h=this.strides[2];return e[n]=this.filters,e[r]=x1(e[r],c,o,this.padding),e[i]=x1(e[i],u,a,this.padding),e[s]=x1(e[s],h,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}A1.className="Conv3DTranspose",pi(A1);class N1 extends T1{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new qY("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new qY("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new qY(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=kZ(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=h1(e.depthwiseRegularizer),this.depthwiseConstraint=NQ(e.depthwiseConstraint),this.pointwiseInitializer=kZ(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=h1(e.pointwiseRegularizer),this.pointwiseConstraint=NQ(e.pointwiseConstraint)}build(t){if((t=CZ(t)).length<this.rank+2)throw new qY(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new qY(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let t=0;t<this.rank;++t)i.push(1);i.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new RZ({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return xr((()=>{let e;if(t=MZ(t),1===this.rank)throw new XY("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=Ar(t,[0,2,3,1])),e=Ja(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=tZ(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=Ar(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=_Z(this.depthwiseInitializer),t.pointwiseInitializer=_Z(this.pointwiseInitializer),t.depthwiseRegularizer=c1(this.depthwiseRegularizer),t.pointwiseRegularizer=c1(this.pointwiseRegularizer),t.depthwiseConstraint=CQ(this.depthwiseConstraint),t.pointwiseConstraint=CQ(this.pointwiseConstraint),t}}N1.className="SeparableConv";class I1 extends N1{constructor(t){super(2,t)}}I1.className="SeparableConv2D",pi(I1);class $1 extends T1{constructor(t){super(1,t),$1.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!dK(t.kernelSize,"number",1,1))throw new qY(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}$1.className="Conv1D",pi($1);class R1 extends FZ{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return xr((()=>{if(t=MZ(t),"channelsLast"===this.dataFormat){const e=HK(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return HK(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=HK(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return HK(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}R1.className="Cropping2D",pi(R1);class O1 extends FZ{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,EK(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,hK(wK,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return xr((()=>{let e=MZ(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=Ar(e,[0,2,3,1]);const t=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?Kc.resizeNearestNeighbor(e,[t,r]):Kc.resizeBilinear(e,[t,r]);return Ar(i,[0,3,1,2])}{const t=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?Kc.resizeNearestNeighbor(e,[t,r]):Kc.resizeBilinear(e,[t,r])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}O1.className="UpSampling2D",pi(O1);class P1 extends k1{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=kZ(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=NQ(t.depthwiseConstraint),this.depthwiseRegularizer=h1(t.depthwiseRegularizer)}build(t){if((t=CZ(t)).length<4)throw new qY(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new qY(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return xr((()=>{let e=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t,e,n=[1,1],r="valid",i,s){return xr((()=>{null==i&&(i="channelsLast"),EK(i);let o=w1(t,i);if(4!==t.rank)throw new qY(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new qY(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=$s(o,e,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(o=Ar(o,[0,3,1,2])),o}))}(t=MZ(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=tZ(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=CZ(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=v1(e,this.kernelSize[0],this.padding,this.strides[0]),s=v1(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,s]:[t[0],i,s,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=_Z(this.depthwiseInitializer),t.depthwiseRegularizer=c1(this.depthwiseRegularizer),t.depthwiseConstraint=CQ(this.depthwiseRegularizer),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function L1(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new qY("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function D1(t,e,n,r=!1,i,s,o=!1,a=!1){return xr((()=>{const l=e.shape.length;if(l<3)throw new qY(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(FK(2,l));if(e=Ar(e,c),null!=s)throw new XY("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=Yn(Yn(i,"bool"),"float32")).rank===l-1&&(i=lo(i,-1)),i=Ar(i,c)),r&&(e=Wa(e,0),null!=i&&(i=Wa(i,0)));const u=[];let h,d=n;const p=e.shape[0],f=Cl(e);let m,g;null!=i&&(m=Cl(i));for(let e=0;e<p;++e){const n=f[e],r=xr((()=>t(n,d)));if(null==i)h=r[0],d=r[1];else{const t=xr((()=>{const t=m[e],n=$o(na(t),t),i=vi(Si(r[0],t),Si(d[0],n)),s=d.map(((e,i)=>vi(Si(r[1][i],t),Si(e,n))));return{output:i,newStates:s}}));h=t.output,d=t.newStates}a&&u.push(h)}if(a){g=ml(u,1)}return[h,g,d]}))}P1.className="DepthwiseConv2D",pi(P1);class F1 extends FZ{constructor(t){let e;if(super(t),null==t.cell)throw new qY("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new G1({cells:t.cell}):t.cell,null==e.stateSize)throw new qY("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new RZ({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return FK(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){TZ(t)&&(t=t[0]);let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let r;if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const r of e)n.push([t[0],r]);return[r].concat(n)}return r}computeMask(t,e){return xr((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new XY("Constants support is not implemented in RNN yet.");TZ(t)&&(t=t[0]);const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new RZ({shape:[e,null,...n]});const r=[t[0]].concat(t.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!f(this.stateSpec.map((t=>t.shape[t.shape.length-1])),i))throw new qY(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map((t=>new RZ({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){xr((()=>{if(!this.stateful)throw new HY("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new qY("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Go([n,t]))):this.states_=[Go([n,this.cell.stateSize])];else if(null==t)wr(this.states_),null!=this.keptStates&&(wr(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Go([n,t]))):this.states_[0]=Go([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new qY(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):wr(this.states_);for(let e=0;e<this.states_.length;++e){const r=t[e],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,s=[n,i];if(!f(r.shape,s))throw new qY(`State ${e} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${r.shape}`);this.states_[e]=r}}this.states_=this.states_.map((t=>Sr(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=L1(t,n,r,this.numConstants);t=i.inputs,n=i.initialState,r=i.constants;let s=[],o=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new RZ({shape:t.shape}));o=o.concat(this.stateSpec)}null!=r&&(e.constants=r,s=s.concat(r),this.numConstants=r.length);if(s[0]instanceof OZ){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return xr((()=>{const n=null==e?null:e.mask,r=null==e?null:e.training;let i=null==e?null:e.initialState;t=MZ(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new qY(`RNN Layer has ${s} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},a=D1(((t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]}),t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=a[0],c=a[1],u=a[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?c:l;return this.returnState?[h].concat(u):h}))}getInitialState(t){return xr((()=>{let e=Go(t.shape);return e=ro(e,[1,2]),e=VK(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?XK(e,[1,t]):e)):this.cell.stateSize>1?[XK(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===F1.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,t,e)}static fromConfig(t,e,n={}){const r=VQ(e.cell,n);return new t(Object.assign(e,{cell:r}))}}F1.className="RNN",pi(F1);class z1 extends FZ{}class B1 extends z1{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,pK(this.units,"units"),this.activation=s1(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=kZ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kZ(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kZ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=h1(t.kernelRegularizer),this.recurrentRegularizer=h1(t.recurrentRegularizer),this.biasRegularizer=h1(t.biasRegularizer),this.kernelConstraint=NQ(t.kernelConstraint),this.recurrentConstraint=NQ(t.recurrentConstraint),this.biasConstraint=NQ(t.biasConstraint),this.dropout=LK([1,DK([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=LK([1,DK([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=CZ(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return xr((()=>{if(2!==t.length)throw new qY(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=q1({ones:()=>na(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=q1({ones:()=>na(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;i=KK(null!=s?Si(t,s):t,this.kernel.read()),null!=this.bias&&(i=tZ(i,this.bias.read())),null!=o&&(n=Si(n,o));let a=vi(i,KK(n,this.recurrentKernel.read()));return null!=this.activation&&(a=this.activation.apply(a)),[a,a]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:r1(this.activation),useBias:this.useBias,kernelInitializer:_Z(this.kernelInitializer),recurrentInitializer:_Z(this.recurrentInitializer),biasInitializer:_Z(this.biasInitializer),kernelRegularizer:c1(this.kernelRegularizer),recurrentRegularizer:c1(this.recurrentRegularizer),biasRegularizer:c1(this.biasRegularizer),activityRegularizer:c1(this.activityRegularizer),kernelConstraint:CQ(this.kernelConstraint),recurrentConstraint:CQ(this.recurrentConstraint),biasConstraint:CQ(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,e)}}B1.className="SimpleRNNCell",pi(B1);class U1 extends F1{constructor(t){t.cell=new B1(t),super(t)}call(t,e){return xr((()=>{null!=this.cell.dropoutMask&&(wr(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(wr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return new t(e)}}U1.className="SimpleRNN",pi(U1);class V1 extends z1{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new qY("GRUCell does not support reset_after parameter set to true.");this.units=t.units,pK(this.units,"units"),this.activation=s1(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=s1(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=kZ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kZ(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kZ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=h1(t.kernelRegularizer),this.recurrentRegularizer=h1(t.recurrentRegularizer),this.biasRegularizer=h1(t.biasRegularizer),this.kernelConstraint=NQ(t.kernelConstraint),this.recurrentConstraint=NQ(t.recurrentConstraint),this.biasConstraint=NQ(t.biasConstraint),this.dropout=LK([1,DK([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=LK([1,DK([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=CZ(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return xr((()=>{if(2!==t.length)throw new qY(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=q1({ones:()=>na(t),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=q1({ones:()=>na(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let o,a,l;0<this.dropout&&this.dropout<1&&(t=Si(t,i[0]));let c=KK(t,this.kernel.read());this.useBias&&(c=tZ(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Si(r,s[0]));const u=this.recurrentKernel.read(),[h,d]=hl(u,[2*this.units,this.units],u.rank-1),p=KK(r,h),[f,m,g]=hl(c,3,c.rank-1),[y,b]=hl(p,2,p.rank-1);o=this.recurrentActivation.apply(vi(f,y)),a=this.recurrentActivation.apply(vi(m,b));const v=KK(Si(a,r),d);l=this.activation.apply(vi(g,v));const x=vi(Si(o,r),Si(vi(1,Mr(o)),l));return[x,x]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:r1(this.activation),recurrentActivation:r1(this.recurrentActivation),useBias:this.useBias,kernelInitializer:_Z(this.kernelInitializer),recurrentInitializer:_Z(this.recurrentInitializer),biasInitializer:_Z(this.biasInitializer),kernelRegularizer:c1(this.kernelRegularizer),recurrentRegularizer:c1(this.recurrentRegularizer),biasRegularizer:c1(this.biasRegularizer),activityRegularizer:c1(this.activityRegularizer),kernelConstraint:CQ(this.kernelConstraint),recurrentConstraint:CQ(this.recurrentConstraint),biasConstraint:CQ(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,e)}}V1.className="GRUCell",pi(V1);class j1 extends F1{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new V1(t),super(t)}call(t,e){return xr((()=>{null!=this.cell.dropoutMask&&(wr(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(wr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}j1.className="GRU",pi(j1);class W1 extends z1{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,pK(this.units,"units"),this.activation=s1(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=s1(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=kZ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=kZ(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=kZ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=h1(t.kernelRegularizer),this.recurrentRegularizer=h1(t.recurrentRegularizer),this.biasRegularizer=h1(t.biasRegularizer),this.kernelConstraint=NQ(t.kernelConstraint),this.recurrentConstraint=NQ(t.recurrentConstraint),this.biasConstraint=NQ(t.biasConstraint),this.dropout=LK([1,DK([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=LK([1,DK([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=CZ(t))[t.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;r=new((e=class extends sZ{apply(e,r){const i=t.apply([n]),s=(new aZ).apply([n]),o=t.apply([2*n]);return qK(qK(i,s),o)}}).className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return xr((()=>{const n=null!=e.training&&e.training;if(3!==t.length)throw new qY(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=q1({ones:()=>na(t),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=q1({ones:()=>na(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c,u;0<this.dropout&&this.dropout<1&&(t=Si(t,s[0]));let h=KK(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Si(r,o[0])),h=vi(h,KK(r,this.recurrentKernel.read())),this.useBias&&(h=tZ(h,this.bias.read()));const[d,p,f,m]=hl(h,4,h.rank-1);a=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=vi(Si(l,i),Si(a,this.activation.apply(f))),u=this.recurrentActivation.apply(m);const g=Si(u,this.activation.apply(c));return[g,g,c]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:r1(this.activation),recurrentActivation:r1(this.recurrentActivation),useBias:this.useBias,kernelInitializer:_Z(this.kernelInitializer),recurrentInitializer:_Z(this.recurrentInitializer),biasInitializer:_Z(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:c1(this.kernelRegularizer),recurrentRegularizer:c1(this.recurrentRegularizer),biasRegularizer:c1(this.biasRegularizer),activityRegularizer:c1(this.activityRegularizer),kernelConstraint:CQ(this.kernelConstraint),recurrentConstraint:CQ(this.recurrentConstraint),biasConstraint:CQ(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,e)}}W1.className="LSTMCell",pi(W1);class H1 extends F1{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new W1(t),super(t)}call(t,e){return xr((()=>{null!=this.cell.dropoutMask&&(wr(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(wr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}H1.className="LSTM",pi(H1);class G1 extends z1{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return xr((()=>{let n=t.slice(1);const r=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?r.push(n.splice(0,t.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let s;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=r[o],s=0===o?[t[0]].concat(n):[s[0]].concat(n),s=a.call(s,e),i.push(s.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[s[0]].concat(n)}))}build(t){let e;TZ(t)&&(t=t[0]),this.cells.forEach(((n,r)=>{NK(`RNNCell_${r}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign({},t,e)}static fromConfig(t,e,n={}){const r=[];for(const t of e.cells)r.push(VQ(t,n));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return IZ(t)}setWeights(t){const e=[];for(const n of this.cells){const r=n.weights.length,i=t.splice(r);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],i[t]])}$Z(e)}}function q1(t){const{ones:e,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=t,o=()=>null!=s?s(e(),n):eZ(e(),n),a=()=>nZ(o,e,r);if(!i||i<=1)return Sr(a().clone());return Array(i).fill(void 0).map(a).map((t=>Sr(t.clone())))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */G1.className="StackedRNNCells",pi(G1);var X1=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};class Y1 extends F1{constructor(t){if(t.unroll)throw new XY("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new XY("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new RZ({ndim:5})]}call(t,e){return xr((()=>{if(null!=this.cell.dropoutMask&&(wr(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(wr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new qY("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return xr((()=>{const{stateSize:e}=this.cell,n=t.shape,r=this.computeSingleOutputShape(n),i=Go([r[0],...r.slice(2)]);return Array.isArray(e)?Array(e.length).fill(i):[i]}))}resetStates(t,e=!1){xr((()=>{if(!this.stateful)throw new HY("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new qY("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Go(i))):this.states_=[Go(i)];else if(null==t)wr(this.states_),null!=this.keptStates&&(wr(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Go(i))):this.states_[0]=Go(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new qY(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):wr(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],r=i;if(!f(n.shape,r))throw new qY(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>Sr(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:r,padding:i,strides:s,dilationRate:o}=this.cell,a="channelsFirst"===e,l=t[a?3:2],c=t[a?4:3],u=v1(l,r[0],i,s[0],o[0]),h=v1(c,r[1],i,s[1],o[1]);return[...t.slice(0,2),...a?[n,u,h]:[u,h,n]]}}Y1.className="ConvRNN2D";class K1 extends W1{constructor(t){const{filters:e,kernelSize:n,strides:r,padding:i,dataFormat:s,dilationRate:o}=t;super(Object.assign({},t,{units:e})),this.filters=e,pK(this.filters,"filters"),this.kernelSize=b1(n,2,"kernelSize"),this.kernelSize.forEach((t=>pK(t,"kernelSize"))),this.strides=b1(r||1,2,"strides"),this.strides.forEach((t=>pK(t,"strides"))),this.padding=i||"valid",MK(this.padding),this.dataFormat=s||"channelsLast",EK(this.dataFormat),this.dilationRate=b1(o||1,2,"dilationRate"),this.dilationRate.forEach((t=>pK(t,"dilationRate")))}build(t){var e;t=CZ(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new qY(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;t=new(e=class extends sZ{apply(t,e){return GK([n.apply([r]),qo([r]),n.apply([2*r])])}},e.className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return xr((()=>{if(3!==t.length)throw new qY(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,r=t[0],i=t[1],s=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=q1({ones:()=>na(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=(t,e,n)=>e&&e[n]?Si(e[n],t):t;let l=a(r,o,0),c=a(r,o,1),u=a(r,o,2),h=a(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=q1({ones:()=>na(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=a(i,d,0),f=a(i,d,1),m=a(i,d,2),g=a(i,d,3);const[y,b,v,x]=hl(this.kernel.read(),4,3),[w,S,_,k]=this.useBias?hl(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,w,this.padding),c=this.inputConv(c,b,S,this.padding),u=this.inputConv(u,v,_,this.padding),h=this.inputConv(h,x,k,this.padding);const[T,E,M,C]=hl(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,T),f=this.recurrentConv(f,E),m=this.recurrentConv(m,M),g=this.recurrentConv(g,C);const A=this.recurrentActivation.apply(vi(l,p)),N=this.recurrentActivation.apply(vi(c,f)),I=vi(Si(N,s),Si(A,this.activation.apply(vi(u,m)))),$=Si(this.recurrentActivation.apply(vi(h,g)),this.activation.apply(I));return[$,$,I]}))}getConfig(){const t=super.getConfig(),e=X1(t,["units"]),n={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},e,n)}inputConv(t,e,n,r){const i=vs(t,e,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?tZ(i,n,this.dataFormat):i}recurrentConv(t,e){return vs(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}K1.className="ConvLSTM2DCell",pi(K1);class Z1 extends Y1{constructor(t){const e=new K1(t);super(Object.assign({},t,{cell:e}))}static fromConfig(t,e){return new t(e)}}Z1.className="ConvLSTM2D",pi(Z1);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class J1 extends FZ{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let t=0;t<this.noiseShape.length;++t)n.push(null==this.noiseShape[t]?e[t]:this.noiseShape[t]);return n}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,r=this.getNoiseShape(n);return nZ((()=>eZ(n,this.rate,r,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}J1.className="Dropout",pi(J1);class Q1 extends J1{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}Q1.className="SpatialDropout1D",pi(Q1);class t2 extends FZ{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,pK(this.units,"units"),this.activation=s1(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=kZ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=kZ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=NQ(t.kernelConstraint),this.biasConstraint=NQ(t.biasConstraint),this.kernelRegularizer=h1(t.kernelRegularizer),this.biasRegularizer=h1(t.biasRegularizer),this.activityRegularizer=h1(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=CZ(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=CZ(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t),r=mK(this.activation.getClassName());let i;return null!=r?i=KK(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=KK(n,this.kernel.read()),null!=this.bias&&(i=tZ(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const t={units:this.units,activation:r1(this.activation),useBias:this.useBias,kernelInitializer:_Z(this.kernelInitializer),biasInitializer:_Z(this.biasInitializer),kernelRegularizer:c1(this.kernelRegularizer),biasRegularizer:c1(this.biasRegularizer),activityRegularizer:c1(this.activityRegularizer),kernelConstraint:CQ(this.kernelConstraint),biasConstraint:CQ(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}t2.className="Dense",pi(t2);class e2 extends FZ{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=CZ(t);for(const e of t.slice(1))if(null==e)throw new qY(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],PK(t,1)]}call(t,e){return xr((()=>{this.invokeCallHook(t,e);let n=MZ(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=Ar(n,t)}return function(t){if(t.rank<=1)throw new qY(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],PK(t.shape,1)];return Ki(t,e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}e2.className="Flatten",pi(e2);class n2 extends FZ{constructor(t){super(t),this.supportsMasking=!0,this.activation=s1(t.activation)}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t);return this.activation.apply(n)}))}getConfig(){const t={activation:r1(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}n2.className="Activation",pi(n2);class r2 extends FZ{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return xr((()=>function(t,e){return xr((()=>{if(2!==t.shape.length)throw new qY(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return XK(VK(t,1),[1,e,1])}))}(t=MZ(t),this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}r2.className="RepeatVector",pi(r2);class i2 extends FZ{constructor(t){super(t),this.targetShape=t.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",r=e.slice();let i=1,s=null;for(let t=0;t<r.length;++t){const e=r[t];if(this.isUnknown(e)){if(null!==s)throw new qY("Can only specifiy one unknown dimension.");s=t}else i*=e}const o=PK(t);if(null!==s){if(0===i||o%i!=0)throw new qY(n);r[s]=o/i}else if(o!==i)throw new qY(n);return r}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return Ki(n,i)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}i2.className="Reshape",pi(i2);class s2 extends FZ{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=FK(1,t.dims.length+1);if(!f(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new RZ({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=CZ(t)).slice();return this.dims.forEach(((n,r)=>{e[r+1]=t[n]})),e}call(t,e){return Ar(MZ(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}s2.className="Permute",pi(s2);class o2 extends FZ{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=MZ(t);return Ci(ea(n,this.maskValue),-1)}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t),r=Ci(ea(n,this.maskValue),-1,!0);return Si(n,Yn(r,n.dtype))}))}}o2.className="Masking",pi(o2);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class a2 extends FZ{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(eK(t.inputLength))}this.inputDim=t.inputDim,pK(this.inputDim,"inputDim"),this.outputDim=t.outputDim,pK(this.outputDim,"outputDim"),this.embeddingsInitializer=kZ(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=h1(t.embeddingsRegularizer),this.activityRegularizer=h1(t.activityRegularizer),this.embeddingsConstraint=NQ(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return xr((()=>this.maskZero?(t=MZ(t),ea(t,Ds(t))):null))}computeOutputShape(t){if(t=CZ(t),null==this.inputLength)return[...t,this.outputDim];const e=eK(this.inputLength);if(e.length!==t.length-1)throw new qY(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=t[r+1];if(null!=i&&null!=s&&i!==s)throw new qY(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==i&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return xr((()=>{this.invokeCallHook(t,e);let n=MZ(t);"int32"!==n.dtype&&(n=UK(n,"int32"));const r=ZK(this.embeddings.read(),Ki(n,[n.size]));return Ki(r,CZ(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:_Z(this.embeddingsInitializer),embeddingsRegularizer:c1(this.embeddingsRegularizer),activityRegularizer:c1(this.activityRegularizer),embeddingsConstraint:CQ(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}a2.className="Embedding",pi(a2);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class l2 extends FZ{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new XY}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],s=e[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new qY("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[CZ(t)]),t.length<2)throw new qY(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const n of t)null!=n&&null!==n[0]&&e.push(n[0]);if(e=cK(e),e.length>1)throw new qY(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let e=1;e<t.length;++e){const r=null==t[e]?null:t[e].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}const r=t.map((t=>t.length));-1===t.indexOf(null)&&1===cK(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return xr((()=>{if(this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const r=DK(n);for(let n of t){const t=n.rank;for(let e=0;e<r-t;++e)n=VK(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const r of t){const t=r.rank;if(null==t){const t=r.shape,i=t[0],s=t.slice(1).concat([i]);let o=Ki(r,[i].concat(PK(t.slice(1))));o=Ar(o,[1,0]),o=Ki(o,s),e.push(o),n=!0}else if(t>1){const i=FK(1,t).concat([0]);e.push(Ar(r,i)),n=!0}else e.push(r)}let r=this.mergeFunction(e);const i=r.rank;if(n)if(null==i){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=Ki(Ar(Ki(r,[-1,e]),[1,0]),n)}else if(i>1){const t=[i-1].concat(FK(0,i-1));r=Ar(r,t)}return r}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==t[0]?null:t[0].slice(1);for(let n=1;n<t.length;++n){const r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}let n=[];for(const e of t)null!=e&&null!==e[0]&&n.push(e[0]);return n=cK(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return xr((()=>{if(null==e)return null;if(!Array.isArray(e))throw new qY("`mask` should be an Array");if(!Array.isArray(t))throw new qY("`inputs` should be an Array");if(e.length!==t.length)throw new qY(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;e=e.map((t=>null==t?t:lo(t,0)));let n=e[0];for(let t=1;t<e.length-1;++t)n=Po(n,e[t]);return n}))}}class c2 extends l2{constructor(t){super(t)}mergeFunction(t){return xr((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=vi(e,t[n]);return e}))}}c2.className="Add",pi(c2);class u2 extends l2{constructor(t){super(t)}mergeFunction(t){return xr((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Si(e,t[n]);return e}))}}u2.className="Multiply",pi(u2);class h2 extends l2{constructor(t){super(t)}mergeFunction(t){return xr((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=vi(e,t[n]);return Si(1/t.length,e)}))}}h2.className="Average",pi(h2);class d2 extends l2{constructor(t){super(t)}mergeFunction(t){return xr((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Wo(e,t[n]);return e}))}}d2.className="Maximum",pi(d2);class p2 extends l2{constructor(t){super(t)}mergeFunction(t){return xr((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Yo(e,t[n]);return e}))}}p2.className="Minimum",pi(p2);class f2 extends l2{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new qY("A `Concatenate` layer should be called on a list of at least 2 inputs");let e=!0;for(const n of t)if(null!=n){e=!1;break}if(e)return;const n=[];for(let e=0;e<t.length;++e){const r=t[e].slice();r.splice(this.axis,1);let i=!1;for(const t of n)if(f(t,r)){i=!0;break}i||n.push(r)}if(n.length>1)throw new qY("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return xr((()=>GK(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new qY("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const t of e.slice(1)){if(null==n[r]||null==t[r]){n[r]=null;break}n[r]+=t[r]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new qY("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new qY("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new qY(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return xr((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const r=[];for(let n=0;n<t.length;++n)null==e[n]?r.push(Yn(na(t[n]),"bool")):e[n].rank<t[n].rank?r.push(lo(e[n],-1)):r.push(e[n]);const i=Qi(r,this.axis);return Mi(i,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function m2(t,e){for(;t<0;)t+=e;return t}f2.className="Concatenate",pi(f2);class g2 extends l2{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){c(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new XY("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new qY(`Dimension incompatibility: ${e[r[0]]} !== ${n[r[1]]}`)}mergeFunction(t){if(2!==t.length)throw new qY(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>m2(e,t[n].shape.length))):[m2(this.axes,n.shape.length),m2(this.axes,r.shape.length)],this.normalize&&(n=jQ(n,e[0]),r=jQ(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new XY("batchDot is not implemented for tensors of 4D or higher rank yet");if(c(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),c(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new XY("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,i=e.shape.length;null==n&&(n=[r-1,i-2]);const s=n;return xr((()=>{let n,o;if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=Ki(e,e.shape.concat(t))}else if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=Ki(t,t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)o=s[0]===s[1]?ro(Si(t,e),s[0]):ro(Si(Ar(t,[1,0]),e),s[1]);else{const n=s[0]!==t.shape.length-1,r=s[1]===e.shape.length-1;o=gr(t,e,n,r)}if(n>0){let t;t=r>i?r+i-3:r-1;const e=[];for(let r=t;r<t+n;++r)e.push(r);o=fl(o,e)}return 1===o.shape.length&&(o=lo(o,1)),o}))}(n,r,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[m2(this.axes,t.length),m2(this.axes,e.length)],n}computeOutputShape(t){c(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new XY("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=e.concat(n);return 1===i.length&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}g2.className="Dot",pi(g2);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class y2 extends FZ{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t);return nZ((()=>vi(YK(n.shape,0,this.stddev),n)),(()=>n),e.training||!1)}))}}y2.className="GaussianNoise",pi(y2);class b2 extends FZ{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return xr((()=>{this.invokeCallHook(t,e);const n=MZ(t);if(this.rate>0&&this.rate<1){return nZ((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return Si(n,YK(n.shape,1,t))}),(()=>n),e.training||!1)}return n}))}}b2.className="GaussianDropout",pi(b2);class v2 extends FZ{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||MZ(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return xr((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return nZ((()=>{const e=MZ(t),r=-1.7580993408473766;let i=go(za(n),this.rate);i=UK(i,"float32");const s=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-s*r*this.rate,a=vi(Si(e,i),Si(vi(i,-1),r));return vi(Si(a,s),o)}),(()=>MZ(t)),e.training||!1)}return t}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function x2(t,e,n,r,i,s=.001){let o;if(2===t.rank)o=os(t,e,n,r,i,s);else if(3===t.rank)o=as(t,e,n,r,i,s);else{if(4!==t.rank)throw new XY(`batchNormalization is not implemented for array of rank ${t.rank} yet`);o=ls(t,e,n,r,i,s)}return o}function w2(t,e,n,r,i=.001){return f(r.slice().sort(),FK(0,t.rank-1))?function(t,e,n,r,i=.001){return xr((()=>{const s=Jo(t,r),o=s.mean,a=s.variance;return[x2(t,o,a,n,e,i),o,a]}))}(t,e,n,r,i):function(t,e,n,r,i=.001){return xr((()=>{const s=Jo(t,r),o=s.mean,a=s.variance,l=[];for(const e of FK(0,t.rank))-1!==r.indexOf(e)?l.push(1):l.push(t.shape[e]);const c=Ki(o,l),u=Ki(a,l),h=null==e?null:Ki(e,l),d=null==n?null:Ki(n,l);return[x2(t,c,u,d,h,i),o,a]}))}(t,e,n,r,i)}v2.className="AlphaDropout",pi(v2);class S2 extends FZ{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=kZ(t.betaInitializer||"zeros"),this.gammaInitializer=kZ(t.gammaInitializer||"ones"),this.movingMeanInitializer=kZ(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=kZ(t.movingVarianceInitializer||"ones"),this.betaConstraint=NQ(t.betaConstraint),this.gammaConstraint=NQ(t.gammaConstraint),this.betaRegularizer=h1(t.betaRegularizer),this.gammaRegularizer=h1(t.gammaRegularizer)}build(t){t=CZ(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new qY(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new RZ({ndim:t.length,axes:{[e]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return xr((()=>{const n=null!=e.training&&e.training,r=MZ(t),i=r.shape,s=i.length,o=FK(0,s),a=this.axis>=0?this.axis:this.axis+s;o.splice(a,1);const l=ZY(1,s);l[a]=i[a];const c=o.slice();c.sort();const u=!f(c,FK(0,s).slice(0,s-1));if(!n)return(()=>{if(u){const t=Ki(this.movingMean.read(),l),e=Ki(this.movingVariance.read(),l),n=this.center?Ki(this.beta.read(),l):null,i=this.scale?Ki(this.gamma.read(),l):null;return x2(r,t,e,n,i,this.epsilon)}return x2(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=w2(r,this.gamma.read(),this.beta.read(),o,this.epsilon),m=(t,e,n)=>{xr((()=>{const r=1-n,i=t.read(),s=Si($o(i,e),r);t.write($o(i,s))}))};return(()=>{m(this.movingMean,d,this.momentum),m(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:_Z(this.betaInitializer),gammaInitializer:_Z(this.gammaInitializer),movingMeanInitializer:_Z(this.movingMeanInitializer),movingVarianceInitializer:_Z(this.movingVarianceInitializer),betaRegularizer:c1(this.betaRegularizer),gammaRegularizer:c1(this.gammaRegularizer),betaConstraint:CQ(this.betaConstraint),gammaConstraint:CQ(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}S2.className="BatchNormalization",pi(S2);class _2 extends FZ{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=kZ(t.betaInitializer||"zeros"),this.gammaInitializer=kZ(t.gammaInitializer||"ones"),this.betaRegularizer=h1(t.betaRegularizer),this.gammaRegularizer=h1(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=CZ(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let t=0;t<this.axis.length;++t)this.axis[t]<0&&(this.axis[t]+=e);for(const t of this.axis)if(t<0||t>=e)throw new Error(`Invalid axis: ${t}`);if(this.axis.length!==cK(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(t,e){const n=MZ(t),r=n.shape,i=r.length;return xr((()=>{let{mean:t,variance:e}=Jo(n,this.axis,!0);const s=ZY(1,i);for(const t of this.axis)s[t]=r[t];const o=t=>null!=t&&t.shape.length!==i?Ki(t,s):t;let a=this.scale?o(this.gamma.read()):null,l=this.center?o(this.beta.read()):null;const c=[],u=[];for(let t=0;t<i;++t)-1!==this.axis.indexOf(t)?(c.push(r[t]),u.push(1)):(c.push(1),u.push(r[t]));return t=uo(t,c),e=uo(e,c),null!=a&&(a=uo(a,u)),null!=l&&(l=uo(l,u)),x2(n,t,e,l,a,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:_Z(this.betaInitializer),gammaInitializer:_Z(this.gammaInitializer),betaRegularizer:c1(this.betaRegularizer),gammaRegularizer:c1(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}_2.className="LayerNormalization",pi(_2);class k2 extends FZ{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new qY(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new qY(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new qY(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new RZ({ndim:4})]}computeOutputShape(t){let e,n;return t=CZ(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return xr((()=>{return e=MZ(t),n=this.padding,r=this.dataFormat,xr((()=>{if(4!==e.rank)throw new qY(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new qY("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new qY(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],ia(e,t)}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var e,n,r}))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function T2(t,e,n,r,i,s){return xr((()=>{let o;EK(i),CK(s),MK(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=w1(t,i);const a="same"===r?"same":"valid";return o="max"===s?Uo(t,e,n,a):Zi(t,e,n,a),"channelsFirst"===i&&(o=Ar(o,[0,3,1,2])),o}))}function E2(t,e,n,r,i,s){return xr((()=>{let o;EK(i),CK(s),MK(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=S1(t,i);const a="same"===r?"same":"valid";return o="max"===s?Vo(t,e,n,a):Ji(t,e,n,a),"channelsFirst"===i&&(o=Ar(o,[0,4,1,2,3])),o}))}k2.className="ZeroPadding2D",pi(k2);class M2 extends FZ{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new qY(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(pK(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new qY(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}pK(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,MK(this.padding),this.inputSpec=[new RZ({ndim:3})]}computeOutputShape(t){const e=v1((t=CZ(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return xr((()=>{this.invokeCallHook(t,e),t=VK(MZ(t),2);const n=this.poolingFunction(MZ(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return fl(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class C2 extends M2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),T2(t,e,n,r,i,"max")}}C2.className="MaxPooling1D",pi(C2);class A2 extends M2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),T2(t,e,n,r,i,"avg")}}A2.className="AveragePooling1D",pi(A2);class N2 extends FZ{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new qY(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];pK(this.poolSize,"poolSize"),pK(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,EK(this.dataFormat),MK(this.padding),this.inputSpec=[new RZ({ndim:4})]}computeOutputShape(t){t=CZ(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=v1(e,this.poolSize[0],this.padding,this.strides[0]),n=v1(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return xr((()=>(this.invokeCallHook(t,e),this.poolingFunction(MZ(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class I2 extends N2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),T2(t,e,n,r,i,"max")}}I2.className="MaxPooling2D",pi(I2);class $2 extends N2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),T2(t,e,n,r,i,"avg")}}$2.className="AveragePooling2D",pi($2);class R2 extends FZ{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new qY(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];pK(this.poolSize,"poolSize"),pK(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,EK(this.dataFormat),MK(this.padding),this.inputSpec=[new RZ({ndim:5})]}computeOutputShape(t){t=CZ(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=v1(e,this.poolSize[0],this.padding,this.strides[0]),n=v1(n,this.poolSize[1],this.padding,this.strides[1]),r=v1(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]}call(t,e){return xr((()=>(this.invokeCallHook(t,e),this.poolingFunction(MZ(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class O2 extends R2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),E2(t,e,n,r,i,"max")}}O2.className="MaxPooling3D",pi(O2);class P2 extends R2{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return EK(i),MK(r),E2(t,e,n,r,i,"avg")}}P2.className="AveragePooling3D",pi(P2);class L2 extends FZ{constructor(t){super(t),this.inputSpec=[new RZ({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new XY}}class D2 extends L2{constructor(t){super(t||{})}call(t,e){return xr((()=>{const e=MZ(t);return Ho(e,1)}))}}D2.className="GlobalAveragePooling1D",pi(D2);class F2 extends L2{constructor(t){super(t||{})}call(t,e){return xr((()=>{const e=MZ(t);return Zs(e,1)}))}}F2.className="GlobalMaxPooling1D",pi(F2);class z2 extends FZ{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,EK(this.dataFormat),this.inputSpec=[new RZ({ndim:4})]}computeOutputShape(t){return"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new XY}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class B2 extends z2{call(t,e){return xr((()=>{const e=MZ(t);return"channelsLast"===this.dataFormat?Ho(e,[1,2]):Ho(e,[2,3])}))}}B2.className="GlobalAveragePooling2D",pi(B2);class U2 extends z2{call(t,e){return xr((()=>{const e=MZ(t);return"channelsLast"===this.dataFormat?Zs(e,[1,2]):Zs(e,[2,3])}))}}U2.className="GlobalMaxPooling2D",pi(U2);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class V2 extends FZ{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const r=VQ(e.layer,n);delete e.layer;const i={layer:r};return Object.assign(i,e),new t(i)}}class j2 extends V2{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=CZ(t)).length<3)throw new qY(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=CZ(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))}call(t,e){return xr((()=>D1(((t,n)=>[MZ(this.layer.call(t,e)),[]]),t=MZ(t),[],!1,null,null,!1,!0)[1]))}}j2.className="TimeDistributed",pi(j2);class W2 extends V2{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=VQ(n),e.goBackwards=!0!==e.goBackwards;const r={};var i;if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=VQ(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,i=this.mergeMode,hK(kK,"BidirectionalMergeMode",i),t.weights)throw new XY("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(r=i.slice(1),e=i[0]):e=i[0],"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):tK(n)}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=L1(t,n,r,this.numConstants);if(t=i.inputs,n=i.initialState,r=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==r)return super.apply(t,e);const s=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new qY("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const r=n.map((t=>new RZ({shape:t.shape})));this.forwardLayer.stateSpec=r.slice(0,t/2),this.backwardLayer.stateSpec=r.slice(t/2),o.push(...r)}if(null!=r)throw new XY("Support for constants in Bidirectional layers is not implemented yet.");const a=s[0]instanceof OZ;for(const t of s)if(t instanceof OZ!==a)throw new qY("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return xr((()=>{const n=e.initialState;let r,i,s,o;if(null==n)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const s=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:s})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Wa(i,1)),"concat"===this.mergeMode?o=GK([r,i]):"sum"===this.mergeMode?o=vi(r,i):"ave"===this.mergeMode?o=Si(.5,vi(r,i)):"mul"===this.mergeMode?o=Si(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(s):[o].concat(s):o}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){NK(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),NK(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=VQ(e.layer);if(delete e.layer,null!=e.numConstants)throw new XY("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=n,new t(r)}}W2.className="Bidirectional",pi(W2);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class H2 extends FZ{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return xr((()=>("float32"!==(t=MZ(t)).dtype&&(t=UK(t,"float32")),vi(Si(t,this.scale),this.offset))))}}function G2(t){return new t2(t)}function q2(t,e){return HQ(t,e)}function X2(t){if(!t.modelTopology.model_config||!t.modelTopology.model_config.config||!t.modelTopology.model_config.config.layers||t.modelTopology.model_config.config.layers.length>0&&!t.modelTopology.model_config.config.layers[0].class_name)return t;try{let e=!1;for(const[n,r]of t.modelTopology.model_config.config.layers.entries())if("SeparableConv2D"===r.class_name){const r=["kernel_constraint","kernel_initializer","kernel_regularizer"];for(const i of r)Object.keys(t.modelTopology.model_config.config.layers[n].config).includes(i)&&(e=!0),delete t.modelTopology.model_config.config.layers[n].config[i]}e&&aU.warning("TFJS Model loading: experimentally removing Kernel attributes from SeparableConv2D layers")}catch(t){aU.warning("TFJS Model loading: An error occurred whil experimentally removing Kernel attributes from SeparableConv2D layers",t)}return t}function Y2(...t){const e=lr(...t),n=e.load.bind(e);return e.load=async function(){return X2(await n())},e}function K2(...t){const e=er(...t),n=e.load.bind(e);return e.load=async function(){return X2(await n())},e}H2.className="Rescaling",pi(H2);class Z2 extends MX{constructor(){super(...arguments),this.serviceName="tfjs-models"}async warmup(){const t=this.model.inputs[0].shape.map((t=>t&&t>0?t:1)),e=this.model.predict(xr((()=>Go(t))));await e.data(),e.dispose()}async save(t,e,n,r=null){if(!this.model)return null;let i;if(t.backend===_q.LocalStorage)await this.model.save(`indexeddb://${e}`),i=[["main",`indexeddb://${e}`]];else if(t.backend===_q.Remote){const e={};if(t.requiresAuth){const n=await t.feathers.authentication.getAccessToken(),r=new Headers({Authorization:`Bearer ${n}`});e.requestInit={headers:r}}i=await this.model.save(Y2(`${t.location}/tfjs-models/upload`,e)).then((t=>t.responses[0].json()))}const s={name:e,files:i,format:"tfjs",metadata:{tfjsModelFormat:this.model instanceof L0?"layers-model":"graph-model",...this.labels&&{labels:this.labels},...n}};return this.saveToDatastore(t,s,r)}async load(t,e){if(!e)return null;this.$training.set({status:"loading"}),this.ready=!1;try{const n=await this.loadFromDatastore(t,e);let r;if(this.loadFn="graph-model"===n.metadata.tfjsModelFormat?jY:U0,t.backend===_q.LocalStorage)r=await this.loadFn(n.files[0][1]);else if(t.backend===_q.Remote){const e={};if(t.requiresAuth){const n=await t.feathers.authentication.getAccessToken(),r=new Headers({Authorization:`Bearer ${n}`});e.requestInit={headers:r}}r=await this.loadFn(Y2(`${t.location}/tfjs-models/${n.id}/model.json`,e))}return r&&(this.model=r,await this.warmup()),n.metadata&&n.metadata.labels?this.labels=n.metadata.labels:this.labels=void 0,this.$training.set({status:"loaded",data:{source:"datastore",url:t.location}}),n}catch(t){throw console.log("[tfjs-model] Loading error",t),this.$training.set({status:"error"}),t}}async download(t){const e=Iq(this.title),n={type:"tfjs-model",tfjsModelFormat:this.model instanceof L0?"layers-model":"graph-model",name:e,...this.labels&&{labels:this.labels},...t},r=new Date(Date.now());await this.model.save(fr((async t=>{const i={modelTopology:t.modelTopology,weightsManifest:[{paths:[`./${e}.weights.bin`],weights:t.weightSpecs}],marcelle:n};return await Aq(t.weightData,`${e}.weights.bin`,"application/octet-stream"),await Aq(JSON.stringify(i),`${e}.json`,"text/plain"),{modelArtifactsInfo:{dateSaved:r,modelTopologyType:"JSON"}}})))}async upload(...t){this.$training.set({status:"loading"});try{const e=t.filter((t=>t.name.includes(".json"))),n=t.filter((t=>t.name.includes(".bin"))),{marcelle:r}=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=t=>n(new Error(`The provided files are not a valid marcelle model ${t}`)),r.readAsText(e[0])}));if(this.loadFn="graph-model"===r.tfjsModelFormat?jY:U0,1===e.length&&t.length){const t=await this.loadFn(K2([e[0],...n]));return t&&(this.model=t,await this.warmup()),r&&r.labels?this.labels=r.labels:this.labels=null,this.$training.set({status:"loaded",data:{source:"file"}}),{name:r.name,format:"tfjs",files:[],metadata:r}}const i=new Error("The provided files are not compatible with this model");throw i.name="File upload error",i}catch(t){throw this.$training.set({status:"error"}),t}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
function J2(t,e){return Q2(t,e)}function Q2(t,e,n=new Map,r=new Set){if(null==t)return null;if("function"==typeof Blob&&t instanceof Blob)return t.slice();if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(r3(t)){const i=Array.isArray(t)?[]:{};r.add(t);for(const s in t){const o=Q2(t[s],e,n,r);i[s]=o}return r.delete(t),t.__proto__&&(i.__proto__=t.__proto__),i}throw new Error(`Can't recurse into non-iterable type: ${t}`)}return n.set(t,i.value),i.value}function t3(t,e=n3){return e3(t,e)}function e3(t,e,n=new Set){const r=t[0];if(n.has(r))throw new Error("Circular references are not supported.");const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(r3(r)){const i=Array.isArray(r)?[]:{};n.add(r);for(const s in r){const r=e3(t.map((t=>t[s])),e,n);i[s]=r}return n.delete(r),i}throw new Error(`Can't recurse into non-iterable type: ${r}`)}return i.value}function n3(t){return null===t?null:r3(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function r3(t){let e=!1;if(X().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");e=t instanceof n}return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof we)&&!(t instanceof Promise)&&!e)}function i3(t){return t instanceof we?{value:t.clone(),recurse:!1}:r3(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */jB([cU],Z2.prototype,"warmup",null),jB([cU],Z2.prototype,"upload",null),
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.gather=function(t,e){return this.throwIfDisposed(),fo(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.argMax=function(t){return this.throwIfDisposed(),Ai(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.squeeze=function(t){return this.throwIfDisposed(),fl(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.expandDims=function(t){return this.throwIfDisposed(),lo(this,t)};class s3{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class o3 extends s3{constructor(){super(o3.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let t=0;t<n;t++)e[t]=this.get(this.wrap(this.begin+t));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function a3(t){return new u3(t)}o3.INITIAL_CAPACITY=32;class l3{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();for(;!n.done;)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);for(;!e.done&&n;)e=await this.next(),n=t(e.value)}handleErrors(t){return new y3(this,t)}filter(t){return new m3(this,t)}map(t){return new g3(this,t)}mapAsync(t){return new b3(this,t)}serialMapAsync(t){return new b3(this,t).serial()}flatmap(t){return new x3(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile((t=>!0===t))}rowMajorBatch(t,e=!0){return new f3(this,t,e)}columnMajorBatch(t,e=!0,n=n3){return this.rowMajorBatch(t,e).map((t=>t3(t,n)))}concatenate(t,e){return new w3(new c3([this,t]),e)}take(t){return t<0||null==t?this:new p3(this,t)}skip(t){return t<0||null==t?this:new d3(this,t)}prefetch(t){return new T3(this,t)}shuffle(t,e){return new E3(this,t,e)}serial(){return new h3(this)}}class c3 extends l3{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:(e=t,J2(e,i3)),done:!1};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var e}}class u3 extends l3{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class h3 extends l3{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class d3 extends l3{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;wr(t.value)}return this.upstream.next()}}class p3 extends l3{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class f3 extends l3{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class m3 extends l3{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;wr(t.value)}}}class g3 extends l3{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Pe(t.value),n=this.transform(t.value),r=Pe(n);for(const t of e)Oe(t,r)||t.dispose();return{value:n,done:!1}}}class y3 extends l3{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class b3 extends l3{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Pe(t.value),n=await this.transform(t.value),r=Pe(n);for(const t of e)Oe(t,r)||t.dispose();return{value:n,done:!1}}}class v3 extends l3{constructor(){super(),this.outputQueue=new o3,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class x3 extends v3{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=Pe(t.value),n=this.transform(t.value),r=Pe(n);this.outputQueue.pushAll(n);for(const t of e)Oe(t,r)||t.dispose();return!0}}class w3 extends l3{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}var S3,_3,k3;!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(S3||(S3={}));class T3 extends l3{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new s3(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class E3 extends T3{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=$a.alea(n||oe().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class M3{constructor(){this.size=null}batch(t,e=!0){const n=this;let r;return c(t>0,(()=>`batchSize needs to be positive, but it is\n      ${t}`)),r=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),C3((async()=>(await n.iterator()).columnMajorBatch(t,e,A3)),r)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,C3((async()=>(await e.iterator()).concatenate(await t.iterator())),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,C3((async()=>(await e.iterator()).filter((e=>xr((()=>t(e)))))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return C3((async()=>(await e.iterator()).map((e=>xr((()=>t(e)))))),this.size)}mapAsync(t){const e=this;return C3((async()=>(await e.iterator()).mapAsync(t)),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return C3((async()=>(await e.iterator()).prefetch(t)),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,C3((async()=>{const n=a3((async()=>({value:await e.iterator(),done:!1})));return r=n.take(t),new w3(r,i);var r,i}),n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,C3((async()=>(await e.iterator()).skip(t)),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=$a.alea(e||oe().toString());return C3((async()=>{let e=i.int32();return n&&(e+=i.int32()),(await r.iterator()).shuffle(t,e.toString())}),this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,C3((async()=>(await e.iterator()).take(t)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function C3(t,e=null){return new class extends M3{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function A3(t){if(null===t)return null;const e=t[0];if(null==(n=e)||null===(r=n)||"object"!=typeof r&&"function"!=typeof r||Array.isArray(n)||"object"==typeof n&&n instanceof we||M(n)){return{value:function(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof we?ml(t):rn(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */(t),recurse:!1}}var n,r;return{value:null,recurse:!0}}function N3(t,e=null,n=!1){const r=e?{$select:e}:{},i=EX(t)?t.items().query(r):t,s=n?i.toArray():Promise.resolve(i);return function(t){return C3((async()=>{const e=await t();return a3((()=>e.next()))}))}((async function*(){const t=await s;for await(const e of t)yield e}))}function I3(t){const e={};for(const[n,r]of Object.entries(t)){e[n.startsWith("val_")?n.replace("val_","")+"Val":n]=r}return e}M3.MAX_BUFFER_SIZE=1e4;class $3 extends Z2{constructor({epochs:t=20,batchSize:e=8,validationSplit:n=.2}={}){super(),this.title="TFJSCustomModel",this.loadFn=U0,this.validationSplit=Math.max(Math.min(n,1),0),this.parameters={epochs:new rU(t,!0),batchSize:new rU(e,!0)}}transformDataset(t){return t.map((t=>({xs:rn(t.x),ys:rn(t.y)})))}async train(t,e){this.$training.set({status:"start",epochs:this.parameters.epochs.get()});const n=EX(t)?t.$count.value:(await t.toArray()).length,r=Math.min(200,n),i=this.transformDataset(N3(t,["x","y"],n<200)).shuffle(r);let s,o;if(e)s=i,o=this.transformDataset(N3(e,["x","y"],n<200)).shuffle(r);else{const t=Math.floor(n*(1-this.validationSplit));s=i.take(t),o=this.validationSplit>0&&i.skip(t)}const[{xs:a,ys:l}]=await s.take(1).toArray();this.buildModel(a.shape,l.shape),this.fit(s,o)}_predict(t){return this.model?xr((()=>this.model.predict(rn(t).expandDims(0)).gather(0))):null}clear(){delete this.model}fit(t,e){this.model.fitDataset(t.batch(this.parameters.batchSize.get()),{...e?{validationData:e.batch(this.parameters.batchSize.get())}:{},epochs:this.parameters.epochs.get(),callbacks:{onEpochEnd:(t,e)=>{this.$training.set({status:"epoch",epoch:t+1,epochs:this.parameters.epochs.get(),data:I3(e)})}}}).then((t=>{this.$training.set({status:"success",data:I3(t.history)})})).catch((t=>{throw this.$training.set({status:"error",data:t}),new uU(t.message)}))}}jB([cU],$3.prototype,"train",null);class R3 extends $3{constructor(){super(...arguments),this.title="TFJSCustomClassifier"}async train(t,e){const n=EX(t);if(this.labels=n?await t.distinct("y"):this.labels=Array.from(new Set(await t.map((({y:t})=>t)).toArray())),0===this.labels.length)return hU(new uU("This dataset is empty or is missing labels")),void this.$training.set({status:"error"});if(1===this.labels.length)return hU(new uU("At least two classes are needed to train the classifier")),void this.$training.set({status:"error"});const r=this.labels.length;this.transformDataset=t=>t.map((t=>({xs:rn(t.x),ys:yr(this.labels.indexOf(t.y),r)}))),super.train(t,e)}async predict(t){return this.model?xr((()=>{const e=this._predict(t),n=this.labels[e.argMax().arraySync()],r=e.arraySync().reduce(((t,e,n)=>({...t,[this.labels[n]]:e})),{});return{label:n,confidences:r}})):{label:void 0,confidences:{}}}}function O3(t){let e;return{c(){e=zT("div"),e.textContent="This dataStore does not require authentication"},m(t,n){LT(t,e,n)},p:uT,i:uT,o:uT,d(t){t&&DT(e)}}}function P3(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:F3,then:D3,catch:L3,value:3,blocks:[,,,]};return VE(n=t[1].connect(),i),{c(){e=jT(),i.block.c()},m(t,n){LT(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,2&r&&n!==(n=t[1].connect())&&VE(n,i)||jE(i,t,r)},i(t){r||(FE(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){zE(i.blocks[t])}r=!1},d(t){t&&DT(e),i.block.d(t),i.token=null,i=null}}}function L3(t){return{c:uT,m:uT,p:uT,i:uT,o:uT,d:uT}}function D3(t){let e,n,r,i,s,o,a,l,c=t[3].email+"";return{c(){e=zT("p"),n=UT("Hello, "),r=UT(c),i=VT(),s=zT("div"),o=zT("button"),o.textContent="Log out",GT(e,"class","pb-2"),GT(o,"class","btn danger"),GT(s,"class","flex")},m(c,u){LT(c,e,u),RT(e,n),RT(e,r),LT(c,i,u),LT(c,s,u),RT(s,o),a||(l=WT(o,"click",t[2]),a=!0)},p(t,e){2&e&&c!==(c=t[3].email+"")&&XT(r,c)},i:uT,o:uT,d(t){t&&DT(e),t&&DT(i),t&&DT(s),a=!1,l()}}}function F3(t){let e,n;return e=new XM({}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p:uT,i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function z3(t){let e,n,r,i;const s=[P3,O3],o=[];function a(t,e){return t[1].requiresAuth?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=jT()},m(t,n){o[e].m(t,n),LT(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(LE(),zE(o[l],1,1,(()=>{o[l]=null})),DE(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),FE(n,1),n.m(r.parentNode,r))},i(t){i||(FE(n),i=!0)},o(t){zE(n),i=!1},d(t){o[e].d(t),t&&DT(r)}}}function B3(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[z3]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),18&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function U3(t,e,n){let{title:r}=e,{dataStore:i}=e;return t.$$set=t=>{"title"in t&&n(0,r=t.title),"dataStore"in t&&n(1,i=t.dataStore)},[r,i,function(){i.logout()}]}jB([cU],R3.prototype,"train",null);class V3 extends QE{constructor(t){super(),JE(this,t,U3,B3,gT,{title:0,dataStore:1})}}class j3 extends SU{constructor(t){super(),this.title="account manager",_3.set(this,void 0),HB(this,_3,t,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new V3({target:e,props:{title:this.title,dataStore:WB(this,_3,"f")}}))}}function W3(...t){return new j3(...t)}function H3(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[2]?.message+"",m=Math.floor(100*t[2]?.progress)+"";return d=new BM({props:{progress:t[2]?.progress,type:t[2]?.type}}),{c(){e=zT("div"),n=zT("div"),r=zT("div"),i=zT("span"),s=UT(f),o=VT(),a=zT("div"),l=zT("span"),c=UT(m),u=UT("%"),h=VT(),YE(d.$$.fragment),GT(i,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200 svelte-cymqgb"),tE(i,"gray","idle"===t[2]?.type),tE(i,"green","success"===t[2]?.type),tE(i,"red","danger"===t[2]?.type),GT(l,"class","text-xs font-semibold inline-block text-blue-600 svelte-cymqgb"),tE(l,"tgray","idle"===t[2]?.type),tE(l,"tgreen","success"===t[2]?.type),tE(l,"tred","danger"===t[2]?.type),GT(a,"class","text-right"),GT(n,"class","flex mb-2 items-center justify-between"),GT(e,"class","relative pt-6 w-full"),KT(e,"min-width","250px")},m(t,f){LT(t,e,f),RT(e,n),RT(n,r),RT(r,i),RT(i,s),RT(n,o),RT(n,a),RT(a,l),RT(l,c),RT(l,u),RT(e,h),KE(d,e,null),p=!0},p(t,e){(!p||4&e)&&f!==(f=t[2]?.message+"")&&XT(s,f),(!p||4&e)&&tE(i,"gray","idle"===t[2]?.type),(!p||4&e)&&tE(i,"green","success"===t[2]?.type),(!p||4&e)&&tE(i,"red","danger"===t[2]?.type),(!p||4&e)&&m!==(m=Math.floor(100*t[2]?.progress)+"")&&XT(c,m),(!p||4&e)&&tE(l,"tgray","idle"===t[2]?.type),(!p||4&e)&&tE(l,"tgreen","success"===t[2]?.type),(!p||4&e)&&tE(l,"tred","danger"===t[2]?.type);const n={};4&e&&(n.progress=t[2]?.progress),4&e&&(n.type=t[2]?.type),d.$set(n)},i(t){p||(FE(d.$$.fragment,t),p=!0)},o(t){zE(d.$$.fragment,t),p=!1},d(t){t&&DT(e),ZE(d)}}}function G3(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[H3]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),12&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function q3(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(2,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{progress:a}=e;return s(),t.$$set=t=>{"title"in t&&n(0,o=t.title),"progress"in t&&s(n(1,a=t.progress))},[o,a,r]}_3=new WeakMap;class X3 extends QE{constructor(t){super(),JE(this,t,q3,G3,gT,{title:0,progress:1})}}class Y3 extends SU{constructor(t){super(),this.$progress=t,this.title="progress bar",this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new X3({target:e,props:{title:this.title,progress:this.$progress}}))}}function K3(...t){return new Y3(...t)}function Z3(t){if(!t.$training)throw new Error("The argument is not a valid MLP");const e=t.$training.map((({status:t,epoch:e,epochs:n})=>{let r="default",i=n>0?e/n:null;return"error"===t&&(r="danger"),"idle"===t&&(r="idle",i=0),["success","loaded"].includes(t)&&(r="success",i=1),["start","loading"].includes(t)&&(i=null),{message:`Status: ${t}`,progress:i,type:r}})).hold(),n=new Y3(e);return n.title="Training Progress",n}class J3 extends SU{constructor(t,e=Cq()){super(),this.title="batch prediction",k3.set(this,void 0),this.$status=new rU({status:"loading"},!0),this.name=t,this.title=`batch prediction (${t})`,HB(this,k3,e||new Mq,"f"),this.start(),WB(this,k3,"f").connect().then((()=>{this.setup()})).catch((e=>{const n=new Error(null==e?void 0:e.message);n.name=`Batch Prediction Error (${t}): Datastore connection failed`,hU(n,{duration:0})}))}async setup(){const t=Iq(`predictions-${this.name}`);this.predictionService=WB(this,k3,"f").service(t);const{total:e}=await this.predictionService.find({query:{$limit:1,$select:["id"]}});this.$status.set({status:e>0?"loaded":"idle"})}async predict(t,e){try{const n=EX(e)?e.$count.value:(await e.toArray()).length;this.$status.set({status:"start"});const r=EX(e)?e.items():e;let i=0;for await(const{id:e,x:s,y:o}of r){const r=await t.predict(s),a=await this.predictionService.create({...r,instanceId:e,yTrue:o});this.$status.set({status:"running",count:++i,total:n,data:a})}this.$status.set({status:"success",count:i,total:n})}catch(t){this.$status.set({status:"error",data:{error:t}})}}async clear(){await this.predictionService.remove(null,{query:{}})}items(){return this.predictionService.items()}mount(){}}function Q3(...t){return new J3(...t)}function t4(t){if(!t.$status)throw new Error("The argument is not a valid Batch Prediction");const e=t.$status.map((({status:t,count:e,total:n})=>{let r="default",i=n>0?(e+1)/n:null;return"error"===t&&(r="danger"),"idle"===t&&(r="idle",i=0),["success","loaded"].includes(t)&&(r="success",i=1),["start","loading"].includes(t)&&(i=null),{message:`Status: ${t}`,progress:i,type:r}})).hold(),n=K3(e);return n.title="Prediction Progress",n}function e4(t){let e;return{c(){e=UT(t[10])},m(t,n){LT(t,e,n)},p(t,n){1024&n&&XT(e,t[10])},d(t){t&&DT(e)}}}function n4(t){let e,n,r,i;function s(e){t[11](e)}let o={disabled:t[7],type:t[8],$$slots:{default:[e4]},$$scope:{ctx:t}};return void 0!==t[9]&&(o.pressed=t[9]),n=new nM({props:o}),bE.push((()=>XE(n,"pressed",s))),n.$on("click",t[12]),{c(){e=zT("div"),YE(n.$$.fragment)},m(t,r){LT(t,e,r),KE(n,e,null),i=!0},p(t,e){const i={};128&e&&(i.disabled=t[7]),256&e&&(i.type=t[8]),9216&e&&(i.$$scope={dirty:e,ctx:t}),!r&&512&e&&(r=!0,i.pressed=t[9],EE((()=>r=!1))),n.$set(i)},i(t){i||(FE(n.$$.fragment,t),i=!0)},o(t){zE(n.$$.fragment,t),i=!1},d(t){t&&DT(e),ZE(n)}}}function r4(t){let e,n;return e=new zL({props:{title:t[0],loading:t[6],$$slots:{default:[n4]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),64&n&&(r.loading=t[6]),10112&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function i4(t,e,n){let r,i,s,o,a,l=uT,c=()=>(l(),l=vT(w,(t=>n(6,r=t))),w),u=uT,h=()=>(u(),u=vT(S,(t=>n(7,i=t))),S),d=uT,p=()=>(d(),d=vT(_,(t=>n(8,s=t))),_),f=uT,m=()=>(f(),f=vT(x,(t=>n(9,o=t))),x),g=uT,y=()=>(g(),g=vT(v,(t=>n(10,a=t))),v);t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u())),t.$$.on_destroy.push((()=>d())),t.$$.on_destroy.push((()=>f())),t.$$.on_destroy.push((()=>g()));let{title:b}=e,{text:v}=e;y();let{pressed:x}=e;m();let{loading:w}=e;c();let{disabled:S}=e;h();let{type:_}=e;return p(),t.$$set=t=>{"title"in t&&n(0,b=t.title),"text"in t&&y(n(1,v=t.text)),"pressed"in t&&m(n(2,x=t.pressed)),"loading"in t&&c(n(3,w=t.loading)),"disabled"in t&&h(n(4,S=t.disabled)),"type"in t&&p(n(5,_=t.type))},[b,v,x,w,S,_,r,i,s,o,a,function(t){o=t,x.set(o)},function(e){gE.call(this,t,e)}]}k3=new WeakMap;class s4 extends QE{constructor(t){super(),JE(this,t,i4,r4,gT,{title:0,text:1,pressed:2,loading:3,disabled:4,type:5})}}class o4 extends SU{constructor(t="click me"){super(),this.title="button",this.$click=new rU(JD()),this.$pressed=new rU(!1,!0),this.$loading=new rU(!1,!0),this.$disabled=new rU(!1,!0),this.$type=new rU("default",!0),this.$text=new rU(t,!0),this.start(),this.$loading.skip(1).subscribe((t=>{this.$disabled.set(t)}))}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new s4({target:e,props:{title:this.title,text:this.$text,pressed:this.$pressed,loading:this.$loading,disabled:this.$disabled,type:this.$type}}),this.$$.app.$on("click",this.$click.set))}}function a4(...t){return new o4(...t)}var l4,c4,u4={exports:{}},h4=vt(WY),d4=vt(uh);function p4(t){let e,n;return{c(){e=UT("COCO-SSD loaded with base "),n=UT(t[2])},m(t,r){LT(t,e,r),LT(t,n,r)},p(t,e){4&e&&XT(n,t[2])},d(t){t&&DT(e),t&&DT(n)}}}function f4(t){let e;return{c(){e=UT("")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function m4(t){let e;function n(t,e){return t[3]?f4:p4}let r=n(t),i=r(t);return{c(){e=zT("p"),i.c(),GT(e,"class","p-2 text-sm text-gray-600")},m(t,n){LT(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&DT(e),i.d()}}}function g4(t){let e,n;return e=new zL({props:{title:t[0],loading:t[3],$$slots:{default:[m4]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading=t[3]),28&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function y4(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{base:l}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"base"in t&&n(2,l=t.base)},[o,a,l,r]}!function(t,e,n){const r={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class i{constructor(t,e){this.modelPath=e||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(t)}/model.json`}getPrefix(t){return"lite_mobilenet_v2"===t?`ssd${t}`:`ssd_${t}`}async load(){this.model=await e.loadGraphModel(this.modelPath);const t=n.zeros([1,300,300,3],"int32"),r=await this.model.executeAsync(t);await Promise.all(r.map((t=>t.data()))),r.map((t=>t.dispose())),t.dispose()}async infer(t,e,r){const i=n.tidy((()=>(t instanceof n.Tensor||(t=n.browser.fromPixels(t)),n.expandDims(t)))),s=i.shape[1],o=i.shape[2],a=await this.model.executeAsync(i),l=a[0].dataSync(),c=a[1].dataSync();i.dispose(),n.dispose(a);const[u,h]=this.calculateMaxScores(l,a[0].shape[1],a[0].shape[2]),d=n.getBackend();"webgl"===n.getBackend()&&n.setBackend("cpu");const p=n.tidy((()=>{const t=n.tensor2d(c,[a[1].shape[1],a[1].shape[3]]);return n.image.nonMaxSuppression(t,u,e,r,r)})),f=p.dataSync();return p.dispose(),d!==n.getBackend()&&n.setBackend(d),this.buildDetectedObjects(o,s,c,u,f,h)}buildDetectedObjects(t,e,n,i,s,o){const a=s.length,l=[];for(let c=0;c<a;c++){const a=[];for(let t=0;t<4;t++)a[t]=n[4*s[c]+t];const u=a[0]*e,h=a[1]*t,d=a[2]*e,p=a[3]*t;a[0]=h,a[1]=u,a[2]=p-h,a[3]=d-u,l.push({bbox:a,class:r[o[s[c]]+1].displayName,score:i[s[c]]})}return l}calculateMaxScores(t,e,n){const r=[],i=[];for(let s=0;s<e;s++){let e=Number.MIN_VALUE,o=-1;for(let r=0;r<n;r++)t[s*n+r]>e&&(e=t[s*n+r],o=r);r[s]=e,i[s]=o}return[r,i]}async detect(t,e=20,n=.5){return this.infer(t,e,n)}dispose(){null!=this.model&&this.model.dispose()}}t.ObjectDetection=i,t.load=async function(t={}){if(null==n)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const e=t.base||"lite_mobilenet_v2",r=t.modelUrl;if(-1===["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(e))throw new Error(`ObjectDetection constructed with invalid base model ${e}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const s=new i(e,r);return await s.load(),s},t.version="2.2.2",Object.defineProperty(t,"__esModule",{value:!0})}(u4.exports,h4,d4);class b4 extends QE{constructor(t){super(),JE(this,t,y4,g4,gT,{title:0,loading:1,base:2})}}class v4 extends MX{constructor({base:t="lite_mobilenet_v2"}={}){super(),this.title="COCO-SSD Object Detection",this.parameters={},this.serviceName="undefined",l4.set(this,void 0),c4.set(this,void 0),this.$loading=new rU(!0,!0),HB(this,c4,t,"f"),this.setup()}async setup(){const t=await Vn(),e=Object.keys(t).filter((t=>t.includes("cocossd")));try{HB(this,l4,await u4.exports.load({base:WB(this,c4,"f"),modelUrl:`indexeddb://cocossd-${WB(this,c4,"f")}`}),"f")}catch(t){e.length>0&&await jn(e[0]),HB(this,l4,await u4.exports.load({base:WB(this,c4,"f")}),"f"),await WB(this,l4,"f").model.save(`indexeddb://cocossd-${WB(this,c4,"f")}`)}aU.info("COCO-SSD loaded with base `lite_mobilenet_v2`"),this.$loading.set(!1),this.start()}train(){throw new uU("Model `CocoSsd` cannot be trained")}async predict(t){if(!WB(this,l4,"f"))throw new Error("Model is not loaded");return{outputs:(await WB(this,l4,"f").detect(t)).map((t=>({bbox:t.bbox,class:t.class,confidence:t.score})))}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new b4({target:e,props:{title:this.title,loading:this.$loading,base:WB(this,c4,"f")}}))}save(){throw new Error("CocoSsd does not support saving")}load(){throw new Error("CocoSsd does not support loading")}download(){throw new Error("CocoSsd does not support downloading")}upload(){throw new Error("CocoSsd does not support uploading")}}function x4(...t){return new v4(...t)}
/*!
 * Chart.js v3.8.2
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */l4=new WeakMap,c4=new WeakMap,jB([cU],v4.prototype,"train",null),jB([cU],v4.prototype,"predict",null),jB([cU],v4.prototype,"save",null),jB([cU],v4.prototype,"load",null),jB([cU],v4.prototype,"download",null),jB([cU],v4.prototype,"upload",null);const w4="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function S4(t,e,n){const r=n||(t=>Array.prototype.slice.call(t));let i=!1,s=[];return function(...n){s=r(n),i||(i=!0,w4.call(window,(()=>{i=!1,t.apply(e,s)})))}}const _4=t=>"start"===t?"left":"end"===t?"right":"center",k4=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function T4(){}const E4=function(){let t=0;return function(){return t++}}();function M4(t){return null==t}function C4(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function A4(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const N4=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function I4(t,e){return N4(t)?t:e}function $4(t,e){return void 0===t?e:t}const R4=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function O4(t,e,n){if(t&&"function"==typeof t.call)return t.apply(n,e)}function P4(t,e,n,r){let i,s,o;if(C4(t))if(s=t.length,r)for(i=s-1;i>=0;i--)e.call(n,t[i],i);else for(i=0;i<s;i++)e.call(n,t[i],i);else if(A4(t))for(o=Object.keys(t),s=o.length,i=0;i<s;i++)e.call(n,t[o[i]],o[i])}function L4(t,e){let n,r,i,s;if(!t||!e||t.length!==e.length)return!1;for(n=0,r=t.length;n<r;++n)if(i=t[n],s=e[n],i.datasetIndex!==s.datasetIndex||i.index!==s.index)return!1;return!0}function D4(t){if(C4(t))return t.map(D4);if(A4(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=D4(t[n[i]]);return e}return t}function F4(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function z4(t,e,n,r){if(!F4(t))return;const i=e[t],s=n[t];A4(i)&&A4(s)?B4(i,s,r):e[t]=D4(s)}function B4(t,e,n){const r=C4(e)?e:[e],i=r.length;if(!A4(t))return t;const s=(n=n||{}).merger||z4;for(let o=0;o<i;++o){if(e=r[o],!A4(e))continue;const i=Object.keys(e);for(let r=0,o=i.length;r<o;++r)s(i[r],t,e,n)}return t}function U4(t,e){return B4(t,e,{merger:V4})}function V4(t,e,n){if(!F4(t))return;const r=e[t],i=n[t];A4(r)&&A4(i)?U4(r,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=D4(i))}function j4(t,e){const n=t.indexOf(".",e);return-1===n?t.length:n}function W4(t,e){if(""===e)return t;let n=0,r=j4(e,n);for(;t&&r>n;)t=t[e.slice(n,r)],n=r+1,r=j4(e,n);return t}function H4(t){return t.charAt(0).toUpperCase()+t.slice(1)}const G4=t=>void 0!==t,q4=t=>"function"==typeof t,X4=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};const Y4=Math.PI,K4=2*Y4,Z4=K4+Y4,J4=Number.POSITIVE_INFINITY,Q4=Y4/180,t5=Y4/2,e5=Y4/4,n5=2*Y4/3,r5=Math.log10,i5=Math.sign;function s5(t){const e=Math.round(t);t=a5(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(r5(t))),r=t/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function o5(t){return!isNaN(parseFloat(t))&&isFinite(t)}function a5(t,e,n){return Math.abs(t-e)<n}function l5(t,e,n){let r,i,s;for(r=0,i=t.length;r<i;r++)s=t[r][n],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function c5(t){return t*(Y4/180)}function u5(t){return t*(180/Y4)}function h5(t){if(!N4(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function d5(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s<-.5*Y4&&(s+=K4),{angle:s,distance:i}}function p5(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function f5(t,e){return(t-e+Z4)%K4-Y4}function m5(t){return(t%K4+K4)%K4}function g5(t,e,n,r){const i=m5(t),s=m5(e),o=m5(n),a=m5(s-i),l=m5(o-i),c=m5(i-s),u=m5(i-o);return i===s||i===o||r&&s===o||a>l&&c<u}function y5(t,e,n){return Math.max(e,Math.min(n,t))}function b5(t,e,n,r=1e-6){return t>=Math.min(e,n)-r&&t<=Math.max(e,n)+r}const v5=t=>0===t||1===t,x5=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*K4/n),w5=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*K4/n)+1,S5={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*t5),easeOutSine:t=>Math.sin(t*t5),easeInOutSine:t=>-.5*(Math.cos(Y4*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>v5(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>v5(t)?t:x5(t,.075,.3),easeOutElastic:t=>v5(t)?t:w5(t,.075,.3),easeInOutElastic(t){const e=.1125;return v5(t)?t:t<.5?.5*x5(2*t,e,.45):.5+.5*w5(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-S5.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*S5.easeInBounce(2*t):.5*S5.easeOutBounce(2*t-1)+.5};
/*!
 * @kurkle/color v0.2.1
 * https://github.com/kurkle/color#readme
 * (c) 2022 Jukka Kurkela
 * Released under the MIT License
 */
function _5(t){return t+.5|0}const k5=(t,e,n)=>Math.max(Math.min(t,n),e);function T5(t){return k5(_5(2.55*t),0,255)}function E5(t){return k5(_5(255*t),0,255)}function M5(t){return k5(_5(t/2.55)/100,0,1)}function C5(t){return k5(_5(100*t),0,100)}const A5={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},N5=[..."0123456789ABCDEF"],I5=t=>N5[15&t],$5=t=>N5[(240&t)>>4]+N5[15&t],R5=t=>(240&t)>>4==(15&t);function O5(t){var e=(t=>R5(t.r)&&R5(t.g)&&R5(t.b)&&R5(t.a))(t)?I5:$5;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const P5=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function L5(t,e,n){const r=e*Math.min(n,1-n),i=(e,i=(e+t/30)%12)=>n-r*Math.max(Math.min(i-3,9-i,1),-1);return[i(0),i(8),i(4)]}function D5(t,e,n){const r=(r,i=(r+t/60)%6)=>n-n*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function F5(t,e,n){const r=L5(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function z5(t){const e=t.r/255,n=t.g/255,r=t.b/255,i=Math.max(e,n,r),s=Math.min(e,n,r),o=(i+s)/2;let a,l,c;return i!==s&&(c=i-s,l=o>.5?c/(2-i-s):c/(i+s),a=function(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}(e,n,r,c,i),a=60*a+.5),[0|a,l||0,o]}function B5(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(E5)}function U5(t,e,n){return B5(L5,t,e,n)}function V5(t){return(t%360+360)%360}function j5(t){const e=P5.exec(t);let n,r=255;if(!e)return;e[5]!==n&&(r=e[6]?T5(+e[5]):E5(+e[5]));const i=V5(+e[2]),s=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return B5(F5,t,e,n)}(i,s,o):"hsv"===e[1]?function(t,e,n){return B5(D5,t,e,n)}(i,s,o):U5(i,s,o),{r:n[0],g:n[1],b:n[2],a:r}}const W5={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},H5={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let G5;function q5(t){G5||(G5=function(){const t={},e=Object.keys(H5),n=Object.keys(W5);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,W5[s]);s=parseInt(H5[o],16),t[a]=[s>>16&255,s>>8&255,255&s]}return t}(),G5.transparent=[0,0,0,0]);const e=G5[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const X5=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Y5=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,K5=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Z5(t,e,n){if(t){let r=z5(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,0===e?360:1)),r=U5(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function J5(t,e){return t?Object.assign(e||{},t):t}function Q5(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=E5(t[3]))):(e=J5(t,{r:0,g:0,b:0,a:1})).a=E5(e.a),e}function t6(t){return"r"===t.charAt(0)?function(t){const e=X5.exec(t);let n,r,i,s=255;if(e){if(e[7]!==n){const t=+e[7];s=e[8]?T5(t):k5(255*t,0,255)}return n=+e[1],r=+e[3],i=+e[5],n=255&(e[2]?T5(n):k5(n,0,255)),r=255&(e[4]?T5(r):k5(r,0,255)),i=255&(e[6]?T5(i):k5(i,0,255)),{r:n,g:r,b:i,a:s}}}(t):j5(t)}class e6{constructor(t){if(t instanceof e6)return t;const e=typeof t;let n;var r,i,s;"object"===e?n=Q5(t):"string"===e&&(s=(r=t).length,"#"===r[0]&&(4===s||5===s?i={r:255&17*A5[r[1]],g:255&17*A5[r[2]],b:255&17*A5[r[3]],a:5===s?17*A5[r[4]]:255}:7!==s&&9!==s||(i={r:A5[r[1]]<<4|A5[r[2]],g:A5[r[3]]<<4|A5[r[4]],b:A5[r[5]]<<4|A5[r[6]],a:9===s?A5[r[7]]<<4|A5[r[8]]:255})),n=i||q5(t)||t6(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=J5(this._rgb);return t&&(t.a=M5(t.a)),t}set rgb(t){this._rgb=Q5(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${M5(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?O5(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=z5(t),n=e[0],r=C5(e[1]),i=C5(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${M5(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,r=t.rgb;let i;const s=e===i?.5:e,o=2*s-1,a=n.a-r.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;i=1-l,n.r=255&l*n.r+i*r.r+.5,n.g=255&l*n.g+i*r.g+.5,n.b=255&l*n.b+i*r.b+.5,n.a=s*n.a+(1-s)*r.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const r=K5(M5(t.r)),i=K5(M5(t.g)),s=K5(M5(t.b));return{r:E5(Y5(r+n*(K5(M5(e.r))-r))),g:E5(Y5(i+n*(K5(M5(e.g))-i))),b:E5(Y5(s+n*(K5(M5(e.b))-s))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new e6(this.rgb)}alpha(t){return this._rgb.a=E5(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=_5(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Z5(this._rgb,2,t),this}darken(t){return Z5(this._rgb,2,-t),this}saturate(t){return Z5(this._rgb,1,t),this}desaturate(t){return Z5(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=z5(t);n[0]=V5(n[0]+e),n=U5(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function n6(t){return new e6(t)}function r6(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function i6(t){return r6(t)?t:n6(t)}function s6(t){return r6(t)?t:n6(t).saturate(.5).darken(.1).hexString()}const o6=Object.create(null),a6=Object.create(null);function l6(t,e){if(!e)return t;const n=e.split(".");for(let e=0,r=n.length;e<r;++e){const r=n[e];t=t[r]||(t[r]=Object.create(null))}return t}function c6(t,e,n){return"string"==typeof e?B4(l6(t,e),n):B4(l6(t,""),e)}var u6=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>s6(e.backgroundColor),this.hoverBorderColor=(t,e)=>s6(e.borderColor),this.hoverColor=(t,e)=>s6(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return c6(this,t,e)}get(t){return l6(this,t)}describe(t,e){return c6(a6,t,e)}override(t,e){return c6(o6,t,e)}route(t,e,n,r){const i=l6(this,t),s=l6(this,n),o="_"+e;Object.defineProperties(i,{[o]:{value:i[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=s[r];return A4(t)?Object.assign({},e,t):$4(t,e)},set(t){this[o]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function h6(t,e,n,r,i){let s=e[i];return s||(s=e[i]=t.measureText(i).width,n.push(i)),s>r&&(r=s),r}function d6(t,e,n,r){let i=(r=r||{}).data=r.data||{},s=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},s=r.garbageCollect=[],r.font=e),t.save(),t.font=e;let o=0;const a=n.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=n[l],null!=h&&!0!==C4(h))o=h6(t,i,s,o,h);else if(C4(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||C4(d)||(o=h6(t,i,s,o,d));t.restore();const p=s.length/2;if(p>n.length){for(l=0;l<p;l++)delete i[s[l]];s.splice(0,p)}return o}function p6(t,e,n){const r=t.currentDevicePixelRatio,i=0!==n?Math.max(n/2,.5):0;return Math.round((e-i)*r)/r+i}function f6(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function m6(t,e,n,r){g6(t,e,n,r,null)}function g6(t,e,n,r,i){let s,o,a,l,c,u;const h=e.pointStyle,d=e.rotation,p=e.radius;let f=(d||0)*Q4;if(h&&"object"==typeof h&&(s=h.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return t.save(),t.translate(n,r),t.rotate(f),t.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),void t.restore();if(!(isNaN(p)||p<=0)){switch(t.beginPath(),h){default:i?t.ellipse(n,r,i/2,p,0,0,K4):t.arc(n,r,p,0,K4),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(f)*p,r-Math.cos(f)*p),f+=n5,t.lineTo(n+Math.sin(f)*p,r-Math.cos(f)*p),f+=n5,t.lineTo(n+Math.sin(f)*p,r-Math.cos(f)*p),t.closePath();break;case"rectRounded":c=.516*p,l=p-c,o=Math.cos(f+e5)*l,a=Math.sin(f+e5)*l,t.arc(n-o,r-a,c,f-Y4,f-t5),t.arc(n+a,r-o,c,f-t5,f),t.arc(n+o,r+a,c,f,f+t5),t.arc(n-a,r+o,c,f+t5,f+Y4),t.closePath();break;case"rect":if(!d){l=Math.SQRT1_2*p,u=i?i/2:l,t.rect(n-u,r-l,2*u,2*l);break}f+=e5;case"rectRot":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+a,r-o),t.lineTo(n+o,r+a),t.lineTo(n-a,r+o),t.closePath();break;case"crossRot":f+=e5;case"cross":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o);break;case"star":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o),f+=e5,o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o);break;case"line":o=i?i/2:Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a);break;case"dash":t.moveTo(n,r),t.lineTo(n+Math.cos(f)*p,r+Math.sin(f)*p)}t.fill(),e.borderWidth>0&&t.stroke()}}function y6(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function b6(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function v6(t){t.restore()}function x6(t,e,n,r,i){if(!e)return t.lineTo(n.x,n.y);if("middle"===i){const r=(e.x+n.x)/2;t.lineTo(r,e.y),t.lineTo(r,n.y)}else"after"===i!=!!r?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function w6(t,e,n,r){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function S6(t,e,n,r,i,s={}){const o=C4(e)?e:[e],a=s.strokeWidth>0&&""!==s.strokeColor;let l,c;for(t.save(),t.font=i.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]);M4(e.rotation)||t.rotate(e.rotation);e.color&&(t.fillStyle=e.color);e.textAlign&&(t.textAlign=e.textAlign);e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,s),l=0;l<o.length;++l)c=o[l],a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),M4(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(c,n,r,s.maxWidth)),t.fillText(c,n,r,s.maxWidth),_6(t,n,r,c,s),r+=i.lineHeight;t.restore()}function _6(t,e,n,r,i){if(i.strikethrough||i.underline){const s=t.measureText(r),o=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,l=n-s.actualBoundingBoxAscent,c=n+s.actualBoundingBoxDescent,u=i.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(o,u),t.lineTo(a,u),t.stroke()}}function k6(t,e){const{x:n,y:r,w:i,h:s,radius:o}=e;t.arc(n+o.topLeft,r+o.topLeft,o.topLeft,-t5,Y4,!0),t.lineTo(n,r+s-o.bottomLeft),t.arc(n+o.bottomLeft,r+s-o.bottomLeft,o.bottomLeft,Y4,t5,!0),t.lineTo(n+i-o.bottomRight,r+s),t.arc(n+i-o.bottomRight,r+s-o.bottomRight,o.bottomRight,t5,0,!0),t.lineTo(n+i,r+o.topRight),t.arc(n+i-o.topRight,r+o.topRight,o.topRight,0,-t5,!0),t.lineTo(n+o.topLeft,r)}const T6=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),E6=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function M6(t,e){const n=(""+t).match(T6);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}function C6(t,e){const n={},r=A4(e),i=r?Object.keys(e):e,s=A4(t)?r?n=>$4(t[n],t[e[n]]):e=>t[e]:()=>t;for(const t of i)n[t]=+s(t)||0;return n}function A6(t){return C6(t,{top:"y",right:"x",bottom:"y",left:"x"})}function N6(t){return C6(t,["topLeft","topRight","bottomLeft","bottomRight"])}function I6(t){const e=A6(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function $6(t,e){t=t||{},e=e||u6.font;let n=$4(t.size,e.size);"string"==typeof n&&(n=parseInt(n,10));let r=$4(t.style,e.style);r&&!(""+r).match(E6)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const i={family:$4(t.family,e.family),lineHeight:M6($4(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:$4(t.weight,e.weight),string:""};return i.string=function(t){return!t||M4(t.size)||M4(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(i),i}function R6(t,e,n,r){let i,s,o,a=!0;for(i=0,s=t.length;i<s;++i)if(o=t[i],void 0!==o&&(void 0!==e&&"function"==typeof o&&(o=o(e),a=!1),void 0!==n&&C4(o)&&(o=o[n%o.length],a=!1),void 0!==o))return r&&!a&&(r.cacheable=!1),o}function O6(t,e){return Object.assign(Object.create(t),e)}function P6(t,e,n){n=n||(n=>t[n]<e);let r,i=t.length-1,s=0;for(;i-s>1;)r=s+i>>1,n(r)?s=r:i=r;return{lo:s,hi:i}}const L6=(t,e,n)=>P6(t,n,(r=>t[r][e]<n)),D6=(t,e,n)=>P6(t,n,(r=>t[r][e]>=n));const F6=["push","pop","shift","splice","unshift"];function z6(t,e){const n=t._chartjs;if(!n)return;const r=n.listeners,i=r.indexOf(e);-1!==i&&r.splice(i,1),r.length>0||(F6.forEach((e=>{delete t[e]})),delete t._chartjs)}function B6(t){const e=new Set;let n,r;for(n=0,r=t.length;n<r;++n)e.add(t[n]);return e.size===r?t:Array.from(e)}function U6(t,e=[""],n=t,r,i=(()=>t[0])){G4(r)||(r=J6("_fallback",t));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:r,_getTarget:i,override:i=>U6([i,...t],e,n,r)};return new Proxy(s,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,r)=>G6(n,r,(()=>function(t,e,n,r){let i;for(const s of e)if(i=J6(W6(s,t),n),G4(i))return H6(t,i)?K6(n,r,t,i):i}(r,e,t,n))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>Q6(t).includes(e),ownKeys:t=>Q6(t),set(t,e,n){const r=t._storage||(t._storage=i());return t[e]=r[e]=n,delete t._keys,!0}})}function V6(t,e,n,r){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:j6(t,r),setContext:e=>V6(t,e,n,r),override:i=>V6(t.override(i),e,n,r)};return new Proxy(i,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>G6(t,e,(()=>function(t,e,n){const{_proxy:r,_context:i,_subProxy:s,_descriptors:o}=t;let a=r[e];q4(a)&&o.isScriptable(e)&&(a=function(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);a.add(t),e=e(s,o||r),a.delete(t),H6(t,e)&&(e=K6(i._scopes,i,t,e));return e}(e,a,t,n));C4(a)&&a.length&&(a=function(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_descriptors:a}=n;if(G4(s.index)&&r(t))e=e[s.index%e.length];else if(A4(e[0])){const n=e,r=i._scopes.filter((t=>t!==n));e=[];for(const l of n){const n=K6(r,i,t,l);e.push(V6(n,s,o&&o[t],a))}}return e}(e,a,t,o.isIndexable));H6(e,a)&&(a=V6(a,i,s&&s[e],o));return a}(t,e,n))),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,r)=>(t[n]=r,delete e[n],!0)})}function j6(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:r,isScriptable:q4(n)?n:()=>n,isIndexable:q4(r)?r:()=>r}}const W6=(t,e)=>t?t+H4(e):e,H6=(t,e)=>A4(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function G6(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const r=n();return t[e]=r,r}function q6(t,e,n){return q4(t)?t(e,n):t}const X6=(t,e)=>!0===t?e:"string"==typeof t?W4(e,t):void 0;function Y6(t,e,n,r,i){for(const s of e){const e=X6(n,s);if(e){t.add(e);const s=q6(e._fallback,n,i);if(G4(s)&&s!==n&&s!==r)return s}else if(!1===e&&G4(r)&&n!==r)return null}return!1}function K6(t,e,n,r){const i=e._rootScopes,s=q6(e._fallback,n,r),o=[...t,...i],a=new Set;a.add(r);let l=Z6(a,o,n,s||n,r);return null!==l&&((!G4(s)||s===n||(l=Z6(a,o,s,l,r),null!==l))&&U6(Array.from(a),[""],i,s,(()=>function(t,e,n){const r=t._getTarget();e in r||(r[e]={});const i=r[e];if(C4(i)&&A4(n))return n;return i}(e,n,r))))}function Z6(t,e,n,r,i){for(;n;)n=Y6(t,e,n,r,i);return n}function J6(t,e){for(const n of e){if(!n)continue;const e=n[t];if(G4(e))return e}}function Q6(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function t8(t,e,n,r){const{iScale:i}=t,{key:s="r"}=this._parsing,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+n,u=e[c],o[a]={r:i.parse(W4(u,s),c)};return o}const e8=Number.EPSILON||1e-14,n8=(t,e)=>e<t.length&&!t[e].skip&&t[e],r8=t=>"x"===t?"y":"x";function i8(t,e,n,r){const i=t.skip?e:t,s=e,o=n.skip?e:n,a=p5(s,i),l=p5(o,s);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=r*c,d=r*u;return{previous:{x:s.x-h*(o.x-i.x),y:s.y-h*(o.y-i.y)},next:{x:s.x+d*(o.x-i.x),y:s.y+d*(o.y-i.y)}}}function s8(t,e="x"){const n=r8(e),r=t.length,i=Array(r).fill(0),s=Array(r);let o,a,l,c=n8(t,0);for(o=0;o<r;++o)if(a=l,l=c,c=n8(t,o+1),l){if(c){const t=c[e]-l[e];i[o]=0!==t?(c[n]-l[n])/t:0}s[o]=a?c?i5(i[o-1])!==i5(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}!function(t,e,n){const r=t.length;let i,s,o,a,l,c=n8(t,0);for(let u=0;u<r-1;++u)l=c,c=n8(t,u+1),l&&c&&(a5(e[u],0,e8)?n[u]=n[u+1]=0:(i=n[u]/e[u],s=n[u+1]/e[u],a=Math.pow(i,2)+Math.pow(s,2),a<=9||(o=3/Math.sqrt(a),n[u]=i*o*e[u],n[u+1]=s*o*e[u])))}(t,i,s),function(t,e,n="x"){const r=r8(n),i=t.length;let s,o,a,l=n8(t,0);for(let c=0;c<i;++c){if(o=a,a=l,l=n8(t,c+1),!a)continue;const i=a[n],u=a[r];o&&(s=(i-o[n])/3,a[`cp1${n}`]=i-s,a[`cp1${r}`]=u-s*e[c]),l&&(s=(l[n]-i)/3,a[`cp2${n}`]=i+s,a[`cp2${r}`]=u+s*e[c])}}(t,s,e)}function o8(t,e,n){return Math.max(Math.min(t,n),e)}function a8(t,e,n,r,i){let s,o,a,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)s8(t,i);else{let n=r?t[t.length-1]:t[0];for(s=0,o=t.length;s<o;++s)a=t[s],l=i8(n,a,t[Math.min(s+1,o-(r?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,n=a}e.capBezierPoints&&function(t,e){let n,r,i,s,o,a=y6(t[0],e);for(n=0,r=t.length;n<r;++n)o=s,s=a,a=n<r-1&&y6(t[n+1],e),s&&(i=t[n],o&&(i.cp1x=o8(i.cp1x,e.left,e.right),i.cp1y=o8(i.cp1y,e.top,e.bottom)),a&&(i.cp2x=o8(i.cp2x,e.left,e.right),i.cp2y=o8(i.cp2y,e.top,e.bottom)))}(t,n)}function l8(){return"undefined"!=typeof window&&"undefined"!=typeof document}function c8(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function u8(t,e,n){let r;return"string"==typeof t?(r=parseInt(t,10),-1!==t.indexOf("%")&&(r=r/100*e.parentNode[n])):r=t,r}const h8=t=>window.getComputedStyle(t,null);const d8=["top","right","bottom","left"];function p8(t,e,n){const r={};n=n?"-"+n:"";for(let i=0;i<4;i++){const s=d8[i];r[s]=parseFloat(t[e+"-"+s+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function f8(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:r}=e,i=h8(n),s="border-box"===i.boxSizing,o=p8(i,"padding"),a=p8(i,"border","width"),{x:l,y:c,box:u}=function(t,e){const n=t.touches,r=n&&n.length?n[0]:t,{offsetX:i,offsetY:s}=r;let o,a,l=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(i,s,t.target))o=i,a=s;else{const t=e.getBoundingClientRect();o=r.clientX-t.left,a=r.clientY-t.top,l=!0}return{x:o,y:a,box:l}}(t,n),h=o.left+(u&&a.left),d=o.top+(u&&a.top);let{width:p,height:f}=e;return s&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-h)/p*n.width/r),y:Math.round((c-d)/f*n.height/r)}}const m8=t=>Math.round(10*t)/10;function g8(t,e,n,r){const i=h8(t),s=p8(i,"margin"),o=u8(i.maxWidth,t,"clientWidth")||J4,a=u8(i.maxHeight,t,"clientHeight")||J4,l=function(t,e,n){let r,i;if(void 0===e||void 0===n){const s=c8(t);if(s){const t=s.getBoundingClientRect(),o=h8(s),a=p8(o,"border","width"),l=p8(o,"padding");e=t.width-l.width-a.width,n=t.height-l.height-a.height,r=u8(o.maxWidth,s,"clientWidth"),i=u8(o.maxHeight,s,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:r||J4,maxHeight:i||J4}}(t,e,n);let{width:c,height:u}=l;if("content-box"===i.boxSizing){const t=p8(i,"border","width"),e=p8(i,"padding");c-=e.width+t.width,u-=e.height+t.height}return c=Math.max(0,c-s.width),u=Math.max(0,r?Math.floor(c/r):u-s.height),c=m8(Math.min(c,o,l.maxWidth)),u=m8(Math.min(u,a,l.maxHeight)),c&&!u&&(u=m8(c/2)),{width:c,height:u}}function y8(t,e,n){const r=e||1,i=Math.floor(t.height*r),s=Math.floor(t.width*r);t.height=i/r,t.width=s/r;const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==r||o.height!==i||o.width!==s)&&(t.currentDevicePixelRatio=r,o.height=i,o.width=s,t.ctx.setTransform(r,0,0,r,0,0),!0)}const b8=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function v8(t,e){const n=function(t,e){return h8(t).getPropertyValue(e)}(t,e),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function x8(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function w8(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:"middle"===r?n<.5?t.y:e.y:"after"===r?n<1?t.y:e.y:n>0?e.y:t.y}}function S8(t,e,n,r){const i={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},o=x8(t,i,n),a=x8(i,s,n),l=x8(s,e,n),c=x8(o,a,n),u=x8(a,l,n);return x8(c,u,n)}const _8=new Map;function k8(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let r=_8.get(n);return r||(r=new Intl.NumberFormat(t,e),_8.set(n,r)),r}(e,n).format(t)}function T8(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function E8(t,e){let n,r;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=r)}function M8(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function C8(t){return"angle"===t?{between:g5,compare:f5,normalize:m5}:{between:b5,compare:(t,e)=>t-e,normalize:t=>t}}function A8({start:t,end:e,count:n,loop:r,style:i}){return{start:t%n,end:e%n,loop:r&&(e-t+1)%n==0,style:i}}function N8(t,e,n){if(!n)return[t];const{property:r,start:i,end:s}=n,o=e.length,{compare:a,between:l,normalize:c}=C8(r),{start:u,end:h,loop:d,style:p}=function(t,e,n){const{property:r,start:i,end:s}=n,{between:o,normalize:a}=C8(r),l=e.length;let c,u,{start:h,end:d,loop:p}=t;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(a(e[h%l][r]),i,s);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:t.style}}(t,e,n),f=[];let m,g,y,b=!1,v=null;const x=()=>b||l(i,y,m)&&0!==a(i,y),w=()=>!b||0===a(s,m)||l(s,y,m);for(let t=u,n=u;t<=h;++t)g=e[t%o],g.skip||(m=c(g[r]),m!==y&&(b=l(m,i,s),null===v&&x()&&(v=0===a(m,i)?t:n),null!==v&&w()&&(f.push(A8({start:v,end:t,loop:d,count:o,style:p})),v=null),n=t,y=m));return null!==v&&f.push(A8({start:v,end:h,loop:d,count:o,style:p})),f}function I8(t,e){const n=[],r=t.segments;for(let i=0;i<r.length;i++){const s=N8(r[i],t.points,e);s.length&&n.push(...s)}return n}function $8(t,e,n,r){return r&&r.setContext&&n?function(t,e,n,r){const i=t._chart.getContext(),s=R8(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=n.length,c=[];let u=s,h=e[0].start,d=h;function p(t,e,r,i){const s=a?-1:1;if(t!==e){for(t+=l;n[t%l].skip;)t-=s;for(;n[e%l].skip;)e+=s;t%l!=e%l&&(c.push({start:t%l,end:e%l,loop:r,style:i}),u=i,h=e%l)}}for(const t of e){h=a?h:t.start;let e,s=n[h%l];for(d=h+1;d<=t.end;d++){const a=n[d%l];e=R8(r.setContext(O6(i,{type:"segment",p0:s,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),O8(e,u)&&p(h,d-1,t.loop,u),s=a,u=e}h<d-1&&p(h,d-1,t.loop,u)}return c}(t,e,n,r):e}function R8(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function O8(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}
/*!
 * Chart.js v3.8.2
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */var P8=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,r){const i=e.listeners[r],s=e.duration;i.forEach((r=>r({chart:t,initial:e.initial,numSteps:s,currentStep:Math.min(n-e.start,s)})))}_refresh(){this._request||(this._running=!0,this._request=w4.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((n,r)=>{if(!n.running||!n.items.length)return;const i=n.items;let s,o=i.length-1,a=!1;for(;o>=0;--o)s=i[o],s._active?(s._total>n.duration&&(n.duration=s._total),s.tick(t),a=!0):(i[o]=i[i.length-1],i.pop());a&&(r.draw(),this._notify(r,n,t,"progress")),i.length||(n.running=!1,this._notify(r,n,t,"complete"),n.initial=!1),e+=i.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let r=n.length-1;for(;r>=0;--r)n[r].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};const L8={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const r=i6(t||"transparent"),i=r.valid&&i6(e||"transparent");return i&&i.valid?i.mix(r,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class D8{constructor(t,e,n,r){const i=e[n];r=R6([t.to,r,i,t.from]);const s=R6([t.from,i,r]);this._active=!0,this._fn=t.fn||L8[t.type||typeof s],this._easing=S5[t.easing]||S5.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=s,this._to=r,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const r=this._target[this._prop],i=n-this._start,s=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=i,this._loop=!!t.loop,this._to=R6([t.to,e,r,t.from]),this._from=R6([t.from,r,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,r=this._prop,i=this._from,s=this._loop,o=this._to;let a;if(this._active=i!==o&&(s||e<n),!this._active)return this._target[r]=o,void this._notify(!0);e<0?this._target[r]=i:(a=e/n%2,a=s&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[r]=this._fn(i,o,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,n)=>{t.push({res:e,rej:n})}))}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let t=0;t<n.length;t++)n[t][e]()}}u6.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const F8=Object.keys(u6.animation);u6.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),u6.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),u6.describe("animations",{_fallback:"animation"}),u6.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class z8{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!A4(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const r=t[n];if(!A4(r))return;const i={};for(const t of F8)i[t]=r[t];(C4(r.properties)&&r.properties||[n]).forEach((t=>{t!==n&&e.has(t)||e.set(t,i)}))}))}_animateOptions(t,e){const n=e.options,r=function(t,e){if(!e)return;let n=t.options;if(!n)return void(t.options=e);n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(t,n);if(!r)return[];const i=this._createAnimations(r,n);return n.$shared&&function(t,e){const n=[],r=Object.keys(e);for(let e=0;e<r.length;e++){const i=t[r[e]];i&&i.active()&&n.push(i.wait())}return Promise.all(n)}(t.options.$animations,n).then((()=>{t.options=n}),(()=>{})),i}_createAnimations(t,e){const n=this._properties,r=[],i=t.$animations||(t.$animations={}),s=Object.keys(e),o=Date.now();let a;for(a=s.length-1;a>=0;--a){const l=s[a];if("$"===l.charAt(0))continue;if("options"===l){r.push(...this._animateOptions(t,e));continue}const c=e[l];let u=i[l];const h=n.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(i[l]=u=new D8(h,t,l,c),r.push(u)):t[l]=c}return r}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(P8.add(this._chart,n),!0):void 0}}function B8(t,e){const n=t&&t.options||{},r=n.reverse,i=void 0===n.min?e:0,s=void 0===n.max?e:0;return{start:r?s:i,end:r?i:s}}function U8(t,e){const n=[],r=t._getSortedDatasetMetas(e);let i,s;for(i=0,s=r.length;i<s;++i)n.push(r[i].index);return n}function V8(t,e,n,r={}){const i=t.keys,s="single"===r.mode;let o,a,l,c;if(null!==e){for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===n){if(r.all)continue;break}c=t.values[l],N4(c)&&(s||0===e||i5(e)===i5(c))&&(e+=c)}return e}}function j8(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function W8(t,e,n){const r=t[e]||(t[e]={});return r[n]||(r[n]={})}function H8(t,e,n,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const e=t[i.index];if(n&&e>0||!n&&e<0)return i.index}return null}function G8(t,e){const{chart:n,_cachedMeta:r}=t,i=n._stacks||(n._stacks={}),{iScale:s,vScale:o,index:a}=r,l=s.axis,c=o.axis,u=function(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}(s,o,r),h=e.length;let d;for(let t=0;t<h;++t){const n=e[t],{[l]:s,[c]:h}=n;d=(n._stacks||(n._stacks={}))[c]=W8(i,u,s),d[a]=h,d._top=H8(d,o,!0,r.type),d._bottom=H8(d,o,!1,r.type)}}function q8(t,e){const n=t.scales;return Object.keys(n).filter((t=>n[t].axis===e)).shift()}function X8(t,e){const n=t.controller.index,r=t.vScale&&t.vScale.axis;if(r){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[r]||void 0===e[r][n])return;delete e[r][n]}}}const Y8=t=>"reset"===t||"none"===t,K8=(t,e)=>e?t:Object.assign({},t);class Z8{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=j8(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&X8(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),r=(t,e,n,r)=>"x"===t?e:"r"===t?r:n,i=e.xAxisID=$4(n.xAxisID,q8(t,"x")),s=e.yAxisID=$4(n.yAxisID,q8(t,"y")),o=e.rAxisID=$4(n.rAxisID,q8(t,"r")),a=e.indexAxis,l=e.iAxisID=r(a,i,s,o),c=e.vAxisID=r(a,s,i,o);e.xScale=this.getScaleForId(i),e.yScale=this.getScaleForId(s),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&z6(this._data,this),t._stacked&&X8(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(A4(e))this._data=function(t){const e=Object.keys(t),n=new Array(e.length);let r,i,s;for(r=0,i=e.length;r<i;++r)s=e[r],n[r]={x:s,y:t[s]};return n}(e);else if(n!==e){if(n){z6(n,this);const t=this._cachedMeta;X8(t),t._parsed=[]}e&&Object.isExtensible(e)&&(i=this,(r=e)._chartjs?r._chartjs.listeners.push(i):(Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),F6.forEach((t=>{const e="_onData"+H4(t),n=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...t){const i=n.apply(this,t);return r._chartjs.listeners.forEach((n=>{"function"==typeof n[e]&&n[e](...t)})),i}})})))),this._syncList=[],this._data=e}var r,i}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let r=!1;this._dataCheck();const i=e._stacked;e._stacked=j8(e.vScale,e),e.stack!==n.stack&&(r=!0,X8(e),e.stack=n.stack),this._resyncElements(t),(r||i!==e._stacked)&&G8(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:r}=this,{iScale:i,_stacked:s}=n,o=i.axis;let a,l,c,u=0===t&&e===r.length||n._sorted,h=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=r,n._sorted=!0,c=r;else{c=C4(r[t])?this.parseArrayData(n,r,t,e):A4(r[t])?this.parseObjectData(n,r,t,e):this.parsePrimitiveData(n,r,t,e);const i=()=>null===l[o]||h&&l[o]<h[o];for(a=0;a<e;++a)n._parsed[a+t]=l=c[a],u&&(i()&&(u=!1),h=l);n._sorted=u}s&&G8(this,c)}parsePrimitiveData(t,e,n,r){const{iScale:i,vScale:s}=t,o=i.axis,a=s.axis,l=i.getLabels(),c=i===s,u=new Array(r);let h,d,p;for(h=0,d=r;h<d;++h)p=h+n,u[h]={[o]:c||i.parse(l[p],p),[a]:s.parse(e[p],p)};return u}parseArrayData(t,e,n,r){const{xScale:i,yScale:s}=t,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+n,u=e[c],o[a]={x:i.parse(u[0],c),y:s.parse(u[1],c)};return o}parseObjectData(t,e,n,r){const{xScale:i,yScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(r);let c,u,h,d;for(c=0,u=r;c<u;++c)h=c+n,d=e[h],l[c]={x:i.parse(W4(d,o),h),y:s.parse(W4(d,a),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const r=this.chart,i=this._cachedMeta,s=e[t.axis];return V8({keys:U8(r,!0),values:e._stacks[t.axis]},s,i.index,{mode:n})}updateRangeFromParsed(t,e,n,r){const i=n[e.axis];let s=null===i?NaN:i;const o=r&&n._stacks[e.axis];r&&o&&(r.values=o,s=V8(r,i,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,e){const n=this._cachedMeta,r=n._parsed,i=n._sorted&&t===n.iScale,s=r.length,o=this._getOtherScale(t),a=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:U8(n,!0),values:null})(e,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(t){const{min:e,max:n,minDefined:r,maxDefined:i}=t.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=r[h];const e=d[o.axis];return!N4(d[t.axis])||c>e||u<e}for(h=0;h<s&&(p()||(this.updateRangeFromParsed(l,t,d,a),!i));++h);if(i)for(h=s-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,t,d,a);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let r,i,s;for(r=0,i=e.length;r<i;++r)s=e[r][t.axis],N4(s)&&n.push(s);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,r=e.vScale,i=this.getParsed(t);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:r?""+r.getLabelForValue(i[r.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,r,i;return A4(t)?(e=t.top,n=t.right,r=t.bottom,i=t.left):e=n=r=i=t,{top:e,right:n,bottom:r,left:i,disabled:!1===t}}($4(this.options.clip,function(t,e,n){if(!1===n)return!1;const r=B8(t,n),i=B8(e,n);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,r=n.data||[],i=e.chartArea,s=[],o=this._drawStart||0,a=this._drawCount||r.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(t,i,o,a),c=o;c<o+a;++c){const e=r[c];e.hidden||(e.active&&l?s.push(e):e.draw(t,i))}for(c=0;c<s.length;++c)s[c].draw(t,i)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const r=this.getDataset();let i;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];i=e.$context||(e.$context=function(t,e,n){return O6(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),i.parsed=this.getParsed(t),i.raw=r.data[t],i.index=i.dataIndex=t}else i=this.$context||(this.$context=function(t,e){return O6(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),i.dataset=r,i.index=i.datasetIndex=this.index;return i.active=!!e,i.mode=n,i}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",n){const r="active"===e,i=this._cachedDataOpts,s=t+"-"+e,o=i[s],a=this.enableOptionSharing&&G4(n);if(o)return K8(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),u=r?[`${t}Hover`,"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(u6.elements[t]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(n,r)),u);return p.$shared&&(p.$shared=a,i[s]=Object.freeze(K8(p,a))),p}_resolveAnimations(t,e,n){const r=this.chart,i=this._cachedDataOpts,s=`animation-${e}`,o=i[s];if(o)return o;let a;if(!1!==r.options.animation){const r=this.chart.config,i=r.datasetAnimationScopeKeys(this._type,e),s=r.getOptionScopes(this.getDataset(),i);a=r.createResolver(s,this.getContext(t,n,e))}const l=new z8(r,a&&a.animations);return a&&a._cacheable&&(i[s]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Y8(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),r=this._sharedOptions,i=this.getSharedOptions(n),s=this.includeOptions(e,i)||i!==r;return this.updateSharedOptions(i,e,n),{sharedOptions:i,includeOptions:s}}updateElement(t,e,n,r){Y8(r)?Object.assign(t,n):this._resolveAnimations(e,r).update(t,n)}updateSharedOptions(t,e,n){t&&!Y8(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,r){t.active=r;const i=this.getStyle(e,r);this._resolveAnimations(e,n,r).update(t,{options:!r&&this.getSharedOptions(i)||i})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[t,e,n]of this._syncList)this[t](e,n);this._syncList=[];const r=n.length,i=e.length,s=Math.min(i,r);s&&this.parse(0,s),i>r?this._insertElements(r,i-r,t):i<r&&this._removeElements(i,r-i)}_insertElements(t,e,n=!0){const r=this._cachedMeta,i=r.data,s=t+e;let o;const a=t=>{for(t.length+=e,o=t.length-1;o>=s;o--)t[o]=t[o-e]};for(a(i),o=t;o<s;++o)i[o]=new this.dataElementType;this._parsing&&a(r._parsed),this.parse(t,e),n&&this.updateElements(i,t,e,"reset")}updateElements(t,e,n,r){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const r=n._parsed.splice(t,e);n._stacked&&X8(n,r)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,r]=t;this[e](n,r)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function J8(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let r=[];for(let e=0,i=n.length;e<i;e++)r=r.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=B6(r.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let r,i,s,o,a=e._length;const l=()=>{32767!==s&&-32768!==s&&(G4(o)&&(a=Math.min(a,Math.abs(s-o)||a)),o=s)};for(r=0,i=n.length;r<i;++r)s=e.getPixelForValue(n[r]),l();for(o=void 0,r=0,i=e.ticks.length;r<i;++r)s=e.getPixelForTick(r),l();return a}function Q8(t,e,n,r){return C4(t)?function(t,e,n,r){const i=n.parse(t[0],r),s=n.parse(t[1],r),o=Math.min(i,s),a=Math.max(i,s);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:i,end:s,min:o,max:a}}(t,e,n,r):e[n.axis]=n.parse(t,r),e}function t7(t,e,n,r){const i=t.iScale,s=t.vScale,o=i.getLabels(),a=i===s,l=[];let c,u,h,d;for(c=n,u=n+r;c<u;++c)d=e[c],h={},h[i.axis]=a||i.parse(o[c],c),l.push(Q8(d,h,s,c));return l}function e7(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function n7(t,e,n,r){let i=e.borderSkipped;const s={};if(!i)return void(t.borderSkipped=s);const{start:o,end:a,reverse:l,top:c,bottom:u}=function(t){let e,n,r,i,s;return t.horizontal?(e=t.base>t.x,n="left",r="right"):(e=t.base<t.y,n="bottom",r="top"),e?(i="end",s="start"):(i="start",s="end"),{start:n,end:r,reverse:e,top:i,bottom:s}}(t);"middle"===i&&n&&(t.enableBorderRadius=!0,(n._top||0)===r?i=c:(n._bottom||0)===r?i=u:(s[r7(u,o,a,l)]=!0,i=c)),s[r7(i,o,a,l)]=!0,t.borderSkipped=s}function r7(t,e,n,r){var i,s,o;return r?(o=n,t=i7(t=(i=t)===(s=e)?o:i===o?s:i,n,e)):t=i7(t,e,n),t}function i7(t,e,n){return"start"===t?e:"end"===t?n:t}function s7(t,{inflateAmount:e},n){t.inflateAmount="auto"===e?1===n?.33:0:e}Z8.defaults={},Z8.prototype.datasetElementType=null,Z8.prototype.dataElementType=null;class o7 extends Z8{parsePrimitiveData(t,e,n,r){return t7(t,e,n,r)}parseArrayData(t,e,n,r){return t7(t,e,n,r)}parseObjectData(t,e,n,r){const{iScale:i,vScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===i.axis?o:a,c="x"===s.axis?o:a,u=[];let h,d,p,f;for(h=n,d=n+r;h<d;++h)f=e[h],p={},p[i.axis]=i.parse(W4(f,l),h),u.push(Q8(W4(f,c),p,s,h));return u}updateRangeFromParsed(t,e,n,r){super.updateRangeFromParsed(t,e,n,r);const i=n._custom;i&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,i.min),t.max=Math.max(t.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:r}=e,i=this.getParsed(t),s=i._custom,o=e7(s)?"["+s.start+", "+s.end+"]":""+r.getLabelForValue(i[r.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,r){const i="reset"===r,{index:s,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,r);for(let d=e;d<e+n;d++){const e=this.getParsed(d),n=i||M4(e[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[o.axis],m={horizontal:l,base:n.base,enableBorderRadius:!f||e7(e._custom)||s===f._top||s===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,t[d].active?"active":r));const g=m.options||t[d].options;n7(m,g,f,s),s7(m,g,c.ratio),this.updateElement(t[d],d,m,r)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,r=n.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),i=n.options.stacked,s=[],o=t=>{const n=t.controller.getParsed(e),r=n&&n[t.vScale.axis];if(M4(r)||isNaN(r))return!0};for(const n of r)if((void 0===e||!o(n))&&((!1===i||-1===s.indexOf(n.stack)||void 0===i&&void 0===n.stack)&&s.push(n.stack),n.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,n){const r=this._getStacks(t,n),i=void 0!==e?r.indexOf(e):-1;return-1===i?r.length-1:i}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,r=[];let i,s;for(i=0,s=e.data.length;i<s;++i)r.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const o=t.barThickness;return{min:o||J8(e),pixels:r,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n},options:{base:r,minBarLength:i}}=this,s=r||0,o=this.getParsed(t),a=o._custom,l=e7(a);let c,u,h=o[e.axis],d=0,p=n?this.applyStack(e,o,n):h;p!==h&&(d=p-h,p=h),l&&(h=a.barStart,p=a.barEnd-a.barStart,0!==h&&i5(h)!==i5(a.barEnd)&&(d=0),d+=h);const f=M4(r)||l?d:r;let m=e.getPixelForValue(f);if(c=this.chart.getDataVisibility(t)?e.getPixelForValue(d+p):m,u=c-m,Math.abs(u)<i){u=function(t,e,n){return 0!==t?i5(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(u,e,s)*i,h===s&&(m-=u/2);const t=e.getPixelForDecimal(0),n=e.getPixelForDecimal(1),r=Math.min(t,n),o=Math.max(t,n);m=Math.max(Math.min(m,o),r),c=m+u}if(m===e.getPixelForValue(s)){const t=i5(u)*e.getLineWidthForValue(s)/2;m+=t,u-=t}return{size:u,base:m,head:c,center:c+u/2}}_calculateBarIndexPixels(t,e){const n=e.scale,r=this.options,i=r.skipNull,s=$4(r.maxBarThickness,1/0);let o,a;if(e.grouped){const n=i?this._getStackCount(t):e.stackCount,l="flex"===r.barThickness?function(t,e,n,r){const i=e.pixels,s=i[t];let o=t>0?i[t-1]:null,a=t<i.length-1?i[t+1]:null;const l=n.categoryPercentage;null===o&&(o=s-(null===a?e.end-e.start:a-s)),null===a&&(a=s+s-o);const c=s-(s-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/r,ratio:n.barPercentage,start:c}}(t,e,r,n):function(t,e,n,r){const i=n.barThickness;let s,o;return M4(i)?(s=e.min*n.categoryPercentage,o=n.barPercentage):(s=i*r,o=1),{chunk:s/r,ratio:o,start:e.pixels[t]-s/2}}(t,e,r,n),c=this._getStackIndex(this.index,this._cachedMeta.stack,i?t:void 0);o=l.start+l.chunk*c+l.chunk/2,a=Math.min(s,l.chunk*l.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),a=Math.min(s,e.min*e.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,r=n.length;let i=0;for(;i<r;++i)null!==this.getParsed(i)[e.axis]&&n[i].draw(this._ctx)}}o7.id="bar",o7.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},o7.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class a7 extends Z8{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,r){const i=super.parsePrimitiveData(t,e,n,r);for(let t=0;t<i.length;t++)i[t]._custom=this.resolveDataElementOptions(t+n).radius;return i}parseArrayData(t,e,n,r){const i=super.parseArrayData(t,e,n,r);for(let t=0;t<i.length;t++){const r=e[n+t];i[t]._custom=$4(r[2],this.resolveDataElementOptions(t+n).radius)}return i}parseObjectData(t,e,n,r){const i=super.parseObjectData(t,e,n,r);for(let t=0;t<i.length;t++){const r=e[n+t];i[t]._custom=$4(r&&r.r&&+r.r,this.resolveDataElementOptions(t+n).radius)}return i}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:n,yScale:r}=e,i=this.getParsed(t),s=n.getLabelForValue(i.x),o=r.getLabelForValue(i.y),a=i._custom;return{label:e.label,value:"("+s+", "+o+(a?", "+a:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,r){const i="reset"===r,{iScale:s,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(e,r),c=s.axis,u=o.axis;for(let h=e;h<e+n;h++){const e=t[h],n=!i&&this.getParsed(h),d={},p=d[c]=i?s.getPixelForDecimal(.5):s.getPixelForValue(n[c]),f=d[u]=i?o.getBasePixel():o.getPixelForValue(n[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,e.active?"active":r),i&&(d.options.radius=0)),this.updateElement(e,h,d,r)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let r=super.resolveDataElementOptions(t,e);r.$shared&&(r=Object.assign({},r,{$shared:!1}));const i=r.radius;return"active"!==e&&(r.radius=0),r.radius+=$4(n&&n._custom,i),r}}a7.id="bubble",a7.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},a7.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class l7 extends Z8{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,r=this._cachedMeta;if(!1===this._parsing)r._parsed=n;else{let i,s,o=t=>+n[t];if(A4(n[t])){const{key:t="value"}=this._parsing;o=e=>+W4(n[e],t)}for(i=t,s=t+e;i<s;++i)r._parsed[i]=o(i)}}_getRotation(){return c5(this.options.rotation-90)}_getCircumference(){return c5(this.options.circumference)}_getRotationExtents(){let t=K4,e=-K4;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){const r=this.chart.getDatasetMeta(n).controller,i=r._getRotation(),s=r._getCircumference();t=Math.min(t,i),e=Math.max(e,i+s)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,r=this._cachedMeta,i=r.data,s=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-s)/2,0),a=Math.min((l=this.options.cutout,c=o,"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100:l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,n){let r=1,i=1,s=0,o=0;if(e<K4){const a=t,l=a+e,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(t,e,r)=>g5(t,a,l,!0)?1:Math.max(e,e*n,r,r*n),f=(t,e,r)=>g5(t,a,l,!0)?-1:Math.min(e,e*n,r,r*n),m=p(0,c,h),g=p(t5,u,d),y=f(Y4,c,h),b=f(Y4+t5,u,d);r=(m-y)/2,i=(g-b)/2,s=-(m+y)/2,o=-(g+b)/2}return{ratioX:r,ratioY:i,offsetX:s,offsetY:o}}(d,h,a),y=(n.width-s)/p,b=(n.height-s)/f,v=Math.max(Math.min(y,b)/2,0),x=R4(this.options.radius,v),w=(x-Math.max(x*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,r.total=this.calculateTotal(),this.outerRadius=x-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*u,0),this.updateElements(i,0,i.length,t)}_circumference(t,e){const n=this.options,r=this._cachedMeta,i=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===r._parsed[t]||r.data[t].hidden?0:this.calculateCircumference(r._parsed[t]*i/K4)}updateElements(t,e,n,r){const i="reset"===r,s=this.chart,o=s.chartArea,a=s.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=i&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,r);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,i);for(m=e;m<e+n;++m){const e=this._circumference(m,i),n=t[m],s={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:d,innerRadius:h};f&&(s.options=p||this.resolveDataElementOptions(m,n.active?"active":r)),g+=e,this.updateElement(n,m,s,r)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,r=0;for(n=0;n<e.length;n++){const i=t._parsed[n];null===i||isNaN(i)||!this.chart.getDataVisibility(n)||e[n].hidden||(r+=Math.abs(i))}return r}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?K4*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,r=n.data.labels||[],i=k8(e._parsed[t],n.options.locale);return{label:r[t]||"",value:i}}getMaxBorderWidth(t){let e=0;const n=this.chart;let r,i,s,o,a;if(!t)for(r=0,i=n.data.datasets.length;r<i;++r)if(n.isDatasetVisible(r)){s=n.getDatasetMeta(r),t=s.data,o=s.controller;break}if(!t)return 0;for(r=0,i=t.length;r<i;++r)a=o.resolveDataElementOptions(r),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,r=t.length;n<r;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max($4(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}l7.id="doughnut",l7.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},l7.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},l7.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,r)=>{const i=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:i.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const n=": "+t.formattedValue;return C4(e)?(e=e.slice(),e[0]+=n):e+=n,e}}}}};class c7 extends Z8{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:r=[],_dataset:i}=e,s=this.chart._animationsDisabled;let{start:o,count:a}=function(t,e,n){const r=e.length;let i=0,s=r;if(t._sorted){const{iScale:o,_parsed:a}=t,l=o.axis,{min:c,max:u,minDefined:h,maxDefined:d}=o.getUserBounds();h&&(i=y5(Math.min(L6(a,o.axis,c).lo,n?r:L6(e,l,o.getPixelForValue(c)).lo),0,r-1)),s=d?y5(Math.max(L6(a,o.axis,u).hi+1,n?0:L6(e,l,o.getPixelForValue(u)).hi+1),i,r)-i:r-i}return{start:i,count:s}}(e,r,s);this._drawStart=o,this._drawCount=a,function(t){const{xScale:e,yScale:n,_scaleRanges:r}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!r)return t._scaleRanges=i,!0;const s=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,i),s}(e)&&(o=0,a=r.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=r;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:l},t),this.updateElements(r,o,a,t)}updateElements(t,e,n,r){const i="reset"===r,{iScale:s,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(e,r),h=s.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=o5(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||i||"none"===r;let y=e>0&&this.getParsed(e-1);for(let p=e;p<e+n;++p){const e=t[p],n=this.getParsed(p),b=g?e:{},v=M4(n[d]),x=b[h]=s.getPixelForValue(n[h],p),w=b[d]=i||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[d],p);b.skip=isNaN(x)||isNaN(w)||v,b.stop=p>0&&Math.abs(n[h]-y[h])>m,f&&(b.parsed=n,b.raw=l.data[p]),u&&(b.options=c||this.resolveDataElementOptions(p,e.active?"active":r)),g||this.updateElement(e,p,b,r),y=n}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,r=t.data||[];if(!r.length)return n;const i=r[0].size(this.resolveDataElementOptions(0)),s=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(n,i,s)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}c7.id="line",c7.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},c7.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class u7 extends Z8{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,r=n.data.labels||[],i=k8(e._parsed[t].r,n.options.locale);return{label:r[t]||"",value:i}}parseObjectData(t,e,n,r){return t8.bind(this)(t,e,n,r)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,r=Math.min(e.right-e.left,e.bottom-e.top),i=Math.max(r/2,0),s=(i-Math.max(n.cutoutPercentage?i/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=i-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(t,e,n,r){const i="reset"===r,s=this.chart,o=s.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*Y4;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,r,p);for(h=e;h<e+n;h++){const e=t[h];let n=d,f=d+this._computeAngle(h,r,p),m=s.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,i&&(o.animateScale&&(m=0),o.animateRotate&&(n=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(h,e.active?"active":r)};this.updateElement(e,h,g,r)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++})),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?c5(this.resolveDataElementOptions(t,e).angle||n):0}}u7.id="polarArea",u7.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},u7.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,r)=>{const i=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:i.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class h7 extends l7{}h7.id="pie",h7.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class d7 extends Z8{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,r){return t8.bind(this)(t,e,n,r)}update(t){const e=this._cachedMeta,n=e.dataset,r=e.data||[],i=e.iScale.getLabels();if(n.points=r,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const s={_loop:!0,_fullLoop:i.length===r.length,options:e};this.updateElement(n,void 0,s,t)}this.updateElements(r,0,r.length,t)}updateElements(t,e,n,r){const i=this._cachedMeta.rScale,s="reset"===r;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":r),a=i.getPointPositionForValue(o,this.getParsed(o).r),l=s?i.xCenter:a.x,c=s?i.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(e,o,u,r)}}}d7.id="radar",d7.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},d7.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class p7 extends c7{}function f7(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}p7.id="scatter",p7.defaults={showLine:!1,fill:!1},p7.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};class m7{constructor(t){this.options=t||{}}formats(){return f7()}parse(t,e){return f7()}format(t,e){return f7()}add(t,e,n){return f7()}diff(t,e,n){return f7()}startOf(t,e,n){return f7()}endOf(t,e){return f7()}}m7.override=function(t){Object.assign(m7.prototype,t)};var g7={_date:m7};function y7(t,e,n,r){const{controller:i,data:s,_sorted:o}=t,a=i._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&o&&s.length){const t=a._reversePixels?D6:L6;if(!r)return t(s,e,n);if(i._sharedOptions){const r=s[0],i="function"==typeof r.getRange&&r.getRange(e);if(i){const r=t(s,e,n-i),o=t(s,e,n+i);return{lo:r.lo,hi:o.hi}}}}return{lo:0,hi:s.length-1}}function b7(t,e,n,r,i){const s=t.getSortedVisibleDatasetMetas(),o=n[e];for(let t=0,n=s.length;t<n;++t){const{index:n,data:a}=s[t],{lo:l,hi:c}=y7(s[t],e,o,i);for(let t=l;t<=c;++t){const e=a[t];e.skip||r(e,n,t)}}}function v7(t,e,n,r,i){const s=[];if(!i&&!t.isPointInArea(e))return s;return b7(t,n,e,(function(n,o,a){(i||y6(n,t.chartArea,0))&&n.inRange(e.x,e.y,r)&&s.push({element:n,datasetIndex:o,index:a})}),!0),s}function x7(t,e,n,r,i,s){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,r){const i=e?Math.abs(t.x-r.x):0,s=n?Math.abs(t.y-r.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2))}}(n);let l=Number.POSITIVE_INFINITY;return b7(t,n,e,(function(n,c,u){const h=n.inRange(e.x,e.y,i);if(r&&!h)return;const d=n.getCenterPoint(i);if(!(!!s||t.isPointInArea(d))&&!h)return;const p=a(e,d);p<l?(o=[{element:n,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:n,datasetIndex:c,index:u})})),o}function w7(t,e,n,r,i,s){return s||t.isPointInArea(e)?"r"!==n||r?x7(t,e,n,r,i,s):function(t,e,n,r){let i=[];return b7(t,n,e,(function(t,n,s){const{startAngle:o,endAngle:a}=t.getProps(["startAngle","endAngle"],r),{angle:l}=d5(t,{x:e.x,y:e.y});g5(l,o,a)&&i.push({element:t,datasetIndex:n,index:s})})),i}(t,e,n,i):[]}function S7(t,e,n,r,i){const s=[],o="x"===n?"inXRange":"inYRange";let a=!1;return b7(t,n,e,((t,r,l)=>{t[o](e[n],i)&&(s.push({element:t,datasetIndex:r,index:l}),a=a||t.inRange(e.x,e.y,i))})),r&&!a?[]:s}var _7={evaluateInteractionItems:b7,modes:{index(t,e,n,r){const i=f8(e,t),s=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?v7(t,i,s,r,o):w7(t,i,s,!1,r,o),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,n=t.data[e];n&&!n.skip&&l.push({element:n,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,n,r){const i=f8(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?v7(t,i,s,r,o):w7(t,i,s,!1,r,o);if(a.length>0){const e=a[0].datasetIndex,n=t.getDatasetMeta(e).data;a=[];for(let t=0;t<n.length;++t)a.push({element:n[t],datasetIndex:e,index:t})}return a},point:(t,e,n,r)=>v7(t,f8(e,t),n.axis||"xy",r,n.includeInvisible||!1),nearest(t,e,n,r){const i=f8(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;return w7(t,i,s,n.intersect,r,o)},x:(t,e,n,r)=>S7(t,f8(e,t),"x",n.intersect,r),y:(t,e,n,r)=>S7(t,f8(e,t),"y",n.intersect,r)}};const k7=["left","top","right","bottom"];function T7(t,e){return t.filter((t=>t.pos===e))}function E7(t,e){return t.filter((t=>-1===k7.indexOf(t.pos)&&t.box.axis===e))}function M7(t,e){return t.sort(((t,n)=>{const r=e?n:t,i=e?t:n;return r.weight===i.weight?r.index-i.index:r.weight-i.weight}))}function C7(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:r,stackWeight:i}=n;if(!t||!k7.includes(r))continue;const s=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=i}return e}(t),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let s,o,a;for(s=0,o=t.length;s<o;++s){a=t[s];const{fullSize:o}=a.box,l=n[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*r:o&&e.availableWidth,a.height=i):(a.width=r,a.height=c?c*i:o&&e.availableHeight)}return n}function A7(t,e,n,r){return Math.max(t[n],e[n])+Math.max(t[r],e[r])}function N7(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function I7(t,e,n,r){const{pos:i,box:s}=n,o=t.maxPadding;if(!A4(i)){n.size&&(t[i]-=n.size);const e=r[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?s.height:s.width),n.size=e.size/e.count,t[i]+=n.size}s.getPadding&&N7(o,s.getPadding());const a=Math.max(0,e.outerWidth-A7(o,t,"left","right")),l=Math.max(0,e.outerHeight-A7(o,t,"top","bottom")),c=a!==t.w,u=l!==t.h;return t.w=a,t.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function $7(t,e){const n=e.maxPadding;function r(t){const r={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{r[t]=Math.max(e[t],n[t])})),r}return r(t?["left","right"]:["top","bottom"])}function R7(t,e,n,r){const i=[];let s,o,a,l,c,u;for(s=0,o=t.length,c=0;s<o;++s){a=t[s],l=a.box,l.update(a.width||e.w,a.height||e.h,$7(a.horizontal,e));const{same:o,other:h}=I7(e,n,a,r);c|=o&&i.length,u=u||h,l.fullSize||i.push(a)}return c&&R7(i,e,n,r)||u}function O7(t,e,n,r,i){t.top=n,t.left=e,t.right=e+r,t.bottom=n+i,t.width=r,t.height=i}function P7(t,e,n,r){const i=n.padding;let{x:s,y:o}=e;for(const a of t){const t=a.box,l=r[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const r=e.w*c,s=l.size||t.height;G4(l.start)&&(o=l.start),t.fullSize?O7(t,i.left,o,n.outerWidth-i.right-i.left,s):O7(t,e.left+l.placed,o,r,s),l.start=o,l.placed+=r,o=t.bottom}else{const r=e.h*c,o=l.size||t.width;G4(l.start)&&(s=l.start),t.fullSize?O7(t,s,i.top,o,n.outerHeight-i.bottom-i.top):O7(t,s,e.top+l.placed,o,r),l.start=s,l.placed+=r,s=t.right}}e.x=s,e.y=o}u6.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var L7={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,r){if(!t)return;const i=I6(t.options.layout.padding),s=Math.max(e-i.width,0),o=Math.max(n-i.height,0),a=function(t){const e=function(t){const e=[];let n,r,i,s,o,a;for(n=0,r=(t||[]).length;n<r;++n)i=t[n],({position:s,options:{stack:o,stackWeight:a=1}}=i),e.push({index:n,box:i,pos:s,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&s+o,stackWeight:a});return e}(t),n=M7(e.filter((t=>t.box.fullSize)),!0),r=M7(T7(e,"left"),!0),i=M7(T7(e,"right")),s=M7(T7(e,"top"),!0),o=M7(T7(e,"bottom")),a=E7(e,"x"),l=E7(e,"y");return{fullSize:n,leftAndTop:r.concat(s),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:T7(e,"chartArea"),vertical:r.concat(i).concat(l),horizontal:s.concat(o).concat(a)}}(t.boxes),l=a.vertical,c=a.horizontal;P4(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const u=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},i);N7(d,I6(r));const p=Object.assign({maxPadding:d,w:s,h:o,x:i.left,y:i.top},i),f=C7(l.concat(c),h);R7(a.fullSize,p,h,f),R7(l,p,h,f),R7(c,p,h,f)&&R7(l,p,h,f),function(t){const e=t.maxPadding;function n(n){const r=Math.max(e[n]-t[n],0);return t[n]+=r,r}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(p),P7(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,P7(a.rightAndBottom,p,h,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},P4(a.chartArea,(e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class D7{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,r){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,r?Math.floor(e/r):n)}}isAttached(t){return!0}updateConfig(t){}}class F7 extends D7{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const z7={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},B7=t=>null===t||""===t;const U7=!!b8&&{passive:!0};function V7(t,e,n){t.canvas.removeEventListener(e,n,U7)}function j7(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function W7(t,e,n){const r=t.canvas,i=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||j7(n.addedNodes,r),e=e&&!j7(n.removedNodes,r);e&&n()}));return i.observe(document,{childList:!0,subtree:!0}),i}function H7(t,e,n){const r=t.canvas,i=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||j7(n.removedNodes,r),e=e&&!j7(n.addedNodes,r);e&&n()}));return i.observe(document,{childList:!0,subtree:!0}),i}const G7=new Map;let q7=0;function X7(){const t=window.devicePixelRatio;t!==q7&&(q7=t,G7.forEach(((e,n)=>{n.currentDevicePixelRatio!==t&&e()})))}function Y7(t,e,n){const r=t.canvas,i=r&&c8(r);if(!i)return;const s=S4(((t,e)=>{const r=i.clientWidth;n(t,e),r<i.clientWidth&&n()}),window),o=new ResizeObserver((t=>{const e=t[0],n=e.contentRect.width,r=e.contentRect.height;0===n&&0===r||s(n,r)}));return o.observe(i),function(t,e){G7.size||window.addEventListener("resize",X7),G7.set(t,e)}(t,s),o}function K7(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){G7.delete(t),G7.size||window.removeEventListener("resize",X7)}(t)}function Z7(t,e,n){const r=t.canvas,i=S4((e=>{null!==t.ctx&&n(function(t,e){const n=z7[t.type]||t.type,{x:r,y:i}=f8(t,e);return{type:n,chart:e,native:t,x:void 0!==r?r:null,y:void 0!==i?i:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,n){t.addEventListener(e,n,U7)}(r,e,i),i}class J7 extends D7{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,r=t.getAttribute("height"),i=t.getAttribute("width");if(t.$chartjs={initial:{height:r,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",B7(i)){const e=v8(t,"width");void 0!==e&&(t.width=e)}if(B7(r))if(""===t.style.height)t.height=t.width/(e||2);else{const e=v8(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e.$chartjs)return!1;const n=e.$chartjs.initial;["height","width"].forEach((t=>{const r=n[t];M4(r)?e.removeAttribute(t):e.setAttribute(t,r)}));const r=n.style||{};return Object.keys(r).forEach((t=>{e.style[t]=r[t]})),e.width=e.width,delete e.$chartjs,!0}addEventListener(t,e,n){this.removeEventListener(t,e);const r=t.$proxies||(t.$proxies={}),i={attach:W7,detach:H7,resize:Y7}[e]||Z7;r[e]=i(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),r=n[e];if(!r)return;({attach:K7,detach:K7,resize:K7}[e]||V7)(t,e,r),n[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,r){return g8(t,e,n,r)}isAttached(t){const e=c8(t);return!(!e||!e.isConnected)}}class Q7{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return o5(this.x)&&o5(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const r={};return t.forEach((t=>{r[t]=n[t]&&n[t].active()?n[t]._to:this[t]})),r}}Q7.defaults={},Q7.defaultRoutes=void 0;const t9={values:t=>C4(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const r=this.chart.options.locale;let i,s=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(i="scientific"),s=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t));return n}(t,n)}const o=r5(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),k8(t,r,l)},logarithmic(t,e,n){if(0===t)return"0";const r=t/Math.pow(10,Math.floor(r5(t)));return 1===r||2===r||5===r?t9.numeric.call(this,t,e,n):""}};var e9={formatters:t9};function n9(t,e){const n=t.options.ticks,r=n.maxTicksLimit||function(t){const e=t.options.offset,n=t._tickSize(),r=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(r,i))}(t),i=n.major.enabled?function(t){const e=[];let n,r;for(n=0,r=t.length;n<r;n++)t[n].major&&e.push(n);return e}(e):[],s=i.length,o=i[0],a=i[s-1],l=[];if(s>r)return function(t,e,n,r){let i,s=0,o=n[0];for(r=Math.ceil(r),i=0;i<t.length;i++)i===o&&(e.push(t[i]),s++,o=n[s*r])}(e,l,i,s/r),l;const c=function(t,e,n){const r=function(t){const e=t.length;let n,r;if(e<2)return!1;for(r=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==r)return!1;return r}(t),i=e.length/n;if(!r)return Math.max(i,1);const s=function(t){const e=[],n=Math.sqrt(t);let r;for(r=1;r<n;r++)t%r==0&&(e.push(r),e.push(t/r));return n===(0|n)&&e.push(n),e.sort(((t,e)=>t-e)).pop(),e}(r);for(let t=0,e=s.length-1;t<e;t++){const e=s[t];if(e>i)return e}return Math.max(i,1)}(i,e,r);if(s>0){let t,n;const r=s>1?Math.round((a-o)/(s-1)):null;for(r9(e,l,c,M4(r)?0:o-r,o),t=0,n=s-1;t<n;t++)r9(e,l,c,i[t],i[t+1]);return r9(e,l,c,a,M4(r)?e.length:a+r),l}return r9(e,l,c),l}function r9(t,e,n,r,i){const s=$4(r,0),o=Math.min($4(i,t.length),t.length);let a,l,c,u=0;for(n=Math.ceil(n),i&&(a=i-r,n=a/Math.floor(a/n)),c=s;c<0;)u++,c=Math.round(s+u*n);for(l=Math.max(s,0);l<o;l++)l===c&&(e.push(t[l]),u++,c=Math.round(s+u*n))}u6.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:e9.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),u6.route("scale.ticks","color","","color"),u6.route("scale.grid","color","","borderColor"),u6.route("scale.grid","borderColor","","borderColor"),u6.route("scale.title","color","","color"),u6.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),u6.describe("scales",{_fallback:"scale"}),u6.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const i9=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n;function s9(t,e){const n=[],r=t.length/e,i=t.length;let s=0;for(;s<i;s+=r)n.push(t[Math.floor(s)]);return n}function o9(t,e,n){const r=t.ticks.length,i=Math.min(e,r-1),s=t._startPixel,o=t._endPixel,a=1e-6;let l,c=t.getPixelForTick(i);if(!(n&&(l=1===r?Math.max(c-s,o-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(i-1))/2,c+=i<e?l:-l,c<s-a||c>o+a)))return c}function a9(t){return t.drawTicks?t.tickLength:0}function l9(t,e){if(!t.display)return 0;const n=$6(t.font,e),r=I6(t.padding);return(C4(t.text)?t.text.length:1)*n.lineHeight+r.height}function c9(t,e,n){let r=_4(t);return(n&&"right"!==e||!n&&"right"===e)&&(r=(t=>"left"===t?"right":"right"===t?"left":t)(r)),r}class u9 extends Q7{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:r}=this;return t=I4(t,Number.POSITIVE_INFINITY),e=I4(e,Number.NEGATIVE_INFINITY),n=I4(n,Number.POSITIVE_INFINITY),r=I4(r,Number.NEGATIVE_INFINITY),{min:I4(t,n),max:I4(e,r),minDefined:N4(t),maxDefined:N4(e)}}getMinMax(t){let e,{min:n,max:r,minDefined:i,maxDefined:s}=this.getUserBounds();if(i&&s)return{min:n,max:r};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)e=o[a].controller.getMinMax(this,t),i||(n=Math.min(n,e.min)),s||(r=Math.max(r,e.max));return n=s&&n>r?r:n,r=i&&n>r?n:r,{min:I4(n,I4(r,n)),max:I4(r,I4(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){O4(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:r,grace:i,ticks:s}=this.options,o=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:r,max:i}=t,s=R4(e,(i-r)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(r,-Math.abs(s)),max:o(i,s)}}(this,i,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?s9(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=n9(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){O4(this.options.afterUpdate,[this])}beforeSetDimensions(){O4(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){O4(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),O4(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){O4(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,r,i;for(n=0,r=t.length;n<r;n++)i=t[n],i.label=O4(e.callback,[i.value,n,t],this)}afterTickToLabelConversion(){O4(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){O4(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=this.ticks.length,r=e.minRotation||0,i=e.maxRotation;let s,o,a,l=r;if(!this._isVisible()||!e.display||r>=i||n<=1||!this.isHorizontal())return void(this.labelRotation=r);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=y5(this.chart.width-u,0,this.maxWidth);s=t.offset?this.maxWidth/n:d/(n-1),u+6>s&&(s=d/(n-(t.offset?.5:1)),o=this.maxHeight-a9(t.grid)-e.padding-l9(t.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=u5(Math.min(Math.asin(y5((c.highest.height+6)/s,-1,1)),Math.asin(y5(o/a,-1,1))-Math.asin(y5(h/a,-1,1)))),l=Math.max(r,Math.min(i,l))),this.labelRotation=l}afterCalculateLabelRotation(){O4(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){O4(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:r,grid:i}}=this,s=this._isVisible(),o=this.isHorizontal();if(s){const s=l9(r,e.options.font);if(o?(t.width=this.maxWidth,t.height=a9(i)+s):(t.height=this.maxHeight,t.width=a9(i)+s),n.display&&this.ticks.length){const{first:e,last:r,widest:i,highest:s}=this._getLabelSizes(),a=2*n.padding,l=c5(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const e=n.mirror?0:u*i.width+c*s.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=n.mirror?0:c*i.width+u*s.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,r,u,c)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,r){const{ticks:{align:i,padding:s},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=r*t.width,h=n*e.height):(u=n*t.height,h=r*e.width):"start"===i?h=e.width:"end"===i?u=t.width:"inner"!==i&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-o+s)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+s)*this.width/(this.width-c),0)}else{let n=e.height/2,r=t.height/2;"start"===i?(n=0,r=t.height):"end"===i&&(n=e.height,r=0),this.paddingTop=n+s,this.paddingBottom=r+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){O4(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)M4(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=s9(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length)}return t}_computeLabelSizes(t,e){const{ctx:n,_longestTextCache:r}=this,i=[],s=[];let o,a,l,c,u,h,d,p,f,m,g,y=0,b=0;for(o=0;o<e;++o){if(c=t[o].label,u=this._resolveTickFontOptions(o),n.font=h=u.string,d=r[h]=r[h]||{data:{},gc:[]},p=u.lineHeight,f=m=0,M4(c)||C4(c)){if(C4(c))for(a=0,l=c.length;a<l;++a)g=c[a],M4(g)||C4(g)||(f=h6(n,d.data,d.gc,f,g),m+=p)}else f=h6(n,d.data,d.gc,f,c),m=p;i.push(f),s.push(m),y=Math.max(f,y),b=Math.max(m,b)}!function(t,e){P4(t,(t=>{const n=t.gc,r=n.length/2;let i;if(r>e){for(i=0;i<r;++i)delete t.data[n[i]];n.splice(0,r)}}))}(r,e);const v=i.indexOf(y),x=s.indexOf(b),w=t=>({width:i[t]||0,height:s[t]||0});return{first:w(0),last:w(e-1),widest:w(v),highest:w(x),widths:i,heights:s}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return y5(this._alignToPixels?p6(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return O6(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=function(t,e){return O6(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=c5(this.labelRotation),n=Math.abs(Math.cos(e)),r=Math.abs(Math.sin(e)),i=this._getLabelSizes(),s=t.autoSkipPadding||0,o=i?i.widest.width+s:0,a=i?i.highest.height+s:0;return this.isHorizontal()?a*n>o*r?o/n:a/r:a*r<o*n?a/n:o/r}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,r=this.options,{grid:i,position:s}=r,o=i.offset,a=this.isHorizontal(),l=this.ticks.length+(o?1:0),c=a9(i),u=[],h=i.setContext(this.getContext()),d=h.drawBorder?h.borderWidth:0,p=d/2,f=function(t){return p6(n,t,d)};let m,g,y,b,v,x,w,S,_,k,T,E;if("top"===s)m=f(this.bottom),x=this.bottom-c,S=m-p,k=f(t.top)+p,E=t.bottom;else if("bottom"===s)m=f(this.top),k=t.top,E=f(t.bottom)-p,x=m+p,S=this.top+c;else if("left"===s)m=f(this.right),v=this.right-c,w=m-p,_=f(t.left)+p,T=t.right;else if("right"===s)m=f(this.left),_=t.left,T=f(t.right)-p,v=m+p,w=this.left+c;else if("x"===e){if("center"===s)m=f((t.top+t.bottom)/2+.5);else if(A4(s)){const t=Object.keys(s)[0],e=s[t];m=f(this.chart.scales[t].getPixelForValue(e))}k=t.top,E=t.bottom,x=m+p,S=x+c}else if("y"===e){if("center"===s)m=f((t.left+t.right)/2);else if(A4(s)){const t=Object.keys(s)[0],e=s[t];m=f(this.chart.scales[t].getPixelForValue(e))}v=m-p,w=v-c,_=t.left,T=t.right}const M=$4(r.ticks.maxTicksLimit,l),C=Math.max(1,Math.ceil(l/M));for(g=0;g<l;g+=C){const t=i.setContext(this.getContext(g)),e=t.lineWidth,r=t.color,s=i.borderDash||[],l=t.borderDashOffset,c=t.tickWidth,h=t.tickColor,d=t.tickBorderDash||[],p=t.tickBorderDashOffset;y=o9(this,g,o),void 0!==y&&(b=p6(n,y,e),a?v=w=_=T=b:x=S=k=E=b,u.push({tx1:v,ty1:x,tx2:w,ty2:S,x1:_,y1:k,x2:T,y2:E,width:e,color:r,borderDash:s,borderDashOffset:l,tickWidth:c,tickColor:h,tickBorderDash:d,tickBorderDashOffset:p}))}return this._ticksLength=l,this._borderValue=m,u}_computeLabelItems(t){const e=this.axis,n=this.options,{position:r,ticks:i}=n,s=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=i,h=a9(n.grid),d=h+c,p=u?-c:d,f=-c5(this.labelRotation),m=[];let g,y,b,v,x,w,S,_,k,T,E,M,C="middle";if("top"===r)w=this.bottom-p,S=this._getXAxisLabelAlignment();else if("bottom"===r)w=this.top+p,S=this._getXAxisLabelAlignment();else if("left"===r){const t=this._getYAxisLabelAlignment(h);S=t.textAlign,x=t.x}else if("right"===r){const t=this._getYAxisLabelAlignment(h);S=t.textAlign,x=t.x}else if("x"===e){if("center"===r)w=(t.top+t.bottom)/2+d;else if(A4(r)){const t=Object.keys(r)[0],e=r[t];w=this.chart.scales[t].getPixelForValue(e)+d}S=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===r)x=(t.left+t.right)/2-d;else if(A4(r)){const t=Object.keys(r)[0],e=r[t];x=this.chart.scales[t].getPixelForValue(e)}S=this._getYAxisLabelAlignment(h).textAlign}"y"===e&&("start"===a?C="top":"end"===a&&(C="bottom"));const A=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){b=o[g],v=b.label;const t=i.setContext(this.getContext(g));_=this.getPixelForTick(g)+i.labelOffset,k=this._resolveTickFontOptions(g),T=k.lineHeight,E=C4(v)?v.length:1;const e=E/2,n=t.color,a=t.textStrokeColor,c=t.textStrokeWidth;let h,d=S;if(s?(x=_,"inner"===S&&(d=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),M="top"===r?"near"===l||0!==f?-E*T+T/2:"center"===l?-A.highest.height/2-e*T+T:-A.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?A.highest.height/2-e*T:A.highest.height-E*T,u&&(M*=-1)):(w=_,M=(1-E)*T/2),t.showLabelBackdrop){const e=I6(t.backdropPadding),n=A.heights[g],r=A.widths[g];let i=w+M-e.top,s=x-e.left;switch(C){case"middle":i-=n/2;break;case"bottom":i-=n}switch(S){case"center":s-=r/2;break;case"right":s-=r}h={left:s,top:i,width:r+e.width,height:n+e.height,color:t.backdropColor}}m.push({rotation:f,label:v,font:k,color:n,strokeColor:a,strokeWidth:c,textOffset:M,textAlign:d,textBaseline:C,translation:[x,w],backdrop:h})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-c5(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:r,padding:i}}=this.options,s=t+i,o=this._getLabelSizes().widest.width;let a,l;return"left"===e?r?(l=this.right+i,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-s,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l=this.left)):"right"===e?r?(l=this.left+i,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+s,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:r,width:i,height:s}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,r,i,s),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex((e=>e.value===t));if(n>=0){return e.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,n=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let i,s;const o=(t,e,r)=>{r.width&&r.color&&(n.save(),n.lineWidth=r.width,n.strokeStyle=r.color,n.setLineDash(r.borderDash||[]),n.lineDashOffset=r.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(i=0,s=r.length;i<s;++i){const t=r[i];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:n}}=this,r=n.setContext(this.getContext()),i=n.drawBorder?r.borderWidth:0;if(!i)return;const s=n.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,l,c,u;this.isHorizontal()?(a=p6(t,this.left,i)-i/2,l=p6(t,this.right,s)+s/2,c=u=o):(c=p6(t,this.top,i)-i/2,u=p6(t,this.bottom,s)+s/2,a=l=o),e.save(),e.lineWidth=r.borderWidth,e.strokeStyle=r.borderColor,e.beginPath(),e.moveTo(a,c),e.lineTo(l,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&b6(e,n);const r=this._labelItems||(this._labelItems=this._computeLabelItems(t));let i,s;for(i=0,s=r.length;i<s;++i){const t=r[i],n=t.font,s=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),S6(e,s,0,t.textOffset,n,t)}n&&v6(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:r}}=this;if(!n.display)return;const i=$6(n.font),s=I6(n.padding),o=n.align;let a=i.lineHeight/2;"bottom"===e||"center"===e||A4(e)?(a+=s.bottom,C4(n.text)&&(a+=i.lineHeight*(n.text.length-1))):a+=s.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(t,e,n,r){const{top:i,left:s,bottom:o,right:a,chart:l}=t,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-i,g=a-s;if(t.isHorizontal()){if(d=k4(r,s,a),A4(n)){const t=Object.keys(n)[0],r=n[t];p=u[t].getPixelForValue(r)+m-e}else p="center"===n?(c.bottom+c.top)/2+m-e:i9(t,n,e);h=a-s}else{if(A4(n)){const t=Object.keys(n)[0],r=n[t];d=u[t].getPixelForValue(r)-g+e}else d="center"===n?(c.left+c.right)/2-g+e:i9(t,n,e);p=k4(r,o,i),f="left"===n?-t5:t5}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,e,o);S6(t,n.text,0,0,i,{color:n.color,maxWidth:u,rotation:h,textAlign:c9(o,e,r),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=$4(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===u9.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",r=[];let i,s;for(i=0,s=e.length;i<s;++i){const s=e[i];s[n]!==this.id||t&&s.type!==t||r.push(s)}return r}_resolveTickFontOptions(t){return $6(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class h9{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const r=this.items,i=t.id,s=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+t);return i in r||(r[i]=t,function(t,e,n){const r=B4(Object.create(null),[n?u6.get(n):{},u6.get(e),t.defaults]);u6.set(e,r),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((n=>{const r=n.split("."),i=r.pop(),s=[t].concat(r).join("."),o=e[n].split("."),a=o.pop(),l=o.join(".");u6.route(s,i,l,a)}))}(e,t.defaultRoutes);t.descriptors&&u6.describe(e,t.descriptors)}(t,s,n),this.override&&u6.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,r=this.scope;n in e&&delete e[n],r&&n in u6[r]&&(delete u6[r][n],this.override&&delete o6[n])}}var d9=new class{constructor(){this.controllers=new h9(Z8,"datasets",!0),this.elements=new h9(Q7,"elements"),this.plugins=new h9(Object,"plugins"),this.scales=new h9(u9,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,n){[...e].forEach((e=>{const r=n||this._getRegistryForType(e);n||r.isForType(e)||r===this.plugins&&e.id?this._exec(t,r,e):P4(e,(e=>{const r=n||this._getRegistryForType(e);this._exec(t,r,e)}))}))}_exec(t,e,n){const r=H4(t);O4(n["before"+r],[],n),e[t](n),O4(n["after"+r],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const r=e.get(t);if(void 0===r)throw new Error('"'+t+'" is not a registered '+n+".");return r}};class p9{constructor(){this._init=[]}notify(t,e,n,r){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const i=r?this._descriptors(t).filter(r):this._descriptors(t),s=this._notify(i,t,e,n);return"afterDestroy"===e&&(this._notify(i,t,"stop"),this._notify(this._init,t,"uninstall")),s}_notify(t,e,n,r){r=r||{};for(const i of t){const t=i.plugin;if(!1===O4(t[n],[e,r,i.options],t)&&r.cancelable)return!1}return!0}invalidate(){M4(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,r=$4(n.options&&n.options.plugins,{}),i=function(t){const e={},n=[],r=Object.keys(d9.plugins.items);for(let t=0;t<r.length;t++)n.push(d9.getPlugin(r[t]));const i=t.plugins||[];for(let t=0;t<i.length;t++){const r=i[t];-1===n.indexOf(r)&&(n.push(r),e[r.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==r||e?function(t,{plugins:e,localIds:n},r,i){const s=[],o=t.getContext();for(const a of e){const e=a.id,l=f9(r[e],i);null!==l&&s.push({plugin:a,options:m9(t.config,{plugin:a,local:n[e]},l,o)})}return s}(t,i,r,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,r=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(r(e,n),t,"stop"),this._notify(r(n,e),t,"start")}}function f9(t,e){return e||!1!==t?!0===t?{}:t:null}function m9(t,{plugin:e,local:n},r,i){const s=t.pluginScopeKeys(e),o=t.getOptionScopes(r,s);return n&&e.defaults&&o.push(e.defaults),t.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function g9(t,e){const n=u6.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function y9(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(n=e.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||t.charAt(0).toLowerCase();var n}function b9(t){const e=t.options||(t.options={});e.plugins=$4(e.plugins,{}),e.scales=function(t,e){const n=o6[t.type]||{scales:{}},r=e.scales||{},i=g9(t.type,e),s=Object.create(null),o=Object.create(null);return Object.keys(r).forEach((t=>{const e=r[t];if(!A4(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=y9(t,e),l=function(t,e){return t===e?"_index_":"_value_"}(a,i),c=n.scales||{};s[a]=s[a]||t,o[t]=U4(Object.create(null),[{axis:a},e,c[a],c[l]])})),t.data.datasets.forEach((n=>{const i=n.type||t.type,a=n.indexAxis||g9(i,e),l=(o6[i]||{}).scales||{};Object.keys(l).forEach((t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,a),i=n[e+"AxisID"]||s[e]||e;o[i]=o[i]||Object.create(null),U4(o[i],[{axis:e},r[i],l[t]])}))})),Object.keys(o).forEach((t=>{const e=o[t];U4(e,[u6.scales[e.type],u6.scale])})),o}(t,e)}function v9(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const x9=new Map,w9=new Set;function S9(t,e){let n=x9.get(t);return n||(n=e(),x9.set(t,n),w9.add(n)),n}const _9=(t,e,n)=>{const r=W4(e,n);void 0!==r&&t.add(r)};class k9{constructor(t){this._config=function(t){return(t=t||{}).data=v9(t.data),b9(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=v9(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),b9(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return S9(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return S9(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return S9(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return S9(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const n=this._scopeCache;let r=n.get(t);return r&&!e||(r=new Map,n.set(t,r)),r}getOptionScopes(t,e,n){const{options:r,type:i}=this,s=this._cachedScopes(t,n),o=s.get(e);if(o)return o;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>_9(a,t,e)))),e.forEach((t=>_9(a,r,t))),e.forEach((t=>_9(a,o6[i]||{},t))),e.forEach((t=>_9(a,u6,t))),e.forEach((t=>_9(a,a6,t)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),w9.has(e)&&s.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,o6[e]||{},u6.datasets[e]||{},{type:e},u6,a6]}resolveNamedOptions(t,e,n,r=[""]){const i={$shared:!0},{resolver:s,subPrefixes:o}=T9(this._resolverCache,t,r);let a=s;if(function(t,e){const{isScriptable:n,isIndexable:r}=j6(t);for(const i of e){const e=n(i),s=r(i),o=(s||e)&&t[i];if(e&&(q4(o)||E9(o))||s&&C4(o))return!0}return!1}(s,e)){i.$shared=!1;a=V6(s,n=q4(n)?n():n,this.createResolver(t,n,o))}for(const t of e)i[t]=a[t];return i}createResolver(t,e,n=[""],r){const{resolver:i}=T9(this._resolverCache,t,n);return A4(e)?V6(i,e,void 0,r):i}}function T9(t,e,n){let r=t.get(e);r||(r=new Map,t.set(e,r));const i=n.join();let s=r.get(i);if(!s){s={resolver:U6(e,n),subPrefixes:n.filter((t=>!t.toLowerCase().includes("hover")))},r.set(i,s)}return s}const E9=t=>A4(t)&&Object.getOwnPropertyNames(t).reduce(((e,n)=>e||q4(t[n])),!1);const M9=["top","bottom","left","right","chartArea"];function C9(t,e){return"top"===t||"bottom"===t||-1===M9.indexOf(t)&&"x"===e}function A9(t,e){return function(n,r){return n[t]===r[t]?n[e]-r[e]:n[t]-r[t]}}function N9(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),O4(n&&n.onComplete,[t],e)}function I9(t){const e=t.chart,n=e.options.animation;O4(n&&n.onProgress,[t],e)}function $9(t){return l8()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const R9={},O9=t=>{const e=$9(t);return Object.values(R9).filter((t=>t.canvas===e)).pop()};function P9(t,e,n){const r=Object.keys(t);for(const i of r){const r=+i;if(r>=e){const s=t[i];delete t[i],(n>0||r>e)&&(t[r+n]=s)}}}class L9{constructor(t,e){const n=this.config=new k9(e),r=$9(t),i=O9(r);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const s=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!l8()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?F7:J7}(r)),this.platform.updateConfig(n);const o=this.platform.acquireContext(r,s.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=E4(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new p9,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(...r){return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}((t=>this.update(t)),s.resizeDelay||0),this._dataChanges=[],R9[this.id]=this,o&&a?(P8.listen(this,"complete",N9),P8.listen(this,"progress",I9),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:r,_aspectRatio:i}=this;return M4(t)?e&&i?i:r?n/r:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():y8(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return f6(this.canvas,this.ctx),this}stop(){return P8.stop(this),this}resize(t,e){P8.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,r=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(r,t,e,i),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,y8(this,o,!0)&&(this.notifyPlugins("resize",{size:s}),O4(n.onResize,[this,s],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){P4(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,r=Object.keys(n).reduce(((t,e)=>(t[e]=!1,t)),{});let i=[];e&&(i=i.concat(Object.keys(e).map((t=>{const n=e[t],r=y9(t,n),i="r"===r,s="x"===r;return{options:n,dposition:i?"chartArea":s?"bottom":"left",dtype:i?"radialLinear":s?"category":"linear"}})))),P4(i,(e=>{const i=e.options,s=i.id,o=y9(s,i),a=$4(i.type,e.dtype);void 0!==i.position&&C9(i.position,o)===C9(e.dposition)||(i.position=e.dposition),r[s]=!0;let l=null;if(s in n&&n[s].type===a)l=n[s];else{l=new(d9.getScale(a))({id:s,type:a,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(i,t)})),P4(r,((t,e)=>{t||delete n[e]})),P4(n,(t=>{L7.configure(this,t,t.options),L7.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort(((t,e)=>t.index-e.index)),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(A9("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,n)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(n)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,r;for(this._removeUnreferencedMetasets(),n=0,r=e.length;n<r;n++){const r=e[n];let i=this.getDatasetMeta(n);const s=r.type||this.config.type;if(i.type&&i.type!==s&&(this._destroyDatasetMeta(n),i=this.getDatasetMeta(n)),i.type=s,i.indexAxis=r.indexAxis||g9(s,this.options),i.order=r.order||0,i.index=n,i.label=""+r.label,i.visible=this.isDatasetVisible(n),i.controller)i.controller.updateIndex(n),i.controller.linkScales();else{const e=d9.getController(s),{datasetElementType:r,dataElementType:o}=u6.datasets[s];Object.assign(e.prototype,{dataElementType:d9.getElement(o),datasetElementType:r&&d9.getElement(r)}),i.controller=new e(this,n),t.push(i.controller)}}return this._updateMetasets(),t}_resetElements(){P4(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),n=!r&&-1===i.indexOf(e);e.buildOrUpdateElements(n),s=Math.max(+e.getMaxOverflow(),s)}s=this._minPadding=n.layout.autoPadding?s:0,this._updateLayout(s),r||P4(i,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(A9("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){P4(this.scales,(t=>{L7.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);X4(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:r,count:i}of e){P9(t,r,"_removeElements"===n?-i:i)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),r=n(0);for(let t=1;t<e;t++)if(!X4(r,n(t)))return;return Array.from(r).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;L7.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],P4(this.boxes,(t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,q4(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),r={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",r)&&(n.controller._update(e),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(P8.has(this)?this.attached&&!P8.running(this)&&P8.start(this):(this.draw(),N9({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let r,i;for(r=0,i=e.length;r<i;++r){const i=e[r];t&&!i.visible||n.push(i)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n=t._clip,r=!n.disabled,i=this.chartArea,s={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(r&&b6(e,{left:!1===n.left?0:i.left-n.left,right:!1===n.right?this.width:i.right+n.right,top:!1===n.top?0:i.top-n.top,bottom:!1===n.bottom?this.height:i.bottom+n.bottom}),t.controller.draw(),r&&v6(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return y6(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,r){const i=_7.modes[e];return"function"==typeof i?i(this,t,n,r):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let r=n.filter((t=>t&&t._dataset===e)).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(r)),r}getContext(){return this.$context||(this.$context=O6(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"==typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const r=n?"show":"hide",i=this.getDatasetMeta(t),s=i.controller._resolveAnimations(void 0,r);G4(e)?(i.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),s.update(i,{visible:n}),this.update((e=>e.datasetIndex===t?r:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),P8.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),f6(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete R9[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,r)=>{e.addEventListener(this,n,r),t[n]=r},r=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};P4(this.options.events,(t=>n(t,r)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,r)=>{e.addEventListener(this,n,r),t[n]=r},r=(n,r)=>{t[n]&&(e.removeEventListener(this,n,r),delete t[n])},i=(t,e)=>{this.canvas&&this.resize(t,e)};let s;const o=()=>{r("attach",o),this.attached=!0,this.resize(),n("resize",i),n("detach",s)};s=()=>{this.attached=!1,r("resize",i),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():s()}unbindEvents(){P4(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},P4(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const r=n?"set":"remove";let i,s,o,a;for("dataset"===e&&(i=this.getDatasetMeta(t[0].datasetIndex),i.controller["_"+r+"DatasetHoverStyle"]()),o=0,a=t.length;o<a;++o){s=t[o];const e=s&&this.getDatasetMeta(s.datasetIndex).controller;e&&e[r+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map((({datasetIndex:t,index:e})=>{const n=this.getDatasetMeta(t);if(!n)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:n.data[e],index:e}}));!L4(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}_updateHoverStyles(t,e,n){const r=this.options.hover,i=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),s=i(e,t),o=n?t:i(t,e);s.length&&this.updateHoverStyle(s,r.mode,!1),o.length&&r.mode&&this.updateHoverStyle(o,r.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},r=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,r))return;const i=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,r),(i||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:r=[],options:i}=this,s=e,o=this._getActiveElements(t,r,n,s),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,n,r){return n&&"mouseout"!==t.type?r?e:t:null}(t,this._lastEvent,n,a);n&&(this._lastEvent=null,O4(i.onHover,[t,o,this],this),a&&O4(i.onClick,[t,o,this],this));const c=!L4(o,r);return(c||e)&&(this._active=o,this._updateHoverStyles(o,r,e)),this._lastEvent=l,c}_getActiveElements(t,e,n,r){if("mouseout"===t.type)return[];if(!n)return e;const i=this.options.hover;return this.getElementsAtEventForMode(t,i.mode,i,r)}}const D9=()=>P4(L9.instances,(t=>t._plugins.invalidate()));function F9(t,e,n){const{startAngle:r,pixelMargin:i,x:s,y:o,outerRadius:a,innerRadius:l}=e;let c=i/a;t.beginPath(),t.arc(s,o,a,r-c,n+c),l>i?(c=i/l,t.arc(s,o,l,n+c,r-c,!0)):t.arc(s,o,i,n+t5,r-t5),t.closePath(),t.clip()}function z9(t,e,n,r){const i=C6(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const s=(n-e)/2,o=Math.min(s,r*e/2),a=t=>{const e=(n-Math.min(s,t))*r/2;return y5(t,0,Math.min(s,e))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:y5(i.innerStart,0,o),innerEnd:y5(i.innerEnd,0,o)}}function B9(t,e,n,r){return{x:n+t*Math.cos(e),y:r+t*Math.sin(e)}}function U9(t,e,n,r,i){const{x:s,y:o,startAngle:a,pixelMargin:l,innerRadius:c}=e,u=Math.max(e.outerRadius+r+n-l,0),h=c>0?c+r+n+l:0;let d=0;const p=i-a;if(r){const t=((c>0?c-r:0)+(u>0?u-r:0))/2;d=(p-(0!==t?p*t/(t+r):p))/2}const f=(p-Math.max(.001,p*u-n/Y4)/u)/2,m=a+f+d,g=i-f-d,{outerStart:y,outerEnd:b,innerStart:v,innerEnd:x}=z9(e,h,u,g-m),w=u-y,S=u-b,_=m+y/w,k=g-b/S,T=h+v,E=h+x,M=m+v/T,C=g-x/E;if(t.beginPath(),t.arc(s,o,u,_,k),b>0){const e=B9(S,k,s,o);t.arc(e.x,e.y,b,k,g+t5)}const A=B9(E,g,s,o);if(t.lineTo(A.x,A.y),x>0){const e=B9(E,C,s,o);t.arc(e.x,e.y,x,g+t5,C+Math.PI)}if(t.arc(s,o,h,g-x/h,m+v/h,!0),v>0){const e=B9(T,M,s,o);t.arc(e.x,e.y,v,M+Math.PI,m-t5)}const N=B9(w,m,s,o);if(t.lineTo(N.x,N.y),y>0){const e=B9(w,_,s,o);t.arc(e.x,e.y,y,m-t5,_)}t.closePath()}function V9(t,e,n,r,i){const{options:s}=e,{borderWidth:o,borderJoinStyle:a}=s,l="inner"===s.borderAlign;o&&(l?(t.lineWidth=2*o,t.lineJoin=a||"round"):(t.lineWidth=o,t.lineJoin=a||"bevel"),e.fullCircles&&function(t,e,n){const{x:r,y:i,startAngle:s,pixelMargin:o,fullCircles:a}=e,l=Math.max(e.outerRadius-o,0),c=e.innerRadius+o;let u;for(n&&F9(t,e,s+K4),t.beginPath(),t.arc(r,i,c,s+K4,s,!0),u=0;u<a;++u)t.stroke();for(t.beginPath(),t.arc(r,i,l,s,s+K4),u=0;u<a;++u)t.stroke()}(t,e,l),l&&F9(t,e,i),U9(t,e,n,r,i),t.stroke())}Object.defineProperties(L9,{defaults:{enumerable:true,value:u6},instances:{enumerable:true,value:R9},overrides:{enumerable:true,value:o6},registry:{enumerable:true,value:d9},version:{enumerable:true,value:"3.8.2"},getChart:{enumerable:true,value:O9},register:{enumerable:true,value:(...t)=>{d9.add(...t),D9()}},unregister:{enumerable:true,value:(...t)=>{d9.remove(...t),D9()}}});class j9 extends Q7{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const r=this.getProps(["x","y"],n),{angle:i,distance:s}=d5(r,{x:t,y:e}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=this.options.spacing/2,d=$4(u,a-o)>=K4||g5(i,o,a),p=b5(s,l+h,c+h);return d&&p}getCenterPoint(t){const{x:e,y:n,startAngle:r,endAngle:i,innerRadius:s,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:a,spacing:l}=this.options,c=(r+i)/2,u=(s+o+l+a)/2;return{x:e+Math.cos(c)*u,y:n+Math.sin(c)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,r=(e.offset||0)/2,i=(e.spacing||0)/2;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>K4?Math.floor(n/K4):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();let s=0;if(r){s=r/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*s,Math.sin(e)*s),this.circumference>=Y4&&(s=r)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const o=function(t,e,n,r){const{fullCircles:i,startAngle:s,circumference:o}=e;let a=e.endAngle;if(i){U9(t,e,n,r,s+K4);for(let e=0;e<i;++e)t.fill();isNaN(o)||(a=s+o%K4,o%K4==0&&(a+=K4))}return U9(t,e,n,r,a),t.fill(),a}(t,this,s,i);V9(t,this,s,i,o),t.restore()}}function W9(t,e,n=e){t.lineCap=$4(n.borderCapStyle,e.borderCapStyle),t.setLineDash($4(n.borderDash,e.borderDash)),t.lineDashOffset=$4(n.borderDashOffset,e.borderDashOffset),t.lineJoin=$4(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=$4(n.borderWidth,e.borderWidth),t.strokeStyle=$4(n.borderColor,e.borderColor)}function H9(t,e,n){t.lineTo(n.x,n.y)}function G9(t,e,n={}){const r=t.length,{start:i=0,end:s=r-1}=n,{start:o,end:a}=e,l=Math.max(i,o),c=Math.min(s,a),u=i<o&&s<o||i>a&&s>a;return{count:r,start:l,loop:e.loop,ilen:c<l&&!u?r+c-l:c-l}}function q9(t,e,n,r){const{points:i,options:s}=e,{count:o,start:a,loop:l,ilen:c}=G9(i,n,r),u=function(t){return t.stepped?x6:t.tension||"monotone"===t.cubicInterpolationMode?w6:H9}(s);let h,d,p,{move:f=!0,reverse:m}=r||{};for(h=0;h<=c;++h)d=i[(a+(m?c-h:h))%o],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):u(t,p,d,m,s.stepped),p=d);return l&&(d=i[(a+(m?c:0))%o],u(t,p,d,m,s.stepped)),!!l}function X9(t,e,n,r){const i=e.points,{count:s,start:o,ilen:a}=G9(i,n,r),{move:l=!0,reverse:c}=r||{};let u,h,d,p,f,m,g=0,y=0;const b=t=>(o+(c?a-t:t))%s,v=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(h=i[b(0)],t.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=i[b(u)],h.skip)continue;const e=h.x,n=h.y,r=0|e;r===d?(n<p?p=n:n>f&&(f=n),g=(y*g+e)/++y):(v(),t.lineTo(e,n),d=r,y=0,p=f=n),m=n}v()}function Y9(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!(t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||n)?X9:q9}j9.id="arc",j9.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},j9.defaultRoutes={backgroundColor:"backgroundColor"};const K9="function"==typeof Path2D;function Z9(t,e,n,r){K9&&!e.options.segment?function(t,e,n,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,r)&&i.closePath()),W9(t,e.options),t.stroke(i)}(t,e,n,r):function(t,e,n,r){const{segments:i,options:s}=e,o=Y9(e);for(const a of i)W9(t,s,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+r-1})&&t.closePath(),t.stroke()}(t,e,n,r)}class J9 extends Q7{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const r=n.spanGaps?this._loop:this._fullLoop;a8(this._points,n,t,r,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,r=t.options.spanGaps,i=n.length;if(!i)return[];const s=!!t._loop,{start:o,end:a}=function(t,e,n,r){let i=0,s=e-1;if(n&&!r)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(s+=i);s>i&&t[s%e].skip;)s--;return s%=e,{start:i,end:s}}(n,i,s,r);return $8(t,!0===r?[{start:o,end:a,loop:s}]:function(t,e,n,r){const i=t.length,s=[];let o,a=e,l=t[e];for(o=e+1;o<=n;++o){const n=t[o%i];n.skip||n.stop?l.skip||(r=!1,s.push({start:e%i,end:(o-1)%i,loop:r}),e=a=n.stop?o:null):(a=o,l.skip&&(e=o)),l=n}return null!==a&&s.push({start:e%i,end:a%i,loop:r}),s}(n,o,a<o?a+i:a,!!t._fullLoop&&0===o&&a===i-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,r=t[e],i=this.points,s=I8(this,{property:e,start:r,end:r});if(!s.length)return;const o=[],a=function(t){return t.stepped?w8:t.tension||"monotone"===t.cubicInterpolationMode?S8:x8}(n);let l,c;for(l=0,c=s.length;l<c;++l){const{start:c,end:u}=s[l],h=i[c],d=i[u];if(h===d){o.push(h);continue}const p=a(h,d,Math.abs((r-h[e])/(d[e]-h[e])),n.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return Y9(this)(t,this,e,n)}path(t,e,n){const r=this.segments,i=Y9(this);let s=this._loop;e=e||0,n=n||this.points.length-e;for(const o of r)s&=i(t,this,o,{start:e,end:e+n-1});return!!s}draw(t,e,n,r){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(t.save(),Z9(t,this,n,r),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Q9(t,e,n,r){const i=t.options,{[n]:s}=t.getProps([n],r);return Math.abs(e-s)<i.radius+i.hitRadius}J9.id="line",J9.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},J9.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},J9.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class ttt extends Q7{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const r=this.options,{x:i,y:s}=this.getProps(["x","y"],n);return Math.pow(t-i,2)+Math.pow(e-s,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(t,e){return Q9(this,t,"x",e)}inYRange(t,e){return Q9(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!y6(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,m6(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function ett(t,e){const{x:n,y:r,base:i,width:s,height:o}=t.getProps(["x","y","base","width","height"],e);let a,l,c,u,h;return t.horizontal?(h=o/2,a=Math.min(n,i),l=Math.max(n,i),c=r-h,u=r+h):(h=s/2,a=n-h,l=n+h,c=Math.min(r,i),u=Math.max(r,i)),{left:a,top:c,right:l,bottom:u}}function ntt(t,e,n,r){return t?0:y5(e,n,r)}function rtt(t){const e=ett(t),n=e.right-e.left,r=e.bottom-e.top,i=function(t,e,n){const r=t.options.borderWidth,i=t.borderSkipped,s=A6(r);return{t:ntt(i.top,s.top,0,n),r:ntt(i.right,s.right,0,e),b:ntt(i.bottom,s.bottom,0,n),l:ntt(i.left,s.left,0,e)}}(t,n/2,r/2),s=function(t,e,n){const{enableBorderRadius:r}=t.getProps(["enableBorderRadius"]),i=t.options.borderRadius,s=N6(i),o=Math.min(e,n),a=t.borderSkipped,l=r||A4(i);return{topLeft:ntt(!l||a.top||a.left,s.topLeft,0,o),topRight:ntt(!l||a.top||a.right,s.topRight,0,o),bottomLeft:ntt(!l||a.bottom||a.left,s.bottomLeft,0,o),bottomRight:ntt(!l||a.bottom||a.right,s.bottomRight,0,o)}}(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r,radius:s},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,s.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(i.b,i.r))}}}}function itt(t,e,n,r){const i=null===e,s=null===n,o=t&&!(i&&s)&&ett(t,r);return o&&(i||b5(e,o.left,o.right))&&(s||b5(n,o.top,o.bottom))}function stt(t,e){t.rect(e.x,e.y,e.w,e.h)}function ott(t,e,n={}){const r=t.x!==n.x?-e:0,i=t.y!==n.y?-e:0,s=(t.x+t.w!==n.x+n.w?e:0)-r,o=(t.y+t.h!==n.y+n.h?e:0)-i;return{x:t.x+r,y:t.y+i,w:t.w+s,h:t.h+o,radius:t.radius}}ttt.id="point",ttt.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},ttt.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class att extends Q7{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:r}}=this,{inner:i,outer:s}=rtt(this),o=(a=s.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?k6:stt;var a;t.save(),s.w===i.w&&s.h===i.h||(t.beginPath(),o(t,ott(s,e,i)),t.clip(),o(t,ott(i,-e,s)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,ott(i,e)),t.fillStyle=r,t.fill(),t.restore()}inRange(t,e,n){return itt(this,t,e,n)}inXRange(t,e){return itt(this,t,null,e)}inYRange(t,e){return itt(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:r,horizontal:i}=this.getProps(["x","y","base","horizontal"],t);return{x:i?(e+r)/2:e,y:i?n:(n+r)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}function ltt(t,e,n,r){if(r)return;let i=e[t],s=n[t];return"angle"===t&&(i=m5(i),s=m5(s)),{property:t,start:i,end:s}}function ctt(t,e,n){for(;e>t;e--){const t=n[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function utt(t,e,n,r){return t&&e?r(t[n],e[n]):t?t[n]:e?e[n]:0}function htt(t,e){let n=[],r=!1;return C4(t)?(r=!0,n=t):n=function(t,e){const{x:n=null,y:r=null}=t||{},i=e.points,s=[];return e.segments.forEach((({start:t,end:e})=>{e=ctt(t,e,i);const o=i[t],a=i[e];null!==r?(s.push({x:o.x,y:r}),s.push({x:a.x,y:r})):null!==n&&(s.push({x:n,y:o.y}),s.push({x:n,y:a.y}))})),s}(t,e),n.length?new J9({points:n,options:{tension:0},_loop:r,_fullLoop:r}):null}function dtt(t){return t&&!1!==t.fill}function ptt(t,e,n){let r=t[e].fill;const i=[e];let s;if(!n)return r;for(;!1!==r&&-1===i.indexOf(r);){if(!N4(r))return r;if(s=t[r],!s)return!1;if(s.visible)return r;i.push(r),r=s.fill}return!1}function ftt(t,e,n){const r=function(t){const e=t.options,n=e.fill;let r=$4(n&&n.target,n);void 0===r&&(r=!!e.backgroundColor);if(!1===r||null===r)return!1;if(!0===r)return"origin";return r}(t);if(A4(r))return!isNaN(r.value)&&r;let i=parseFloat(r);return N4(i)&&Math.floor(i)===i?function(t,e,n,r){"-"!==t&&"+"!==t||(n=e+n);if(n===e||n<0||n>=r)return!1;return n}(r[0],e,i,n):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function mtt(t,e,n){const r=[];for(let i=0;i<n.length;i++){const s=n[i],{first:o,last:a,point:l}=gtt(s,e,"x");if(!(!l||o&&a))if(o)r.unshift(l);else if(t.push(l),!a)break}t.push(...r)}function gtt(t,e,n){const r=t.interpolate(e,n);if(!r)return{};const i=r[n],s=t.segments,o=t.points;let a=!1,l=!1;for(let t=0;t<s.length;t++){const e=s[t],r=o[e.start][n],c=o[e.end][n];if(b5(i,r,c)){a=i===r,l=i===c;break}}return{first:a,last:l,point:r}}att.id="bar",att.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},att.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class ytt{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,n){const{x:r,y:i,radius:s}=this;return e=e||{start:0,end:K4},t.arc(r,i,s,e.end,e.start,!0),!n.bounds}interpolate(t){const{x:e,y:n,radius:r}=this,i=t.angle;return{x:e+Math.cos(i)*r,y:n+Math.sin(i)*r,angle:i}}}function btt(t){const{chart:e,fill:n,line:r}=t;if(N4(n))return function(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}(e,n);if("stack"===n)return function(t){const{scale:e,index:n,line:r}=t,i=[],s=r.segments,o=r.points,a=function(t,e){const n=[],r=t.getMatchingVisibleMetas("line");for(let t=0;t<r.length;t++){const i=r[t];if(i.index===e)break;i.hidden||n.unshift(i.dataset)}return n}(e,n);a.push(htt({x:null,y:e.bottom},r));for(let t=0;t<s.length;t++){const e=s[t];for(let t=e.start;t<=e.end;t++)mtt(i,o[t],a)}return new J9({points:i,options:{}})}(t);if("shape"===n)return!0;const i=function(t){if((t.scale||{}).getPointPositionForValue)return function(t){const{scale:e,fill:n}=t,r=e.options,i=e.getLabels().length,s=r.reverse?e.max:e.min,o=function(t,e,n){let r;return r="start"===t?n:"end"===t?e.options.reverse?e.min:e.max:A4(t)?t.value:e.getBaseValue(),r}(n,e,s),a=[];if(r.grid.circular){const t=e.getPointPositionForValue(0,s);return new ytt({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let t=0;t<i;++t)a.push(e.getPointPositionForValue(t,o));return a}(t);return function(t){const{scale:e={},fill:n}=t,r=function(t,e){let n=null;return"start"===t?n=e.bottom:"end"===t?n=e.top:A4(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}(n,e);if(N4(r)){const t=e.isHorizontal();return{x:t?r:null,y:t?null:r}}return null}(t)}(t);return i instanceof ytt?i:htt(i,r)}function vtt(t,e,n){const r=btt(e),{line:i,scale:s,axis:o}=e,a=i.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};r&&i.points.length&&(b6(t,n),function(t,e){const{line:n,target:r,above:i,below:s,area:o,scale:a}=e,l=n._loop?"angle":e.axis;t.save(),"x"===l&&s!==i&&(xtt(t,r,o.top),wtt(t,{line:n,target:r,color:i,scale:a,property:l}),t.restore(),t.save(),xtt(t,r,o.bottom));wtt(t,{line:n,target:r,color:s,scale:a,property:l}),t.restore()}(t,{line:i,target:r,above:u,below:h,area:n,scale:s,axis:o}),v6(t))}function xtt(t,e,n){const{segments:r,points:i}=e;let s=!0,o=!1;t.beginPath();for(const a of r){const{start:r,end:l}=a,c=i[r],u=i[ctt(r,l,i)];s?(t.moveTo(c.x,c.y),s=!1):(t.lineTo(c.x,n),t.lineTo(c.x,c.y)),o=!!e.pathSegment(t,a,{move:o}),o?t.closePath():t.lineTo(u.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function wtt(t,e){const{line:n,target:r,property:i,color:s,scale:o}=e,a=function(t,e,n){const r=t.segments,i=t.points,s=e.points,o=[];for(const t of r){let{start:r,end:a}=t;a=ctt(r,a,i);const l=ltt(n,i[r],i[a],t.loop);if(!e.segments){o.push({source:t,target:l,start:i[r],end:i[a]});continue}const c=I8(e,l);for(const e of c){const r=ltt(n,s[e.start],s[e.end],e.loop),a=N8(t,i,r);for(const t of a)o.push({source:t,target:e,start:{[n]:utt(l,r,"start",Math.max)},end:{[n]:utt(l,r,"end",Math.min)}})}}return o}(n,r,i);for(const{source:e,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=s}={}}=e,h=!0!==r;t.save(),t.fillStyle=a,Stt(t,o,h&&ltt(i,c,u)),t.beginPath();const d=!!n.pathSegment(t,e);let p;if(h){d?t.closePath():_tt(t,r,u,i);const e=!!r.pathSegment(t,l,{move:d,reverse:!0});p=d&&e,p||_tt(t,r,c,i)}t.closePath(),t.fill(p?"evenodd":"nonzero"),t.restore()}}function Stt(t,e,n){const{top:r,bottom:i}=e.chart.chartArea,{property:s,start:o,end:a}=n||{};"x"===s&&(t.beginPath(),t.rect(o,r,a-o,i-r),t.clip())}function _tt(t,e,n,r){const i=e.interpolate(n,r);i&&t.lineTo(i.x,i.y)}var ktt={id:"filler",afterDatasetsUpdate(t,e,n){const r=(t.data.datasets||[]).length,i=[];let s,o,a,l;for(o=0;o<r;++o)s=t.getDatasetMeta(o),a=s.dataset,l=null,a&&a.options&&a instanceof J9&&(l={visible:t.isDatasetVisible(o),index:o,fill:ftt(a,o,r),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=l,i.push(l);for(o=0;o<r;++o)l=i[o],l&&!1!==l.fill&&(l.fill=ptt(i,o,n.propagate))},beforeDraw(t,e,n){const r="beforeDraw"===n.drawTime,i=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let e=i.length-1;e>=0;--e){const n=i[e].$filler;n&&(n.line.updateControlPoints(s,n.axis),r&&n.fill&&vtt(t.ctx,n,s))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const r=t.getSortedVisibleDatasetMetas();for(let e=r.length-1;e>=0;--e){const n=r[e].$filler;dtt(n)&&vtt(t.ctx,n,t.chartArea)}},beforeDatasetDraw(t,e,n){const r=e.meta.$filler;dtt(r)&&"beforeDatasetDraw"===n.drawTime&&vtt(t.ctx,r,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Ttt=(t,e)=>{let{boxHeight:n=e,boxWidth:r=e}=t;return t.usePointStyle&&(n=Math.min(n,e),r=t.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(e,n)}};class Ett extends Q7{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=O4(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,n)=>t.sort(e,n,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,r=$6(n.font),i=r.size,s=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=Ttt(n,i);let l,c;e.font=r.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(s,i,o,a)+10):(c=this.maxHeight,l=this._fitCols(s,i,o,a)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,r){const{ctx:i,maxWidth:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=r+o;let u=t;i.textAlign="left",i.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((t,p)=>{const f=n+e/2+i.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>s)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:r},l[l.length-1]+=f+o})),u}_fitCols(t,e,n,r){const{ctx:i,maxHeight:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=s-t;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((t,s)=>{const m=n+e/2+i.measureText(t.text).width;s>0&&d+r+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),a[s]={left:p,top:d,col:f,width:m,height:r},h=Math.max(h,m),d+=r+o})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:r},rtl:i}}=this,s=T8(i,this.left,this.width);if(this.isHorizontal()){let i=0,o=k4(n,this.left+r,this.right-this.lineWidths[i]);for(const a of e)i!==a.row&&(i=a.row,o=k4(n,this.left+r,this.right-this.lineWidths[i])),a.top+=this.top+t+r,a.left=s.leftForLtr(s.x(o),a.width),o+=a.width+r}else{let i=0,o=k4(n,this.top+t+r,this.bottom-this.columnSizes[i].height);for(const a of e)a.col!==i&&(i=a.col,o=k4(n,this.top+t+r,this.bottom-this.columnSizes[i].height)),a.top=o,a.left+=this.left+r,a.left=s.leftForLtr(s.x(a.left),a.width),o+=a.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;b6(t,this),this._draw(),v6(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:r}=this,{align:i,labels:s}=t,o=u6.color,a=T8(t.rtl,this.left,this.width),l=$6(s.font),{color:c,padding:u}=s,h=l.size,d=h/2;let p;this.drawTitle(),r.textAlign=a.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=l.string;const{boxWidth:f,boxHeight:m,itemHeight:g}=Ttt(s,h),y=this.isHorizontal(),b=this._computeTitleHeight();p=y?{x:k4(i,this.left+u,this.right-n[0]),y:this.top+u+b,line:0}:{x:this.left+u,y:k4(i,this.top+b+u,this.bottom-e[0].height),line:0},E8(this.ctx,t.textDirection);const v=g+u;this.legendItems.forEach(((x,w)=>{r.strokeStyle=x.fontColor||c,r.fillStyle=x.fontColor||c;const S=r.measureText(x.text).width,_=a.textAlign(x.textAlign||(x.textAlign=s.textAlign)),k=f+d+S;let T=p.x,E=p.y;a.setWidth(this.width),y?w>0&&T+k+u>this.right&&(E=p.y+=v,p.line++,T=p.x=k4(i,this.left+u,this.right-n[p.line])):w>0&&E+v>this.bottom&&(T=p.x=T+e[p.line].width+u,p.line++,E=p.y=k4(i,this.top+b+u,this.bottom-e[p.line].height));!function(t,e,n){if(isNaN(f)||f<=0||isNaN(m)||m<0)return;r.save();const i=$4(n.lineWidth,1);if(r.fillStyle=$4(n.fillStyle,o),r.lineCap=$4(n.lineCap,"butt"),r.lineDashOffset=$4(n.lineDashOffset,0),r.lineJoin=$4(n.lineJoin,"miter"),r.lineWidth=i,r.strokeStyle=$4(n.strokeStyle,o),r.setLineDash($4(n.lineDash,[])),s.usePointStyle){const s={radius:m*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:i},o=a.xPlus(t,f/2);g6(r,s,o,e+d,f)}else{const s=e+Math.max((h-m)/2,0),o=a.leftForLtr(t,f),l=N6(n.borderRadius);r.beginPath(),Object.values(l).some((t=>0!==t))?k6(r,{x:o,y:s,w:f,h:m,radius:l}):r.rect(o,s,f,m),r.fill(),0!==i&&r.stroke()}r.restore()}(a.x(T),E,x),T=((t,e,n,r)=>t===(r?"left":"right")?n:"center"===t?(e+n)/2:e)(_,T+f+d,y?T+k:this.right,t.rtl),function(t,e,n){S6(r,n.text,t,e+g/2,l,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(T),E,x),y?p.x+=k+u:p.y+=v})),M8(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=$6(e.font),r=I6(e.padding);if(!e.display)return;const i=T8(t.rtl,this.left,this.width),s=this.ctx,o=e.position,a=n.size/2,l=r.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=k4(t.align,u,this.right-h);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);c=l+k4(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=k4(o,u,u+h);s.textAlign=i.textAlign(_4(o)),s.textBaseline="middle",s.strokeStyle=e.color,s.fillStyle=e.color,s.font=n.string,S6(s,e.text,d,c,n)}_computeTitleHeight(){const t=this.options.title,e=$6(t.font),n=I6(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,r,i;if(b5(t,this.left,this.right)&&b5(e,this.top,this.bottom))for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(r=i[n],b5(t,r.left,r.left+r.width)&&b5(e,r.top,r.top+r.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const s=this._hoveredItem,o=(i=n,null!==(r=s)&&null!==i&&r.datasetIndex===i.datasetIndex&&r.index===i.index);s&&!o&&O4(e.onLeave,[t,s,this],this),this._hoveredItem=n,n&&!o&&O4(e.onHover,[t,n,this],this)}else n&&O4(e.onClick,[t,n,this],this);var r,i}}var Mtt={id:"legend",_element:Ett,start(t,e,n){const r=t.legend=new Ett({ctx:t.ctx,options:n,chart:t});L7.configure(t,r,n),L7.addBox(t,r)},stop(t){L7.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const r=t.legend;L7.configure(t,r,n),r.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const r=e.datasetIndex,i=n.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:i,color:s}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const o=t.controller.getStyle(n?0:void 0),a=I6(o.borderWidth);return{text:e[t.index].label,fillStyle:o.backgroundColor,fontColor:s,hidden:!t.visible,lineCap:o.borderCapStyle,lineDash:o.borderDash,lineDashOffset:o.borderDashOffset,lineJoin:o.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:o.borderColor,pointStyle:r||o.pointStyle,rotation:o.rotation,textAlign:i||o.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Ctt extends Q7{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const r=C4(n.text)?n.text.length:1;this._padding=I6(n.padding);const i=r*$6(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:r,right:i,options:s}=this,o=s.align;let a,l,c,u=0;return this.isHorizontal()?(l=k4(o,n,i),c=e+t,a=i-n):("left"===s.position?(l=n+t,c=k4(o,r,e),u=-.5*Y4):(l=i-t,c=k4(o,e,r),u=.5*Y4),a=r-e),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=$6(e.font),r=n.lineHeight/2+this._padding.top,{titleX:i,titleY:s,maxWidth:o,rotation:a}=this._drawArgs(r);S6(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:a,textAlign:_4(e.align),textBaseline:"middle",translation:[i,s]})}}var Att={id:"title",_element:Ctt,start(t,e,n){!function(t,e){const n=new Ctt({ctx:t.ctx,options:e,chart:t});L7.configure(t,n,e),L7.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;L7.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const r=t.titleBlock;L7.configure(t,r,n),r.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ntt={average(t){if(!t.length)return!1;let e,n,r=0,i=0,s=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();r+=t.x,i+=t.y,++s}}return{x:r/s,y:i/s}},nearest(t,e){if(!t.length)return!1;let n,r,i,s=e.x,o=e.y,a=Number.POSITIVE_INFINITY;for(n=0,r=t.length;n<r;++n){const r=t[n].element;if(r&&r.hasValue()){const t=p5(e,r.getCenterPoint());t<a&&(a=t,i=r)}}if(i){const t=i.tooltipPosition();s=t.x,o=t.y}return{x:s,y:o}}};function Itt(t,e){return e&&(C4(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function $tt(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function Rtt(t,e){const{element:n,datasetIndex:r,index:i}=e,s=t.getDatasetMeta(r).controller,{label:o,value:a}=s.getLabelAndValue(i);return{chart:t,label:o,parsed:s.getParsed(i),raw:t.data.datasets[r].data[i],formattedValue:a,dataset:s.getDataset(),dataIndex:i,datasetIndex:r,element:n}}function Ott(t,e){const n=t.chart.ctx,{body:r,footer:i,title:s}=t,{boxWidth:o,boxHeight:a}=e,l=$6(e.bodyFont),c=$6(e.titleFont),u=$6(e.footerFont),h=s.length,d=i.length,p=r.length,f=I6(e.padding);let m=f.height,g=0,y=r.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){m+=p*(e.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(y-p)*l.lineHeight+(y-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let b=0;const v=function(t){g=Math.max(g,n.measureText(t).width+b)};return n.save(),n.font=c.string,P4(t.title,v),n.font=l.string,P4(t.beforeBody.concat(t.afterBody),v),b=e.displayColors?o+2+e.boxPadding:0,P4(r,(t=>{P4(t.before,v),P4(t.lines,v),P4(t.after,v)})),b=0,n.font=u.string,P4(t.footer,v),n.restore(),g+=f.width,{width:g,height:m}}function Ptt(t,e,n,r){const{x:i,width:s}=n,{width:o,chartArea:{left:a,right:l}}=t;let c="center";return"center"===r?c=i<=(a+l)/2?"left":"right":i<=s/2?c="left":i>=o-s/2&&(c="right"),function(t,e,n,r){const{x:i,width:s}=r,o=n.caretSize+n.caretPadding;return"left"===t&&i+s+o>e.width||"right"===t&&i-s-o<0||void 0}(c,t,e,n)&&(c="center"),c}function Ltt(t,e,n){const r=n.yAlign||e.yAlign||function(t,e){const{y:n,height:r}=e;return n<r/2?"top":n>t.height-r/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||Ptt(t,e,n,r),yAlign:r}}function Dtt(t,e,n,r){const{caretSize:i,caretPadding:s,cornerRadius:o}=t,{xAlign:a,yAlign:l}=n,c=i+s,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=N6(o);let f=function(t,e){let{x:n,width:r}=t;return"right"===e?n-=r:"center"===e&&(n-=r/2),n}(e,a);const m=function(t,e,n){let{y:r,height:i}=t;return"top"===e?r+=n:r-="bottom"===e?i+n:i/2,r}(e,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+i:"right"===a&&(f+=Math.max(h,p)+i),{x:y5(f,0,r.width-e.width),y:y5(m,0,r.height-e.height)}}function Ftt(t,e,n){const r=I6(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-r.right:t.x+r.left}function ztt(t){return Itt([],$tt(t))}function Btt(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}class Utt extends Q7{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),r=n.enabled&&e.options.animation&&n.animations,i=new z8(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,n=this._tooltipItems,O6(t,{tooltip:e,tooltipItems:n,type:"tooltip"})));var t,e,n}getTitle(t,e){const{callbacks:n}=e,r=n.beforeTitle.apply(this,[t]),i=n.title.apply(this,[t]),s=n.afterTitle.apply(this,[t]);let o=[];return o=Itt(o,$tt(r)),o=Itt(o,$tt(i)),o=Itt(o,$tt(s)),o}getBeforeBody(t,e){return ztt(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:n}=e,r=[];return P4(t,(t=>{const e={before:[],lines:[],after:[]},i=Btt(n,t);Itt(e.before,$tt(i.beforeLabel.call(this,t))),Itt(e.lines,i.label.call(this,t)),Itt(e.after,$tt(i.afterLabel.call(this,t))),r.push(e)})),r}getAfterBody(t,e){return ztt(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:n}=e,r=n.beforeFooter.apply(this,[t]),i=n.footer.apply(this,[t]),s=n.afterFooter.apply(this,[t]);let o=[];return o=Itt(o,$tt(r)),o=Itt(o,$tt(i)),o=Itt(o,$tt(s)),o}_createItems(t){const e=this._active,n=this.chart.data,r=[],i=[],s=[];let o,a,l=[];for(o=0,a=e.length;o<a;++o)l.push(Rtt(this.chart,e[o]));return t.filter&&(l=l.filter(((e,r,i)=>t.filter(e,r,i,n)))),t.itemSort&&(l=l.sort(((e,r)=>t.itemSort(e,r,n)))),P4(l,(e=>{const n=Btt(t.callbacks,e);r.push(n.labelColor.call(this,e)),i.push(n.labelPointStyle.call(this,e)),s.push(n.labelTextColor.call(this,e))})),this.labelColors=r,this.labelPointStyles=i,this.labelTextColors=s,this.dataPoints=l,l}update(t,e){const n=this.options.setContext(this.getContext()),r=this._active;let i,s=[];if(r.length){const t=Ntt[n.position].call(this,r,this._eventPosition);s=this._createItems(n),this.title=this.getTitle(s,n),this.beforeBody=this.getBeforeBody(s,n),this.body=this.getBody(s,n),this.afterBody=this.getAfterBody(s,n),this.footer=this.getFooter(s,n);const e=this._size=Ott(this,n),o=Object.assign({},t,e),a=Ltt(this.chart,n,o),l=Dtt(n,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,i={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(i={opacity:0});this._tooltipItems=s,this.$context=void 0,i&&this._resolveAnimations().update(this,i),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,r){const i=this.getCaretPosition(t,n,r);e.lineTo(i.x1,i.y1),e.lineTo(i.x2,i.y2),e.lineTo(i.x3,i.y3)}getCaretPosition(t,e,n){const{xAlign:r,yAlign:i}=this,{caretSize:s,cornerRadius:o}=n,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=N6(o),{x:h,y:d}=t,{width:p,height:f}=e;let m,g,y,b,v,x;return"center"===i?(v=d+f/2,"left"===r?(m=h,g=m-s,b=v+s,x=v-s):(m=h+p,g=m+s,b=v-s,x=v+s),y=m):(g="left"===r?h+Math.max(a,c)+s:"right"===r?h+p-Math.max(l,u)-s:this.caretX,"top"===i?(b=d,v=b-s,m=g-s,y=g+s):(b=d+f,v=b+s,m=g+s,y=g-s),x=b),{x1:m,x2:g,x3:y,y1:b,y2:v,y3:x}}drawTitle(t,e,n){const r=this.title,i=r.length;let s,o,a;if(i){const l=T8(n.rtl,this.x,this.width);for(t.x=Ftt(this,n.titleAlign,n),e.textAlign=l.textAlign(n.titleAlign),e.textBaseline="middle",s=$6(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=s.string,a=0;a<i;++a)e.fillText(r[a],l.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+o,a+1===i&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,r,i){const s=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:a,boxWidth:l,boxPadding:c}=i,u=$6(i.bodyFont),h=Ftt(this,"left",i),d=r.x(h),p=a<u.lineHeight?(u.lineHeight-a)/2:0,f=e.y+p;if(i.usePointStyle){const e={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=r.leftForLtr(d,l)+l/2,c=f+a/2;t.strokeStyle=i.multiKeyBackground,t.fillStyle=i.multiKeyBackground,m6(t,e,n,c),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,m6(t,e,n,c)}else{t.lineWidth=A4(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const e=r.leftForLtr(d,l-c),n=r.leftForLtr(r.xPlus(d,1),l-c-2),o=N6(s.borderRadius);Object.values(o).some((t=>0!==t))?(t.beginPath(),t.fillStyle=i.multiKeyBackground,k6(t,{x:e,y:f,w:l,h:a,radius:o}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),k6(t,{x:n,y:f+1,w:l-2,h:a-2,radius:o}),t.fill()):(t.fillStyle=i.multiKeyBackground,t.fillRect(e,f,l,a),t.strokeRect(e,f,l,a),t.fillStyle=s.backgroundColor,t.fillRect(n,f+1,l-2,a-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:r}=this,{bodySpacing:i,bodyAlign:s,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=n,u=$6(n.bodyFont);let h=u.lineHeight,d=0;const p=T8(n.rtl,this.x,this.width),f=function(n){e.fillText(n,p.x(t.x+d),t.y+h/2),t.y+=h+i},m=p.textAlign(s);let g,y,b,v,x,w,S;for(e.textAlign=s,e.textBaseline="middle",e.font=u.string,t.x=Ftt(this,m,n),e.fillStyle=n.bodyColor,P4(this.beforeBody,f),d=o&&"right"!==m?"center"===s?l/2+c:l+2+c:0,v=0,w=r.length;v<w;++v){for(g=r[v],y=this.labelTextColors[v],e.fillStyle=y,P4(g.before,f),b=g.lines,o&&b.length&&(this._drawColorBox(e,t,v,p,n),h=Math.max(u.lineHeight,a)),x=0,S=b.length;x<S;++x)f(b[x]),h=u.lineHeight;P4(g.after,f)}d=0,h=u.lineHeight,P4(this.afterBody,f),t.y-=i}drawFooter(t,e,n){const r=this.footer,i=r.length;let s,o;if(i){const a=T8(n.rtl,this.x,this.width);for(t.x=Ftt(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=a.textAlign(n.footerAlign),e.textBaseline="middle",s=$6(n.footerFont),e.fillStyle=n.footerColor,e.font=s.string,o=0;o<i;++o)e.fillText(r[o],a.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+n.footerSpacing}}drawBackground(t,e,n,r){const{xAlign:i,yAlign:s}=this,{x:o,y:a}=t,{width:l,height:c}=n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=N6(r.cornerRadius);e.fillStyle=r.backgroundColor,e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.beginPath(),e.moveTo(o+u,a),"top"===s&&this.drawCaret(t,e,n,r),e.lineTo(o+l-h,a),e.quadraticCurveTo(o+l,a,o+l,a+h),"center"===s&&"right"===i&&this.drawCaret(t,e,n,r),e.lineTo(o+l,a+c-p),e.quadraticCurveTo(o+l,a+c,o+l-p,a+c),"bottom"===s&&this.drawCaret(t,e,n,r),e.lineTo(o+d,a+c),e.quadraticCurveTo(o,a+c,o,a+c-d),"center"===s&&"left"===i&&this.drawCaret(t,e,n,r),e.lineTo(o,a+u),e.quadraticCurveTo(o,a,o+u,a),e.closePath(),e.fill(),r.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,r=n&&n.x,i=n&&n.y;if(r||i){const n=Ntt[t.position].call(this,this._active,this._eventPosition);if(!n)return;const s=this._size=Ott(this,t),o=Object.assign({},n,this._size),a=Ltt(e,t,o),l=Dtt(t,o,a,e);r._to===l.x&&i._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=s.width,this.height=s.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const r={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const s=I6(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(i,t,r,e),E8(t,e.textDirection),i.y+=s.top,this.drawTitle(i,t,e),this.drawBody(i,t,e),this.drawFooter(i,t,e),M8(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,r=t.map((({datasetIndex:t,index:e})=>{const n=this.chart.getDatasetMeta(t);if(!n)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:n.data[e],index:e}})),i=!L4(n,r),s=this._positionChanged(r,e);(i||s)&&(this._active=r,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,n=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,i=this._active||[],s=this._getActiveElements(t,i,e,n),o=this._positionChanged(s,t),a=e||!L4(s,i)||o;return a&&(this._active=s,(r.enabled||r.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,n,r){const i=this.options;if("mouseout"===t.type)return[];if(!r)return e;const s=this.chart.getElementsAtEventForMode(t,i.mode,i,n);return i.reverse&&s.reverse(),s}_positionChanged(t,e){const{caretX:n,caretY:r,options:i}=this,s=Ntt[i.position].call(this,t,e);return!1!==s&&(n!==s.x||r!==s.y)}}Utt.positioners=Ntt;var Vtt={id:"tooltip",_element:Utt,positioners:Ntt,afterInit(t,e,n){n&&(t.tooltip=new Utt({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",n))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:T4,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,r=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return n[e.dataIndex]}return""},afterTitle:T4,beforeBody:T4,beforeLabel:T4,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return M4(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:T4,afterBody:T4,beforeFooter:T4,footer:T4,afterFooter:T4}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function jtt(t,e,n,r){const i=t.indexOf(e);if(-1===i)return((t,e,n,r)=>("string"==typeof e?(n=t.push(e)-1,r.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,r);return i!==t.lastIndexOf(e)?n:i}class Wtt extends u9{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:r}of e)t[n]===r&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(M4(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:y5(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:jtt(n,t,$4(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:r}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(r=this.getLabels().length-1)),this.min=n,this.max=r}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,r=[];let i=this.getLabels();i=0===t&&e===i.length-1?i:i.slice(t,e+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let n=t;n<=e;n++)r.push({value:n});return r}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function Htt(t,e){const n=[],{bounds:r,step:i,min:s,max:o,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=t,d=i||1,p=c-1,{min:f,max:m}=e,g=!M4(s),y=!M4(o),b=!M4(l),v=(m-f)/(u+1);let x,w,S,_,k=s5((m-f)/p/d)*d;if(k<1e-14&&!g&&!y)return[{value:f},{value:m}];_=Math.ceil(m/k)-Math.floor(f/k),_>p&&(k=s5(_*k/p/d)*d),M4(a)||(x=Math.pow(10,a),k=Math.ceil(k*x)/x),"ticks"===r?(w=Math.floor(f/k)*k,S=Math.ceil(m/k)*k):(w=f,S=m),g&&y&&i&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-s)/i,k/1e3)?(_=Math.round(Math.min((o-s)/k,c)),k=(o-s)/_,w=s,S=o):b?(w=g?s:w,S=y?o:S,_=l-1,k=(S-w)/_):(_=(S-w)/k,_=a5(_,Math.round(_),k/1e3)?Math.round(_):Math.ceil(_));const T=Math.max(h5(k),h5(w));x=Math.pow(10,M4(a)?T:a),w=Math.round(w*x)/x,S=Math.round(S*x)/x;let E=0;for(g&&(h&&w!==s?(n.push({value:s}),w<s&&E++,a5(Math.round((w+E*k)*x)/x,s,Gtt(s,v,t))&&E++):w<s&&E++);E<_;++E)n.push({value:Math.round((w+E*k)*x)/x});return y&&h&&S!==o?n.length&&a5(n[n.length-1].value,o,Gtt(o,v,t))?n[n.length-1].value=o:n.push({value:o}):y&&S!==o||n.push({value:S}),n}function Gtt(t,e,{horizontal:n,minRotation:r}){const i=c5(r),s=(n?Math.sin(i):Math.cos(i))||.001,o=.75*e*(""+t).length;return Math.min(e/s,o)}Wtt.id="category",Wtt.defaults={ticks:{callback:Wtt.prototype.getLabelForValue}};class qtt extends u9{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return M4(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this;const s=t=>r=e?r:t,o=t=>i=n?i:t;if(t){const t=i5(r),e=i5(i);t<0&&e<0?o(0):t>0&&e>0&&s(0)}if(r===i){let e=1;(i>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*i)),o(i+e),t||s(r-e)}this.min=r,this.max=i}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:r}=t;return r?(e=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const r=Htt({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&l5(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const r=(n-e)/Math.max(t.length-1,1)/2;e-=r,n+=r}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return k8(t,this.chart.options.locale,this.options.ticks.format)}}class Xtt extends qtt{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=N4(t)?t:0,this.max=N4(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=c5(this.options.ticks.minRotation),r=(t?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,i.lineHeight/r))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function Ytt(t){return 1===t/Math.pow(10,Math.floor(r5(t)))}Xtt.id="linear",Xtt.defaults={ticks:{callback:e9.formatters.numeric}};class Ktt extends u9{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=qtt.prototype.parse.apply(this,[t,e]);if(0!==n)return N4(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=N4(t)?Math.max(0,t):null,this.max=N4(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,r=this.max;const i=e=>n=t?n:e,s=t=>r=e?r:t,o=(t,e)=>Math.pow(10,Math.floor(r5(t))+e);n===r&&(n<=0?(i(1),s(10)):(i(o(n,-1)),s(o(r,1)))),n<=0&&i(o(r,-1)),r<=0&&s(o(n,1)),this._zero&&this.min!==this._suggestedMin&&n===o(this.min,0)&&i(o(n,-1)),this.min=n,this.max=r}buildTicks(){const t=this.options,e=function(t,e){const n=Math.floor(r5(e.max)),r=Math.ceil(e.max/Math.pow(10,n)),i=[];let s=I4(t.min,Math.pow(10,Math.floor(r5(e.min)))),o=Math.floor(r5(s)),a=Math.floor(s/Math.pow(10,o)),l=o<0?Math.pow(10,Math.abs(o)):1;do{i.push({value:s,major:Ytt(s)}),++a,10===a&&(a=1,++o,l=o>=0?1:l),s=Math.round(a*Math.pow(10,o)*l)/l}while(o<n||o===n&&a<r);const c=I4(t.max,s);return i.push({value:c,major:Ytt(s)}),i}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&l5(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":k8(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=r5(t),this._valueRange=r5(this.max)-r5(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(r5(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Ztt(t){const e=t.ticks;if(e.display&&t.display){const t=I6(e.backdropPadding);return $4(e.font&&e.font.size,u6.font.size)+t.height}return 0}function Jtt(t,e,n){return n=C4(n)?n:[n],{w:d6(t,e.string,n),h:n.length*e.lineHeight}}function Qtt(t,e,n,r,i){return t===r||t===i?{start:e-n/2,end:e+n/2}:t<r||t>i?{start:e-n,end:e}:{start:e,end:e+n}}function tet(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),r=[],i=[],s=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?Y4/s:0;for(let l=0;l<s;l++){const s=o.setContext(t.getPointLabelContext(l));i[l]=s.padding;const c=t.getPointPosition(l,t.drawingArea+i[l],a),u=$6(s.font),h=Jtt(t.ctx,u,t._pointLabels[l]);r[l]=h;const d=m5(t.getIndexAngle(l)+a),p=Math.round(u5(d));eet(n,e,d,Qtt(p,c.x,h.w,0,180),Qtt(p,c.y,h.h,90,270))}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const r=[],i=t._pointLabels.length,s=t.options,o=Ztt(s)/2,a=t.drawingArea,l=s.pointLabels.centerPointLabels?Y4/i:0;for(let s=0;s<i;s++){const i=t.getPointPosition(s,a+o+n[s],l),c=Math.round(u5(m5(i.angle+t5))),u=e[s],h=iet(i.y,u.h,c),d=net(c),p=ret(i.x,u.w,d);r.push({x:i.x,y:h,textAlign:d,left:p,top:h,right:p+u.w,bottom:h+u.h})}return r}(t,r,i)}function eet(t,e,n,r,i){const s=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,l=0;r.start<e.l?(a=(e.l-r.start)/s,t.l=Math.min(t.l,e.l-a)):r.end>e.r&&(a=(r.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),i.start<e.t?(l=(e.t-i.start)/o,t.t=Math.min(t.t,e.t-l)):i.end>e.b&&(l=(i.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function net(t){return 0===t||180===t?"center":t<180?"left":"right"}function ret(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function iet(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function set(t,e,n,r){const{ctx:i}=t;if(n)i.arc(t.xCenter,t.yCenter,e,0,K4);else{let n=t.getPointPosition(0,e);i.moveTo(n.x,n.y);for(let s=1;s<r;s++)n=t.getPointPosition(s,e),i.lineTo(n.x,n.y)}}Ktt.id="logarithmic",Ktt.defaults={ticks:{callback:e9.formatters.logarithmic,major:{enabled:!0}}};class oet extends qtt{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=I6(Ztt(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=N4(t)&&!isNaN(t)?t:0,this.max=N4(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ztt(this.options))}generateTickLabels(t){qtt.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const n=O4(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?tet(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,r){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,r))}getIndexAngle(t){return m5(t*(K4/(this._pointLabels.length||1))+c5(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(M4(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(M4(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return O6(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e,n=0){const r=this.getIndexAngle(t)-t5+n;return{x:Math.cos(r)*e+this.xCenter,y:Math.sin(r)*e+this.yCenter,angle:r}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:r,bottom:i}=this._pointLabelItems[t];return{left:e,top:n,right:r,bottom:i}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),set(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:r}=e,i=this._pointLabels.length;let s,o,a;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:r}}=t;for(let i=e-1;i>=0;i--){const e=r.setContext(t.getPointLabelContext(i)),s=$6(e.font),{x:o,y:a,textAlign:l,left:c,top:u,right:h,bottom:d}=t._pointLabelItems[i],{backdropColor:p}=e;if(!M4(p)){const t=N6(e.borderRadius),r=I6(e.backdropPadding);n.fillStyle=p;const i=c-r.left,s=u-r.top,o=h-c+r.width,a=d-u+r.height;Object.values(t).some((t=>0!==t))?(n.beginPath(),k6(n,{x:i,y:s,w:o,h:a,radius:t}),n.fill()):n.fillRect(i,s,o,a)}S6(n,t._pointLabels[i],o,a+s.lineHeight/2,s,{color:e.color,textAlign:l,textBaseline:"middle"})}}(this,i),r.display&&this.ticks.forEach(((t,e)=>{if(0!==e){o=this.getDistanceFromCenterForValue(t.value);!function(t,e,n,r){const i=t.ctx,s=e.circular,{color:o,lineWidth:a}=e;!s&&!r||!o||!a||n<0||(i.save(),i.strokeStyle=o,i.lineWidth=a,i.setLineDash(e.borderDash),i.lineDashOffset=e.borderDashOffset,i.beginPath(),set(t,n,s,r),i.closePath(),i.stroke(),i.restore())}(this,r.setContext(this.getContext(e-1)),o,i)}})),n.display){for(t.save(),s=i-1;s>=0;s--){const r=n.setContext(this.getPointLabelContext(s)),{color:i,lineWidth:l}=r;l&&i&&(t.lineWidth=l,t.strokeStyle=i,t.setLineDash(r.borderDash),t.lineDashOffset=r.borderDashOffset,o=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),a=this.getPointPosition(s,o),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(a.x,a.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const r=this.getIndexAngle(0);let i,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(r),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((r,o)=>{if(0===o&&!e.reverse)return;const a=n.setContext(this.getContext(o)),l=$6(a.font);if(i=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){t.font=l.string,s=t.measureText(r.label).width,t.fillStyle=a.backdropColor;const e=I6(a.backdropPadding);t.fillRect(-s/2-e.left,-i-l.size/2-e.top,s+e.width,l.size+e.height)}S6(t,r.label,0,-i,l,{color:a.color})})),t.restore()}drawTitle(){}}oet.id="radialLinear",oet.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:e9.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},oet.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},oet.descriptors={angleLines:{_fallback:"grid"}};const aet={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},cet=Object.keys(aet);function uet(t,e){return t-e}function het(t,e){if(M4(e))return null;const n=t._adapter,{parser:r,round:i,isoWeekday:s}=t._parseOpts;let o=e;return"function"==typeof r&&(o=r(o)),N4(o)||(o="string"==typeof r?n.parse(o,r):n.parse(o)),null===o?null:(i&&(o="week"!==i||!o5(s)&&!0!==s?n.startOf(o,i):n.startOf(o,"isoWeek",s)),+o)}function det(t,e,n,r){const i=cet.length;for(let s=cet.indexOf(t);s<i-1;++s){const t=aet[cet[s]],i=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(i*t.size))<=r)return cet[s]}return cet[i-1]}function pet(t,e,n){if(n){if(n.length){const{lo:r,hi:i}=P6(n,e);t[n[r]>=e?n[r]:n[i]]=!0}}else t[e]=!0}function fet(t,e,n){const r=[],i={},s=e.length;let o,a;for(o=0;o<s;++o)a=e[o],i[a]=o,r.push({value:a,major:!1});return 0!==s&&n?function(t,e,n,r){const i=t._adapter,s=+i.startOf(e[0].value,r),o=e[e.length-1].value;let a,l;for(a=s;a<=o;a=+i.add(a,1,r))l=n[a],l>=0&&(e[l].major=!0);return e}(t,r,i,n):r}class met extends u9{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const n=t.time||(t.time={}),r=this._adapter=new g7._date(t.adapters.date);U4(n.displayFormats,r.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:het(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:r,max:i,minDefined:s,maxDefined:o}=this.getUserBounds();function a(t){s||isNaN(t.min)||(r=Math.min(r,t.min)),o||isNaN(t.max)||(i=Math.max(i,t.max))}s&&o||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),r=N4(r)&&!isNaN(r)?r:+e.startOf(Date.now(),n),i=N4(i)&&!isNaN(i)?i:+e.endOf(Date.now(),n)+1,this.min=Math.min(r,i-1),this.max=Math.max(r+1,i)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,r="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const i=this.min,s=function(t,e,n){let r=0,i=t.length;for(;r<i&&t[r]<e;)r++;for(;i>r&&t[i-1]>n;)i--;return r>0||i<t.length?t.slice(r,i):t}(r,i,this.max);return this._unit=e.unit||(n.autoSkip?det(e.minUnit,this.min,this.max,this._getLabelCapacity(i)):function(t,e,n,r,i){for(let s=cet.length-1;s>=cet.indexOf(n);s--){const n=cet[s];if(aet[n].common&&t._adapter.diff(i,r,n)>=e-1)return n}return cet[n?cet.indexOf(n):0]}(this,s.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=cet.indexOf(t)+1,n=cet.length;e<n;++e)if(aet[cet[e]].common)return cet[e]}(this._unit):void 0,this.initOffsets(r),t.reverse&&s.reverse(),fet(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t){let e,n,r=0,i=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),r=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,n=this.getDecimalForValue(t[t.length-1]),i=1===t.length?n:(n-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;r=y5(r,0,s),i=y5(i,0,s),this._offsets={start:r,end:i,factor:1/(r+1+i)}}_generate(){const t=this._adapter,e=this.min,n=this.max,r=this.options,i=r.time,s=i.unit||det(i.minUnit,e,n,this._getLabelCapacity(e)),o=$4(i.stepSize,1),a="week"===s&&i.isoWeekday,l=o5(a)||!0===a,c={};let u,h,d=e;if(l&&(d=+t.startOf(d,"isoWeek",a)),d=+t.startOf(d,l?"day":s),t.diff(n,e,s)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+s);const p="data"===r.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<n;u=+t.add(u,o,s),h++)pet(c,u,p);return u!==n&&"ticks"!==r.bounds&&1!==h||pet(c,u,p),Object.keys(c).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}_tickFormatFunction(t,e,n,r){const i=this.options,s=i.time.displayFormats,o=this._unit,a=this._majorUnit,l=o&&s[o],c=a&&s[a],u=n[e],h=a&&c&&u&&u.major,d=this._adapter.format(t,r||(h?c:l)),p=i.ticks.callback;return p?O4(p,[d,e,n],this):d}generateTickLabels(t){let e,n,r;for(e=0,n=t.length;e<n;++e)r=t[e],r.label=this._tickFormatFunction(r.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,r=c5(this.isHorizontal()?e.maxRotation:e.minRotation),i=Math.cos(r),s=Math.sin(r),o=this._resolveTickFontOptions(0).size;return{w:n*i+o*s,h:n*s+o*i}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,r=n[e.unit]||n.millisecond,i=this._tickFormatFunction(t,0,fet(this,[t],this._majorUnit),r),s=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(t=0,e=r.length;t<e;++t)n=n.concat(r[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const r=this.getLabels();for(e=0,n=r.length;e<n;++e)t.push(het(this,r[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return B6(t.sort(uet))}}function get(t,e,n){let r,i,s,o,a=0,l=t.length-1;n?(e>=t[a].pos&&e<=t[l].pos&&({lo:a,hi:l}=L6(t,"pos",e)),({pos:r,time:s}=t[a]),({pos:i,time:o}=t[l])):(e>=t[a].time&&e<=t[l].time&&({lo:a,hi:l}=L6(t,"time",e)),({time:r,pos:s}=t[a]),({time:i,pos:o}=t[l]));const c=i-r;return c?s+(o-s)*(e-r)/c:s}met.id="time",met.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class yet extends met{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=get(e,this.min),this._tableRange=get(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,r=[],i=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;++s)l=t[s],l>=e&&l<=n&&r.push(l);if(r.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(s=0,o=r.length;s<o;++s)c=r[s+1],a=r[s-1],l=r[s],Math.round((c+a)/2)!==l&&i.push({time:l,pos:s/(o-1)});return i}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(get(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return get(this._table,n*this._tableRange+this._minPos,!0)}}yet.id="timeseries",yet.defaults=met.defaults;class bet extends Error{}class vet extends bet{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class xet extends bet{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class wet extends bet{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class _et extends bet{}class ket extends bet{constructor(t){super(`Invalid unit ${t}`)}}class Tet extends bet{}class Eet extends bet{constructor(){super("Zone is an abstract class")}}const Met="numeric",Cet="short",Aet="long",Net={year:Met,month:Met,day:Met},Iet={year:Met,month:Cet,day:Met},$et={year:Met,month:Cet,day:Met,weekday:Cet},Ret={year:Met,month:Aet,day:Met},Oet={year:Met,month:Aet,day:Met,weekday:Aet},Pet={hour:Met,minute:Met},Let={hour:Met,minute:Met,second:Met},Det={hour:Met,minute:Met,second:Met,timeZoneName:Cet},Fet={hour:Met,minute:Met,second:Met,timeZoneName:Aet},zet={hour:Met,minute:Met,hourCycle:"h23"},Bet={hour:Met,minute:Met,second:Met,hourCycle:"h23"},Uet={hour:Met,minute:Met,second:Met,hourCycle:"h23",timeZoneName:Cet},Vet={hour:Met,minute:Met,second:Met,hourCycle:"h23",timeZoneName:Aet},jet={year:Met,month:Met,day:Met,hour:Met,minute:Met},Wet={year:Met,month:Met,day:Met,hour:Met,minute:Met,second:Met},Het={year:Met,month:Cet,day:Met,hour:Met,minute:Met},Get={year:Met,month:Cet,day:Met,hour:Met,minute:Met,second:Met},qet={year:Met,month:Cet,day:Met,weekday:Cet,hour:Met,minute:Met},Xet={year:Met,month:Aet,day:Met,hour:Met,minute:Met,timeZoneName:Cet},Yet={year:Met,month:Aet,day:Met,hour:Met,minute:Met,second:Met,timeZoneName:Cet},Ket={year:Met,month:Aet,day:Met,weekday:Aet,hour:Met,minute:Met,timeZoneName:Aet},Zet={year:Met,month:Aet,day:Met,weekday:Aet,hour:Met,minute:Met,second:Met,timeZoneName:Aet};function Jet(t){return void 0===t}function Qet(t){return"number"==typeof t}function tnt(t){return"number"==typeof t&&t%1==0}function ent(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(t){return!1}}function nnt(t,e,n){if(0!==t.length)return t.reduce(((t,r)=>{const i=[e(r),r];return t&&n(t[0],i[0])===t[0]?t:i}),null)[1]}function rnt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function int(t,e,n){return tnt(t)&&t>=e&&t<=n}function snt(t,e=2){let n;return n=t<0?"-"+(""+-t).padStart(e,"0"):(""+t).padStart(e,"0"),n}function ont(t){return Jet(t)||null===t||""===t?void 0:parseInt(t,10)}function ant(t){return Jet(t)||null===t||""===t?void 0:parseFloat(t)}function lnt(t){if(!Jet(t)&&null!==t&&""!==t){const e=1e3*parseFloat("0."+t);return Math.floor(e)}}function cnt(t,e,n=!1){const r=10**e;return(n?Math.trunc:Math.round)(t*r)/r}function unt(t){return t%4==0&&(t%100!=0||t%400==0)}function hnt(t){return unt(t)?366:365}function dnt(t,e){const n=function(t,e){return t-e*Math.floor(t/e)}(e-1,12)+1;return 2===n?unt(t+(e-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function pnt(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function fnt(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,n=t-1,r=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return 4===e||3===r?53:52}function mnt(t){return t>99?t:t>60?1900+t:2e3+t}function gnt(t,e,n,r=null){const i=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(n,o).formatToParts(i).find((t=>"timezonename"===t.type.toLowerCase()));return a?a.value:null}function ynt(t,e){let n=parseInt(t,10);Number.isNaN(n)&&(n=0);const r=parseInt(e,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function bnt(t){const e=Number(t);if("boolean"==typeof t||""===t||Number.isNaN(e))throw new Tet(`Invalid unit value ${t}`);return e}function vnt(t,e){const n={};for(const r in t)if(rnt(t,r)){const i=t[r];if(null==i)continue;n[e(r)]=bnt(i)}return n}function xnt(t,e){const n=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),i=t>=0?"+":"-";switch(e){case"short":return`${i}${snt(n,2)}:${snt(r,2)}`;case"narrow":return`${i}${n}${r>0?`:${r}`:""}`;case"techie":return`${i}${snt(n,2)}${snt(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function wnt(t){return function(t,e){return e.reduce(((e,n)=>(e[n]=t[n],e)),{})}(t,["hour","minute","second","millisecond"])}const Snt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,_nt=["January","February","March","April","May","June","July","August","September","October","November","December"],knt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Tnt=["J","F","M","A","M","J","J","A","S","O","N","D"];function Ent(t){switch(t){case"narrow":return[...Tnt];case"short":return[...knt];case"long":return[..._nt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Mnt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Cnt=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Ant=["M","T","W","T","F","S","S"];function Nnt(t){switch(t){case"narrow":return[...Ant];case"short":return[...Cnt];case"long":return[...Mnt];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Int=["AM","PM"],$nt=["Before Christ","Anno Domini"],Rnt=["BC","AD"],Ont=["B","A"];function Pnt(t){switch(t){case"narrow":return[...Ont];case"short":return[...Rnt];case"long":return[...$nt];default:return null}}function Lnt(t,e){let n="";for(const r of t)r.literal?n+=r.val:n+=e(r.val);return n}const Dnt={D:Net,DD:Iet,DDD:Ret,DDDD:Oet,t:Pet,tt:Let,ttt:Det,tttt:Fet,T:zet,TT:Bet,TTT:Uet,TTTT:Vet,f:jet,ff:Het,fff:Xet,ffff:Ket,F:Wet,FF:Get,FFF:Yet,FFFF:Zet};class Fnt{static create(t,e={}){return new Fnt(t,e)}static parseFormat(t){let e=null,n="",r=!1;const i=[];for(let s=0;s<t.length;s++){const o=t.charAt(s);"'"===o?(n.length>0&&i.push({literal:r,val:n}),e=null,n="",r=!r):r||o===e?n+=o:(n.length>0&&i.push({literal:!1,val:n}),n=o,e=o)}return n.length>0&&i.push({literal:r,val:n}),i}static macroTokenToFormatOpts(t){return Dnt[t]}constructor(t,e){this.opts=e,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,e){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(t,{...this.opts,...e}).format()}formatDateTime(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).format()}formatDateTimeParts(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).formatToParts()}resolvedOptions(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).resolvedOptions()}num(t,e=0){if(this.opts.forceSimple)return snt(t,e);const n={...this.opts};return e>0&&(n.padTo=e),this.loc.numberFormatter(n).format(t)}formatDateTimeFromString(t,e){const n="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,i=(e,n)=>this.loc.extract(t,e,n),s=e=>t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):"",o=()=>n?function(t){return Int[t.hour<12?0:1]}(t):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(e,r)=>n?function(t,e){return Ent(e)[t.month-1]}(t,e):i(r?{month:e}:{month:e,day:"numeric"},"month"),l=(e,r)=>n?function(t,e){return Nnt(e)[t.weekday-1]}(t,e):i(r?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday"),c=e=>{const n=Fnt.macroTokenToFormatOpts(e);return n?this.formatWithSystemDefault(t,n):e},u=e=>n?function(t,e){return Pnt(e)[t.year<0?0:1]}(t,e):i({era:e},"era");return Lnt(Fnt.parseFormat(e),(e=>{switch(e){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12==0?12:t.hour%12);case"hh":return this.num(t.hour%12==0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return o();case"d":return r?i({day:"numeric"},"day"):this.num(t.day);case"dd":return r?i({day:"2-digit"},"day"):this.num(t.day,2);case"c":case"E":return this.num(t.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?i({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return r?i({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return r?i({month:"numeric"},"month"):this.num(t.month);case"MM":return r?i({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return r?i({year:"numeric"},"year"):this.num(t.year);case"yy":return r?i({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return r?i({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return r?i({year:"numeric"},"year"):this.num(t.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return c(e)}}))}formatDurationFromString(t,e){const n=t=>{switch(t[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=Fnt.parseFormat(e),i=r.reduce(((t,{literal:e,val:n})=>e?t:t.concat(n)),[]);return Lnt(r,(t=>e=>{const r=n(e);return r?this.num(t.get(r),e.length):e})(t.shiftTo(...i.map(n).filter((t=>t)))))}}class znt{constructor(t,e){this.reason=t,this.explanation=e}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class Bnt{get type(){throw new Eet}get name(){throw new Eet}get ianaName(){return this.name}get isUniversal(){throw new Eet}offsetName(t,e){throw new Eet}formatOffset(t,e){throw new Eet}offset(t){throw new Eet}equals(t){throw new Eet}get isValid(){throw new Eet}}let Unt=null;class Vnt extends Bnt{static get instance(){return null===Unt&&(Unt=new Vnt),Unt}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return gnt(t,e,n)}formatOffset(t,e){return xnt(this.offset(t),e)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return"system"===t.type}get isValid(){return!0}}let jnt={};const Wnt={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Hnt={};class Gnt extends Bnt{static create(t){return Hnt[t]||(Hnt[t]=new Gnt(t)),Hnt[t]}static resetCache(){Hnt={},jnt={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch(t){return!1}}constructor(t){super(),this.zoneName=t,this.valid=Gnt.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return gnt(t,e,n,this.name)}formatOffset(t,e){return xnt(this.offset(t),e)}offset(t){const e=new Date(t);if(isNaN(e))return NaN;const n=(r=this.name,jnt[r]||(jnt[r]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),jnt[r]);var r;let[i,s,o,a,l,c,u]=n.formatToParts?function(t,e){const n=t.formatToParts(e),r=[];for(let t=0;t<n.length;t++){const{type:e,value:i}=n[t],s=Wnt[e];"era"===e?r[s]=i:Jet(s)||(r[s]=parseInt(i,10))}return r}(n,e):function(t,e){const n=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,i,s,o,a,l,c,u]=r;return[o,i,s,a,l,c,u]}(n,e);"BC"===a&&(i=1-Math.abs(i));let h=+e;const d=h%1e3;return h-=d>=0?d:1e3+d,(pnt({year:i,month:s,day:o,hour:24===l?0:l,minute:c,second:u,millisecond:0})-h)/6e4}equals(t){return"iana"===t.type&&t.name===this.name}get isValid(){return this.valid}}let qnt=null;class Xnt extends Bnt{static get utcInstance(){return null===qnt&&(qnt=new Xnt(0)),qnt}static instance(t){return 0===t?Xnt.utcInstance:new Xnt(t)}static parseSpecifier(t){if(t){const e=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(e)return new Xnt(ynt(e[1],e[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${xnt(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${xnt(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,e){return xnt(this.fixed,e)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return"fixed"===t.type&&t.fixed===this.fixed}get isValid(){return!0}}class Ynt extends Bnt{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Knt(t,e){if(Jet(t)||null===t)return e;if(t instanceof Bnt)return t;if("string"==typeof t){const n=t.toLowerCase();return"local"===n||"system"===n?e:"utc"===n||"gmt"===n?Xnt.utcInstance:Xnt.parseSpecifier(n)||Gnt.create(t)}return Qet(t)?Xnt.instance(t):"object"==typeof t&&t.offset&&"number"==typeof t.offset?t:new Ynt(t)}let Znt,Jnt=()=>Date.now(),Qnt="system",trt=null,ert=null,nrt=null;class rrt{static get now(){return Jnt}static set now(t){Jnt=t}static set defaultZone(t){Qnt=t}static get defaultZone(){return Knt(Qnt,Vnt.instance)}static get defaultLocale(){return trt}static set defaultLocale(t){trt=t}static get defaultNumberingSystem(){return ert}static set defaultNumberingSystem(t){ert=t}static get defaultOutputCalendar(){return nrt}static set defaultOutputCalendar(t){nrt=t}static get throwOnInvalid(){return Znt}static set throwOnInvalid(t){Znt=t}static resetCaches(){mrt.resetCache(),Gnt.resetCache()}}let irt={};let srt={};function art(t,e={}){const n=JSON.stringify([t,e]);let r=srt[n];return r||(r=new Intl.DateTimeFormat(t,e),srt[n]=r),r}let lrt={};let crt={};let urt=null;function hrt(t,e,n,r,i){const s=t.listingMode(n);return"error"===s?null:"en"===s?r(e):i(e)}class drt{constructor(t,e,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:r,floor:i,...s}=n;if(!e||Object.keys(s).length>0){const e={useGrouping:!1,...n};n.padTo>0&&(e.minimumIntegerDigits=n.padTo),this.inf=function(t,e={}){const n=JSON.stringify([t,e]);let r=lrt[n];return r||(r=new Intl.NumberFormat(t,e),lrt[n]=r),r}(t,e)}}format(t){if(this.inf){const e=this.floor?Math.floor(t):t;return this.inf.format(e)}return snt(this.floor?Math.floor(t):cnt(t,3),this.padTo)}}class prt{constructor(t,e,n){let r;if(this.opts=n,t.zone.isUniversal){const e=t.offset/60*-1,i=e>=0?`Etc/GMT+${e}`:`Etc/GMT${e}`;0!==t.offset&&Gnt.create(i).valid?(r=i,this.dt=t):(r="UTC",n.timeZoneName?this.dt=t:this.dt=0===t.offset?t:hst.fromMillis(t.ts+60*t.offset*1e3))}else"system"===t.zone.type?this.dt=t:(this.dt=t,r=t.zone.name);const i={...this.opts};r&&(i.timeZone=r),this.dtf=art(e,i)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class frt{constructor(t,e,n){this.opts={style:"long",...n},!e&&ent()&&(this.rtf=function(t,e={}){const{base:n,...r}=e,i=JSON.stringify([t,r]);let s=crt[i];return s||(s=new Intl.RelativeTimeFormat(t,e),crt[i]=s),s}(t,n))}format(t,e){return this.rtf?this.rtf.format(t,e):function(t,e,n="always",r=!1){const i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(t);if("auto"===n&&s){const n="days"===t;switch(e){case 1:return n?"tomorrow":`next ${i[t][0]}`;case-1:return n?"yesterday":`last ${i[t][0]}`;case 0:return n?"today":`this ${i[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=1===a,c=i[t],u=r?l?c[1]:c[2]||c[1]:l?i[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}(e,t,this.opts.numeric,"long"!==this.opts.style)}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}}class mrt{static fromOpts(t){return mrt.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,e,n,r=!1){const i=t||rrt.defaultLocale,s=i||(r?"en-US":urt||(urt=(new Intl.DateTimeFormat).resolvedOptions().locale,urt)),o=e||rrt.defaultNumberingSystem,a=n||rrt.defaultOutputCalendar;return new mrt(s,o,a,i)}static resetCache(){urt=null,srt={},lrt={},crt={}}static fromObject({locale:t,numberingSystem:e,outputCalendar:n}={}){return mrt.create(t,e,n)}constructor(t,e,n,r){const[i,s,o]=function(t){const e=t.indexOf("-u-");if(-1===e)return[t];{let n;const r=t.substring(0,e);try{n=art(t).resolvedOptions()}catch(t){n=art(r).resolvedOptions()}const{numberingSystem:i,calendar:s}=n;return[r,i,s]}}(t);this.locale=i,this.numberingSystem=e||s||null,this.outputCalendar=n||o||null,this.intl=function(t,e,n){return n||e?(t+="-u",n&&(t+=`-ca-${n}`),e&&(t+=`-nu-${e}`),t):t}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var t;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(t=this).numberingSystem||"latn"===t.numberingSystem)&&("latn"===t.numberingSystem||!t.locale||t.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),e=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t&&e?"en":"intl"}clone(t){return t&&0!==Object.getOwnPropertyNames(t).length?mrt.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,e=!1,n=!0){return hrt(this,t,n,Ent,(()=>{const n=e?{month:t,day:"numeric"}:{month:t},r=e?"format":"standalone";return this.monthsCache[r][t]||(this.monthsCache[r][t]=function(t){const e=[];for(let n=1;n<=12;n++){const r=hst.utc(2016,n,1);e.push(t(r))}return e}((t=>this.extract(t,n,"month")))),this.monthsCache[r][t]}))}weekdays(t,e=!1,n=!0){return hrt(this,t,n,Nnt,(()=>{const n=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},r=e?"format":"standalone";return this.weekdaysCache[r][t]||(this.weekdaysCache[r][t]=function(t){const e=[];for(let n=1;n<=7;n++){const r=hst.utc(2016,11,13+n);e.push(t(r))}return e}((t=>this.extract(t,n,"weekday")))),this.weekdaysCache[r][t]}))}meridiems(t=!0){return hrt(this,void 0,t,(()=>Int),(()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[hst.utc(2016,11,13,9),hst.utc(2016,11,13,19)].map((e=>this.extract(e,t,"dayperiod")))}return this.meridiemCache}))}eras(t,e=!0){return hrt(this,t,e,Pnt,(()=>{const e={era:t};return this.eraCache[t]||(this.eraCache[t]=[hst.utc(-40,1,1),hst.utc(2017,1,1)].map((t=>this.extract(t,e,"era")))),this.eraCache[t]}))}extract(t,e,n){const r=this.dtFormatter(t,e).formatToParts().find((t=>t.type.toLowerCase()===n));return r?r.value:null}numberFormatter(t={}){return new drt(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new prt(t,this.intl,e)}relFormatter(t={}){return new frt(this.intl,this.isEnglish(),t)}listFormatter(t={}){return function(t,e={}){const n=JSON.stringify([t,e]);let r=irt[n];return r||(r=new Intl.ListFormat(t,e),irt[n]=r),r}(this.intl,t)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function grt(...t){const e=t.reduce(((t,e)=>t+e.source),"");return RegExp(`^${e}$`)}function yrt(...t){return e=>t.reduce((([t,n,r],i)=>{const[s,o,a]=i(e,r);return[{...t,...s},o||n,a]}),[{},null,1]).slice(0,2)}function brt(t,...e){if(null==t)return[null,null];for(const[n,r]of e){const e=n.exec(t);if(e)return r(e)}return[null,null]}function vrt(...t){return(e,n)=>{const r={};let i;for(i=0;i<t.length;i++)r[t[i]]=ont(e[n+i]);return[r,null,n+i]}}const xrt=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,wrt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Srt=RegExp(`${wrt.source}${`(?:${xrt.source}?(?:\\[(${Snt.source})\\])?)?`}`),_rt=RegExp(`(?:T${Srt.source})?`),krt=vrt("weekYear","weekNumber","weekDay"),Trt=vrt("year","ordinal"),Ert=RegExp(`${wrt.source} ?(?:${xrt.source}|(${Snt.source}))?`),Mrt=RegExp(`(?: ${Ert.source})?`);function Crt(t,e,n){const r=t[e];return Jet(r)?n:ont(r)}function Art(t,e){return[{hours:Crt(t,e,0),minutes:Crt(t,e+1,0),seconds:Crt(t,e+2,0),milliseconds:lnt(t[e+3])},null,e+4]}function Nrt(t,e){const n=!t[e]&&!t[e+1],r=ynt(t[e+1],t[e+2]);return[{},n?null:Xnt.instance(r),e+3]}function Irt(t,e){return[{},t[e]?Gnt.create(t[e]):null,e+1]}const $rt=RegExp(`^T?${wrt.source}$`),Rrt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Ort(t){const[e,n,r,i,s,o,a,l,c]=t,u="-"===e[0],h=l&&"-"===l[0],d=(t,e=!1)=>void 0!==t&&(e||t&&u)?-t:t;return[{years:d(ant(n)),months:d(ant(r)),weeks:d(ant(i)),days:d(ant(s)),hours:d(ant(o)),minutes:d(ant(a)),seconds:d(ant(l),"-0"===l),milliseconds:d(lnt(c),h)}]}const Prt={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Lrt(t,e,n,r,i,s,o){const a={year:2===e.length?mnt(ont(e)):ont(e),month:knt.indexOf(n)+1,day:ont(r),hour:ont(i),minute:ont(s)};return o&&(a.second=ont(o)),t&&(a.weekday=t.length>3?Mnt.indexOf(t)+1:Cnt.indexOf(t)+1),a}const Drt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Frt(t){const[,e,n,r,i,s,o,a,l,c,u,h]=t,d=Lrt(e,i,r,n,s,o,a);let p;return p=l?Prt[l]:c?0:ynt(u,h),[d,new Xnt(p)]}const zrt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Brt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Urt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Vrt(t){const[,e,n,r,i,s,o,a]=t;return[Lrt(e,i,r,n,s,o,a),Xnt.utcInstance]}function jrt(t){const[,e,n,r,i,s,o,a]=t;return[Lrt(e,a,n,r,i,s,o),Xnt.utcInstance]}const Wrt=grt(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,_rt),Hrt=grt(/(\d{4})-?W(\d\d)(?:-?(\d))?/,_rt),Grt=grt(/(\d{4})-?(\d{3})/,_rt),qrt=grt(Srt),Xrt=yrt((function(t,e){return[{year:Crt(t,e),month:Crt(t,e+1,1),day:Crt(t,e+2,1)},null,e+3]}),Art,Nrt,Irt),Yrt=yrt(krt,Art,Nrt,Irt),Krt=yrt(Trt,Art,Nrt,Irt),Zrt=yrt(Art,Nrt,Irt);const Jrt=yrt(Art);const Qrt=grt(/(\d{4})-(\d\d)-(\d\d)/,Mrt),tit=grt(Ert),eit=yrt(Art,Nrt,Irt);const nit={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},rit={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...nit},iit={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...nit},sit=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],oit=sit.slice(0).reverse();function ait(t,e,n=!1){const r={values:n?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy};return new cit(r)}function lit(t,e,n,r,i){const s=t[i][n],o=e[n]/s,a=!(Math.sign(o)===Math.sign(r[i]))&&0!==r[i]&&Math.abs(o)<=1?function(t){return t<0?Math.floor(t):Math.ceil(t)}(o):Math.trunc(o);r[i]+=a,e[n]-=a*s}class cit{constructor(t){const e="longterm"===t.conversionAccuracy||!1;this.values=t.values,this.loc=t.loc||mrt.create(),this.conversionAccuracy=e?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=e?iit:rit,this.isLuxonDuration=!0}static fromMillis(t,e){return cit.fromObject({milliseconds:t},e)}static fromObject(t,e={}){if(null==t||"object"!=typeof t)throw new Tet("Duration.fromObject: argument expected to be an object, got "+(null===t?"null":typeof t));return new cit({values:vnt(t,cit.normalizeUnit),loc:mrt.fromObject(e),conversionAccuracy:e.conversionAccuracy})}static fromDurationLike(t){if(Qet(t))return cit.fromMillis(t);if(cit.isDuration(t))return t;if("object"==typeof t)return cit.fromObject(t);throw new Tet(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,e){const[n]=function(t){return brt(t,[Rrt,Ort])}(t);return n?cit.fromObject(n,e):cit.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,e){const[n]=function(t){return brt(t,[$rt,Jrt])}(t);return n?cit.fromObject(n,e):cit.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,e=null){if(!t)throw new Tet("need to specify a reason the Duration is invalid");const n=t instanceof znt?t:new znt(t,e);if(rrt.throwOnInvalid)throw new wet(n);return new cit({invalid:n})}static normalizeUnit(t){const e={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t?t.toLowerCase():t];if(!e)throw new ket(t);return e}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,e={}){const n={...e,floor:!1!==e.round&&!1!==e.floor};return this.isValid?Fnt.create(this.loc,n).formatDurationFromString(this,t):"Invalid Duration"}toHuman(t={}){const e=sit.map((e=>{const n=this.values[e];return Jet(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:e.slice(0,-1)}).format(n)})).filter((t=>t));return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(e)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return 0!==this.years&&(t+=this.years+"Y"),0===this.months&&0===this.quarters||(t+=this.months+3*this.quarters+"M"),0!==this.weeks&&(t+=this.weeks+"W"),0!==this.days&&(t+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(t+="T"),0!==this.hours&&(t+=this.hours+"H"),0!==this.minutes&&(t+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(t+=cnt(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===t&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const e=this.toMillis();if(e<0||e>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const n=this.shiftTo("hours","minutes","seconds","milliseconds");let r="basic"===t.format?"hhmm":"hh:mm";t.suppressSeconds&&0===n.seconds&&0===n.milliseconds||(r+="basic"===t.format?"ss":":ss",t.suppressMilliseconds&&0===n.milliseconds||(r+=".SSS"));let i=n.toFormat(r);return t.includePrefix&&(i="T"+i),i}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const e=cit.fromDurationLike(t),n={};for(const t of sit)(rnt(e.values,t)||rnt(this.values,t))&&(n[t]=e.get(t)+this.get(t));return ait(this,{values:n},!0)}minus(t){if(!this.isValid)return this;const e=cit.fromDurationLike(t);return this.plus(e.negate())}mapUnits(t){if(!this.isValid)return this;const e={};for(const n of Object.keys(this.values))e[n]=bnt(t(this.values[n],n));return ait(this,{values:e},!0)}get(t){return this[cit.normalizeUnit(t)]}set(t){if(!this.isValid)return this;return ait(this,{values:{...this.values,...vnt(t,cit.normalizeUnit)}})}reconfigure({locale:t,numberingSystem:e,conversionAccuracy:n}={}){const r={loc:this.loc.clone({locale:t,numberingSystem:e})};return n&&(r.conversionAccuracy=n),ait(this,r)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return function(t,e){oit.reduce(((n,r)=>Jet(e[r])?n:(n&&lit(t,e,n,e,r),r)),null)}(this.matrix,t),ait(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(0===t.length)return this;t=t.map((t=>cit.normalizeUnit(t)));const e={},n={},r=this.toObject();let i;for(const s of sit)if(t.indexOf(s)>=0){i=s;let t=0;for(const e in n)t+=this.matrix[e][s]*n[e],n[e]=0;Qet(r[s])&&(t+=r[s]);const o=Math.trunc(t);e[s]=o,n[s]=(1e3*t-1e3*o)/1e3;for(const t in r)sit.indexOf(t)>sit.indexOf(s)&&lit(this.matrix,r,t,e,s)}else Qet(r[s])&&(n[s]=r[s]);for(const t in n)0!==n[t]&&(e[i]+=t===i?n[t]:n[t]/this.matrix[i][t]);return ait(this,{values:e},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const e of Object.keys(this.values))t[e]=0===this.values[e]?0:-this.values[e];return ait(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid)return!1;if(!this.loc.equals(t.loc))return!1;for(const r of sit)if(e=this.values[r],n=t.values[r],!(void 0===e||0===e?void 0===n||0===n:e===n))return!1;var e,n;return!0}}const uit="Invalid Interval";class hit{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,e=null){if(!t)throw new Tet("need to specify a reason the Interval is invalid");const n=t instanceof znt?t:new znt(t,e);if(rrt.throwOnInvalid)throw new xet(n);return new hit({invalid:n})}static fromDateTimes(t,e){const n=dst(t),r=dst(e),i=function(t,e){return t&&t.isValid?e&&e.isValid?e<t?hit.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null:hit.invalid("missing or invalid end"):hit.invalid("missing or invalid start")}(n,r);return null==i?new hit({start:n,end:r}):i}static after(t,e){const n=cit.fromDurationLike(e),r=dst(t);return hit.fromDateTimes(r,r.plus(n))}static before(t,e){const n=cit.fromDurationLike(e),r=dst(t);return hit.fromDateTimes(r.minus(n),r)}static fromISO(t,e){const[n,r]=(t||"").split("/",2);if(n&&r){let t,i,s,o;try{t=hst.fromISO(n,e),i=t.isValid}catch(r){i=!1}try{s=hst.fromISO(r,e),o=s.isValid}catch(r){o=!1}if(i&&o)return hit.fromDateTimes(t,s);if(i){const n=cit.fromISO(r,e);if(n.isValid)return hit.after(t,n)}else if(o){const t=cit.fromISO(n,e);if(t.isValid)return hit.before(s,t)}}return hit.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const e=this.start.startOf(t),n=this.end.startOf(t);return Math.floor(n.diff(e,t).get(t))+1}hasSame(t){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,t))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return!!this.isValid&&this.s>t}isBefore(t){return!!this.isValid&&this.e<=t}contains(t){return!!this.isValid&&(this.s<=t&&this.e>t)}set({start:t,end:e}={}){return this.isValid?hit.fromDateTimes(t||this.s,e||this.e):this}splitAt(...t){if(!this.isValid)return[];const e=t.map(dst).filter((t=>this.contains(t))).sort(),n=[];let{s:r}=this,i=0;for(;r<this.e;){const t=e[i]||this.e,s=+t>+this.e?this.e:t;n.push(hit.fromDateTimes(r,s)),r=s,i+=1}return n}splitBy(t){const e=cit.fromDurationLike(t);if(!this.isValid||!e.isValid||0===e.as("milliseconds"))return[];let n,{s:r}=this,i=1;const s=[];for(;r<this.e;){const t=this.start.plus(e.mapUnits((t=>t*i)));n=+t>+this.e?this.e:t,s.push(hit.fromDateTimes(r,n)),r=n,i+=1}return s}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return!!this.isValid&&+this.e==+t.s}abutsEnd(t){return!!this.isValid&&+t.e==+this.s}engulfs(t){return!!this.isValid&&(this.s<=t.s&&this.e>=t.e)}equals(t){return!(!this.isValid||!t.isValid)&&(this.s.equals(t.s)&&this.e.equals(t.e))}intersection(t){if(!this.isValid)return this;const e=this.s>t.s?this.s:t.s,n=this.e<t.e?this.e:t.e;return e>=n?null:hit.fromDateTimes(e,n)}union(t){if(!this.isValid)return this;const e=this.s<t.s?this.s:t.s,n=this.e>t.e?this.e:t.e;return hit.fromDateTimes(e,n)}static merge(t){const[e,n]=t.sort(((t,e)=>t.s-e.s)).reduce((([t,e],n)=>e?e.overlaps(n)||e.abutsStart(n)?[t,e.union(n)]:[t.concat([e]),n]:[t,n]),[[],null]);return n&&e.push(n),e}static xor(t){let e=null,n=0;const r=[],i=t.map((t=>[{time:t.s,type:"s"},{time:t.e,type:"e"}])),s=Array.prototype.concat(...i).sort(((t,e)=>t.time-e.time));for(const t of s)n+="s"===t.type?1:-1,1===n?e=t.time:(e&&+e!=+t.time&&r.push(hit.fromDateTimes(e,t.time)),e=null);return hit.merge(r)}difference(...t){return hit.xor([this].concat(t)).map((t=>this.intersection(t))).filter((t=>t&&!t.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:uit}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:uit}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:uit}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:uit}toFormat(t,{separator:e="  "}={}){return this.isValid?`${this.s.toFormat(t)}${e}${this.e.toFormat(t)}`:uit}toDuration(t,e){return this.isValid?this.e.diff(this.s,t,e):cit.invalid(this.invalidReason)}mapEndpoints(t){return hit.fromDateTimes(t(this.s),t(this.e))}}class dit{static hasDST(t=rrt.defaultZone){const e=hst.now().setZone(t).set({month:12});return!t.isUniversal&&e.offset!==e.set({month:6}).offset}static isValidIANAZone(t){return Gnt.isValidZone(t)}static normalizeZone(t){return Knt(t,rrt.defaultZone)}static months(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||mrt.create(e,n,i)).months(t)}static monthsFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||mrt.create(e,n,i)).months(t,!0)}static weekdays(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||mrt.create(e,n,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||mrt.create(e,n,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return mrt.create(t).meridiems()}static eras(t="short",{locale:e=null}={}){return mrt.create(e,null,"gregory").eras(t)}static features(){return{relative:ent()}}}function pit(t,e){const n=t=>t.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(e)-n(t);return Math.floor(cit.fromMillis(r).as("days"))}function fit(t,e,n,r){let[i,s,o,a]=function(t,e,n){const r=[["years",(t,e)=>e.year-t.year],["quarters",(t,e)=>e.quarter-t.quarter],["months",(t,e)=>e.month-t.month+12*(e.year-t.year)],["weeks",(t,e)=>{const n=pit(t,e);return(n-n%7)/7}],["days",pit]],i={};let s,o;for(const[a,l]of r)if(n.indexOf(a)>=0){s=a;let n=l(t,e);o=t.plus({[a]:n}),o>e?(t=t.plus({[a]:n-1}),n-=1):t=o,i[a]=n}return[t,i,o,s]}(t,e,n);const l=e-i,c=n.filter((t=>["hours","minutes","seconds","milliseconds"].indexOf(t)>=0));0===c.length&&(o<e&&(o=i.plus({[a]:1})),o!==i&&(s[a]=(s[a]||0)+l/(o-i)));const u=cit.fromObject(s,r);return c.length>0?cit.fromMillis(l,r).shiftTo(...c).plus(u):u}const mit={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},git={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},yit=mit.hanidec.replace(/[\[|\]]/g,"").split("");function bit({numberingSystem:t},e=""){return new RegExp(`${mit[t||"latn"]}${e}`)}function vit(t,e=(t=>t)){return{regex:t,deser:([t])=>e(function(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);if(-1!==t[n].search(mit.hanidec))e+=yit.indexOf(t[n]);else for(const t in git){const[n,i]=git[t];r>=n&&r<=i&&(e+=r-n)}}return parseInt(e,10)}return e}(t))}}const xit=`[ ${String.fromCharCode(160)}]`,wit=new RegExp(xit,"g");function Sit(t){return t.replace(/\./g,"\\.?").replace(wit,xit)}function _it(t){return t.replace(/\./g,"").replace(wit," ").toLowerCase()}function kit(t,e){return null===t?null:{regex:RegExp(t.map(Sit).join("|")),deser:([n])=>t.findIndex((t=>_it(n)===_it(t)))+e}}function Tit(t,e){return{regex:t,deser:([,t,e])=>ynt(t,e),groups:e}}function Eit(t){return{regex:t,deser:([t])=>t}}const Mit={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let Cit=null;function Ait(t,e){if(t.literal)return t;const n=Fnt.macroTokenToFormatOpts(t.val);if(!n)return t;const r=Fnt.create(e,n).formatDateTimeParts((Cit||(Cit=hst.fromMillis(1555555555555)),Cit)).map((t=>function(t,e,n){const{type:r,value:i}=t;if("literal"===r)return{literal:!0,val:i};const s=n[r];let o=Mit[r];return"object"==typeof o&&(o=o[s]),o?{literal:!1,val:o}:void 0}(t,0,n)));return r.includes(void 0)?t:r}function Nit(t,e,n){const r=function(t,e){return Array.prototype.concat(...t.map((t=>Ait(t,e))))}(Fnt.parseFormat(n),t),i=r.map((e=>function(t,e){const n=bit(e),r=bit(e,"{2}"),i=bit(e,"{3}"),s=bit(e,"{4}"),o=bit(e,"{6}"),a=bit(e,"{1,2}"),l=bit(e,"{1,3}"),c=bit(e,"{1,6}"),u=bit(e,"{1,9}"),h=bit(e,"{2,4}"),d=bit(e,"{4,6}"),p=t=>{return{regex:RegExp((e=t.val,e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([t])=>t,literal:!0};var e},f=(f=>{if(t.literal)return p(f);switch(f.val){case"G":return kit(e.eras("short",!1),0);case"GG":return kit(e.eras("long",!1),0);case"y":return vit(c);case"yy":case"kk":return vit(h,mnt);case"yyyy":case"kkkk":return vit(s);case"yyyyy":return vit(d);case"yyyyyy":return vit(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return vit(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return vit(r);case"MMM":return kit(e.months("short",!0,!1),1);case"MMMM":return kit(e.months("long",!0,!1),1);case"LLL":return kit(e.months("short",!1,!1),1);case"LLLL":return kit(e.months("long",!1,!1),1);case"o":case"S":return vit(l);case"ooo":case"SSS":return vit(i);case"u":return Eit(u);case"uu":return Eit(a);case"uuu":case"E":case"c":return vit(n);case"a":return kit(e.meridiems(),0);case"EEE":return kit(e.weekdays("short",!1,!1),1);case"EEEE":return kit(e.weekdays("long",!1,!1),1);case"ccc":return kit(e.weekdays("short",!0,!1),1);case"cccc":return kit(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Tit(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Tit(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return Eit(/[a-z_+-/]{1,256}?/i);default:return p(f)}})(t)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return f.token=t,f}(e,t))),s=i.find((t=>t.invalidReason));if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[t,n]=function(t){return[`^${t.map((t=>t.regex)).reduce(((t,e)=>`${t}(${e.source})`),"")}$`,t]}(i),s=RegExp(t,"i"),[o,a]=function(t,e,n){const r=t.match(e);if(r){const t={};let e=1;for(const i in n)if(rnt(n,i)){const s=n[i],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(t[s.token.val[0]]=s.deser(r.slice(e,e+o))),e+=o}return[r,t]}return[r,{}]}(e,s,n),[l,c,u]=a?function(t){let e,n=null;return Jet(t.z)||(n=Gnt.create(t.z)),Jet(t.Z)||(n||(n=new Xnt(t.Z)),e=t.Z),Jet(t.q)||(t.M=3*(t.q-1)+1),Jet(t.h)||(t.h<12&&1===t.a?t.h+=12:12===t.h&&0===t.a&&(t.h=0)),0===t.G&&t.y&&(t.y=-t.y),Jet(t.u)||(t.S=lnt(t.u)),[Object.keys(t).reduce(((e,n)=>{const r=(t=>{switch(t){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return r&&(e[r]=t[n]),e}),{}),n,e]}(a):[null,null,void 0];if(rnt(a,"a")&&rnt(a,"H"))throw new _et("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:s,rawMatches:o,matches:a,result:l,zone:c,specificOffset:u}}}const Iit=[0,31,59,90,120,151,181,212,243,273,304,334],$it=[0,31,60,91,121,152,182,213,244,274,305,335];function Rit(t,e){return new znt("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Oit(t,e,n){const r=new Date(Date.UTC(t,e-1,n));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const i=r.getUTCDay();return 0===i?7:i}function Pit(t,e,n){return n+(unt(t)?$it:Iit)[e-1]}function Lit(t,e){const n=unt(t)?$it:Iit,r=n.findIndex((t=>t<e));return{month:r+1,day:e-n[r]}}function Dit(t){const{year:e,month:n,day:r}=t,i=Pit(e,n,r),s=Oit(e,n,r);let o,a=Math.floor((i-s+10)/7);return a<1?(o=e-1,a=fnt(o)):a>fnt(e)?(o=e+1,a=1):o=e,{weekYear:o,weekNumber:a,weekday:s,...wnt(t)}}function Fit(t){const{weekYear:e,weekNumber:n,weekday:r}=t,i=Oit(e,1,4),s=hnt(e);let o,a=7*n+r-i-3;a<1?(o=e-1,a+=hnt(o)):a>s?(o=e+1,a-=hnt(e)):o=e;const{month:l,day:c}=Lit(o,a);return{year:o,month:l,day:c,...wnt(t)}}function zit(t){const{year:e,month:n,day:r}=t;return{year:e,ordinal:Pit(e,n,r),...wnt(t)}}function Bit(t){const{year:e,ordinal:n}=t,{month:r,day:i}=Lit(e,n);return{year:e,month:r,day:i,...wnt(t)}}function Uit(t){const e=tnt(t.year),n=int(t.month,1,12),r=int(t.day,1,dnt(t.year,t.month));return e?n?!r&&Rit("day",t.day):Rit("month",t.month):Rit("year",t.year)}function Vit(t){const{hour:e,minute:n,second:r,millisecond:i}=t,s=int(e,0,23)||24===e&&0===n&&0===r&&0===i,o=int(n,0,59),a=int(r,0,59),l=int(i,0,999);return s?o?a?!l&&Rit("millisecond",i):Rit("second",r):Rit("minute",n):Rit("hour",e)}const jit="Invalid DateTime";function Wit(t){return new znt("unsupported zone",`the zone "${t.name}" is not supported`)}function Hit(t){return null===t.weekData&&(t.weekData=Dit(t.c)),t.weekData}function Git(t,e){const n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new hst({...n,...e,old:n})}function qit(t,e,n){let r=t-60*e*1e3;const i=n.offset(r);if(e===i)return[r,e];r-=60*(i-e)*1e3;const s=n.offset(r);return i===s?[r,i]:[t-60*Math.min(i,s)*1e3,Math.max(i,s)]}function Xit(t,e){const n=new Date(t+=60*e*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function Yit(t,e,n){return qit(pnt(t),e,n)}function Kit(t,e){const n=t.o,r=t.c.year+Math.trunc(e.years),i=t.c.month+Math.trunc(e.months)+3*Math.trunc(e.quarters),s={...t.c,year:r,month:i,day:Math.min(t.c.day,dnt(r,i))+Math.trunc(e.days)+7*Math.trunc(e.weeks)},o=cit.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=pnt(s);let[l,c]=qit(a,n,t.zone);return 0!==o&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function Zit(t,e,n,r,i,s){const{setZone:o,zone:a}=n;if(t&&0!==Object.keys(t).length){const r=e||a,i=hst.fromObject(t,{...n,zone:r,specificOffset:s});return o?i:i.setZone(a)}return hst.invalid(new znt("unparsable",`the input "${i}" can't be parsed as ${r}`))}function Jit(t,e,n=!0){return t.isValid?Fnt.create(mrt.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Qit(t,e){const n=t.c.year>9999||t.c.year<0;let r="";return n&&t.c.year>=0&&(r+="+"),r+=snt(t.c.year,n?6:4),e?(r+="-",r+=snt(t.c.month),r+="-",r+=snt(t.c.day)):(r+=snt(t.c.month),r+=snt(t.c.day)),r}function tst(t,e,n,r,i,s){let o=snt(t.c.hour);return e?(o+=":",o+=snt(t.c.minute),0===t.c.second&&n||(o+=":")):o+=snt(t.c.minute),0===t.c.second&&n||(o+=snt(t.c.second),0===t.c.millisecond&&r||(o+=".",o+=snt(t.c.millisecond,3))),i&&(t.isOffsetFixed&&0===t.offset&&!s?o+="Z":t.o<0?(o+="-",o+=snt(Math.trunc(-t.o/60)),o+=":",o+=snt(Math.trunc(-t.o%60))):(o+="+",o+=snt(Math.trunc(t.o/60)),o+=":",o+=snt(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const est={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},nst={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},rst={ordinal:1,hour:0,minute:0,second:0,millisecond:0},ist=["year","month","day","hour","minute","second","millisecond"],sst=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ost=["year","ordinal","hour","minute","second","millisecond"];function ast(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new ket(t);return e}function lst(t,e){const n=Knt(e.zone,rrt.defaultZone),r=mrt.fromObject(e),i=rrt.now();let s,o;if(Jet(t.year))s=i;else{for(const e of ist)Jet(t[e])&&(t[e]=est[e]);const e=Uit(t)||Vit(t);if(e)return hst.invalid(e);const r=n.offset(i);[s,o]=Yit(t,r,n)}return new hst({ts:s,zone:n,loc:r,o:o})}function cst(t,e,n){const r=!!Jet(n.round)||n.round,i=(t,i)=>{t=cnt(t,r||n.calendary?0:2,!0);return e.loc.clone(n).relFormatter(n).format(t,i)},s=r=>n.calendary?e.hasSame(t,r)?0:e.startOf(r).diff(t.startOf(r),r).get(r):e.diff(t,r).get(r);if(n.unit)return i(s(n.unit),n.unit);for(const t of n.units){const e=s(t);if(Math.abs(e)>=1)return i(e,t)}return i(t>e?-0:0,n.units[n.units.length-1])}function ust(t){let e,n={};return t.length>0&&"object"==typeof t[t.length-1]?(n=t[t.length-1],e=Array.from(t).slice(0,t.length-1)):e=Array.from(t),[n,e]}class hst{constructor(t){const e=t.zone||rrt.defaultZone;let n=t.invalid||(Number.isNaN(t.ts)?new znt("invalid input"):null)||(e.isValid?null:Wit(e));this.ts=Jet(t.ts)?rrt.now():t.ts;let r=null,i=null;if(!n){if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e))[r,i]=[t.old.c,t.old.o];else{const t=e.offset(this.ts);r=Xit(this.ts,t),n=Number.isNaN(r.year)?new znt("invalid input"):null,r=n?null:r,i=n?null:t}}this._zone=e,this.loc=t.loc||mrt.create(),this.invalid=n,this.weekData=null,this.c=r,this.o=i,this.isLuxonDateTime=!0}static now(){return new hst({})}static local(){const[t,e]=ust(arguments),[n,r,i,s,o,a,l]=e;return lst({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static utc(){const[t,e]=ust(arguments),[n,r,i,s,o,a,l]=e;return t.zone=Xnt.utcInstance,lst({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static fromJSDate(t,e={}){const n=(r=t,"[object Date]"===Object.prototype.toString.call(r)?t.valueOf():NaN);var r;if(Number.isNaN(n))return hst.invalid("invalid input");const i=Knt(e.zone,rrt.defaultZone);return i.isValid?new hst({ts:n,zone:i,loc:mrt.fromObject(e)}):hst.invalid(Wit(i))}static fromMillis(t,e={}){if(Qet(t))return t<-864e13||t>864e13?hst.invalid("Timestamp out of range"):new hst({ts:t,zone:Knt(e.zone,rrt.defaultZone),loc:mrt.fromObject(e)});throw new Tet(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,e={}){if(Qet(t))return new hst({ts:1e3*t,zone:Knt(e.zone,rrt.defaultZone),loc:mrt.fromObject(e)});throw new Tet("fromSeconds requires a numerical input")}static fromObject(t,e={}){t=t||{};const n=Knt(e.zone,rrt.defaultZone);if(!n.isValid)return hst.invalid(Wit(n));const r=rrt.now(),i=Jet(e.specificOffset)?n.offset(r):e.specificOffset,s=vnt(t,ast),o=!Jet(s.ordinal),a=!Jet(s.year),l=!Jet(s.month)||!Jet(s.day),c=a||l,u=s.weekYear||s.weekNumber,h=mrt.fromObject(e);if((c||o)&&u)throw new _et("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new _et("Can't mix ordinal dates with month/day");const d=u||s.weekday&&!c;let p,f,m=Xit(r,i);d?(p=sst,f=nst,m=Dit(m)):o?(p=ost,f=rst,m=zit(m)):(p=ist,f=est);let g=!1;for(const t of p){Jet(s[t])?s[t]=g?f[t]:m[t]:g=!0}const y=d?function(t){const e=tnt(t.weekYear),n=int(t.weekNumber,1,fnt(t.weekYear)),r=int(t.weekday,1,7);return e?n?!r&&Rit("weekday",t.weekday):Rit("week",t.week):Rit("weekYear",t.weekYear)}(s):o?function(t){const e=tnt(t.year),n=int(t.ordinal,1,hnt(t.year));return e?!n&&Rit("ordinal",t.ordinal):Rit("year",t.year)}(s):Uit(s),b=y||Vit(s);if(b)return hst.invalid(b);const v=d?Fit(s):o?Bit(s):s,[x,w]=Yit(v,i,n),S=new hst({ts:x,zone:n,o:w,loc:h});return s.weekday&&c&&t.weekday!==S.weekday?hst.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${S.toISO()}`):S}static fromISO(t,e={}){const[n,r]=function(t){return brt(t,[Wrt,Xrt],[Hrt,Yrt],[Grt,Krt],[qrt,Zrt])}(t);return Zit(n,r,e,"ISO 8601",t)}static fromRFC2822(t,e={}){const[n,r]=function(t){return brt(function(t){return t.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(t),[Drt,Frt])}(t);return Zit(n,r,e,"RFC 2822",t)}static fromHTTP(t,e={}){const[n,r]=function(t){return brt(t,[zrt,Vrt],[Brt,Vrt],[Urt,jrt])}(t);return Zit(n,r,e,"HTTP",e)}static fromFormat(t,e,n={}){if(Jet(t)||Jet(e))throw new Tet("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:i=null}=n,s=mrt.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),[o,a,l,c]=function(t,e,n){const{result:r,zone:i,specificOffset:s,invalidReason:o}=Nit(t,e,n);return[r,i,s,o]}(s,t,e);return c?hst.invalid(c):Zit(o,a,n,`format ${e}`,t,l)}static fromString(t,e,n={}){return hst.fromFormat(t,e,n)}static fromSQL(t,e={}){const[n,r]=function(t){return brt(t,[Qrt,Xrt],[tit,eit])}(t);return Zit(n,r,e,"SQL",t)}static invalid(t,e=null){if(!t)throw new Tet("need to specify a reason the DateTime is invalid");const n=t instanceof znt?t:new znt(t,e);if(rrt.throwOnInvalid)throw new vet(n);return new hst({invalid:n})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Hit(this).weekYear:NaN}get weekNumber(){return this.isValid?Hit(this).weekNumber:NaN}get weekday(){return this.isValid?Hit(this).weekday:NaN}get ordinal(){return this.isValid?zit(this.c).ordinal:NaN}get monthShort(){return this.isValid?dit.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?dit.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?dit.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?dit.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}get isInLeapYear(){return unt(this.year)}get daysInMonth(){return dnt(this.year,this.month)}get daysInYear(){return this.isValid?hnt(this.year):NaN}get weeksInWeekYear(){return this.isValid?fnt(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:e,numberingSystem:n,calendar:r}=Fnt.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e,numberingSystem:n,outputCalendar:r}}toUTC(t=0,e={}){return this.setZone(Xnt.instance(t),e)}toLocal(){return this.setZone(rrt.defaultZone)}setZone(t,{keepLocalTime:e=!1,keepCalendarTime:n=!1}={}){if((t=Knt(t,rrt.defaultZone)).equals(this.zone))return this;if(t.isValid){let r=this.ts;if(e||n){const e=t.offset(this.ts),n=this.toObject();[r]=Yit(n,e,t)}return Git(this,{ts:r,zone:t})}return hst.invalid(Wit(t))}reconfigure({locale:t,numberingSystem:e,outputCalendar:n}={}){return Git(this,{loc:this.loc.clone({locale:t,numberingSystem:e,outputCalendar:n})})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const e=vnt(t,ast),n=!Jet(e.weekYear)||!Jet(e.weekNumber)||!Jet(e.weekday),r=!Jet(e.ordinal),i=!Jet(e.year),s=!Jet(e.month)||!Jet(e.day),o=i||s,a=e.weekYear||e.weekNumber;if((o||r)&&a)throw new _et("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&r)throw new _et("Can't mix ordinal dates with month/day");let l;n?l=Fit({...Dit(this.c),...e}):Jet(e.ordinal)?(l={...this.toObject(),...e},Jet(e.day)&&(l.day=Math.min(dnt(l.year,l.month),l.day))):l=Bit({...zit(this.c),...e});const[c,u]=Yit(l,this.o,this.zone);return Git(this,{ts:c,o:u})}plus(t){if(!this.isValid)return this;return Git(this,Kit(this,cit.fromDurationLike(t)))}minus(t){if(!this.isValid)return this;return Git(this,Kit(this,cit.fromDurationLike(t).negate()))}startOf(t){if(!this.isValid)return this;const e={},n=cit.normalizeUnit(t);switch(n){case"years":e.month=1;case"quarters":case"months":e.day=1;case"weeks":case"days":e.hour=0;case"hours":e.minute=0;case"minutes":e.second=0;case"seconds":e.millisecond=0}if("weeks"===n&&(e.weekday=1),"quarters"===n){const t=Math.ceil(this.month/3);e.month=3*(t-1)+1}return this.set(e)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,e={}){return this.isValid?Fnt.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):jit}toLocaleString(t=Net,e={}){return this.isValid?Fnt.create(this.loc.clone(e),t).formatDateTime(this):jit}toLocaleParts(t={}){return this.isValid?Fnt.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:e=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:i=!1}={}){if(!this.isValid)return null;const s="extended"===t;let o=Qit(this,s);return o+="T",o+=tst(this,s,e,n,r,i),o}toISODate({format:t="extended"}={}){return this.isValid?Qit(this,"extended"===t):null}toISOWeekDate(){return Jit(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:e=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:i=!1,format:s="extended"}={}){if(!this.isValid)return null;return(r?"T":"")+tst(this,"extended"===s,e,t,n,i)}toRFC2822(){return Jit(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Jit(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Qit(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:e=!1,includeOffsetSpace:n=!0}={}){let r="HH:mm:ss.SSS";return(e||t)&&(n&&(r+=" "),e?r+="z":t&&(r+="ZZ")),Jit(this,r,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():jit}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const e={...this.c};return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,e="milliseconds",n={}){if(!this.isValid||!t.isValid)return cit.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...n},i=(a=e,Array.isArray(a)?a:[a]).map(cit.normalizeUnit),s=t.valueOf()>this.valueOf(),o=fit(s?this:t,s?t:this,i,r);var a;return s?o.negate():o}diffNow(t="milliseconds",e={}){return this.diff(hst.now(),t,e)}until(t){return this.isValid?hit.fromDateTimes(this,t):this}hasSame(t,e){if(!this.isValid)return!1;const n=t.valueOf(),r=this.setZone(t.zone,{keepLocalTime:!0});return r.startOf(e)<=n&&n<=r.endOf(e)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const e=t.base||hst.fromObject({},{zone:this.zone}),n=t.padding?this<e?-t.padding:t.padding:0;let r=["years","months","days","hours","minutes","seconds"],i=t.unit;return Array.isArray(t.unit)&&(r=t.unit,i=void 0),cst(e,this.plus(n),{...t,numeric:"always",units:r,unit:i})}toRelativeCalendar(t={}){return this.isValid?cst(t.base||hst.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(hst.isDateTime))throw new Tet("min requires all arguments be DateTimes");return nnt(t,(t=>t.valueOf()),Math.min)}static max(...t){if(!t.every(hst.isDateTime))throw new Tet("max requires all arguments be DateTimes");return nnt(t,(t=>t.valueOf()),Math.max)}static fromFormatExplain(t,e,n={}){const{locale:r=null,numberingSystem:i=null}=n;return Nit(mrt.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),t,e)}static fromStringExplain(t,e,n={}){return hst.fromFormatExplain(t,e,n)}static get DATE_SHORT(){return Net}static get DATE_MED(){return Iet}static get DATE_MED_WITH_WEEKDAY(){return $et}static get DATE_FULL(){return Ret}static get DATE_HUGE(){return Oet}static get TIME_SIMPLE(){return Pet}static get TIME_WITH_SECONDS(){return Let}static get TIME_WITH_SHORT_OFFSET(){return Det}static get TIME_WITH_LONG_OFFSET(){return Fet}static get TIME_24_SIMPLE(){return zet}static get TIME_24_WITH_SECONDS(){return Bet}static get TIME_24_WITH_SHORT_OFFSET(){return Uet}static get TIME_24_WITH_LONG_OFFSET(){return Vet}static get DATETIME_SHORT(){return jet}static get DATETIME_SHORT_WITH_SECONDS(){return Wet}static get DATETIME_MED(){return Het}static get DATETIME_MED_WITH_SECONDS(){return Get}static get DATETIME_MED_WITH_WEEKDAY(){return qet}static get DATETIME_FULL(){return Xet}static get DATETIME_FULL_WITH_SECONDS(){return Yet}static get DATETIME_HUGE(){return Ket}static get DATETIME_HUGE_WITH_SECONDS(){return Zet}}function dst(t){if(hst.isDateTime(t))return t;if(t&&t.valueOf&&Qet(t.valueOf()))return hst.fromJSDate(t);if(t&&"object"==typeof t)return hst.fromObject(t);throw new Tet(`Unknown datetime argument: ${t}, of type ${typeof t}`)}
/*!
 * chartjs-adapter-luxon v1.2.0
 * https://www.chartjs.org
 * (c) 2022 chartjs-adapter-luxon Contributors
 * Released under the MIT license
 */const pst={datetime:hst.DATETIME_MED_WITH_SECONDS,millisecond:"h:mm:ss.SSS a",second:hst.TIME_WITH_SECONDS,minute:hst.TIME_SIMPLE,hour:{hour:"numeric"},day:{day:"numeric",month:"short"},week:"DD",month:{month:"short",year:"numeric"},quarter:"'Q'q - yyyy",year:{year:"numeric"}};function fst(t){let e,n;return{c(){e=zT("div"),n=zT("canvas"),GT(e,"class","w-full h-96")},m(r,i){LT(r,e,i),RT(e,n),t[6](n)},p:uT,d(n){n&&DT(e),t[6](null)}}}function mst(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[fst]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),32770&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function gst(t,e,n){let{title:r}=e,{preset:i}=e,{options:s}=e,{datasets:o}=e;L9.register(j9,o7,a7,Wtt,l7,ktt,Mtt,J9,c7,Xtt,Ktt,h7,ttt,u7,d7,oet,att,p7,met,yet,Att,Vtt);const a=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"],l={data:{},options:{maintainAspectRatio:!1,animation:{duration:200},borderWidth:4}};function c(t){return{borderColor:a[t%6],backgroundColor:a[t%6],fill:!1,lineTension:.2}}function u(t,e,n){const r={labels:[]};let i=0;return r.datasets=t.map((({dataStream:s,label:o,options:l},u)=>{i=Math.max(i,s.get()?s.get().length:0),0===u&&(r.labels=l.labels||[],!l.labels&&s.get()&&s.get().length>0&&("number"==typeof s.get()[0]?r.labels=Array.from(Array(s.get().length),((t,e)=>e.toString())):r.labels=s.get().map((t=>t.x.toString()))));let h={...c(u),...e,...l,label:o,data:s.get()||[]};return(["bar","bar-fast"].includes(l.type)||["bar","bar-fast"].includes(n.type)&&!l.type)&&1===t.length&&(h.borderColor=a,h.backgroundColor=a),h})),r}let h,d,p=[];function f(){let t=vU(l,i.global);t=vU(t,{data:u(o,i.datasets,t),options:s}),s.xlabel&&(t=vU(t,{options:{scales:{x:{title:{display:!0,text:s.xlabel}}}}})),s.ylabel&&(t=vU(t,{options:{scales:{y:{title:{display:!0,text:s.ylabel}}}}}));const e=o.map((({dataStream:t})=>{var e;return(null===(e=t.get())||void 0===e?void 0:e.length)||0}));p=o.map((({dataStream:n,options:r},i)=>n.subscribe((n=>{if(n&&h){const s=e.reduce(((t,e)=>Math.max(t,e)));e[i]=n.length,!r.labels&&n.length>0&&e[i]>s&&("number"==typeof n[0]?t.data.labels=Array.from(Array(n.length),((t,e)=>e.toString())):t.data.labels=n.map((t=>t.x.toString()))),t.data.datasets[i].data=n;try{h.update()}catch(t){console.log(t)}}}))));const n=d.getContext("2d");h=new L9(n,t)}function m(){for(const t of p)t();null==h||h.destroy()}hE((async()=>{await kE(),await kE(),f()}));let g=o.length;return pE(m),t.$$set=t=>{"title"in t&&n(0,r=t.title),"preset"in t&&n(2,i=t.preset),"options"in t&&n(3,s=t.options),"datasets"in t&&n(4,o=t.datasets)},t.$$.update=()=>{48&t.$$.dirty&&o.length!==g&&(m(),f(),n(5,g=o.length))},[r,d,i,s,o,g,function(t){bE[t?"unshift":"push"]((()=>{d=t,n(1,d)}))}]}g7._date.override({_id:"luxon",_create:function(t){return hst.fromMillis(t,this.options)},init(t){this.options.locale||(this.options.locale=t.locale)},formats:function(){return pst},parse:function(t,e){const n=this.options,r=typeof t;return null===t||"undefined"===r?null:("number"===r?t=this._create(t):"string"===r?t="string"==typeof e?hst.fromFormat(t,e,n):hst.fromISO(t,n):t instanceof Date?t=hst.fromJSDate(t,n):"object"!==r||t instanceof hst||(t=hst.fromObject(t,n)),t.isValid?t.valueOf():null)},format:function(t,e){const n=this._create(t);return"string"==typeof e?n.toFormat(e):n.toLocaleString(e)},add:function(t,e,n){const r={};return r[n]=e,this._create(t).plus(r).valueOf()},diff:function(t,e,n){return this._create(t).diff(this._create(e)).as(n).valueOf()},startOf:function(t,e,n){if("isoWeek"===e){n=Math.trunc(Math.min(Math.max(0,n),6));const e=this._create(t);return e.minus({days:(e.weekday-n+7)%7}).startOf("day").valueOf()}return e?this._create(t).startOf(e).valueOf():t},endOf:function(t,e){return this._create(t).endOf(e).valueOf()}});class yst extends QE{constructor(t){super(),JE(this,t,gst,mst,gT,{title:0,preset:2,options:3,datasets:4})}}var bst,vst,xst;const wst={line:{global:{type:"line",options:{animation:{duration:200},scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:.2}},"line-fast":{global:{type:"line",options:{elements:{point:{radius:0}},animation:!1,tooltips:!1,spanGaps:!0,scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:0}},bar:{global:{type:"bar",options:{animation:{duration:200},scales:{y:{beginAtZero:!0}}}}},"bar-fast":{global:{type:"bar",options:{animation:!1,scales:{y:{beginAtZero:!0}}}}},scatter:{global:{type:"scatter",options:{scales:{x:{type:"linear",position:"bottom"}}}}}};class Sst extends SU{constructor({preset:t="line",options:e={}}={}){super(),this.title="generic chart",bst.set(this,void 0),vst.set(this,void 0),xst.set(this,[]),Object.keys(wst).includes(t)||hU(new Error(`Preset ${t} is not recognized`)),HB(this,bst,t,"f"),HB(this,vst,wst[t],"f"),this.options=e,this.start()}addSeries(t,e,n={}){if(nU(t)){if("line-fast"===WB(this,bst,"f")){const r=t.debounce(10);r.value=t.get(),WB(this,xst,"f").push({dataStream:r,label:e,options:n})}else WB(this,xst,"f").push({dataStream:t,label:e,options:n});this.updateView()}else t.toArray().then((t=>{const r=new rU(t,!0);WB(this,xst,"f").push({dataStream:r,label:e,options:n}),this.updateView()}))}setColors(t){WB(this,xst,"f")[0].label="clusters",WB(this,xst,"f")[0].options.backgroundColor=t.get(),WB(this,xst,"f")[0].options.color=t.get()}removeSeries(t){const e=WB(this,xst,"f").map((t=>t.dataStream)).indexOf(t);e>-1&&WB(this,xst,"f").splice(e,1)}clear(){HB(this,xst,[],"f"),this.updateView()}updateView(){this.$$.app&&this.$$.app.$set({datasets:WB(this,xst,"f")})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new yst({target:e,props:{title:this.title,preset:WB(this,vst,"f"),options:this.options,datasets:WB(this,xst,"f")}}))}}function _st(...t){return new Sst(...t)}function kst(t){let e,n;return{c(){e=new nE(!1),n=jT(),e.a=n},m(r,i){e.m(t[2],r,i),LT(r,n,i)},p(t,n){4&n&&e.p(t[2])},d(t){t&&DT(n),t&&e.d()}}}function Tst(t){let e,n=t[2]&&kst(t);return{c(){e=zT("div"),n&&n.c(),GT(e,"class","grow")},m(t,r){LT(t,e,r),n&&n.m(e,null)},p(t,r){t[2]?n?n.p(t,r):(n=kst(t),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(t){t&&DT(e),n&&n.d()}}}function Est(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[Tst]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),12&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Mst(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(2,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{text:a}=e;return s(),t.$$set=t=>{"title"in t&&n(0,o=t.title),"text"in t&&s(n(1,a=t.text))},[o,a,r]}bst=new WeakMap,vst=new WeakMap,xst=new WeakMap;class Cst extends QE{constructor(t){super(),JE(this,t,Mst,Est,gT,{title:0,text:1})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),NE()}get text(){return this.$$.ctx[1]}set text(t){this.$$set({text:t}),NE()}}class Ast extends SU{constructor(t="click me"){super(),this.title="text",this.$value=new rU(t,!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Cst({target:e,props:{title:this.title,text:this.$value}}))}}function Nst(...t){return new Ast(...t)}var Ist,$st;class Rst extends SU{constructor(t){super(),this.title="confidence plot",Ist.set(this,void 0),$st.set(this,void 0),this.$confidenceStream=t.map((({confidences:t})=>Object.entries(t).map((([t,e])=>({x:t,y:e}))).sort(((t,e)=>t.x<e.x?-1:t.x>e.x?1:0)))),HB(this,Ist,_st({preset:"bar-fast",options:{xlabel:"Label",ylabel:"Confidence",scales:{y:{suggestedMax:1}}}}),"f"),WB(this,Ist,"f").addSeries(this.$confidenceStream,"Confidences"),WB(this,Ist,"f").title="",HB(this,$st,Nst("Waiting for predictions..."),"f"),WB(this,$st,"f").title=this.title,WB(this,$st,"f").$value=new rU(t.map((({label:t})=>`<p>Predicted Label: <code style="font-size: 1.5rem;">${t}</code></p>`)).startWith("Waiting for predictions..."),!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);if(!e)return;const n=document.createElement("div");n.id=`${e.id}-${WB(this,$st,"f").id}`;const r=document.createElement("div");r.id=`${e.id}-${WB(this,Ist,"f").id}`,e.appendChild(n),e.appendChild(r),WB(this,$st,"f").title=this.title,WB(this,$st,"f").mount(n),WB(this,Ist,"f").mount(r),this.destroy=()=>{n.parentElement.removeChild(n),r.parentElement.removeChild(r),WB(this,$st,"f").destroy(),WB(this,Ist,"f").destroy()}}destroy(){WB(this,$st,"f").destroy(),WB(this,Ist,"f").destroy()}}function Ost(...t){return new Rst(...t)}Ist=new WeakMap,$st=new WeakMap;var Pst=Object.prototype.hasOwnProperty;function Lst(t,e,n){for(n of t.keys())if(Dst(n,e))return n}function Dst(t,e){var n,r,i;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&Dst(t[r],e[r]););return-1===r}if(n===Set){if(t.size!==e.size)return!1;for(r of t){if((i=r)&&"object"==typeof i&&!(i=Lst(e,i)))return!1;if(!e.has(i))return!1}return!0}if(n===Map){if(t.size!==e.size)return!1;for(r of t){if((i=r[0])&&"object"==typeof i&&!(i=Lst(e,i)))return!1;if(!Dst(r[1],e.get(i)))return!1}return!0}if(n===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(n===DataView){if((r=t.byteLength)===e.byteLength)for(;r--&&t.getInt8(r)===e.getInt8(r););return-1===r}if(ArrayBuffer.isView(t)){if((r=t.byteLength)===e.byteLength)for(;r--&&t[r]===e[r];);return-1===r}if(!n||"object"==typeof t){for(n in r=0,t){if(Pst.call(t,n)&&++r&&!Pst.call(e,n))return!1;if(!(n in e)||!Dst(t[n],e[n]))return!1}return Object.keys(e).length===r}}return t!=t&&e!=e}
/*!
 * chartjs-chart-matrix v1.2.0
 * https://chartjs-chart-matrix.pages.dev/
 * (c) 2022 Jukka Kurkela
 * Released under the MIT license
 */var Fst;class zst extends Z8{initialize(){this.enableOptionSharing=!0,super.initialize()}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,r){const i=this,s="reset"===r,{xScale:o,yScale:a}=i._cachedMeta,l=i.resolveDataElementOptions(e,r),c=i.getSharedOptions(r,t[e],l);for(let l=e;l<e+n;l++){const e=!s&&i.getParsed(l),n=s?o.getBasePixel():o.getPixelForValue(e.x),c=s?a.getBasePixel():a.getPixelForValue(e.y),u=i.resolveDataElementOptions(l,r),{width:h,height:d,anchorX:p,anchorY:f}=u,m={x:Bst(p,n,h),y:Ust(f,c,d),width:h,height:d,options:u};i.updateElement(t[l],l,m,r)}i.updateSharedOptions(c,r)}draw(){const t=this,e=t.getMeta().data||[];let n,r;for(n=0,r=e.length;n<r;++n)e[n].draw(t._ctx)}}function Bst(t,e,n){return"left"===t||"start"===t?e:"right"===t||"end"===t?e-n:e-n/2}function Ust(t,e,n){return"top"===t||"start"===t?e:"bottom"===t||"end"===t?e-n:e-n/2}function Vst(t,e){const{x:n,y:r,width:i,height:s}=t.getProps(["x","y","width","height"],e);return{left:n,top:r,right:n+i,bottom:r+s}}function jst(t,e,n){return Math.max(Math.min(t,n),e)}function Wst(t){const e=Vst(t),n=e.right-e.left,r=e.bottom-e.top,i=function(t,e,n){const r=t.options.borderWidth;let i,s,o,a;return A4(r)?(i=+r.top||0,s=+r.right||0,o=+r.bottom||0,a=+r.left||0):i=s=o=a=+r||0,{t:jst(i,0,n),r:jst(s,0,e),b:jst(o,0,n),l:jst(a,0,e)}}(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b}}}function Hst(t,e,n,r){const i=null===e,s=null===n,o=!(!t||i&&s)&&Vst(t,r);return o&&(i||e>=o.left&&e<=o.right)&&(s||n>=o.top&&n<=o.bottom)}zst.id="matrix",zst.version="1.2.0",zst.defaults={dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}},anchorX:"center",anchorY:"center"},zst.overrides={interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}};class Gst extends Q7{constructor(t){super(),this.options=void 0,this.width=void 0,this.height=void 0,t&&Object.assign(this,t)}draw(t){const e=this.options,{inner:n,outer:r}=Wst(this),i=N6(e.borderRadius);t.save(),r.w!==n.w||r.h!==n.h?(t.beginPath(),k6(t,{x:r.x,y:r.y,w:r.w,h:r.h,radius:i}),k6(t,{x:n.x,y:n.y,w:n.w,h:n.h,radius:i}),t.fillStyle=e.backgroundColor,t.fill(),t.fillStyle=e.borderColor,t.fill("evenodd")):(t.beginPath(),k6(t,{x:n.x,y:n.y,w:n.w,h:n.h,radius:i}),t.fillStyle=e.backgroundColor,t.fill()),t.restore()}inRange(t,e,n){return Hst(this,t,e,n)}inXRange(t,e){return Hst(this,t,null,e)}inYRange(t,e){return Hst(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,width:r,height:i}=this.getProps(["x","y","width","height"],t);return{x:e+r/2,y:n+i/2}}tooltipPosition(){return this.getCenterPoint()}getRange(t){return"x"===t?this.width/2:this.height/2}}function qst(t){let e;return{c(){e=zT("p"),e.textContent="Waiting for predictions...",GT(e,"class","m-2")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function Xst(t){let e,n,r,i,s,o,a,l,c=t[6].toFixed(2)+"";return{c(){e=zT("p"),n=UT("Global Accuracy: "),r=UT(c),i=VT(),s=zT("div"),o=zT("canvas"),GT(e,"class","m-2"),GT(s,"class","confusion-container svelte-1d2i0ke")},m(c,u){var h;LT(c,e,u),RT(e,n),RT(e,r),LT(c,i,u),LT(c,s,u),RT(s,o),a||(h=t[7].call(null,o),l=h&&mT(h.destroy)?h.destroy:uT,a=!0)},p(t,e){64&e&&c!==(c=t[6].toFixed(2)+"")&&XT(r,c)},d(t){t&&DT(e),t&&DT(i),t&&DT(s),a=!1,l()}}}function Yst(t){let e;function n(t,e){return void 0!==t[6]?Xst:qst}let r=n(t),i=r(t);return{c(){i.c(),e=jT()},m(t,n){i.m(t,n),LT(t,e,n)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},d(t){i.d(t),t&&DT(e)}}}function Kst(t){let e,n;return e=new zL({props:{title:t[0],loading:t[4],progress:t[5],$$slots:{default:[Yst]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16&n&&(r.loading=t[4]),32&n&&(r.progress=t[5]),131136&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Zst(t,e,n){let r,i,s,o=uT,a=()=>(o(),o=vT(p,(t=>n(4,r=t))),p),l=uT,c=()=>(l(),l=vT(f,(t=>n(5,i=t))),f),u=uT,h=()=>(u(),u=vT(m,(t=>n(6,s=t))),m);t.$$.on_destroy.push((()=>o())),t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u()));let{title:d}=e,{loading:p}=e;a();let{progress:f}=e;c();let{accuracy:m}=e;h();let{confusion:g}=e,{labels:y}=e,{selected:b}=e;L9.register(Wtt,Att,Vtt,Gst,zst);let v=1,x=1,w=-1;const S={type:"matrix",data:{datasets:[{label:"Confusion Matrix",data:[],backgroundColor(t){if(t.dataset.data.length>0){if(t.dataIndex===w){const{x:e,y:n}=t.dataset.data[t.dataIndex];return e===n?"green":"red"}return`rgba(54, 162, 235, ${t.dataset.data[t.dataIndex].v/v})`}return"rgba(54, 162, 235, 0)"},width(t){const e=t.chart.chartArea;return e?(e.right-e.left)/x-2:0},height(t){const e=t.chart.chartArea;return e?(e.bottom-e.top)/x-2:0}}]},options:{aspectRatio:1,legend:{display:!1},plugins:{tooltip:{callbacks:{title:([t])=>["count: "+t.dataset.data[t.dataIndex].v],label(t){const e=t.dataset.data[t.dataIndex];return["true label: "+e.y,"predicted label: "+e.x]}}}},scales:{x:{type:"category",labels:[],ticks:{display:!0,autoSkip:!1},gridLines:{display:!1},title:{display:!0,text:"Predicted Label"}},y:{type:"category",labels:[],offset:!0,reverse:!0,ticks:{display:!0,autoSkip:!1},gridLines:{display:!1},title:{display:!0,text:"True Label"}}},onClick(t){try{const e=t.chart.tooltip.dataPoints[0].dataIndex;w===e?(b.set(null),w=-1):(b.set(t.chart.tooltip.dataPoints[0].raw),w=e,t.chart.update())}catch(t){console.log("[confusion matrix] selection error:",t)}}}};let _,k=[];return pE((()=>{for(const t of k)t()})),t.$$set=t=>{"title"in t&&n(0,d=t.title),"loading"in t&&a(n(1,p=t.loading)),"progress"in t&&c(n(2,f=t.progress)),"accuracy"in t&&h(n(3,m=t.accuracy)),"confusion"in t&&n(8,g=t.confusion),"labels"in t&&n(9,y=t.labels),"selected"in t&&n(10,b=t.selected)},[d,p,f,m,r,i,s,function(t){const e=t.getContext("2d");_=new L9(e,S),k.push(y.subscribe((t=>{x=t.length,S.options.scales.x.labels=t.sort(),S.options.scales.y.labels=t.sort(),_.update()}))),k.push(g.subscribe((t=>{v=t.reduce(((t,{v:e})=>Math.max(t,e)),0),S.data.datasets[0].data=t,_.update()})))},g,y,b]}Gst.id="matrix",Gst.defaults={backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:void 0,anchorY:void 0,width:20,height:20};class Jst extends QE{constructor(t){super(),JE(this,t,Zst,Kst,gT,{title:0,loading:1,progress:2,accuracy:3,confusion:8,labels:9,selected:10})}}class Qst extends SU{constructor(t){super(),this.title="confusion matrix",Fst.set(this,void 0),this.$confusion=new rU([],!0),this.$accuracy=new rU(void 0,!0),this.$labels=new rU([],!0),this.$selected=new rU(null,!0),this.$progress=new rU(!1,!0),HB(this,Fst,t,"f"),this.start(),this.setup()}setup(){let t=[];WB(this,Fst,"f").$status.subscribe((async({status:e,count:n,total:r,data:i})=>{"start"===e?(t=[],this.$progress.set(null)):"running"===e?(t.push(i),this.$progress.set(n/r)):"loaded"===e?(t=await WB(this,Fst,"f").predictionService.items().query({$select:["id","label","yTrue"]}).toArray(),this.$progress.set(!1)):"loading"===e?(t=[],this.$progress.set(null)):this.$progress.set(!1),this.updateConfusionMatrix(t),this.updateAccuracy(t)}))}updateConfusionMatrix(t){const e=t.map((t=>t.label)),n=t.map((t=>t.yTrue)),r=Array.from(new Set(e.concat(n)));Dst(r,this.$labels.value)||this.$labels.set(r);const i=r.length,s=r.reduce(((t,e,n)=>({...t,[e]:n})),{}),o=Array.from(Array(i**2),(()=>0));for(let t=0;t<e.length;t+=1)o[s[e[t]]*i+s[n[t]]]+=1;const a=o.map(((t,e)=>({x:r[Math.floor(e/i)],y:r[e%i],v:t})));this.$confusion.set(a)}updateAccuracy(t){0===t.length?this.$accuracy.set(void 0):this.$accuracy.set(t.reduce(((t,{label:e,yTrue:n})=>t+(e===n?1:0)),0)/t.length)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Jst({target:e,props:{title:this.title,loading:WB(this,Fst,"f").$status.map((({status:t})=>"loading"===t)),progress:this.$progress,confusion:this.$confusion,accuracy:this.$accuracy,labels:this.$labels,selected:this.$selected}}))}}function tot(...t){return new Qst(...t)}Fst=new WeakMap;const{window:eot}=WE;function not(t,e,n){const r=t.slice();return r[26]=e[n][0],r[27]=e[n][1].loaded,r[28]=e[n][1].total,r[29]=e[n][1].instances,r}function rot(t,e,n){const r=t.slice();return r[32]=e[n].id,r[33]=e[n].thumbnail,r}function iot(t){let e,n,r,i,s;function o(t,e){return t[6]>0?oot:sot}let a=o(t),l=a(t),c=Object.entries(t[5]),u=[];for(let e=0;e<c.length;e+=1)u[e]=uot(not(t,c,e));const h=t=>zE(u[t],1,1,(()=>{u[t]=null}));return{c(){l.c(),e=VT(),n=zT("div");for(let t=0;t<u.length;t+=1)u[t].c();GT(n,"class","flex flex-wrap")},m(o,a){l.m(o,a),LT(o,e,a),LT(o,n,a);for(let t=0;t<u.length;t+=1)u[t].m(n,null);r=!0,i||(s=WT(n,"click",t[18]),i=!0)},p(t,r){if(a===(a=o(t))&&l?l.p(t,r):(l.d(1),l=a(t),l&&(l.c(),l.m(e.parentNode,e))),6560&r[0]){let e;for(c=Object.entries(t[5]),e=0;e<c.length;e+=1){const i=not(t,c,e);u[e]?(u[e].p(i,r),FE(u[e],1)):(u[e]=uot(i),u[e].c(),FE(u[e],1),u[e].m(n,null))}for(LE(),e=c.length;e<u.length;e+=1)h(e);DE()}},i(t){if(!r){for(let t=0;t<c.length;t+=1)FE(u[t]);r=!0}},o(t){u=u.filter(Boolean);for(let t=0;t<u.length;t+=1)zE(u[t]);r=!1},d(t){l.d(t),t&&DT(e),t&&DT(n),FT(u,t),i=!1,s()}}}function sot(t){let e;return{c(){e=zT("p"),e.textContent="This dataset is empty.",GT(e,"class","ml-3 mt-2")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function oot(t){let e,n,r,i,s,o,a=t[6]>1?"s":"";return{c(){e=zT("p"),n=UT("This dataset contains "),r=UT(t[6]),i=UT(" instance"),s=UT(a),o=UT("."),GT(e,"class","ml-3 mt-2")},m(t,a){LT(t,e,a),RT(e,n),RT(e,r),RT(e,i),RT(e,s),RT(e,o)},p(t,e){64&e[0]&&XT(r,t[6]),64&e[0]&&a!==(a=t[6]>1?"s":"")&&XT(s,a)},d(t){t&&DT(e)}}}function aot(t,e){let n,r,i,s,o,a,l;function c(){return e[16](e[32])}return{key:t,first:null,c(){n=zT("img"),bT(n.src,r=e[33])||GT(n,"src",r),GT(n,"alt","thumbnail"),GT(n,"class","m-1 svelte-14ms951"),tE(n,"selected",e[7].includes(e[32])),this.first=n},m(t,e){var r;LT(t,n,e),o=!0,a||(l=WT(n,"click",(r=c,function(t){return t.stopPropagation(),r.call(this,t)})),a=!0)},p(t,i){e=t,(!o||32&i[0]&&!bT(n.src,r=e[33]))&&GT(n,"src",r),(!o||160&i[0])&&tE(n,"selected",e[7].includes(e[32]))},i(t){o||(TE((()=>{s&&s.end(1),i=function(t,e,n){let r,i,s=e(t,n),o=!1,a=0;function l(){r&&aE(t,r)}function c(){const{delay:e=0,duration:n=300,easing:c=hT,tick:u=uT,css:h}=s||BE;h&&(r=oE(t,0,1,n,e,c,h,a++)),u(0,1);const d=CT()+e,p=d+n;i&&i.abort(),o=!0,TE((()=>RE(t,!0,"start"))),i=$T((e=>{if(o){if(e>=p)return u(1,0),RE(t,!0,"end"),l(),o=!1;if(e>=d){const t=c((e-d)/n);u(t,1-t)}}return o}))}let u=!1;return{start(){u||(u=!0,aE(t),mT(s)?(s=s(),$E().then(c)):c())},invalidate(){u=!1},end(){o&&(l(),o=!1)}}}(n,pM,{}),i.start()})),o=!0)},o(t){i&&i.invalidate(),s=function(t,e,n){let r,i=e(t,n),s=!0;const o=PE;function a(){const{delay:e=0,duration:n=300,easing:a=hT,tick:l=uT,css:c}=i||BE;c&&(r=oE(t,1,0,n,e,a,c));const u=CT()+e,h=u+n;TE((()=>RE(t,!1,"start"))),$T((e=>{if(s){if(e>=h)return l(0,1),RE(t,!1,"end"),--o.r||fT(o.c),!1;if(e>=u){const t=a((e-u)/n);l(1-t,t)}}return s}))}return o.r+=1,mT(i)?$E().then((()=>{i=i(),a()})):a(),{end(e){e&&i.tick&&i.tick(1,0),s&&(r&&aE(t,r),s=!1)}}}(n,pM,{}),o=!1},d(t){t&&DT(n),t&&s&&s.end(),a=!1,l()}}}function lot(t){let e,n;return e=new nM({props:{size:"small",variant:"light",$$slots:{default:[cot]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[17](t[26])})),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(n,r){t=n;const i={};32&r[1]&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function cot(t){let e;return{c(){e=UT("View More")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function uot(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[26]+"",m=[],g=new Map;a=new DM({props:{actions:[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[7].length>0?[{code:"deleteInstances",text:"Delete selected instance"+(t[7].length>1?"s":"")},{code:"relabelInstances",text:"Relabel selected instance"+(t[7].length>1?"s":"")}]:[])}}),a.$on("select",(function(...e){return t[15](t[26],...e)}));let y=t[29];const b=t=>t[32];for(let e=0;e<y.length;e+=1){let n=rot(t,y,e),r=b(n);g.set(r,m[e]=aot(r,n))}let v=t[27]<t[28]&&lot(t);return{c(){e=zT("div"),n=zT("div"),r=zT("div"),i=zT("span"),s=UT(f),o=VT(),YE(a.$$.fragment),l=VT(),c=zT("div");for(let t=0;t<m.length;t+=1)m[t].c();u=VT(),h=zT("div"),v&&v.c(),d=VT(),GT(i,"class","browser-class-title svelte-14ms951"),GT(r,"class","browser-class-header svelte-14ms951"),GT(c,"class","browser-class-body svelte-14ms951"),GT(n,"class","w-full"),GT(h,"class","pb-1"),GT(e,"class","browser-class svelte-14ms951")},m(t,f){LT(t,e,f),RT(e,n),RT(n,r),RT(r,i),RT(i,s),RT(r,o),KE(a,r,null),RT(n,l),RT(n,c);for(let t=0;t<m.length;t+=1)m[t].m(c,null);RT(e,u),RT(e,h),v&&v.m(h,null),RT(e,d),p=!0},p(e,n){t=e,(!p||32&n[0])&&f!==(f=t[26]+"")&&XT(s,f);const r={};128&n[0]&&(r.actions=[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[7].length>0?[{code:"deleteInstances",text:"Delete selected instance"+(t[7].length>1?"s":"")},{code:"relabelInstances",text:"Relabel selected instance"+(t[7].length>1?"s":"")}]:[])),a.$set(r),2208&n[0]&&(y=t[29],LE(),m=qE(m,n,b,1,t,y,g,c,HE,aot,null,rot),DE()),t[27]<t[28]?v?(v.p(t,n),32&n[0]&&FE(v,1)):(v=lot(t),v.c(),FE(v,1),v.m(h,null)):v&&(LE(),zE(v,1,1,(()=>{v=null})),DE())},i(t){if(!p){FE(a.$$.fragment,t);for(let t=0;t<y.length;t+=1)FE(m[t]);FE(v),p=!0}},o(t){zE(a.$$.fragment,t);for(let t=0;t<m.length;t+=1)zE(m[t]);zE(v),p=!1},d(t){t&&DT(e),ZE(a);for(let t=0;t<m.length;t+=1)m[t].d();v&&v.d()}}}function hot(t){let e;return{c(){e=zT("div"),e.innerHTML='<svg class="inline flex-shrink-0 mr-3 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> \n      <div><span class="font-medium">Data Store connection Error!</span> This data store probably requires\n        authentication</div>',GT(e,"class","flex p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800"),GT(e,"role","alert")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function dot(t){let e,n,r,i=t[5]&&!t[4]&&iot(t),s=t[4]&&hot();return{c(){i&&i.c(),e=VT(),s&&s.c(),n=jT()},m(t,o){i&&i.m(t,o),LT(t,e,o),s&&s.m(t,o),LT(t,n,o),r=!0},p(t,r){t[5]&&!t[4]?i?(i.p(t,r),48&r[0]&&FE(i,1)):(i=iot(t),i.c(),FE(i,1),i.m(e.parentNode,e)):i&&(LE(),zE(i,1,1,(()=>{i=null})),DE()),t[4]?s||(s=hot(),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(t){r||(FE(i),r=!0)},o(t){zE(i),r=!1},d(t){i&&i.d(t),t&&DT(e),s&&s.d(t),t&&DT(n)}}}function pot(t){let e,n,r,i;return e=new zL({props:{title:t[0],loading:t[3],$$slots:{default:[dot]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(s,o){KE(e,s,o),n=!0,r||(i=[WT(eot,"keydown",t[9]),WT(eot,"keyup",t[10])],r=!0)},p(t,n){const r={};1&n[0]&&(r.title=t[0]),8&n[0]&&(r.loading=t[3]),240&n[0]|32&n[1]&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t),r=!1,fT(i)}}}function fot(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(h,(t=>n(6,r=t))),h),a=uT,l=()=>(a(),a=vT(p,(t=>n(7,i=t))),p);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{batchSize:u}=e,{count:h}=e;o();let{dataset:d}=e,{selected:p}=e;l();let f=!1,m=!1,g={};async function y(t){await d.ready;for await(const e of d.items().query({y:t,$sort:{updatedAt:-1}}).skip(g[t].loaded).take(u).select(["id","y","thumbnail"]))n(5,g[t].instances=[...g[t].instances,e],g),n(5,g[t].loaded+=1,g)}async function b(){if(f)return;n(3,f=!0);try{n(4,m=!1),await d.ready}catch(t){return n(3,f=!1),void n(4,m=!0)}const t=await d.distinct("y");n(5,g=t.reduce(((t,e)=>({...t,[e]:{total:0,loaded:0,instances:[]}})),{}));for(const e of t){const{total:t}=await d.find({query:{$limit:0,y:e}});if(n(5,g[e].total=t,g),u>0)await y(e);else for(;g[e].loaded<g[e].total;)await y(e)}n(3,f=!1)}function v(t){for(const[e,{instances:n}]of Object.entries(g))if(n.map((t=>t.id)).includes(t))return e;return null}async function x(){let t=Promise.resolve();for(const e of p.get())t=t.then((()=>d.remove(e)));await t,p.set([])}let w=!1,S=!1;let _=null;function k(t){if(w){if(!t)return;p.get().includes(t)?p.set(p.get().filter((e=>e!==t))):p.set(p.get().concat([t]))}else if(S){if(!_||!t)return;const e=v(_);if(e!==v(t))return;const n=g[e].instances.map((t=>t.id)),r=n.indexOf(_),i=n.indexOf(t);p.set(r<i?n.slice(r,i+1):n.slice(i,r+1))}else p.set(t?[t]:[]),_=t}function T(t,e){let n;switch(e){case"edit":n=window.prompt("Enter the new label",t),n&&d.patch(null,{y:n},{query:{y:t}});break;case"delete":d.remove(null,{query:{y:t}});break;case"deleteInstances":x();break;case"relabelInstances":n=window.prompt("Enter the new label",t),n&&async function(t){let e=Promise.resolve();for(const n of p.get())e=e.then((()=>d.patch(n,{y:t})));await e,p.set([])}(n);break;default:alert(`Class ${t}: ${e}`)}}hE((()=>{b(),d.$changes.subscribe((async t=>{for(const{level:e,type:r,data:i}of t)if("dataset"===e)"created"===r&&(k(),b());else if("instance"===e)if("created"===r)g[i.y]||n(5,g[i.y]={total:0,loaded:0,instances:[]},g),n(5,g[i.y].total+=1,g),n(5,g[i.y].loaded+=1,g),n(5,g[i.y].instances=[{id:i.id,y:i.y,thumbnail:i.thumbnail},...g[i.y].instances],g);else if("updated"===r){const t=v(i.id);n(5,g[t].total-=1,g),n(5,g[t].loaded-=1,g),n(5,g[t].instances=g[t].instances.filter((({id:t})=>t!==i.id)),g),0===g[t].total&&(delete g[t],n(5,g)),g[i.y]||n(5,g[i.y]={total:0,loaded:0,instances:[]},g),n(5,g[i.y].instances=[{id:i.id,y:i.y,thumbnail:i.thumbnail},...g[i.y].instances],g)}else"removed"===r&&(n(5,g[i.y].total-=1,g),n(5,g[i.y].loaded-=1,g),n(5,g[i.y].instances=g[i.y].instances.filter((({id:t})=>t!==i.id)),g),0===g[i.y].total&&(delete g[i.y],n(5,g)))}))}));return t.$$set=t=>{"title"in t&&n(0,c=t.title),"batchSize"in t&&n(13,u=t.batchSize),"count"in t&&o(n(1,h=t.count)),"dataset"in t&&n(14,d=t.dataset),"selected"in t&&l(n(2,p=t.selected))},[c,h,p,f,m,g,r,i,y,function(t){["Meta","Control"].includes(t.key)?w=!0:"Shift"===t.key?S=!0:("Delete"===t.key||"Backspace"===t.key&&w)&&x()},function(t){["Meta","Control"].includes(t.key)?w=!1:"Shift"===t.key&&(S=!1)},k,T,u,d,(t,e)=>T(t,e.detail),t=>k(t),t=>y(t),()=>k()]}class mot extends QE{constructor(t){super(),JE(this,t,fot,pot,gT,{title:0,batchSize:13,count:1,dataset:14,selected:2},null,[-1,-1])}}var got;class yot extends SU{constructor(t,{batchSize:e=6}={}){super(),this.title="dataset browser",got.set(this,void 0),this.$selected=new rU([],!0),HB(this,got,t,"f"),this.batchSize=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new mot({target:e,props:{title:this.title,batchSize:this.batchSize,count:WB(this,got,"f").$count,dataset:WB(this,got,"f"),selected:this.$selected}}))}}function bot(...t){return new yot(...t)}
/*!
 * @kurkle/color v0.2.1
 * https://github.com/kurkle/color#readme
 * (c) 2022 Jukka Kurkela
 * Released under the MIT License
 */function vot(t){return t+.5|0}got=new WeakMap;const xot=(t,e,n)=>Math.max(Math.min(t,n),e);function wot(t){return xot(vot(2.55*t),0,255)}function Sot(t){return xot(vot(255*t),0,255)}function _ot(t){return xot(vot(t/2.55)/100,0,1)}function kot(t){return xot(vot(100*t),0,100)}const Tot={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Eot=[..."0123456789ABCDEF"],Mot=t=>Eot[15&t],Cot=t=>Eot[(240&t)>>4]+Eot[15&t],Aot=t=>(240&t)>>4==(15&t);function Not(t){var e=(t=>Aot(t.r)&&Aot(t.g)&&Aot(t.b)&&Aot(t.a))(t)?Mot:Cot;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const Iot=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function $ot(t,e,n){const r=e*Math.min(n,1-n),i=(e,i=(e+t/30)%12)=>n-r*Math.max(Math.min(i-3,9-i,1),-1);return[i(0),i(8),i(4)]}function Rot(t,e,n){const r=(r,i=(r+t/60)%6)=>n-n*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function Oot(t,e,n){const r=$ot(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function Pot(t){const e=t.r/255,n=t.g/255,r=t.b/255,i=Math.max(e,n,r),s=Math.min(e,n,r),o=(i+s)/2;let a,l,c;return i!==s&&(c=i-s,l=o>.5?c/(2-i-s):c/(i+s),a=function(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}(e,n,r,c,i),a=60*a+.5),[0|a,l||0,o]}function Lot(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(Sot)}function Dot(t,e,n){return Lot($ot,t,e,n)}function Fot(t){return(t%360+360)%360}function zot(t){const e=Iot.exec(t);let n,r=255;if(!e)return;e[5]!==n&&(r=e[6]?wot(+e[5]):Sot(+e[5]));const i=Fot(+e[2]),s=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return Lot(Oot,t,e,n)}(i,s,o):"hsv"===e[1]?function(t,e,n){return Lot(Rot,t,e,n)}(i,s,o):Dot(i,s,o),{r:n[0],g:n[1],b:n[2],a:r}}const Bot={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Uot={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Vot;function jot(t){Vot||(Vot=function(){const t={},e=Object.keys(Uot),n=Object.keys(Bot);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,Bot[s]);s=parseInt(Uot[o],16),t[a]=[s>>16&255,s>>8&255,255&s]}return t}(),Vot.transparent=[0,0,0,0]);const e=Vot[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const Wot=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Hot=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Got=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function qot(t,e,n){if(t){let r=Pot(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,0===e?360:1)),r=Dot(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function Xot(t,e){return t?Object.assign(e||{},t):t}function Yot(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Sot(t[3]))):(e=Xot(t,{r:0,g:0,b:0,a:1})).a=Sot(e.a),e}function Kot(t){return"r"===t.charAt(0)?function(t){const e=Wot.exec(t);let n,r,i,s=255;if(e){if(e[7]!==n){const t=+e[7];s=e[8]?wot(t):xot(255*t,0,255)}return n=+e[1],r=+e[3],i=+e[5],n=255&(e[2]?wot(n):xot(n,0,255)),r=255&(e[4]?wot(r):xot(r,0,255)),i=255&(e[6]?wot(i):xot(i,0,255)),{r:n,g:r,b:i,a:s}}}(t):zot(t)}class Zot{constructor(t){if(t instanceof Zot)return t;const e=typeof t;let n;var r,i,s;"object"===e?n=Yot(t):"string"===e&&(s=(r=t).length,"#"===r[0]&&(4===s||5===s?i={r:255&17*Tot[r[1]],g:255&17*Tot[r[2]],b:255&17*Tot[r[3]],a:5===s?17*Tot[r[4]]:255}:7!==s&&9!==s||(i={r:Tot[r[1]]<<4|Tot[r[2]],g:Tot[r[3]]<<4|Tot[r[4]],b:Tot[r[5]]<<4|Tot[r[6]],a:9===s?Tot[r[7]]<<4|Tot[r[8]]:255})),n=i||jot(t)||Kot(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=Xot(this._rgb);return t&&(t.a=_ot(t.a)),t}set rgb(t){this._rgb=Yot(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${_ot(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?Not(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=Pot(t),n=e[0],r=kot(e[1]),i=kot(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${_ot(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,r=t.rgb;let i;const s=e===i?.5:e,o=2*s-1,a=n.a-r.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;i=1-l,n.r=255&l*n.r+i*r.r+.5,n.g=255&l*n.g+i*r.g+.5,n.b=255&l*n.b+i*r.b+.5,n.a=s*n.a+(1-s)*r.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const r=Got(_ot(t.r)),i=Got(_ot(t.g)),s=Got(_ot(t.b));return{r:Sot(Hot(r+n*(Got(_ot(e.r))-r))),g:Sot(Hot(i+n*(Got(_ot(e.g))-i))),b:Sot(Hot(s+n*(Got(_ot(e.b))-s))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Zot(this.rgb)}alpha(t){return this._rgb.a=Sot(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=vot(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return qot(this._rgb,2,t),this}darken(t){return qot(this._rgb,2,-t),this}saturate(t){return qot(this._rgb,1,t),this}desaturate(t){return qot(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=Pot(t);n[0]=Fot(n[0]+e),n=Dot(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}var Jot={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(t){!function(e,n,r,i){var s,o=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l=Math.round,c=Math.abs,u=Date.now;function h(t,e,n){return setTimeout(b(t,n),e)}function d(t,e,n){return!!Array.isArray(t)&&(p(t,n[e],n),!0)}function p(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function f(t,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,i,r),t.apply(this,arguments)}}s="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])}return e}:Object.assign;var m=f((function(t,e,n){for(var r=Object.keys(e),s=0;s<r.length;)(!n||n&&t[r[s]]===i)&&(t[r[s]]=e[r[s]]),s++;return t}),"extend","Use `assign`."),g=f((function(t,e){return m(t,e,!0)}),"merge","Use `assign`.");function y(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&s(r,n)}function b(t,e){return function(){return t.apply(e,arguments)}}function v(t,e){return"function"==typeof t?t.apply(e&&e[0]||i,e):t}function x(t,e){return t===i?e:t}function w(t,e,n){p(T(e),(function(e){t.addEventListener(e,n,!1)}))}function S(t,e,n){p(T(e),(function(e){t.removeEventListener(e,n,!1)}))}function _(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function k(t,e){return t.indexOf(e)>-1}function T(t){return t.trim().split(/\s+/g)}function E(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function M(t){return Array.prototype.slice.call(t,0)}function C(t,e,n){for(var r=[],i=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];E(i,o)<0&&r.push(t[s]),i[s]=o,s++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function A(t,e){for(var n,r,s=e[0].toUpperCase()+e.slice(1),a=0;a<o.length;){if((r=(n=o[a])?n+s:e)in t)return r;a++}return i}var N=1;function I(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var $="ontouchstart"in e,R=A(e,"PointerEvent")!==i,O=$&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),P="touch",L="mouse",D=24,F=["x","y"],z=["clientX","clientY"];function B(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){v(t.options.enable,[t])&&n.handler(e)},this.init()}function U(t,e,n){var r=n.pointers.length,s=n.changedPointers.length,o=1&e&&r-s==0,a=12&e&&r-s==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,s=r.length;n.firstInput||(n.firstInput=V(e));s>1&&!n.firstMultiple?n.firstMultiple=V(e):1===s&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,l=a?a.center:o.center,h=e.center=j(r);e.timeStamp=u(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=q(l,h),e.distance=G(l,h),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},s=t.prevInput||{};1!==e.eventType&&4!==s.eventType||(i=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=H(e.deltaX,e.deltaY);var d=W(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=c(d.x)>c(d.y)?d.x:d.y,e.scale=a?(p=a.pointers,f=r,G(f[0],f[1],z)/G(p[0],p[1],z)):1,e.rotation=a?function(t,e){return q(e[1],e[0],z)+q(t[1],t[0],z)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,s,o,a=t.lastInterval||e,l=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(l>25||a.velocity===i)){var u=e.deltaX-a.deltaX,h=e.deltaY-a.deltaY,d=W(l,u,h);r=d.x,s=d.y,n=c(d.x)>c(d.y)?d.x:d.y,o=H(u,h),t.lastInterval=e}else n=a.velocity,r=a.velocityX,s=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=s,e.direction=o}(n,e);var p,f;var m=t.element;_(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function V(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:l(t.pointers[n].clientX),clientY:l(t.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:e,center:j(e),deltaX:t.deltaX,deltaY:t.deltaY}}function j(t){var e=t.length;if(1===e)return{x:l(t[0].clientX),y:l(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:l(n/e),y:l(r/e)}}function W(t,e,n){return{x:e/t||0,y:n/t||0}}function H(t,e){return t===e?1:c(t)>=c(e)?t<0?2:4:e<0?8:16}function G(t,e,n){n||(n=F);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function q(t,e,n){n||(n=F);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}B.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(I(this.element),this.evWin,this.domHandler)}};var X={mousedown:1,mousemove:2,mouseup:4},Y="mousedown",K="mousemove mouseup";function Z(){this.evEl=Y,this.evWin=K,this.pressed=!1,B.apply(this,arguments)}y(Z,B,{handler:function(t){var e=X[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:L,srcEvent:t}))}});var J={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:P,3:"pen",4:L,5:"kinect"},tt="pointerdown",et="pointermove pointerup pointercancel";function nt(){this.evEl=tt,this.evWin=et,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(tt="MSPointerDown",et="MSPointerMove MSPointerUp MSPointerCancel"),y(nt,B,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=J[r],s=Q[t.pointerType]||t.pointerType,o=s==P,a=E(e,t.pointerId,"pointerId");1&i&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):12&i&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var rt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},it="touchstart",st="touchstart touchmove touchend touchcancel";function ot(){this.evTarget=it,this.evWin=st,this.started=!1,B.apply(this,arguments)}function at(t,e){var n=M(t.touches),r=M(t.changedTouches);return 12&e&&(n=C(n.concat(r),"identifier",!0)),[n,r]}y(ot,B,{handler:function(t){var e=rt[t.type];if(1===e&&(this.started=!0),this.started){var n=at.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:P,srcEvent:t})}}});var lt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ct="touchstart touchmove touchend touchcancel";function ut(){this.evTarget=ct,this.targetIds={},B.apply(this,arguments)}function ht(t,e){var n=M(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,s,o=M(t.changedTouches),a=[],l=this.target;if(s=n.filter((function(t){return _(t.target,l)})),1===e)for(i=0;i<s.length;)r[s[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&a.push(o[i]),12&e&&delete r[o[i].identifier],i++;return a.length?[C(s.concat(a),"identifier",!0),a]:void 0}y(ut,B,{handler:function(t){var e=lt[t.type],n=ht.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:P,srcEvent:t})}});function dt(){B.apply(this,arguments);var t=b(this.handler,this);this.touch=new ut(this.manager,t),this.mouse=new Z(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function pt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ft.call(this,e)):12&t&&ft.call(this,e)}function ft(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function mt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],s=Math.abs(e-i.x),o=Math.abs(n-i.y);if(s<=25&&o<=25)return!0}return!1}y(dt,B,{handler:function(t,e,n){var r=n.pointerType==P,i=n.pointerType==L;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)pt.call(this,e,n);else if(i&&mt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var gt=A(a.style,"touchAction"),yt=gt!==i,bt="compute",vt="auto",xt="manipulation",wt="none",St="pan-x",_t="pan-y",kt=function(){if(!yt)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!n||e.CSS.supports("touch-action",r)})),t}();function Tt(t,e){this.manager=t,this.set(e)}Tt.prototype={set:function(t){t==bt&&(t=this.compute()),yt&&this.manager.element.style&&kt[t]&&(this.manager.element.style[gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return p(this.manager.recognizers,(function(e){v(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(k(t,wt))return wt;var e=k(t,St),n=k(t,_t);if(e&&n)return wt;if(e||n)return e?St:_t;if(k(t,xt))return xt;return vt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=k(r,wt)&&!kt.none,s=k(r,_t)&&!kt["pan-y"],o=k(r,St)&&!kt["pan-x"];if(i){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}if(!o||!s)return i||s&&6&n||o&&n&D?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Et=32;function Mt(t){this.options=s({},this.defaults,t||{}),this.id=N++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ct(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function At(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Nt(t,e){var n=e.manager;return n?n.get(t):t}function It(){Mt.apply(this,arguments)}function $t(){It.apply(this,arguments),this.pX=null,this.pY=null}function Rt(){It.apply(this,arguments)}function Ot(){Mt.apply(this,arguments),this._timer=null,this._input=null}function Pt(){It.apply(this,arguments)}function Lt(){It.apply(this,arguments)}function Dt(){Mt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ft(t,e){return(e=e||{}).recognizers=x(e.recognizers,Ft.defaults.preset),new zt(t,e)}Mt.prototype={defaults:{},set:function(t){return s(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Nt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return d(t,"dropRecognizeWith",this)||(t=Nt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===E(e,t=Nt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(d(t,"dropRequireFailure",this))return this;t=Nt(t,this);var e=E(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Ct(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Ct(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Et},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=s({},t);if(!v(this.options.enable,[this,e]))return this.reset(),void(this.state=Et);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},y(It,Mt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:Et}}),y($t,It,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(_t),t&D&&e.push(St),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,s=t.deltaX,o=t.deltaY;return i&e.direction||(6&e.direction?(i=0===s?1:s<0?2:4,n=s!=this.pX,r=Math.abs(t.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return It.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=At(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),y(Rt,It,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),y(Ot,Mt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[vt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=h((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Et},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),y(Pt,It,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),y(Lt,It,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return $t.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&D&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=At(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),y(Dt,Mt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||G(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=h((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Et},failTimeout:function(){return this._timer=h((function(){this.state=Et}),this.options.interval,this),Et},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ft.VERSION="2.0.7",Ft.defaults={domEvents:!1,touchAction:bt,enable:!0,inputTarget:null,inputClass:null,preset:[[Pt,{enable:!1}],[Rt,{enable:!1},["rotate"]],[Lt,{direction:6}],[$t,{direction:6},["swipe"]],[Dt],[Dt,{event:"doubletap",taps:2},["tap"]],[Ot]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function zt(t,e){this.options=s({},Ft.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){return new(t.options.inputClass||(R?nt:O?ut:$?dt:Z))(t,U)}(this),this.touchAction=new Tt(this,this.options.touchAction),Bt(this,!0),p(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Bt(t,e){var n,r=t.element;r.style&&(p(t.options.cssProps,(function(i,s){n=A(r.style,s),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}zt.prototype={set:function(t){return s(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var s=0;s<r.length;)n=r[s],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),s++}},get:function(t){if(t instanceof Mt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=E(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return p(T(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==i){var n=this.handlers;return p(T(t),(function(t){e?n[t]&&n[t].splice(E(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var r=n.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=e,e.target.dispatchEvent(r)}(t,e);var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](e),i++}},destroy:function(){this.element&&Bt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},s(Ft,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Et,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:D,DIRECTION_ALL:30,Manager:zt,Input:B,TouchAction:Tt,TouchInput:ut,MouseInput:Z,PointerEventInput:nt,TouchMouseInput:dt,SingleTouchInput:ot,Recognizer:Mt,AttrRecognizer:It,Tap:Dt,Pan:$t,Swipe:Lt,Pinch:Rt,Rotate:Pt,Press:Ot,on:w,off:S,each:p,merge:g,extend:m,assign:s,inherit:y,bindFn:b,prefixed:A}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Ft,t.exports?t.exports=Ft:e.Hammer=Ft}(window,document)}(Jot);var Qot=Jot.exports;
/*!
* chartjs-plugin-zoom v1.2.1
* undefined
 * (c) 2016-2022 chartjs-plugin-zoom Contributors
 * Released under the MIT License
 */const tat=t=>t&&t.enabled&&t.modifierKey,eat=(t,e)=>t&&e[t+"Key"],nat=(t,e)=>t&&!e[t+"Key"];function rat(t,e,n){return void 0===t||("string"==typeof t?-1!==t.indexOf(e):"function"==typeof t&&-1!==t({chart:n}).indexOf(e))}function iat(t,e,n){const r=function({x:t,y:e},n){const r=n.scales,i=Object.keys(r);for(let n=0;n<i.length;n++){const s=r[i[n]];if(e>=s.top&&e<=s.bottom&&t>=s.left&&t<=s.right)return s}return null}(e,n);if(r&&rat(t,r.axis,n))return[r];const i=[];return P4(n.scales,(function(e){rat(t,e.axis,n)||i.push(e)})),i}const sat=new WeakMap;function oat(t){let e=sat.get(t);return e||(e={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{}},sat.set(t,e)),e}function aat(t,e,n){const r=t.max-t.min,i=r*(e-1),s=t.isHorizontal()?n.x:n.y,o=Math.max(0,Math.min(1,(t.getValueForPixel(s)-t.min)/r||0));return{min:i*o,max:i*(1-o)}}function lat(t,e,n,r,i){let s=n[r];if("original"===s){const n=t.originalScaleLimits[e.id][r];s=$4(n.options,n.scale)}return $4(s,i)}function cat(t,{min:e,max:n},r,i=!1){const s=oat(t.chart),{id:o,axis:a,options:l}=t,c=r&&(r[o]||r[a])||{},{minRange:u=0}=c,h=lat(s,t,c,"min",-1/0),d=lat(s,t,c,"max",1/0),p=Math.max(e,h),f=Math.min(n,d),m=i?Math.max(f-p,u):t.max-t.min;if(f-p!==m)if(h>f-m)e=p,n=p+m;else if(d<p+m)n=f,e=f-m;else{const t=(m-f+p)/2;e=p-t,n=f+t}else e=p,n=f;return l.min=e,l.max=n,s.updatedScaleLimits[t.id]={min:e,max:n},t.parse(e)!==t.min||t.parse(n)!==t.max}const uat=t=>0===t||isNaN(t)?0:t<0?Math.min(Math.round(t),-1):Math.max(Math.round(t),1);const hat={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function dat(t,e,n,r=!1){const{min:i,max:s,options:o}=t,a=o.time&&o.time.round,l=hat[a]||0,c=t.getValueForPixel(t.getPixelForValue(i+l)-e),u=t.getValueForPixel(t.getPixelForValue(s+l)-e),{min:h=-1/0,max:d=1/0}=r&&n&&n[t.axis]||{};return!!(isNaN(c)||isNaN(u)||c<h||u>d)||cat(t,{min:c,max:u},n,r)}function pat(t,e,n){return dat(t,e,n,!0)}const fat={category:function(t,e,n,r){const i=aat(t,e,n);return t.min===t.max&&e<1&&function(t){const e=t.getLabels().length-1;t.min>0&&(t.min-=1),t.max<e&&(t.max+=1)}(t),cat(t,{min:t.min+uat(i.min),max:t.max-uat(i.max)},r,!0)},default:function(t,e,n,r){const i=aat(t,e,n);return cat(t,{min:t.min+i.min,max:t.max-i.max},r,!0)}},mat={category:function(t,e,n){const r=t.getLabels().length-1;let{min:i,max:s}=t;const o=Math.max(s-i,1),a=Math.round(function(t){return t.isHorizontal()?t.width:t.height}(t)/Math.max(o,10)),l=Math.round(Math.abs(e/a));let c;return e<-a?(s=Math.min(s+l,r),i=1===o?s:s-o,c=s===r):e>a&&(i=Math.max(0,i-l),s=1===o?i:i+o,c=0===i),cat(t,{min:i,max:s},n)||c},default:dat,logarithmic:pat,timeseries:pat};function gat(t,e){P4(t,((n,r)=>{e[r]||delete t[r]}))}function yat(t,e){const{scales:n}=t,{originalScaleLimits:r,updatedScaleLimits:i}=e;return P4(n,(function(t){(function(t,e,n){const{id:r,options:{min:i,max:s}}=t;if(!e[r]||!n[r])return!0;const o=n[r];return o.min!==i||o.max!==s})(t,r,i)&&(r[t.id]={min:{scale:t.min,options:t.options.min},max:{scale:t.max,options:t.options.max}})})),gat(r,n),gat(i,n),r}function bat(t,e,n,r){O4(fat[t.type]||fat.default,[t,e,n,r])}function vat(t){const e=t.chartArea;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function xat(t,e,n="none"){const{x:r=1,y:i=1,focalPoint:s=vat(t)}="number"==typeof e?{x:e,y:e}:e,o=oat(t),{options:{limits:a,zoom:l}}=o,{mode:c="xy",overScaleMode:u}=l||{};yat(t,o);const h=1!==r&&rat(c,"x",t),d=1!==i&&rat(c,"y",t);P4(u&&iat(u,s,t)||t.scales,(function(t){t.isHorizontal()&&h?bat(t,r,s,a):!t.isHorizontal()&&d&&bat(t,i,s,a)})),t.update(n),O4(l.onZoom,[{chart:t}])}function wat(t,e,n){const r=t.getValueForPixel(e),i=t.getValueForPixel(n);return{min:Math.min(r,i),max:Math.max(r,i)}}function Sat(t){const e=oat(t);let n=1,r=1;return P4(t.scales,(function(t){const i=function(t,e){const n=t.originalScaleLimits[e];if(!n)return;const{min:r,max:i}=n;return $4(i.options,i.scale)-$4(r.options,r.scale)}(e,t.id);if(i){const e=Math.round(i/(t.max-t.min)*100)/100;n=Math.min(n,e),r=Math.max(r,e)}})),n<1?n:r}function _at(t,e,n,r){const{panDelta:i}=r,s=i[t.id]||0;i5(s)===i5(e)&&(e+=s);O4(mat[t.type]||mat.default,[t,e,n])?i[t.id]=0:i[t.id]=e}function kat(t,e,n,r="none"){const{x:i=0,y:s=0}="number"==typeof e?{x:e,y:e}:e,o=oat(t),{options:{pan:a,limits:l}}=o,{mode:c="xy",onPan:u}=a||{};yat(t,o);const h=0!==i&&rat(c,"x",t),d=0!==s&&rat(c,"y",t);P4(n||t.scales,(function(t){t.isHorizontal()&&h?_at(t,i,l,o):!t.isHorizontal()&&d&&_at(t,s,l,o)})),t.update(r),O4(u,[{chart:t}])}function Tat(t){const e=oat(t),n={};for(const r of Object.keys(t.scales)){const{min:t,max:i}=e.originalScaleLimits[r]||{min:{},max:{}};n[r]={min:t.scale,max:i.scale}}return n}function Eat(t,e){const{handlers:n}=oat(t),r=n[e];r&&r.target&&(r.target.removeEventListener(e,r),delete n[e])}function Mat(t,e,n,r){const{handlers:i,options:s}=oat(t),o=i[n];o&&o.target===e||(Eat(t,n),i[n]=e=>r(t,e,s),i[n].target=e,e.addEventListener(n,i[n]))}function Cat(t,e){const n=oat(t);n.dragStart&&(n.dragging=!0,n.dragEnd=e,t.update("none"))}function Aat(t,e,n){const{onZoomStart:r,onZoomRejected:i}=n;if(r){const{left:n,top:s}=e.target.getBoundingClientRect();if(!1===O4(r,[{chart:t,event:e,point:{x:e.clientX-n,y:e.clientY-s}}]))return O4(i,[{chart:t,event:e}]),!1}}function Nat(t,e){const n=oat(t),{pan:r,zoom:i={}}=n.options;if(eat(tat(r),e)||nat(tat(i.drag),e))return O4(i.onZoomRejected,[{chart:t,event:e}]);!1!==Aat(t,e,i)&&(n.dragStart=e,Mat(t,t.canvas,"mousemove",Cat))}function Iat(t,e,n,r){const{left:i,top:s}=n.target.getBoundingClientRect(),o=rat(e,"x",t),a=rat(e,"y",t);let{top:l,left:c,right:u,bottom:h,width:d,height:p}=t.chartArea;o&&(c=Math.min(n.clientX,r.clientX)-i,u=Math.max(n.clientX,r.clientX)-i),a&&(l=Math.min(n.clientY,r.clientY)-s,h=Math.max(n.clientY,r.clientY)-s);const f=u-c,m=h-l;return{left:c,top:l,right:u,bottom:h,width:f,height:m,zoomX:o&&f?1+(d-f)/d:1,zoomY:a&&m?1+(p-m)/p:1}}function $at(t,e){const n=oat(t);if(!n.dragStart)return;Eat(t,"mousemove");const{mode:r,onZoomComplete:i,drag:{threshold:s=0}}=n.options.zoom,o=Iat(t,r,n.dragStart,e),a=rat(r,"x",t)?o.width:0,l=rat(r,"y",t)?o.height:0,c=Math.sqrt(a*a+l*l);if(n.dragStart=n.dragEnd=null,c<=s)return n.dragging=!1,void t.update("none");!function(t,e,n,r="none"){const i=oat(t),{options:{limits:s,zoom:o}}=i,{mode:a="xy"}=o;yat(t,i);const l=rat(a,"x",t),c=rat(a,"y",t);P4(t.scales,(function(t){t.isHorizontal()&&l?cat(t,wat(t,e.x,n.x),s,!0):!t.isHorizontal()&&c&&cat(t,wat(t,e.y,n.y),s,!0)})),t.update(r),O4(o.onZoom,[{chart:t}])}(t,{x:o.left,y:o.top},{x:o.right,y:o.bottom},"zoom"),setTimeout((()=>n.dragging=!1),500),O4(i,[{chart:t}])}function Rat(t,e){const{handlers:{onZoomComplete:n},options:{zoom:r}}=oat(t);if(!function(t,e,n){if(nat(tat(n.wheel),e))O4(n.onZoomRejected,[{chart:t,event:e}]);else if(!1!==Aat(t,e,n)&&(e.cancelable&&e.preventDefault(),void 0!==e.deltaY))return!0}(t,e,r))return;const i=e.target.getBoundingClientRect(),s=1+(e.deltaY>=0?-r.wheel.speed:r.wheel.speed);xat(t,{x:s,y:s,focalPoint:{x:e.clientX-i.left,y:e.clientY-i.top}}),n&&n()}function Oat(t,e,n,r){n&&(oat(t).handlers[e]=function(t,e){let n;return function(){return clearTimeout(n),n=setTimeout(t,e),e}}((()=>O4(n,[{chart:t}])),r))}function Pat(t,e){return function(n,r){const{pan:i,zoom:s={}}=e.options;if(!i||!i.enabled)return!1;const o=r&&r.srcEvent;return!o||(!(!e.panning&&"mouse"===r.pointerType&&(nat(tat(i),o)||eat(tat(s.drag),o)))||(O4(i.onPanRejected,[{chart:t,event:r}]),!1))}}function Lat(t,e,n){if(e.scale){const{center:r,pointers:i}=n,s=1/e.scale*n.scale,o=n.target.getBoundingClientRect(),a=function(t,e){const n=Math.abs(t.clientX-e.clientX),r=Math.abs(t.clientY-e.clientY),i=n/r;let s,o;return i>.3&&i<1.7?s=o=!0:n>r?s=!0:o=!0,{x:s,y:o}}(i[0],i[1]),l=e.options.zoom.mode;xat(t,{x:a.x&&rat(l,"x",t)?s:1,y:a.y&&rat(l,"y",t)?s:1,focalPoint:{x:r.x-o.left,y:r.y-o.top}}),e.scale=n.scale}}function Dat(t,e,n){const r=e.delta;r&&(e.panning=!0,kat(t,{x:n.deltaX-r.x,y:n.deltaY-r.y},e.panScales),e.delta={x:n.deltaX,y:n.deltaY})}const Fat=new WeakMap;function zat(t,e){const n=oat(t),r=t.canvas,{pan:i,zoom:s}=e,o=new Qot.Manager(r);s&&s.pinch.enabled&&(o.add(new Qot.Pinch),o.on("pinchstart",(()=>function(t,e){e.options.zoom.pinch.enabled&&(e.scale=1)}(0,n))),o.on("pinch",(e=>Lat(t,n,e))),o.on("pinchend",(e=>function(t,e,n){e.scale&&(Lat(t,e,n),e.scale=null,O4(e.options.zoom.onZoomComplete,[{chart:t}]))}(t,n,e)))),i&&i.enabled&&(o.add(new Qot.Pan({threshold:i.threshold,enable:Pat(t,n)})),o.on("panstart",(e=>function(t,e,n){const{enabled:r,overScaleMode:i,onPanStart:s,onPanRejected:o}=e.options.pan;if(!r)return;const a=n.target.getBoundingClientRect(),l={x:n.center.x-a.left,y:n.center.y-a.top};if(!1===O4(s,[{chart:t,event:n,point:l}]))return O4(o,[{chart:t,event:n}]);e.panScales=i&&iat(i,l,t),e.delta={x:0,y:0},clearTimeout(e.panEndTimeout),Dat(t,e,n)}(t,n,e))),o.on("panmove",(e=>Dat(t,n,e))),o.on("panend",(()=>function(t,e){e.delta=null,e.panning&&(e.panEndTimeout=setTimeout((()=>e.panning=!1),500),O4(e.options.pan.onPanComplete,[{chart:t}]))}(t,n)))),Fat.set(t,o)}var Bat={id:"zoom",version:"1.2.1",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(t,e,n){oat(t).options=n,Object.prototype.hasOwnProperty.call(n.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),Qot&&zat(t,n),t.pan=(e,n,r)=>kat(t,e,n,r),t.zoom=(e,n)=>xat(t,e,n),t.zoomScale=(e,n,r)=>function(t,e,n,r="none"){yat(t,oat(t)),cat(t.scales[e],n,void 0,!0),t.update(r)}(t,e,n,r),t.resetZoom=e=>function(t,e="default"){const n=oat(t),r=yat(t,n);P4(t.scales,(function(t){const e=t.options;r[t.id]?(e.min=r[t.id].min.options,e.max=r[t.id].max.options):(delete e.min,delete e.max)})),t.update(e),O4(n.options.zoom.onZoomComplete,[{chart:t}])}(t,e),t.getZoomLevel=()=>Sat(t),t.getInitialScaleBounds=()=>Tat(t),t.isZoomedOrPanned=()=>function(t){const e=Tat(t);for(const n of Object.keys(t.scales)){const{min:r,max:i}=e[n];if(void 0!==r&&t.scales[n].min!==r)return!0;if(void 0!==i&&t.scales[n].max!==i)return!0}return!1}(t)},beforeEvent(t){const e=oat(t);if(e.panning||e.dragging)return!1},beforeUpdate:function(t,e,n){oat(t).options=n,function(t,e){const n=t.canvas,{wheel:r,drag:i,onZoomComplete:s}=e.zoom;r.enabled?(Mat(t,n,"wheel",Rat),Oat(t,"onZoomComplete",s,250)):Eat(t,"wheel"),i.enabled?(Mat(t,n,"mousedown",Nat),Mat(t,n.ownerDocument,"mouseup",$at)):(Eat(t,"mousedown"),Eat(t,"mousemove"),Eat(t,"mouseup"))}(t,n)},beforeDatasetsDraw:function(t,e,n){const{dragStart:r,dragEnd:i}=oat(t);if(i){const{left:e,top:s,width:o,height:a}=Iat(t,n.zoom.mode,r,i),l=n.zoom.drag,c=t.ctx;c.save(),c.beginPath(),c.fillStyle=l.backgroundColor||"rgba(225,225,225,0.3)",c.fillRect(e,s,o,a),l.borderWidth>0&&(c.lineWidth=l.borderWidth,c.strokeStyle=l.borderColor||"rgba(225,225,225)",c.strokeRect(e,s,o,a)),c.restore()}},stop:function(t){!function(t){Eat(t,"mousedown"),Eat(t,"mousemove"),Eat(t,"mouseup"),Eat(t,"wheel"),Eat(t,"click")}(t),Qot&&function(t){const e=Fat.get(t);e&&(e.remove("pinchstart"),e.remove("pinch"),e.remove("pinchend"),e.remove("panstart"),e.remove("pan"),e.remove("panend"),e.destroy(),Fat.delete(t))}(t),function(t){sat.delete(t)}(t)},panFunctions:mat,zoomFunctions:fat};function Uat(t){let e;return{c(){e=UT("Reset Zoom")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function Vat(t){let e,n,r,i,s,o;return s=new nM({props:{size:"small",$$slots:{default:[Uat]},$$scope:{ctx:t}}}),s.$on("click",t[8]),{c(){e=zT("div"),n=zT("canvas"),r=VT(),i=zT("div"),YE(s.$$.fragment),GT(e,"id","scatter-container"),GT(e,"class","svelte-ei9k3k"),GT(i,"class","flex justify-end")},m(a,l){LT(a,e,l),RT(e,n),t[7](n),LT(a,r,l),LT(a,i,l),KE(s,i,null),o=!0},p(t,e){const n={};8192&e&&(n.$$scope={dirty:e,ctx:t}),s.$set(n)},i(t){o||(FE(s.$$.fragment,t),o=!0)},o(t){zE(s.$$.fragment,t),o=!1},d(n){n&&DT(e),t[7](null),n&&DT(r),n&&DT(i),ZE(s)}}}function jat(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[Vat]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8198&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Wat(t,e,n){L9.register(ktt,Mtt,J9,Xtt,ttt,p7,Att,Vtt),L9.register(Bat);let{title:r}=e,{data:i}=e,{hovered:s}=e,{clicked:o}=e;function a(t){const{chart:e,tooltip:n}=t,r=(t=>{let e=t.canvas.parentNode.querySelector("div");if(!e){e=document.createElement("div"),e.style.background="transparent",e.style.borderRadius="3px",e.style.color="white",e.style.opacity=1,e.style.pointerEvents="none",e.style.position="absolute",e.style.transform="translate(-50%, 0)",e.style.transition="all .1s ease";const n=document.createElement("img");n.style.borderRadius="4px",n.style.margin="0px",n.width=100,n.height=100,e.appendChild(n),t.canvas.parentNode.appendChild(e)}return e})(e);if(0===n.opacity)return void(r.style.opacity=0);r.querySelector("img").src=n.dataPoints[0].raw.thumbnail;const{offsetLeft:i,offsetTop:s}=e.canvas;r.style.opacity=1,r.style.left=i+n.caretX+70+"px",r.style.top=s+n.caretY+20+"px",r.style.font=n.options.bodyFont.string,r.style.padding=n.options.padding+"px "+n.options.padding+"px"}const l={type:"scatter",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:200},scales:{y:{position:"center",ticks:{display:!1}},x:{position:"center",ticks:{display:!1}}},elements:{point:{radius:8,hoverRadius:10,borderWidth:0,hoverBorderWidth:3}},plugins:{legend:{position:"top"},tooltip:{enabled:!1,position:"nearest",external:a},zoom:{zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"}}},onClick(t,e){o.set(e.map((({element:t})=>t)))},onHover(t,e){const n=e.map((({element:t})=>{var e,n;return null===(n=null===(e=null==t?void 0:t.$context)||void 0===e?void 0:e.raw)||void 0===n?void 0:n.id}));Dst(n,s.get())||s.set(n)}}};let c,u,h=()=>{};hE((async()=>{await kE(),await kE(),async function(){h();const t={...l,data:i.get()};h=i.filter((t=>!!t)).subscribe((e=>{t.data=e,c.update(),c.resetZoom()}));const e=u.getContext("2d");n(1,c=new L9(e,t))}()})),pE((()=>{h(),null==c||c.destroy()}));return t.$$set=t=>{"title"in t&&n(0,r=t.title),"data"in t&&n(3,i=t.data),"hovered"in t&&n(4,s=t.hovered),"clicked"in t&&n(5,o=t.clicked)},[r,c,u,i,s,o,a,function(t){bE[t?"unshift":"push"]((()=>{u=t,n(2,u)}))},()=>c.resetZoom()]}class Hat extends QE{constructor(t){super(),JE(this,t,Wat,jat,gT,{title:0,data:3,hovered:4,clicked:5,externalTooltipHandler:6})}get externalTooltipHandler(){return this.$$.ctx[6]}}const Gat=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"];class qat extends SU{constructor(t){super(),this.dataset=t,this.title="Dataset ScatterPlot",this.transforms={xy:t=>[t.x[0],t.x[1]],label:t=>t.y},this.$data=new rU(void 0,!0),this.$hovered=new rU([],!0),this.$clicked=new rU([],!0),this.dataset.ready.then((()=>{this.updateData()}))}setTransforms(t){this.transforms={...this.transforms,...t},this.updateData()}async updateData(){await this.dataset.ready;const t=await Promise.all(await this.dataset.items().map((async t=>{const[e,n]=await this.transforms.xy(t);return{x:e,y:n,label:await this.transforms.label(t),id:t.id,thumbnail:t.thumbnail}})).toArray()),e=t.map((t=>t.label)),n=Array.from(new Set(e));n.sort();const r={labels:e,datasets:n.map(((e,n)=>{return{label:e,data:t.filter((t=>t.label===e)),borderColor:(r=Gat[n],new Zot(r)).darken(.5).rgbString(),backgroundColor:Gat[n]};var r}))};this.$data.set(r)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Hat({target:e,props:{title:this.title,data:this.$data,hovered:this.$hovered,clicked:this.$clicked}}))}}function Xat(...t){return new qat(...t)}function Yat(t){return{c:uT,m:uT,p:uT,i:uT,o:uT,d:uT}}function Kat(t){let e,n,r=t[5]&&Zat(t);return{c(){r&&r.c(),e=jT()},m(t,i){r&&r.m(t,i),LT(t,e,i),n=!0},p(t,n){t[5]?r?(r.p(t,n),32&n&&FE(r,1)):(r=Zat(t),r.c(),FE(r,1),r.m(e.parentNode,e)):r&&(LE(),zE(r,1,1,(()=>{r=null})),DE())},i(t){n||(FE(r),n=!0)},o(t){zE(r),n=!1},d(t){r&&r.d(t),t&&DT(e)}}}function Zat(t){let e,n;return e=new ML({props:{provider:t[5],columns:t[4],singleSelection:t[2],actions:[{name:"delete"}]}}),e.$on("selection",t[7]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};32&n&&(r.provider=t[5]),16&n&&(r.columns=t[4]),4&n&&(r.singleSelection=t[2]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Jat(t){let e,n;return e=new XM({}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p:uT,i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Qat(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:Jat,then:Kat,catch:Yat,value:8,blocks:[,,,]};return VE(n=t[1].ready,i),{c(){e=jT(),i.block.c()},m(t,n){LT(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,2&r&&n!==(n=t[1].ready)&&VE(n,i)||jE(i,t,r)},i(t){r||(FE(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){zE(i.blocks[t])}r=!1},d(t){t&&DT(e),i.block.d(t),i.token=null,i=null}}}function tlt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[Qat]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),574&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function elt(t){return"string"==typeof t&&t.includes("data:image/")?"image":"string"!=typeof t||isNaN(Date.parse(t))?Array.isArray(t)&&(t.length>1&&Array.isArray(t[0])||t.length>3)?"array":"generic":"date"}function nlt(t){return"image"!==elt(t)}function rlt(t,e,n){let r,{title:i}=e,{dataset:s}=e,{colNames:o}=e,{singleSelection:a=!1}=e,{selection:l}=e,c=[{name:"x"},{name:"y",sortable:!0},{name:"thumbnail",type:"image"},{name:"updatedAt",sortable:!0}];hE((async()=>{await kE(),await s.ready,n(5,r=new OL({service:s.instanceService,columns:c})),o.subscribe((async t=>{if(n(4,c=t.map((t=>({name:t})))),s.$count.get()>0){const[t]=await s.items().take(1).toArray();n(4,c=c.map((({name:e})=>({name:e,type:elt(t[e]),sortable:nlt(t[e])}))))}n(5,r.query.$select=c.map((t=>t.name)).concat(["id"]),r),r.update()}));const t=s.$count.subscribe((async e=>{if(e>0){const[e]=await s.items().take(1).toArray();n(4,c=c.map((({name:t})=>({name:t,type:elt(e[t]),sortable:nlt(e[t])})))),t()}}))}));return t.$$set=t=>{"title"in t&&n(0,i=t.title),"dataset"in t&&n(1,s=t.dataset),"colNames"in t&&n(6,o=t.colNames),"singleSelection"in t&&n(2,a=t.singleSelection),"selection"in t&&n(3,l=t.selection)},[i,s,a,l,c,r,o,({detail:t})=>{l.set(t)}]}class ilt extends QE{constructor(t){super(),JE(this,t,rlt,tlt,gT,{title:0,dataset:1,colNames:6,singleSelection:2,selection:3})}}var slt,olt;class alt extends SU{constructor(t,e,n=!1){super(),this.title="dataset table",slt.set(this,void 0),this.$selection=new rU([],!0),this.singleSelection=!1,HB(this,slt,t,"f"),this.singleSelection=n,this.$columns=new rU(e||["x","y","thumbnail","updatedAt"],!0),e||WB(this,slt,"f").ready.then((()=>WB(this,slt,"f").items().take(1).toArray())).then((t=>{if(t.length>0){const e=Object.keys(t[0]);this.$columns.set(e)}})).catch((t=>{console.log("An error occured while fetching the first instance.",t)})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new ilt({target:e,props:{title:this.title,dataset:WB(this,slt,"f"),colNames:this.$columns,singleSelection:this.singleSelection,selection:this.$selection}}))}}function llt(t,e){return new alt(t,e)}function clt(t){let e;return{c(){e=zT("canvas"),GT(e,"id","can"),GT(e,"class","w-full max-w-full")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function ult(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[clt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function hlt(t,e,n){let{title:r}=e,{imageStream:i}=e,{objectDetectionResults:s}=e;return hE((()=>{const t=document.getElementById("can"),e=t.getContext("2d");i.subscribe((n=>{t.height=n.height,t.width=n.width,e.putImageData(n,0,0)})),s.subscribe((({outputs:n})=>{for(let r=0;r<n.length;r++){e.font=`${Math.floor(t.width/60)}px sans-serif`;const i=`${n[r].confidence.toFixed(3)} ${n[r].class}`,s=e.measureText(i);e.beginPath(),e.rect(...n[r].bbox),e.lineWidth=t.width/300,e.strokeStyle="green",e.fillStyle="green",e.stroke(),e.fillRect(n[r].bbox[0]-e.lineWidth/2,n[r].bbox[1]>s.actualBoundingBoxAscent?n[r].bbox[1]-s.actualBoundingBoxAscent-1.5*e.lineWidth:0,s.width+e.lineWidth,s.actualBoundingBoxAscent+e.lineWidth),e.fillStyle="white",e.fillText(i,n[r].bbox[0],n[r].bbox[1]>s.actualBoundingBoxAscent?n[r].bbox[1]-e.lineWidth:s.actualBoundingBoxAscent)}}))})),t.$$set=t=>{"title"in t&&n(0,r=t.title),"imageStream"in t&&n(1,i=t.imageStream),"objectDetectionResults"in t&&n(2,s=t.objectDetectionResults)},[r,i,s]}slt=new WeakMap;class dlt extends QE{constructor(t){super(),JE(this,t,hlt,ult,gT,{title:0,imageStream:1,objectDetectionResults:2})}}class plt extends SU{constructor(t,e){super(),this.title="Visualize Object Detections",this.$imgStream=t,this.$objectDetectionResults=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new dlt({target:e,props:{title:this.title,imageStream:this.$imgStream,objectDetectionResults:this.$objectDetectionResults}}))}}function flt(...t){return new plt(...t)}function mlt(t){let e;return{c(){e=zT("div"),e.innerHTML='<i><svg class="fill-current w-12 h-12 mb-3 text-blue-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.479 10.092c-.212-3.951-3.473-7.092-7.479-7.092-4.005 0-7.267 3.141-7.479 7.092-2.57.463-4.521 2.706-4.521 5.408 0 3.037 2.463 5.5 5.5 5.5h13c3.037 0 5.5-2.463 5.5-5.5 0-2.702-1.951-4.945-4.521-5.408zm-7.479-1.092l4 4h-3v4h-2v-4h-3l4-4z"></path></svg></i> \n      <p class="text-lg text-blue-700">Drop files to upload</p>',GT(e,"class","overlay svelte-10fctvd")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function glt(t){let e;return{c(){e=UT("Upload a file")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function ylt(t){let e,n,r,i,s,o,a,l,c,u,h,d=t[2]&&mlt();return l=new nM({props:{$$slots:{default:[glt]},$$scope:{ctx:t}}}),l.$on("click",t[7]),{c(){d&&d.c(),e=VT(),n=zT("div"),r=zT("div"),i=zT("p"),i.innerHTML="<span>Drop Files here or:</span>",s=VT(),o=zT("input"),a=VT(),YE(l.$$.fragment),GT(i,"class","mb-3 font-semibold text-gray-900 flex flex-wrap justify-center"),GT(o,"type","file"),o.multiple=!0,GT(o,"class","hidden"),GT(r,"class","border-dashed border-2 border-gray-300 py-8 flex flex-col justify-center items-center"),GT(n,"class","file-upload svelte-10fctvd")},m(p,f){d&&d.m(p,f),LT(p,e,f),LT(p,n,f),RT(n,r),RT(r,i),RT(r,s),RT(r,o),t[9](o),RT(r,a),KE(l,r,null),c=!0,u||(h=[WT(n,"dragenter",t[3]),WT(n,"dragleave",t[4]),WT(n,"dragover",t[5]),WT(n,"drop",t[6])],u=!0)},p(t,n){t[2]?d||(d=mlt(),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null);const r={};8192&n&&(r.$$scope={dirty:n,ctx:t}),l.$set(r)},i(t){c||(FE(l.$$.fragment,t),c=!0)},o(t){zE(l.$$.fragment,t),c=!1},d(r){d&&d.d(r),r&&DT(e),r&&DT(n),t[9](null),ZE(l),u=!1,fT(h)}}}function blt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[ylt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8198&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function vlt(t,e,n){let r,{title:i}=e,{fileStream:s}=e,o=0,a=!1;const l=({dataTransfer:{types:t=[]}})=>t.indexOf("Files")>-1;function c(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]);s.set(e)}return hE((async()=>{await kE(),await kE(),r.addEventListener("change",(t=>{c(t.target.files)}))})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"fileStream"in t&&n(8,s=t.fileStream)},[i,r,a,function(t){t.preventDefault(),l(t)&&(o+=1,n(2,a=!0))},function(){o-=1,o<1&&n(2,a=!1)},function(t){l(t)&&t.preventDefault()},function(t){t.preventDefault(),n(2,a=!1),c(t.dataTransfer.files)},function(){r&&r.click()},s,function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class xlt extends QE{constructor(t){super(),JE(this,t,vlt,blt,gT,{title:0,fileStream:8})}}class wlt extends SU{constructor(){super(),this.title="file upload",this.$files=new rU(JD()),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new xlt({target:e,props:{title:this.title,fileStream:this.$files}}))}}function Slt(...t){return new wlt(...t)}function _lt(t){let e;return{c(){e=zT("canvas"),GT(e,"class","w-full max-w-full")},m(n,r){LT(n,e,r),t[3](e)},p:uT,d(n){n&&DT(e),t[3](null)}}}function klt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[_lt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),34&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Tlt(t,e,n){let r,{title:i}=e,{imageStream:s}=e,o=QB;return hE((async()=>{await kE(),await kE();const t=r.getContext("2d");o=s.subscribe((e=>{if(!Array.isArray(e)||0!==e.length)if(e instanceof ImageData)n(1,r.width=e.width,r),n(1,r.height=e.height,r),t.putImageData(e,0,0);else if(Array.isArray(e))throw new Error("This component does not yet support multiple images")}))})),pE((()=>{o()})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"imageStream"in t&&n(2,s=t.imageStream)},[i,r,s,function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Elt extends QE{constructor(t){super(),JE(this,t,Tlt,klt,gT,{title:0,imageStream:2})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),NE()}get imageStream(){return this.$$.ctx[2]}set imageStream(t){this.$$set({imageStream:t}),NE()}}class Mlt extends SU{constructor(t){super(),this.title="image display",olt.set(this,void 0),HB(this,olt,t,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Elt({target:e,props:{title:this.title,imageStream:WB(this,olt,"f")}}))}}function Clt(...t){return new Mlt(...t)}olt=new WeakMap;var Alt={exports:{}},Nlt={exports:{}};!function(t){!function(e){var n=e.URL||e.webkitURL;function r(t){return!!n&&n.createObjectURL(t)}function i(t){return!!n&&n.revokeObjectURL(t)}function s(t,e){!t||"blob:"!==t.slice(0,5)||e&&e.noRevoke||i(t)}function o(t,n,r,i){if(!e.FileReader)return!1;var s=new FileReader;s.onload=function(){n.call(s,this.result)},r&&(s.onabort=s.onerror=function(){r.call(s,this.error)});var o=s[i||"readAsDataURL"];return o?(o.call(s,t),s):void 0}function a(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"}function l(t,n,i){function c(n,c){var u,h=document.createElement("img");function d(t,e){n!==c?t instanceof Error?c(t):((e=e||{}).image=t,n(e)):n&&n(t,e)}function p(n,s){s&&e.console&&console.log(s),n&&a("Blob",n)?u=r(t=n):(u=t,i&&i.crossOrigin&&(h.crossOrigin=i.crossOrigin)),h.src=u}return h.onerror=function(t){s(u,i),c&&c.call(h,t)},h.onload=function(){s(u,i);var e={originalWidth:h.naturalWidth||h.width,originalHeight:h.naturalHeight||h.height};try{l.transform(h,i,d,t,e)}catch(t){c&&c(t)}},"string"==typeof t?(l.requiresMetaData(i)?l.fetchBlob(t,p,i):p(),h):a("Blob",t)||a("File",t)?(u=r(t))?(h.src=u,h):o(t,(function(t){h.src=t}),c):void 0}return e.Promise&&"function"!=typeof n?(i=n,new Promise(c)):c(n,n)}l.requiresMetaData=function(t){return t&&t.meta},l.fetchBlob=function(t,e){e()},l.transform=function(t,e,n,r,i){n(t,i)},l.global=e,l.readFile=o,l.isInstanceOf=a,l.createObjectURL=r,l.revokeObjectURL=i,t.exports?t.exports=l:e.loadImage=l}("undefined"!=typeof window&&window||yt)}(Nlt);var Ilt,$lt={exports:{}};Ilt=function(t){var e=t.transform;t.createCanvas=function(e,n,r){if(r&&t.global.OffscreenCanvas)return new OffscreenCanvas(e,n);var i=document.createElement("canvas");return i.width=e,i.height=n,i},t.transform=function(n,r,i,s,o){e.call(t,t.scale(n,r,o),r,i,s,o)},t.transformCoordinates=function(){},t.getTransformedOptions=function(t,e){var n,r,i,s,o=e.aspectRatio;if(!o)return e;for(r in n={},e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.crop=!0,(i=t.naturalWidth||t.width)/(s=t.naturalHeight||t.height)>o?(n.maxWidth=s*o,n.maxHeight=s):(n.maxWidth=i,n.maxHeight=i/o),n},t.drawImage=function(t,e,n,r,i,s,o,a,l){var c=e.getContext("2d");return!1===l.imageSmoothingEnabled?(c.msImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1):l.imageSmoothingQuality&&(c.imageSmoothingQuality=l.imageSmoothingQuality),c.drawImage(t,n,r,i,s,0,0,o,a),c},t.requiresCanvas=function(t){return t.canvas||t.crop||!!t.aspectRatio},t.scale=function(e,n,r){n=n||{},r=r||{};var i,s,o,a,l,c,u,h,d,p,f,m,g=e.getContext||t.requiresCanvas(n)&&!!t.global.HTMLCanvasElement,y=e.naturalWidth||e.width,b=e.naturalHeight||e.height,v=y,x=b;function w(){var t=Math.max((o||v)/v,(a||x)/x);t>1&&(v*=t,x*=t)}function S(){var t=Math.min((i||v)/v,(s||x)/x);t<1&&(v*=t,x*=t)}if(g&&(u=(n=t.getTransformedOptions(e,n,r)).left||0,h=n.top||0,n.sourceWidth?(l=n.sourceWidth,void 0!==n.right&&void 0===n.left&&(u=y-l-n.right)):l=y-u-(n.right||0),n.sourceHeight?(c=n.sourceHeight,void 0!==n.bottom&&void 0===n.top&&(h=b-c-n.bottom)):c=b-h-(n.bottom||0),v=l,x=c),i=n.maxWidth,s=n.maxHeight,o=n.minWidth,a=n.minHeight,g&&i&&s&&n.crop?(v=i,x=s,(f=l/c-i/s)<0?(c=s*l/i,void 0===n.top&&void 0===n.bottom&&(h=(b-c)/2)):f>0&&(l=i*c/s,void 0===n.left&&void 0===n.right&&(u=(y-l)/2))):((n.contain||n.cover)&&(o=i=i||o,a=s=s||a),n.cover?(S(),w()):(w(),S())),g){if((d=n.pixelRatio)>1&&(!e.style.width||Math.floor(parseFloat(e.style.width,10))!==Math.floor(y/d))&&(v*=d,x*=d),t.orientationCropBug&&!e.getContext&&(u||h||l!==y||c!==b)&&(f=e,e=t.createCanvas(y,b,!0),t.drawImage(f,e,0,0,y,b,y,b,n)),(p=n.downsamplingRatio)>0&&p<1&&v<l&&x<c)for(;l*p>v;)m=t.createCanvas(l*p,c*p,!0),t.drawImage(e,m,u,h,l,c,m.width,m.height,n),u=0,h=0,l=m.width,c=m.height,e=m;return m=t.createCanvas(v,x),t.transformCoordinates(m,n,r),d>1&&(m.style.width=m.width/d+"px"),t.drawImage(e,m,u,h,l,c,v,x,n).setTransform(1,0,0,1,0,0),m}return e.width=v,e.height=x,e}},Ilt($lt.exports?Nlt.exports:window.loadImage);var Rlt={exports:{}};!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){var e=t.global,n=t.transform,r=e.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),i=e.ArrayBuffer&&ArrayBuffer.prototype.slice||function(t,e){e=e||this.byteLength-t;var n=new Uint8Array(this,t,e),r=new Uint8Array(e);return r.set(n),r.buffer},s={jpeg:{65505:[],65517:[]}};function o(n,o,a,l){var c=this;function u(o,u){if(!(e.DataView&&r&&n&&n.size>=12&&"image/jpeg"===n.type))return o(l);var h=a.maxMetaDataSize||262144;t.readFile(r.call(n,0,h),(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return u(new Error("Invalid JPEG file: Missing JPEG marker."));for(var n,r,h,d,p=2,f=e.byteLength-4,m=p;p<f&&((n=e.getUint16(p))>=65504&&n<=65519||65534===n);){if(p+(r=e.getUint16(p+2)+2)>e.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if((h=s.jpeg[n])&&!a.disableMetaDataParsers)for(d=0;d<h.length;d+=1)h[d].call(c,e,p,r,l,a);m=p+=r}!a.disableImageHead&&m>6&&(l.imageHead=i.call(t,0,m)),o(l)}),u,"readAsArrayBuffer")||o(l)}return a=a||{},e.Promise&&"function"!=typeof o?(l=a=o||{},new Promise(u)):(l=l||{},u(o,o))}function a(t,e,n){return t&&e&&n?new Blob([n,r.call(t,e.byteLength)],{type:"image/jpeg"}):null}t.transform=function(r,i,s,a,l){t.requiresMetaData(i)?o(a,(function(o){o!==l&&(e.console&&console.log(o),o=l),n.call(t,r,i,s,a,o)}),i,l=l||{}):n.apply(t,arguments)},t.blobSlice=r,t.bufferSlice=i,t.replaceHead=function(t,n,r){var i={maxMetaDataSize:1024,disableMetaDataParsers:!0};if(!r&&e.Promise)return o(t,i).then((function(e){return a(t,e.imageHead,n)}));o(t,(function(e){r(a(t,e.imageHead,n))}),i)},t.parseMetaData=o,t.metaDataParsers=s}))}(Rlt);!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){var e=t.global;e.fetch&&e.Request&&e.Response&&e.Response.prototype.blob?t.fetchBlob=function(t,n,r){function i(t){return t.blob()}if(e.Promise&&"function"!=typeof n)return fetch(new Request(t,n)).then(i);fetch(new Request(t,r)).then(i).then(n).catch((function(t){n(null,t)}))}:e.XMLHttpRequest&&""===(new XMLHttpRequest).responseType&&(t.fetchBlob=function(t,n,r){function i(e,n){r=r||{};var i=new XMLHttpRequest;i.open(r.method||"GET",t),r.headers&&Object.keys(r.headers).forEach((function(t){i.setRequestHeader(t,r.headers[t])})),i.withCredentials="include"===r.credentials,i.responseType="blob",i.onload=function(){e(i.response)},i.onerror=i.onabort=i.ontimeout=function(t){e===n?n(null,t):n(t)},i.send(r.body)}return e.Promise&&"function"!=typeof n?(r=n,new Promise(i)):i(n,n)})}))}({exports:{}});var Olt={exports:{}};!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){function e(t){t&&(Object.defineProperty(this,"map",{value:this.ifds[t].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[t]||{}}))}e.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965},e.prototype.ifds={ifd1:{name:"Thumbnail",map:e.prototype.map},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},e.prototype.get=function(t){return this[t]||this[this.map[t]]};var n={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,n){return t.getUint16(e,n)},size:2},4:{getValue:function(t,e,n){return t.getUint32(e,n)},size:4},5:{getValue:function(t,e,n){return t.getUint32(e,n)/t.getUint32(e+4,n)},size:8},9:{getValue:function(t,e,n){return t.getInt32(e,n)},size:4},10:{getValue:function(t,e,n){return t.getInt32(e,n)/t.getInt32(e+4,n)},size:8}};function r(t,e,r,i,s,o){var a,l,c,u,h,d,p=n[i];if(p){if(!((l=(a=p.size*s)>4?e+t.getUint32(r+8,o):r+8)+a>t.byteLength)){if(1===s)return p.getValue(t,l,o);for(c=[],u=0;u<s;u+=1)c[u]=p.getValue(t,l+u*p.size,o);if(p.ascii){for(h="",u=0;u<c.length&&"\0"!==(d=c[u]);u+=1)h+=d;return h}return c}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}function i(t,e,n){return(!t||t[n])&&(!e||!0!==e[n])}function s(t,e,n,s,o,a,l,c){var u,h,d,p,f,m;if(n+6>t.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((h=n+2+12*(u=t.getUint16(n,s)))+4>t.byteLength)){for(d=0;d<u;d+=1)p=n+2+12*d,i(l,c,f=t.getUint16(p,s))&&(m=r(t,e,p,t.getUint16(p+2,s),t.getUint32(p+4,s),s),o[f]=m,a&&(a[f]=p));return t.getUint32(h,s)}console.log("Invalid Exif data: Invalid directory size.")}}n[7]=n[1],t.parseExifData=function(n,r,o,a,l){if(!l.disableExif){var c,u,h,d=l.includeExifTags,p=l.excludeExifTags||{34665:{37500:!0}},f=r+10;if(1165519206===n.getUint32(r+4))if(f+8>n.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===n.getUint16(r+8)){switch(n.getUint16(f)){case 18761:c=!0;break;case 19789:c=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===n.getUint16(f+2,c)?(u=n.getUint32(f+4,c),a.exif=new e,l.disableExifOffsets||(a.exifOffsets=new e,a.exifTiffOffset=f,a.exifLittleEndian=c),(u=s(n,f,f+u,c,a.exif,a.exifOffsets,d,p))&&i(d,p,"ifd1")&&(a.exif.ifd1=u,a.exifOffsets&&(a.exifOffsets.ifd1=f+u)),Object.keys(a.exif.ifds).forEach((function(t){!function(t,n,r,i,o,a,l){var c=t.exif[n];c&&(t.exif[n]=new e(n),t.exifOffsets&&(t.exifOffsets[n]=new e(n)),s(r,i,i+c,o,t.exif[n],t.exifOffsets&&t.exifOffsets[n],a&&a[n],l&&l[n]))}(a,t,n,f,c,d,p)})),(h=a.exif.ifd1)&&h[513]&&(h[513]=function(e,n,r){if(r){if(!(n+r>e.byteLength))return new Blob([t.bufferSlice.call(e.buffer,n,n+r)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}}(n,f+h[513],h[514]))):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},t.metaDataParsers.jpeg[65505].push(t.parseExifData),t.exifWriters={274:function(t,e,n){var r=e.exifOffsets[274];return r?(new DataView(t,r+8,2).setUint16(0,n,e.exifLittleEndian),t):t}},t.writeExifData=function(e,n,r,i){return t.exifWriters[n.exif.map[r]](e,n,i)},t.ExifMap=e}))}(Olt);!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){var e=t.ExifMap.prototype;e.tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",34665:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber"},34853:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},40965:{1:"InteroperabilityIndex"}},e.tags.ifd1=e.tags,e.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"Original",2:"Horizontal flip",3:"Rotate 180 CCW",4:"Vertical flip",5:"Vertical flip + Rotate 90 CW",6:"Rotate 90 CW",7:"Horizontal flip + Rotate 90 CW",8:"Rotate 90 CCW"}},e.getText=function(t){var e=this.get(t);switch(t){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[t][e];case"ExifVersion":case"FlashpixVersion":if(!e)return;return String.fromCharCode(e[0],e[1],e[2],e[3]);case"ComponentsConfiguration":if(!e)return;return this.stringValues[t][e[0]]+this.stringValues[t][e[1]]+this.stringValues[t][e[2]]+this.stringValues[t][e[3]];case"GPSVersionID":if(!e)return;return e[0]+"."+e[1]+"."+e[2]+"."+e[3]}return String(e)},e.getAll=function(){var t,e,n,r={};for(t in this)Object.prototype.hasOwnProperty.call(this,t)&&((e=this[t])&&e.getAll?r[this.ifds[t].name]=e.getAll():(n=this.tags[t])&&(r[n]=this.getText(n)));return r},e.getName=function(t){var e=this.tags[t];return"object"==typeof e?this.ifds[t].name:e},function(){var t,n,r,i=e.tags;for(t in i)if(Object.prototype.hasOwnProperty.call(i,t))if(n=e.ifds[t])for(t in r=i[t])Object.prototype.hasOwnProperty.call(r,t)&&(n.map[r[t]]=Number(t));else e.map[i[t]]=Number(t)}()}))}({exports:{}});var Plt={exports:{}};!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){function e(){}function n(t,e,n,r,i){return"binary"===e.types[t]?new Blob([n.buffer.slice(r,r+i)]):"Uint16"===e.types[t]?n.getUint16(r):function(t,e,n){for(var r="",i=e+n,s=e;s<i;s+=1)r+=String.fromCharCode(t.getUint8(s));return r}(n,r,i)}function r(t,e){return void 0===t?e:t instanceof Array?(t.push(e),t):[t,e]}function i(t,e,i,s,o,a){for(var l,c,u,h=e+i,d=e;d<h;)28===t.getUint8(d)&&2===t.getUint8(d+1)&&(u=t.getUint8(d+2),o&&!o[u]||a&&a[u]||(c=t.getInt16(d+3),l=n(u,s.iptc,t,d+5,c),s.iptc[u]=r(s.iptc[u],l),s.iptcOffsets&&(s.iptcOffsets[u]=d))),d+=1}function s(t,e){return 943868237===t.getUint32(e)&&1028===t.getUint16(e+4)}function o(t,e){var n=t.getUint8(e+7);return n%2!=0&&(n+=1),0===n&&(n=4),n}e.prototype.map={ObjectName:5},e.prototype.types={0:"Uint16",200:"Uint16",201:"Uint16",202:"binary"},e.prototype.get=function(t){return this[t]||this[this.map[t]]},t.parseIptcData=function(t,n,r,a,l){if(!l.disableIptc)for(var c=n+r;n+8<c;){if(s(t,n)){var u=o(t,n),h=n+8+u;if(h>c){console.log("Invalid IPTC data: Invalid segment offset.");break}var d=t.getUint16(n+6+u);if(n+d>c){console.log("Invalid IPTC data: Invalid segment size.");break}return a.iptc=new e,l.disableIptcOffsets||(a.iptcOffsets=new e),void i(t,h,d,a,l.includeIptcTags,l.excludeIptcTags||{202:!0})}n+=1}},t.metaDataParsers.jpeg[65517].push(t.parseIptcData),t.IptcMap=e}))}(Plt);!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){var e=t.IptcMap.prototype;e.tags={0:"ApplicationRecordVersion",3:"ObjectTypeReference",4:"ObjectAttributeReference",5:"ObjectName",7:"EditStatus",8:"EditorialUpdate",10:"Urgency",12:"SubjectReference",15:"Category",20:"SupplementalCategories",22:"FixtureIdentifier",25:"Keywords",26:"ContentLocationCode",27:"ContentLocationName",30:"ReleaseDate",35:"ReleaseTime",37:"ExpirationDate",38:"ExpirationTime",40:"SpecialInstructions",42:"ActionAdvised",45:"ReferenceService",47:"ReferenceDate",50:"ReferenceNumber",55:"DateCreated",60:"TimeCreated",62:"DigitalCreationDate",63:"DigitalCreationTime",65:"OriginatingProgram",70:"ProgramVersion",75:"ObjectCycle",80:"Byline",85:"BylineTitle",90:"City",92:"Sublocation",95:"State",100:"CountryCode",101:"Country",103:"OriginalTransmissionReference",105:"Headline",110:"Credit",115:"Source",116:"CopyrightNotice",118:"Contact",120:"Caption",121:"LocalCaption",122:"Writer",125:"RasterizedCaption",130:"ImageType",131:"ImageOrientation",135:"LanguageIdentifier",150:"AudioType",151:"AudioSamplingRate",152:"AudioSamplingResolution",153:"AudioDuration",154:"AudioOutcue",184:"JobID",185:"MasterDocumentID",186:"ShortDocumentID",187:"UniqueDocumentID",188:"OwnerID",200:"ObjectPreviewFileFormat",201:"ObjectPreviewFileVersion",202:"ObjectPreviewData",221:"Prefs",225:"ClassifyState",228:"SimilarityIndex",230:"DocumentNotes",231:"DocumentHistory",232:"ExifCameraInfo",255:"CatalogSets"},e.stringValues={10:{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"},75:{a:"Morning",b:"Both Morning and Evening",p:"Evening"},131:{L:"Landscape",P:"Portrait",S:"Square"}},e.getText=function(t){var e=this.get(t),n=this.map[t],r=this.stringValues[n];return r?r[e]:String(e)},e.getAll=function(){var t,e,n={};for(t in this)Object.prototype.hasOwnProperty.call(this,t)&&(e=this.tags[t])&&(n[e]=this.getText(e));return n},e.getName=function(t){return this.tags[t]},function(){var t,n=e.tags,r=e.map||{};for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[n[t]]=Number(t))}()}))}({exports:{}});!function(t){!function(e){e(t.exports?Nlt.exports:window.loadImage)}((function(t){var e=t.transform,n=t.requiresCanvas,r=t.requiresMetaData,i=t.transformCoordinates,s=t.getTransformedOptions;function o(e,n){var r=e&&e.orientation;return!0===r&&!t.orientation||1===r&&t.orientation||(!n||t.orientation)&&r>1&&r<9}function a(t,e){return t!==e&&(1===t&&e>1&&e<9||t>1&&t<9)}function l(t,e){if(e>1&&e<9)switch(t){case 2:case 4:return e>4;case 5:case 7:return e%2==0;case 6:case 8:return 2===e||4===e||5===e||7===e}return!1}!function(t){if(t.global.document){var e=document.createElement("img");e.onload=function(){if(t.orientation=2===e.width&&3===e.height,t.orientation){var n=t.createCanvas(1,1,!0).getContext("2d");n.drawImage(e,1,1,1,1,0,0,1,1),t.orientationCropBug="255,255,255,255"!==n.getImageData(0,0,1,1).data.toString()}},e.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="}}(t),t.requiresCanvas=function(e){return o(e)||n.call(t,e)},t.requiresMetaData=function(e){return o(e,!0)||r.call(t,e)},t.transform=function(n,r,i,s,o){e.call(t,n,r,(function(e,n){if(n){var r=t.orientation&&n.exif&&n.exif.get("Orientation");if(r>4&&r<9){var s=n.originalWidth,o=n.originalHeight;n.originalWidth=o,n.originalHeight=s}}i(e,n)}),s,o)},t.getTransformedOptions=function(e,n,r){var i=s.call(t,e,n),o=r.exif&&r.exif.get("Orientation"),c=i.orientation,u=t.orientation&&o;if(!0===c&&(c=o),!a(c,u))return i;var h=i.top,d=i.right,p=i.bottom,f=i.left,m={};for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&(m[g]=i[g]);if(m.orientation=c,(c>4&&!(u>4)||c<5&&u>4)&&(m.maxWidth=i.maxHeight,m.maxHeight=i.maxWidth,m.minWidth=i.minHeight,m.minHeight=i.minWidth,m.sourceWidth=i.sourceHeight,m.sourceHeight=i.sourceWidth),u>1){switch(u){case 2:d=i.left,f=i.right;break;case 3:h=i.bottom,d=i.left,p=i.top,f=i.right;break;case 4:h=i.bottom,p=i.top;break;case 5:h=i.left,d=i.bottom,p=i.right,f=i.top;break;case 6:h=i.left,d=i.top,p=i.right,f=i.bottom;break;case 7:h=i.right,d=i.top,p=i.left,f=i.bottom;break;case 8:h=i.right,d=i.bottom,p=i.left,f=i.top}if(l(c,u)){var y=h,b=d;h=p,d=f,p=y,f=b}}switch(m.top=h,m.right=d,m.bottom=p,m.left=f,c){case 2:m.right=f,m.left=d;break;case 3:m.top=p,m.right=f,m.bottom=h,m.left=d;break;case 4:m.top=p,m.bottom=h;break;case 5:m.top=f,m.right=p,m.bottom=d,m.left=h;break;case 6:m.top=d,m.right=p,m.bottom=f,m.left=h;break;case 7:m.top=d,m.right=h,m.bottom=f,m.left=p;break;case 8:m.top=f,m.right=h,m.bottom=d,m.left=p}return m},t.transformCoordinates=function(e,n,r){i.call(t,e,n,r);var s=n.orientation,o=t.orientation&&r.exif&&r.exif.get("Orientation");if(a(s,o)){var c=e.getContext("2d"),u=e.width,h=e.height,d=u,p=h;switch((s>4&&!(o>4)||s<5&&o>4)&&(e.width=h,e.height=u),s>4&&(d=h,p=u),o){case 2:c.translate(d,0),c.scale(-1,1);break;case 3:c.translate(d,p),c.rotate(Math.PI);break;case 4:c.translate(0,p),c.scale(1,-1);break;case 5:c.rotate(-.5*Math.PI),c.scale(-1,1);break;case 6:c.rotate(-.5*Math.PI),c.translate(-d,0);break;case 7:c.rotate(-.5*Math.PI),c.translate(-d,p),c.scale(1,-1);break;case 8:c.rotate(.5*Math.PI),c.translate(0,-p)}switch(l(s,o)&&(c.translate(d,p),c.rotate(Math.PI)),s){case 2:c.translate(u,0),c.scale(-1,1);break;case 3:c.translate(u,h),c.rotate(Math.PI);break;case 4:c.translate(0,h),c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI),c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI),c.translate(0,-h);break;case 7:c.rotate(.5*Math.PI),c.translate(u,-h),c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-u,0)}}}}))}({exports:{}});var Llt,Dlt,Flt=bt(Alt.exports=Nlt.exports);function zlt(t,e,n){const r=t.slice();return r[18]=e[n],r}function Blt(t){let e;return{c(){e=zT("div"),e.innerHTML='<i><svg class="fill-current w-12 h-12 mb-3 text-blue-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.479 10.092c-.212-3.951-3.473-7.092-7.479-7.092-4.005 0-7.267 3.141-7.479 7.092-2.57.463-4.521 2.706-4.521 5.408 0 3.037 2.463 5.5 5.5 5.5h13c3.037 0 5.5-2.463 5.5-5.5 0-2.702-1.951-4.945-4.521-5.408zm-7.479-1.092l4 4h-3v4h-2v-4h-3l4-4z"></path></svg></i> \n      <p class="text-lg text-blue-700">Drop files to upload</p>',GT(e,"class","overlay svelte-u8vb5e")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function Ult(t){let e;return{c(){e=UT("Upload a file")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function Vlt(t){let e,n;return{c(){e=zT("img"),GT(e,"class","mx-auto my-2 w-32"),bT(e.src,n=t[18]||"https://user-images.githubusercontent.com/507615/54591670-ac0a0180-4a65-11e9-846c-e55ffce0fe7b.png")||GT(e,"src",n),GT(e,"alt","no data")},m(t,n){LT(t,e,n)},p(t,r){8&r&&!bT(e.src,n=t[18]||"https://user-images.githubusercontent.com/507615/54591670-ac0a0180-4a65-11e9-846c-e55ffce0fe7b.png")&&GT(e,"src",n)},d(t){t&&DT(e)}}}function jlt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[2]&&Blt();l=new nM({props:{$$slots:{default:[Ult]},$$scope:{ctx:t}}}),l.$on("click",t[8]);let m=t[3],g=[];for(let e=0;e<m.length;e+=1)g[e]=Vlt(zlt(t,m,e));return{c(){f&&f.c(),e=VT(),n=zT("div"),r=zT("div"),i=zT("p"),i.innerHTML="<span>Drag and drop an image or</span>",s=VT(),o=zT("input"),a=VT(),YE(l.$$.fragment),c=VT(),u=zT("div");for(let t=0;t<g.length;t+=1)g[t].c();GT(i,"class","mb-3 font-semibold text-gray-900 flex flex-wrap justify-center"),GT(o,"type","file"),o.multiple=!0,GT(o,"class","hidden"),GT(r,"class","border-dashed border-2 border-gray-300 py-8 flex flex-col justify-center items-center"),GT(u,"class","flex flex-wrap"),GT(n,"class","image-upload svelte-u8vb5e")},m(m,y){f&&f.m(m,y),LT(m,e,y),LT(m,n,y),RT(n,r),RT(r,i),RT(r,s),RT(r,o),t[13](o),RT(r,a),KE(l,r,null),RT(n,c),RT(n,u);for(let t=0;t<g.length;t+=1)g[t].m(u,null);h=!0,d||(p=[WT(n,"dragenter",t[4]),WT(n,"dragleave",t[5]),WT(n,"dragover",t[6]),WT(n,"drop",t[7])],d=!0)},p(t,n){t[2]?f||(f=Blt(),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null);const r={};if(2097152&n&&(r.$$scope={dirty:n,ctx:t}),l.$set(r),8&n){let e;for(m=t[3],e=0;e<m.length;e+=1){const r=zlt(t,m,e);g[e]?g[e].p(r,n):(g[e]=Vlt(r),g[e].c(),g[e].m(u,null))}for(;e<g.length;e+=1)g[e].d(1);g.length=m.length}},i(t){h||(FE(l.$$.fragment,t),h=!0)},o(t){zE(l.$$.fragment,t),h=!1},d(r){f&&f.d(r),r&&DT(e),r&&DT(n),t[13](null),ZE(l),FT(g,r),d=!1,fT(p)}}}function Wlt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[jlt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),2097166&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Hlt(t,e,n){let r,{title:i}=e,{images:s}=e,{thumbnails:o}=e,{width:a}=e,{height:l}=e,c=0,u=!1,h=[];const d=({dataTransfer:{types:t=[]}})=>t.indexOf("Files")>-1;async function p(t){const{image:e}=await Flt(t,{...a>0&&{maxWidth:a},...l>0&&{maxHeight:l},cover:!0,crop:!0,canvas:!0,crossOrigin:"Anonymous"}),{image:n}=await Flt(t,{maxWidth:60,maxHeight:60,cover:!0,crop:!0,canvas:!0,crossOrigin:"Anonymous"}),r=e,i=r.getContext("2d").getImageData(0,0,a||r.width,l||r.height),c=n.toDataURL("image/jpeg");o.set(c),s.set(i)}async function f(t){n(3,h=[]);let e=Promise.resolve();for(let r=0;r<t.length;r++){const i=t[r];i.type.match("image.*")&&(e=e.then((()=>p(i)))),n(2,u=!1),c=0}await e}return hE((async()=>{await kE(),await kE(),r.addEventListener("change",(t=>{f(t.target.files)}))})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"images"in t&&n(9,s=t.images),"thumbnails"in t&&n(10,o=t.thumbnails),"width"in t&&n(11,a=t.width),"height"in t&&n(12,l=t.height)},[i,r,u,h,function(t){t.preventDefault(),d(t)&&(c+=1,n(2,u=!0))},function(){c-=1,c<1&&n(2,u=!1)},function(t){d(t)&&t.preventDefault()},function(t){t.preventDefault(),f(t.dataTransfer.files)},function(){r&&r.click()},s,o,a,l,function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Glt extends QE{constructor(t){super(),JE(this,t,Hlt,Wlt,gT,{title:0,images:9,thumbnails:10,width:11,height:12})}}class qlt extends SU{constructor({width:t=0,height:e=0}={}){super(),this.title="image upload",this.$images=new rU(JD()),this.$thumbnails=new rU(JD()),Llt.set(this,void 0),Dlt.set(this,void 0),HB(this,Llt,t,"f"),HB(this,Dlt,e,"f"),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Glt({target:e,props:{title:this.title,images:this.$images,thumbnails:this.$thumbnails,width:WB(this,Llt,"f"),height:WB(this,Dlt,"f")}}))}}function Xlt(...t){return new qlt(...t)}function Ylt(t,e){let n=0;for(let r=0;r<t.length;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return n}Llt=new WeakMap,Dlt=new WeakMap;const Klt={distanceFunction:Ylt};function Zlt(t,e,n=Klt){const r=n.distanceFunction||Klt.distanceFunction,i=n.similarityFunction||Klt.similarityFunction;let s=-1;if("function"==typeof i){let n=Number.MIN_VALUE;for(let r=0;r<t.length;r++){const o=i(e,t[r]);o>n&&(n=o,s=r)}}else{if("function"!=typeof r)throw new Error("A similarity or distance function it's required");{let n=Number.MAX_VALUE;for(let i=0;i<t.length;i++){const o=r(e,t[i]);o<n&&(n=o,s=i)}}}return s}function Jlt(t,e,n,r){for(var i=0;i<t.length;i++)n[i]=Zlt(e,t[i],{distanceFunction:r});return n}function Qlt(t,e){const n=65535&(t>>>=0);return((t-n)*(e>>>=0)>>>0)+n*e>>>0}class tct{constructor(t=Date.now()){this.state=new Uint32Array(4),this.init(t),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return 5.960464477539063e-8*(this.getUint32()>>>8)}init(t){if(!Number.isInteger(t))throw new TypeError("seed must be an integer");this.state[0]=t,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let t=1;t<8;t++)this.state[3&t]^=t+Qlt(1812433253,this.state[t-1&3]^this.state[t-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let t=0;t<8;t++)this.nextState()}periodCertification(){0===this.state[0]&&0===this.state[1]&&0===this.state[2]&&0===this.state[3]&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let t=this.state[0];t^=t<<15,t^=t>>>18,t^=this.state[3]<<11,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=t}}function ect(t,e={},n=Math.random){const{size:r=1,replace:i=!1,probabilities:s}=e;let o,a;if(o="number"==typeof t?function(t){const e=[];for(let n=0;n<t;n++)e.push(n);return e}(t):t.slice(),s){if(!i)throw new Error("choice with probabilities and no replacement is not implemented");if(s.length!==o.length)throw new Error("the length of probabilities option should be equal to the number of choices");a=[s[0]];for(let t=1;t<s.length;t++)a[t]=a[t-1]+s[t];if(Math.abs(1-a[a.length-1])>1e-8)throw new Error(`probabilities should sum to 1, but instead sums to ${a[a.length-1]}`)}if(!1===i&&r>o.length)throw new Error("size option is too large");const l=[];for(let t=0;t<r;t++){const t=nct(o.length,n,a);l.push(o[t]),i||o.splice(t,1)}return l}function nct(t,e,n){const r=e();if(n){let t=0;for(;r>n[t];)t++;return t}return Math.floor(r*t)}class rct{constructor(t=Math.random){if("number"==typeof t){const e=new tct(t);this.randomGenerator=e.random}else this.randomGenerator=t}choice(t,e){return ect(t,e,this.randomGenerator)}random(){return this.randomGenerator()}randInt(t,e){return void 0===e&&(e=t,t=0),t+Math.floor(this.randomGenerator()*(e-t))}randomSample(t){const e=[];for(let n=0;n<t;n++)e.push(this.random());return e}}const ict=Object.prototype.toString;function sct(t){return ict.call(t).endsWith("Array]")}function oct(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!sct(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]>o&&(o=t[a]);return o}function act(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!sct(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]<o&&(o=t[a]);return o}function lct(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!sct(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!sct(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var r=act(t),i=oct(t);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=n.min,o=void 0===s?n.autoMinMax?r:0:s,a=n.max,l=void 0===a?n.autoMinMax?i:1:a;if(o>=l)throw new RangeError("min option must be smaller than max option");for(var c=(l-o)/(i-r),u=0;u<t.length;u++)e[u]=(t[u]-r)*c+o;return e}const cct=" ".repeat(2),uct=" ".repeat(4);function hct(t,e={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8}=e;return`${t.constructor.name} {\n${cct}[\n${uct}${function(t,e,n,r){const{rows:i,columns:s}=t,o=Math.min(i,e),a=Math.min(s,n),l=[];for(let e=0;e<o;e++){let n=[];for(let i=0;i<a;i++)n.push(dct(t.get(e,i),r));l.push(`${n.join(" ")}`)}a!==s&&(l[l.length-1]+=` ... ${s-n} more columns`);o!==i&&l.push(`... ${i-e} more rows`);return l.join(`\n${uct}`)}(t,n,r,i)}\n${cct}]\n${cct}rows: ${t.rows}\n${cct}columns: ${t.columns}\n}`}function dct(t,e){const n=String(t);if(n.length<=e)return n.padEnd(e," ");const r=t.toPrecision(e-2);if(r.length<=e)return r;const i=t.toExponential(e-2),s=i.indexOf("e"),o=i.slice(s);return i.slice(0,e-o.length)+o}function pct(t,e,n){let r=n?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function fct(t,e,n){let r=n?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function mct(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function gct(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function yct(t,e,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(vct("startRow",e),vct("endRow",n),vct("startColumn",r),vct("endColumn",i),e>n||r>i||e<0||e>=t.rows||n<0||n>=t.rows||r<0||r>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function bct(t,e=0){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function vct(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function xct(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class wct{static from1DArray(t,e,n){if(t*e!==n.length)throw new RangeError("data length does not match given dimensions");let r=new _ct(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++)r.set(i,t,n[i*e+t]);return r}static rowVector(t){let e=new _ct(1,t.length);for(let n=0;n<t.length;n++)e.set(0,n,t[n]);return e}static columnVector(t){let e=new _ct(t.length,1);for(let n=0;n<t.length;n++)e.set(n,0,t[n]);return e}static zeros(t,e){return new _ct(t,e)}static ones(t,e){return new _ct(t,e).fill(1)}static rand(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{random:r=Math.random}=n;let i=new _ct(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r());return i}static randInt(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{min:r=0,max:i=1e3,random:s=Math.random}=n;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(r>=i)throw new RangeError("min must be smaller than max");let o=i-r,a=new _ct(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=r+Math.round(s()*o);a.set(n,t,e)}return a}static eye(t,e,n){void 0===e&&(e=t),void 0===n&&(n=1);let r=Math.min(t,e),i=this.zeros(t,e);for(let t=0;t<r;t++)i.set(t,t,n);return i}static diag(t,e,n){let r=t.length;void 0===e&&(e=r),void 0===n&&(n=e);let i=Math.min(r,e,n),s=this.zeros(e,n);for(let e=0;e<i;e++)s.set(e,e,t[e]);return s}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new _ct(n,r);for(let s=0;s<n;s++)for(let n=0;n<r;n++)i.set(s,n,Math.min(t.get(s,n),e.get(s,n)));return i}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new this(n,r);for(let s=0;s<n;s++)for(let n=0;n<r;n++)i.set(s,n,Math.max(t.get(s,n),e.get(s,n)));return i}static checkMatrix(t){return wct.isMatrix(t)?t:new _ct(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.call(this,e,n);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let n=0;n<this.columns;n++)t[e].push(this.get(e,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);t++}return r}isReducedEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);for(let n=e+1;n<this.rows;n++)0!==this.get(t,n)&&(r=!1);t++}return r}echelonForm(){let t=this.clone(),e=0,n=0;for(;e<t.rows&&n<t.columns;){let r=e;for(let i=e;i<t.rows;i++)t.get(i,n)>t.get(r,n)&&(r=i);if(0===t.get(r,n))n++;else{t.swapRows(e,r);let i=t.get(e,n);for(let r=n;r<t.columns;r++)t.set(e,r,t.get(e,r)/i);for(let r=e+1;r<t.rows;r++){let i=t.get(r,n)/t.get(e,n);t.set(r,n,0);for(let s=n+1;s<t.columns;s++)t.set(r,s,t.get(r,s)-t.get(e,s)*i)}e++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,n=t.rows,r=n-1;for(;r>=0;)if(0===t.maxRow(r))r--;else{let i=0,s=!1;for(;i<n&&!1===s;)1===t.get(r,i)?s=!0:i++;for(let n=0;n<r;n++){let s=t.get(n,i);for(let o=i;o<e;o++){let e=t.get(n,o)-s*t.get(r,o);t.set(n,o,e)}}r--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let r=new _ct(this.rows*e,this.columns*n);for(let t=0;t<e;t++)for(let e=0;e<n;e++)r.setSubMatrix(this,this.rows*t,this.columns*e);return r}fill(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,t);return this}neg(){return this.mulS(-1)}getRow(t){pct(this,t);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}getRowVector(t){return _ct.rowVector(this.getRow(t))}setRow(t,e){pct(this,t),e=mct(this,e);for(let n=0;n<this.columns;n++)this.set(t,n,e[n]);return this}swapRows(t,e){pct(this,t),pct(this,e);for(let n=0;n<this.columns;n++){let r=this.get(t,n);this.set(t,n,this.get(e,n)),this.set(e,n,r)}return this}getColumn(t){fct(this,t);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,t));return e}getColumnVector(t){return _ct.columnVector(this.getColumn(t))}setColumn(t,e){fct(this,t),e=gct(this,e);for(let n=0;n<this.rows;n++)this.set(n,t,e[n]);return this}swapColumns(t,e){fct(this,t),fct(this,e);for(let n=0;n<this.rows;n++){let r=this.get(n,t);this.set(n,t,this.get(n,e)),this.set(n,e,r)}return this}addRowVector(t){t=mct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[n]);return this}subRowVector(t){t=mct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[n]);return this}mulRowVector(t){t=mct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[n]);return this}divRowVector(t){t=mct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[n]);return this}addColumnVector(t){t=gct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[e]);return this}subColumnVector(t){t=gct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[e]);return this}mulColumnVector(t){t=gct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[e]);return this}divColumnVector(t){t=gct(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[e]);return this}mulRow(t,e){pct(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this}mulColumn(t,e){fct(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){xct(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){xct(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}maxRow(t){if(pct(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxRowIndex(t){pct(this,t),xct(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),n[1]=r);return n}minRow(t){if(pct(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minRowIndex(t){pct(this,t),xct(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),n[1]=r);return n}maxColumn(t){if(fct(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t));return e}maxColumnIndex(t){fct(this,t),xct(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t),n[0]=r);return n}minColumn(t){if(fct(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t));return e}minColumnIndex(t){fct(this,t),xct(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t),n[0]=r);return n}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let n=0;n<t;n++)e.push(this.get(n,n));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e+=this.get(t,n)*this.get(t,n);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n),this.set(e,n,t);return this}dot(t){wct.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}mmul(t){t=_ct.checkMatrix(t);let e=this.rows,n=this.columns,r=t.columns,i=new _ct(e,r),s=new Float64Array(n);for(let o=0;o<r;o++){for(let e=0;e<n;e++)s[e]=t.get(e,o);for(let t=0;t<e;t++){let e=0;for(let r=0;r<n;r++)e+=this.get(t,r)*s[r];i.set(t,o,e)}}return i}strassen2x2(t){t=_ct.checkMatrix(t);let e=new _ct(2,2);const n=this.get(0,0),r=t.get(0,0),i=this.get(0,1),s=t.get(0,1),o=this.get(1,0),a=t.get(1,0),l=this.get(1,1),c=t.get(1,1),u=(n+l)*(r+c),h=(o+l)*r,d=n*(s-c),p=l*(a-r),f=(n+i)*c,m=u+p-f+(i-l)*(a+c),g=d+f,y=h+p,b=u-h+d+(o-n)*(r+s);return e.set(0,0,m),e.set(0,1,g),e.set(1,0,y),e.set(1,1,b),e}strassen3x3(t){t=_ct.checkMatrix(t);let e=new _ct(3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),s=this.get(1,0),o=this.get(1,1),a=this.get(1,2),l=this.get(2,0),c=this.get(2,1),u=this.get(2,2),h=t.get(0,0),d=t.get(0,1),p=t.get(0,2),f=t.get(1,0),m=t.get(1,1),g=t.get(1,2),y=t.get(2,0),b=t.get(2,1),v=t.get(2,2),x=(n-s)*(-d+m),w=(-n+s+o)*(h-d+m),S=(s+o)*(-h+d),_=n*h,k=(-n+l+c)*(h-p+g),T=(-n+l)*(p-g),E=(l+c)*(-h+p),M=(-i+c+u)*(m+y-b),C=(i-u)*(m-b),A=i*y,N=(c+u)*(-y+b),I=(-i+o+a)*(g+y-v),$=(i-a)*(g-v),R=(o+a)*(-y+v),O=_+A+r*f,P=(n+r+i-s-o-c-u)*m+w+S+_+M+A+N,L=_+k+E+(n+r+i-o-a-l-c)*g+A+I+R,D=x+o*(-h+d+f-m-g-y+v)+w+_+A+I+$,F=x+w+S+_+a*b,z=A+I+$+R+s*p,B=_+k+T+c*(-h+p+f-m-g-y+b)+M+C+A,U=M+C+A+N+l*d,V=_+k+T+E+u*v;return e.set(0,0,O),e.set(0,1,P),e.set(0,2,L),e.set(1,0,D),e.set(1,1,F),e.set(1,2,z),e.set(2,0,B),e.set(2,1,U),e.set(2,2,V),e}mmulStrassen(t){t=_ct.checkMatrix(t);let e=this.clone(),n=e.rows,r=e.columns,i=t.rows,s=t.columns;function o(t,e,n){let r=t.rows,i=t.columns;if(r===e&&i===n)return t;{let r=wct.zeros(e,n);return r=r.setSubMatrix(t,0,0),r}}r!==i&&console.warn(`Multiplying ${n} x ${r} and ${i} x ${s} matrix: dimensions do not match.`);let a=Math.max(n,i),l=Math.max(r,s);return e=o(e,a,l),function t(e,n,r,i){if(r<=512||i<=512)return e.mmul(n);r%2==1&&i%2==1?(e=o(e,r+1,i+1),n=o(n,r+1,i+1)):r%2==1?(e=o(e,r+1,i),n=o(n,r+1,i)):i%2==1&&(e=o(e,r,i+1),n=o(n,r,i+1));let s=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),l=e.subMatrix(0,s-1,0,a-1),c=n.subMatrix(0,s-1,0,a-1),u=e.subMatrix(0,s-1,a,e.columns-1),h=n.subMatrix(0,s-1,a,n.columns-1),d=e.subMatrix(s,e.rows-1,0,a-1),p=n.subMatrix(s,n.rows-1,0,a-1),f=e.subMatrix(s,e.rows-1,a,e.columns-1),m=n.subMatrix(s,n.rows-1,a,n.columns-1),g=t(wct.add(l,f),wct.add(c,m),s,a),y=t(wct.add(d,f),c,s,a),b=t(l,wct.sub(h,m),s,a),v=t(f,wct.sub(p,c),s,a),x=t(wct.add(l,u),m,s,a),w=t(wct.sub(d,l),wct.add(c,h),s,a),S=t(wct.sub(u,f),wct.add(p,m),s,a),_=wct.add(g,v);_.sub(x),_.add(S);let k=wct.add(b,x),T=wct.add(y,v),E=wct.sub(g,y);E.add(b),E.add(w);let M=wct.zeros(2*_.rows,2*_.columns);return M=M.setSubMatrix(_,0,0),M=M.setSubMatrix(k,_.rows,0),M=M.setSubMatrix(T,0,_.columns),M=M.setSubMatrix(E,_.rows,_.columns),M.subMatrix(0,r-1,0,i-1)}(e,t=o(t,a,l),a,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new _ct(this.rows,this.columns);for(let t=0;t<this.rows;t++){const i=this.getRow(t);i.length>0&&lct(i,{min:e,max:n,output:i}),r.setRow(t,i)}return r}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new _ct(this.rows,this.columns);for(let t=0;t<this.columns;t++){const i=this.getColumn(t);i.length&&lct(i,{min:e,max:n,output:i}),r.setColumn(t,i)}return r}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<t;n++){let t=this.get(e,n),r=this.get(e,this.columns-1-n);this.set(e,n,r),this.set(e,this.columns-1-n,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<t;n++){let t=this.get(n,e),r=this.get(this.rows-1-n,e);this.set(n,e,r),this.set(this.rows-1-n,e,t)}return this}kroneckerProduct(t){t=_ct.checkMatrix(t);let e=this.rows,n=this.columns,r=t.rows,i=t.columns,s=new _ct(e*r,n*i);for(let o=0;o<e;o++)for(let e=0;e<n;e++)for(let n=0;n<r;n++)for(let a=0;a<i;a++)s.set(r*o+n,i*e+a,this.get(o,e)*t.get(n,a));return s}kroneckerSum(t){if(t=_ct.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=t.rows,r=this.kroneckerProduct(_ct.eye(n,n)),i=_ct.eye(e,e).kroneckerProduct(t);return r.add(i)}transpose(){let t=new _ct(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(n,e,this.get(e,n));return t}sortRows(t=Sct){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=Sct){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,n,r){yct(this,t,e,n,r);let i=new _ct(e-t+1,r-n+1);for(let s=t;s<=e;s++)for(let e=n;e<=r;e++)i.set(s-t,e-n,this.get(s,e));return i}subMatrixRow(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let r=new _ct(t.length,n-e+1);for(let i=0;i<t.length;i++)for(let s=e;s<=n;s++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);r.set(i,s-e,this.get(t[i],s))}return r}subMatrixColumn(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let r=new _ct(n-e+1,t.length);for(let i=0;i<t.length;i++)for(let s=e;s<=n;s++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);r.set(s-e,i,this.get(s,t[i]))}return r}setSubMatrix(t,e,n){if((t=_ct.checkMatrix(t)).isEmpty())return this;yct(this,e,e+t.rows-1,n,n+t.columns-1);for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)this.set(e+r,n+i,t.get(r,i));return this}selection(t,e){!function(t,e){if(!sct(e))throw new TypeError("row indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.rows)throw new RangeError("row indices are out of range")}(this,t),function(t,e){if(!sct(e))throw new TypeError("column indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.columns)throw new RangeError("column indices are out of range")}(this,e);let n=new _ct(t.length,e.length);for(let r=0;r<t.length;r++){let i=t[r];for(let t=0;t<e.length;t++){let s=e[t];n.set(r,t,this.get(i,s))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let n=0;n<t;n++)e+=this.get(n,n);return e}clone(){let t=new _ct(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(e,n,this.get(e,n));return t}sum(t){switch(t){case"row":return function(t){let e=bct(t.rows);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]+=t.get(n,r);return e}(this);case"column":return function(t){let e=bct(t.columns);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]+=t.get(n,r);return e}(this);case void 0:return function(t){let e=0;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e+=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=bct(t.rows,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]*=t.get(n,r);return e}(this);case"column":return function(t){let e=bct(t.columns,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]*=t.get(n,r);return e}(this);case void 0:return function(t){let e=1;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e*=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:n=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof n)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!sct(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<r;o++){let r=0,a=0,l=0;for(let e=0;e<i;e++)l=t.get(o,e)-n[o],r+=l,a+=l*l;e?s.push((a-r*r/i)/(i-1)):s.push((a-r*r/i)/i)}return s}(this,n,r);case"column":if(!sct(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<i;o++){let i=0,a=0,l=0;for(let e=0;e<r;e++)l=t.get(e,o)-n[o],i+=l,a+=l*l;e?s.push((a-i*i/r)/(r-1)):s.push((a-i*i/r)/r)}return s}(this,n,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,n){const r=t.rows,i=t.columns,s=r*i;let o=0,a=0,l=0;for(let e=0;e<r;e++)for(let r=0;r<i;r++)l=t.get(e,r)-n,o+=l,a+=l*l;return e?(a-o*o/s)/(s-1):(a-o*o/s)/s}(this,n,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const n=this.variance(t,e);if(void 0===t)return Math.sqrt(n);for(let t=0;t<n.length;t++)n[t]=Math.sqrt(n[t]);return n}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:n=this.mean(t)}=e;switch(t){case"row":if(!sct(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[n])}(this,n),this;case"column":if(!sct(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[r])}(this,n),this;case void 0:if("number"!=typeof n)throw new TypeError("center must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let n=e.scale;switch(t){case"row":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.rows;n++){let r=0;for(let e=0;e<t.columns;e++)r+=Math.pow(t.get(n,e),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}(this);else if(!sct(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[n])}(this,n),this;case"column":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.columns;n++){let r=0;for(let e=0;e<t.rows;e++)r+=Math.pow(t.get(e,n),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}(this);else if(!sct(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[r])}(this,n),this;case void 0:if(void 0===n)n=function(t){const e=t.size-1;let n=0;for(let r=0;r<t.columns;r++)for(let i=0;i<t.rows;i++)n+=Math.pow(t.get(i,r),2)/e;return Math.sqrt(n)}(this);else if("number"!=typeof n)throw new TypeError("scale must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return hct(this,t)}}function Sct(t,e){return t-e}wct.prototype.klass="Matrix","undefined"!=typeof Symbol&&(wct.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return hct(this)}),wct.random=wct.rand,wct.randomInt=wct.randInt,wct.diagonal=wct.diag,wct.prototype.diagonal=wct.prototype.diag,wct.identity=wct.eye,wct.prototype.negate=wct.prototype.neg,wct.prototype.tensorProduct=wct.prototype.kroneckerProduct;class _ct extends wct{constructor(t,e){if(super(),_ct.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let n=0;n<t;n++)this.data.push(new Float64Array(e))}else{if(!sct(t))throw new TypeError("First argument must be a positive number or an array");{const n=t;if("number"!=typeof(e=(t=n.length)?n[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<t;r++){if(n[r].length!==e)throw new RangeError("Inconsistent array dimensions");if(!n[r].every((t=>"number"==typeof t)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[r]))}}}this.rows=t,this.columns=e}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}removeRow(t){return pct(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),pct(this,t,!0),e=Float64Array.from(mct(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){fct(this,t);for(let e=0;e<this.rows;e++){const n=new Float64Array(this.columns-1);for(let r=0;r<t;r++)n[r]=this.data[e][r];for(let r=t+1;r<this.columns;r++)n[r-1]=this.data[e][r];this.data[e]=n}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),fct(this,t,!0),e=gct(this,e);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns+1);let i=0;for(;i<t;i++)r[i]=this.data[n][i];for(r[i++]=e[n];i<this.columns+1;i++)r[i]=this.data[n][i-1];this.data[n]=r}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t.get(e,n));return this},t.add=function(t,n){return new e(t).add(n)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t.get(e,n));return this},t.sub=function(t,n){return new e(t).sub(n)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t.get(e,n));return this},t.mul=function(t,n){return new e(t).mul(n)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t.get(e,n));return this},t.div=function(t,n){return new e(t).div(n)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t.get(e,n));return this},t.mod=function(t,n){return new e(t).mod(n)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t.get(e,n));return this},t.and=function(t,n){return new e(t).and(n)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t.get(e,n));return this},t.or=function(t,n){return new e(t).or(n)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t.get(e,n));return this},t.xor=function(t,n){return new e(t).xor(n)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t.get(e,n));return this},t.leftShift=function(t,n){return new e(t).leftShift(n)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t.get(e,n));return this},t.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t.get(e,n));return this},t.rightShift=function(t,n){return new e(t).rightShift(n)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,n){return new e(t).pow(n)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t.get(e,n)));return this}}(wct,_ct);class kct extends wct{constructor(t,e,n){super(),this.matrix=t,this.rows=e,this.columns=n}}class Tct extends kct{constructor(t){super(t,t.columns,t.rows)}set(t,e,n){return this.matrix.set(e,t,n),this}get(t,e){return this.matrix.get(e,t)}}class Ect extends wct{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}}class Mct{constructor(t){let e,n,r,i,s,o,a,l,c,u=(t=Ect.checkMatrix(t)).clone(),h=u.rows,d=u.columns,p=new Float64Array(h),f=1;for(e=0;e<h;e++)p[e]=e;for(l=new Float64Array(h),n=0;n<d;n++){for(e=0;e<h;e++)l[e]=u.get(e,n);for(e=0;e<h;e++){for(c=Math.min(e,n),s=0,r=0;r<c;r++)s+=u.get(e,r)*l[r];l[e]-=s,u.set(e,n,l[e])}for(i=n,e=n+1;e<h;e++)Math.abs(l[e])>Math.abs(l[i])&&(i=e);if(i!==n){for(r=0;r<d;r++)o=u.get(i,r),u.set(i,r,u.get(n,r)),u.set(n,r,o);a=p[i],p[i]=p[n],p[n]=a,f=-f}if(n<h&&0!==u.get(n,n))for(e=n+1;e<h;e++)u.set(e,n,u.get(e,n)/u.get(n,n))}this.LU=u,this.pivotVector=p,this.pivotSign=f}isSingular(){let t=this.LU,e=t.columns;for(let n=0;n<e;n++)if(0===t.get(n,n))return!0;return!1}solve(t){t=_ct.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n,r,i,s=t.columns,o=t.subMatrixRow(this.pivotVector,0,s-1),a=e.columns;for(i=0;i<a;i++)for(n=i+1;n<a;n++)for(r=0;r<s;r++)o.set(n,r,o.get(n,r)-o.get(i,r)*e.get(n,i));for(i=a-1;i>=0;i--){for(r=0;r<s;r++)o.set(i,r,o.get(i,r)/e.get(i,i));for(n=0;n<i;n++)for(r=0;r<s;r++)o.set(n,r,o.get(n,r)-o.get(i,r)*e.get(n,i))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,n=t.columns;for(let r=0;r<n;r++)e*=t.get(r,r);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new _ct(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i>e?r.set(i,e,t.get(i,e)):i===e?r.set(i,e,1):r.set(i,e,0);return r}get upperTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new _ct(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i<=e?r.set(i,e,t.get(i,e)):r.set(i,e,0);return r}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Cct(t,e){let n=0;return Math.abs(t)>Math.abs(e)?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0!==e?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0}class Act{constructor(t){let e,n,r,i,s=(t=Ect.checkMatrix(t)).clone(),o=t.rows,a=t.columns,l=new Float64Array(a);for(r=0;r<a;r++){let t=0;for(e=r;e<o;e++)t=Cct(t,s.get(e,r));if(0!==t){for(s.get(r,r)<0&&(t=-t),e=r;e<o;e++)s.set(e,r,s.get(e,r)/t);for(s.set(r,r,s.get(r,r)+1),n=r+1;n<a;n++){for(i=0,e=r;e<o;e++)i+=s.get(e,r)*s.get(e,n);for(i=-i/s.get(r,r),e=r;e<o;e++)s.set(e,n,s.get(e,n)+i*s.get(e,r))}}l[r]=-t}this.QR=s,this.Rdiag=l}solve(t){t=_ct.checkMatrix(t);let e=this.QR,n=e.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let r,i,s,o,a=t.columns,l=t.clone(),c=e.columns;for(s=0;s<c;s++)for(i=0;i<a;i++){for(o=0,r=s;r<n;r++)o+=e.get(r,s)*l.get(r,i);for(o=-o/e.get(s,s),r=s;r<n;r++)l.set(r,i,l.get(r,i)+o*e.get(r,s))}for(s=c-1;s>=0;s--){for(i=0;i<a;i++)l.set(s,i,l.get(s,i)/this.Rdiag[s]);for(r=0;r<s;r++)for(i=0;i<a;i++)l.set(r,i,l.get(r,i)-l.get(s,i)*e.get(r,s))}return l.subMatrix(0,c-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,n=this.QR,r=n.columns,i=new _ct(r,r);for(t=0;t<r;t++)for(e=0;e<r;e++)t<e?i.set(t,e,n.get(t,e)):t===e?i.set(t,e,this.Rdiag[t]):i.set(t,e,0);return i}get orthogonalMatrix(){let t,e,n,r,i=this.QR,s=i.rows,o=i.columns,a=new _ct(s,o);for(n=o-1;n>=0;n--){for(t=0;t<s;t++)a.set(t,n,0);for(a.set(n,n,1),e=n;e<o;e++)if(0!==i.get(n,n)){for(r=0,t=n;t<s;t++)r+=i.get(t,n)*a.get(t,e);for(r=-r/i.get(n,n),t=n;t<s;t++)a.set(t,e,a.get(t,e)+r*i.get(t,n))}}return a}}class Nct{constructor(t,e={}){if((t=Ect.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,r=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:s=!0,autoTranspose:o=!1}=e;let a,l=Boolean(i),c=Boolean(s),u=!1;if(n<r)if(o){a=t.transpose(),n=a.rows,r=a.columns,u=!0;let e=l;l=c,c=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let h=Math.min(n,r),d=Math.min(n+1,r),p=new Float64Array(d),f=new _ct(n,h),m=new _ct(r,r),g=new Float64Array(r),y=new Float64Array(n),b=new Float64Array(d);for(let t=0;t<d;t++)b[t]=t;let v=Math.min(n-1,r),x=Math.max(0,Math.min(r-2,n)),w=Math.max(v,x);for(let t=0;t<w;t++){if(t<v){p[t]=0;for(let e=t;e<n;e++)p[t]=Cct(p[t],a.get(e,t));if(0!==p[t]){a.get(t,t)<0&&(p[t]=-p[t]);for(let e=t;e<n;e++)a.set(e,t,a.get(e,t)/p[t]);a.set(t,t,a.get(t,t)+1)}p[t]=-p[t]}for(let e=t+1;e<r;e++){if(t<v&&0!==p[t]){let r=0;for(let i=t;i<n;i++)r+=a.get(i,t)*a.get(i,e);r=-r/a.get(t,t);for(let i=t;i<n;i++)a.set(i,e,a.get(i,e)+r*a.get(i,t))}g[e]=a.get(t,e)}if(l&&t<v)for(let e=t;e<n;e++)f.set(e,t,a.get(e,t));if(t<x){g[t]=0;for(let e=t+1;e<r;e++)g[t]=Cct(g[t],g[e]);if(0!==g[t]){g[t+1]<0&&(g[t]=0-g[t]);for(let e=t+1;e<r;e++)g[e]/=g[t];g[t+1]+=1}if(g[t]=-g[t],t+1<n&&0!==g[t]){for(let e=t+1;e<n;e++)y[e]=0;for(let e=t+1;e<n;e++)for(let n=t+1;n<r;n++)y[e]+=g[n]*a.get(e,n);for(let e=t+1;e<r;e++){let r=-g[e]/g[t+1];for(let i=t+1;i<n;i++)a.set(i,e,a.get(i,e)+r*y[i])}}if(c)for(let e=t+1;e<r;e++)m.set(e,t,g[e])}}let S=Math.min(r,n+1);if(v<r&&(p[v]=a.get(v,v)),n<S&&(p[S-1]=0),x+1<S&&(g[x]=a.get(x,S-1)),g[S-1]=0,l){for(let t=v;t<h;t++){for(let e=0;e<n;e++)f.set(e,t,0);f.set(t,t,1)}for(let t=v-1;t>=0;t--)if(0!==p[t]){for(let e=t+1;e<h;e++){let r=0;for(let i=t;i<n;i++)r+=f.get(i,t)*f.get(i,e);r=-r/f.get(t,t);for(let i=t;i<n;i++)f.set(i,e,f.get(i,e)+r*f.get(i,t))}for(let e=t;e<n;e++)f.set(e,t,-f.get(e,t));f.set(t,t,1+f.get(t,t));for(let e=0;e<t-1;e++)f.set(e,t,0)}else{for(let e=0;e<n;e++)f.set(e,t,0);f.set(t,t,1)}}if(c)for(let t=r-1;t>=0;t--){if(t<x&&0!==g[t])for(let e=t+1;e<r;e++){let n=0;for(let i=t+1;i<r;i++)n+=m.get(i,t)*m.get(i,e);n=-n/m.get(t+1,t);for(let i=t+1;i<r;i++)m.set(i,e,m.get(i,e)+n*m.get(i,t))}for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}let _=S-1,k=Number.EPSILON;for(;S>0;){let t,e;for(t=S-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+k*Math.abs(p[t]+Math.abs(p[t+1]));if(Math.abs(g[t])<=e||Number.isNaN(g[t])){g[t]=0;break}}if(t===S-2)e=4;else{let n;for(n=S-1;n>=t&&n!==t;n--){let e=(n!==S?Math.abs(g[n]):0)+(n!==t+1?Math.abs(g[n-1]):0);if(Math.abs(p[n])<=k*e){p[n]=0;break}}n===t?e=3:n===S-1?e=1:(e=2,t=n)}switch(t++,e){case 1:{let e=g[S-2];g[S-2]=0;for(let n=S-2;n>=t;n--){let i=Cct(p[n],e),s=p[n]/i,o=e/i;if(p[n]=i,n!==t&&(e=-o*g[n-1],g[n-1]=s*g[n-1]),c)for(let t=0;t<r;t++)i=s*m.get(t,n)+o*m.get(t,S-1),m.set(t,S-1,-o*m.get(t,n)+s*m.get(t,S-1)),m.set(t,n,i)}break}case 2:{let e=g[t-1];g[t-1]=0;for(let r=t;r<S;r++){let i=Cct(p[r],e),s=p[r]/i,o=e/i;if(p[r]=i,e=-o*g[r],g[r]=s*g[r],l)for(let e=0;e<n;e++)i=s*f.get(e,r)+o*f.get(e,t-1),f.set(e,t-1,-o*f.get(e,r)+s*f.get(e,t-1)),f.set(e,r,i)}break}case 3:{const e=Math.max(Math.abs(p[S-1]),Math.abs(p[S-2]),Math.abs(g[S-2]),Math.abs(p[t]),Math.abs(g[t])),i=p[S-1]/e,s=p[S-2]/e,o=g[S-2]/e,a=p[t]/e,u=g[t]/e,h=((s+i)*(s-i)+o*o)/2,d=i*o*(i*o);let y=0;0===h&&0===d||(y=h<0?0-Math.sqrt(h*h+d):Math.sqrt(h*h+d),y=d/(h+y));let b=(a+i)*(a-i)+y,v=a*u;for(let e=t;e<S-1;e++){let i=Cct(b,v);0===i&&(i=Number.MIN_VALUE);let s=b/i,o=v/i;if(e!==t&&(g[e-1]=i),b=s*p[e]+o*g[e],g[e]=s*g[e]-o*p[e],v=o*p[e+1],p[e+1]=s*p[e+1],c)for(let t=0;t<r;t++)i=s*m.get(t,e)+o*m.get(t,e+1),m.set(t,e+1,-o*m.get(t,e)+s*m.get(t,e+1)),m.set(t,e,i);if(i=Cct(b,v),0===i&&(i=Number.MIN_VALUE),s=b/i,o=v/i,p[e]=i,b=s*g[e]+o*p[e+1],p[e+1]=-o*g[e]+s*p[e+1],v=o*g[e+1],g[e+1]=s*g[e+1],l&&e<n-1)for(let t=0;t<n;t++)i=s*f.get(t,e)+o*f.get(t,e+1),f.set(t,e+1,-o*f.get(t,e)+s*f.get(t,e+1)),f.set(t,e,i)}g[S-2]=b;break}case 4:if(p[t]<=0&&(p[t]=p[t]<0?-p[t]:0,c))for(let e=0;e<=_;e++)m.set(e,t,-m.get(e,t));for(;t<_&&!(p[t]>=p[t+1]);){let e=p[t];if(p[t]=p[t+1],p[t+1]=e,c&&t<r-1)for(let n=0;n<r;n++)e=m.get(n,t+1),m.set(n,t+1,m.get(n,t)),m.set(n,t,e);if(l&&t<n-1)for(let r=0;r<n;r++)e=f.get(r,t+1),f.set(r,t+1,f.get(r,t)),f.set(r,t,e);t++}S--}}if(u){let t=m;m=f,f=t}this.m=n,this.n=r,this.s=p,this.U=f,this.V=m}solve(t){let e=t,n=this.threshold,r=this.s.length,i=_ct.zeros(r,r);for(let t=0;t<r;t++)Math.abs(this.s[t])<=n?i.set(t,t,0):i.set(t,t,1/this.s[t]);let s=this.U,o=this.rightSingularVectors,a=o.mmul(i),l=o.rows,c=s.rows,u=_ct.zeros(l,c);for(let t=0;t<l;t++)for(let e=0;e<c;e++){let n=0;for(let i=0;i<r;i++)n+=a.get(t,i)*s.get(e,i);u.set(t,e,n)}return u.mmul(e)}solveForDiagonal(t){return this.solve(_ct.diag(t))}inverse(){let t=this.V,e=this.threshold,n=t.rows,r=t.columns,i=new _ct(n,this.s.length);for(let s=0;s<n;s++)for(let n=0;n<r;n++)Math.abs(this.s[n])>e&&i.set(s,n,t.get(s,n)/this.s[n]);let s=this.U,o=s.rows,a=s.columns,l=new _ct(n,o);for(let t=0;t<n;t++)for(let e=0;e<o;e++){let n=0;for(let r=0;r<a;r++)n+=i.get(t,r)*s.get(e,r);l.set(t,e,n)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let r=0,i=n.length;r<i;r++)n[r]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return _ct.diag(this.s)}}function Ict(t,e=!1){return t=Ect.checkMatrix(t),e?new Nct(t).inverse():function(t,e,n=!1){return t=Ect.checkMatrix(t),e=Ect.checkMatrix(e),n?new Nct(t).solve(e):t.isSquare()?new Mct(t).solve(e):new Act(t).solve(e)}(t,_ct.eye(t.rows))}class $ct{constructor(t,e={}){const{assumeSymmetric:n=!1}=e;if(!(t=Ect.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let r,i,s=t.columns,o=new _ct(s,s),a=new Float64Array(s),l=new Float64Array(s),c=t,u=!1;if(u=!!n||t.isSymmetric(),u){for(r=0;r<s;r++)for(i=0;i<s;i++)o.set(r,i,c.get(r,i));!function(t,e,n,r){let i,s,o,a,l,c,u,h;for(l=0;l<t;l++)n[l]=r.get(t-1,l);for(a=t-1;a>0;a--){for(h=0,o=0,c=0;c<a;c++)h+=Math.abs(n[c]);if(0===h)for(e[a]=n[a-1],l=0;l<a;l++)n[l]=r.get(a-1,l),r.set(a,l,0),r.set(l,a,0);else{for(c=0;c<a;c++)n[c]/=h,o+=n[c]*n[c];for(i=n[a-1],s=Math.sqrt(o),i>0&&(s=-s),e[a]=h*s,o-=i*s,n[a-1]=i-s,l=0;l<a;l++)e[l]=0;for(l=0;l<a;l++){for(i=n[l],r.set(l,a,i),s=e[l]+r.get(l,l)*i,c=l+1;c<=a-1;c++)s+=r.get(c,l)*n[c],e[c]+=r.get(c,l)*i;e[l]=s}for(i=0,l=0;l<a;l++)e[l]/=o,i+=e[l]*n[l];for(u=i/(o+o),l=0;l<a;l++)e[l]-=u*n[l];for(l=0;l<a;l++){for(i=n[l],s=e[l],c=l;c<=a-1;c++)r.set(c,l,r.get(c,l)-(i*e[c]+s*n[c]));n[l]=r.get(a-1,l),r.set(a,l,0)}}n[a]=o}for(a=0;a<t-1;a++){if(r.set(t-1,a,r.get(a,a)),r.set(a,a,1),o=n[a+1],0!==o){for(c=0;c<=a;c++)n[c]=r.get(c,a+1)/o;for(l=0;l<=a;l++){for(s=0,c=0;c<=a;c++)s+=r.get(c,a+1)*r.get(c,l);for(c=0;c<=a;c++)r.set(c,l,r.get(c,l)-s*n[c])}}for(c=0;c<=a;c++)r.set(c,a+1,0)}for(l=0;l<t;l++)n[l]=r.get(t-1,l),r.set(t-1,l,0);r.set(t-1,t-1,1),e[0]=0}(s,l,a,o),function(t,e,n,r){let i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v;for(o=1;o<t;o++)e[o-1]=e[o];e[t-1]=0;let x=0,w=0,S=Number.EPSILON;for(c=0;c<t;c++){for(w=Math.max(w,Math.abs(n[c])+Math.abs(e[c])),u=c;u<t&&!(Math.abs(e[u])<=S*w);)u++;if(u>c)do{for(i=n[c],h=(n[c+1]-i)/(2*e[c]),d=Cct(h,1),h<0&&(d=-d),n[c]=e[c]/(h+d),n[c+1]=e[c]*(h+d),p=n[c+1],s=i-n[c],o=c+2;o<t;o++)n[o]-=s;for(x+=s,h=n[u],f=1,m=f,g=f,y=e[c+1],b=0,v=0,o=u-1;o>=c;o--)for(g=m,m=f,v=b,i=f*e[o],s=f*h,d=Cct(h,e[o]),e[o+1]=b*d,b=e[o]/d,f=h/d,h=f*n[o]-b*i,n[o+1]=s+b*(f*i+b*n[o]),l=0;l<t;l++)s=r.get(l,o+1),r.set(l,o+1,b*r.get(l,o)+f*s),r.set(l,o,f*r.get(l,o)-b*s);h=-b*v*g*y*e[c]/p,e[c]=b*h,n[c]=f*h}while(Math.abs(e[c])>S*w);n[c]=n[c]+x,e[c]=0}for(o=0;o<t-1;o++){for(l=o,h=n[o],a=o+1;a<t;a++)n[a]<h&&(l=a,h=n[a]);if(l!==o)for(n[l]=n[o],n[o]=h,a=0;a<t;a++)h=r.get(a,o),r.set(a,o,r.get(a,l)),r.set(a,l,h)}}(s,l,a,o)}else{let t=new _ct(s,s),e=new Float64Array(s);for(i=0;i<s;i++)for(r=0;r<s;r++)t.set(r,i,c.get(r,i));!function(t,e,n,r){let i,s,o,a,l,c,u,h=0,d=t-1;for(c=h+1;c<=d-1;c++){for(u=0,a=c;a<=d;a++)u+=Math.abs(e.get(a,c-1));if(0!==u){for(o=0,a=d;a>=c;a--)n[a]=e.get(a,c-1)/u,o+=n[a]*n[a];for(s=Math.sqrt(o),n[c]>0&&(s=-s),o-=n[c]*s,n[c]=n[c]-s,l=c;l<t;l++){for(i=0,a=d;a>=c;a--)i+=n[a]*e.get(a,l);for(i/=o,a=c;a<=d;a++)e.set(a,l,e.get(a,l)-i*n[a])}for(a=0;a<=d;a++){for(i=0,l=d;l>=c;l--)i+=n[l]*e.get(a,l);for(i/=o,l=c;l<=d;l++)e.set(a,l,e.get(a,l)-i*n[l])}n[c]=u*n[c],e.set(c,c-1,u*s)}}for(a=0;a<t;a++)for(l=0;l<t;l++)r.set(a,l,a===l?1:0);for(c=d-1;c>=h+1;c--)if(0!==e.get(c,c-1)){for(a=c+1;a<=d;a++)n[a]=e.get(a,c-1);for(l=c;l<=d;l++){for(s=0,a=c;a<=d;a++)s+=n[a]*r.get(a,l);for(s=s/n[c]/e.get(c,c-1),a=c;a<=d;a++)r.set(a,l,r.get(a,l)+s*n[a])}}}(s,t,e,o),function(t,e,n,r,i){let s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x=t-1,w=0,S=t-1,_=Number.EPSILON,k=0,T=0,E=0,M=0,C=0,A=0,N=0,I=0;for(s=0;s<t;s++)for((s<w||s>S)&&(n[s]=i.get(s,s),e[s]=0),o=Math.max(s-1,0);o<t;o++)T+=Math.abs(i.get(s,o));for(;x>=w;){for(l=x;l>w&&(A=Math.abs(i.get(l-1,l-1))+Math.abs(i.get(l,l)),0===A&&(A=T),!(Math.abs(i.get(l,l-1))<_*A));)l--;if(l===x)i.set(x,x,i.get(x,x)+k),n[x]=i.get(x,x),e[x]=0,x--,I=0;else if(l===x-1){if(h=i.get(x,x-1)*i.get(x-1,x),E=(i.get(x-1,x-1)-i.get(x,x))/2,M=E*E+h,N=Math.sqrt(Math.abs(M)),i.set(x,x,i.get(x,x)+k),i.set(x-1,x-1,i.get(x-1,x-1)+k),d=i.get(x,x),M>=0){for(N=E>=0?E+N:E-N,n[x-1]=d+N,n[x]=n[x-1],0!==N&&(n[x]=d-h/N),e[x-1]=0,e[x]=0,d=i.get(x,x-1),A=Math.abs(d)+Math.abs(N),E=d/A,M=N/A,C=Math.sqrt(E*E+M*M),E/=C,M/=C,o=x-1;o<t;o++)N=i.get(x-1,o),i.set(x-1,o,M*N+E*i.get(x,o)),i.set(x,o,M*i.get(x,o)-E*N);for(s=0;s<=x;s++)N=i.get(s,x-1),i.set(s,x-1,M*N+E*i.get(s,x)),i.set(s,x,M*i.get(s,x)-E*N);for(s=w;s<=S;s++)N=r.get(s,x-1),r.set(s,x-1,M*N+E*r.get(s,x)),r.set(s,x,M*r.get(s,x)-E*N)}else n[x-1]=d+E,n[x]=d+E,e[x-1]=N,e[x]=-N;x-=2,I=0}else{if(d=i.get(x,x),p=0,h=0,l<x&&(p=i.get(x-1,x-1),h=i.get(x,x-1)*i.get(x-1,x)),10===I){for(k+=d,s=w;s<=x;s++)i.set(s,s,i.get(s,s)-d);A=Math.abs(i.get(x,x-1))+Math.abs(i.get(x-1,x-2)),d=p=.75*A,h=-.4375*A*A}if(30===I&&(A=(p-d)/2,A=A*A+h,A>0)){for(A=Math.sqrt(A),p<d&&(A=-A),A=d-h/((p-d)/2+A),s=w;s<=x;s++)i.set(s,s,i.get(s,s)-A);k+=A,d=p=h=.964}for(I+=1,c=x-2;c>=l&&(N=i.get(c,c),C=d-N,A=p-N,E=(C*A-h)/i.get(c+1,c)+i.get(c,c+1),M=i.get(c+1,c+1)-N-C-A,C=i.get(c+2,c+1),A=Math.abs(E)+Math.abs(M)+Math.abs(C),E/=A,M/=A,C/=A,c!==l)&&!(Math.abs(i.get(c,c-1))*(Math.abs(M)+Math.abs(C))<_*(Math.abs(E)*(Math.abs(i.get(c-1,c-1))+Math.abs(N)+Math.abs(i.get(c+1,c+1)))));)c--;for(s=c+2;s<=x;s++)i.set(s,s-2,0),s>c+2&&i.set(s,s-3,0);for(a=c;a<=x-1&&(b=a!==x-1,a!==c&&(E=i.get(a,a-1),M=i.get(a+1,a-1),C=b?i.get(a+2,a-1):0,d=Math.abs(E)+Math.abs(M)+Math.abs(C),0!==d&&(E/=d,M/=d,C/=d)),0!==d);a++)if(A=Math.sqrt(E*E+M*M+C*C),E<0&&(A=-A),0!==A){for(a!==c?i.set(a,a-1,-A*d):l!==c&&i.set(a,a-1,-i.get(a,a-1)),E+=A,d=E/A,p=M/A,N=C/A,M/=E,C/=E,o=a;o<t;o++)E=i.get(a,o)+M*i.get(a+1,o),b&&(E+=C*i.get(a+2,o),i.set(a+2,o,i.get(a+2,o)-E*N)),i.set(a,o,i.get(a,o)-E*d),i.set(a+1,o,i.get(a+1,o)-E*p);for(s=0;s<=Math.min(x,a+3);s++)E=d*i.get(s,a)+p*i.get(s,a+1),b&&(E+=N*i.get(s,a+2),i.set(s,a+2,i.get(s,a+2)-E*C)),i.set(s,a,i.get(s,a)-E),i.set(s,a+1,i.get(s,a+1)-E*M);for(s=w;s<=S;s++)E=d*r.get(s,a)+p*r.get(s,a+1),b&&(E+=N*r.get(s,a+2),r.set(s,a+2,r.get(s,a+2)-E*C)),r.set(s,a,r.get(s,a)-E),r.set(s,a+1,r.get(s,a+1)-E*M)}}}if(0===T)return;for(x=t-1;x>=0;x--)if(E=n[x],M=e[x],0===M)for(l=x,i.set(x,x,1),s=x-1;s>=0;s--){for(h=i.get(s,s)-E,C=0,o=l;o<=x;o++)C+=i.get(s,o)*i.get(o,x);if(e[s]<0)N=h,A=C;else if(l=s,0===e[s]?i.set(s,x,0!==h?-C/h:-C/(_*T)):(d=i.get(s,s+1),p=i.get(s+1,s),M=(n[s]-E)*(n[s]-E)+e[s]*e[s],u=(d*A-N*C)/M,i.set(s,x,u),i.set(s+1,x,Math.abs(d)>Math.abs(N)?(-C-h*u)/d:(-A-p*u)/N)),u=Math.abs(i.get(s,x)),_*u*u>1)for(o=s;o<=x;o++)i.set(o,x,i.get(o,x)/u)}else if(M<0)for(l=x-1,Math.abs(i.get(x,x-1))>Math.abs(i.get(x-1,x))?(i.set(x-1,x-1,M/i.get(x,x-1)),i.set(x-1,x,-(i.get(x,x)-E)/i.get(x,x-1))):(v=Rct(0,-i.get(x-1,x),i.get(x-1,x-1)-E,M),i.set(x-1,x-1,v[0]),i.set(x-1,x,v[1])),i.set(x,x-1,0),i.set(x,x,1),s=x-2;s>=0;s--){for(f=0,m=0,o=l;o<=x;o++)f+=i.get(s,o)*i.get(o,x-1),m+=i.get(s,o)*i.get(o,x);if(h=i.get(s,s)-E,e[s]<0)N=h,C=f,A=m;else if(l=s,0===e[s]?(v=Rct(-f,-m,h,M),i.set(s,x-1,v[0]),i.set(s,x,v[1])):(d=i.get(s,s+1),p=i.get(s+1,s),g=(n[s]-E)*(n[s]-E)+e[s]*e[s]-M*M,y=2*(n[s]-E)*M,0===g&&0===y&&(g=_*T*(Math.abs(h)+Math.abs(M)+Math.abs(d)+Math.abs(p)+Math.abs(N))),v=Rct(d*C-N*f+M*m,d*A-N*m-M*f,g,y),i.set(s,x-1,v[0]),i.set(s,x,v[1]),Math.abs(d)>Math.abs(N)+Math.abs(M)?(i.set(s+1,x-1,(-f-h*i.get(s,x-1)+M*i.get(s,x))/d),i.set(s+1,x,(-m-h*i.get(s,x)-M*i.get(s,x-1))/d)):(v=Rct(-C-p*i.get(s,x-1),-A-p*i.get(s,x),N,M),i.set(s+1,x-1,v[0]),i.set(s+1,x,v[1]))),u=Math.max(Math.abs(i.get(s,x-1)),Math.abs(i.get(s,x))),_*u*u>1)for(o=s;o<=x;o++)i.set(o,x-1,i.get(o,x-1)/u),i.set(o,x,i.get(o,x)/u)}for(s=0;s<t;s++)if(s<w||s>S)for(o=s;o<t;o++)r.set(s,o,i.get(s,o));for(o=t-1;o>=w;o--)for(s=w;s<=S;s++){for(N=0,a=w;a<=Math.min(o,S);a++)N+=r.get(s,a)*i.get(a,o);r.set(s,o,N)}}(s,l,a,o,t)}this.n=s,this.e=l,this.d=a,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,n=this.n,r=this.e,i=this.d,s=new _ct(n,n);for(t=0;t<n;t++){for(e=0;e<n;e++)s.set(t,e,0);s.set(t,t,i[t]),r[t]>0?s.set(t,t+1,r[t]):r[t]<0&&s.set(t,t-1,r[t])}return s}}function Rct(t,e,n,r){let i,s;return Math.abs(n)>Math.abs(r)?(i=r/n,s=n+i*r,[(t+i*e)/s,(e-i*t)/s]):(i=n/r,s=r+i*n,[(i*t+e)/s,(i*e-t)/s])}class Oct{constructor(t,e={}){t=Ect.checkMatrix(t);let{Y:n}=e;const{scaleScores:r=!1,maxIterations:i=1e3,terminationCriteria:s=1e-10}=e;let o;if(n){if(n=sct(n)&&"number"==typeof n[0]?_ct.columnVector(n):Ect.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");o=n.getColumnVector(0)}else o=t.getColumnVector(0);let a,l,c,u,h=1;for(let e=0;e<i&&h>s;e++)c=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),c=c.div(c.norm()),a=t.mmul(c).div(c.transpose().mmul(c).get(0,0)),e>0&&(h=a.clone().sub(u).pow(2).sum()),u=a.clone(),n?(l=n.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),l=l.div(l.norm()),o=n.mmul(l).div(l.transpose().mmul(l).get(0,0))):o=a;if(n){let e=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0));e=e.div(e.norm());let r=t.clone().sub(a.clone().mmul(e.transpose())),i=o.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),s=n.clone().sub(a.clone().mulS(i.get(0,0)).mmul(l.transpose()));this.t=a,this.p=e.transpose(),this.w=c.transpose(),this.q=l,this.u=o,this.s=a.transpose().mmul(a),this.xResidual=r,this.yResidual=s,this.betas=i}else this.w=c.transpose(),this.s=a.transpose().mmul(a).sqrt(),this.t=r?a.clone().div(this.s.get(0,0)):a,this.xResidual=t.sub(a.mmul(c.transpose()))}}function Pct(t,e){const n=new _ct(t.rows,e.rows);for(let r=0;r<t.rows;r++)for(let i=0;i<e.rows;i++)n.set(r,i,Ylt(t.getRow(r),e.getRow(i)));return n}function Lct(t){let e=[];for(let n=0;n<t;n++)e.push(n);return e}function Dct(t){let e=[t[0]];for(let n=1;n<t.length;n++)e[n]=e[n-1]+t[n];return e}const Fct=Symbol("distance");class zct{constructor(t,e,n,r,i){this.clusters=t,this.centroids=e,this.converged=n,this.iterations=r,this[Fct]=i}nearest(t){const e=new Array(t.length);return Jlt(t,this.centroids.map((function(t){return t.centroid})),e,this[Fct])}computeInformation(t){for(var e=this.centroids.map((function(t){return{centroid:t,error:0,size:0}})),n=0;n<t.length;n++)e[this.clusters[n]].error+=this[Fct](t[n],this.centroids[this.clusters[n]]),e[this.clusters[n]].size++;for(var r=0;r<this.centroids.length;r++)e[r].size?e[r].error/=e[r].size:e[r].error=null;return new zct(this.clusters,e,this.converged,this.iterations,this[Fct])}}const Bct={maxIterations:100,tolerance:1e-6,withIterations:!1,initialization:"kmeans++",distanceFunction:Ylt};function Uct(t,e,n,r,i,s){var o=function(t,e,n,r){const i=e[0].length;for(var s=new Array(r),o=new Array(r),a=0;a<r;a++){s[a]=new Array(i),o[a]=0;for(var l=0;l<i;l++)s[a][l]=0}for(var c=0;c<e.length;c++){o[n[c]]++;for(var u=0;u<i;u++)s[n[c]][u]+=e[c][u]}for(var h=0;h<r;h++)for(var d=0;d<i;d++)o[h]?s[h][d]/=o[h]:s[h][d]=t[h][d];return s}(t,e,n=Jlt(e,t,n,i.distanceFunction),r),a=function(t,e,n,r){for(var i=0;i<t.length;i++)if(n(t[i],e[i])>r)return!1;return!0}(o,t,i.distanceFunction,i.tolerance);return new zct(n,o,a,s,i.distanceFunction)}function Vct(t,e,n){if(n=Object.assign({},Bct,n),e<=0||e>t.length||!Number.isInteger(e))throw new Error("K should be a positive integer smaller than the number of points");var r;if(Array.isArray(n.initialization)){if(n.initialization.length!==e)throw new Error("The initial centers should have the same length as K");r=n.initialization}else switch(n.initialization){case"kmeans++":r=function(t,e,n={}){const r=(t=new _ct(t)).rows,i=new rct(n.seed),s=[],o=n.localTrials||2+Math.floor(Math.log(e)),a=i.randInt(r);s.push(t.getRow(a));let l=new _ct(1,t.rows);for(let e=0;e<t.rows;e++)l.set(0,e,Ylt(t.getRow(e),s[0]));let c=[Dct(l.getRow(0))];const u=1/c[0][r-1];let h=_ct.mul(l,u);for(let n=1;n<e;n++){const e=i.choice(r,{replace:!0,size:o,probabilities:h[0]}),a=Pct(t.selection(e,Lct(t.columns)),t);let u,d,p;for(let t=0;t<o;t++){const n=_ct.min(l,[a.getRow(t)]),r=n.sum();(void 0===u||r<d)&&(u=e[t],d=r,p=n)}s[n]=t.getRow(u),l=p,c=[Dct(l.getRow(0))],h=_ct.mul(l,1/c[0][r-1])}return s}(t,e,n);break;case"random":r=function(t,e,n){return new rct(n).choice(t,{size:e})}(t,e,n.seed);break;case"mostDistant":r=function(t,e,n,r){const i=new rct(r);var s=new Array(e);if(s[0]=Math.floor(i.random()*t.length),e>1){for(var o={dist:-1,index:-1},a=0;a<t.length;++a)n[s[0]][a]>o.dist&&(o.dist=n[s[0]][a],o.index=a);if(s[1]=o.index,e>2)for(var l=2;l<e;++l){for(var c={dist:-1,index:-1},u=0;u<t.length;++u){for(var h={dist:Number.MAX_VALUE,index:-1},d=0;d<l;++d)n[d][u]<h.dist&&-1===s.indexOf(u)&&(h={dist:n[d][u],index:u});h.dist!==Number.MAX_VALUE&&h.dist>c.dist&&(c=Object.assign({},h))}s[l]=c.index}}return s.map((e=>t[e]))}(t,e,function(t,e){for(var n=new Array(t.length),r=0;r<t.length;++r)for(var i=r;i<t.length;++i){n[r]||(n[r]=new Array(t.length)),n[i]||(n[i]=new Array(t.length));const s=e(t[r],t[i]);n[r][i]=s,n[i][r]=s}return n}(t,n.distanceFunction),n.seed);break;default:throw new Error(`Unknown initialization method: "${n.initialization}"`)}0===n.maxIterations&&(n.maxIterations=Number.MAX_VALUE);var i=new Array(t.length);if(n.withIterations)return function*(t,e,n,r,i){for(var s,o=!1,a=0;!o&&a<i.maxIterations;)s=Uct(t,e,n,r,i,++a),yield s.computeInformation(e),o=s.converged,t=s.centroids}(r,t,i,e,n);for(var s,o=!1,a=0;!o&&a<n.maxIterations;)o=(s=Uct(r,t,i,e,n,++a)).converged,r=s.centroids;return s.computeInformation(t)}function jct(t,e){return t.map(((t,n)=>Math.abs(t-e[n])**2)).reduce(((t,e)=>t+e))**.5}class Wct extends MX{constructor({k:t=3}={}){super(),this.title="k-means clustering",this.serviceName="kmeans-models",this.parameters={k:new rU(t,!0)},this.$centers=new rU([],!1),this.$clusters=new rU([],!1),this.dataset=[],this.start()}async train(t){this.$training.set({status:"start",epochs:1});const e=EX(t)?t.items():t;for await(const{x:t}of e)this.dataset.push(t);const n=Vct(this.dataset,this.parameters.k.get());this.$centers.set(n.centroids.map((t=>t.centroid))),this.$clusters.set(n.clusters),this.$training.set({status:"success"})}async predict(t){let e=0,n=1e3;const r={};let i=0;for(let s=0;s<this.$centers.get().length;s++){const o=jct(this.$centers.get()[s],t);o<n&&(n=o,e=s),r[`${s}`]=Math.exp(o),i+=Math.exp(o)}if(Object.entries(r).forEach((([t])=>{r[t]/=i})),0===this.$centers.get().length){const t=new Error("KMeans is not trained");t.name="[KMeans] Prediction Error",hU(t)}return{cluster:e,confidences:r}}async batchPredict(t){const e=[],n=EX(t)?t.items():t;for await(const{x:t}of n)e.push(t);const r=[];for(let t=0;t<e.length;t++)this.predict(e[t]).then((t=>r.push(t)));if(0===this.$centers.get().length){const t=new Error("KMeans is not trained");t.name="[KMeans] Prediction Error",hU(t)}return r}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);Aq(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){return{name:Iq(this.title),files:[],format:"ml-kmeans",metadata:{clusters:this.$clusters.get(),centers:this.$centers.get(),...t}}}async read(t){const e=t.metadata.data;e&&(Object.entries(e).forEach((([t,e])=>{})),this.$clusters.set(t.metadata.labels),this.$training.set({status:"loaded"}))}}function Hct(...t){return new Wct(...t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function Gct(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function qct(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xct(t,e){for(var n=[],r=0;r<t.length;r++)n.push({value:t[r],index:r});n.sort((function(t,e){return e.value-t.value}));var i=new Float32Array(e),s=new Int32Array(e);for(r=0;r<e;r++)i[r]=n[r].value,s[r]=n[r].index;return{values:i,indices:s}}jB([cU],Wct.prototype,"train",null),jB([cU],Wct.prototype,"predict",null),jB([cU],Wct.prototype,"batchPredict",null),Se().prototype.flatten=function(){return this.throwIfDisposed(),Ki(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.norm=function(t,e,n){return this.throwIfDisposed(),so(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),gr(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.as1D=function(){return this.throwIfDisposed(),Ki(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.as2D=function(t,e){return this.throwIfDisposed(),Ki(this,[t,e])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Se().prototype.asType=function(t){return this.throwIfDisposed(),Yn(this,t)};var Yct=function(){function t(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return t.prototype.addExample=function(t,e){var n=this;if(null==this.exampleShape&&(this.exampleShape=t.shape),!f(this.exampleShape,t.shape))throw new Error("Example shape provided, "+t.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),e in this.labelToClassId||(this.labelToClassId[e]=this.nextClassId++),xr((function(){var r=n.normalizeVectorToUnitLength(Ki(t,[t.size])),i=r.shape[0];if(null==n.classDatasetMatrices[e])n.classDatasetMatrices[e]=Ki(r,[1,i]);else{var s=Qi([Ki(n.classDatasetMatrices[e],[n.classExampleCount[e],i]),Ki(r,[1,i])],0);n.classDatasetMatrices[e].dispose(),n.classDatasetMatrices[e]=s}Sr(n.classDatasetMatrices[e]),null==n.classExampleCount[e]&&(n.classExampleCount[e]=0),n.classExampleCount[e]++}))},t.prototype.similarities=function(t){var e=this;return xr((function(){var n,r,i=e.normalizeVectorToUnitLength(Ki(t,[t.size])),s=i.shape[0];if(null==e.trainDatasetMatrix){var o=null;for(var a in e.classDatasetMatrices)n=o,r=e.classDatasetMatrices[a],o=null==n&&null==r?null:null==n?r.clone():null===r?n.clone():Qi([n,r],0);e.trainDatasetMatrix=o}if(null==e.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;Sr(e.trainDatasetMatrix);var l=e.getNumExamples();return Ki(gr(Ki(e.trainDatasetMatrix,[l,s]),Ki(i,[s,1])),[l])}))},t.prototype.predictClass=function(t,e){return void 0===e&&(e=3),Gct(this,void 0,void 0,(function(){var n,r,i,s,o=this;return qct(this,(function(a){switch(a.label){case 0:if(e<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return n=xr((function(){return Yn(o.similarities(t),"float32")})),r=Math.min(e,this.getNumExamples()),s=Xct,[4,n.data()];case 1:return i=s.apply(void 0,[a.sent(),r]).indices,n.dispose(),[2,this.calculateTopClass(i,r)]}}))}))},t.prototype.clearClass=function(t){if(null==this.classDatasetMatrices[t])throw new Error("Cannot clear invalid class "+t);this.classDatasetMatrices[t].dispose(),delete this.classDatasetMatrices[t],delete this.classExampleCount[t],this.clearTrainDatasetMatrix()},t.prototype.clearAllClasses=function(){for(var t in this.classDatasetMatrices)this.clearClass(t)},t.prototype.getClassExampleCount=function(){return this.classExampleCount},t.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},t.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},t.prototype.setClassifierDataset=function(t){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=t,t)this.classExampleCount[e]=t[e].shape[0]},t.prototype.calculateTopClass=function(t,e){var n,r={};if(null==t)return{classIndex:this.labelToClassId[n],label:n,confidences:r};var i={},s=0;for(var o in this.classDatasetMatrices)s+=this.classExampleCount[o],i[o]=s;var a={};for(var o in this.classDatasetMatrices)a[o]=0;for(var l=0;l<t.length;l++){var c=t[l];for(var o in this.classDatasetMatrices)if(c<i[o]){a[o]++;break}}var u=0;for(var o in this.classDatasetMatrices){var h=a[o]/e;h>u&&(u=h,n=o),r[o]=h}return{classIndex:this.labelToClassId[n],label:n,confidences:r}},t.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},t.prototype.normalizeVectorToUnitLength=function(t){return xr((function(){var e=so(t);return wi(t,e)}))},t.prototype.getNumExamples=function(){var t=0;for(var e in this.classDatasetMatrices)t+=this.classExampleCount[e];return t},t.prototype.dispose=function(){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[t].dispose()},t}();class Kct extends MX{constructor({k:t=3}={}){super(),this.title="KNN classifier",this.serviceName="knn-classifier-models",this.classifier=new Yct,this.parameters={k:new rU(t,!0)}}async train(t){this.labels=EX(t)?await t.distinct("y"):this.labels=Array.from(new Set(await t.map((({y:t})=>t)).toArray()));const e=EX(t)?t.items():t;if(this.labels.length<1)throw this.$training.set({status:"error"}),new Error("Cannot train a kNN with no classes");this.$training.set({status:"start",epochs:1}),this.classifier.clearAllClasses();for await(const{x:t,y:n}of e)this.classifier.addExample(rn(t),n);this.$training.set({status:"success"})}async predict(t){if(!this.classifier||!this.labels||this.labels.length<1)return{label:void 0,confidences:{}};const{label:e,confidences:n}=await this.classifier.predictClass(rn(t),this.parameters.k.get());return{label:e,confidences:n}}clear(){delete this.classifier}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);Aq(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){if(!this.classifier)return null;const e=this.classifier.getClassifierDataset(),n={};for(const t of Object.keys(e)){const r=e[t].arraySync();n[t]=r}return{name:Iq(this.title),files:[],format:"knn-classifier",metadata:{labels:this.labels,data:n,...t}}}async read(t){const e=t.metadata.data;if(!e)return;const n={};for(const[t,r]of Object.entries(e))n[t]=xl(r);this.labels=t.metadata.labels,this.classifier.setClassifierDataset(n),this.$training.set({status:"loaded"})}}function Zct(...t){return new Kct(...t)}jB([cU],Kct.prototype,"train",null),jB([cU],Kct.prototype,"predict",null);class Jct extends R3{constructor({layers:t=[64,32],...e}={}){super(e),this.title="MLPClassifier",this.parameters={layers:new rU(t,!0),...this.parameters}}buildModel(t,e){this.model=B0();for(const[e,n]of this.parameters.layers.get().entries()){const r={units:n,activation:"relu"};0===e&&(r.inputDim=t[0]),this.model.add(G2(r))}this.model.add(G2({units:e[0],activation:"softmax"}));const n=uu.adam();this.model.compile({optimizer:n,loss:"categoricalCrossentropy",metrics:["accuracy"]})}}function Qct(...t){return new Jct(...t)}class tut extends $3{constructor({units:t=[64,32],...e}={}){super(e),this.title="MLPRegressor",this.parameters={units:new rU(t,!0),...this.parameters}}async train(t,e){this.transformDataset=t=>t.map((t=>({xs:rn(t.x),ys:rn(t.y)}))),super.train(t,e)}buildModel(t,e){const n=this.parameters.units.get();this.model=B0(),this.model.add(
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(t){return new BZ(t)}({inputShape:t}));for(const t of n)this.model.add(G2({units:t,activation:"relu"}));this.model.add(G2({units:e.length>0?e[0]:1}));const r=uu.adam();this.model.compile({optimizer:r,loss:"meanSquaredError",metrics:[q2]})}async predict(t){return this.model?xr((()=>{const e=this._predict(t).arraySync();return 1===e.length?e[0]:e})):null}}function eut(...t){return new tut(...t)}
/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function nut(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function rut(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var iut={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},sut={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},out={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function aut(t){return void 0===t&&(t={version:1,alpha:1}),nut(this,void 0,void 0,(function(){var e,n,r,i,s,o,a;return rut(this,(function(l){switch(l.label){case 0:if(null==uh)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(r=t.version.toFixed(2),i=t.alpha?t.alpha.toFixed(2):"",s=-1,o=1,null==t.modelUrl){if(!(r in out))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(out));if(!(i in out[r]))throw new Error("MobileNet constructed with invalid alpha "+t.alpha+". Valid multipliers for this version are: "+Object.keys(out[r])+".");e=out[r][i].inputRange,s=e[0],o=e[1]}return null!=t.inputRange&&(n=t.inputRange,s=n[0],o=n[1]),[4,(a=new hut(r,i,t.modelUrl,s,o)).load()];case 1:return l.sent(),[2,a]}}))}))}var lut,cut,uut,hut=function(){function t(t,e,n,r,i){void 0===r&&(r=-1),void 0===i&&(i=1),this.version=t,this.alpha=e,this.modelUrl=n,this.inputMin=r,this.inputMax=i,this.normalizationConstant=(i-r)/255}return t.prototype.load=function(){return nut(this,void 0,void 0,(function(){var t,e,n,r,i=this;return rut(this,(function(s){switch(s.label){case 0:return this.modelUrl?(t=this,[4,jY(this.modelUrl)]):[3,2];case 1:return t.model=s.sent(),[3,4];case 2:return e=out[this.version][this.alpha].url,n=this,[4,jY(e,{fromTFHub:!0})];case 3:n.model=s.sent(),s.label=4;case 4:return[4,(r=xr((function(){return i.model.predict(Go([1,224,224,3]))}))).data()];case 5:return s.sent(),r.dispose(),[2]}}))}))},t.prototype.infer=function(t,e){var n=this;return void 0===e&&(e=!1),xr((function(){t instanceof we||(t=Ur(t));var r=vi(Si(Yn(t,"float32"),n.normalizationConstant),n.inputMin),i=r;224===t.shape[0]&&224===t.shape[1]||(i=Kc.resizeBilinear(r,[224,224],!0));var s,o=Ki(i,[-1,224,224,3]);if(e){var a=sut[n.version],l=n.model.execute(o,a);s=fl(l,[1,2])}else{var c=n.model.predict(o);s=es(c,[0,1],[-1,1e3])}return s}))},t.prototype.classify=function(t,e){return void 0===e&&(e=3),nut(this,void 0,void 0,(function(){var n,r;return rut(this,(function(i){switch(i.label){case 0:return[4,dut(n=this.infer(t),e)];case 1:return r=i.sent(),n.dispose(),[2,r]}}))}))},t}();function dut(t,e){return nut(this,void 0,void 0,(function(){var n,r,i,s,o,a,l;return rut(this,(function(c){switch(c.label){case 0:return[4,(n=al(t)).data()];case 1:for(r=c.sent(),n.dispose(),i=[],l=0;l<r.length;l++)i.push({value:r[l],index:l});for(i.sort((function(t,e){return e.value-t.value})),s=new Float32Array(e),o=new Int32Array(e),l=0;l<e;l++)s[l]=i[l].value,o[l]=i[l].index;for(a=[],l=0;l<o.length;l++)a.push({className:iut[o[l]],probability:s[l]});return[2,a]}}))}))}function put(t){let e,n,r,i,s;return{c(){e=UT("Using Mobilenet v"),n=UT(t[2]),r=UT(" with alpha = "),i=UT(t[3]),s=UT(".")},m(t,o){LT(t,e,o),LT(t,n,o),LT(t,r,o),LT(t,i,o),LT(t,s,o)},p(t,e){4&e&&XT(n,t[2]),8&e&&XT(i,t[3])},d(t){t&&DT(e),t&&DT(n),t&&DT(r),t&&DT(i),t&&DT(s)}}}function fut(t){let e;return{c(){e=UT("")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function mut(t){let e;function n(t,e){return t[4]?fut:put}let r=n(t),i=r(t);return{c(){e=zT("p"),i.c(),GT(e,"class","p-2 text-sm text-gray-600")},m(t,n){LT(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&DT(e),i.d()}}}function gut(t){let e,n;return e=new zL({props:{title:t[0],loading:t[4],$$slots:{default:[mut]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16&n&&(r.loading=t[4]),60&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function yut(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(4,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{version:l}=e,{alpha:c}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"version"in t&&n(2,l=t.version),"alpha"in t&&n(3,c=t.alpha)},[o,a,l,c,r]}class but extends QE{constructor(t){super(),JE(this,t,yut,gut,gT,{title:0,loading:1,version:2,alpha:3})}}class vut extends MX{constructor({version:t=1,alpha:e=1}={}){if(super(),this.title="mobileNet",this.parameters={},this.serviceName="undefined",lut.set(this,void 0),this.$loading=new rU(!0,!0),![1,2].includes(t))throw new Error("Mobilenet version must be 1 or 2");if(![.25,.5,.75,1].includes(e))throw new Error("Mobilenet alpha must be 0.25 | 0.50 | 0.75 | 1.0");this.version=t,this.alpha=e,this.setup()}async setup(){const t=await Vn(),e=Object.keys(t).filter((t=>t.includes("mobileNet")));try{HB(this,lut,await aut({modelUrl:`indexeddb://mobilenet-v${this.version}-${this.alpha}`,version:this.version,alpha:this.alpha}),"f")}catch(t){e.length>0&&await jn(e[0]),HB(this,lut,await aut({version:this.version,alpha:this.alpha}),"f"),await WB(this,lut,"f").model.save(`indexeddb://mobilenet-v${this.version}-${this.alpha}`)}return aU.info(`MobileNet v${this.version} loaded with alpha = ${this.alpha}`),this.$loading.set(!1),this.start(),this}async process(t){return WB(this,lut,"f")?xr((()=>WB(this,lut,"f").infer(t,!0).arraySync()[0])):[]}async predict(t){if(!WB(this,lut,"f"))throw new Error("Mobilenet is not loaded");const e=await WB(this,lut,"f").classify(t,5);return{label:e[0].className,confidences:e.reduce(((t,e)=>({...t,[e.className]:e.probability})),{})}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new but({target:e,props:{title:this.title,loading:this.$loading,version:this.version,alpha:this.alpha}}))}train(){throw new uU("Model `MobileNet` cannot be trained")}save(){throw new Error("MobileNet does not support saving")}load(){throw new Error("MobileNet does not support loading")}download(){throw new Error("MobileNet does not support downloading")}upload(){throw new Error("MobileNet does not support uploading")}}function xut(...t){return new vut(...t)}function wut(t){let e,n,r;function i(e){t[7](e)}let s={type:"text"};return void 0!==t[2]&&(s.value=t[2]),e=new sM({props:s}),bE.push((()=>XE(e,"value",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function Sut(t){let e,n,r;function i(e){t[6](e)}let s={};return void 0!==t[2]&&(s.value=t[2]),e=new NM({props:s}),bE.push((()=>XE(e,"value",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function _ut(t){let e,n,r;function i(e){t[5](e)}let s={};return void 0!==t[2]&&(s.value=t[2]),e=new kM({props:s}),bE.push((()=>XE(e,"value",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function kut(t){let e,n,r;function i(e){t[4](e)}let s={};return void 0!==t[2]&&(s.checked=t[2]),e=new ZM({props:s}),bE.push((()=>XE(e,"checked",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.checked=t[2],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function Tut(t){let e,n,r;function i(e){t[3](e)}let s={options:t[1].options};return void 0!==t[2]&&(s.value=t[2]),e=new GM({props:s}),bE.push((()=>XE(e,"value",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};2&r&&(i.options=t[1].options),!n&&4&r&&(n=!0,i.value=t[2],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function Eut(t){let e,n,r,i,s,o,a,l;const c=[Tut,kut,_ut,Sut,wut],u=[];function h(t,e){return 2&e&&(n=null),3&e&&(r=null),3&e&&(i=null),3&e&&(s=null),null==n&&(n=!!("menu"===t[1].type&&Array.isArray(t[1].options)&&t[1].options.length>0)),n?0:(null==r&&(r=!("boolean"!==t[1].type&&("auto"!==t[1].type||"boolean"!=typeof t[0].get()))),r?1:(null==i&&(i=!("number"!==t[1].type&&("auto"!==t[1].type||"number"!=typeof t[0].get()))),i?2:(null==s&&(s=!!("number array"===t[1].type||"auto"===t[1].type&&Array.isArray(t[0].get())&&t[0].get().length&&"number"==typeof t[0].get()[0])),s?3:4)))}return o=h(t,-1),a=u[o]=c[o](t),{c(){e=zT("div"),a.c(),KT(e,"flex-grow","1")},m(t,n){LT(t,e,n),u[o].m(e,null),l=!0},p(t,[n]){let r=o;o=h(t,n),o===r?u[o].p(t,n):(LE(),zE(u[r],1,1,(()=>{u[r]=null})),DE(),a=u[o],a?a.p(t,n):(a=u[o]=c[o](t),a.c()),FE(a,1),a.m(e,null))},i(t){l||(FE(a),l=!0)},o(t){zE(a),l=!1},d(t){t&&DT(e),u[o].d()}}}function Mut(t,e,n){let r,i=uT,s=()=>(i(),i=vT(o,(t=>n(2,r=t))),o);t.$$.on_destroy.push((()=>i()));let{stream:o}=e;s();let{spec:a}=e;return t.$$set=t=>{"stream"in t&&s(n(0,o=t.stream)),"spec"in t&&n(1,a=t.spec)},[o,a,r,function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)}]}lut=new WeakMap,jB([cU],vut.prototype,"train",null),jB([cU],vut.prototype,"save",null),jB([cU],vut.prototype,"load",null),jB([cU],vut.prototype,"download",null),jB([cU],vut.prototype,"upload",null);class Cut extends QE{constructor(t){super(),JE(this,t,Mut,Eut,gT,{stream:0,spec:1})}}function Aut(t,e,n){const r=t.slice();return r[4]=e[n][0],r[5]=e[n][1],r}function Nut(t){let e,n;return e=new Cut({props:{stream:t[5],spec:{type:"auto"}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.stream=t[5]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Iut(t){let e,n;return e=new Cut({props:{stream:t[5],spec:t[2][t[4]]}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.stream=t[5]),6&n&&(r.spec=t[2][t[4]]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function $ut(t){let e,n,r,i,s,o,a,l,c=t[4]+"";const u=[Iut,Nut],h=[];function d(t,e){return t[4]in t[2]?0:1}return s=d(t),o=h[s]=u[s](t),{c(){e=zT("div"),n=zT("p"),r=UT(c),i=VT(),o.c(),a=VT(),GT(n,"class","w-32 my-2"),GT(e,"class","flex my-1 items-center")},m(t,o){LT(t,e,o),RT(e,n),RT(n,r),RT(e,i),h[s].m(e,null),RT(e,a),l=!0},p(t,n){(!l||2&n)&&c!==(c=t[4]+"")&&XT(r,c);let i=s;s=d(t),s===i?h[s].p(t,n):(LE(),zE(h[i],1,1,(()=>{h[i]=null})),DE(),o=h[s],o?o.p(t,n):(o=h[s]=u[s](t),o.c()),FE(o,1),o.m(e,a))},i(t){l||(FE(o),l=!0)},o(t){zE(o),l=!1},d(t){t&&DT(e),h[s].d()}}}function Rut(t){let e,n,r=Object.entries(t[1]),i=[];for(let e=0;e<r.length;e+=1)i[e]=$ut(Aut(t,r,e));const s=t=>zE(i[t],1,1,(()=>{i[t]=null}));return{c(){e=zT("div");for(let t=0;t<i.length;t+=1)i[t].c();GT(e,"class","m-2")},m(t,r){LT(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,n){if(6&n){let o;for(r=Object.entries(t[1]),o=0;o<r.length;o+=1){const s=Aut(t,r,o);i[o]?(i[o].p(s,n),FE(i[o],1)):(i[o]=$ut(s),i[o].c(),FE(i[o],1),i[o].m(e,null))}for(LE(),o=r.length;o<i.length;o+=1)s(o);DE()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)FE(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)zE(i[t]);n=!1},d(t){t&&DT(e),FT(i,t)}}}function Out(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[Rut]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),262&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Put(t,e,n){let{title:r}=e,{parameters:i}=e,{config:s={}}=e,o=[];return t.$$set=t=>{"title"in t&&n(0,r=t.title),"parameters"in t&&n(1,i=t.parameters),"config"in t&&n(2,s=t.config)},t.$$.update=()=>{if(10&t.$$.dirty){for(const t of o)t();n(3,o=Object.values(i).map((t=>t.subscribe())))}},[r,i,s,o]}class Lut extends QE{constructor(t){super(),JE(this,t,Put,Out,gT,{title:0,parameters:1,config:2})}}class Dut extends SU{constructor(t,e={}){super(),this.title="modelParameters",cut.set(this,void 0),HB(this,cut,t,"f"),this.config=e}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Lut({target:e,props:{title:this.title,parameters:WB(this,cut,"f").parameters,config:this.config}}))}}function Fut(t,e={}){if(!t.parameters)throw new Error("The argument is not a valid component with parameters");return new Dut(t,e)}function zut(t){let e,n,r,i,s;function o(e){t[5](e)}let a={disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new kM({props:a}),bE.push((()=>XE(r,"value",o))),{c(){e=zT("div"),n=zT("div"),YE(r.$$.fragment),GT(n,"class","md:flex md:items-center mb-2"),GT(e,"class","w-full max-w-sm")},m(t,i){LT(t,e,i),RT(e,n),KE(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],EE((()=>i=!1))),r.$set(n)},i(t){s||(FE(r.$$.fragment,t),s=!0)},o(t){zE(r.$$.fragment,t),s=!1},d(t){t&&DT(e),ZE(r)}}}function But(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[zut]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function Uut(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(u,(t=>n(3,r=t))),u),a=uT,l=()=>(a(),a=vT(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}cut=new WeakMap;class Vut extends QE{constructor(t){super(),JE(this,t,Uut,But,gT,{title:0,value:1,disabled:2})}}class jut extends SU{constructor(t){super(),this.title="number",this.$value=new rU(0,!0),this.$disabled=new rU(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Vut({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function Wut(...t){return new jut(...t)}function Hut(t){let e,n,r,i,s;function o(e){t[5](e)}let a={disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new NM({props:a}),bE.push((()=>XE(r,"value",o))),{c(){e=zT("div"),n=zT("div"),YE(r.$$.fragment),GT(n,"class","md:flex md:items-center mb-2"),GT(e,"class","w-full max-w-sm")},m(t,i){LT(t,e,i),RT(e,n),KE(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],EE((()=>i=!1))),r.$set(n)},i(t){s||(FE(r.$$.fragment,t),s=!0)},o(t){zE(r.$$.fragment,t),s=!1},d(t){t&&DT(e),ZE(r)}}}function Gut(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[Hut]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function qut(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(u,(t=>n(3,r=t))),u),a=uT,l=()=>(a(),a=vT(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}class Xut extends QE{constructor(t){super(),JE(this,t,qut,Gut,gT,{title:0,value:1,disabled:2})}}class Yut extends SU{constructor(t){super(),this.title="number array",this.$value=new rU([],!0),this.$disabled=new rU(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Xut({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function Kut(...t){return new Yut(...t)}function Zut(t){let e;return{c(){e=zT("p"),e.textContent="No model loaded"},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function Jut(t){let e,n,r,i;return{c(){e=zT("p"),n=UT("Model Loaded from "),r=UT(t[2]),i=UT(".")},m(t,s){LT(t,e,s),RT(e,n),RT(e,r),RT(e,i)},p(t,e){4&e&&XT(r,t[2])},d(t){t&&DT(e)}}}function Qut(t){let e;return{c(){e=zT("p"),e.textContent="Loading Model..."},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function tht(t){let e;function n(t,e){return"loading"===t[3]?Qut:"loaded"===t[3]?Jut:Zut}let r=n(t),i=r(t);return{c(){e=zT("div"),i.c(),GT(e,"class","p-2 text-sm text-gray-600")},m(t,n){LT(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&DT(e),i.d()}}}function eht(t){let e,n;return e=new zL({props:{title:t[0],loading:"loading"===t[3],$$slots:{default:[tht]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading="loading"===t[3]),268&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function nht(t,e,n){let r,i,s,o=uT,a=()=>(o(),o=vT(d,(t=>n(7,s=t))),d);var l,c,u;t.$$.on_destroy.push((()=>o()));let{title:h}=e,{training:d}=e;return a(),t.$$set=t=>{"title"in t&&n(0,h=t.title),"training"in t&&a(n(1,d=t.training))},t.$$.update=()=>{128&t.$$.dirty&&n(3,r=s.status),240&t.$$.dirty&&n(2,i=(null===n(4,l=s.data)||void 0===l?void 0:l.source)?"datastore"===s.data.source?`datastore at ${null===n(5,c=s.data)||void 0===c?void 0:c.url}`:"url"===s.data.source?`url ${null===n(6,u=s.data)||void 0===u?void 0:u.url}`:"files":"unknown source")},[h,d,i,r,l,c,u,s]}class rht extends QE{constructor(t){super(),JE(this,t,nht,eht,gT,{title:0,training:1})}}function iht(t,e){return t===e}function sht(t,e){return t===e}class oht extends MX{constructor({inputType:t,taskType:e,inputShape:n}){super(),this.title="onnx model",this.parameters={},this.serviceName="onnx-models",this.$loading=new rU(!1,!0),this.$ready=new rU(!1,!0),this.modelName="",this.lockLoading=Promise.resolve(),uut.set(this,void 0),this.inputType=t,this.taskType=e,this.inputShape=n,this.start()}train(){throw new uU("Model `OnnxModel` cannot be trained")}async predict(t){if(!WB(this,uut,"f")||!this.$ready.get())throw new Error("Model is not loaded");const e=this.preprocess(t),n=await WB(this,uut,"f").run({[WB(this,uut,"f").inputNames[0]]:e});return await this.postprocess(n)}async loadFromUrl(t){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{await this.loadModel(t,t),this.$training.set({status:"loaded",data:{source:"url",url:t}}),this.$loading.set(!1),this.$ready.set(!0)}catch(t){throw this.$training.set({status:"error"}),this.$loading.set(!1),t}}async loadFromFile(t){if(t){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{const e=await new Promise(((e,n)=>{const r=new FileReader;r.onload=function(){const t=this.result;e(t)},r.onerror=function(){n()},r.readAsArrayBuffer(t)}));await this.loadModel(e,t.name),this.$training.set({status:"loaded",data:{source:"file"}}),this.$loading.set(!1),this.$ready.set(!0)}catch(t){throw this.$training.set({status:"error"}),this.$loading.set(!1),t}}}async loadModel(t,e){this.ready=!1,this.lockLoading=this.lockLoading.then((()=>ort.InferenceSession.create(t))).then((t=>{HB(this,uut,t,"f")})),await this.lockLoading,this.modelName=e;try{await this.warmup()}catch(t){console.log("ONNX Model warmup failed",t)}this.ready=!0}preprocess(t){if(iht(this.inputType,"image"))return this.preprocessImage(t);if(iht(this.inputType,"generic")){const e=t.flat().flat().flat().flat().flat();return new ort.Tensor("float32",Float32Array.from(e),this.inputShape)}throw new Error("Invalid input data type")}preprocessImage(t){throw new Error("ONNX for Images: Not yet implemented")}async postprocess(t){if(sht(this.taskType,"classification")){const e=this.labels?t=>this.labels[t]:t=>t.toString(),n=Array.from(t.probabilities.data).reduce(((t,n,r)=>({...t,[e(r)]:n})),{});return{label:e(t.label.data[0]),confidences:n}}if(sht(this.taskType,"generic")){const e={};for(const n of WB(this,uut,"f").outputNames)e[n]=Array.from(t[n].data);return e}throw new Error("Invalid output data type")}async warmup(){const t=Float32Array.from(Array(this.inputShape.reduce(((t,e)=>t*e),1)),(()=>Math.random())),e=new ort.Tensor("float32",t,this.inputShape);await WB(this,uut,"f").run({[WB(this,uut,"f").inputNames[0]]:e})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new rht({target:e,props:{title:this.title,training:this.$training}}))}save(){throw new Error("OnnxModel does not support saving")}load(){throw new Error("OnnxModel does not support loading")}download(){throw new Error("OnnxModel does not support downloading")}upload(){throw new Error("OnnxModel does not support uploading")}}function aht(t){return new oht(t)}uut=new WeakMap,jB([cU],oht.prototype,"train",null),jB([cU],oht.prototype,"predict",null),jB([cU],oht.prototype,"loadFromUrl",null),jB([cU],oht.prototype,"loadFromFile",null),jB([cU],oht.prototype,"loadModel",null),jB([cU],oht.prototype,"preprocess",null),jB([cU],oht.prototype,"postprocess",null),jB([cU],oht.prototype,"save",null),jB([cU],oht.prototype,"load",null),jB([cU],oht.prototype,"download",null),jB([cU],oht.prototype,"upload",null);class lht{constructor(t,e={}){if(!0===t){const t=e;return this.center=t.center,this.scale=t.scale,this.means=t.means,this.stdevs=t.stdevs,this.U=_ct.checkMatrix(t.U),this.S=t.S,this.R=t.R,void(this.excludedFeatures=t.excludedFeatures||[])}t=new _ct(t);const{isCovarianceMatrix:n=!1,method:r="SVD",nCompNIPALS:i=2,center:s=!0,scale:o=!1,ignoreZeroVariance:a=!1}=e;if(this.center=s,this.scale=o,this.means=null,this.stdevs=null,this.excludedFeatures=[],n)this._computeFromCovarianceMatrix(t);else switch(this._adjust(t,a),r){case"covarianceMatrix":{const e=new Tct(t).mmul(t).div(t.rows-1);this._computeFromCovarianceMatrix(e);break}case"NIPALS":this._computeWithNIPALS(t,i);break;case"SVD":{const e=new Nct(t,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=e.rightSingularVectors;const n=e.diagonal,r=[];for(const e of n)r.push(e*e/(t.rows-1));this.S=r;break}default:throw new Error(`unknown method: ${r}`)}}static load(t){if("string"!=typeof t.name)throw new TypeError("model must have a name property");if("PCA"!==t.name)throw new RangeError(`invalid model: ${t.name}`);return new lht(!0,t)}predict(t,e={}){const{nComponents:n=this.U.columns}=e;if(t=new _ct(t),this.center&&(t.subRowVector(this.means),this.scale)){for(let e of this.excludedFeatures)t.removeColumn(e);t.divRowVector(this.stdevs)}let r=t.mmul(this.U);return r.subMatrix(0,r.rows-1,0,n-1)}invert(t){let e=(t=_ct.checkMatrix(t)).mmul(this.U.transpose());return this.center&&(this.scale&&e.mulRowVector(this.stdevs),e.addRowVector(this.means)),e}getExplainedVariance(){let t=0;for(const e of this.S)t+=e;return this.S.map((e=>e/t))}getCumulativeVariance(){let t=this.getExplainedVariance();for(let e=1;e<t.length;e++)t[e]+=t[e-1];return t}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map((t=>Math.sqrt(t)))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(t,e){if(this.center){const n=t.mean("column"),r=this.scale?t.standardDeviation("column",{mean:n}):null;if(this.means=n,t.subRowVector(n),this.scale){for(let n=0;n<r.length;n++)if(0===r[n]){if(!e)throw new RangeError(`Cannot scale the dataset (standard deviation is zero at index ${n}`);t.removeColumn(n),r.splice(n,1),this.excludedFeatures.push(n),n--}this.stdevs=r,t.divRowVector(r)}}}_computeFromCovarianceMatrix(t){const e=new $ct(t,{assumeSymmetric:!0});this.U=e.eigenvectorMatrix,this.U.flipRows(),this.S=e.realEigenvalues,this.S.reverse()}_computeWithNIPALS(t,e){this.U=new _ct(e,t.columns),this.S=[];let n=t;for(let t=0;t<e;t++){let e=new Oct(n);this.U.setRow(t,e.w.transpose()),this.S.push(Math.pow(e.s.get(0,0),2)),n=e.xResidual}this.U=this.U.transpose()}}class cht extends MX{constructor(){super(...arguments),this.title="PCA",this.serviceName="pca",this.parameters={}}async train(t){this.$training.set({status:"start",epochs:-1});const e=EX(t)?t.items():t,n=(await e.toArray()).reduce(((t,{x:e})=>t.concat([e])),[]);this.model=new lht(n),this.$training.set({status:"success",data:{explainedVariance:this.model.getExplainedVariance()}})}async predict(t){return this.model?this.model.predict([t]).to2DArray()[0].slice(0,2):null}clear(){this.model=null}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);Aq(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){var e;return{name:Iq(this.title),files:[],format:"ml-pca",metadata:{IPCAModel:null===(e=this.model)||void 0===e?void 0:e.toJSON(),...t}}}async read(t){const e=t.metadata.IPCAModel;e&&(this.model=lht.load(e),this.$training.set({status:"loaded"}))}}function uht(...t){return new cht(...t)}var hht={};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof yt&&yt];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(t,e){if(e)t:{var i=r;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(e=e(s=i[t=t[t.length-1]]))!=s&&null!=e&&n(i,t,{configurable:!0,writable:!0,value:e})}}function s(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function o(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=o(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}i("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+i++,n)}})),i("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<i.length;o++){var a=r[i[o]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return t}));var l,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var u;t:{var h={};try{h.__proto__={a:!0},u=h.a;break t}catch(t){}u=!1}l=u?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var d=l;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,d)d(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ea=e.prototype}function f(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function g(t,e){t.j={U:e,V:!0},t.g=t.m||t.s}function y(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new f,this.h=t}function v(t,e,n,r){try{var i=e.call(t.g.i,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.g.l=!1,i;var s=i.value}catch(e){return t.g.i=null,g(t.g,e),x(t)}return t.g.i=null,r.call(t.g,s),x(t)}function x(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,g(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.V)throw e.U;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function w(t){this.next=function(e){return m(t.g),t.g.i?e=v(t,t.g.i.next,e,t.g.o):(t.g.o(e),e=x(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=v(t,t.g.i.throw,e,t.g.o):(g(t.g,e),e=x(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?v(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),x(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function S(t,e){return e=new w(new b(e)),d&&t.prototype&&d(e,t.prototype),e}f.prototype.o=function(t){this.h=t},f.prototype.return=function(t){this.j={return:t},this.g=this.s};var _="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};i("Object.assign",(function(t){return t||_})),i("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function i(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var s=r.setTimeout;n.prototype.i=function(t){s(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.C),reject:t(this.l)}},e.prototype.C=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.F(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.m(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.G(e,t):this.m(t)},e.prototype.l=function(t){this.s(2,t)},e.prototype.m=function(t){this.s(1,t)},e.prototype.s=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.D(),this.A()},e.prototype.D=function(){var t=this;s((function(){if(t.B()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.B=function(){if(this.o)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.A=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.F=function(t){var e=this.j();t.J(e.resolve,e.reject)},e.prototype.G=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){s(t)}}:e}var i,s,o=new e((function(t,e){i=t,s=e}));return this.J(r(t,i),r(n,s)),o},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.J=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},e.resolve=i,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=o(t),s=r.next();!s.done;s=r.next())i(s.value).J(e,n)}))},e.all=function(t){var n=o(t),r=n.next();return r.done?i([]):new e((function(t,e){function s(e){return function(n){o[e]=n,0==--a&&t(o)}}var o=[],a=0;do{o.push(void 0),a++,i(r.value).J(s(o.length-1),e),r=n.next()}while(!r.done)}))},e})),i("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),i("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var i=n[e];if(i===t||Object.is(i,t))return!0}return!1}})),i("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),i("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(i,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t){return t}))}}));var k=this||self;function T(t,e){t=t.split(".");var n,r=k;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function E(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var M,C,A="undefined"!=typeof TextDecoder,N="undefined"!=typeof TextEncoder;function I(t){if(N)t=(C||(C=new TextEncoder)).encode(t);else{var e=void 0;e=void 0!==e&&e;for(var n=0,r=new Uint8Array(3*t.length),i=0;i<t.length;i++){var s=t.charCodeAt(i);if(128>s)r[n++]=s;else{if(2048>s)r[n++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&i<t.length){var o=t.charCodeAt(++i);if(56320<=o&&57343>=o){s=1024*(s-55296)+o-56320+65536,r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=63&s|128;continue}i--}if(e)throw Error("Found an unpaired surrogate");s=65533}r[n++]=s>>12|224,r[n++]=s>>6&63|128}r[n++]=63&s|128}}t=r.subarray(0,n)}return t}var $={},R=null;function O(t,e){void 0===e&&(e=0),L(),e=$[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",i=0,s=0;i<t.length-2;i+=3){var o=t[i],a=t[i+1],l=t[i+2],c=e[o>>2];o=e[(3&o)<<4|a>>4],a=e[(15&a)<<2|l>>6],l=e[63&l],n[s++]=c+o+a+l}switch(c=0,l=r,t.length-i){case 2:l=e[(15&(c=t[i+1]))<<2]||r;case 1:t=t[i],n[s]=e[t>>2]+e[(3&t)<<4|c>>4]+l+r}return n.join("")}function P(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=R[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}L();for(var r=0;;){var i=n(-1),s=n(0),o=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|s>>4),64!=o&&(e(s<<4&240|o>>2),64!=a&&e(o<<6&192|a))}}(t,(function(t){r[i++]=t})),r.subarray(0,i)}function L(){if(!R){R={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));$[n]=r;for(var i=0;i<r.length;i++){var s=r[i];void 0===R[s]&&(R[s]=i)}}}}var D,F="function"==typeof Uint8Array.prototype.slice;function z(t,e,n){return e===n?D||(D=new Uint8Array(0)):F?t.slice(e,n):new Uint8Array(t.subarray(e,n))}var B=0;function U(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.l=!1,this.v=e,t&&V(this,t)}function V(t,e){e=e.constructor===Uint8Array?e:e.constructor===ArrayBuffer||e.constructor===Array?new Uint8Array(e):e.constructor===String?P(e):e instanceof Uint8Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t.h=e,t.j=0,t.i=t.h.length,t.g=t.j}function j(t){var e=t.h,n=e[t.g],r=127&n;return 128>n?(t.g+=1,r):(r|=(127&(n=e[t.g+1]))<<7,128>n?(t.g+=2,r):(r|=(127&(n=e[t.g+2]))<<14,128>n?(t.g+=3,r):(r|=(127&(n=e[t.g+3]))<<21,128>n?(t.g+=4,r):(r|=(15&(n=e[t.g+4]))<<28,128>n?(t.g+=5,r>>>0):(t.g+=5,128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&t.g++,r)))))}function W(t){var e=t.h[t.g],n=t.h[t.g+1],r=t.h[t.g+2],i=t.h[t.g+3];return t.g+=4,t=2*((n=(e<<0|n<<8|r<<16|i<<24)>>>0)>>31)+1,e=n>>>23&255,n&=8388607,255==e?n?NaN:1/0*t:0==e?t*Math.pow(2,-149)*n:t*Math.pow(2,e-150)*(n+Math.pow(2,23))}U.prototype.reset=function(){this.g=this.j};var H=[];function G(){this.g=new Uint8Array(64),this.h=0}function q(t,e){for(;127<e;)t.push(127&e|128),e>>>=7;t.push(e)}function X(t){var e={},n=void 0!==e.N&&e.N;this.o={v:void 0!==e.v&&e.v},this.N=n,e=this.o,H.length?(n=H.pop(),e&&(n.v=e.v),t&&V(n,t),t=n):t=new U(t,e),this.g=t,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}function Y(t){var e=t.g;if((e=e.g==e.i)||(e=t.j)||(e=(e=t.g).l||0>e.g||e.g>e.i),e)return!1;t.m=t.g.g;var n=7&(e=j(t.g));return 0!=n&&5!=n&&1!=n&&2!=n&&3!=n&&4!=n?(t.j=!0,!1):(t.i=e,t.l=e>>>3,t.h=n,!0)}function K(t){switch(t.h){case 0:if(0!=t.h)K(t);else{for(t=t.g;128&t.h[t.g];)t.g++;t.g++}break;case 1:1!=t.h?K(t):(t=t.g).g+=8;break;case 2:if(2!=t.h)K(t);else{var e=j(t.g);(t=t.g).g+=e}break;case 5:5!=t.h?K(t):(t=t.g).g+=4;break;case 3:for(e=t.l;;){if(!Y(t)){t.j=!0;break}if(4==t.h){t.l!=e&&(t.j=!0);break}K(t)}break;default:t.j=!0}}function Z(t,e,n){var r=t.g.i,i=j(t.g),s=t.g.g+i;if(t.g.i=s,n(e,t),0!==(n=s-t.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+i+" bytes, instead read "+(i-n)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=s,t.g.i=r,e}function J(t){var e,n=j(t.g),r=(t=t.g).g;if(t.g+=n,t=t.h,A)(e=M)||(e=M=new TextDecoder("utf-8",{fatal:!1})),e=e.decode(t.subarray(r,r+n));else{n=r+n;for(var i,s,o,a=[],l=null;r<n;)128>(i=t[r++])?a.push(i):224>i?r>=n?a.push(65533):(s=t[r++],194>i||128!=(192&s)?(r--,a.push(65533)):a.push((31&i)<<6|63&s)):240>i?r>=n-1?a.push(65533):128!=(192&(s=t[r++]))||224===i&&160>s||237===i&&160<=s||128!=(192&(e=t[r++]))?(r--,a.push(65533)):a.push((15&i)<<12|(63&s)<<6|63&e):244>=i?r>=n-2?a.push(65533):128!=(192&(s=t[r++]))||0!=s-144+(i<<28)>>30||128!=(192&(e=t[r++]))||128!=(192&(o=t[r++]))?(r--,a.push(65533)):(i=(7&i)<<18|(63&s)<<12|(63&e)<<6|63&o,i-=65536,a.push(55296+(i>>10&1023),56320+(1023&i))):a.push(65533),8192<=a.length&&(l=E(l,a),a.length=0);e=E(l,a)}return e}function Q(){this.h=[],this.i=0,this.g=new G}function tt(t,e){0!==e.length&&(t.h.push(e),t.i+=e.length)}function et(t){var e=t.i+t.g.length();if(0===e)return new Uint8Array(0);e=new Uint8Array(e);for(var n=t.h,r=n.length,i=0,s=0;s<r;s++){var o=n[s];0!==o.length&&(e.set(o,i),i+=o.length)}return 0!==(r=(n=t.g).h)&&(e.set(n.g.subarray(0,r),i),n.h=0),t.h=[e],e}function nt(t,e,n){if(null!=n){q(t.g,8*e+5),t=t.g;var r=n;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?B=0:(0,B=2147483648):isNaN(r)?(0,B=2147483647):34028234663852886e22<r?(0,B=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,B=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,B=(n<<31|e+127<<23|8388607&r)>>>0),n=B,t.push(n>>>0&255),t.push(n>>>8&255),t.push(n>>>16&255),t.push(n>>>24&255)}}G.prototype.push=function(t){if(!(this.h+1<this.g.length)){var e=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(e)}this.g[this.h++]=t},G.prototype.length=function(){return this.h},G.prototype.end=function(){var t=this.g,e=this.h;return this.h=0,z(t,0,e)},X.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};var rt="function"==typeof Uint8Array;function it(t,e,n){if(null!=t)return"object"==typeof t?rt&&t instanceof Uint8Array?n(t):st(t,e,n):e(t)}function st(t,e,n){if(Array.isArray(t)){for(var r=Array(t.length),i=0;i<t.length;i++)r[i]=it(t[i],e,n);return Array.isArray(t)&&t.W&&ct(r),r}for(i in r={},t)r[i]=it(t[i],e,n);return r}function ot(t){return"number"==typeof t?isFinite(t)?t:String(t):t}var at,lt={W:{value:!0,configurable:!0}};function ct(t){return Array.isArray(t)&&!Object.isFrozen(t)&&Object.defineProperties(t,lt),t}function ut(t,e,n){var r=at;if(at=null,t||(t=r),r=this.constructor.ca,t||(t=r?[r]:[]),this.j=r?0:-1,this.i=null,this.g=t,t=(r=this.g.length)-1,!r||(null===(r=this.g[t])||"object"!=typeof r||Array.isArray(r)||rt&&r instanceof Uint8Array)?void 0!==e&&-1<e?(this.l=Math.max(e,t+1-this.j),this.h=null):this.l=Number.MAX_VALUE:(this.l=t-this.j,this.h=r),n)for(e=0;e<n.length;e++)(t=n[e])<this.l?(t+=this.j,(r=this.g[t])?ct(r):this.g[t]=ht):(dt(this),(r=this.h[t])?ct(r):this.h[t]=ht)}var ht=Object.freeze(ct([]));function dt(t){var e=t.l+t.j;t.g[e]||(t.h=t.g[e]={})}function pt(t,e,n){return-1===e?null:void 0!==n&&n||e>=t.l?t.h?t.h[e]:void 0:t.g[e+t.j]}function ft(t){var e=void 0!==e&&e,n=pt(t,1,e);return null==n&&(n=ht),n===ht&&gt(t,1,n=ct([]),e),n}function mt(t,e,n){return null==(t=null==(t=pt(t,e))?t:+t)?void 0===n?0:n:t}function gt(t,e,n,r){void 0!==r&&r||e>=t.l?(dt(t),t.h[e]=n):t.g[e+t.j]=n}function bt(t,e){t.i||(t.i={});var n=t.i[1];if(!n){var r=ft(t);n=[];for(var i=0;i<r.length;i++)n[i]=new e(r[i]);t.i[1]=n}return n}function vt(t,e,n,r){var i=bt(t,n);e=e||new n,t=ft(t),null!=r?(i.splice(r,0,e),t.splice(r,0,xt(e))):(i.push(e),t.push(xt(e)))}function xt(t,e){if(t.i)for(var n in t.i){var r=t.i[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)r[i]&&xt(r[i]);else r&&xt(r)}return t.g}function wt(t,e){return null==(t=pt(t,e))?0:t}function St(t,e){return null==(t=pt(t,e))?"":t}function _t(t,e){if(t=t.m){tt(e,e.g.end());for(var n=0;n<t.length;n++)tt(e,t[n])}}function kt(t,e){if(4==e.h)return!1;var n=e.m;return K(e),e.N||(e=z(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e]),!0}function Tt(t,e){var n=void 0;return new(n||(n=Promise))((function(r,i){function s(t){try{a(e.next(t))}catch(t){i(t)}}function o(t){try{a(e.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(s,o)}a((e=e.apply(t,void 0)).next())}))}function Et(t){ut.call(this,t)}function Mt(t,e){for(;Y(e);)switch(e.i){case 8:var n=j(e.g);gt(t,1,n);break;case 21:gt(t,2,n=W(e.g));break;case 26:gt(t,3,n=J(e));break;case 34:gt(t,4,n=J(e));break;default:if(!kt(t,e))return t}return t}function Ct(t){ut.call(this,t,-1,At)}ut.prototype.toJSON=function(){return st(xt(this),ot,O)},ut.prototype.toString=function(){return xt(this).toString()},p(Et,ut),p(Ct,ut),Ct.prototype.addClassification=function(t,e){return vt(this,t,Et,e),this};var At=[1];function Nt(t){ut.call(this,t)}function It(t,e){for(;Y(e);)switch(e.i){case 13:var n=W(e.g);gt(t,1,n);break;case 21:gt(t,2,n=W(e.g));break;case 29:gt(t,3,n=W(e.g));break;case 37:gt(t,4,n=W(e.g));break;case 45:gt(t,5,n=W(e.g));break;default:if(!kt(t,e))return t}return t}function $t(t){ut.call(this,t,-1,Rt)}p(Nt,ut),p($t,ut);var Rt=[1];function Ot(t){ut.call(this,t)}function Pt(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Lt(t){return bt(t,Et).map((function(t){return{index:wt(t,1),Y:mt(t,2),label:null!=pt(t,3)?St(t,3):void 0,displayName:null!=pt(t,4)?St(t,4):void 0}}))}function Dt(t){return{x:mt(t,1),y:mt(t,2),z:mt(t,3),visibility:null!=pt(t,4)?mt(t,4):void 0}}function Ft(t){t:{var e=new $t;for(t=new X(t);Y(t);)if(10===t.i){vt(e,Z(t,new Nt,It),Nt,void 0)}else if(!kt(e,t))break t}return bt(e,Nt).map(Dt)}function zt(t,e){this.h=t,this.g=e,this.l=0}function Bt(t,e,n){return function(t,e){var n=t.g;if(void 0===t.m){var r=Pt(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),i=Pt(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),s=n.createProgram();if(n.attachShader(s,r),n.attachShader(s,i),n.linkProgram(s),!n.getProgramParameter(s,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(s));r=t.m=s,n.useProgram(r),i=n.getUniformLocation(r,"sampler0"),t.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:i},t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.I),n.vertexAttribPointer(t.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.enableVertexAttribArray(t.j.H),n.vertexAttribPointer(t.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(i,0)}r=t.j,n.useProgram(t.m),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Ut(t){this.g=t}p(Ot,ut);var Vt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function jt(t,e){return e+t}function Wt(t,e){window[t]=e}function Ht(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||jt,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=e,t.options)for(var n=(e=o(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Gt(t){return Tt(t,(function t(){var e,n,r,i,s,o,l,c,u,h,d,p=this;return S(t,(function(t){switch(t.g){case 1:return e=p,p.R?(n=function(t,e){return void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(e):t.g.files}(p,p.j),y(t,function(){return Tt(this,(function t(){return S(t,(function(t){switch(t.g){case 1:return t.m=2,y(t,WebAssembly.instantiate(Vt),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}}))}))}(),2)):t.return();case 2:if(r=t.h,"object"==typeof window)return Wt("createMediapipeSolutionsWasm",{locateFile:p.locateFile}),Wt("createMediapipeSolutionsPackedAssets",{locateFile:p.locateFile}),o=n.filter((function(t){return void 0!==t.data})),l=n.filter((function(t){return void 0===t.data})),c=Promise.all(o.map((function(t){var n=qt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),u=Promise.all(l.map((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){return Tt(e,(function t(){var e,n,r=this;return S(t,(function(t){if(1==t.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,y(t,e(n),2);r.h=t.h,t.g=0}))}))})),h=Tt(e,(function t(){var e=this;return S(t,(function(t){return e.g.graph&&e.g.graph.url?t=y(t,qt(e,e.g.graph.url),0):(t.g=0,t=void 0),t}))})),y(t,Promise.all([u,c,h]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return i=n.filter((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,a(i)),y(t,createMediapipeSolutionsWasm(Module),6);case 6:p.h=t.h,p.l=new OffscreenCanvas(1,1),p.h.canvas=p.l,s=p.h.GL.createContext(p.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),p.h.GL.makeContextCurrent(s),t.g=4;break;case 7:if(p.l=document.createElement("canvas"),!(d=p.l.getContext("webgl2",{}))&&!(d=p.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),t.return();p.D=d,p.h.canvas=p.l,p.h.createContext(p.l,!0,!0,{});case 4:p.i=new p.h.SolutionWasm,p.R=!1,t.g=0}}))}))}function qt(t,e){return Tt(t,(function t(){var n,r,i=this;return S(t,(function(t){return e in i.F?t.return(i.F[e]):(n=i.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),i.F[e]=r,t.return(r))}))}))}function Xt(t,e,n){return Tt(t,(function t(){var r,i,s,a,l,c,u,h,d,p,f,m,g,b,v=this;return S(t,(function(t){switch(t.g){case 1:if(!n)return t.return(e);for(r={},i=0,s=o(Object.keys(n)),a=s.next();!a.done;a=s.next())l=a.value,"string"!=typeof(c=n[l])&&"texture"===c.type&&void 0!==e[c.stream]&&++i;1<i&&(v.G=!1),u=o(Object.keys(n)),a=u.next();case 2:if(a.done){t.g=4;break}if(h=a.value,"string"==typeof(d=n[h]))return g=r,b=h,y(t,function(t,e,n){return Tt(t,(function t(){var r,i=this;return S(t,(function(t){return"number"==typeof n||n instanceof Uint8Array||n instanceof i.h.Uint8BlobList?t.return(n):n instanceof i.h.Texture2dDataOut?((r=i.s[e])||(r=new zt(i.h,i.D),i.s[e]=r),t.return(Bt(r,n,i.G))):t.return(void 0)}))}))}(v,h,e[d]),14);if(p=e[d.stream],"detection_list"===d.type){if(p){for(var x=p.getRectList(),w=p.getLandmarksList(),_=p.getClassificationsList(),k=[],T=0;T<x.size();++T){var E=x.get(T);t:{var M=new Ot;for(E=new X(E);Y(E);)switch(E.i){case 13:var C=W(E.g);gt(M,1,C);break;case 21:gt(M,2,C=W(E.g));break;case 29:gt(M,3,C=W(E.g));break;case 37:gt(M,4,C=W(E.g));break;case 45:gt(M,5,C=W(E.g));break;case 48:for(var A=E.g,N=128,I=0,$=C=0;4>$&&128<=N;$++)I|=(127&(N=A.h[A.g++]))<<7*$;if(128<=N&&(I|=(127&(N=A.h[A.g++]))<<28,C|=(127&N)>>4),128<=N)for($=0;5>$&&128<=N;$++)C|=(127&(N=A.h[A.g++]))<<7*$+3;128>N?(A=I>>>0,(C=2147483648&(N=C>>>0))&&(N=~N>>>0,0==(A=1+~A>>>0)&&(N=N+1>>>0)),A=4294967296*N+(A>>>0),C=C?-A:A):(A.l=!0,C=void 0),gt(M,6,C);break;default:if(!kt(M,E))break t}}M={Z:mt(M,1),$:mt(M,2),height:mt(M,3),width:mt(M,4),rotation:mt(M,5,0),X:wt(M,6)},E=Ft(w.get(T)),A=_.get(T);t:for(C=new Ct,A=new X(A);Y(A);)if(10===A.i)C.addClassification(Z(A,new Et,Mt));else if(!kt(C,A))break t;M={T:M,O:E,M:Lt(C)},k.push(M)}x=k}else x=[];r[h]=x,t.g=7;break}if("proto_list"===d.type){if(p){for(x=Array(p.size()),w=0;w<p.size();w++)x[w]=p.get(w);p.delete()}else x=[];r[h]=x,t.g=7;break}if(void 0===p){t.g=3;break}if("float_list"===d.type){r[h]=p,t.g=7;break}if("proto"===d.type){r[h]=p,t.g=7;break}if("texture"!==d.type)throw Error("Unknown output config type: '"+d.type+"'");return(f=v.s[h])||(f=new zt(v.h,v.D),v.s[h]=f),y(t,Bt(f,p,v.G),13);case 13:m=t.h,r[h]=m;case 7:d.transform&&r[h]&&(r[h]=d.transform(r[h])),t.g=3;break;case 14:g[b]=t.h;case 3:a=u.next(),t.g=2;break;case 4:return t.return(r)}}))}))}function Yt(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),i=new t.h.StringList,s=o(e.wants),l=s.next();!l.done;l=s.next())i.push_back(l.value);s=t.h.PacketListener.implement({onResults:function(i){for(var s={},o=0;o<e.wants.length;++o)s[r[o]]=i.get(o);var a=t.listeners[n];a&&(t.C=Xt(t,s,e.outs).then((function(n){n=a(n);for(var i=0;i<e.wants.length;++i){var o=s[r[i]];"object"==typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}n&&(t.C=n)})))}}),t.i.attachMultiListener(i,s),i.delete()}function Kt(t){switch(void 0===t&&(t=0),t){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Zt(t){var e=this;t=t||{},this.g=new Ht({locateFile:t.locateFile,files:function(t){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:Kt(t.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Ft},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Ft},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){return Tt(e,(function e(){var n,r,i,s=this;return S(e,(function(e){return 1==e.g?(n=Kt(t),r="third_party/mediapipe/modules/pose_landmark/"+n,y(e,qt(s.g,n),2)):(i=e.h,s.g.overrideFile(r,i),e.return(!0))}))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=Ht.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){return Tt(this,(function t(){var e=this;return S(t,(function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],i=[],s={},a=o(Object.keys(t)),l=a.next();!l.done;s={K:s.K,L:s.L},l=a.next()){var c=l.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(l=e[c])&&(l.onChange&&(s.K=l.onChange,s.L=t[c],r.push(function(t){return function(){return Tt(n,(function e(){var n=this;return S(e,(function(e){if(1==e.g)return y(e,t.K(t.L),2);!0===e.h&&(n.o=!0),e.g=0}))}))}}(s))),l.graphOptionXref&&(c={valueNumber:1===l.type?t[c]:0,valueBoolean:0===l.type&&t[c],valueString:2===l.type?t[c]:""},l=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),l.graphOptionXref),c),i.push(l))))}0===r.length&&0===i.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(i),this.u=(void 0===this.u?[]:this.u).concat(r))}},t.initialize=function(){return Tt(this,(function t(){var e=this;return S(t,(function(t){return 1==t.g?y(t,Gt(e),2):3!=t.g?y(t,Tt(e,(function t(){var e,n,r,i,s,a,l,c,u=this;return S(t,(function(t){if(1==t.g)return u.g.graph&&u.g.graph.url&&u.P===u.g.graph.url?t.return():(u.o=!0,u.g.graph&&u.g.graph.url?(u.P=u.g.graph.url,y(t,qt(u,u.g.graph.url),3)):void(t.g=2));for(2!=t.g&&(e=t.h,u.i.loadGraph(e)),n=o(Object.keys(u.B)),r=n.next();!r.done;r=n.next())i=r.value,u.i.overrideFile(i,u.B[i]);if(u.B={},u.g.listeners)for(s=o(u.g.listeners),a=s.next();!a.done;a=s.next())l=a.value,Yt(u,l);c=u.j,u.j={},u.setOptions(c),t.g=0}))})),3):y(t,function(t){return Tt(t,(function t(){var e,n,r,i,s,a,l=this;return S(t,(function(t){switch(t.g){case 1:if(!l.o)return t.return();if(!l.u){t.g=2;break}e=o(l.u),n=e.next();case 3:if(n.done){t.g=5;break}return y(t,(0,n.value)(),4);case 4:n=e.next(),t.g=3;break;case 5:l.u=void 0;case 2:if(l.A){for(r=new l.h.GraphOptionChangeRequestList,i=o(l.A),s=i.next();!s.done;s=i.next())a=s.value,r.push_back(a);l.i.changeOptions(r),r.delete(),l.A=void 0}l.o=!1,t.g=0}}))}))}(e),0)}))}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.B[t]=e},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){return Tt(this,(function n(){var r,i,s,a,l,c,u,h,d,p=this;return S(n,(function(n){switch(n.g){case 1:return p.g.inputs?(r=1e3*(null==e?performance.now():e),y(n,p.C,2)):n.return();case 2:return y(n,p.initialize(),3);case 3:for(i=new p.h.PacketDataList,s=o(Object.keys(t)),a=s.next();!a.done;a=s.next())if(l=a.value,c=p.g.inputs[l]){t:{var f=p,m=t[l];switch(c.type){case"video":var g=f.m[c.stream];if(g||(g=new zt(f.h,f.D),f.m[c.stream]=g),0===(f=g).l&&(f.l=f.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&m instanceof HTMLVideoElement){var b=m.videoWidth;g=m.videoHeight}else"undefined"!=typeof HTMLImageElement&&m instanceof HTMLImageElement?(b=m.naturalWidth,g=m.naturalHeight):(b=m.width,g=m.height);g={glName:f.l,width:b,height:g},(b=f.g).canvas.width=g.width,b.canvas.height=g.height,b.activeTexture(b.TEXTURE0),f.h.bindTexture2d(f.l),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),f.h.bindTexture2d(0),f=g;break t;case"detections":for((g=f.m[c.stream])||(g=new Ut(f.h),f.m[c.stream]=g),(f=g).data||(f.data=new f.g.DetectionListData),f.data.reset(m.length),g=0;g<m.length;++g){b=m[g];var v=f.data,x=v.setBoundingBox,w=g,S=b.T,_=new Ot;gt(_,1,S.Z),gt(_,2,S.$),gt(_,3,S.height),gt(_,4,S.width),gt(_,5,S.rotation),gt(_,6,S.X);var k=S=new Q;nt(k,1,pt(_,1)),nt(k,2,pt(_,2)),nt(k,3,pt(_,3)),nt(k,4,pt(_,4)),nt(k,5,pt(_,5));var T=pt(_,6);if(null!=T&&null!=T){q(k.g,48);var E=k.g,M=T;T=0>M;var C=(M=Math.abs(M))>>>0;for(M=Math.floor((M-C)/4294967296),M>>>=0,T&&(M=~M>>>0,4294967295<(C=1+(~C>>>0))&&(C=0,4294967295<++M&&(M=0))),T=B=C,C=M;0<C||127<T;)E.push(127&T|128),T=(T>>>7|C<<25)>>>0,C>>>=7;E.push(T)}if(_t(_,k),S=et(S),x.call(v,w,S),b.O)for(v=0;v<b.O.length;++v)k=!!(_=b.O[v]).visibility,w=(x=f.data).addNormalizedLandmark,S=g,_=Object.assign(Object.assign({},_),{visibility:k?_.visibility:0}),gt(k=new Nt,1,_.x),gt(k,2,_.y),gt(k,3,_.z),_.visibility&&gt(k,4,_.visibility),nt(E=_=new Q,1,pt(k,1)),nt(E,2,pt(k,2)),nt(E,3,pt(k,3)),nt(E,4,pt(k,4)),nt(E,5,pt(k,5)),_t(k,E),_=et(_),w.call(x,S,_);if(b.M)for(v=0;v<b.M.length;++v){if(w=(x=f.data).addClassification,S=g,_=b.M[v],gt(k=new Et,2,_.Y),_.index&&gt(k,1,_.index),_.label&&gt(k,3,_.label),_.displayName&&gt(k,4,_.displayName),E=_=new Q,null!=(C=pt(k,1))&&null!=C)if(q(E.g,8),T=E.g,0<=C)q(T,C);else{for(M=0;9>M;M++)T.push(127&C|128),C>>=7;T.push(1)}nt(E,2,pt(k,2)),null!=(T=pt(k,3))&&(T=I(T),q(E.g,26),q(E.g,T.length),tt(E,E.g.end()),tt(E,T)),null!=(T=pt(k,4))&&(T=I(T),q(E.g,34),q(E.g,T.length),tt(E,E.g.end()),tt(E,T)),_t(k,E),_=et(_),w.call(x,S,_)}}f=f.data;break t;default:f={}}}switch(u=f,h=c.stream,c.type){case"video":i.pushTexture2d(Object.assign(Object.assign({},u),{stream:h,timestamp:r}));break;case"detections":(d=u).stream=h,d.timestamp=r,i.pushDetectionList(d);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return p.i.send(i),y(n,p.C,4);case 4:i.delete(),n.g=0}}))}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},T("Solution",Ht),T("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Zt.prototype).reset=function(){this.g.reset()},t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){return Tt(this,(function t(){var e=this;return S(t,(function(t){return y(t,e.g.initialize(),0)}))}))},t.send=function(t,e){return Tt(this,(function n(){var r=this;return S(n,(function(n){return y(n,r.g.send(t,e),0)}))}))},t.setOptions=function(t){this.g.setOptions(t)},T("Pose",Zt),T("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),T("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),T("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),T("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),T("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),T("VERSION","0.4.1633558788")}).call(yt);
/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */
var dht=function(t,e){return(dht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function pht(t,e){function n(){this.constructor=t}dht(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var fht=function(){return(fht=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function mht(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function ght(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function yht(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var bht=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],vht=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],xht={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},wht={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},Sht=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],_ht=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function kht(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function Tht(t){return mht(this,void 0,void 0,(function(){var e,n;return ght(this,(function(r){switch(r.label){case 0:return e=document.createElement("canvas"),t instanceof we?[4,Br(t,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:e.width=kht(t.width),e.height=kht(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),r.label=3;case 3:return[2,e]}}))}))}function Eht(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s,o;return ght(this,(function(a){switch(a.label){case 0:return t instanceof we?(e=t.shape.slice(0,2),n=e[0],r=e[1],i=ImageData.bind,[4,Br(t)]):[3,2];case 1:return[2,new(i.apply(ImageData,[void 0,a.sent(),r,n]))];case 2:return s=document.createElement("canvas"),o=s.getContext("2d"),s.width=kht(t.width),s.height=kht(t.height),o.drawImage(t,0,0),[2,o.getImageData(0,0,s.width,s.height)]}}))}))}function Mht(t){return mht(this,void 0,void 0,(function(){var e;return ght(this,(function(n){switch(n.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,Tht(t)]:[3,2];case 1:return e=n.sent(),[3,3];case 2:e=t,n.label=3;case 3:return[2,Ur(e,4)]}}))}))}function Cht(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got "+t);if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got "+t)}var Aht={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},Nht=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,this.mask]}))}))},t.prototype.toImageData=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,Eht(this.mask)]}))}))},t.prototype.toTensor=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,Mht(this.mask)]}))}))},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function Iht(t){return Cht(t),"person"}var $ht=function(){function t(t){var e,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new hht.Pose({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing,enableSegmentation:t.enableSegmentation,smoothSegmentation:t.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(t){if(n.height=t.image.height,n.width=t.image.width,null==t.poseLandmarks)n.poses=[];else{var e=n.translateOutput(t.poseLandmarks,t.poseWorldLandmarks);t.segmentationMask&&(e.segmentation={maskValueToLabel:Iht,mask:new Nht(t.segmentationMask)}),n.poses=[e]}}))}return t.prototype.translateOutput=function(t,e){var n=this,r={keypoints:t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,z:t.z,score:t.visibility,name:vht[e]}}))};return null!=e&&(r.keypoints3D=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:vht[e]}}))),r},t.prototype.estimatePoses=function(t,e,n){return mht(this,void 0,void 0,(function(){var r,i;return ght(this,(function(s){switch(s.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),t instanceof we?(i=ImageData.bind,[4,Br(t)]):[3,2];case 1:return r=new(i.apply(ImageData,[void 0,s.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:r=t,s.label=3;case 3:return t=r,[4,this.poseSolution.send({image:t},n)];case 4:return s.sent(),[2,this.poses]}}))}))},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function Rht(t){return mht(this,void 0,void 0,(function(){var e,n;return ght(this,(function(r){switch(r.label){case 0:return e=function(t){if(null==t)return fht({},Aht);var e=fht({},t);return e.runtime="mediapipe",null==e.enableSegmentation&&(e.enableSegmentation=Aht.enableSegmentation),null==e.enableSmoothing&&(e.enableSmoothing=Aht.enableSmoothing),null==e.smoothSegmentation&&(e.smoothSegmentation=Aht.smoothSegmentation),null==e.modelType&&(e.modelType=Aht.modelType),e}(t),[4,(n=new $ht(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function Oht(t){return t instanceof we?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function Pht(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function Lht(t){return t instanceof we?t:Ur(t)}function Dht(t,e,n){return Fht(n,"inputResolution"),[1/n.width*t[0][0]*e.width,1/n.height*t[0][1]*e.width,t[0][3]*e.width,1/n.width*t[1][0]*e.height,1/n.height*t[1][1]*e.height,t[1][3]*e.height,0,0]}function Fht(t,e){c(0!==t.width,(function(){return e+" width cannot be 0."})),c(0!==t.height,(function(){return e+" height cannot be 0."}))}function zht(t,e,n){var r=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex,s=t.locationData,o=s.relativeKeypoints[r].x*e.width,a=s.relativeKeypoints[r].y*e.height,l=s.relativeKeypoints[i].x*e.width,c=s.relativeKeypoints[i].y*e.height,u=2*Math.sqrt((l-o)*(l-o)+(c-a)*(c-a)),h=function(t,e,n){var r,i=t.locationData,s=n.rotationVectorStartKeypointIndex,o=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=i.relativeKeypoints[s].x*e.width,l=i.relativeKeypoints[s].y*e.height,c=i.relativeKeypoints[o].x*e.width,u=i.relativeKeypoints[o].y*e.height;return Pht(r-Math.atan2(-(u-l),c-a))}(t,e,n);return{xCenter:o/e.width,yCenter:a/e.height,width:u/e.width,height:u/e.height,rotation:h}}function Bht(t){if(16!==t.length)throw new Error("Array length must be 16 but got "+t.length);return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function Uht(t,e,n,r,i,s,o){return t[e][i]*(t[n][s]*t[r][o]-t[n][o]*t[r][s])}function Vht(t,e,n){var r=(e+1)%4,i=(e+2)%4,s=(e+3)%4,o=(n+1)%4,a=(n+2)%4,l=(n+3)%4;return Uht(t,r,i,s,o,a,l)+Uht(t,i,s,r,o,a,l)+Uht(t,s,r,i,o,a,l)}function jht(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],i=0,s=t;i<s.length;i++){var o=s[i],a=o.x-.5,l=o.y-.5,c=n.ignoreRotation?0:e.rotation,u=Math.cos(c)*a-Math.sin(c)*l,h=Math.sin(c)*a+Math.cos(c)*l;u=u*e.width+e.xCenter,h=h*e.height+e.yCenter;var d=o.z*e.width,p=fht({},o);p.x=u,p.y=h,p.z=d,r.push(p)}return r}function Wht(t,e){var n=function(t,e,n,r){var i=(r-n)/255;return{scale:i,offset:n-0*i}}(0,0,e[0],e[1]);return xr((function(){return vi(Si(t,n.scale),n.offset)}))}function Hht(t,e,n){var r,i,s,o,a,l,c,u,h,d,p,f,m=e.outputTensorSize,g=e.keepAspectRatio,y=e.borderMode,b=e.outputTensorFloatRange,v=Oht(t),x=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}(v,n),w=function(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,i=e.width;Fht(e,"targetSize"),Fht(t,"roi");var s,o,a=r/i,l=t.height/t.width,c=0,u=0;return a>l?(s=t.width,o=t.width*a,u=(1-l/a)/2):(s=t.height/a,o=t.height,c=(1-a/l)/2),t.width=s,t.height=o,{top:u,left:c,right:c,bottom:u}}(x,m,g),S=(r=x,i=v.width,s=v.height,!1,o=r.width,a=r.height,1,l=Math.cos(r.rotation),c=Math.sin(r.rotation),u=r.xCenter,h=r.yCenter,d=1/i,p=1/s,(f=new Array(16))[0]=o*l*1*d,f[1]=-a*c*d,f[2]=0,f[3]=(-.5*o*l*1+.5*a*c+u)*d,f[4]=o*c*1*p,f[5]=a*l*p,f[6]=0,f[7]=(-.5*a*l-.5*o*c*1+h)*p,f[8]=0,f[9]=0,f[10]=o*d,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,Bht(f));return{imageTensor:xr((function(){var e=Lht(t),n=xl(Dht(S,v,m),[1,8]),r="zero"===y?"constant":"nearest",i=Kc.transform(lo(Yn(e,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=b?Wht(i,b):i})),padding:w,transformationMatrix:S}}function Ght(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}function qht(t){return null!=t&&null!=t.currentTime}function Xht(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var a=t[o];n=Math.min(n,a.x),r=Math.max(r,a.x),i=Math.min(i,a.y),s=Math.max(s,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:i,xMax:r,yMax:s,width:r-n,height:s-i},e}function Yht(t,e,n,r){return mht(this,void 0,void 0,(function(){var r,i,s,o,a;return ght(this,(function(l){switch(l.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),r=xl(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),i=vl(t.map((function(t){return t.score[0]}))),[4,Kc.nonMaxSuppressionAsync(r,i,e,n)];case 1:return[4,(s=l.sent()).array()];case 2:return o=l.sent(),a=t.filter((function(t,e){return o.indexOf(e)>-1})),wr([r,i,s]),[2,a]}}))}))}function Kht(t,e){return t.map((function(t){var n=fht(fht({},t),{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}function Zht(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,S,_,k,T,E;return ght(this,(function(M){switch(M.label){case 0:if(r=fl(e,[0]),i=r.shape,s=i[0],o=i[1],a=i[2],t.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+t.length+", heatmap length: "+a);return l=[],[4,r.buffer()];case 1:for(c=M.sent(),u=0;u<t.length;u++)if(h=t[u],d=fht({},h),l.push(d),p=Math.trunc(d.x*o),f=Math.trunc(d.y*s),!(p<0||p>=o||f<0||p>=s)){for(m=Math.trunc((n.kernelSize-1)/2),g=Math.max(0,p-m),y=Math.min(o,p+m+1),b=Math.max(0,f-m),v=Math.min(s,f+m+1),x=0,w=0,S=0,_=0,k=b;k<v;++k)for(T=g;T<y;++T)E=c.get(k,T,u),x+=E,_=Math.max(_,E),w+=T*E,S+=k*E;_>=n.minConfidenceToRefine&&x>0&&(d.x=w/o/x,d.y=S/s/x)}return r.dispose(),[2,l]}}))}))}function Jht(t,e){var n=e.left,r=e.top,i=e.left+e.right,s=e.top+e.bottom;return t.map((function(t){return fht(fht({},t),{x:(t.x-n)/(1-i),y:(t.y-r)/(1-s),z:t.z/(1-i)})}))}function Qht(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a;return ght(this,(function(l){switch(l.label){case 0:return r=t[0],i=t[1],s=function(t,e,n){return xr((function(){var r,i,s,o;n.reverseOutputOrder?(i=fl(es(t,[0,n.boxCoordOffset+0],[-1,1])),r=fl(es(t,[0,n.boxCoordOffset+1],[-1,1])),o=fl(es(t,[0,n.boxCoordOffset+2],[-1,1])),s=fl(es(t,[0,n.boxCoordOffset+3],[-1,1]))):(r=fl(es(t,[0,n.boxCoordOffset+0],[-1,1])),i=fl(es(t,[0,n.boxCoordOffset+1],[-1,1])),s=fl(es(t,[0,n.boxCoordOffset+2],[-1,1])),o=fl(es(t,[0,n.boxCoordOffset+3],[-1,1]))),i=vi(Si(wi(i,n.xScale),e.w),e.x),r=vi(Si(wi(r,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(s=Si(ao(wi(s,n.hScale)),e.h),o=Si(ao(wi(o,n.wScale)),e.w)):(s=Si(wi(s,n.hScale),e.h),o=Si(wi(o,n.wScale),e.h));var a=$o(r,wi(s,2)),l=$o(i,wi(o,2)),c=vi(r,wi(s,2)),u=vi(i,wi(o,2)),h=Qi([Ki(a,[n.numBoxes,1]),Ki(l,[n.numBoxes,1]),Ki(c,[n.numBoxes,1]),Ki(u,[n.numBoxes,1])],1);if(n.numKeypoints)for(var d=0;d<n.numKeypoints;++d){var p=n.keypointCoordOffset+d*n.numValuesPerKeypoint,f=void 0,m=void 0;n.reverseOutputOrder?(f=fl(es(t,[0,p],[-1,1])),m=fl(es(t,[0,p+1],[-1,1]))):(m=fl(es(t,[0,p],[-1,1])),f=fl(es(t,[0,p+1],[-1,1])));var g=vi(Si(wi(f,n.xScale),e.w),e.x),y=vi(Si(wi(m,n.yScale),e.h),e.y);h=Qi([h,Ki(g,[n.numBoxes,1]),Ki(y,[n.numBoxes,1])],1)}return h}))}(i,e,n),o=xr((function(){var t=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=fs(r,-n.scoreClippingThresh,n.scoreClippingThresh)),t=ts(t)):t})),[4,tdt(s,o,n)];case 1:return a=l.sent(),wr([s,o]),[2,a]}}))}))}function tdt(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f;return ght(this,(function(m){switch(m.label){case 0:return r=[],[4,t.data()];case 1:return i=m.sent(),[4,e.data()];case 2:for(s=m.sent(),o=0;o<n.numBoxes;++o)if(!(null!=n.minScoreThresh&&s[o]<n.minScoreThresh||(a=o*n.numCoords,l=edt(i[a+0],i[a+1],i[a+2],i[a+3],s[o],n.flipVertically,o),(c=l.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((u=l.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,d=0;d<h;d+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+d,f={x:i[p+0],y:n.flipVertically?1-i[p+1]:i[p+1]},u.relativeKeypoints.push(f);r.push(l)}return[2,r]}}))}))}function edt(t,e,n,r,i,s,o){return{score:[i],ind:o,locationData:{relativeBoundingBox:{xMin:e,yMin:s?1-n:t,xMax:r,yMax:s?1-t:n,width:r-e,height:n-t}}}}function ndt(t,e){return"none"===t?e:function(t){return 1/(1+Math.exp(-t))}(e)}function rdt(t,e,n,r){return mht(this,void 0,void 0,(function(){var i,s,o,a,l,c,u,h;return ght(this,(function(d){switch(d.label){case 0:return n=n||e.flipHorizontally||!1,r=r||e.flipVertically||!1,i=t.size,s=i/e.numLandmarks,[4,t.data()];case 1:for(o=d.sent(),a=[],l=0;l<e.numLandmarks;++l)c=l*s,(h={x:0,y:0}).x=n?e.inputImageWidth-o[c]:o[c],s>1&&(h.y=r?e.inputImageHeight-o[c+1]:o[c+1]),s>2&&(h.z=o[c+2]),s>3&&(h.score=ndt(e.visibilityActivation,o[c+3])),a.push(h);for(u=0;u<a.length;++u)(h=a[u]).x=h.x/e.inputImageWidth,h.y=h.y/e.inputImageHeight,h.z=h.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}}))}))}function idt(t,e,n){var r=t.width,i=t.height,s=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(s=function(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),Pht(t)}(s,n)),0===s)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+i*n.shiftY;else{var o=(e.width*r*n.shiftX*Math.cos(s)-e.height*i*n.shiftY*Math.sin(s))/e.width,a=(e.width*r*n.shiftX*Math.sin(s)+e.height*i*n.shiftY*Math.cos(s))/e.height;t.xCenter=t.xCenter+o,t.yCenter=t.yCenter+a}if(n.squareLong){var l=Math.max(r*e.width,i*e.height);r=l/e.width,i=l/e.height}else if(n.squareShort){var c=Math.min(r*e.width,i*e.height);r=c/e.width,i=c/e.height}return t.width=r*n.scaleX,t.height=i*n.scaleY,t}var sdt=function(){function t(t){this.alpha=t,this.initialized=!1}return t.prototype.apply=function(t,e){var n;return this.initialized?n=null==e?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(n=t,this.initialized=!0),this.rawValue=t,this.storedValue=n,n},t.prototype.applyWithAlpha=function(t,e,n){return this.alpha=e,this.apply(t,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),odt=function(){function t(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new sdt(this.getAlpha(this.minCutOff)),this.dx=new sdt(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r=Math.trunc(e);if(this.lastTimestamp>=r)return t;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var i=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*n*this.frequency:0,s=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),o=this.minCutOff+this.beta*Math.abs(s),a=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(s):null;return this.x.applyWithAlpha(t,this.getAlpha(o),a)},t.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},t}(),adt=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;this.initializeFiltersIfEmpty(t);var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return yht(t);i=1/n}return t.map((function(t,n){var s=fht(fht({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(s.z=r.zFilters[n].apply(t.z,e,i)),s}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new odt(e.config)})),this.yFilters=t.map((function(t){return new odt(e.config)})),this.zFilters=t.map((function(t){return new odt(e.config)})))},t}(),ldt=function(){function t(t){this.config=t,this.window=[],this.lowPassFilter=new sdt(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r,i=Math.trunc(e);if(this.lastTimestamp>=i)return t;if(-1===this.lastTimestamp)r=1;else{for(var s=t*n-this.lastValue*this.lastValueScale,o=i-this.lastTimestamp,a=s,l=o,c=(1+this.window.length)*(1e6/30),u=0,h=this.window;u<h.length;u++){var d=h[u];if(l+d.duration>c)break;a+=d.distance,l+=d.duration}var p=a/(1e-6*l);r=1-1/(1+this.config.velocityScale*Math.abs(p)),this.window.unshift({distance:s,duration:o}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=n,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(t,r)},t}(),cdt=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return yht(t);i=1/n}return this.initializeFiltersIfEmpty(t),t.map((function(t,n){var s=fht(fht({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(s.z=r.zFilters[n].apply(t.z,e,i)),s}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new ldt(e.config)})),this.yFilters=t.map((function(t){return new ldt(e.config)})),this.zFilters=t.map((function(t){return new ldt(e.config)})))},t}(),udt=function(){function t(t){if(null!=t.velocityFilter)this.keypointsFilter=new cdt(t.velocityFilter);else{if(null==t.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+t+".");this.keypointsFilter=new adt(t.oneEuroFilter)}}return t.prototype.apply=function(t,e,n,r,i){if(void 0===r&&(r=!1),null==t)return this.keypointsFilter.reset(),null;var s=null!=i?function(t,e){return(t.width*e.width+t.height*e.height)/2}(i,n):1,o=r?Kht(t,n):t,a=this.keypointsFilter.apply(o,e,s);return r?function(t,e){return t.map((function(t){var n=fht(fht({},t),{x:t.x/e.width,y:t.y/e.height});return null!=t.z&&(t.z=t.z/e.width),n}))}(a,n):a},t}(),hdt=function(){function t(t){this.alpha=t.alpha}return t.prototype.apply=function(t){var e=this;if(null==t)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map((function(t){return new sdt(e.alpha)})));for(var n=[],r=0;r<t.length;++r){var i=t[r],s=fht({},i);s.score=this.visibilityFilters[r].apply(i.score),n.push(s)}return n},t}(),ddt={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},pdt={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},fdt={maxPoses:1,flipHorizontal:!1},mdt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},gdt={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},ydt={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},bdt={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},vdt={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},xdt={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},wdt={kernelSize:7,minConfidenceToRefine:.5},Sdt={alpha:.1},_dt={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},kdt={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},Tdt={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},Edt={activation:"none"},Mdt={combineWithPreviousRatio:.7},Cdt=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,Tht(this.mask)]}))}))},t.prototype.toImageData=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,Eht(this.mask)]}))}))},t.prototype.toTensor=function(){return mht(this,void 0,void 0,(function(){return ght(this,(function(t){return[2,this.mask]}))}))},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function Adt(t){return Cht(t),"person"}var Ndt=function(){function t(t,e,n,r,i,s){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=i,this.modelType=s,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(t){null==t.reduceBoxesInLowestLayer&&(t.reduceBoxesInLowestLayer=!1),null==t.interpolatedScaleAspectRatio&&(t.interpolatedScaleAspectRatio=1),null==t.fixedAnchorSize&&(t.fixedAnchorSize=!1);for(var e=[],n=0;n<t.numLayers;){for(var r=[],i=[],s=[],o=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var l=Ght(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)s.push(1),s.push(2),s.push(.5),o.push(.1),o.push(l),o.push(l);else{for(var c=0;c<t.aspectRatios.length;++c)s.push(t.aspectRatios[c]),o.push(l);if(t.interpolatedScaleAspectRatio>0){var u=a===t.strides.length-1?1:Ght(t.minScale,t.maxScale,a+1,t.strides.length);o.push(Math.sqrt(l*u)),s.push(t.interpolatedScaleAspectRatio)}}a++}for(var h=0;h<s.length;++h){var d=Math.sqrt(s[h]);r.push(o[h]/d),i.push(o[h]*d)}var p=0,f=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],f=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),f=Math.ceil(t.inputSizeWidth/m)}for(var g=0;g<p;++g)for(var y=0;y<f;++y)for(var b=0;b<r.length;++b){var v={xCenter:(y+t.anchorOffsetX)/f,yCenter:(g+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(v.width=1,v.height=1):(v.width=i[b],v.height=r[b]),e.push(v)}n=a}return e}(ddt);var o=vl(this.anchors.map((function(t){return t.width}))),a=vl(this.anchors.map((function(t){return t.height}))),l=vl(this.anchors.map((function(t){return t.xCenter}))),c=vl(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:l,y:c,w:o,h:a},this.prevFilteredSegmentationMask=this.enableSegmentation?xl([],[0,0]):null}return t.prototype.estimatePoses=function(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,S,_,k,T;return ght(this,(function(E){switch(E.label){case 0:return r=function(t){var e;if(null==(e=null==t?fdt:fht({},t)).maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}(e),null==t?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:qht(t)?1e6*t.currentTime:null,i=Oht(t),s=xr((function(){return Yn(Lht(t),"float32")})),null!=(o=this.regionOfInterest)?[3,2]:[4,this.detectPose(s)]);case 1:if(0===(a=E.sent()).length)return this.reset(),s.dispose(),[2,[]];l=a[0],o=this.poseDetectionToRoi(l,i),E.label=2;case 2:return[4,this.poseLandmarksByRoi(o,s)];case 3:return c=E.sent(),s.dispose(),null==c?(this.reset(),[2,[]]):(u=c.landmarks,h=c.auxiliaryLandmarks,d=c.poseScore,p=c.worldLandmarks,f=c.segmentationMask,m=this.poseLandmarkFiltering(u,h,p,i),g=m.actualLandmarksFiltered,y=m.auxiliaryLandmarksFiltered,b=m.actualWorldLandmarksFiltered,v=this.poseLandmarksToRoi(y,i),this.regionOfInterest=v,x=this.smoothSegmentation&&null!=f?this.poseSegmentationFiltering(f):f,null!=(w=null!=g?Kht(g,i):null)&&w.forEach((function(t,e){t.name=vht[e]})),null!=(S=b)&&S.forEach((function(t,e){t.name=vht[e]})),_={score:d,keypoints:w,keypoints3D:S},null!==x&&(k=xr((function(){var t=lo(x,2),e=ia(t,[[0,0],[0,0],[0,1]]);return Ko(e,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||wr(x),T={maskValueToLabel:Adt,mask:new Cdt(k)},_.segmentation=T),[2,[_]])}}))}))},t.prototype.poseSegmentationFiltering=function(t){var e=this.prevFilteredSegmentationMask;return 0===e.size?this.prevFilteredSegmentationMask=t:(this.prevFilteredSegmentationMask=function(t,e,n){return"webgl"===_r()?function(t,e,n){var r=n.combineWithPreviousRatio.toFixed(2),i={variableNames:["prevMask","newMask"],outputShape:t.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * "+r+");\n\n      setOutput(outputValue);\n    }\n"},s=Tr();return xr((function(){var n=s.compileAndRun(i,[t,e]);return br().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(t,e,n):xr((function(){var r=$o(e,.5),i=no(r),s=$o(1,Yo(1,Si(i,vi(5.68842,Si(i,vi(-.748699,Si(i,vi(-57.8051,Si(i,vi(291.309,Si(i,-624.717)))))))))));return vi(e,Si($o(t,e),Si(s,n.combineWithPreviousRatio)))}))}(e,t,Mdt),wr(t)),wr(e),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),wr([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(wr(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=xl([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l,c,u;return ght(this,(function(h){switch(h.label){case 0:return e=Hht(t,ydt),n=e.imageTensor,r=e.padding,i=this.detectorModel.predict(n),s=function(t){return xr((function(){var e=function(t){return xr((function(){return[es(t,[0,0,0],[1,-1,1]),es(t,[0,0,1],[1,-1,-1])]}))}(t),n=e[0],r=e[1];return{boxes:fl(r),logits:fl(n)}}))}(i),o=s.boxes,[4,Qht([a=s.logits,o],this.anchorTensor,mdt)];case 1:return 0===(l=h.sent()).length?(wr([n,i,a,o]),[2,l]):[4,Yht(l,this.maxPoses,.3)];case 2:return c=h.sent(),u=function(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,i=e.left+e.right,s=e.top+e.bottom,o=0;o<t.length;o++){var a=t[o],l=a.locationData.relativeBoundingBox,c=(l.xMin-n)/(1-i),u=(l.yMin-r)/(1-s),h=l.width/(1-i),d=l.height/(1-s);l.xMin=c,l.yMin=u,l.width=h,l.height=d,l.xMax=c+h,l.yMax=u+d;var p=a.locationData.relativeKeypoints;p&&p.forEach((function(t){var e=(t.x-n)/(1-i),o=(t.y-r)/(1-s);t.x=e,t.y=o}))}return t}(c,r),wr([n,i,a,o]),[2,u]}}))}))},t.prototype.poseDetectionToRoi=function(t,e){return idt(zht(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,gdt)},t.prototype.poseLandmarksByRoi=function(t,e){return mht(this,void 0,void 0,(function(){var n,r,i,s,o,a,l,c,u,h,d,p,f,m;return ght(this,(function(g){switch(g.label){case 0:if(n=Oht(e),r=Hht(e,bdt,t),i=r.imageTensor,s=r.padding,o=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return a=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&a.push("activation_segmentation"),l=this.landmarkModel.execute(i,a),[4,this.tensorsToPoseLandmarksAndSegmentation(l)];case 1:return null==(c=g.sent())?(wr(l),wr(i),[2,null]):(u=c.landmarks,h=c.auxiliaryLandmarks,d=c.poseScore,p=c.worldLandmarks,f=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,t,s,o,u,h,p,f)]);case 2:return m=g.sent(),wr(l),wr(i),[2,fht({poseScore:d},m)]}}))}))},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(t,e,n,r,i,s,o,a){return mht(this,void 0,void 0,(function(){var l,c,u,h,d,p;return ght(this,(function(f){return l=Jht(i,n),c=Jht(s,n),u=jht(l,e),h=jht(c,e),d=function(t,e){for(var n=[],r=0,i=t;r<i.length;r++){var s=i[r],o=s.x,a=s.y,l=e.rotation,c=Math.cos(l)*o-Math.sin(l)*a,u=Math.sin(l)*o+Math.cos(l)*a,h=fht({},s);h.x=c,h.y=u,n.push(h)}return n}(o,e),p=null,this.enableSegmentation&&(p=xr((function(){var e=a.shape,n=e[0],i=e[1],s=function(t){var e=Bht(new Array(16).fill(0));e[0][0]=Vht(t,0,0),e[1][0]=-Vht(t,0,1),e[2][0]=Vht(t,0,2),e[3][0]=-Vht(t,0,3),e[0][2]=Vht(t,2,0),e[1][2]=-Vht(t,2,1),e[2][2]=Vht(t,2,2),e[3][2]=-Vht(t,2,3),e[0][1]=-Vht(t,1,0),e[1][1]=Vht(t,1,1),e[2][1]=-Vht(t,1,2),e[3][1]=Vht(t,1,3),e[0][3]=-Vht(t,3,0),e[1][3]=Vht(t,3,1),e[2][3]=-Vht(t,3,2),e[3][3]=Vht(t,3,3);for(var n=t[0][0]*e[0][0]+t[1][0]*e[0][1]+t[2][0]*e[0][2]+t[3][0]*e[0][3],r=0;r<e.length;r++)for(var i=0;i<e.length;i++)e[r][i]/=n;return e}(r),o=xl(Dht(s,{width:i,height:n},t),[1,8]),l=[1,n,i,1];return fl(Kc.transform(Ki(a,l),o,"bilinear","constant",0,[t.height,t.width]),[0,3])})),wr(a)),[2,{landmarks:u,auxiliaryLandmarks:h,worldLandmarks:d,segmentationMask:p}]}))}))},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l,c,u,h,d,p;return ght(this,(function(f){switch(f.label){case 0:return e=t[0],n=t[1],r=t[2],i=t[3],s=this.enableSegmentation?t[4]:null,[4,n.data()];case 1:return(o=f.sent()[0])<.5?[2,null]:[4,rdt(e,vdt)];case 2:return[4,Zht(f.sent(),r,wdt)];case 3:return a=f.sent(),l=a.slice(0,33),c=a.slice(33,35),[4,rdt(i,xdt)];case 4:return u=f.sent(),h=u.slice(0,33),d=function(t,e,n){void 0===n&&(n=!0);for(var r=[],i=0;i<t.length;i++){var s=fht({},e[i]);n&&(s.score=t[i].score),r.push(s)}return r}(l,h,!0),p=this.enableSegmentation?function(t,e,n){return xr((function(){var n=fl(t,[0]),r=n.shape[2];if(1===r){var i=n;switch(e.activation){case"none":break;case"sigmoid":i=ts(i);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+e.activation+")")}return fl(i,[2])}throw new Error("Unsupported number of tensor channels "+r)}))}(s,Edt):null,[2,{landmarks:l,auxiliaryLandmarks:c,poseScore:o,worldLandmarks:d,segmentationMask:p}]}}))}))},t.prototype.poseLandmarksToRoi=function(t,e){return idt(zht(Xht(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,gdt)},t.prototype.poseLandmarkFiltering=function(t,e,n,r){var i,s,o;if(null!=this.timestamp&&this.enableSmoothing){var a=zht(Xht(e),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new hdt(Sdt)),i=this.visibilitySmoothingFilterActual.apply(t),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new hdt(Sdt)),s=this.visibilitySmoothingFilterAuxiliary.apply(e),o=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new udt(_dt)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,r,!0,a),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new udt(kdt)),s=this.landmarksSmoothingFilterAuxiliary.apply(s,this.timestamp,r,!0,a),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new udt(Tdt)),o=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else i=t,s=e,o=n;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:s,actualWorldLandmarksFiltered:o}},t}();function Idt(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s,o;return ght(this,(function(a){switch(a.label){case 0:return e=function(t){var e=fht({},null==t?pdt:t);if(null==e.enableSmoothing&&(e.enableSmoothing=pdt.enableSmoothing),null==e.enableSegmentation&&(e.enableSegmentation=pdt.enableSegmentation),null==e.smoothSegmentation&&(e.smoothSegmentation=pdt.smoothSegmentation),null==e.modelType&&(e.modelType=pdt.modelType),null==e.detectorModelUrl&&(e.detectorModelUrl=pdt.detectorModelUrl),null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return e}(t),n="string"==typeof e.detectorModelUrl&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof e.landmarkModelUrl&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([jY(e.detectorModelUrl,{fromTFHub:n}),jY(e.landmarkModelUrl,{fromTFHub:r})])];case 1:return i=a.sent(),s=i[0],o=i[1],[2,new Ndt(s,o,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}}))}))}var $dt,Rdt,Odt,Pdt=function(){function t(t){!function(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+t.maxTracks);if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+t.maxAge);if(void 0!==t.keypointTrackerParams){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+t.keypointTrackerParams.keypointConfidenceThreshold);if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+t.keypointTrackerParams.minNumberOfKeypoints);for(var e=0,n=t.keypointTrackerParams.keypointFalloff;e<n.length;e++){var r=n[e];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return t.prototype.apply=function(t,e){this.filterOldTracks(e);var n=this.computeSimilarity(t);return this.assignTracks(t,n,e),this.updateTracks(e),t},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(t){return t.id})))},t.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter((function(n){return t-n.lastTimestamp<=e.maxAge}))},t.prototype.assignTracks=function(t,e,n){for(var r=Array.from(Array(e[0].length).keys()),i=[],s=0,o=Array.from(Array(t.length).keys());s<o.length;s++){var a=o[s];if(0!==r.length){for(var l=-1,c=-1,u=0,h=r;u<h.length;u++){var d=h[u],p=e[a][d];p>=this.minSimilarity&&p>c&&(l=d,c=p)}if(l>=0){var f=this.tracks[l];f=Object.assign(f,this.createTrack(t[a],n,f.id)),t[a].id=f.id;var m=r.indexOf(l);r.splice(m,1)}else i.push(a)}else i.push(a)}for(var g=0,y=i;g<y.length;g++){a=y[g];var b=this.createTrack(t[a],n);this.tracks.push(b),t[a].id=b.id}},t.prototype.updateTracks=function(t){this.tracks.sort((function(t,e){return e.lastTimestamp-t.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(t,e,n){var r={id:n||this.nextTrackID(),lastTimestamp:e,keypoints:yht(t.keypoints).map((function(t){return fht({},t)}))};return void 0!==t.box&&(r.box=fht({},t.box)),r},t.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter((function(e){return!t.includes(e.id)}))},t.prototype.reset=function(){this.tracks=[]},t}(),Ldt=function(t){function e(e){return t.call(this,e)||this}return pht(e,t),e.prototype.computeSimilarity=function(t){var e=this;return 0===t.length||0===this.tracks.length?[[]]:t.map((function(t){return e.tracks.map((function(n){return e.iou(t,n)}))}))},e.prototype.iou=function(t,e){var n=Math.max(t.box.xMin,e.box.xMin),r=Math.max(t.box.yMin,e.box.yMin),i=Math.min(t.box.xMax,e.box.xMax),s=Math.min(t.box.yMax,e.box.yMax);if(n>=i||r>=s)return 0;var o=(i-n)*(s-r);return o/(t.box.width*t.box.height+e.box.width*e.box.height-o)},e}(Pdt),Ddt=function(t){function e(e){var n=t.call(this,e)||this;return n.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=e.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,n}return pht(e,t),e.prototype.computeSimilarity=function(t){if(0===t.length||0===this.tracks.length)return[[]];for(var e=[],n=0,r=t;n<r.length;n++){for(var i=r[n],s=[],o=0,a=this.tracks;o<a.length;o++){var l=a[o];s.push(this.oks(i,l))}e.push(s)}return e},e.prototype.oks=function(t,e){for(var n=this.area(e.keypoints)+1e-6,r=0,i=0,s=0;s<t.keypoints.length;++s){var o=t.keypoints[s],a=e.keypoints[s];if(!(o.score<this.keypointThreshold||a.score<this.keypointThreshold)){i+=1;var l=Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2),c=2*this.keypointFalloff[s];r+=Math.exp(-1*l/(2*n*Math.pow(c,2)))}}return i<this.minNumKeyoints?0:r/i},e.prototype.area=function(t){var e=this,n=t.filter((function(t){return t.score>e.keypointThreshold})),r=Math.min.apply(Math,yht([1],n.map((function(t){return t.x})))),i=Math.max.apply(Math,yht([0],n.map((function(t){return t.x})))),s=Math.min.apply(Math,yht([1],n.map((function(t){return t.y}))));return(i-r)*(Math.max.apply(Math,yht([0],n.map((function(t){return t.y}))))-s)},e}(Pdt);function Fdt(t){switch(t){case Rdt.BlazePose:return vht.reduce((function(t,e,n){return t[e]=n,t}),{});case Rdt.PoseNet:case Rdt.MoveNet:return bht.reduce((function(t,e,n){return t[e]=n,t}),{});default:throw new Error("Model "+t+" is not supported.")}}(Odt=$dt||($dt={})).Keypoint="keypoint",Odt.BoundingBox="boundingBox",function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(Rdt||(Rdt={}));var zdt=Object.freeze({__proto__:null,getKeypointIndexBySide:function(t){switch(t){case Rdt.BlazePose:return xht;case Rdt.PoseNet:case Rdt.MoveNet:return wht;default:throw new Error("Model "+t+" is not supported.")}},getAdjacentPairs:function(t){switch(t){case Rdt.BlazePose:return _ht;case Rdt.PoseNet:case Rdt.MoveNet:return Sht;default:throw new Error("Model "+t+" is not supported.")}},getKeypointIndexByName:Fdt}),Bdt=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],Udt={modelType:"SinglePose.Lightning",enableSmoothing:!0},Vdt={},jdt={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},Wdt={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},Hdt={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function Gdt(t,e){var n,r,i,s;return t?e.width>e.height?(n=1,r=e.height/e.width,i=0,s=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,s=0):e.width>e.height?(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,s=0):(n=1,r=e.height/e.width,i=0,s=(e.width/2-e.height/2)/e.width),{yMin:i,xMin:s,yMax:i+n,xMax:s+r,height:n,width:r}}function qdt(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return null!=e.maxTracks&&(n.maxTracks=e.maxTracks),null!=e.maxAge&&(n.maxAge=e.maxAge),null!=e.minSimilarity&&(n.minSimilarity=e.minSimilarity),n}var Xdt=function(){function t(t,e){this.moveNetModel=t,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=Fdt(Rdt.MoveNet),"SinglePose.Lightning"===e.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===e.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===e.modelType,this.multiPoseModel||(this.keypointFilter=new adt(jdt),this.cropRegionFilterYMin=new sdt(.9),this.cropRegionFilterXMin=new sdt(.9),this.cropRegionFilterYMax=new sdt(.9),this.cropRegionFilterXMax=new sdt(.9)),this.enableSmoothing=e.enableSmoothing,e.minPoseScore?this.minPoseScore=e.minPoseScore:this.minPoseScore=.25,e.multiPoseMaxDimension?this.multiPoseMaxDimension=e.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=e.enableTracking,this.multiPoseModel&&this.enableTracking&&(e.trackerType===$dt.Keypoint?this.tracker=new Ddt(e.trackerConfig):e.trackerType===$dt.BoundingBox&&(this.tracker=new Ldt(e.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s;return ght(this,(function(o){switch(o.label){case 0:if(4!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||1!==e.shape[1]||17!==e.shape[2]||3!==e.shape[3])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===_r()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=o.sent(),o.label=3;case 3:for(e.dispose(),r={keypoints:[],score:0},i=0,s=0;s<17;++s)r.keypoints[s]={y:n[3*s],x:n[3*s+1],score:n[3*s+2]},r.keypoints[s].score>.2&&(++i,r.score+=r.keypoints[s].score);return i>0&&(r.score/=i),[2,r]}}))}))},t.prototype.runMultiPersonPoseModel=function(t){return mht(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l;return ght(this,(function(c){switch(c.label){case 0:if(3!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||56!==e.shape[2])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===_r()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=c.sent(),c.label=3;case 3:for(e.dispose(),r=[],i=n.length/56,s=0;s<i;++s)for(r[s]={keypoints:[]},o=56*s+51,r[s].box={yMin:n[o],xMin:n[o+1],yMax:n[o+2],xMax:n[o+3],width:n[o+3]-n[o+1],height:n[o+2]-n[o]},a=56*s+55,r[s].score=n[a],r[s].keypoints=[],l=0;l<17;++l)r[s].keypoints[l]={y:n[56*s+3*l],x:n[56*s+3*l+1],score:n[56*s+3*l+2]};return[2,r]}}))}))},t.prototype.estimatePoses=function(t,e,n){return void 0===e&&(e=Vdt),mht(this,void 0,void 0,(function(){var r,i,s,o,a,l;return ght(this,(function(c){switch(c.label){case 0:return e=function(t){return null==t?Vdt:fht({},t)}(e),null==t?(this.reset(),[2,[]]):(null==n?qht(t)&&(n=1e6*t.currentTime):n*=1e3,r=Lht(t),i=Oht(r),s=lo(r,0),t instanceof we||r.dispose(),o=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(s,i,n)]);case 1:return o=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(s,i,n)];case 3:o=c.sent(),c.label=4;case 4:for(a=0;a<o.length;++a)for(l=0;l<o[a].keypoints.length;++l)o[a].keypoints[l].name=bht[l],o[a].keypoints[l].y*=i.height,o[a].keypoints[l].x*=i.width;return[2,o]}}))}))},t.prototype.estimateSinglePose=function(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a=this;return ght(this,(function(l){switch(l.label){case 0:return this.cropRegion||(this.cropRegion=Gdt(null==this.cropRegion,e)),r=xr((function(){var e=xl([[a.cropRegion.yMin,a.cropRegion.xMin,a.cropRegion.yMax,a.cropRegion.xMax]]),n=Go([1],"int32"),r=[a.modelInputResolution.height,a.modelInputResolution.width];return Yn(Kc.cropAndResize(t,e,n,r,"bilinear",0),"int32")})),t.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(i=l.sent(),r.dispose(),i.score<this.minPoseScore)return this.reset(),[2,[]];for(s=0;s<i.keypoints.length;++s)i.keypoints[s].y=this.cropRegion.yMin+i.keypoints[s].y*this.cropRegion.height,i.keypoints[s].x=this.cropRegion.xMin+i.keypoints[s].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(i.keypoints=this.keypointFilter.apply(i.keypoints,n,1)),o=function(t,e,n,r){for(var i={},s=0,o=bht;s<o.length;s++){var a=o[s];i[a]=[e[n[a]].y*r.height,e[n[a]].x*r.width]}if(function(t,e){return(t[e.left_hip].score>.2||t[e.right_hip].score>.2)&&(t[e.left_shoulder].score>.2||t[e.right_shoulder].score>.2)}(e,n)){var l=(i.left_hip[0]+i.right_hip[0])/2,c=(i.left_hip[1]+i.right_hip[1])/2,u=function(t,e,n,r,i){for(var s=["left_shoulder","right_shoulder","left_hip","right_hip"],o=0,a=0,l=0;l<s.length;l++)(p=Math.abs(r-n[s[l]][0]))>o&&(o=p),(f=Math.abs(i-n[s[l]][1]))>a&&(a=f);for(var c=0,u=0,h=0,d=Object.keys(n);h<d.length;h++){var p,f,m=d[h];t[e[m]].score<.2||((p=Math.abs(r-n[m][0]))>c&&(c=p),(f=Math.abs(i-n[m][1]))>u&&(u=f))}return[o,a,c,u]}(e,n,i,l,c),h=u[0],d=u[1],p=u[2],f=u[3],m=Math.max(1.9*d,1.9*h,1.2*p,1.2*f),g=[l-(m=Math.min(m,Math.max(c,r.width-c,l,r.height-l))),c-m];if(m>Math.max(r.width,r.height)/2)return Gdt(null==t,r);var y=2*m;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+y)/r.height,xMax:(g[1]+y)/r.width,height:(g[0]+y)/r.height-g[0]/r.height,width:(g[1]+y)/r.width-g[1]/r.width}}return Gdt(null==t,r)}(this.cropRegion,i.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(o),[2,[i]]}}))}))},t.prototype.estimateMultiplePoses=function(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f=this;return ght(this,(function(m){switch(m.label){case 0:return e.width>e.height?(i=this.multiPoseMaxDimension,s=Math.round(this.multiPoseMaxDimension*e.height/e.width),r=Kc.resizeBilinear(t,[s,i]),a=i,l=32*Math.ceil(s/32),o=ia(r,[[0,0],[0,l-s],[0,0],[0,0]])):(i=Math.round(this.multiPoseMaxDimension*e.width/e.height),s=this.multiPoseMaxDimension,r=Kc.resizeBilinear(t,[s,i]),a=32*Math.ceil(i/32),l=s,o=ia(r,[[0,0],[0,0],[0,a-i],[0,0]])),r.dispose(),t.dispose(),c=Yn(o,"int32"),o.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(u=m.sent(),c.dispose(),u=u.filter((function(t){return t.score>=f.minPoseScore})),d=0;d<u.length;++d)for(h=0;h<u[d].keypoints.length;++h)u[d].keypoints[h].y*=l/s,u[d].keypoints[h].x*=a/i;if(this.enableTracking&&(this.tracker.apply(u,n),this.enableSmoothing)){for(d=0;d<u.length;++d)this.keypointFilterMap.has(u[d].id)||this.keypointFilterMap.set(u[d].id,new adt(jdt)),u[d].keypoints=this.keypointFilterMap.get(u[d].id).apply(u[d].keypoints,n,1);p=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(t,e){p.has(e)||f.keypointFilterMap.delete(e)}))}return[2,u]}}))}))},t.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),n=this.cropRegionFilterXMin.apply(t.xMin),r=this.cropRegionFilterYMax.apply(t.yMax),i=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:n,yMax:r,xMax:i,height:r-e,width:i-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function Ydt(t){return void 0===t&&(t=Udt),mht(this,void 0,void 0,(function(){var e,n,r,i;return ght(this,(function(s){switch(s.label){case 0:return e=function(t){var e,n=null==t?Udt:fht({},t);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(Bdt.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+Bdt);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=$dt.BoundingBox),n.trackerType===$dt.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(t){var e=qdt(Wdt,t);return e.keypointTrackerParams=fht({},Wdt.keypointTrackerParams),null!=t.keypointTrackerParams&&(null!=t.keypointTrackerParams.keypointConfidenceThreshold&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),null!=t.keypointTrackerParams.keypointFalloff&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),null!=t.keypointTrackerParams.minNumberOfKeypoints&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}(n.trackerConfig):n.trackerConfig=Wdt;else{if(n.trackerType!==$dt.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(e=n.trackerConfig,qdt(Hdt,e)):n.trackerConfig=Hdt}return n}(t),r=!0,e.modelUrl?(r="string"==typeof e.modelUrl&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,jY(e.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return i=void 0,"SinglePose.Lightning"===e.modelType?i="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===e.modelType?i="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===e.modelType&&(i="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,jY(i,{fromTFHub:r})];case 3:n=s.sent(),s.label=4;case 4:return"webgl"===_r()&&X().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new Xdt(n,e)]}}))}))}var Kdt={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},Zdt=["MobileNetV1","ResNet50"],Jdt={MobileNetV1:[8,16],ResNet50:[16]},Qdt=[8,16,32],tpt={MobileNetV1:[.5,.75,1],ResNet50:[1]},ept=[1,2,4],npt={maxPoses:1,flipHorizontal:!1},rpt={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},ipt=[-123.15,-115.9,-103.06];function spt(t){return Math.floor(t/2)}var opt=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(spt(t),t);)this.exchange(t,spt(t)),t=spt(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function apt(t,e,n,r,i,s){for(var o=s.shape,a=o[0],l=o[1],c=!0,u=Math.max(n-i,0),h=Math.min(n+i+1,a),d=u;d<h;++d){for(var p=Math.max(r-i,0),f=Math.min(r+i+1,l),m=p;m<f;++m)if(s.get(d,m,t)>e){c=!1;break}if(!c)break}return c}function lpt(t){return mht(this,void 0,void 0,(function(){return ght(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function cpt(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+17)}}function upt(t,e,n){var r=cpt(t.heatmapY,t.heatmapX,t.id,n),i=r.y,s=r.x;return{x:t.heatmapX*e+s,y:t.heatmapY*e+i}}function hpt(t,e,n,r){var i=n.x,s=n.y;return t.some((function(t){var n,o,a,l,c=t.keypoints;return n=s,o=i,(a=c[r].y-n)*a+(l=c[r].x-o)*l<=e}))}var dpt=bht.reduce((function(t,e,n){return t[e]=n,t}),{}),ppt=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(t){var e=t[0],n=t[1];return[dpt[e],dpt[n]]})),fpt=ppt.map((function(t){return t[1]})),mpt=ppt.map((function(t){return t[0]}));function gpt(t,e,n){return t<e?e:t>n?n:t}function ypt(t,e,n,r){return{y:gpt(Math.round(t.y/e),0,n-1),x:gpt(Math.round(t.x/e),0,r-1)}}function bpt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function vpt(t,e,n,r,i,s,o,a){void 0===a&&(a=2);for(var l=r.shape,c=l[0],u=l[1],h={y:e.y,x:e.x},d=bpt(h,function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,ypt(h,s,c,u),o)),p=0;p<a;p++){var f=ypt(d,s,c,u),m=cpt(f.y,f.x,n,i);d=bpt({x:f.x*s,y:f.y*s},{x:m.x,y:m.y})}var g=ypt(d,s,c,u),y=r.get(g.y,g.x,n);return{y:d.y,x:d.x,name:bht[n],score:y}}function xpt(t,e,n,r,i,s){var o=e.shape[2],a=fpt.length,l=new Array(o),c=t.part,u=t.score,h=upt(c,r,n);l[c.id]={score:u,name:bht[c.id],y:h.y,x:h.x};for(var d=a-1;d>=0;--d){var p=fpt[d],f=mpt[d];l[p]&&!l[f]&&(l[f]=vpt(d,l[p],f,e,n,r,s))}for(d=0;d<a;++d)p=mpt[d],f=fpt[d],l[p]&&!l[f]&&(l[f]=vpt(d,l[p],f,e,n,r,i));return l}function wpt(t,e,n){return n.reduce((function(n,r,i){var s=r.y,o=r.x,a=r.score;return hpt(t,e,{y:s,x:o},i)||(n+=a),n}),0)/n.length}function Spt(t,e,n,r,i,s,o,a){return void 0===o&&(o=.5),void 0===a&&(a=20),mht(this,void 0,void 0,(function(){var l,c,u,h,d,p,f,m,g,y,b,v;return ght(this,(function(x){switch(x.label){case 0:return[4,lpt([t,e,n,r])];case 1:for(l=x.sent(),c=l[0],u=l[1],h=l[2],d=l[3],p=[],f=function(t,e,n){for(var r=n.shape,i=r[0],s=r[1],o=r[2],a=new opt(i*s*o,(function(t){return t.score})),l=0;l<i;++l)for(var c=0;c<s;++c)for(var u=0;u<o;++u){var h=n.get(l,c,u);h<t||apt(u,h,l,c,1,n)&&a.enqueue({score:h,part:{heatmapY:l,heatmapX:c,id:u}})}return a}(o,0,c),m=a*a;p.length<s&&!f.empty();)g=f.dequeue(),y=upt(g.part,i,u),hpt(p,m,y,g.part.id)||(b=xpt(g,c,u,i,h,d),v=wpt(p,m,b),p.push({keypoints:b,score:v}));return[2,p]}}))}))}function _pt(t,e,n){return xr((function(){var r=function(t,e){for(var n=[],r=0;r<bht.length;r++){var i=kpt(t.get(r,0).valueOf(),t.get(r,1).valueOf(),r,e),s=i.x,o=i.y;n.push(o),n.push(s)}return xl(n,[bht.length,2])}(t,n);return vi(Yn(Si(t.toTensor(),to(e,"int32")),"float32"),r)}))}function kpt(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+bht.length)}}function Tpt(t,e,n){return mht(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d;return ght(this,(function(p){switch(p.label){case 0:return r=0,i=function(t){var e=t.shape,n=e[0],r=e[1],i=e[2];return xr((function(){var e,s,o=Ki(t,[n*r,i]),a=Ai(o,0),l=lo(wi(a,to(r,"int32")),1),c=lo((e=a,s=r,xr((function(){var t=wi(e,to(s,"int32"));return $o(e,Si(t,to(s,"int32")))}))),1);return Qi([l,c],1)}))}(t),[4,Promise.all([t.buffer(),e.buffer(),i.buffer()])];case 1:return s=p.sent(),o=s[0],a=s[1],l=s[2],[4,(c=_pt(l,n,a)).buffer()];case 2:return u=p.sent(),h=Array.from(function(t,e){for(var n=e.shape[0],r=new Float32Array(n),i=0;i<n;i++){var s=e.get(i,0),o=e.get(i,1);r[i]=t.get(s,o,i)}return r}(o,l)),d=h.map((function(t,e){return r+=t,{y:u.get(e,0),x:u.get(e,1),score:t,name:bht[e]}})),i.dispose(),c.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}function Ept(t,e){return(t-1)%e==0}var Mpt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Cpt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Apt(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var Npt=function(){function t(t,e){this.posenetModel=t;var n=this.posenetModel.inputs[0].shape;c(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var r,i,s=(r=e.inputResolution,i=e.outputStride,{height:Apt(r.height,i),width:Apt(r.width,i)});!function(t){c(Qdt.indexOf(t)>=0,(function(){return"outputStride of "+t+" is invalid. It must be either 8 or 16."}))}(e.outputStride),function(t,e){c(Ept(t.height,e),(function(){return"height of "+t.height+" is invalid for output stride "+e+"."})),c(Ept(t.width,e),(function(){return"width of "+t.width+" is invalid for output stride "+e+"."}))}(s,e.outputStride),this.inputResolution=s,this.outputStride=e.outputStride,this.architecture=e.architecture}return t.prototype.estimatePoses=function(t,e){return void 0===e&&(e=npt),mht(this,void 0,void 0,(function(){var n,r,i,s,o,a,l,c,u,h,d,p,f,m,g;return ght(this,(function(y){switch(y.label){case 0:return n=function(t){var e=t;if(null==e.maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1){if((e=fht(fht({},rpt),e)).scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+e.scoreThreshold+". Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius "+e.nmsRadius+".")}return e}(e),null==t?[2,[]]:(this.maxPoses=n.maxPoses,r=Hht(t,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),i=r.imageTensor,s=r.padding,o="ResNet50"===this.architecture?vi(i,ipt):Wht(i,[-1,1]),a=this.posenetModel.predict(o),"ResNet50"===this.architecture?(l=fl(a[2],[0]),c=fl(a[3],[0]),u=fl(a[0],[0]),h=fl(a[1],[0])):(l=fl(a[0],[0]),c=fl(a[1],[0]),u=fl(a[2],[0]),h=fl(a[3],[0])),d=ts(c),1!==this.maxPoses?[3,2]:[4,Tpt(d,l,this.outputStride)]);case 1:return f=y.sent(),p=[f],[3,4];case 2:return[4,Spt(d,l,u,h,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:p=y.sent(),y.label=4;case 4:return m=Oht(t),g=function(t,e,n,r){var i=e.height,s=e.width,o=i/(n.height*(1-r.top-r.bottom)),a=s/(n.width*(1-r.left-r.right)),l=-r.top*n.height,c=-r.left*n.width;if(1===a&&1===o&&0===l&&0===c)return t;for(var u=0,h=t;u<h.length;u++)for(var d=0,p=h[u].keypoints;d<p.length;d++){var f=p[d];f.x=(f.x+c)*a,f.y=(f.y+l)*o}return t}(p,m,this.inputResolution,s),n.flipHorizontal&&(g=function(t,e){for(var n=0,r=t;n<r.length;n++)for(var i=0,s=r[n].keypoints;i<s.length;i++){var o=s[i];o.x=e.width-1-o.x}return t}(g,m)),i.dispose(),o.dispose(),wr(a),l.dispose(),c.dispose(),u.dispose(),h.dispose(),d.dispose(),[2,g]}}))}))},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function Ipt(t){return void 0===t&&(t=Kdt),mht(this,void 0,void 0,(function(){var e,n,r,i,s;return ght(this,(function(o){switch(o.label){case 0:return"ResNet50"!==(e=function(t){var e=t||Kdt;if(null==e.architecture&&(e.architecture="MobileNetV1"),Zdt.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+Zdt);if(null==e.inputResolution&&(e.inputResolution={height:257,width:257}),null==e.outputStride&&(e.outputStride=16),Jdt[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+Jdt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),tpt[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+tpt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),ept.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+ept+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(t)).architecture?[3,2]:(a=e.outputStride,l=e.quantBytes,c="model-stride"+a+".json",n=4===l?Cpt+"float/"+c:Cpt+"quant"+l+"/"+c,[4,jY(e.modelUrl||n)]);case 1:return r=o.sent(),[2,new Npt(r,e)];case 2:return i=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+t+".json";return 4===n?Mpt+"float/"+r[e]+"/"+i:Mpt+"quant"+n+"/"+r[e]+"/"+i}(e.outputStride,e.multiplier,e.quantBytes),[4,jY(e.modelUrl||i)];case 3:return s=o.sent(),[2,new Npt(s,e)]}var a,l,c}))}))}const $pt={MoveNet:.35,PoseNet:.5,BlazePose:.65},Rpt=["#ffffff","#800000","#469990","#e6194b","#42d4f4","#fabed4","#aaffc3","#9a6324","#000075","#f58231","#4363d8","#ffd8b1","#dcbeff","#808000","#ffe119","#911eb4","#bfef45","#f032e6","#3cb44b","#a9a9a9"];class Opt{constructor(t,e){this.model=t,this.width=e,this.params={lineWidth:2,radius:4,scoreThreshold:$pt[t]},this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.width,this.ctx=this.canvas.getContext("2d")}drawKeypoint(t){if((null!=t.score?t.score:1)>=this.params.scoreThreshold){const e=new Path2D;e.arc(t.x,t.y,this.params.radius,0,2*Math.PI),this.ctx.fill(e),this.ctx.stroke(e)}}drawKeypoints(t){const e=zdt.getKeypointIndexBySide(this.model);this.ctx.fillStyle="Red",this.ctx.strokeStyle="White",this.ctx.lineWidth=this.params.lineWidth;for(const n of e.middle)this.drawKeypoint(t[n]);this.ctx.fillStyle="Green";for(const n of e.left)this.drawKeypoint(t[n]);this.ctx.fillStyle="Orange";for(const n of e.right)this.drawKeypoint(t[n])}drawSkeleton(t,e){const n=null!=e?Rpt[e%20]:"White";this.ctx.fillStyle=n,this.ctx.strokeStyle=n,this.ctx.lineWidth=this.params.lineWidth,zdt.getAdjacentPairs(this.model).forEach((([e,n])=>{const r=t[e],i=t[n],s=null!=r.score?r.score:1,o=null!=i.score?i.score:1,a=this.params.scoreThreshold||0;s>=a&&o>=a&&(this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke())}))}drawResult(t){if(null!=t.keypoints&&(this.drawKeypoints(t.keypoints),this.drawSkeleton(t.keypoints,t.id)),null!=t.keypoints3D)throw new Error("Keypoints 3D is not Implemented...")}drawResults(t){for(const e of t)this.drawResult(e)}drawImage(t){this.ctx.clearRect(0,0,t.width,t.width),this.canvas.height=t.height,this.canvas.width=t.width,this.ctx.putImageData(t,0,0)}render(t,e,n="ImageData"){return this.drawImage(t),this.drawResults(e),"ImageData"===n?this.ctx.getImageData(0,0,this.width,this.width):this.canvas.toDataURL("image/jpeg")}}function Ppt(t){let e,n,r;return{c(){e=UT("Using "),n=UT(t[2]),r=UT(" pose detector.")},m(t,i){LT(t,e,i),LT(t,n,i),LT(t,r,i)},p(t,e){4&e&&XT(n,t[2])},d(t){t&&DT(e),t&&DT(n),t&&DT(r)}}}function Lpt(t){let e;return{c(){e=UT("")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function Dpt(t){let e;function n(t,e){return t[3]?Lpt:Ppt}let r=n(t),i=r(t);return{c(){e=zT("p"),i.c(),GT(e,"class","p-2 text-sm text-gray-600")},m(t,n){LT(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&DT(e),i.d()}}}function Fpt(t){let e,n;return e=new zL({props:{title:t[0],loading:t[3],$$slots:{default:[Dpt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading=t[3]),28&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function zpt(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{model:l}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"model"in t&&n(2,l=t.model)},[o,a,l,r]}class Bpt extends QE{constructor(t){super(),JE(this,t,zpt,Fpt,gT,{title:0,loading:1,model:2})}}var Upt,Vpt,jpt;class Wpt extends MX{constructor(t="MoveNet",e){super(),this.model=t,this.modelConfig=e,this.title="Pose Detection",this.parameters={},this.serviceName="undefined",Upt.set(this,void 0),this.$loading=new rU(!0,!0),this.$bodyParts=new rU("Full body",!1),Vpt.set(this,void 0),jpt.set(this,void 0),HB(this,Vpt,new Opt(Rdt[t],224),"f"),HB(this,jpt,new Opt(Rdt[t],60),"f"),this.start(),this.setup(t,e)}async setup(t,e){HB(this,Upt,await function(t,e){return mht(this,void 0,void 0,(function(){var n,r;return ght(this,(function(i){switch(t){case Rdt.PoseNet:return[2,Ipt(e)];case Rdt.BlazePose:if(r=void 0,null!=(n=e)){if("tfjs"===n.runtime)return[2,Idt(e)];if("mediapipe"===n.runtime)return[2,Rht(e)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case Rdt.MoveNet:return[2,Ydt(e)];default:throw new Error(t+" is not a supported model name.")}}))}))}(Rdt[t],e),"f"),aU.info(`${t} loaded`),this.$loading.set(!1),this.start()}async predict(t){if(!WB(this,Upt,"f"))return aU.error("Movenet is not loaded"),[];return await WB(this,Upt,"f").estimatePoses(t)}postprocess(t,e){const n=e&&Array.isArray(e)&&e.length>0?(t,n)=>e.includes(n):()=>!0;return t.map((t=>{const e=t.keypoints[0];return t.keypoints.filter(n).reduce(((t,n)=>[...t,(n.x-e.x)/100,(n.y-e.y)/100]),[])})).reduce(((t,e)=>[...t,...e]),[])}thumbnail(t,e){return WB(this,jpt,"f").render(t,e,"dataURL")}render(t,e){return WB(this,Vpt,"f").render(t,e)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Bpt({target:e,props:{title:this.title,loading:this.$loading,model:this.model}}))}train(){throw new uU("Model `MobileNet` cannot be trained")}save(){throw new Error("MobileNet does not support saving")}load(){throw new Error("MobileNet does not support loading")}download(){throw new Error("MobileNet does not support downloading")}upload(){throw new Error("MobileNet does not support uploading")}}function Hpt(...t){return new Wpt(...t)}Upt=new WeakMap,Vpt=new WeakMap,jpt=new WeakMap,jB([cU],Wpt.prototype,"train",null),jB([cU],Wpt.prototype,"save",null),jB([cU],Wpt.prototype,"load",null),jB([cU],Wpt.prototype,"download",null),jB([cU],Wpt.prototype,"upload",null);var Gpt={},qpt={},Xpt={};const Ypt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Kpt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};function Zpt(){}Object.assign(Zpt.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});const Jpt=[];for(let t=0;t<256;t++)Jpt[t]=(t<16?"0":"")+t.toString(16);let Qpt=1234567;const tft={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Jpt[255&t]+Jpt[t>>8&255]+Jpt[t>>16&255]+Jpt[t>>24&255]+"-"+Jpt[255&e]+Jpt[e>>8&255]+"-"+Jpt[e>>16&15|64]+Jpt[e>>24&255]+"-"+Jpt[63&n|128]+Jpt[n>>8&255]+"-"+Jpt[n>>16&255]+Jpt[n>>24&255]+Jpt[255&r]+Jpt[r>>8&255]+Jpt[r>>16&255]+Jpt[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},damp:function(t,e,n,r){return tft.lerp(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(tft.euclideanModulo(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Qpt=t%2147483647),Qpt=16807*Qpt%2147483647,(Qpt-1)/2147483646},degToRad:function(t){return t*tft.DEG2RAD},radToDeg:function(t){return t*tft.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class eft{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class nft{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],b=r[4],v=r[7],x=r[2],w=r[5],S=r[8];return i[0]=s*f+o*y+a*x,i[3]=s*m+o*b+a*w,i[6]=s*g+o*v+a*S,i[1]=l*f+c*y+u*x,i[4]=l*m+c*b+u*w,i[7]=l*g+c*v+u*S,i[2]=h*f+d*y+p*x,i[5]=h*m+d*b+p*w,i[8]=h*g+d*v+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}let rft;const ift={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===rft&&(rft=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),rft.width=t.width,rft.height=t.height;const n=rft.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=rft}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let sft=0;function oft(t=oft.DEFAULT_IMAGE,e=oft.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,o=1023,a=1009,l=1,c=3e3){Object.defineProperty(this,"id",{value:sft++}),this.uuid=tft.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new eft(0,0),this.repeat=new eft(1,1),this.center=new eft(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}function aft(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ift.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}oft.DEFAULT_IMAGE=void 0,oft.DEFAULT_MAPPING=300,oft.prototype=Object.assign(Object.create(Zpt.prototype),{constructor:oft,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=tft.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(aft(r[t].image)):e.push(aft(r[t]))}else e=aft(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(oft.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class lft{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,y=(g+1)/2,b=(c+h)/4,v=(u+f)/4,x=(p+m)/4;return t>a&&t>y?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=b/n,i=v/n):a>y?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=b/r,i=x/r):y<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=v/i,r=x/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class cft extends Zpt{constructor(t,e,n){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=t,this.height=e,this.scissor=new lft(0,0,t,e),this.scissorTest=!1,this.viewport=new lft(0,0,t,e),n=n||{},this.texture=new oft(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setSize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class uft{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return n.copy(t).slerp(e,r)}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(u!==f||a!==h||l!==d||c!==p){let t=1-o;const e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tft.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class hft{constructor(t=0,e=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(pft.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(pft.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return dft.copy(this).projectOnVector(t),this.sub(dft)}reflect(t){return this.sub(dft.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(tft.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const dft=new hft,pft=new uft;class fft{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new hft(1/0,1/0,1/0),this.max=void 0!==e?e:new hft(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=yft.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new hft),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new hft),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),bft.copy(e.boundingBox),bft.applyMatrix4(t.matrixWorld),this.union(bft));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new hft),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,yft),yft.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Tft),Eft.subVectors(this.max,Tft),vft.subVectors(t.a,Tft),xft.subVectors(t.b,Tft),wft.subVectors(t.c,Tft),Sft.subVectors(xft,vft),_ft.subVectors(wft,xft),kft.subVectors(vft,wft);let e=[0,-Sft.z,Sft.y,0,-_ft.z,_ft.y,0,-kft.z,kft.y,Sft.z,0,-Sft.x,_ft.z,0,-_ft.x,kft.z,0,-kft.x,-Sft.y,Sft.x,0,-_ft.y,_ft.x,0,-kft.y,kft.x,0];return!!mft(e,vft,xft,wft,Eft)&&(e=[1,0,0,0,1,0,0,0,1],!!mft(e,vft,xft,wft,Eft)&&(Mft.crossVectors(Sft,_ft),e=[Mft.x,Mft.y,Mft.z],mft(e,vft,xft,wft,Eft)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new hft),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return yft.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(yft).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(gft[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),gft[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),gft[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),gft[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),gft[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),gft[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),gft[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),gft[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(gft)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function mft(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Cft.fromArray(t,s);const o=i.x*Math.abs(Cft.x)+i.y*Math.abs(Cft.y)+i.z*Math.abs(Cft.z),a=e.dot(Cft),l=n.dot(Cft),c=r.dot(Cft);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const gft=[new hft,new hft,new hft,new hft,new hft,new hft,new hft,new hft],yft=new hft,bft=new fft,vft=new hft,xft=new hft,wft=new hft,Sft=new hft,_ft=new hft,kft=new hft,Tft=new hft,Eft=new hft,Mft=new hft,Cft=new hft,Aft=new fft;class Nft{constructor(t,e){this.center=void 0!==t?t:new hft,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Aft.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new hft),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new fft),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const Ift=new hft,$ft=new hft,Rft=new hft,Oft=new hft,Pft=new hft,Lft=new hft,Dft=new hft;class Fft{constructor(t,e){this.origin=void 0!==t?t:new hft,this.direction=void 0!==e?e:new hft(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new hft),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ift)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new hft),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ift.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ift.copy(this.direction).multiplyScalar(e).add(this.origin),Ift.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){$ft.copy(t).add(e).multiplyScalar(.5),Rft.copy(e).sub(t).normalize(),Oft.copy(this.origin).sub($ft);const i=.5*t.distanceTo(e),s=-this.direction.dot(Rft),o=Oft.dot(this.direction),a=-Oft.dot(Rft),l=Oft.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=i*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Rft).multiplyScalar(h).add($ft),d}intersectSphere(t,e){Ift.subVectors(t.center,this.origin);const n=Ift.dot(this.direction),r=Ift.dot(Ift)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r?null:((i>n||n!=n)&&(n=i),(s<r||r!=r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Ift)}intersectTriangle(t,e,n,r,i){Pft.subVectors(e,t),Lft.subVectors(n,t),Dft.crossVectors(Pft,Lft);let s,o=this.direction.dot(Dft);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Oft.subVectors(this.origin,t);const a=s*this.direction.dot(Lft.crossVectors(Oft,Lft));if(a<0)return null;const l=s*this.direction.dot(Pft.cross(Oft));if(l<0)return null;if(a+l>o)return null;const c=-s*Oft.dot(Dft);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class zft{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new zft).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Bft.setFromMatrixColumn(t,0).length(),i=1/Bft.setFromMatrixColumn(t,1).length(),s=1/Bft.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Vft,t,jft)}lookAt(t,e,n){const r=this.elements;return Gft.subVectors(t,e),0===Gft.lengthSq()&&(Gft.z=1),Gft.normalize(),Wft.crossVectors(n,Gft),0===Wft.lengthSq()&&(1===Math.abs(n.z)?Gft.x+=1e-4:Gft.z+=1e-4,Gft.normalize(),Wft.crossVectors(n,Gft)),Wft.normalize(),Hft.crossVectors(Gft,Wft),r[0]=Wft.x,r[4]=Hft.x,r[8]=Gft.x,r[1]=Wft.y,r[5]=Hft.y,r[9]=Gft.y,r[2]=Wft.z,r[6]=Hft.z,r[10]=Gft.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],b=n[7],v=n[11],x=n[15],w=r[0],S=r[4],_=r[8],k=r[12],T=r[1],E=r[5],M=r[9],C=r[13],A=r[2],N=r[6],I=r[10],$=r[14],R=r[3],O=r[7],P=r[11],L=r[15];return i[0]=s*w+o*T+a*A+l*R,i[4]=s*S+o*E+a*N+l*O,i[8]=s*_+o*M+a*I+l*P,i[12]=s*k+o*C+a*$+l*L,i[1]=c*w+u*T+h*A+d*R,i[5]=c*S+u*E+h*N+d*O,i[9]=c*_+u*M+h*I+d*P,i[13]=c*k+u*C+h*$+d*L,i[2]=p*w+f*T+m*A+g*R,i[6]=p*S+f*E+m*N+g*O,i[10]=p*_+f*M+m*I+g*P,i[14]=p*k+f*C+m*$+g*L,i[3]=y*w+b*T+v*A+x*R,i[7]=y*S+b*E+v*N+x*O,i[11]=y*_+b*M+v*I+x*P,i[15]=y*k+b*C+v*$+x*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*d-i*s*u+n*s*d+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,b=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,v=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,x=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,w=e*y+n*b+r*v+i*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/w;return t[0]=y*S,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*S,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*S,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*d-n*a*d)*S,t[4]=b*S,t[5]=(c*m*i-p*h*i+p*r*d-e*m*d-c*r*g+e*h*g)*S,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*S,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*d+e*a*d)*S,t[8]=v*S,t[9]=(p*u*i-c*f*i-p*n*d+e*f*d+c*n*g-e*u*g)*S,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*S,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*d-e*o*d)*S,t[12]=x*S,t[13]=(c*f*r-p*u*r+p*n*h-e*f*h-c*n*m+e*u*m)*S,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*S,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*S,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,d=i*c,p=i*u,f=s*c,m=s*u,g=o*u,y=a*l,b=a*c,v=a*u,x=n.x,w=n.y,S=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+v)*x,r[2]=(p-b)*x,r[3]=0,r[4]=(d-v)*w,r[5]=(1-(h+g))*w,r[6]=(m+y)*w,r[7]=0,r[8]=(p+b)*S,r[9]=(m-y)*S,r[10]=(1-(h+f))*S,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Bft.set(r[0],r[1],r[2]).length();const s=Bft.set(r[4],r[5],r[6]).length(),o=Bft.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Uft.copy(this);const a=1/i,l=1/s,c=1/o;return Uft.elements[0]*=a,Uft.elements[1]*=a,Uft.elements[2]*=a,Uft.elements[4]*=l,Uft.elements[5]*=l,Uft.elements[6]*=l,Uft.elements[8]*=c,Uft.elements[9]*=c,Uft.elements[10]*=c,e.setFromRotationMatrix(Uft),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),d=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,i,s){const o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,d=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Bft=new hft,Uft=new zft,Vft=new hft(0,0,0),jft=new hft(1,1,1),Wft=new hft,Hft=new hft,Gft=new hft;class qft{constructor(t=0,e=0,n=0,r=qft.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const r=tft.clamp,i=t.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Xft.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Xft,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return Yft.setFromEuler(this),this.setFromQuaternion(Yft,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new hft(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}qft.DefaultOrder="XYZ",qft.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Xft=new zft,Yft=new uft;class Kft{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Zft=0;const Jft=new hft,Qft=new uft,tmt=new zft,emt=new hft,nmt=new hft,rmt=new hft,imt=new uft,smt=new hft(1,0,0),omt=new hft(0,1,0),amt=new hft(0,0,1),lmt={type:"added"},cmt={type:"removed"};function umt(){Object.defineProperty(this,"id",{value:Zft++}),this.uuid=tft.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=umt.DefaultUp.clone();const t=new hft,e=new qft,n=new uft,r=new hft(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new zft},normalMatrix:{value:new nft}}),this.matrix=new zft,this.matrixWorld=new zft,this.matrixAutoUpdate=umt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Kft,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}umt.DefaultUp=new hft(0,1,0),umt.DefaultMatrixAutoUpdate=!0,umt.prototype=Object.assign(Object.create(Zpt.prototype),{constructor:umt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Qft.setFromAxisAngle(t,e),this.quaternion.multiply(Qft),this},rotateOnWorldAxis:function(t,e){return Qft.setFromAxisAngle(t,e),this.quaternion.premultiply(Qft),this},rotateX:function(t){return this.rotateOnAxis(smt,t)},rotateY:function(t){return this.rotateOnAxis(omt,t)},rotateZ:function(t){return this.rotateOnAxis(amt,t)},translateOnAxis:function(t,e){return Jft.copy(t).applyQuaternion(this.quaternion),this.position.add(Jft.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(smt,t)},translateY:function(t){return this.translateOnAxis(omt,t)},translateZ:function(t){return this.translateOnAxis(amt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(tmt.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?emt.copy(t):emt.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),nmt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tmt.lookAt(nmt,emt,this.up):tmt.lookAt(emt,nmt,this.up),this.quaternion.setFromRotationMatrix(tmt),r&&(tmt.extractRotation(r.matrixWorld),Qft.setFromRotationMatrix(tmt),this.quaternion.premultiply(Qft.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(lmt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(cmt)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(cmt)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),tmt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),tmt.multiply(t.parent.matrixWorld)),t.applyMatrix4(tmt),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new hft),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new uft),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nmt,t,rmt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new hft),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nmt,imt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new hft),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}});const hmt=new hft,dmt=new hft,pmt=new nft;class fmt{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new hft(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=hmt.subVectors(n,e).cross(dmt.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new hft),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new hft);const n=t.delta(hmt),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new hft),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||pmt.getNormalMatrix(t),r=this.coplanarPoint(hmt).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const mmt=new hft,gmt=new hft,ymt=new hft,bmt=new hft,vmt=new hft,xmt=new hft,wmt=new hft,Smt=new hft,_mt=new hft,kmt=new hft;class Tmt{constructor(t,e,n){this.a=void 0!==t?t:new hft,this.b=void 0!==e?e:new hft,this.c=void 0!==n?n:new hft}static getNormal(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new hft),r.subVectors(n,e),mmt.subVectors(t,e),r.cross(mmt);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){mmt.subVectors(r,e),gmt.subVectors(n,e),ymt.subVectors(t,e);const s=mmt.dot(mmt),o=mmt.dot(gmt),a=mmt.dot(ymt),l=gmt.dot(gmt),c=gmt.dot(ymt),u=s*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new hft),0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,bmt),bmt.x>=0&&bmt.y>=0&&bmt.x+bmt.y<=1}static getUV(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,bmt),a.set(0,0),a.addScaledVector(i,bmt.x),a.addScaledVector(s,bmt.y),a.addScaledVector(o,bmt.z),a}static isFrontFacing(t,e,n,r){return mmt.subVectors(n,e),gmt.subVectors(t,e),mmt.cross(gmt).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return mmt.subVectors(this.c,this.b),gmt.subVectors(this.a,this.b),.5*mmt.cross(gmt).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new hft),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Tmt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new fmt),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Tmt.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return Tmt.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return Tmt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Tmt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new hft);const n=this.a,r=this.b,i=this.c;let s,o;vmt.subVectors(r,n),xmt.subVectors(i,n),Smt.subVectors(t,n);const a=vmt.dot(Smt),l=xmt.dot(Smt);if(a<=0&&l<=0)return e.copy(n);_mt.subVectors(t,r);const c=vmt.dot(_mt),u=xmt.dot(_mt);if(c>=0&&u<=c)return e.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(vmt,s);kmt.subVectors(t,i);const d=vmt.dot(kmt),p=xmt.dot(kmt);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(xmt,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return wmt.subVectors(i,r),o=(u-c)/(u-c+(d-p)),e.copy(r).addScaledVector(wmt,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(vmt,s).addScaledVector(xmt,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Emt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mmt={h:0,s:0,l:0},Cmt={h:0,s:0,l:0};function Amt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Nmt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Imt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class $mt{constructor(t,e,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=tft.euclideanModulo(t,1),e=tft.clamp(e,0,1),n=tft.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Amt(i,r,t+1/3),this.g=Amt(i,r,t),this.b=Amt(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Emt[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Nmt(t.r),this.g=Nmt(t.g),this.b=Nmt(t.b),this}copyLinearToSRGB(t){return this.r=Imt(t.r),this.g=Imt(t.g),this.b=Imt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),s=Math.min(e,n,r);let o,a;const l=(s+i)/2;if(s===i)o=0,a=0;else{const t=i-s;switch(a=l<=.5?t/(i+s):t/(2-i-s),i){case e:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-e)/t+2;break;case r:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(Mmt),Mmt.h+=t,Mmt.s+=e,Mmt.l+=n,this.setHSL(Mmt.h,Mmt.s,Mmt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Mmt),t.getHSL(Cmt);const n=tft.lerp(Mmt.h,Cmt.h,e),r=tft.lerp(Mmt.s,Cmt.s,e),i=tft.lerp(Mmt.l,Cmt.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}$mt.NAMES=Emt,$mt.prototype.r=1,$mt.prototype.g=1,$mt.prototype.b=1;class Rmt{constructor(t,e,n,r,i,s=0){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new hft,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new $mt,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let Omt=0;function Pmt(){Object.defineProperty(this,"id",{value:Omt++}),this.uuid=tft.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Lmt(t){Pmt.call(this),this.type="MeshBasicMaterial",this.color=new $mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Pmt.prototype=Object.assign(Object.create(Zpt.prototype),{constructor:Pmt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Pmt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Lmt.prototype=Object.create(Pmt.prototype),Lmt.prototype.constructor=Lmt,Lmt.prototype.isMeshBasicMaterial=!0,Lmt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const Dmt=new hft,Fmt=new eft;function zmt(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Bmt(t,e,n){zmt.call(this,new Int8Array(t),e,n)}function Umt(t,e,n){zmt.call(this,new Uint8Array(t),e,n)}function Vmt(t,e,n){zmt.call(this,new Uint8ClampedArray(t),e,n)}function jmt(t,e,n){zmt.call(this,new Int16Array(t),e,n)}function Wmt(t,e,n){zmt.call(this,new Uint16Array(t),e,n)}function Hmt(t,e,n){zmt.call(this,new Int32Array(t),e,n)}function Gmt(t,e,n){zmt.call(this,new Uint32Array(t),e,n)}function qmt(t,e,n){zmt.call(this,new Uint16Array(t),e,n)}function Xmt(t,e,n){zmt.call(this,new Float32Array(t),e,n)}function Ymt(t,e,n){zmt.call(this,new Float64Array(t),e,n)}function Kmt(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(zmt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(zmt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new $mt),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new eft),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new hft),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new lft),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Fmt.fromBufferAttribute(this,e),Fmt.applyMatrix3(t),this.setXY(e,Fmt.x,Fmt.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Dmt.fromBufferAttribute(this,e),Dmt.applyMatrix3(t),this.setXYZ(e,Dmt.x,Dmt.y,Dmt.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)Dmt.x=this.getX(e),Dmt.y=this.getY(e),Dmt.z=this.getZ(e),Dmt.applyMatrix4(t),this.setXYZ(e,Dmt.x,Dmt.y,Dmt.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)Dmt.x=this.getX(e),Dmt.y=this.getY(e),Dmt.z=this.getZ(e),Dmt.applyNormalMatrix(t),this.setXYZ(e,Dmt.x,Dmt.y,Dmt.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)Dmt.x=this.getX(e),Dmt.y=this.getY(e),Dmt.z=this.getZ(e),Dmt.transformDirection(t),this.setXYZ(e,Dmt.x,Dmt.y,Dmt.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Bmt.prototype=Object.create(zmt.prototype),Bmt.prototype.constructor=Bmt,Umt.prototype=Object.create(zmt.prototype),Umt.prototype.constructor=Umt,Vmt.prototype=Object.create(zmt.prototype),Vmt.prototype.constructor=Vmt,jmt.prototype=Object.create(zmt.prototype),jmt.prototype.constructor=jmt,Wmt.prototype=Object.create(zmt.prototype),Wmt.prototype.constructor=Wmt,Hmt.prototype=Object.create(zmt.prototype),Hmt.prototype.constructor=Hmt,Gmt.prototype=Object.create(zmt.prototype),Gmt.prototype.constructor=Gmt,qmt.prototype=Object.create(zmt.prototype),qmt.prototype.constructor=qmt,qmt.prototype.isFloat16BufferAttribute=!0,Xmt.prototype=Object.create(zmt.prototype),Xmt.prototype.constructor=Xmt,Ymt.prototype=Object.create(zmt.prototype),Ymt.prototype.constructor=Ymt;const Zmt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Jmt(t,e){return new Zmt[t](e)}let Qmt=0;const tgt=new zft,egt=new umt,ngt=new hft,rgt=new fft,igt=new fft,sgt=new hft;function ogt(){Object.defineProperty(this,"id",{value:Qmt++}),this.uuid=tft.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ogt.prototype=Object.assign(Object.create(Zpt.prototype),{constructor:ogt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(Kmt(t)>65535?Gmt:Wmt)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new nft).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return tgt.makeRotationX(t),this.applyMatrix4(tgt),this},rotateY:function(t){return tgt.makeRotationY(t),this.applyMatrix4(tgt),this},rotateZ:function(t){return tgt.makeRotationZ(t),this.applyMatrix4(tgt),this},translate:function(t,e,n){return tgt.makeTranslation(t,e,n),this.applyMatrix4(tgt),this},scale:function(t,e,n){return tgt.makeScale(t,e,n),this.applyMatrix4(tgt),this},lookAt:function(t){return egt.lookAt(t),egt.updateMatrix(),this.applyMatrix4(egt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ngt).negate(),this.translate(ngt.x,ngt.y,ngt.z),this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Xmt(e,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new fft);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new hft(-1/0,-1/0,-1/0),new hft(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];rgt.setFromBufferAttribute(n),this.morphTargetsRelative?(sgt.addVectors(this.boundingBox.min,rgt.min),this.boundingBox.expandByPoint(sgt),sgt.addVectors(this.boundingBox.max,rgt.max),this.boundingBox.expandByPoint(sgt)):(this.boundingBox.expandByPoint(rgt.min),this.boundingBox.expandByPoint(rgt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Nft);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new hft,1/0);if(t){const n=this.boundingSphere.center;if(rgt.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];igt.setFromBufferAttribute(n),this.morphTargetsRelative?(sgt.addVectors(rgt.min,igt.min),rgt.expandByPoint(sgt),sgt.addVectors(rgt.max,igt.max),rgt.expandByPoint(sgt)):(rgt.expandByPoint(igt.min),rgt.expandByPoint(igt.max))}rgt.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)sgt.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(sgt));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)sgt.fromBufferAttribute(s,e),o&&(ngt.fromBufferAttribute(t,e),sgt.add(ngt)),r=Math.max(r,n.distanceToSquared(sgt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,r=e.position.array,i=e.normal.array,s=e.uv.array,o=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new zmt(new Float32Array(4*o),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new hft,c[t]=new hft;const u=new hft,h=new hft,d=new hft,p=new eft,f=new eft,m=new eft,g=new hft,y=new hft;function b(t,e,n){u.fromArray(r,3*t),h.fromArray(r,3*e),d.fromArray(r,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),y.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(y),c[e].add(y),c[n].add(y))}let v=this.groups;0===v.length&&(v=[{start:0,count:n.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)b(n[t+0],n[t+1],n[t+2])}const x=new hft,w=new hft,S=new hft,_=new hft;function k(t){S.fromArray(i,3*t),_.copy(S);const e=l[t];x.copy(e),x.sub(S.multiplyScalar(S.dot(e))).normalize(),w.crossVectors(_,e);const n=w.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=n}for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)k(n[t+0]),k(n[t+1]),k(n[t+2])}},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new zmt(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new hft,i=new hft,s=new hft,o=new hft,a=new hft,l=new hft,c=new hft,u=new hft;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)sgt.fromBufferAttribute(t,e),sgt.normalize(),t.setXYZ(e,sgt.x,sgt.y,sgt.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let t=0,i=e.length;t<i;t++){o=e[t]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new zmt(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ogt,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),t.data.attributes[e]=i}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),s.push(i)}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t},clone:function(){return(new ogt).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const agt=new zft,lgt=new Fft,cgt=new Nft,ugt=new hft,hgt=new hft,dgt=new hft,pgt=new hft,fgt=new hft,mgt=new hft,ggt=new hft,ygt=new hft,bgt=new hft,vgt=new eft,xgt=new eft,wgt=new eft,Sgt=new hft,_gt=new hft;function kgt(t=new ogt,e=new Lmt){umt.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function Tgt(t,e,n,r,i,s,o,a,l,c,u,h){ugt.fromBufferAttribute(i,c),hgt.fromBufferAttribute(i,u),dgt.fromBufferAttribute(i,h);const d=t.morphTargetInfluences;if(e.morphTargets&&s&&d){ggt.set(0,0,0),ygt.set(0,0,0),bgt.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(pgt.fromBufferAttribute(n,c),fgt.fromBufferAttribute(n,u),mgt.fromBufferAttribute(n,h),o?(ggt.addScaledVector(pgt,e),ygt.addScaledVector(fgt,e),bgt.addScaledVector(mgt,e)):(ggt.addScaledVector(pgt.sub(ugt),e),ygt.addScaledVector(fgt.sub(hgt),e),bgt.addScaledVector(mgt.sub(dgt),e)))}ugt.add(ggt),hgt.add(ygt),dgt.add(bgt)}t.isSkinnedMesh&&(t.boneTransform(c,ugt),t.boneTransform(u,hgt),t.boneTransform(h,dgt));const p=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,2!==e.side,a),null===l)return null;_gt.copy(a),_gt.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(_gt);return c<n.near||c>n.far?null:{distance:c,point:_gt.clone(),object:t}}(t,e,n,r,ugt,hgt,dgt,Sgt);if(p){a&&(vgt.fromBufferAttribute(a,c),xgt.fromBufferAttribute(a,u),wgt.fromBufferAttribute(a,h),p.uv=Tmt.getUV(Sgt,ugt,hgt,dgt,vgt,xgt,wgt,new eft)),l&&(vgt.fromBufferAttribute(l,c),xgt.fromBufferAttribute(l,u),wgt.fromBufferAttribute(l,h),p.uv2=Tmt.getUV(Sgt,ugt,hgt,dgt,vgt,xgt,wgt,new eft));const t=new Rmt(c,u,h);Tmt.getNormal(ugt,hgt,dgt,t.normal),p.face=t}return p}kgt.prototype=Object.assign(Object.create(umt.prototype),{constructor:kgt,isMesh:!0,copy:function(t){return umt.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),cgt.copy(n.boundingSphere),cgt.applyMatrix4(i),!1===t.ray.intersectsSphere(cgt))return;if(agt.copy(i).invert(),lgt.copy(t.ray).applyMatrix4(agt),null!==n.boundingBox&&!1===lgt.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);s=Tgt(this,f,t,lgt,o,a,l,c,u,r,h,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);s=Tgt(this,r,t,lgt,o,a,l,c,u,h,d,p),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){s=Tgt(this,p,t,lgt,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),i=Math.min(o.count,d.start+d.count);n<i;n+=3){s=Tgt(this,r,t,lgt,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class Egt extends ogt{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,y){const b=s/m,v=p/g,x=s/2,w=p/2,S=f/2,_=m+1,k=g+1;let T=0,E=0;const M=new hft;for(let s=0;s<k;s++){const o=s*v-w;for(let a=0;a<_;a++){const h=a*b-x;M[t]=h*r,M[e]=o*i,M[n]=S,l.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+_*t,r=h+e+_*(t+1),i=h+(e+1)+_*(t+1),s=h+(e+1)+_*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(d,E,y),d+=E,h+=T}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Xmt(l,3)),this.setAttribute("normal",new Xmt(c,3)),this.setAttribute("uv",new Xmt(u,2))}}function Mgt(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Cgt(t){const e={};for(let n=0;n<t.length;n++){const r=Mgt(t[n]);for(const t in r)e[t]=r[t]}return e}const Agt={clone:Mgt,merge:Cgt};function Ngt(t){Pmt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Igt(){umt.call(this),this.type="Camera",this.matrixWorldInverse=new zft,this.projectionMatrix=new zft,this.projectionMatrixInverse=new zft}function $gt(t=50,e=1,n=.1,r=2e3){Igt.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Ngt.prototype=Object.create(Pmt.prototype),Ngt.prototype.constructor=Ngt,Ngt.prototype.isShaderMaterial=!0,Ngt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Mgt(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},Ngt.prototype.toJSON=function(t){const e=Pmt.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},Igt.prototype=Object.assign(Object.create(umt.prototype),{constructor:Igt,isCamera:!0,copy:function(t,e){return umt.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new hft),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){umt.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){umt.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),$gt.prototype=Object.assign(Object.create(Igt.prototype),{constructor:$gt,isPerspectiveCamera:!0,copy:function(t,e){return Igt.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*tft.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*tft.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*tft.RAD2DEG*Math.atan(Math.tan(.5*tft.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*tft.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=umt.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function Rgt(t,e,n){if(umt.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new $gt(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new hft(1,0,0)),this.add(r);const i=new $gt(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new hft(-1,0,0)),this.add(i);const s=new $gt(90,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new hft(0,1,0)),this.add(s);const o=new $gt(90,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new hft(0,-1,0)),this.add(o);const a=new $gt(90,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new hft(0,0,1)),this.add(a);const l=new $gt(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new hft(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c}}function Ogt(t,e,n,r,i,s,o,a,l,c){t=void 0!==t?t:[],e=void 0!==e?e:301,o=void 0!==o?o:1022,oft.call(this,t,e,n,r,i,s,o,a,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}Rgt.prototype=Object.create(umt.prototype),Rgt.prototype.constructor=Rgt,Ogt.prototype=Object.create(oft.prototype),Ogt.prototype.constructor=Ogt,Ogt.prototype.isCubeTexture=!0,Object.defineProperty(Ogt.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});class Pgt extends cft{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),e=e||{},this.texture=new Ogt(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=1023,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Egt(5,5,5),i=new Ngt({name:"CubemapFromEquirect",uniforms:Mgt(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const s=new kgt(r,i),o=e.minFilter;1008===e.minFilter&&(e.minFilter=1006);return new Rgt(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}function Lgt(t,e,n,r,i,s,o,a,l,c,u,h){oft.call(this,null,s,o,a,l,c,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==c?c:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Lgt.prototype=Object.create(oft.prototype),Lgt.prototype.constructor=Lgt,Lgt.prototype.isDataTexture=!0;const Dgt=new Nft,Fgt=new hft;class zgt{constructor(t,e,n,r,i,s){this.planes=[void 0!==t?t:new fmt,void 0!==e?e:new fmt,void 0!==n?n:new fmt,void 0!==r?r:new fmt,void 0!==i?i:new fmt,void 0!==s?s:new fmt]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],y=n[14],b=n[15];return e[0].setComponents(o-r,u-a,f-h,b-m).normalize(),e[1].setComponents(o+r,u+a,f+h,b+m).normalize(),e[2].setComponents(o+i,u+l,f+d,b+g).normalize(),e[3].setComponents(o-i,u-l,f-d,b-g).normalize(),e[4].setComponents(o-s,u-c,f-p,b-y).normalize(),e[5].setComponents(o+s,u+c,f+p,b+y).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Dgt.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Dgt)}intersectsSprite(t){return Dgt.center.set(0,0,0),Dgt.radius=.7071067811865476,Dgt.applyMatrix4(t.matrixWorld),this.intersectsSphere(Dgt)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Fgt.x=r.normal.x>0?t.max.x:t.min.x,Fgt.y=r.normal.y>0?t.max.y:t.min.y,Fgt.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Fgt)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}function Bgt(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ugt(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=r.get(e);void 0===s?r.set(e,function(e,r){const i=e.array,s=e.usage,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,i,s),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):s.version<e.version&&(!function(e,r,i){const s=r.array,o=r.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,s):(n?t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,i),s.version=e.version)}}}class Vgt extends ogt{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,c=a+1,u=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-s;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new Xmt(p,3)),this.setAttribute("normal",new Xmt(f,3)),this.setAttribute("uv",new Xmt(m,2))}}const jgt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Wgt={common:{diffuse:{value:new $mt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new nft},uv2Transform:{value:new nft},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new eft(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $mt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $mt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new nft}},sprite:{diffuse:{value:new $mt(15658734)},opacity:{value:1},center:{value:new eft(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new nft}}},Hgt={basic:{uniforms:Cgt([Wgt.common,Wgt.specularmap,Wgt.envmap,Wgt.aomap,Wgt.lightmap,Wgt.fog]),vertexShader:jgt.meshbasic_vert,fragmentShader:jgt.meshbasic_frag},lambert:{uniforms:Cgt([Wgt.common,Wgt.specularmap,Wgt.envmap,Wgt.aomap,Wgt.lightmap,Wgt.emissivemap,Wgt.fog,Wgt.lights,{emissive:{value:new $mt(0)}}]),vertexShader:jgt.meshlambert_vert,fragmentShader:jgt.meshlambert_frag},phong:{uniforms:Cgt([Wgt.common,Wgt.specularmap,Wgt.envmap,Wgt.aomap,Wgt.lightmap,Wgt.emissivemap,Wgt.bumpmap,Wgt.normalmap,Wgt.displacementmap,Wgt.fog,Wgt.lights,{emissive:{value:new $mt(0)},specular:{value:new $mt(1118481)},shininess:{value:30}}]),vertexShader:jgt.meshphong_vert,fragmentShader:jgt.meshphong_frag},standard:{uniforms:Cgt([Wgt.common,Wgt.envmap,Wgt.aomap,Wgt.lightmap,Wgt.emissivemap,Wgt.bumpmap,Wgt.normalmap,Wgt.displacementmap,Wgt.roughnessmap,Wgt.metalnessmap,Wgt.fog,Wgt.lights,{emissive:{value:new $mt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jgt.meshphysical_vert,fragmentShader:jgt.meshphysical_frag},toon:{uniforms:Cgt([Wgt.common,Wgt.aomap,Wgt.lightmap,Wgt.emissivemap,Wgt.bumpmap,Wgt.normalmap,Wgt.displacementmap,Wgt.gradientmap,Wgt.fog,Wgt.lights,{emissive:{value:new $mt(0)}}]),vertexShader:jgt.meshtoon_vert,fragmentShader:jgt.meshtoon_frag},matcap:{uniforms:Cgt([Wgt.common,Wgt.bumpmap,Wgt.normalmap,Wgt.displacementmap,Wgt.fog,{matcap:{value:null}}]),vertexShader:jgt.meshmatcap_vert,fragmentShader:jgt.meshmatcap_frag},points:{uniforms:Cgt([Wgt.points,Wgt.fog]),vertexShader:jgt.points_vert,fragmentShader:jgt.points_frag},dashed:{uniforms:Cgt([Wgt.common,Wgt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jgt.linedashed_vert,fragmentShader:jgt.linedashed_frag},depth:{uniforms:Cgt([Wgt.common,Wgt.displacementmap]),vertexShader:jgt.depth_vert,fragmentShader:jgt.depth_frag},normal:{uniforms:Cgt([Wgt.common,Wgt.bumpmap,Wgt.normalmap,Wgt.displacementmap,{opacity:{value:1}}]),vertexShader:jgt.normal_vert,fragmentShader:jgt.normal_frag},sprite:{uniforms:Cgt([Wgt.sprite,Wgt.fog]),vertexShader:jgt.sprite_vert,fragmentShader:jgt.sprite_frag},background:{uniforms:{uvTransform:{value:new nft},t2D:{value:null}},vertexShader:jgt.background_vert,fragmentShader:jgt.background_frag},cube:{uniforms:Cgt([Wgt.envmap,{opacity:{value:1}}]),vertexShader:jgt.cube_vert,fragmentShader:jgt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jgt.equirect_vert,fragmentShader:jgt.equirect_frag},distanceRGBA:{uniforms:Cgt([Wgt.common,Wgt.displacementmap,{referencePosition:{value:new hft},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jgt.distanceRGBA_vert,fragmentShader:jgt.distanceRGBA_frag},shadow:{uniforms:Cgt([Wgt.lights,Wgt.fog,{color:{value:new $mt(0)},opacity:{value:1}}]),vertexShader:jgt.shadow_vert,fragmentShader:jgt.shadow_frag}};function Ggt(t,e,n,r,i){const s=new $mt(0);let o,a,l=0,c=null,u=0,h=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(s,l)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?d(s,l):m&&m.isColor&&(d(m,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||306===m.mapping)?(void 0===a&&(a=new kgt(new Egt(1,1,1),new Ngt({name:"BackgroundCubeMaterial",uniforms:Mgt(Hgt.cube.uniforms),vertexShader:Hgt.cube.vertexShader,fragmentShader:Hgt.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,c===m&&u===m.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=m,u=m.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new kgt(new Vgt(2,2),new Ngt({name:"BackgroundMaterial",uniforms:Mgt(Hgt.background.uniforms),vertexShader:Hgt.background.vertexShader,fragmentShader:Hgt.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&u===m.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=m,u=m.version,h=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function qgt(t,e,n,r){const i=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=d(null);let c=l;function u(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==i){(r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function g(){const e=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function y(e,n,i,s,o,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,s,o,a):t.vertexAttribIPointer(e,n,i,o,a)}function b(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,b,v){let x=!1;if(o){const e=function(e,n,i){const o=!0===i.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];void 0===u&&(u=d(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u);return u}(b,h,l);c!==e&&(c=e,u(c.object)),x=function(t,e){const n=c.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],s=r[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;i++}return c.attributesNum!==i||c.index!==e}(b,v),x&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,i++}c.attributes=n,c.attributesNum=i,c.index=e}(b,v)}else{const t=!0===l.wireframe;c.geometry===b.id&&c.program===h.id&&c.wireframe===t||(c.geometry=b.id,c.program=h.id,c.wireframe=t,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==v&&n.update(v,34963),x&&(!function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const r=c[e];if(r>=0){const s=l[e];if(void 0!==s){const e=s.normalized,i=s.itemSize,o=n.get(s);if(void 0===o)continue;const l=o.buffer,c=o.type,u=o.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,o=n.stride,h=s.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),t.bindBuffer(34962,l),y(r,i,c,e,o*u,h*u)}else s.isInstancedBufferAttribute?(m(r,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):f(r),t.bindBuffer(34962,l),y(r,i,c,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const s=e.buffer,o=e.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(r+0,4,o,!1,64,0),t.vertexAttribPointer(r+1,4,o,!1,64,16),t.vertexAttribPointer(r+2,4,o,!1,64,32),t.vertexAttribPointer(r+3,4,o,!1,64,48)}else if("instanceColor"===e){const e=n.get(i.instanceColor);if(void 0===e)continue;const s=e.buffer,o=e.type;m(r,1),t.bindBuffer(34962,s),t.vertexAttribPointer(r,3,o,!1,12,0)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}g()}(i,l,h,b),null!==v&&t.bindBuffer(34963,n.get(v).buffer))},reset:b,resetDefaultState:v,dispose:function(){b();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Xgt(t,e,n,r){const i=r.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,r){t.drawArrays(s,e,r),n.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(i)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),n.update(o,s,a)}}function Ygt(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),y=u>0,b=s||!!e.get("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:s?t.getParameter(36183):0}}function Kgt(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new fmt,a=new nft,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=r;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(i,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==r||i;return i=e,n=u(t,s,0),r=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||s&&!p)s?u(null):c();else{const t=s?0:r,e=4*t;let i=f.clippingState||null;l.value=i,i=u(h,o,e,a);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Zgt(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(303===s||304===s){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=t.getRenderList(),a=t.getRenderTarget(),l=new Pgt(s.height/2);return l.fromEquirectangularTexture(t,i),e.set(i,l),t.setRenderTarget(a),t.setRenderList(o),i.addEventListener("dispose",r),n(l.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}function Jgt(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Qgt(t,e,n,r){const i={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(Kmt(n)>65535?Gmt:Wmt)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function tyt(t,e,n,r){const i=r.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(s,r,o,e*a),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,r*a,c),n.update(l,s,c)}}function eyt(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function nyt(t,e){return t[0]-e[0]}function ryt(t,e){return Math.abs(e[1])-Math.abs(t[1])}function iyt(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,s,o,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=e[s.id];if(void 0===u){u=[];for(let t=0;t<c;t++)u[t]=[t,0];e[s.id]=u}for(let t=0;t<c;t++){const e=u[t];e[0]=t,e[1]=l[t]}u.sort(ryt);for(let t=0;t<8;t++)t<c&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(nyt);const h=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal;let p=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],o=e[1];i!==Number.MAX_SAFE_INTEGER&&o?(h&&s.getAttribute("morphTarget"+t)!==h[i]&&s.setAttribute("morphTarget"+t,h[i]),d&&s.getAttribute("morphNormal"+t)!==d[i]&&s.setAttribute("morphNormal"+t,d[i]),n[t]=o,p+=o):(h&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),d&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),n[t]=0)}const f=s.morphTargetsRelative?1:1-p;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function syt(t,e,n,r){let i=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=r.render.frame,a=t.geometry,l=e.get(t,a);return i.get(l)!==o&&(e.update(l),i.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}function oyt(t=null,e=1,n=1,r=1){oft.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ayt(t=null,e=1,n=1,r=1){oft.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Hgt.physical={uniforms:Cgt([Hgt.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new eft(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new $mt(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:jgt.meshphysical_vert,fragmentShader:jgt.meshphysical_frag},oyt.prototype=Object.create(oft.prototype),oyt.prototype.constructor=oyt,oyt.prototype.isDataTexture2DArray=!0,ayt.prototype=Object.create(oft.prototype),ayt.prototype.constructor=ayt,ayt.prototype.isDataTexture3D=!0;const lyt=new oft,cyt=new oyt,uyt=new ayt,hyt=new Ogt,dyt=[],pyt=[],fyt=new Float32Array(16),myt=new Float32Array(9),gyt=new Float32Array(4);function yyt(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=dyt[i];if(void 0===s&&(s=new Float32Array(i),dyt[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function byt(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function vyt(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function xyt(t,e){let n=pyt[e];void 0===n&&(n=new Int32Array(e),pyt[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function wyt(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Syt(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(byt(n,e))return;t.uniform2fv(this.addr,e),vyt(n,e)}}function _yt(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(byt(n,e))return;t.uniform3fv(this.addr,e),vyt(n,e)}}function kyt(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(byt(n,e))return;t.uniform4fv(this.addr,e),vyt(n,e)}}function Tyt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(byt(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),vyt(n,e)}else{if(byt(n,r))return;gyt.set(r),t.uniformMatrix2fv(this.addr,!1,gyt),vyt(n,r)}}function Eyt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(byt(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),vyt(n,e)}else{if(byt(n,r))return;myt.set(r),t.uniformMatrix3fv(this.addr,!1,myt),vyt(n,r)}}function Myt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(byt(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),vyt(n,e)}else{if(byt(n,r))return;fyt.set(r),t.uniformMatrix4fv(this.addr,!1,fyt),vyt(n,r)}}function Cyt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||lyt,i)}function Ayt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||cyt,i)}function Nyt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||uyt,i)}function Iyt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||hyt,i)}function $yt(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ryt(t,e){const n=this.cache;byt(n,e)||(t.uniform2iv(this.addr,e),vyt(n,e))}function Oyt(t,e){const n=this.cache;byt(n,e)||(t.uniform3iv(this.addr,e),vyt(n,e))}function Pyt(t,e){const n=this.cache;byt(n,e)||(t.uniform4iv(this.addr,e),vyt(n,e))}function Lyt(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Dyt(t,e){t.uniform1fv(this.addr,e)}function Fyt(t,e){t.uniform1iv(this.addr,e)}function zyt(t,e){t.uniform2iv(this.addr,e)}function Byt(t,e){t.uniform3iv(this.addr,e)}function Uyt(t,e){t.uniform4iv(this.addr,e)}function Vyt(t,e){const n=yyt(e,this.size,2);t.uniform2fv(this.addr,n)}function jyt(t,e){const n=yyt(e,this.size,3);t.uniform3fv(this.addr,n)}function Wyt(t,e){const n=yyt(e,this.size,4);t.uniform4fv(this.addr,n)}function Hyt(t,e){const n=yyt(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Gyt(t,e){const n=yyt(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function qyt(t,e){const n=yyt(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Xyt(t,e,n){const r=e.length,i=xyt(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||lyt,i[t])}function Yyt(t,e,n){const r=e.length,i=xyt(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||hyt,i[t])}function Kyt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return wyt;case 35664:return Syt;case 35665:return _yt;case 35666:return kyt;case 35674:return Tyt;case 35675:return Eyt;case 35676:return Myt;case 5124:case 35670:return $yt;case 35667:case 35671:return Ryt;case 35668:case 35672:return Oyt;case 35669:case 35673:return Pyt;case 5125:return Lyt;case 35678:case 36198:case 36298:case 36306:case 35682:return Cyt;case 35679:case 36299:case 36307:return Nyt;case 35680:case 36300:case 36308:case 36293:return Iyt;case 36289:case 36303:case 36311:case 36292:return Ayt}}(e.type)}function Zyt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Dyt;case 35664:return Vyt;case 35665:return jyt;case 35666:return Wyt;case 35674:return Hyt;case 35675:return Gyt;case 35676:return qyt;case 5124:case 35670:return Fyt;case 35667:case 35671:return zyt;case 35668:case 35672:return Byt;case 35669:case 35673:return Uyt;case 35678:case 36198:case 36298:case 36306:case 35682:return Xyt;case 35680:case 36300:case 36308:case 36293:return Yyt}}(e.type)}function Jyt(t){this.id=t,this.seq=[],this.map={}}Zyt.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),vyt(e,t)},Jyt.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}};const Qyt=/(\w+)(\])?(\[|\.)?/g;function tbt(t,e){t.seq.push(e),t.map[e.id]=e}function ebt(t,e,n){const r=t.name,i=r.length;for(Qyt.lastIndex=0;;){const s=Qyt.exec(r),o=Qyt.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){tbt(n,void 0===c?new Kyt(a,t,e):new Zyt(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Jyt(a),tbt(n,t)),n=t}}}function nbt(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);ebt(n,t.getUniformLocation(e,n.name),this)}}function rbt(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}nbt.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},nbt.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},nbt.upload=function(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},nbt.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let ibt=0;function sbt(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function obt(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function abt(t,e){const n=sbt(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function lbt(t,e){const n=sbt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function cbt(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ubt(t){return""!==t}function hbt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function dbt(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const pbt=/^[ \t]*#include +<([\w\d./]+)>/gm;function fbt(t){return t.replace(pbt,mbt)}function mbt(t,e){const n=jgt[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return fbt(n)}const gbt=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ybt=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function bbt(t){return t.replace(ybt,xbt).replace(gbt,vbt)}function vbt(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),xbt(t,e,n,r)}function xbt(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function wbt(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Sbt(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ubt).join("\n")}(n),f=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),m=i.createProgram();let g,y,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(ubt).join("\n"),g.length>0&&(g+="\n"),y=[p,f].filter(ubt).join("\n"),y.length>0&&(y+="\n")):(g=[wbt(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ubt).join("\n"),y=[p,wbt(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?jgt.tonemapping_pars_fragment:"",0!==n.toneMapping?cbt("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",jgt.encodings_pars_fragment,n.map?abt("mapTexelToLinear",n.mapEncoding):"",n.matcap?abt("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?abt("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?abt("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?abt("lightMapTexelToLinear",n.lightMapEncoding):"",lbt("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ubt).join("\n")),o=fbt(o),o=hbt(o,n),o=dbt(o,n),a=fbt(a),a=hbt(a,n),a=dbt(a,n),o=bbt(o),a=bbt(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const v=b+y+a,x=rbt(i,35633,b+g+o),w=rbt(i,35632,v);if(i.attachShader(m,x),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(m).trim(),e=i.getShaderInfoLog(x).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,s=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const e=obt(i,x,"vertex"),n=obt(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:y}})}let S,_;return i.deleteShader(x),i.deleteShader(w),this.getUniforms=function(){return void 0===S&&(S=new nbt(i,m)),S},this.getAttributes=function(){return void 0===_&&(_=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(i,m)),_},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=ibt++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}function _bt(t,e,n,r,i,s){const o=[],a=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=3e3,e}return{getParameters:function(i,o,f,g,y){const b=g.fog,v=i.isMeshStandardMaterial?g.environment:null,x=e.get(i.envMap||v),w=p[i.type],S=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=u,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(y):0;let _,k;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),w){const t=Hgt[w];_=t.vertexShader,k=t.fragmentShader}else _=i.vertexShader,k=i.fragmentShader;const T=t.getRenderTarget();return{isWebGL2:a,shaderID:w,shaderName:i.type,vertexShader:_,fragmentShader:k,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:h,outputEncoding:null!==T?m(T.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&S>0,maxBones:S,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)n.push(e[f[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=p[t.type];let n;if(e){const t=Hgt[e];n=Agt.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=o.length;t<e;t++){const e=o[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new Sbt(t,n,e,i),o.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=o.indexOf(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function kbt(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function Tbt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ebt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Mbt(t){const e=[];let n=0;const r=[],i=[],s={id:-1};function o(r,i,o,a,l,c){let u=e[n];const h=t.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).push(c)},unshift:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).unshift(c)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||Tbt),i.length>1&&i.sort(e||Ebt)}}}function Cbt(t){let e=new WeakMap;return{get:function(n,r){const i=e.get(n);let s;return void 0===i?(s=new Mbt(t),e.set(n,new WeakMap),e.get(n).set(r,s)):(s=i.get(r),void 0===s&&(s=new Mbt(t),i.set(r,s))),s},dispose:function(){e=new WeakMap}}}function Abt(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new hft,color:new $mt};break;case"SpotLight":n={position:new hft,direction:new hft,color:new $mt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new hft,color:new $mt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new hft,skyColor:new $mt,groundColor:new $mt};break;case"RectAreaLight":n={color:new $mt,position:new hft,halfWidth:new hft,halfHeight:new hft}}return t[e.id]=n,n}}}let Nbt=0;function Ibt(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function $bt(t,e){const n=new Abt,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eft};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eft,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new hft);const s=new hft,o=new zft,a=new zft;return{setup:function(s){let o=0,a=0,l=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;s.sort(Ibt);for(let t=0,e=s.length;t<e;t++){const e=s[t],y=e.color,b=e.intensity,v=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=y.r*b,a+=y.g*b,l+=y.b*b;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],b);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=x,i.directionalShadowMatrix[c]=e.shadow.matrix,f++}i.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(y).multiplyScalar(b),t.distance=v,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=e.shadow.matrix,g++}i.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(y).multiplyScalar(b),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[d]=t,d++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=e.shadow.matrix,m++}i.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(b),t.groundColor.copy(e.groundColor).multiplyScalar(b),i.hemi[p]=t,p++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Wgt.LTC_FLOAT_1,i.rectAreaLTC2=Wgt.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Wgt.LTC_HALF_1,i.rectAreaLTC2=Wgt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=a,i.ambient[2]=l;const y=i.hash;y.directionalLength===c&&y.pointLength===u&&y.spotLength===h&&y.rectAreaLength===d&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===m&&y.numSpotShadows===g||(i.directional.length=c,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,y.directionalLength=c,y.pointLength=u,y.spotLength=h,y.rectAreaLength=d,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=m,y.numSpotShadows=g,i.version=Nbt++)},setupView:function(t,e){let n=0,r=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function Rbt(t,e){const n=new $bt(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function Obt(t,e){let n=new WeakMap;return{get:function(r,i=0){let s;return!1===n.has(r)?(s=new Rbt(t,e),n.set(r,[]),n.get(r).push(s)):i>=n.get(r).length?(s=new Rbt(t,e),n.get(r).push(s)):s=n.get(r)[i],s},dispose:function(){n=new WeakMap}}}function Pbt(t){Pmt.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Lbt(t){Pmt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new hft,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Pbt.prototype=Object.create(Pmt.prototype),Pbt.prototype.constructor=Pbt,Pbt.prototype.isMeshDepthMaterial=!0,Pbt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Lbt.prototype=Object.create(Pmt.prototype),Lbt.prototype.constructor=Lbt,Lbt.prototype.isMeshDistanceMaterial=!0,Lbt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function Dbt(t,e,n){let r=new zgt;const i=new eft,s=new eft,o=new lft,a=[],l=[],c={},u={0:1,1:0,2:2},h=new Ngt({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new eft},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new ogt;p.setAttribute("position",new zmt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new kgt(p,h),m=this;function g(n,r){const i=e.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,f,null)}function y(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new Pbt({depthPacking:3201,morphTargets:t,skinning:e}),a[r]=i),i}function b(t,e,n){const r=t<<0|e<<1|n<<2;let i=l[r];return void 0===i&&(i=new Lbt({morphTargets:t,skinning:e}),l[r]=i),i}function v(e,n,r,i,s,o,a){let l=null,h=y,d=e.customDepthMaterial;if(!0===i.isPointLight&&(h=b,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e));l=h(t,i,!0===e.isInstancedMesh)}else l=d;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=l.uuid,e=r.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let i=n[e];void 0===i&&(i=l.clone(),n[e]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=s,l.farDistance=o),l}function x(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=i[c.materialIndex];if(u&&u.visible){const e=v(n,r,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,c)}}}else if(i.visible){const e=v(n,r,i,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)x(l[t],i,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,a,l){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let c=0,u=e.length;c<u;c++){const u=e[c],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),s.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(s.x=Math.floor(n/p.x),i.x=s.x*p.x,h.mapSize.x=s.x),i.y>n&&(s.y=Math.floor(n/p.y),i.y=s.y*p.y,h.mapSize.y=s.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const t={minFilter:1006,magFilter:1006,format:1023};h.map=new cft(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new cft(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:1003,magFilter:1003,format:1023};h.map=new cft(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),h.updateMatrices(u,t),r=h.getFrustum(),x(a,l,h.camera,u,this.type)}h.isPointLightShadow||3!==this.type||g(h,l),h.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(c,u,h)}}function Fbt(t,e,n){const r=n.isWebGL2;const i=new function(){let e=!1;const n=new lft;let r=null;const i=new lft(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?R(2929):O(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},o=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?R(2960):O(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}};let a={},l=null,c=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,y=!1,b=null,v=null,x=null,w=null,S=null;const _=t.getParameter(35661);let k=!1,T=0;const E=t.getParameter(7938);-1!==E.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(E)[1]),k=T>=1):-1!==E.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(E)[1]),k=T>=2);let M=null,C={};const A=new lft,N=new lft;function I(e,n,r){const i=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return s}const $={};function R(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function O(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}$[3553]=I(3553,3553,1),$[34067]=I(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),o.setClear(0),R(2929),s.setFunc(3),F(!1),z(1),R(2884),D(0);const P={100:32774,101:32778,102:32779};if(r)P[103]=32775,P[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(P[103]=t.MIN_EXT,P[104]=t.MAX_EXT)}const L={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function D(e,n,r,i,s,o,a,l){if(0!==e){if(c||(R(3042),c=!0),5===e)s=s||n,o=o||r,a=a||i,n===h&&s===f||(t.blendEquationSeparate(P[n],P[s]),h=n,f=s),r===d&&i===p&&o===m&&a===g||(t.blendFuncSeparate(L[r],L[i],L[o],L[a]),d=r,p=i,m=o,g=a),u=e,y=null;else if(e!==u||l!==y){if(100===h&&100===f||(t.blendEquation(32774),h=100,f=100),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}d=null,p=null,m=null,g=null,u=e,y=l}}else c&&(O(3042),c=!1)}function F(e){b!==e&&(e?t.frontFace(2304):t.frontFace(2305),b=e)}function z(e){0!==e?(R(2884),e!==v&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):O(2884),v=e}function B(e,n,r){e?(R(32823),w===n&&S===r||(t.polygonOffset(n,r),w=n,S=r)):O(32823)}function U(e){void 0===e&&(e=33984+_-1),M!==e&&(t.activeTexture(e),M=e)}return{buffers:{color:i,depth:s,stencil:o},enable:R,disable:O,useProgram:function(e){return l!==e&&(t.useProgram(e),l=e,!0)},setBlending:D,setMaterial:function(t,e){2===t.side?O(2884):R(2884);let n=1===t.side;e&&(n=!n),F(n),1===t.blending&&!1===t.transparent?D(0):D(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const r=t.stencilWrite;o.setTest(r),r&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),B(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:F,setCullFace:z,setLineWidth:function(e){e!==x&&(k&&t.lineWidth(e),x=e)},setPolygonOffset:B,setScissorTest:function(t){t?R(3089):O(3089)},activeTexture:U,bindTexture:function(e,n){null===M&&U();let r=C[M];void 0===r&&(r={type:void 0,texture:void 0},C[M]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||$[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=C[M];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===A.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),A.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){a={},M=null,C={},l=null,c=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,y=!1,b=null,v=null,x=null,w=null,S=null,i.reset(),s.reset(),o.reset()}}}function zbt(t,e,n,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?tft.floorPowerOfTwo:Math.floor,s=r(i*t.width),o=r(i*t.height);void 0===p&&(p=m(s,o));const a=n?m(s,o):p;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return tft.isPowerOfTwo(t.width)&&tft.isPowerOfTwo(t.height)}function b(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function v(e,n,i,s){t.generateMipmap(e);r.get(n).__maxMipLevel=Math.log(Math.max(i,s))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),6407===r&&(5126===i&&(s=34837),5131===i&&(s=34843),5121===i&&(s=32849)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function w(t){return 1003===t||1004===t||1005===t?9728:9729}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&d.delete(n),o.memory.textures--}function _(e){const n=e.target;n.removeEventListener("dispose",_),function(e){const n=r.get(e),i=r.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}(n),o.memory.textures--}let k=0;function T(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void I(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function E(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;N(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=o||l?l?r.image[t].image:r.image[t]:g(r.image[t],!1,!0,c);const h=u[0],d=y(h)||a,p=s.convert(r.format),f=s.convert(r.type),m=x(r.internalFormat,p,f);let w;if(A(34067,r,d),o){for(let t=0;t<6;t++){w=u[t].mipmaps;for(let e=0;e<w.length;e++){const i=w[e];1023!==r.format&&1022!==r.format?null!==p?n.compressedTexImage2D(34069+t,e,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,m,i.width,i.height,0,p,f,i.data)}}e.__maxMipLevel=w.length-1}else{w=r.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,p,f,u[t].data);for(let e=0;e<w.length;e++){const r=w[e].image[t].image;n.texImage2D(34069+t,e+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+t,0,m,p,f,u[t]);for(let e=0;e<w.length;e++){const r=w[e];n.texImage2D(34069+t,e+1,m,p,f,r.image[t])}}e.__maxMipLevel=w.length}b(r,d)&&v(34067,r,h.width,h.height);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}const M={1e3:10497,1001:33071,1002:33648},C={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function A(n,s,o){o?(t.texParameteri(n,10242,M[s.wrapS]),t.texParameteri(n,10243,M[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,M[s.wrapR]),t.texParameteri(n,10240,C[s.magFilter]),t.texParameteri(n,10241,C[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===s.wrapS&&1001===s.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,w(s.magFilter)),t.texParameteri(n,10241,w(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=e.get("EXT_texture_filter_anisotropic");if(l){if(1015===s.type&&null===e.get("OES_texture_float_linear"))return;if(1016===s.type&&null===(a||e.get("OES_texture_half_float_linear")))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function N(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",S),e.__webglTexture=t.createTexture(),o.memory.textures++)}function I(e,r,i){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),N(e,r),n.activeTexture(33984+i),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const l=function(t){return!a&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(r)&&!1===y(r.image),c=g(r.image,l,!1,u),h=y(c)||a,d=s.convert(r.format);let p,f=s.convert(r.type),m=x(r.internalFormat,d,f);A(o,r,h);const w=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=s.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=s.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(r.isDataTexture)if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)p=w[t],n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=w.length;t<e;t++)p=w[t],1023!==r.format&&1022!==r.format?null!==d?n.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);e.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)p=w[t],n.texImage2D(3553,t,m,d,f,p);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,d,f,c),e.__maxMipLevel=0;b(r,h)&&v(o,r,c.width,c.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function $(e,i,o,a){const l=s.convert(i.texture.format),c=s.convert(i.texture.type),u=x(i.texture.internalFormat,l,c);n.texImage2D(a,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,a,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function R(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(1015===e.type?i=36012:1014===e.type&&(i=33190));const r=P(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=s.convert(n.texture.format),i=s.convert(n.texture.type),o=x(n.texture.internalFormat,e,i);if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,o,n.width,n.height)}else t.renderbufferStorage(36161,o,n.width,n.height)}t.bindRenderbuffer(36161,null)}function O(e){const n=r.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)t.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),R(n.__webglDepthbuffer[r],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),R(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function P(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let L=!1,D=!1;this.allocateTextureUnit=function(){const t=k;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),k+=1,t},this.resetTextureUnits=function(){k=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(e){const i=r.get(e),l=r.get(e.texture);e.addEventListener("dispose",_),l.__webglTexture=t.createTexture(),o.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=y(e)||a;if(!a||1022!==e.texture.format||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=s.convert(e.texture.format),r=s.convert(e.texture.type),o=x(e.texture.internalFormat,n,r),a=P(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),R(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),A(34067,e.texture,h);for(let t=0;t<6;t++)$(i.__webglFramebuffer[t],e,36064,34069+t);b(e.texture,h)&&v(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),A(3553,e.texture,h),$(i.__webglFramebuffer,e,36064,3553),b(e.texture,h)&&v(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(b(e,y(t)||a)){const i=t.isWebGLCubeRenderTarget?34067:3553,s=r.get(e).__webglTexture;n.bindTexture(i,s),v(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const i=e.width,s=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024),t.blitFramebuffer(0,0,i,s,0,0,i,s,o,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===L&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),L=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),t=t.texture),E(t,e)}}function Bbt(t,e,n){const r=n.isWebGL2;return{convert:function(t){let n;if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):1020===t?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Ubt(t=[]){$gt.call(this),this.cameras=t}function Vbt(){umt.call(this),this.type="Group"}function jbt(){this._targetRay=null,this._grip=null,this._hand=null}function Wbt(t,e){const n=this;let r=null,i=1,s=null,o="local-floor",a=null;const l=[],c=new Map,u=new $gt;u.layers.enable(1),u.viewport=new lft;const h=new $gt;h.layers.enable(2),h.viewport=new lft;const d=[u,h],p=new Ubt;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(t){const e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function y(){c.forEach((function(t,e){t.disconnect(e)})),c.clear(),f=null,m=null,t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),_.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(t){const e=r.inputSources;for(let t=0;t<l.length;t++)c.set(e[t],l[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=c.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),c.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=c.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=l[t];return void 0===e&&(e=new jbt,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=l[t];return void 0===e&&(e=new jbt,l[t]=e),e.getGripSpace()},this.getHand=function(t){let e=l[t];return void 0===e&&(e=new jbt,l[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=async function(t){if(r=t,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",y),r.addEventListener("inputsourceschange",b);const t=e.getContextAttributes();!0!==t.xrCompatible&&await e.makeXRCompatible();const a={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},l=new XRWebGLLayer(r,e,a);r.updateRenderState({baseLayer:l}),s=await r.requestReferenceSpace(o),_.setContext(r),_.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const v=new hft,x=new hft;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){p.near=h.near=u.near=t.near,p.far=h.far=u.far=t.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const e=t.parent,n=p.cameras;w(p,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(p.matrixWorld),t.matrix.copy(p.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){v.setFromMatrixPosition(e.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);const r=v.distanceTo(x),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,y=a+f,b=d-m,w=p+(r-m),S=l*a/y*g,_=c*a/y*g;t.projectionMatrix.makePerspective(b,w,S,_,g,y)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let S=null;const _=new Bgt;_.setAnimationLoop((function(e,n){if(a=n.getViewerPose(s),null!==a){const e=a.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let t=0;t<e.length;t++){const r=e[t],s=n.getViewport(r),o=d[t];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===t&&p.matrix.copy(o.matrix),!0===i&&p.cameras.push(o)}}const i=r.inputSources;for(let t=0;t<l.length;t++){const e=l[t],r=i[t];e.update(r,n,s)}S&&S(e,n)})),this.setAnimationLoop=function(t){S=t},this.dispose=function(){}}function Hbt(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,s;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,s){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,s):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Gbt(t){const e=void 0!==(t=t||{}).canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,y=0,b=0,v=null,x=null,w=-1,S=null;const _=new lft,k=new lft;let T=null,E=e.width,M=e.height,C=1,A=null,N=null;const I=new lft(0,0,E,M),$=new lft(0,0,E,M);let R=!1;const O=new zgt;let P=!1,L=!1;const D=new zft,F=new hft,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function B(){return null===v?C:1}let U,V,j,W,H,G,q,X,Y,K,Z,J,Q,tt,et,nt,rt,it,st,ot,at,lt=n;function ct(t,n){for(let r=0;r<t.length;r++){const i=t[r],s=e.getContext(i,n);if(null!==s)return s}return null}try{const t={alpha:r,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===lt){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),lt=ct(e,t),null===lt)throw ct(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===lt.getShaderPrecisionFormat&&(lt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){U=new Jgt(lt),V=new Ygt(lt,U,t),U.init(V),ot=new Bbt(lt,U,V),j=new Fbt(lt,U,V),j.scissor(k.copy($).multiplyScalar(C).floor()),j.viewport(_.copy(I).multiplyScalar(C).floor()),W=new eyt,H=new kbt,G=new zbt(lt,U,j,H,V,ot,W),q=new Zgt(f),X=new Ugt(lt,V),at=new qgt(lt,U,X,V),Y=new Qgt(lt,X,W,at),K=new syt(lt,Y,X,W),rt=new iyt(lt),et=new Kgt(H),Z=new _bt(f,q,U,V,at,et),J=new Hbt(H),Q=new Cbt(H),tt=new Obt(U,V),nt=new Ggt(f,q,j,K,a),it=new Xgt(lt,U,W,V),st=new tyt(lt,U,W,V),W.programs=Z.programs,f.capabilities=V,f.extensions=U,f.properties=H,f.renderLists=Q,f.state=j,f.info=W}ut();const ht=new Wbt(f,lt);this.xr=ht;const dt=new Dbt(f,K,V.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ut()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),H.remove(t)}(e)}function gt(t){const e=H.get(t).program;void 0!==e&&Z.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return lt},this.getContextAttributes=function(){return lt.getContextAttributes()},this.forceContextLoss=function(){const t=U.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=U.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(E,M,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new eft),t.set(E,M)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,M=n,e.width=Math.floor(t*C),e.height=Math.floor(n*C),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new eft),t.set(E*C,M*C).floor()},this.setDrawingBufferSize=function(t,n,r){E=t,M=n,C=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new lft),t.copy(_)},this.getViewport=function(t){return t.copy(I)},this.setViewport=function(t,e,n,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,n,r),j.viewport(_.copy(I).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy($)},this.setScissor=function(t,e,n,r){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,r),j.scissor(k.copy($).multiplyScalar(C).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(t){j.setScissorTest(R=t)},this.setOpaqueSort=function(t){A=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new $mt),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),lt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",ft,!1),Q.dispose(),tt.dispose(),H.dispose(),q.dispose(),K.dispose(),at.dispose(),ht.dispose(),bt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=H.get(t);t.hasPositions&&!n.position&&(n.position=lt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=lt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=lt.createBuffer()),t.hasColors&&!n.color&&(n.color=lt.createBuffer());const r=e.getAttributes();t.hasPositions&&(lt.bindBuffer(34962,n.position),lt.bufferData(34962,t.positionArray,35048),at.enableAttribute(r.position),lt.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(lt.bindBuffer(34962,n.normal),lt.bufferData(34962,t.normalArray,35048),at.enableAttribute(r.normal),lt.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(lt.bindBuffer(34962,n.uv),lt.bufferData(34962,t.uvArray,35048),at.enableAttribute(r.uv),lt.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(lt.bindBuffer(34962,n.color),lt.bufferData(34962,t.colorArray,35048),at.enableAttribute(r.color),lt.vertexAttribPointer(r.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),lt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=z);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=_t(t,e,r,i);j.setMaterial(r,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=Y.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,l);let d=it;null!==l&&(u=X.get(l),d=st,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==s?s.start*h:0,y=null!==s?s.count*h:1/0,b=Math.max(f,g),v=Math.min(p,f+m,g+y)-1,x=Math.max(0,v-b+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*B()),d.setMode(1)):d.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),j.setLineWidth(t*B()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(b,x,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(b,x,t)}else d.render(b,x)}},this.compile=function(t,e){d=tt.get(t),d.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights();const n=new WeakMap;t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];!1===n.has(s)&&(St(s,t,e),n.set(s))}else!1===n.has(r)&&(St(r,t,e),n.set(r))}))};let yt=null;const bt=new Bgt;function vt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||O.intersectsSprite(t)){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);const e=K.update(t),i=t.material;i.visible&&h.push(t,e,i,n,F.z,null)}}else if(t.isImmediateRenderObject)r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D),h.push(t,null,t.material,n,F.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==W.render.frame&&(t.skeleton.update(),t.skeleton.frame=W.render.frame),!t.frustumCulled||O.intersectsObject(t))){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);const e=K.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,F.z,o)}}else i.visible&&h.push(t,e,i,n,F.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)vt(i[t],e,n,r)}function xt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];o.layers.test(r.layers)&&(j.viewport(_.copy(r.viewport)),d.setupLightsView(r),wt(o,e,r,a,l,c))}}else wt(o,e,n,a,l,c)}}function wt(t,e,n,r,i,s){if(t.onBeforeRender(f,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=_t(n,e,i,t);j.setMaterial(i),at.reset(),function(t,e){t.render((function(t){f.renderBufferImmediate(t,e)}))}(t,r)}else f.renderBufferDirect(n,e,r,i,t,s);t.onAfterRender(f,e,n,r,i,s)}function St(t,e,n){!0!==e.isScene&&(e=z);const r=H.get(t),i=d.state.lights,s=d.state.shadowsArray,o=i.state.version,a=Z.getParameters(t,i.state,s,e,n),l=Z.getProgramCacheKey(a);let c=r.program,u=!0;if(r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=q.get(t.envMap||r.environment),void 0===c)t.addEventListener("dispose",mt);else if(c.cacheKey!==l)gt(t);else if(r.lightsStateVersion!==o)u=!1;else{if(void 0!==a.shaderID)return;u=!1}u&&(a.uniforms=Z.getUniforms(t),t.onBeforeCompile(a,f),c=Z.acquireProgram(a,l),r.program=c,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=et.numPlanes,r.numIntersection=et.numIntersection,h.clippingPlanes=et.uniform),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=nbt.seqWithValue(p.seq,h);r.uniformsList=m}function _t(t,e,n,r){!0!==e.isScene&&(e=z),G.resetTextureUnits();const i=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===v?f.outputEncoding:v.texture.encoding,a=q.get(n.envMap||s),l=H.get(n),c=d.state.lights;if(!0===P&&(!0===L||t!==S)){const e=t===S&&n.id===w;et.setState(n,t,e)}n.version===l.__version?n.fog&&l.fog!==i||l.environment!==s||l.needsLights&&l.lightsStateVersion!==c.state.version?St(n,e,r):void 0===l.numClippingPlanes||l.numClippingPlanes===et.numPlanes&&l.numIntersection===et.numIntersection?(l.outputEncoding!==o||l.envMap!==a)&&St(n,e,r):St(n,e,r):(St(n,e,r),l.__version=n.version);let u=!1,h=!1,p=!1;const m=l.program,g=m.getUniforms(),y=l.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==w&&(w=n.id,h=!0),u||S!==t){if(g.setValue(lt,"projectionMatrix",t.projectionMatrix),V.logarithmicDepthBuffer&&g.setValue(lt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),S!==t&&(S=t,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(lt,F.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(lt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(lt,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){g.setOptional(lt,r,"bindMatrix"),g.setOptional(lt,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(V.floatVertexTextures){if(null===t.boneTexture){let n=Math.sqrt(4*e.length);n=tft.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new Lgt(r,n,n,1023,1015);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}g.setValue(lt,"boneTexture",t.boneTexture,G),g.setValue(lt,"boneTextureSize",t.boneTextureSize)}else g.setOptional(lt,t,"boneMatrices")}}var b,x;return(h||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,g.setValue(lt,"receiveShadow",r.receiveShadow)),h&&(g.setValue(lt,"toneMappingExposure",f.toneMappingExposure),l.needsLights&&(x=p,(b=y).ambientLightColor.needsUpdate=x,b.lightProbe.needsUpdate=x,b.directionalLights.needsUpdate=x,b.directionalLightShadows.needsUpdate=x,b.pointLights.needsUpdate=x,b.pointLightShadows.needsUpdate=x,b.spotLights.needsUpdate=x,b.spotLightShadows.needsUpdate=x,b.rectAreaLights.needsUpdate=x,b.hemisphereLights.needsUpdate=x),i&&n.fog&&J.refreshFogUniforms(y,i),J.refreshMaterialUniforms(y,n,C,M),nbt.upload(lt,l.uniformsList,y,G)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(nbt.upload(lt,l.uniformsList,y,G),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(lt,"center",r.center),g.setValue(lt,"modelViewMatrix",r.modelViewMatrix),g.setValue(lt,"normalMatrix",r.normalMatrix),g.setValue(lt,"modelMatrix",r.matrixWorld),m}bt.setAnimationLoop((function(t){ht.isPresenting||yt&&yt(t)})),"undefined"!=typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){yt=t,ht.setAnimationLoop(t),null===t?bt.stop():bt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;at.resetDefaultState(),w=-1,S=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(f,t,e,n||v),d=tt.get(t,p.length),d.init(),p.push(d),D.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),O.setFromProjectionMatrix(D),L=this.localClippingEnabled,P=et.init(this.clippingPlanes,L,e),h=Q.get(t,e),h.init(),vt(t,e,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(A,N),!0===P&&et.beginShadows();const i=d.state.shadowsArray;dt.render(i,t,e),d.setupLights(),d.setupLightsView(e),!0===P&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const s=h.opaque,o=h.transparent;s.length>0&&xt(s,t,e),o.length>0&&xt(o,t,e),!0===t.isScene&&t.onAfterRender(f,t,e),null!==v&&(G.updateRenderTargetMipmap(v),G.updateMultisampleRenderTarget(v)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(t){g!==t&&null===v&&lt.bindFramebuffer(36160,t),g=t},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderTarget=function(){return v},this.setRenderTarget=function(t,e=0,n=0){v=t,y=e,b=n,t&&void 0===H.get(t).__webglFramebuffer&&G.setupRenderTarget(t);let r=g,i=!1;if(t){const n=H.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],i=!0):r=t.isWebGLMultisampleRenderTarget?H.get(t).__webglMultisampledFramebuffer:n,_.copy(t.viewport),k.copy(t.scissor),T=t.scissorTest}else _.copy(I).multiplyScalar(C).floor(),k.copy($).multiplyScalar(C).floor(),T=R;if(x!==r&&(lt.bindFramebuffer(36160,r),x=r),j.viewport(_),j.scissor(k),j.setScissorTest(T),i){const r=H.get(t.texture);lt.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=H.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){let o=!1;a!==x&&(lt.bindFramebuffer(36160,a),o=!0);try{const a=t.texture,l=a.format,c=a.type;if(1023!==l&&ot.convert(l)!==lt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=1016===c&&(U.has("EXT_color_buffer_half_float")||V.isWebGL2&&U.has("EXT_color_buffer_float"));if(!(1009===c||ot.convert(c)===lt.getParameter(35738)||1015===c&&(V.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===lt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&lt.readPixels(e,n,r,i,ot.convert(l),ot.convert(c),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&lt.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r),o=ot.convert(e.format);G.setTexture2D(e,0),lt.copyTexImage2D(3553,n,o,t.x,t.y,i,s,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,s=e.image.height,o=ot.convert(n.format),a=ot.convert(n.type);G.setTexture2D(n,0),lt.pixelStorei(37440,n.flipY),lt.pixelStorei(37441,n.premultiplyAlpha),lt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?lt.texSubImage2D(3553,r,t.x,t.y,i,s,o,a,e.image.data):e.isCompressedTexture?lt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):lt.texSubImage2D(3553,r,t.x,t.y,o,a,e.image),0===r&&n.generateMipmaps&&lt.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(t){G.setTexture2D(t,0),j.unbindTexture()},this.resetState=function(){j.reset(),at.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function qbt(t){Gbt.call(this,t)}Ubt.prototype=Object.assign(Object.create($gt.prototype),{constructor:Ubt,isArrayCamera:!0}),Vbt.prototype=Object.assign(Object.create(umt.prototype),{constructor:Vbt,isGroup:!0}),Object.assign(jbt.prototype,{constructor:jbt,getHandSpace:function(){return null===this._hand&&(this._hand=new Vbt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Vbt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Vbt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const t=new Vbt;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[r.jointName]=t,l.add(t)}const i=l.joints[r.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}}),Object.assign(Wbt.prototype,Zpt.prototype),qbt.prototype=Object.assign(Object.create(Gbt.prototype),{constructor:qbt,isWebGL1Renderer:!0});class Xbt{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new $mt(t),this.density=void 0!==e?e:25e-5}clone(){return new Xbt(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Ybt{constructor(t,e,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new $mt(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}clone(){return new Ybt(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Kbt extends umt{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function Zbt(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=tft.generateUUID()}Object.defineProperty(Zbt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Zbt.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=tft.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new Zbt(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=tft.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Jbt=new hft;function Qbt(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function tvt(t){Pmt.call(this),this.type="SpriteMaterial",this.color=new $mt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let evt;Object.defineProperties(Qbt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Qbt.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)Jbt.x=this.getX(e),Jbt.y=this.getY(e),Jbt.z=this.getZ(e),Jbt.applyMatrix4(t),this.setXYZ(e,Jbt.x,Jbt.y,Jbt.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new zmt(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Qbt(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),tvt.prototype=Object.create(Pmt.prototype),tvt.prototype.constructor=tvt,tvt.prototype.isSpriteMaterial=!0,tvt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const nvt=new hft,rvt=new hft,ivt=new hft,svt=new eft,ovt=new eft,avt=new zft,lvt=new hft,cvt=new hft,uvt=new hft,hvt=new eft,dvt=new eft,pvt=new eft;function fvt(t){if(umt.call(this),this.type="Sprite",void 0===evt){evt=new ogt;const t=new Zbt(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);evt.setIndex([0,1,2,0,2,3]),evt.setAttribute("position",new Qbt(t,3,0,!1)),evt.setAttribute("uv",new Qbt(t,2,3,!1))}this.geometry=evt,this.material=void 0!==t?t:new tvt,this.center=new eft(.5,.5)}function mvt(t,e,n,r,i,s){svt.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(ovt.x=s*svt.x-i*svt.y,ovt.y=i*svt.x+s*svt.y):ovt.copy(svt),t.copy(e),t.x+=ovt.x,t.y+=ovt.y,t.applyMatrix4(avt)}fvt.prototype=Object.assign(Object.create(umt.prototype),{constructor:fvt,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rvt.setFromMatrixScale(this.matrixWorld),avt.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ivt.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&rvt.multiplyScalar(-ivt.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;mvt(lvt.set(-.5,-.5,0),ivt,s,rvt,r,i),mvt(cvt.set(.5,-.5,0),ivt,s,rvt,r,i),mvt(uvt.set(.5,.5,0),ivt,s,rvt,r,i),hvt.set(0,0),dvt.set(1,0),pvt.set(1,1);let o=t.ray.intersectTriangle(lvt,cvt,uvt,!1,nvt);if(null===o&&(mvt(cvt.set(-.5,.5,0),ivt,s,rvt,r,i),dvt.set(0,1),o=t.ray.intersectTriangle(lvt,uvt,cvt,!1,nvt),null===o))return;const a=t.ray.origin.distanceTo(nvt);a<t.near||a>t.far||e.push({distance:a,point:nvt.clone(),uv:Tmt.getUV(nvt,lvt,cvt,uvt,hvt,dvt,pvt,new eft),face:null,object:this})},copy:function(t){return umt.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const gvt=new hft,yvt=new hft;function bvt(){umt.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}bvt.prototype=Object.assign(Object.create(umt.prototype),{constructor:bvt,isLOD:!0,copy:function(t){umt.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){gvt.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(gvt);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){gvt.setFromMatrixPosition(t.matrixWorld),yvt.setFromMatrixPosition(this.matrixWorld);const n=gvt.distanceTo(yvt)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){const e=umt.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}});const vvt=new hft,xvt=new lft,wvt=new lft,Svt=new hft,_vt=new zft;function kvt(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),kgt.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new zft,this.bindMatrixInverse=new zft}function Tvt(){umt.call(this),this.type="Bone"}kvt.prototype=Object.assign(Object.create(kgt.prototype),{constructor:kvt,isSkinnedMesh:!0,copy:function(t){return kgt.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new lft,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){kgt.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const n=this.skeleton,r=this.geometry;xvt.fromBufferAttribute(r.attributes.skinIndex,t),wvt.fromBufferAttribute(r.attributes.skinWeight,t),vvt.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=wvt.getComponent(t);if(0!==r){const i=xvt.getComponent(t);_vt.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(Svt.copy(vvt).applyMatrix4(_vt),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}),Tvt.prototype=Object.assign(Object.create(umt.prototype),{constructor:Tvt,isBone:!0});const Evt=new zft,Mvt=new zft;function Cvt(t=[],e=[]){this.uuid=tft.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Cvt.prototype,{init:function(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new zft)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new zft;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:Mvt;Evt.multiplyMatrices(i,e[r]),Evt.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new Cvt(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Tvt),this.bones.push(i),this.boneInverses.push((new zft).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const s=n[r];t.boneInverses.push(s.toArray())}return t}});const Avt=new zft,Nvt=new zft,Ivt=[],$vt=new kgt;function Rvt(t,e,n){kgt.call(this,t,e),this.instanceMatrix=new zmt(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Ovt(t){Pmt.call(this),this.type="LineBasicMaterial",this.color=new $mt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Rvt.prototype=Object.assign(Object.create(kgt.prototype),{constructor:Rvt,isInstancedMesh:!0,copy:function(t){return kgt.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if($vt.geometry=this.geometry,$vt.material=this.material,void 0!==$vt.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Avt),Nvt.multiplyMatrices(n,Avt),$vt.matrixWorld=Nvt,$vt.raycast(t,Ivt);for(let t=0,n=Ivt.length;t<n;t++){const n=Ivt[t];n.instanceId=i,n.object=this,e.push(n)}Ivt.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new zmt(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ovt.prototype=Object.create(Pmt.prototype),Ovt.prototype.constructor=Ovt,Ovt.prototype.isLineBasicMaterial=!0,Ovt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Pvt=new hft,Lvt=new hft,Dvt=new zft,Fvt=new Fft,zvt=new Nft;function Bvt(t=new ogt,e=new Ovt){umt.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}Bvt.prototype=Object.assign(Object.create(umt.prototype),{constructor:Bvt,isLine:!0,copy:function(t){return umt.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)Pvt.fromBufferAttribute(e,t-1),Lvt.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Pvt.distanceTo(Lvt);t.setAttribute("lineDistance",new Xmt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),zvt.copy(n.boundingSphere),zvt.applyMatrix4(r),zvt.radius+=i,!1===t.ray.intersectsSphere(zvt))return;Dvt.copy(r).invert(),Fvt.copy(t.ray).applyMatrix4(Dvt);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,a=new hft,l=new hft,c=new hft,u=new hft,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,s=n.length-1;r<s;r+=h){const s=n[r],h=n[r+1];a.fromBufferAttribute(i,s),l.fromBufferAttribute(i,h);if(Fvt.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){a.fromBufferAttribute(i,n),l.fromBufferAttribute(i,n+1);if(Fvt.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Uvt=new hft,Vvt=new hft;function jvt(t,e){Bvt.call(this,t,e),this.type="LineSegments"}function Wvt(t,e){Bvt.call(this,t,e),this.type="LineLoop"}function Hvt(t){Pmt.call(this),this.type="PointsMaterial",this.color=new $mt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}jvt.prototype=Object.assign(Object.create(Bvt.prototype),{constructor:jvt,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Uvt.fromBufferAttribute(e,t),Vvt.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Uvt.distanceTo(Vvt);t.setAttribute("lineDistance",new Xmt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),Wvt.prototype=Object.assign(Object.create(Bvt.prototype),{constructor:Wvt,isLineLoop:!0}),Hvt.prototype=Object.create(Pmt.prototype),Hvt.prototype.constructor=Hvt,Hvt.prototype.isPointsMaterial=!0,Hvt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Gvt=new zft,qvt=new Fft,Xvt=new Nft,Yvt=new hft;function Kvt(t=new ogt,e=new Hvt){umt.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function Zvt(t,e,n,r,i,s,o){const a=qvt.distanceSqToPoint(t);if(a<n){const n=new hft;qvt.closestPointToPoint(t,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}function Jvt(t,e,n,r,i,s,o,a,l){oft.call(this,t,e,n,r,i,s,o,a,l),this.format=void 0!==o?o:1022,this.minFilter=void 0!==s?s:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function Qvt(t,e,n,r,i,s,o,a,l,c,u,h){oft.call(this,null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function txt(t,e,n,r,i,s,o,a,l){oft.call(this,t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}function ext(t,e,n,r,i,s,o,a,l,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===c&&(n=1012),void 0===n&&1027===c&&(n=1020),oft.call(this,null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:1003,this.minFilter=void 0!==a?a:1003,this.flipY=!1,this.generateMipmaps=!1}Kvt.prototype=Object.assign(Object.create(umt.prototype),{constructor:Kvt,isPoints:!0,copy:function(t){return umt.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xvt.copy(n.boundingSphere),Xvt.applyMatrix4(r),Xvt.radius+=i,!1===t.ray.intersectsSphere(Xvt))return;Gvt.copy(r).invert(),qvt.copy(t.ray).applyMatrix4(Gvt);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];Yvt.fromBufferAttribute(s,a),Zvt(Yvt,a,o,r,t,e,this)}}else for(let n=0,i=s.count;n<i;n++)Yvt.fromBufferAttribute(s,n),Zvt(Yvt,n,o,r,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Jvt.prototype=Object.assign(Object.create(oft.prototype),{constructor:Jvt,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Qvt.prototype=Object.create(oft.prototype),Qvt.prototype.constructor=Qvt,Qvt.prototype.isCompressedTexture=!0,txt.prototype=Object.create(oft.prototype),txt.prototype.constructor=txt,txt.prototype.isCanvasTexture=!0,ext.prototype=Object.create(oft.prototype),ext.prototype.constructor=ext,ext.prototype.isDepthTexture=!0;class nxt extends ogt{constructor(t=1,e=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],s=[],o=[],a=[],l=new hft,c=new eft;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=e;i++,u+=3){const h=n+i/e*r;l.x=t*Math.cos(h),l.y=t*Math.sin(h),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/t+1)/2,c.y=(s[u+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new Xmt(s,3)),this.setAttribute("normal",new Xmt(o,3)),this.setAttribute("uv",new Xmt(a,2))}}class rxt extends ogt{constructor(t=1,e=1,n=1,r=8,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,s=new eft,f=new hft;let y=0;const b=!0===n?t:e,v=!0===n?1:-1;for(let t=1;t<=r;t++)u.push(0,m*v,0),h.push(0,v,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=b*i,f.y=m*v,f.z=b*n,u.push(f.x,f.y,f.z),h.push(0,v,0),s.x=.5*n+.5,s.y=.5*i*v+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=x+t;!0===n?c.push(r,r+1,e):c.push(r+1,r,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const s=new hft,y=new hft;let b=0;const v=(e-t)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,b=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);y.x=b*l,y.y=-g*n+m,y.z=b*f,u.push(y.x,y.y,y.z),s.set(l,v,f).normalize(),h.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],s=f[e][t+1];c.push(n,r,s),c.push(r,i,s),b+=6}l.addGroup(g,b,0),g+=b}(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Xmt(u,3)),this.setAttribute("normal",new Xmt(h,3)),this.setAttribute("uv",new Xmt(d,2))}}class ixt extends rxt{constructor(t=1,e=1,n=8,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}}class sxt extends ogt{constructor(t,e,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],s=[];function o(t,e,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const o=t.clone().lerp(n,r/i),a=e.clone().lerp(n,r/i),l=i-r;for(let t=0;t<=l;t++)s[r][t]=0===t&&r===i?o:o.clone().lerp(a,t/l)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function c(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new hft,r=new hft,i=new hft;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],r),l(e[s+2],i),o(n,r,i,t)}(r),function(t){const e=new hft;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new hft;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new hft,e=new hft,n=new hft,r=new hft,o=new eft,a=new eft,l=new eft;for(let h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),r.copy(t).add(e).add(n).divideScalar(3);const p=u(r);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Xmt(i,3)),this.setAttribute("normal",new Xmt(i.slice(),3)),this.setAttribute("uv",new Xmt(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class oxt extends sxt{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}}const axt=new hft,lxt=new hft,cxt=new hft,uxt=new Tmt;class hxt extends ogt{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0===t.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),r=Math.cos(tft.DEG2RAD*e),i=t.getIndex(),s=t.getAttribute("position"),o=i?i.count:s.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),u={},h=[];for(let t=0;t<o;t+=3){i?(a[0]=i.getX(t),a[1]=i.getX(t+1),a[2]=i.getX(t+2)):(a[0]=t,a[1]=t+1,a[2]=t+2);const{a:e,b:o,c:d}=uxt;if(e.fromBufferAttribute(s,a[0]),o.fromBufferAttribute(s,a[1]),d.fromBufferAttribute(s,a[2]),uxt.getNormal(cxt),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=c[t],i=c[e],s=uxt[l[t]],o=uxt[l[e]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(cxt.dot(u[p].normal)<=r&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),u[p]=null):d in u||(u[d]={index0:a[t],index1:a[e],normal:cxt.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];axt.fromBufferAttribute(s,e),lxt.fromBufferAttribute(s,n),h.push(axt.x,axt.y,axt.z),h.push(lxt.x,lxt.y,lxt.z)}this.setAttribute("position",new Xmt(h,3))}}const dxt=function(t,e,n){n=n||2;const r=e&&e.length,i=r?e[0]*n:t.length;let s=pxt(t,0,i,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,p;if(r&&(s=function(t,e,n,r){const i=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=pxt(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(kxt(c));for(i.sort(xxt),s=0;s<i.length;s++)wxt(i[s],n),n=fxt(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(let e=n;e<i;e+=n)h=t[e],d=t[e+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return mxt(s,o,n,a,l,p),o};function pxt(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Oxt(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Oxt(s,t[s],t[s+1],o);return o&&Cxt(o,o.next)&&(Pxt(o),o=o.next),o}function fxt(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!Cxt(r,r.next)&&0!==Mxt(r.prev,r,r.next))r=r.next;else{if(Pxt(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function mxt(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=_xt(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?yxt(t,r,i,s):gxt(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Pxt(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?mxt(t=bxt(fxt(t),e,n),e,n,r,i,s,2):2===o&&vxt(t,e,n,r,i,s):mxt(fxt(t),e,n,r,i,s,1);break}}function gxt(t){const e=t.prev,n=t,r=t.next;if(Mxt(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(Txt(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Mxt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yxt(t,e,n,r){const i=t.prev,s=t,o=t.next;if(Mxt(i,s,o)>=0)return!1;const a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=_xt(a,l,e,n,r),d=_xt(c,u,e,n,r);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Txt(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Mxt(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Txt(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Mxt(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&Txt(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Mxt(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Txt(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Mxt(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function bxt(t,e,n){let r=t;do{const i=r.prev,s=r.next.next;!Cxt(i,s)&&Axt(i,r,r.next,s)&&$xt(i,s)&&$xt(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),Pxt(r),Pxt(r.next),r=t=s),r=r.next}while(r!==t);return fxt(r)}function vxt(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Ext(o,t)){let a=Rxt(o,t);return o=fxt(o,o.next),a=fxt(a,a.next),mxt(o,e,n,r,i,s),void mxt(a,e,n,r,i,s)}t=t.next}o=o.next}while(o!==t)}function xxt(t,e){return t.x-e.x}function wxt(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let s,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>o){if(o=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s;const a=s,l=s.x,c=s.y;let u,h=1/0;n=s;do{r>=n.x&&n.x>=l&&r!==n.x&&Txt(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),$xt(n,t)&&(u<h||u===h&&(n.x>s.x||n.x===s.x&&Sxt(s,n)))&&(s=n,h=u)),n=n.next}while(n!==a);return s}(t,e),e){const n=Rxt(e,t);fxt(e,e.next),fxt(n,n.next)}}function Sxt(t,e){return Mxt(t.prev,t,e.prev)<0&&Mxt(e.next,t,t.next)<0}function _xt(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function kxt(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Txt(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function Ext(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Axt(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&($xt(t,e)&&$xt(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Mxt(t.prev,t,e.prev)||Mxt(t,e.prev,e))||Cxt(t,e)&&Mxt(t.prev,t,t.next)>0&&Mxt(e.prev,e,e.next)>0)}function Mxt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Cxt(t,e){return t.x===e.x&&t.y===e.y}function Axt(t,e,n,r){const i=Ixt(Mxt(t,e,n)),s=Ixt(Mxt(t,e,r)),o=Ixt(Mxt(n,r,t)),a=Ixt(Mxt(n,r,e));return i!==s&&o!==a||(!(0!==i||!Nxt(t,n,e))||(!(0!==s||!Nxt(t,r,e))||(!(0!==o||!Nxt(n,t,r))||!(0!==a||!Nxt(n,e,r)))))}function Nxt(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ixt(t){return t>0?1:t<0?-1:0}function $xt(t,e){return Mxt(t.prev,t,t.next)<0?Mxt(t,e,t.next)>=0&&Mxt(t,t.prev,e)>=0:Mxt(t,e,t.prev)<0||Mxt(t,t.next,e)<0}function Rxt(t,e){const n=new Lxt(t.i,t.x,t.y),r=new Lxt(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Oxt(t,e,n,r){const i=new Lxt(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Pxt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lxt(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Dxt={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return Dxt.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];Fxt(t),zxt(n,t);let s=t.length;e.forEach(Fxt);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,zxt(n,e[t]);const o=dxt(n,r);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}};function Fxt(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function zxt(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class Bxt extends ogt{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Uxt;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,y,b,v,x,w=!1;f&&(g=f.getSpacedPoints(a),w=!0,c=!1,y=f.computeFrenetFrames(a,!1),b=new hft,v=new hft,x=new hft),c||(p=0,u=0,h=0,d=0);const S=t.extractPoints(o);let _=S.shape;const k=S.holes;if(!Dxt.isClockWise(_)){_=_.reverse();for(let t=0,e=k.length;t<e;t++){const e=k[t];Dxt.isClockWise(e)&&(k[t]=e.reverse())}}const T=Dxt.triangulateShape(_,k),E=_;for(let t=0,e=k.length;t<e;t++){const e=k[t];_=_.concat(e)}function M(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const C=_.length,A=T.length;function N(t,e,n){let r,i,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-a*l);r=p+o*m-t.x,i=f+a*m-t.y;const g=r*r+i*i;if(g<=2)return new eft(r,i);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new eft(r/s,i/s)}const I=[];for(let t=0,e=E.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),I[t]=N(E[t],E[n],E[r]);const $=[];let R,O=I.concat();for(let t=0,e=k.length;t<e;t++){const e=k[t];R=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),R[t]=N(e[t],e[r],e[i]);$.push(R),O=O.concat(R)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=M(E[t],I[t],r);D(e.x,e.y,-n)}for(let t=0,e=k.length;t<e;t++){const e=k[t];R=$[t];for(let t=0,i=e.length;t<i;t++){const i=M(e[t],R[t],r);D(i.x,i.y,-n)}}}const P=h+d;for(let t=0;t<C;t++){const e=c?M(_[t],O[t],P):_[t];w?(v.copy(y.normals[0]).multiplyScalar(e.x),b.copy(y.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(v).add(b),D(x.x,x.y,x.z)):D(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const n=c?M(_[e],O[e],P):_[e];w?(v.copy(y.normals[t]).multiplyScalar(n.x),b.copy(y.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(v).add(b),D(x.x,x.y,x.z)):D(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=M(E[t],I[t],r);D(e.x,e.y,l+n)}for(let t=0,e=k.length;t<e;t++){const e=k[t];R=$[t];for(let t=0,i=e.length;t<i;t++){const i=M(e[t],R[t],r);w?D(i.x,i.y+g[a-1].y,g[a-1].x+n):D(i.x,i.y,l+n)}}}function L(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=C*t,s=C*(t+1);z(e+r+n,e+i+n,e+i+s,e+r+s)}}}function D(t,e,n){s.push(t),s.push(e),s.push(n)}function F(t,e,i){B(t),B(e),B(i);const s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);U(o[0]),U(o[1]),U(o[2])}function z(t,e,i,s){B(t),B(e),B(s),B(e),B(i),B(s);const o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);U(a[0]),U(a[1]),U(a[3]),U(a[1]),U(a[2]),U(a[3])}function B(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function U(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=C*t;for(let t=0;t<A;t++){const n=T[t];F(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<A;t++){const n=T[t];F(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<A;t++){const e=T[t];F(e[2],e[1],e[0])}for(let t=0;t<A;t++){const e=T[t];F(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;L(E,e),e+=E.length;for(let t=0,n=k.length;t<n;t++){const n=k[t];L(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Xmt(r,3)),this.setAttribute("uv",new Xmt(i,2)),this.computeVertexNormals()}toJSON(){const t=ogt.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}const Uxt={generateTopUV:function(t,e,n,r,i){const s=e[3*n],o=e[3*n+1],a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new eft(s,o),new eft(a,l),new eft(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*s],g=e[3*s+1],y=e[3*s+2];return Math.abs(a-u)<.01?[new eft(o,1-l),new eft(c,1-h),new eft(d,1-f),new eft(m,1-y)]:[new eft(a,1-l),new eft(u,1-h),new eft(p,1-f),new eft(g,1-y)]}};class Vxt extends sxt{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}}class jxt extends ogt{constructor(t,e=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=tft.clamp(r,0,2*Math.PI);const i=[],s=[],o=[],a=1/e,l=new hft,c=new eft;for(let i=0;i<=e;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*h,l.y=t[n].y,l.z=t[n].x*d,s.push(l.x,l.y,l.z),c.x=i/e,c.y=n/(t.length-1),o.push(c.x,c.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,s=r,o=r+t.length,a=r+t.length+1,l=r+1;i.push(s,o,l),i.push(o,a,l)}if(this.setIndex(i),this.setAttribute("position",new Xmt(s,3)),this.setAttribute("uv",new Xmt(o,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new hft,i=new hft,s=new hft,o=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[o+a+0],i.y=n[o+a+1],i.z=n[o+a+2],s.addVectors(r,i).normalize(),n[a+0]=n[o+a+0]=s.x,n[a+1]=n[o+a+1]=s.y,n[a+2]=n[o+a+2]=s.z}}}class Wxt extends sxt{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}}function Hxt(t,e,n){ogt.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],s=[],o=[],a=1e-5,l=new hft,c=new hft,u=new hft,h=new hft,d=new hft;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,p,c),i.push(c.x,c.y,c.z),r-a>=0?(t(r-a,p,u),h.subVectors(c,u)):(t(r+a,p,u),h.subVectors(u,c)),p-a>=0?(t(r,p-a,u),d.subVectors(c,u)):(t(r,p+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),s.push(l.x,l.y,l.z),o.push(r,p)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*p+n,i=t*p+n+1,s=(t+1)*p+n+1,o=(t+1)*p+n;r.push(e,i,o),r.push(i,s,o)}this.setIndex(r),this.setAttribute("position",new Xmt(i,3)),this.setAttribute("normal",new Xmt(s,3)),this.setAttribute("uv",new Xmt(o,2))}Hxt.prototype=Object.create(ogt.prototype),Hxt.prototype.constructor=Hxt;class Gxt extends ogt{constructor(t=.5,e=1,n=8,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let u=t;const h=(e-t)/(r=Math.max(1,r)),d=new hft,p=new eft;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*s;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}u+=h}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,s=r+n+1,a=r+n+2,l=r+1;o.push(i,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Xmt(a,3)),this.setAttribute("normal",new Xmt(l,3)),this.setAttribute("uv",new Xmt(c,2))}}class qxt extends ogt{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=r.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===Dxt.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===Dxt.isClockWise(e)&&(u[t]=e.reverse())}const h=Dxt.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+o,i=e[1]+o,s=e[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new Xmt(r,3)),this.setAttribute("normal",new Xmt(i,3)),this.setAttribute("uv",new Xmt(s,2))}toJSON(){const t=ogt.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class Xxt extends ogt{constructor(t=1,e=8,n=6,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new hft,h=new hft,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let b=0;0==d&&0==s?b=.5/e:d==n&&a==Math.PI&&(b=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),u.y=t*Math.cos(s+y*o),u.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+b,1-y),g.push(l++)}c.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=c[t][r+1],i=c[t][r],o=c[t+1][r],l=c[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new Xmt(p,3)),this.setAttribute("normal",new Xmt(f,3)),this.setAttribute("uv",new Xmt(m,2))}}class Yxt extends sxt{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}}class Kxt extends Bxt{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ogt;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(r,e),this.type="TextGeometry"}}class Zxt extends ogt{constructor(t=1,e=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],a=[],l=[],c=new hft,u=new hft,h=new hft;for(let s=0;s<=n;s++)for(let d=0;d<=r;d++){const p=d/r*i,f=s/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/r),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(n,i,a),s.push(i,o,a)}this.setIndex(s),this.setAttribute("position",new Xmt(o,3)),this.setAttribute("normal",new Xmt(a,3)),this.setAttribute("uv",new Xmt(l,2))}}class Jxt extends ogt{constructor(t=1,e=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new hft,h=new hft,d=new hft,p=new hft,f=new hft,m=new hft,g=new hft;for(let o=0;o<=n;++o){const b=o/n*i*Math.PI*2;y(b,i,s,t,d),y(b+.01,i,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,s=-e*Math.cos(i),p=e*Math.sin(i);u.x=d.x+(s*g.x+p*f.x),u.y=d.y+(s*g.y+p*f.y),u.z=d.z+(s*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(n,i,a),o.push(i,s,a)}function y(t,e,n,r,i){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Xmt(a,3)),this.setAttribute("normal",new Xmt(l,3)),this.setAttribute("uv",new Xmt(c,2))}}class Qxt extends ogt{constructor(t,e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new hft,a=new hft,l=new eft;let c=new hft;const u=[],h=[],d=[],p=[];function f(i){c=t.getPointAt(i/e,c);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Xmt(u,3)),this.setAttribute("normal",new Xmt(h,3)),this.setAttribute("uv",new Xmt(d,2))}toJSON(){const t=ogt.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class twt extends ogt{constructor(t){if(super(),this.type="WireframeGeometry",!0===t.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const e=[],n=[0,0],r={},i=new hft;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],i=e.start;for(let t=i,s=i+e.count;t<s;t+=3)for(let e=0;e<3;e++){const i=o.getX(t+e),s=o.getX(t+(e+1)%3);n[0]=Math.min(i,s),n[1]=Math.max(i,s);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];i.fromBufferAttribute(s,n.index1),e.push(i.x,i.y,i.z),i.fromBufferAttribute(s,n.index2),e.push(i.x,i.y,i.z)}}else{const n=t.attributes.position;for(let t=0,r=n.count/3;t<r;t++)for(let r=0;r<3;r++){const s=3*t+r;i.fromBufferAttribute(n,s),e.push(i.x,i.y,i.z);const o=3*t+(r+1)%3;i.fromBufferAttribute(n,o),e.push(i.x,i.y,i.z)}}this.setAttribute("position",new Xmt(e,3))}}var ewt=Object.freeze({__proto__:null,BoxGeometry:Egt,BoxBufferGeometry:Egt,CircleGeometry:nxt,CircleBufferGeometry:nxt,ConeGeometry:ixt,ConeBufferGeometry:ixt,CylinderGeometry:rxt,CylinderBufferGeometry:rxt,DodecahedronGeometry:oxt,DodecahedronBufferGeometry:oxt,EdgesGeometry:hxt,ExtrudeGeometry:Bxt,ExtrudeBufferGeometry:Bxt,IcosahedronGeometry:Vxt,IcosahedronBufferGeometry:Vxt,LatheGeometry:jxt,LatheBufferGeometry:jxt,OctahedronGeometry:Wxt,OctahedronBufferGeometry:Wxt,ParametricGeometry:Hxt,ParametricBufferGeometry:Hxt,PlaneGeometry:Vgt,PlaneBufferGeometry:Vgt,PolyhedronGeometry:sxt,PolyhedronBufferGeometry:sxt,RingGeometry:Gxt,RingBufferGeometry:Gxt,ShapeGeometry:qxt,ShapeBufferGeometry:qxt,SphereGeometry:Xxt,SphereBufferGeometry:Xxt,TetrahedronGeometry:Yxt,TetrahedronBufferGeometry:Yxt,TextGeometry:Kxt,TextBufferGeometry:Kxt,TorusGeometry:Zxt,TorusBufferGeometry:Zxt,TorusKnotGeometry:Jxt,TorusKnotBufferGeometry:Jxt,TubeGeometry:Qxt,TubeBufferGeometry:Qxt,WireframeGeometry:twt});function nwt(t){Pmt.call(this),this.type="ShadowMaterial",this.color=new $mt(0),this.transparent=!0,this.setValues(t)}function rwt(t){Ngt.call(this,t),this.type="RawShaderMaterial"}function iwt(t){Pmt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $mt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new eft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function swt(t){iwt.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new eft(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=tft.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function owt(t){Pmt.call(this),this.type="MeshPhongMaterial",this.color=new $mt(16777215),this.specular=new $mt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new eft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function awt(t){Pmt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $mt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new eft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function lwt(t){Pmt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new eft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function cwt(t){Pmt.call(this),this.type="MeshLambertMaterial",this.color=new $mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function uwt(t){Pmt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $mt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new eft(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function hwt(t){Ovt.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}nwt.prototype=Object.create(Pmt.prototype),nwt.prototype.constructor=nwt,nwt.prototype.isShadowMaterial=!0,nwt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this},rwt.prototype=Object.create(Ngt.prototype),rwt.prototype.constructor=rwt,rwt.prototype.isRawShaderMaterial=!0,iwt.prototype=Object.create(Pmt.prototype),iwt.prototype.constructor=iwt,iwt.prototype.isMeshStandardMaterial=!0,iwt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},swt.prototype=Object.create(iwt.prototype),swt.prototype.constructor=swt,swt.prototype.isMeshPhysicalMaterial=!0,swt.prototype.copy=function(t){return iwt.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new $mt).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},owt.prototype=Object.create(Pmt.prototype),owt.prototype.constructor=owt,owt.prototype.isMeshPhongMaterial=!0,owt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},awt.prototype=Object.create(Pmt.prototype),awt.prototype.constructor=awt,awt.prototype.isMeshToonMaterial=!0,awt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},lwt.prototype=Object.create(Pmt.prototype),lwt.prototype.constructor=lwt,lwt.prototype.isMeshNormalMaterial=!0,lwt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},cwt.prototype=Object.create(Pmt.prototype),cwt.prototype.constructor=cwt,cwt.prototype.isMeshLambertMaterial=!0,cwt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},uwt.prototype=Object.create(Pmt.prototype),uwt.prototype.constructor=uwt,uwt.prototype.isMeshMatcapMaterial=!0,uwt.prototype.copy=function(t){return Pmt.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},hwt.prototype=Object.create(Ovt.prototype),hwt.prototype.constructor=hwt,hwt.prototype.isLineDashedMaterial=!0,hwt.prototype.copy=function(t){return Ovt.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var dwt=Object.freeze({__proto__:null,ShadowMaterial:nwt,SpriteMaterial:tvt,RawShaderMaterial:rwt,ShaderMaterial:Ngt,PointsMaterial:Hvt,MeshPhysicalMaterial:swt,MeshStandardMaterial:iwt,MeshPhongMaterial:owt,MeshToonMaterial:awt,MeshNormalMaterial:lwt,MeshLambertMaterial:cwt,MeshDepthMaterial:Pbt,MeshDistanceMaterial:Lbt,MeshBasicMaterial:Lmt,MeshMatcapMaterial:uwt,LineDashedMaterial:hwt,LineBasicMaterial:Ovt,Material:Pmt});const pwt={arraySlice:function(t,e,n){return pwt.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r,i=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*i;if(!(s<n||s>=r)){l.push(e.times[t]);for(let n=0;n<a;++n)c.push(e.values[t*a+n])}}0!==l.length&&(e.times=pwt.convertArray(l,e.times.constructor),e.values=pwt.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,s=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===o)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(s<=r.times[0]){const t=a,e=l-a;d=pwt.arraySlice(r.values,t,e)}else if(s>=r.times[h]){const t=h*l+a,e=t+l-a;d=pwt.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,n=l-a;t.evaluate(s),d=pwt.arraySlice(t.resultBuffer,e,n)}if("quaternion"===i){(new uft).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===i)uft.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)o.values[e+n]-=d[n]}}}return t.blendMode=2501,t}};function fwt(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function mwt(t,e,n,r){fwt.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function gwt(t,e,n,r){fwt.call(this,t,e,n,r)}function ywt(t,e,n,r){fwt.call(this,t,e,n,r)}function bwt(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=pwt.convertArray(e,this.TimeBufferType),this.values=pwt.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function vwt(t,e,n){bwt.call(this,t,e,n)}function xwt(t,e,n,r){bwt.call(this,t,e,n,r)}function wwt(t,e,n,r){bwt.call(this,t,e,n,r)}function Swt(t,e,n,r){fwt.call(this,t,e,n,r)}function _wt(t,e,n,r){bwt.call(this,t,e,n,r)}function kwt(t,e,n,r){bwt.call(this,t,e,n,r)}function Twt(t,e,n,r){bwt.call(this,t,e,n,r)}function Ewt(t,e=-1,n,r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=tft.generateUUID(),this.duration<0&&this.resetDuration()}function Mwt(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wwt;case"vector":case"vector2":case"vector3":case"vector4":return Twt;case"color":return xwt;case"quaternion":return _wt;case"bool":case"boolean":return vwt;case"string":return kwt}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];pwt.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(fwt.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(fwt.prototype,{beforeStart_:fwt.prototype.copySampleValue_,afterEnd_:fwt.prototype.copySampleValue_}),mwt.prototype=Object.assign(Object.create(fwt.prototype),{constructor:mwt,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=t,o=2*e-n;break;case 2402:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c},interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,b=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let t=0;t!==o;++t)i[t]=g*s[c+t]+y*s[l+t]+b*s[a+t]+v*s[u+t];return i}}),gwt.prototype=Object.assign(Object.create(fwt.prototype),{constructor:gwt,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let t=0;t!==o;++t)i[t]=s[l+t]*u+s[a+t]*c;return i}}),ywt.prototype=Object.assign(Object.create(fwt.prototype),{constructor:ywt,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(bwt,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:pwt.convertArray(t.times,Array),values:pwt.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(bwt.prototype,{constructor:bwt,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new ywt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new gwt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new mwt(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=pwt.arraySlice(n,i,s),this.values=pwt.arraySlice(this.values,i*t,s*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&pwt.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=pwt.arraySlice(this.times),e=pwt.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=pwt.arraySlice(t,0,s),this.values=pwt.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this},clone:function(){const t=pwt.arraySlice(this.times,0),e=pwt.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),vwt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:vwt,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),xwt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:xwt,ValueTypeName:"color"}),wwt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:wwt,ValueTypeName:"number"}),Swt.prototype=Object.assign(Object.create(fwt.prototype),{constructor:Swt,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)uft.slerpFlat(i,0,s,l-o,s,l,a);return i}}),_wt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:_wt,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new Swt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),kwt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:kwt,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Twt.prototype=Object.assign(Object.create(bwt.prototype),{constructor:Twt,ValueTypeName:"vector"}),Object.assign(Ewt,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(Mwt(n[t]).scale(r));const i=new Ewt(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(bwt.toJSON(n[t]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const i=e.length,s=[];for(let t=0;t<i;t++){let o=[],a=[];o.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const l=pwt.getKeyframeOrder(o);o=pwt.sortedArray(o,1,l),a=pwt.sortedArray(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new wwt(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new Ewt(t,-1,s)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(i);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const s=[];for(const t in r)s.push(Ewt.CreateFromMorphTargetSequence(t,r[t],e,n));return s},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const s=[],o=[];pwt.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new wwt(".morphTargetInfluence["+n+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(Twt,s+".position",i,"pos",r),n(_wt,s+".quaternion",i,"rot",r),n(Twt,s+".scale",i,"scl",r)}}if(0===r.length)return null;return new Ewt(i,a,r,o)}}),Object.assign(Ewt.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Ewt(this.name,this.duration,t,this.blendMode)},toJSON:function(){return Ewt.toJSON(this)}});const Cwt={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Awt(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const Nwt=new Awt;function Iwt(t){this.manager=void 0!==t?t:Nwt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Iwt.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const $wt={};function Rwt(t){Iwt.call(this,t)}function Owt(t){Iwt.call(this,t)}function Pwt(t){Iwt.call(this,t)}function Lwt(t){Iwt.call(this,t)}function Dwt(t){Iwt.call(this,t)}function Fwt(t){Iwt.call(this,t)}function zwt(t){Iwt.call(this,t)}function Bwt(){this.type="Curve",this.arcLengthDivisions=200}function Uwt(t,e,n,r,i,s,o,a){Bwt.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}function Vwt(t,e,n,r,i,s){Uwt.call(this,t,e,n,n,r,i,s),this.type="ArcCurve"}function jwt(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}Rwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Rwt,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Cwt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;if(void 0!==$wt[t])return void $wt[t].push({onLoad:e,onProgress:n,onError:r});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const n=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let r;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{$wt[t]=[],$wt[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=$wt[t];if(delete $wt[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cwt.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=$wt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=$wt[t];delete $wt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=$wt[t];delete $wt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Owt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Owt,load:function(t,e,n,r){const i=this,s=new Rwt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const r=Ewt.parse(t[n]);e.push(r)}return e}}),Pwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Pwt,load:function(t,e,n,r){const i=this,s=[],o=new Qvt,a=new Rwt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(t[c],(function(t){const n=i.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=1006),o.image=s,o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=1006),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,r);return o}}),Lwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Lwt,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Cwt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Cwt.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),Dwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Dwt,load:function(t,e,n,r){const i=new Ogt,s=new Lwt(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){i.images[n]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}),Fwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:Fwt,load:function(t,e,n,r){const i=this,s=new Lgt,o=new Rwt(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:1001,s.wrapT=void 0!==n.wrapT?n.wrapT:1001,s.magFilter=void 0!==n.magFilter?n.magFilter:1006,s.minFilter=void 0!==n.minFilter?n.minFilter:1006,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=1008),1===n.mipmapCount&&(s.minFilter=1006),s.needsUpdate=!0,e&&e(s,n))}),n,r),s}}),zwt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:zwt,load:function(t,e,n,r){const i=new oft,s=new Lwt(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?1022:1023,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}),Object.assign(Bwt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const c=n[r];return(r+(s-c)/(n[r+1]-c))/(i-1)},getTangent:function(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new eft:new hft);return a.copy(o).sub(s).normalize(),a},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new hft,r=[],i=[],s=[],o=new hft,a=new zft;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new hft),r[e].normalize()}i[0]=new hft,s[0]=new hft;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(tft.clamp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(tft.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Uwt.prototype=Object.create(Bwt.prototype),Uwt.prototype.constructor=Uwt,Uwt.prototype.isEllipseCurve=!0,Uwt.prototype.getPoint=function(t,e){const n=e||new eft,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)},Uwt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Uwt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Uwt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Vwt.prototype=Object.create(Uwt.prototype),Vwt.prototype.constructor=Vwt,Vwt.prototype.isArcCurve=!0;const Wwt=new hft,Hwt=new jwt,Gwt=new jwt,qwt=new jwt;function Xwt(t=[],e=!1,n="centripetal",r=.5){Bwt.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}function Ywt(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function Kwt(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Zwt(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function Jwt(t=new eft,e=new eft,n=new eft,r=new eft){Bwt.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function Qwt(t=new hft,e=new hft,n=new hft,r=new hft){Bwt.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function tSt(t=new eft,e=new eft){Bwt.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function eSt(t=new hft,e=new hft){Bwt.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function nSt(t=new eft,e=new eft,n=new eft){Bwt.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}function rSt(t=new hft,e=new hft,n=new hft){Bwt.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}function iSt(t=[]){Bwt.call(this),this.type="SplineCurve",this.points=t}Xwt.prototype=Object.create(Bwt.prototype),Xwt.prototype.constructor=Xwt,Xwt.prototype.isCatmullRomCurve3=!0,Xwt.prototype.getPoint=function(t,e=new hft){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(Wwt.subVectors(r[0],r[1]).add(r[0]),o=Wwt);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(Wwt.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Wwt),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),Hwt.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,e,n,r),Gwt.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,e,n,r),qwt.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(Hwt.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),Gwt.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),qwt.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(Hwt.calc(c),Gwt.calc(c),qwt.calc(c)),n},Xwt.prototype.copy=function(t){Bwt.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Xwt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Xwt.prototype.fromJSON=function(t){Bwt.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new hft).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Jwt.prototype=Object.create(Bwt.prototype),Jwt.prototype.constructor=Jwt,Jwt.prototype.isCubicBezierCurve=!0,Jwt.prototype.getPoint=function(t,e=new eft){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Zwt(t,r.x,i.x,s.x,o.x),Zwt(t,r.y,i.y,s.y,o.y)),n},Jwt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Jwt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Jwt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Qwt.prototype=Object.create(Bwt.prototype),Qwt.prototype.constructor=Qwt,Qwt.prototype.isCubicBezierCurve3=!0,Qwt.prototype.getPoint=function(t,e=new hft){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Zwt(t,r.x,i.x,s.x,o.x),Zwt(t,r.y,i.y,s.y,o.y),Zwt(t,r.z,i.z,s.z,o.z)),n},Qwt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Qwt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Qwt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},tSt.prototype=Object.create(Bwt.prototype),tSt.prototype.constructor=tSt,tSt.prototype.isLineCurve=!0,tSt.prototype.getPoint=function(t,e=new eft){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},tSt.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},tSt.prototype.getTangent=function(t,e){const n=e||new eft;return n.copy(this.v2).sub(this.v1).normalize(),n},tSt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},tSt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},tSt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},eSt.prototype=Object.create(Bwt.prototype),eSt.prototype.constructor=eSt,eSt.prototype.isLineCurve3=!0,eSt.prototype.getPoint=function(t,e=new hft){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},eSt.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},eSt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},eSt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},eSt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},nSt.prototype=Object.create(Bwt.prototype),nSt.prototype.constructor=nSt,nSt.prototype.isQuadraticBezierCurve=!0,nSt.prototype.getPoint=function(t,e=new eft){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(Kwt(t,r.x,i.x,s.x),Kwt(t,r.y,i.y,s.y)),n},nSt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},nSt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},nSt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},rSt.prototype=Object.create(Bwt.prototype),rSt.prototype.constructor=rSt,rSt.prototype.isQuadraticBezierCurve3=!0,rSt.prototype.getPoint=function(t,e=new hft){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(Kwt(t,r.x,i.x,s.x),Kwt(t,r.y,i.y,s.y),Kwt(t,r.z,i.z,s.z)),n},rSt.prototype.copy=function(t){return Bwt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},rSt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},rSt.prototype.fromJSON=function(t){return Bwt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},iSt.prototype=Object.create(Bwt.prototype),iSt.prototype.constructor=iSt,iSt.prototype.isSplineCurve=!0,iSt.prototype.getPoint=function(t,e=new eft){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(Ywt(o,a.x,l.x,c.x,u.x),Ywt(o,a.y,l.y,c.y,u.y)),n},iSt.prototype.copy=function(t){Bwt.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},iSt.prototype.toJSON=function(){const t=Bwt.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},iSt.prototype.fromJSON=function(t){Bwt.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new eft).fromArray(n))}return this};var sSt=Object.freeze({__proto__:null,ArcCurve:Vwt,CatmullRomCurve3:Xwt,CubicBezierCurve:Jwt,CubicBezierCurve3:Qwt,EllipseCurve:Uwt,LineCurve:tSt,LineCurve3:eSt,QuadraticBezierCurve:nSt,QuadraticBezierCurve3:rSt,SplineCurve:iSt});function oSt(){Bwt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function aSt(t){oSt.call(this),this.type="Path",this.currentPoint=new eft,t&&this.setFromPoints(t)}function lSt(t){aSt.call(this,t),this.uuid=tft.generateUUID(),this.type="Shape",this.holes=[]}function cSt(t,e=1){umt.call(this),this.type="Light",this.color=new $mt(t),this.intensity=e}function uSt(t,e,n){cSt.call(this,t,n),this.type="HemisphereLight",this.position.copy(umt.DefaultUp),this.updateMatrix(),this.groundColor=new $mt(e)}function hSt(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new eft(512,512),this.map=null,this.mapPass=null,this.matrix=new zft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zgt,this._frameExtents=new eft(1,1),this._viewportCount=1,this._viewports=[new lft(0,0,1,1)]}function dSt(){hSt.call(this,new $gt(50,1,.5,500)),this.focus=1}function pSt(t,e,n,r,i,s){cSt.call(this,t,e),this.type="SpotLight",this.position.copy(umt.DefaultUp),this.updateMatrix(),this.target=new umt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==s?s:1,this.shadow=new dSt}function fSt(){hSt.call(this,new $gt(90,1,.5,500)),this._frameExtents=new eft(4,2),this._viewportCount=6,this._viewports=[new lft(2,1,1,1),new lft(0,1,1,1),new lft(3,1,1,1),new lft(1,1,1,1),new lft(3,0,1,1),new lft(1,0,1,1)],this._cubeDirections=[new hft(1,0,0),new hft(-1,0,0),new hft(0,0,1),new hft(0,0,-1),new hft(0,1,0),new hft(0,-1,0)],this._cubeUps=[new hft(0,1,0),new hft(0,1,0),new hft(0,1,0),new hft(0,1,0),new hft(0,0,1),new hft(0,0,-1)]}function mSt(t,e,n,r){cSt.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new fSt}function gSt(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){Igt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}function ySt(){hSt.call(this,new gSt(-5,5,5,-5,.5,500))}function bSt(t,e){cSt.call(this,t,e),this.type="DirectionalLight",this.position.copy(umt.DefaultUp),this.updateMatrix(),this.target=new umt,this.shadow=new ySt}function vSt(t,e){cSt.call(this,t,e),this.type="AmbientLight"}function xSt(t,e,n,r){cSt.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}oSt.prototype=Object.assign(Object.create(Bwt.prototype),{constructor:oSt,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new tSt(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],s=i.getLength(),o=0===s?0:1-t/s;return i.getPointAt(o)}r++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Bwt.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Bwt.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Bwt.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new sSt[n.type]).fromJSON(n))}return this}}),aSt.prototype=Object.assign(Object.create(oSt.prototype),{constructor:aSt,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new tSt(this.currentPoint.clone(),new eft(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const i=new nSt(this.currentPoint.clone(),new eft(t,e),new eft(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,s){const o=new Jwt(this.currentPoint.clone(),new eft(t,e),new eft(n,r),new eft(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this},splineThru:function(t){const e=new iSt([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this},absarc:function(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this},ellipse:function(t,e,n,r,i,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this},absellipse:function(t,e,n,r,i,s,o,a){const l=new Uwt(t,e,n,r,i,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return oSt.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=oSt.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return oSt.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),lSt.prototype=Object.assign(Object.create(aSt.prototype),{constructor:lSt,getPointsHoles:function(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){aSt.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=aSt.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){aSt.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new aSt).fromJSON(n))}return this}}),cSt.prototype=Object.assign(Object.create(umt.prototype),{constructor:cSt,isLight:!0,copy:function(t){return umt.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=umt.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),uSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:uSt,isHemisphereLight:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(hSt.prototype,{_projScreenMatrix:new zft,_lightPositionWorld:new hft,_lookTarget:new hft,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(t.matrixWorld),e.position.copy(s),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),dSt.prototype=Object.assign(Object.create(hSt.prototype),{constructor:dSt,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*tft.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),hSt.prototype.updateMatrices.call(this,t)}}),pSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:pSt,isSpotLight:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),fSt.prototype=Object.assign(Object.create(hSt.prototype),{constructor:fSt,isPointLightShadow:!0,updateMatrices:function(t,e=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,s=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),s.copy(n.position),s.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(s),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),mSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:mSt,isPointLight:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),gSt.prototype=Object.assign(Object.create(Igt.prototype),{constructor:gSt,isOrthographicCamera:!0,copy:function(t,e){return Igt.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=umt.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),ySt.prototype=Object.assign(Object.create(hSt.prototype),{constructor:ySt,isDirectionalLightShadow:!0,updateMatrices:function(t){hSt.prototype.updateMatrices.call(this,t)}}),bSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:bSt,isDirectionalLight:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),vSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:vSt,isAmbientLight:!0}),xSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:xSt,isRectAreaLight:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=cSt.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class wSt{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new hft)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}function SSt(t,e){cSt.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new wSt}function _St(t){Iwt.call(this,t),this.textures={}}SSt.prototype=Object.assign(Object.create(cSt.prototype),{constructor:SSt,isLightProbe:!0,copy:function(t){return cSt.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=cSt.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),_St.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:_St,load:function(t,e,n,r){const i=this,s=new Rwt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new dwt[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new $mt).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new $mt).setHex(i.value);break;case"v2":r.uniforms[e].value=(new eft).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new hft).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new lft).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new nft).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new zft).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new eft).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new eft).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});const kSt={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function TSt(){ogt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function ESt(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),zmt.call(this,t,e,n),this.meshPerAttribute=r||1}function MSt(t){Iwt.call(this,t)}TSt.prototype=Object.assign(Object.create(ogt.prototype),{constructor:TSt,isInstancedBufferGeometry:!0,copy:function(t){return ogt.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=ogt.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),ESt.prototype=Object.assign(Object.create(zmt.prototype),{constructor:ESt,isInstancedBufferAttribute:!0,copy:function(t){return zmt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=zmt.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),MSt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:MSt,load:function(t,e,n,r){const i=this,s=new Rwt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],s=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),o=new Zbt(Jmt(i.type,s),i.stride);return o.uuid=i.uuid,e[r]=o,o}const i=t.isInstancedBufferGeometry?new TSt:new ogt,s=t.data.index;if(void 0!==s){const t=Jmt(s.type,s.array);i.setIndex(new zmt(t,1))}const o=t.data.attributes;for(const e in o){const n=o[e];let s;if(n.isInterleavedBufferAttribute){s=new Qbt(r(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=Jmt(n.type,n.array);s=new(n.isInstancedBufferAttribute?ESt:zmt)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),i.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let o;if(i.isInterleavedBufferAttribute){o=new Qbt(r(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{o=new zmt(Jmt(i.type,i.array),i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),s.push(o)}i.morphAttributes[e]=s}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];i.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new hft;void 0!==c.center&&t.fromArray(c.center),i.boundingSphere=new Nft(t,c.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}});const CSt={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},ASt={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},NSt={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function ISt(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Iwt.call(this,t),this.options={premultiplyAlpha:"none"}}function $St(){this.type="ShapePath",this.color=new $mt,this.subPaths=[],this.currentPath=null}ISt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:ISt,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Cwt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,i.options)})).then((function(n){Cwt.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign($St.prototype,{moveTo:function(t,e){return this.currentPath=new aSt,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,s){return this.currentPath.bezierCurveTo(t,e,n,r,i,s),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new lSt;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=e[i],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[i],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return r}const i=Dxt.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new lSt,l.curves=a.curves,c.push(l),c;let u=!i(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,n=s.length;e<n;e++)a=s[e],p=a.getPoints(),o=i(p),o=t?!o:o,o?(!u&&d[g]&&g++,d[g]={s:new lSt,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(s);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)h[t]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let s=0;s<i.length;s++){const o=i[s];let a=!0;for(let i=0;i<d.length;i++)r(o.p,d[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:s}),a?(a=!1,h[i].push(o)):t=!0);a&&h[n].push(o)}}e.length>0&&(t||(m=h))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}});class RSt{constructor(t){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],r=function(t,e,n){const r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[];let a=0,l=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,l-=s;else{const t=OSt(e,i,a,l,n);a+=t.offsetX,o.push(t.path)}}return o}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}function OSt(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const o=new $St;let a,l,c,u,h,d,p,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=t.length;i<s;){switch(t[i++]){case"m":a=t[i++]*e+n,l=t[i++]*e+r,o.moveTo(a,l);break;case"l":a=t[i++]*e+n,l=t[i++]*e+r,o.lineTo(a,l);break;case"q":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,o.quadraticCurveTo(h,d,c,u);break;case"b":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,p=t[i++]*e+n,f=t[i++]*e+r,o.bezierCurveTo(h,d,p,f,c,u)}}}return{offsetX:s.ha*e,path:o}}function PSt(t){Iwt.call(this,t)}let LSt;PSt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:PSt,load:function(t,e,n,r){const i=this,s=new Rwt(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new RSt(t)}});const DSt={getContext:function(){return void 0===LSt&&(LSt=new(window.AudioContext||window.webkitAudioContext)),LSt},setContext:function(t){LSt=t}};function FSt(t){Iwt.call(this,t)}function zSt(t,e,n){SSt.call(this,void 0,n);const r=(new $mt).set(t),i=(new $mt).set(e),s=new hft(r.r,r.g,r.b),o=new hft(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}function BSt(t,e){SSt.call(this,void 0,e);const n=(new $mt).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}FSt.prototype=Object.assign(Object.create(Iwt.prototype),{constructor:FSt,load:function(t,e,n,r){const i=this,s=new Rwt(i.manager);s.setResponseType("arraybuffer"),s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);DSt.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}),zSt.prototype=Object.assign(Object.create(SSt.prototype),{constructor:zSt,isHemisphereLightProbe:!0,copy:function(t){return SSt.prototype.copy.call(this,t),this},toJSON:function(t){return SSt.prototype.toJSON.call(this,t)}}),BSt.prototype=Object.assign(Object.create(SSt.prototype),{constructor:BSt,isAmbientLightProbe:!0,copy:function(t){return SSt.prototype.copy.call(this,t),this},toJSON:function(t){return SSt.prototype.toJSON.call(this,t)}});const USt=new zft,VSt=new zft;function jSt(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new $gt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new $gt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(jSt.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,s=e.near*Math.tan(tft.DEG2RAD*e.fov*.5)/e.zoom;let o,a;VSt.elements[12]=-r,USt.elements[12]=r,o=-s*e.aspect+i,a=s*e.aspect+i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(n),o=-s*e.aspect-i,a=s*e.aspect-i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(VSt),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(USt)}});class WSt{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=HSt(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=HSt();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function HSt(){return("undefined"==typeof performance?Date:performance).now()}const GSt=new hft,qSt=new uft,XSt=new hft,YSt=new hft;class KSt extends umt{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const ZSt=new hft,JSt=new uft,QSt=new hft,t_t=new hft;class e_t{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}function n_t(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(n_t.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){o.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){uft.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){const s=this._workIndex*i;uft.multiplyQuaternionsFlat(t,s,t,e,t,n),uft.slerpFlat(t,e,t,e,t,s,r)},_lerp:function(t,e,n,r,i){const s=1-r;for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]*s+t[n+o]*r}},_lerpAdditive:function(t,e,n,r,i){for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]+t[n+s]*r}}});const r_t=new RegExp("[\\[\\]\\.:\\/]","g"),i_t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",s_t=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),o_t=/(WCOD+)?/.source.replace("WCOD",i_t),a_t=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),l_t=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),c_t=new RegExp("^"+s_t+o_t+a_t+l_t+"$"),u_t=["material","materials","bones"];function h_t(t,e,n){const r=n||d_t.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function d_t(t,e,n){this.path=e,this.parsedPath=n||d_t.parseTrackName(e),this.node=d_t.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function p_t(){this.uuid=tft.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(h_t.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(d_t,{Composite:h_t,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new d_t.Composite(t,e,n):new d_t(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(r_t,"")},parseTrackName:function(t){const e=c_t.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==u_t.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(d_t.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=d_t.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(d_t.prototype,{_getValue_unbound:d_t.prototype.getValue,_setValue_unbound:d_t.prototype.setValue}),Object.assign(p_t.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=e[h];if(void 0===d){d=a++,e[h]=d,t.push(u);for(let t=0,e=s;t!==e;++t)i[t].push(new d_t(u,n[t],r[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[h]=a,t[a]=u;for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new d_t(u,n[t],r[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=i){const s=i++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[l]=r,e[s]=i}}}this.nCachedObjects_=i},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<i){const o=--i,a=t[o],c=--s,u=t[c];e[a.uuid]=l,t[l]=a,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[l]=r,e[o]=i,e.pop()}}else{const i=--s,o=t[i];i>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,s.push(t),o.push(e),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new d_t(r,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});class f_t{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,s=i.length,o=new Array(s),a={endingStart:2400,endingEnd:2400};for(let t=0;t!==s;++t){const e=i[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const s=2202===n;if(0===t)return-1===i?r:s&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}}function m_t(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}m_t.prototype=Object.assign(Object.create(Zpt.prototype),{constructor:m_t,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==i;++t){const i=r[t],l=i.name;let u=c[l];if(void 0!==u)s[t]=u;else{if(u=s[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new n_t(d_t.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[t]=u}o[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,i=this._actionsByClip;let s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new gwt(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,i=r.uuid;let s="string"==typeof t?Ewt.findByName(r,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:2500),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new f_t(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c},existingAction:function(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?Ewt.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o){e[o]._update(r,t,i,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class g_t{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new g_t(void 0===this.value.clone?this.value:this.value.clone())}}function y_t(t,e,n){Zbt.call(this,t,e),this.meshPerAttribute=n||1}function b_t(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function v_t(t,e,n,r){this.ray=new Fft(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new Kft,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function x_t(t,e){return t.distance-e.distance}function w_t(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)w_t(r[t],e,n,!0)}}y_t.prototype=Object.assign(Object.create(Zbt.prototype),{constructor:y_t,isInstancedInterleavedBuffer:!0,copy:function(t){return Zbt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=Zbt.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=Zbt.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(b_t.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(b_t.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(v_t.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,n){const r=n||[];return w_t(t,this,r,e),r.sort(x_t),r},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=t.length;n<i;n++)w_t(t[n],this,r,e);return r.sort(x_t),r}});class S_t{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(tft.clamp(e/this.radius,-1,1))),this}}const __t=new eft;class k_t{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new eft(1/0,1/0),this.max=void 0!==e?e:new eft(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=__t.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new eft),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new eft),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new eft),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new eft),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return __t.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const T_t=new hft,E_t=new hft;class M_t{constructor(t,e){this.start=void 0!==t?t:new hft,this.end=void 0!==e?e:new hft}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new hft),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new hft),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new hft),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){T_t.subVectors(t,this.start),E_t.subVectors(this.end,this.start);const n=E_t.dot(E_t);let r=E_t.dot(T_t)/n;return e&&(r=tft.clamp(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new hft),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function C_t(t){umt.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}C_t.prototype=Object.create(umt.prototype),C_t.prototype.constructor=C_t,C_t.prototype.isImmediateRenderObject=!0;const A_t=new hft;const N_t=new hft,I_t=new zft,$_t=new zft;class R_t extends jvt{constructor(t){const e=O_t(t),n=new ogt,r=[],i=[],s=new $mt(0,0,1),o=new $mt(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new Xmt(r,3)),n.setAttribute("color",new Xmt(i,3));super(n,new Ovt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");$_t.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(I_t.multiplyMatrices($_t,i.matrixWorld),N_t.setFromMatrixPosition(I_t),r.setXYZ(n,N_t.x,N_t.y,N_t.z),I_t.multiplyMatrices($_t,i.parent.matrixWorld),N_t.setFromMatrixPosition(I_t),r.setXYZ(n+1,N_t.x,N_t.y,N_t.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function O_t(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,O_t(t.children[n]));return e}const P_t=new hft,L_t=new $mt,D_t=new $mt;class F_t extends jvt{constructor(t=10,e=10,n=4473924,r=8947848){n=new $mt(n),r=new $mt(r);const i=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,u=-o;t<=e;t++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const e=t===i?n:r;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new ogt;c.setAttribute("position",new Xmt(a,3)),c.setAttribute("color",new Xmt(l,3));super(c,new Ovt({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const z_t=new hft,B_t=new hft,U_t=new hft;const V_t=new hft,j_t=new Igt;function W_t(t,e,n,r,i,s,o){V_t.set(i,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],V_t.x,V_t.y,V_t.z)}}const H_t=new fft;class G_t extends jvt{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new ogt;i.setIndex(new zmt(n,1)),i.setAttribute("position",new zmt(r,3)),super(i,new Ovt({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&H_t.setFromObject(this.object),H_t.isEmpty())return;const e=H_t.min,n=H_t.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return jvt.prototype.copy.call(this,t),this.object=t.object,this}}const q_t=new hft;let X_t,Y_t;class K_t extends jvt{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new ogt;n.setAttribute("position",new Xmt(e,3)),n.setAttribute("color",new Xmt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Ovt({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const Z_t=new Float32Array(1),J_t=new Int32Array(Z_t.buffer),Q_t={toHalfFloat:function(t){Z_t[0]=t;const e=J_t[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},tkt=Math.pow(2,8),ekt=[.125,.215,.35,.446,.526,.582],nkt=5+ekt.length,rkt={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},ikt=new Lmt({side:1,depthWrite:!1,depthTest:!1}),skt=new kgt(new Egt,ikt),okt=new gSt,{_lodPlanes:akt,_sizeLods:lkt,_sigmas:ckt}=ykt(),ukt=new $mt;let hkt=null;const dkt=(1+Math.sqrt(5))/2,pkt=1/dkt,fkt=[new hft(1,1,1),new hft(-1,1,1),new hft(1,1,-1),new hft(-1,1,-1),new hft(0,dkt,pkt),new hft(0,dkt,-pkt),new hft(pkt,0,dkt),new hft(-pkt,0,dkt),new hft(dkt,pkt,0),new hft(-dkt,pkt,0)];function mkt(t){const e=Math.max(t.r,t.g,t.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);t.multiplyScalar(Math.pow(2,-n));return(n+128)/255}function gkt(t){return void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding)}function ykt(){const t=[],e=[],n=[];let r=8;for(let i=0;i<nkt;i++){const s=Math.pow(2,r);e.push(s);let o=1/s;i>4?o=ekt[i-8+4-1]:0==i&&(o=0),n.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),y=new Float32Array(f*d*h),b=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(r,p*d*t),y.set(u,f*d*t);const i=[t,t,t,t,t,t];b.set(i,m*d*t)}const v=new ogt;v.setAttribute("position",new zmt(g,p)),v.setAttribute("uv",new zmt(y,f)),v.setAttribute("faceIndex",new zmt(b,m)),t.push(v),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function bkt(t){const e=new cft(3*tkt,3*tkt,t);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function vkt(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function xkt(){return new rwt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new eft(1,1)},inputEncoding:{value:rkt[3e3]},outputEncoding:{value:rkt[3e3]}},vertexShader:Skt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${_kt()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function wkt(){return new rwt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:rkt[3e3]},outputEncoding:{value:rkt[3e3]}},vertexShader:Skt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${_kt()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Skt(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _kt(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function kkt(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Xwt.call(this,t),this.type="catmullrom",this.closed=!0}function Tkt(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Xwt.call(this,t),this.type="catmullrom"}function Ekt(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Xwt.call(this,t),this.type="catmullrom"}Bwt.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Bwt.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(aSt.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),kkt.prototype=Object.create(Xwt.prototype),Tkt.prototype=Object.create(Xwt.prototype),Ekt.prototype=Object.create(Xwt.prototype),Object.assign(Ekt.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),F_t.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},R_t.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Iwt.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),kSt.extractUrlBase(t)}}),Iwt.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(k_t.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(fft.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Nft.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),zgt.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},M_t.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(tft,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),tft.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),tft.ceilPowerOfTwo(t)}}),Object.assign(nft.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(zft.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new hft).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),fmt.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(uft.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Fft.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Tmt.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Tmt,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Tmt.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Tmt.getNormal(t,e,n,r)}}),Object.assign(lSt.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Bxt(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new qxt(this,t)}}),Object.assign(eft.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(hft.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(lft.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(umt.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(umt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(kgt.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(kgt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(bvt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Cvt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),kvt.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Bwt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),$gt.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(cSt.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(zmt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(zmt.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ogt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new zmt(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(ogt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(TSt.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(v_t.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Zbt.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Zbt.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Bxt.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(Kbt.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(g_t.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Pmt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new $mt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(owt.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(swt.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(Ngt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Gbt.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Gbt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Dbt.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(cft.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(KSt.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new FSt).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),e_t.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Rgt.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Rgt.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)};const Mkt={merge:function(t,e,n){let r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};ift.crossOrigin=void 0,ift.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new zwt;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},ift.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Dwt;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},ift.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ift.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Ckt={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125");var Akt=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:100,AddOperation:2,AdditiveAnimationBlendMode:2501,AdditiveBlending:2,AlphaFormat:1021,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:vSt,AmbientLightProbe:BSt,AnimationClip:Ewt,AnimationLoader:Owt,AnimationMixer:m_t,AnimationObjectGroup:p_t,AnimationUtils:pwt,ArcCurve:Vwt,ArrayCamera:Ubt,ArrowHelper:class extends umt{constructor(t,e,n,r,i,s){super(),this.type="ArrowHelper",void 0===t&&(t=new hft(0,0,1)),void 0===e&&(e=new hft(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===s&&(s=.2*i),void 0===X_t&&(X_t=new ogt,X_t.setAttribute("position",new Xmt([0,0,0,0,1,0],3)),Y_t=new rxt(0,.5,1,5,1),Y_t.translate(0,-.5,0)),this.position.copy(e),this.line=new Bvt(X_t,new Ovt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new kgt(Y_t,new Lmt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{q_t.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(q_t,e)}}setLength(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},Audio:KSt,AudioAnalyser:e_t,AudioContext:DSt,AudioListener:class extends umt{constructor(){super(),this.type="AudioListener",this.context=DSt.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new WSt}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(GSt,qSt,XSt),YSt.set(0,0,-1).applyQuaternion(qSt),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(GSt.x,t),e.positionY.linearRampToValueAtTime(GSt.y,t),e.positionZ.linearRampToValueAtTime(GSt.z,t),e.forwardX.linearRampToValueAtTime(YSt.x,t),e.forwardY.linearRampToValueAtTime(YSt.y,t),e.forwardZ.linearRampToValueAtTime(YSt.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(GSt.x,GSt.y,GSt.z),e.setOrientation(YSt.x,YSt.y,YSt.z,n.x,n.y,n.z)}},AudioLoader:FSt,AxesHelper:K_t,AxisHelper:function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new K_t(t)},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Fwt(t)},Bone:Tvt,BooleanKeyframeTrack:vwt,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new G_t(t,e)},Box2:k_t,Box3:fft,Box3Helper:class extends jvt{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new ogt;r.setIndex(new zmt(n,1)),r.setAttribute("position",new Xmt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Ovt({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},BoxBufferGeometry:Egt,BoxGeometry:Egt,BoxHelper:G_t,BufferAttribute:zmt,BufferGeometry:ogt,BufferGeometryLoader:MSt,ByteType:1010,Cache:Cwt,Camera:Igt,CameraHelper:class extends jvt{constructor(t){const e=new ogt,n=new Ovt({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={},o=new $mt(16755200),a=new $mt(16711680),l=new $mt(43775),c=new $mt(16777215),u=new $mt(3355443);function h(t,e,n){d(t,n),d(e,n)}function d(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new Xmt(r,3)),e.setAttribute("color",new Xmt(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;j_t.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),W_t("c",e,t,j_t,0,0,-1),W_t("t",e,t,j_t,0,0,1),W_t("n1",e,t,j_t,-1,-1,-1),W_t("n2",e,t,j_t,1,-1,-1),W_t("n3",e,t,j_t,-1,1,-1),W_t("n4",e,t,j_t,1,1,-1),W_t("f1",e,t,j_t,-1,-1,1),W_t("f2",e,t,j_t,1,-1,1),W_t("f3",e,t,j_t,-1,1,1),W_t("f4",e,t,j_t,1,1,1),W_t("u1",e,t,j_t,.7,1.1,-1),W_t("u2",e,t,j_t,-.7,1.1,-1),W_t("u3",e,t,j_t,0,2,-1),W_t("cf1",e,t,j_t,-1,0,1),W_t("cf2",e,t,j_t,1,0,1),W_t("cf3",e,t,j_t,0,-1,1),W_t("cf4",e,t,j_t,0,1,1),W_t("cn1",e,t,j_t,-1,0,-1),W_t("cn2",e,t,j_t,1,0,-1),W_t("cn3",e,t,j_t,0,-1,-1),W_t("cn4",e,t,j_t,0,1,-1),t.getAttribute("position").needsUpdate=!0}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:txt,CatmullRomCurve3:Xwt,CineonToneMapping:3,CircleBufferGeometry:nxt,CircleGeometry:nxt,ClampToEdgeWrapping:1001,Clock:WSt,ClosedSplineCurve3:kkt,Color:$mt,ColorKeyframeTrack:xwt,CompressedTexture:Qvt,CompressedTextureLoader:Pwt,ConeBufferGeometry:ixt,ConeGeometry:ixt,CubeCamera:Rgt,CubeReflectionMapping:301,CubeRefractionMapping:302,CubeTexture:Ogt,CubeTextureLoader:Dwt,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,CubicBezierCurve:Jwt,CubicBezierCurve3:Qwt,CubicInterpolant:mwt,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:Bwt,CurvePath:oSt,CustomBlending:5,CustomToneMapping:5,CylinderBufferGeometry:rxt,CylinderGeometry:rxt,Cylindrical:class{constructor(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}},DataTexture:Lgt,DataTexture2DArray:oyt,DataTexture3D:ayt,DataTextureLoader:Fwt,DataUtils:Q_t,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:Nwt,DepthFormat:1026,DepthStencilFormat:1027,DepthTexture:ext,DirectionalLight:bSt,DirectionalLightHelper:class extends umt{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new ogt;r.setAttribute("position",new Xmt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new Ovt({fog:!1,toneMapped:!1});this.lightPlane=new Bvt(r,i),this.add(this.lightPlane),r=new ogt,r.setAttribute("position",new Xmt([0,0,0,0,0,1],3)),this.targetLine=new Bvt(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){z_t.setFromMatrixPosition(this.light.matrixWorld),B_t.setFromMatrixPosition(this.light.target.matrixWorld),U_t.subVectors(B_t,z_t),this.lightPlane.lookAt(B_t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(B_t),this.targetLine.scale.z=U_t.length()}},DiscreteInterpolant:ywt,DodecahedronBufferGeometry:oxt,DodecahedronGeometry:oxt,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new zmt(t,e).setUsage(35048)},DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:hxt,EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new jvt(new hxt(t.geometry),new Ovt({color:void 0!==e?e:16777215}))},EllipseCurve:Uwt,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,Euler:qft,EventDispatcher:Zpt,ExtrudeBufferGeometry:Bxt,ExtrudeGeometry:Bxt,Face3:Rmt,Face4:function(t,e,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Rmt(t,e,n,i,s,o)},FaceColors:1,FileLoader:Rwt,FlatShading:1,Float16BufferAttribute:qmt,Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Xmt(t,e)},Float32BufferAttribute:Xmt,Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ymt(t,e)},Float64BufferAttribute:Ymt,FloatType:1015,Fog:Ybt,FogExp2:Xbt,Font:RSt,FontLoader:PSt,FrontSide:0,Frustum:zgt,GLBufferAttribute:b_t,GLSL1:"100",GLSL3:"300 es",GammaEncoding:3007,GeometryUtils:Mkt,GreaterDepth:6,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:F_t,Group:Vbt,HalfFloatType:1016,HemisphereLight:uSt,HemisphereLightHelper:class extends umt{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Wxt(e);r.rotateY(.5*Math.PI),this.material=new Lmt({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new zmt(s,3)),this.add(new kgt(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");L_t.copy(this.light.color),D_t.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?L_t:D_t;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(P_t.setFromMatrixPosition(this.light.matrixWorld).negate())}},HemisphereLightProbe:zSt,IcosahedronBufferGeometry:Vxt,IcosahedronGeometry:Vxt,ImageBitmapLoader:ISt,ImageLoader:Lwt,ImageUtils:ift,ImmediateRenderObject:C_t,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:ESt,InstancedBufferGeometry:TSt,InstancedInterleavedBuffer:y_t,InstancedMesh:Rvt,Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new jmt(t,e)},Int16BufferAttribute:jmt,Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Hmt(t,e)},Int32BufferAttribute:Hmt,Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Bmt(t,e)},Int8BufferAttribute:Bmt,IntType:1013,InterleavedBuffer:Zbt,InterleavedBufferAttribute:Qbt,Interpolant:fwt,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:7680,KeyframeTrack:bwt,LOD:bvt,LatheBufferGeometry:jxt,LatheGeometry:jxt,Layers:Kft,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:2,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:cSt,LightProbe:SSt,Line:Bvt,Line3:M_t,LineBasicMaterial:Ovt,LineCurve:tSt,LineCurve3:eSt,LineDashedMaterial:hwt,LineLoop:Wvt,LinePieces:1,LineSegments:jvt,LineStrip:0,LinearEncoding:3e3,LinearFilter:1006,LinearInterpolant:gwt,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:1008,LinearMipmapNearestFilter:1007,LinearToneMapping:1,Loader:Iwt,LoaderUtils:kSt,LoadingManager:Awt,LogLuvEncoding:3003,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:Ypt,Material:Pmt,MaterialLoader:_St,Math:tft,MathUtils:tft,Matrix3:nft,Matrix4:zft,MaxEquation:104,Mesh:kgt,MeshBasicMaterial:Lmt,MeshDepthMaterial:Pbt,MeshDistanceMaterial:Lbt,MeshFaceMaterial:function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},MeshLambertMaterial:cwt,MeshMatcapMaterial:uwt,MeshNormalMaterial:lwt,MeshPhongMaterial:owt,MeshPhysicalMaterial:swt,MeshStandardMaterial:iwt,MeshToonMaterial:awt,MinEquation:103,MirroredRepeatWrapping:1002,MixOperation:1,MultiMaterial:function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},MultiplyBlending:4,MultiplyOperation:0,NearestFilter:1003,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipmapNearestFilter:1004,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColors:0,NoToneMapping:0,NormalAnimationBlendMode:2500,NormalBlending:1,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:wwt,Object3D:umt,ObjectLoader:class extends Iwt{constructor(t){super(t)}load(t,e,n,r){const i=this,s=""===this.path?kSt.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new Rwt(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,i,a,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new lSt).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new Cvt).fromJSON(t[e],r);n[i.uuid]=i}return n}parseGeometries(t,e){const n={};let r;if(void 0!==t){const i=new MSt;for(let s=0,o=t.length;s<o;s++){let o;const a=t[s];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ewt[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new ewt[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ewt[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ewt[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ewt[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ewt[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ewt[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ewt[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ewt[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ewt[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new ewt[a.type]((new sSt[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ewt[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ewt[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}o=new ewt[a.type](r,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new sSt[t.type]).fromJSON(t)),o=new ewt[a.type](r,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new _St;i.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const r=s.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=Ewt.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:Jmt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new Awt(e);i=new Lwt(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=s(i[t]);null!==e&&(e instanceof HTMLImageElement?r[n.uuid].push(e):r[n.uuid].push(new Lgt(e.data,e.width,e.height)))}}else{const t=s(n.url);null!==t&&(r[n.uuid]=t)}}}return r}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,s=t.length;i<s;i++){const s=t[i];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image];Array.isArray(a)?(o=new Ogt(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new Lgt(a.data,a.width,a.height):new oft(a),a&&(o.needsUpdate=!0)),o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,CSt)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],ASt),o.wrapT=n(s.wrap[1],ASt)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,NSt)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,NSt)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r}parseObject(t,e,n,r){let i,s,o;function a(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new Kbt,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new $mt(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new Ybt(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new Xbt(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new $gt(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new gSt(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new vSt(t.color,t.intensity);break;case"DirectionalLight":i=new bSt(t.color,t.intensity);break;case"PointLight":i=new mSt(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new xSt(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new pSt(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new uSt(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new SSt).fromJSON(t);break;case"SkinnedMesh":s=a(t.geometry),o=l(t.material),i=new kvt(s,o),void 0!==t.bindMode&&(i.bindMode=t.bindMode),void 0!==t.bindMatrix&&i.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"Mesh":s=a(t.geometry),o=l(t.material),i=new kgt(s,o);break;case"InstancedMesh":s=a(t.geometry),o=l(t.material);const e=t.count,n=t.instanceMatrix;i=new Rvt(s,o,e),i.instanceMatrix=new zmt(new Float32Array(n.array),16);break;case"LOD":i=new bvt;break;case"Line":i=new Bvt(a(t.geometry),l(t.material));break;case"LineLoop":i=new Wvt(a(t.geometry),l(t.material));break;case"LineSegments":i=new jvt(a(t.geometry),l(t.material));break;case"PointCloud":case"Points":i=new Kvt(a(t.geometry),l(t.material));break;case"Sprite":i=new fvt(l(t.material));break;case"Group":i=new Vbt;break;case"Bone":i=new Tvt;break;default:i=new umt}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const s=t.children;for(let t=0;t<s.length;t++)i.add(this.parseObject(s[t],e,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];i.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},ObjectSpaceNormalMap:1,OctahedronBufferGeometry:Wxt,OctahedronGeometry:Wxt,OneFactor:201,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:205,OneMinusSrcColorFactor:203,OrthographicCamera:gSt,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new hft(0,1,0);return new rwt({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:rkt[3e3]},outputEncoding:{value:rkt[3e3]}},vertexShader:Skt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${_kt()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){hkt=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=wkt(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=xkt(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<akt.length;t++)akt[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(hkt),t.scissorTest=!1,vkt(t,0,0,t.width,t.height)}_fromTexture(t){hkt=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:gkt(t)?t.encoding:3002,depthBuffer:!1},n=bkt(e);return n.depthBuffer=!t,this._pingPongRenderTarget=bkt(e),n}_compileMaterial(t){const e=new kgt(akt[0],t);this._renderer.compile(e,okt)}_sceneToCubeUV(t,e,n,r){const i=new $gt(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(ukt),a.toneMapping=0,a.outputEncoding=3e3,a.autoClear=!1;let h=!1;const d=t.background;if(d){if(d.isColor){ikt.color.copy(d).convertSRGBToLinear(),t.background=null;const e=mkt(ikt.color);ikt.opacity=e,h=!0}}else{ikt.color.copy(ukt).convertSRGBToLinear();const t=mkt(ikt.color);ikt.opacity=t,h=!0}for(let e=0;e<6;e++){const n=e%3;0==n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1==n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e])),vkt(r,n*tkt,e>2?tkt:0,tkt,tkt),a.setRenderTarget(r),h&&a.render(skt,i),a.render(t,i)}a.toneMapping=u,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=wkt()):null==this._equirectShader&&(this._equirectShader=xkt());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new kgt(akt[0],r),s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=rkt[t.encoding],s.outputEncoding.value=rkt[e.texture.encoding],vkt(e,0,0,3*tkt,2*tkt),n.setRenderTarget(e),n.render(i,okt)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<nkt;e++){const n=Math.sqrt(ckt[e]*ckt[e]-ckt[e-1]*ckt[e-1]),r=fkt[(e-1)%fkt.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new kgt(akt[r],l),u=l.uniforms,h=lkt[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=rkt[t.texture.encoding],u.outputEncoding.value=rkt[t.texture.encoding];const y=lkt[r];vkt(e,3*Math.max(0,tkt-2*y),(0===r?0:2*tkt)+2*y*(r>4?r-8+4:0),3*y,2*y),a.setRenderTarget(e),a.render(c,okt)}},ParametricBufferGeometry:Hxt,ParametricGeometry:Hxt,Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new fvt(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Hvt(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Kvt(t,e)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Hvt(t)},Path:aSt,PerspectiveCamera:$gt,Plane:fmt,PlaneBufferGeometry:Vgt,PlaneGeometry:Vgt,PlaneHelper:class extends Bvt{constructor(t,e=1,n=16776960){const r=n,i=new ogt;i.setAttribute("position",new Xmt([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new Ovt({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new ogt;s.setAttribute("position",new Xmt([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new kgt(s,new Lmt({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Kvt(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Hvt(t)},PointLight:mSt,PointLightHelper:class extends kgt{constructor(t,e,n){super(new Xxt(e,4,2),new Lmt({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:Kvt,PointsMaterial:Hvt,PolarGridHelper:class extends jvt{constructor(t=10,e=16,n=8,r=64,i=4473924,s=8947848){i=new $mt(i),s=new $mt(s);const o=[],a=[];for(let n=0;n<=e;n++){const r=n/e*(2*Math.PI),l=Math.sin(r)*t,c=Math.cos(r)*t;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const l=1&e?i:s,c=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c;o.push(n,0,i),a.push(l.r,l.g,l.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c,o.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new ogt;l.setAttribute("position",new Xmt(o,3)),l.setAttribute("color",new Xmt(a,3));super(l,new Ovt({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},PolyhedronBufferGeometry:sxt,PolyhedronGeometry:sxt,PositionalAudio:class extends KSt{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ZSt,JSt,QSt),t_t.set(0,0,1).applyQuaternion(JSt);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ZSt.x,t),e.positionY.linearRampToValueAtTime(ZSt.y,t),e.positionZ.linearRampToValueAtTime(ZSt.z,t),e.orientationX.linearRampToValueAtTime(t_t.x,t),e.orientationY.linearRampToValueAtTime(t_t.y,t),e.orientationZ.linearRampToValueAtTime(t_t.z,t)}else e.setPosition(ZSt.x,ZSt.y,ZSt.z),e.setOrientation(t_t.x,t_t.y,t_t.z)}},PropertyBinding:d_t,PropertyMixer:n_t,QuadraticBezierCurve:nSt,QuadraticBezierCurve3:rSt,Quaternion:uft,QuaternionKeyframeTrack:_wt,QuaternionLinearInterpolant:Swt,REVISION:"125",RGBADepthPacking:3201,RGBAFormat:1023,RGBAIntegerFormat:1033,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_2BPPV1_Format:35843,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT1_Format:33777,RGBA_S3TC_DXT3_Format:33778,RGBA_S3TC_DXT5_Format:33779,RGBDEncoding:3006,RGBEEncoding:3002,RGBEFormat:1023,RGBFormat:1022,RGBIntegerFormat:1032,RGBM16Encoding:3005,RGBM7Encoding:3004,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_2BPPV1_Format:35841,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776,RGFormat:1030,RGIntegerFormat:1031,RawShaderMaterial:rwt,Ray:Fft,Raycaster:v_t,RectAreaLight:xSt,RedFormat:1028,RedIntegerFormat:1029,ReinhardToneMapping:2,RepeatWrapping:1e3,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingBufferGeometry:Gxt,RingGeometry:Gxt,SRGB8_ALPHA8_ASTC_10x10_Format:37851,SRGB8_ALPHA8_ASTC_10x5_Format:37848,SRGB8_ALPHA8_ASTC_10x6_Format:37849,SRGB8_ALPHA8_ASTC_10x8_Format:37850,SRGB8_ALPHA8_ASTC_12x10_Format:37852,SRGB8_ALPHA8_ASTC_12x12_Format:37853,SRGB8_ALPHA8_ASTC_4x4_Format:37840,SRGB8_ALPHA8_ASTC_5x4_Format:37841,SRGB8_ALPHA8_ASTC_5x5_Format:37842,SRGB8_ALPHA8_ASTC_6x5_Format:37843,SRGB8_ALPHA8_ASTC_6x6_Format:37844,SRGB8_ALPHA8_ASTC_8x5_Format:37845,SRGB8_ALPHA8_ASTC_8x6_Format:37846,SRGB8_ALPHA8_ASTC_8x8_Format:37847,Scene:Kbt,SceneUtils:Ckt,ShaderChunk:jgt,ShaderLib:Hgt,ShaderMaterial:Ngt,ShadowMaterial:nwt,Shape:lSt,ShapeBufferGeometry:qxt,ShapeGeometry:qxt,ShapePath:$St,ShapeUtils:Dxt,ShortType:1011,Skeleton:Cvt,SkeletonHelper:R_t,SkinnedMesh:kvt,SmoothShading:2,Sphere:Nft,SphereBufferGeometry:Xxt,SphereGeometry:Xxt,Spherical:S_t,SphericalHarmonics3:wSt,Spline:Ekt,SplineCurve:iSt,SplineCurve3:Tkt,SpotLight:pSt,SpotLightHelper:class extends umt{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new ogt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,s=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Xmt(r,3));const i=new Ovt({fog:!1,toneMapped:!1});this.cone=new jvt(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),A_t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(A_t),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:fvt,SpriteMaterial:tvt,SrcAlphaFactor:204,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:35044,StaticReadUsage:35045,StereoCamera:jSt,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:kwt,SubtractEquation:101,SubtractiveBlending:3,TOUCH:Kpt,TangentSpaceNormalMap:0,TetrahedronBufferGeometry:Yxt,TetrahedronGeometry:Yxt,TextBufferGeometry:Kxt,TextGeometry:Kxt,Texture:oft,TextureLoader:zwt,TorusBufferGeometry:Zxt,TorusGeometry:Zxt,TorusKnotBufferGeometry:Jxt,TorusKnotGeometry:Jxt,Triangle:Tmt,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:Qxt,TubeGeometry:Qxt,UVMapping:300,Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Wmt(t,e)},Uint16BufferAttribute:Wmt,Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Gmt(t,e)},Uint32BufferAttribute:Gmt,Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Umt(t,e)},Uint8BufferAttribute:Umt,Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Vmt(t,e)},Uint8ClampedBufferAttribute:Vmt,Uniform:g_t,UniformsLib:Wgt,UniformsUtils:Agt,UnsignedByteType:1009,UnsignedInt248Type:1020,UnsignedIntType:1014,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedShortType:1012,VSMShadowMap:3,Vector2:eft,Vector3:hft,Vector4:lft,VectorKeyframeTrack:Twt,Vertex:function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new hft(t,e,n)},VertexColors:2,VideoTexture:Jvt,WebGL1Renderer:qbt,WebGLCubeRenderTarget:Pgt,WebGLMultisampleRenderTarget:class extends cft{constructor(t,e,n){super(t,e,n),Object.defineProperty(this,"isWebGLMultisampleRenderTarget",{value:!0}),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}},WebGLRenderTarget:cft,WebGLRenderTargetCube:function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Pgt(t,n)},WebGLRenderer:Gbt,WebGLUtils:Bbt,WireframeGeometry:twt,WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new jvt(new twt(t.geometry),new Ovt({color:void 0!==e?e:16777215}))},WrapAroundEnding:2402,XHRLoader:function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Rwt(t)},ZeroCurvatureEnding:2400,ZeroFactor:200,ZeroSlopeEnding:2401,ZeroStencilOp:0,sRGBEncoding:3001}),Nkt=vt(Akt),Ikt=function(t,e){void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new hft,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Ypt.ROTATE,MIDDLE:Ypt.DOLLY,RIGHT:Ypt.PAN},this.touches={ONE:Kpt.ROTATE,TWO:Kpt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.listenToKeyEvents=function(t){t.addEventListener("keydown",W),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),a=o.NONE},this.update=function(){var e=new hft,i=(new uft).setFromUnitVectors(t.up,new hft(0,1,0)),s=i.clone().invert(),f=new hft,m=new uft,g=2*Math.PI;return function(){var t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(i),c.setFromVector3(e),n.autoRotate&&a===o.NONE&&k(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);var y=n.minAzimuthAngle,b=n.maxAzimuthAngle;return isFinite(y)&&isFinite(b)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),b<-Math.PI?b+=g:b>Math.PI&&(b-=g),c.theta=y<=b?Math.max(y,Math.min(b,c.theta)):c.theta>(y+b)/2?Math.max(y,c.theta):Math.min(b,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),e.setFromSpherical(c),e.applyQuaternion(s),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),f.copy(n.object.position),m.copy(n.object.quaternion),p=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",X),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("wheel",j),n.domElement.removeEventListener("touchstart",H),n.domElement.removeEventListener("touchend",q),n.domElement.removeEventListener("touchmove",G),n.domElement.ownerDocument.removeEventListener("pointermove",U),n.domElement.ownerDocument.removeEventListener("pointerup",V),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",W)};var n=this,r={type:"change"},i={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=o.NONE,l=1e-6,c=new S_t,u=new S_t,h=1,d=new hft,p=!1,f=new eft,m=new eft,g=new eft,y=new eft,b=new eft,v=new eft,x=new eft,w=new eft,S=new eft;function _(){return Math.pow(.95,n.zoomSpeed)}function k(t){u.theta-=t}function T(t){u.phi-=t}var E,M=(E=new hft,function(t,e){E.setFromMatrixColumn(e,0),E.multiplyScalar(-t),d.add(E)}),C=function(){var t=new hft;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),d.add(t)}}(),A=function(){var t=new hft;return function(e,r){var i=n.domElement;if(n.object.isPerspectiveCamera){var s=n.object.position;t.copy(s).sub(n.target);var o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),M(2*e*o/i.clientHeight,n.object.matrix),C(2*r*o/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(e*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),C(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function N(t){n.object.isPerspectiveCamera?h/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(t){n.object.isPerspectiveCamera?h*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function $(t){f.set(t.clientX,t.clientY)}function R(t){y.set(t.clientX,t.clientY)}function O(t){if(1==t.touches.length)f.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);f.set(e,n)}}function P(t){if(1==t.touches.length)y.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);y.set(e,n)}}function L(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);x.set(0,r)}function D(t){if(1==t.touches.length)m.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);m.set(e,r)}g.subVectors(m,f).multiplyScalar(n.rotateSpeed);var i=n.domElement;k(2*Math.PI*g.x/i.clientHeight),T(2*Math.PI*g.y/i.clientHeight),f.copy(m)}function F(t){if(1==t.touches.length)b.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);b.set(e,r)}v.subVectors(b,y).multiplyScalar(n.panSpeed),A(v.x,v.y),y.copy(b)}function z(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);w.set(0,i),S.set(0,Math.pow(w.y/x.y,n.zoomSpeed)),N(S.y),x.copy(w)}function B(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var e;switch(t.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ypt.DOLLY:if(!1===n.enableZoom)return;!function(t){x.set(t.clientX,t.clientY)}(t),a=o.DOLLY;break;case Ypt.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;R(t),a=o.PAN}else{if(!1===n.enableRotate)return;$(t),a=o.ROTATE}break;case Ypt.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;$(t),a=o.ROTATE}else{if(!1===n.enablePan)return;R(t),a=o.PAN}break;default:a=o.NONE}a!==o.NONE&&(n.domElement.ownerDocument.addEventListener("pointermove",U),n.domElement.ownerDocument.addEventListener("pointerup",V),n.dispatchEvent(i))}(t)}}function U(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){if(!1===n.enabled)return;switch(t.preventDefault(),a){case o.ROTATE:if(!1===n.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),g.subVectors(m,f).multiplyScalar(n.rotateSpeed);var e=n.domElement;k(2*Math.PI*g.x/e.clientHeight),T(2*Math.PI*g.y/e.clientHeight),f.copy(m),n.update()}(t);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(t){w.set(t.clientX,t.clientY),S.subVectors(w,x),S.y>0?N(_()):S.y<0&&I(_()),x.copy(w),n.update()}(t);break;case o.PAN:if(!1===n.enablePan)return;!function(t){b.set(t.clientX,t.clientY),v.subVectors(b,y).multiplyScalar(n.panSpeed),A(v.x,v.y),y.copy(b),n.update()}(t)}}(t)}}function V(t){switch(t.pointerType){case"mouse":case"pen":!function(t){if(n.domElement.ownerDocument.removeEventListener("pointermove",U),n.domElement.ownerDocument.removeEventListener("pointerup",V),!1===n.enabled)return;n.dispatchEvent(s),a=o.NONE}()}}function j(t){!1===n.enabled||!1===n.enableZoom||a!==o.NONE&&a!==o.ROTATE||(t.preventDefault(),t.stopPropagation(),n.dispatchEvent(i),function(t){t.deltaY<0?I(_()):t.deltaY>0&&N(_()),n.update()}(t),n.dispatchEvent(s))}function W(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){var e=!1;switch(t.keyCode){case n.keys.UP:A(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:A(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:A(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:A(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function H(t){if(!1!==n.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(n.touches.ONE){case Kpt.ROTATE:if(!1===n.enableRotate)return;O(t),a=o.TOUCH_ROTATE;break;case Kpt.PAN:if(!1===n.enablePan)return;P(t),a=o.TOUCH_PAN;break;default:a=o.NONE}break;case 2:switch(n.touches.TWO){case Kpt.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&L(t),n.enablePan&&P(t)}(t),a=o.TOUCH_DOLLY_PAN;break;case Kpt.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&L(t),n.enableRotate&&O(t)}(t),a=o.TOUCH_DOLLY_ROTATE;break;default:a=o.NONE}break;default:a=o.NONE}a!==o.NONE&&n.dispatchEvent(i)}}function G(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),a){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;D(t),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;F(t),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&z(t),n.enablePan&&F(t)}(t),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&z(t),n.enableRotate&&D(t)}(t),n.update();break;default:a=o.NONE}}function q(t){!1!==n.enabled&&(n.dispatchEvent(s),a=o.NONE)}function X(t){!1!==n.enabled&&t.preventDefault()}n.domElement.addEventListener("contextmenu",X),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("wheel",j),n.domElement.addEventListener("touchstart",H),n.domElement.addEventListener("touchend",q),n.domElement.addEventListener("touchmove",G),this.update()};(Ikt.prototype=Object.create(Zpt.prototype)).constructor=Ikt;var $kt=function(t,e){Ikt.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Ypt.PAN,this.mouseButtons.RIGHT=Ypt.ROTATE,this.touches.ONE=Kpt.PAN,this.touches.TWO=Kpt.DOLLY_ROTATE};($kt.prototype=Object.create(Zpt.prototype)).constructor=$kt;var Rkt=vt(Object.freeze({__proto__:null,OrbitControls:Ikt,MapControls:$kt})),Okt={};!function(t){Object.defineProperty(t,"__esModule",{value:!0});var e,n=function(t,e,n,r,i,s,o){this.pointIndices=t,this.labelStrings=e,this.scaleFactors=n,this.useSceneOpacityFlags=r,this.defaultFontSize=i,this.fillColors=s,this.strokeColors=o};t.LabelRenderParams=n,(e=t.CameraType||(t.CameraType={}))[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic";var r=function(t,e,n,r,i,s,o,a,l,c,u,h,d,p){this.camera=t,this.cameraType=e,this.cameraTarget=n,this.screenWidth=r,this.screenHeight=i,this.nearestCameraSpacePointZ=s,this.farthestCameraSpacePointZ=o,this.backgroundColor=a,this.pointColors=l,this.pointScaleFactors=c,this.labels=u,this.polylineColors=h,this.polylineOpacities=d,this.polylineWidths=p};t.RenderContext=r}(Okt);var Pkt={};Object.defineProperty(Pkt,"__esModule",{value:!0});var Lkt=Nkt;function Dkt(t,e){return void 0===e&&(e=!0),t.needsUpdate=e,t.minFilter=Lkt.LinearFilter,t.generateMipmaps=!1,t.flipY=!1,t}Pkt.vector3DToScreenCoords=function(t,e,n,r){var i=window.devicePixelRatio,s=(new Lkt.Vector3).copy(r).project(t);return[(s.x+1)/2*e*i,-(s.y-1)/2*n*i]},Pkt.vector3FromPackedArray=function(t,e){var n=3*e;return new Lkt.Vector3(t[n],t[n+1],t[n+2])},Pkt.getNearFarPoints=function(t,e,n){for(var r=1/0,i=0,s=(new Lkt.Vector3).copy(n).sub(e),o=(new Lkt.Vector3).copy(s).normalize(),a=t.length/3,l=0,c=new Lkt.Vector3,u=new Lkt.Vector3,h=0;h<a;h++){c.x=t[l],c.y=t[l+1],c.z=t[l+2],l+=3,u.copy(c).sub(e);var d=o.dot(u);d<0||(i=d>i?d:i,r=d<r?d:r)}return[r,i]},Pkt.createTextureFromCanvas=function(t){return Dkt(new Lkt.Texture(t))},Pkt.createTextureFromImage=function(t,e){var n=new Lkt.Texture(t);return t.complete?(n.needsUpdate=!0,e()):t.onload=function(){n.needsUpdate=!0,e()},Dkt(n,!1)},Pkt.hasWebGLSupport=function(){try{var t=document.createElement("canvas");return null!=(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}},Pkt.extent=function(t){for(var e=1/0,n=-1/0,r=0;r<t.length;r++){var i=t[r];i<e&&(e=i),i>n&&(n=i)}return[e,n]},Pkt.scaleLinear=function(t,e,n){var r=e[1]-e[0],i=n[1]-n[0];return(t-e[0])/r*i+n[0]},Pkt.scaleExponential=function(t,e,n){var r=Math.pow(e[1],Math.E)-Math.pow(e[0],Math.E),i=n[1]-n[0];return(Math.pow(t,Math.E)-e[0])/r*i+n[0]},Pkt.packRgbIntoUint8Array=function(t,e,n,r,i){t[3*e]=n,t[3*e+1]=r,t[3*e+2]=i},Pkt.styleRgbFromHexColor=function(t){var e=new Lkt.Color(t);return[255*e.r|0,255*e.g|0,255*e.b|0]};var Fkt=function(t){return 100*t+"%"};Pkt.getDefaultPointInPolylineColor=function(t,e,n,r,i,s){var o="hsl("+(n+(r-n)*t/e)+", "+Fkt(i)+", "+Fkt(s)+")";return new Lkt.Color(o)};var zkt={};Object.defineProperty(zkt,"__esModule",{value:!0});var Bkt=function(){function t(t,e,n){this.startCoordinates=[0,0],this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.display="none",this.svgElement.style.height="100%",this.svgElement.style.width="100%",this.svgElement.style.position="absolute",t.insertAdjacentElement("afterbegin",this.svgElement),this.rectElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rectElement.style.stroke=n.select.stroke,this.rectElement.style.strokeDasharray=n.select.strokeDashArray,this.rectElement.style.strokeWidth=""+n.select.strokeWidth,this.rectElement.style.fill=n.select.fill,this.rectElement.style.fillOpacity=""+n.select.fillOpacity,this.svgElement.appendChild(this.rectElement),this.selectionCallback=e,this.isMouseDown=!1}return t.prototype.onMouseDown=function(t,e){this.isMouseDown=!0,this.rectElement.style.display="block",this.svgElement.style.display="block",this.startCoordinates=[t,e],this.lastBoundingBox={x:this.startCoordinates[0],y:this.startCoordinates[1],width:1,height:1}},t.prototype.onMouseMove=function(t,e){this.isMouseDown&&(this.lastBoundingBox.x=Math.min(t,this.startCoordinates[0]),this.lastBoundingBox.y=Math.max(e,this.startCoordinates[1]),this.lastBoundingBox.width=Math.max(t,this.startCoordinates[0])-this.lastBoundingBox.x,this.lastBoundingBox.height=this.lastBoundingBox.y-Math.min(e,this.startCoordinates[1]),this.rectElement.setAttribute("x",""+this.lastBoundingBox.x),this.rectElement.setAttribute("y",""+(this.lastBoundingBox.y-this.lastBoundingBox.height)),this.rectElement.setAttribute("width",""+this.lastBoundingBox.width),this.rectElement.setAttribute("height",""+this.lastBoundingBox.height))},t.prototype.onMouseUp=function(){this.isMouseDown=!1,this.svgElement.style.display="none",this.rectElement.style.display="none",this.rectElement.setAttribute("width","0"),this.rectElement.setAttribute("height","0"),this.selectionCallback(this.lastBoundingBox)},t}();zkt.ScatterPlotRectangleSelector=Bkt;var Ukt=yt&&yt.__assign||function(){return Ukt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Ukt.apply(this,arguments)},Vkt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},jkt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Xpt,"__esModule",{value:!0});var Wkt=Nkt,Hkt=Rkt,Gkt=Okt,qkt=Pkt,Xkt=zkt,Ykt=new Wkt.Vector3(.45,.9,1.6),Kkt=new Wkt.Vector3(0,0,0),Zkt=new Wkt.Vector3(0,0,4),Jkt=new Wkt.Vector3(0,0,0),Qkt={mouseRotateSpeed:1,autoRotateSpeed:2,zoomSpeed:.125},tTt=function(){function t(t,e){var n=this;this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.selectEnabled=!0,this.visualizers=new Map,this.onCameraMoveListeners=[],this.height=0,this.width=0,this.dimensions=3,this.interactionMode="PAN",this.pickingTexture=new Wkt.WebGLRenderTarget(0,0),this.orbitAnimationOnNextCameraCreation=!1,this.orbitAnimationId=null,this.worldSpacePointPositions=new Float32Array(0),this.pointColors=new Float32Array(0),this.pointScaleFactors=new Float32Array(0),this.polylineColors={},this.polylineOpacities=new Float32Array(0),this.polylineWidths=new Float32Array(0),this.selecting=!1,this.nearestPoint=null,this.mouseIsDown=!1,this.isDragSequence=!1,this.lastHovered=null,this.container=t,this.styles=e.styles,this.setParameters(e),this.computeLayoutValues(),this.scene=new Wkt.Scene,this.renderer=new Wkt.WebGLRenderer({alpha:!0,premultipliedAlpha:!1,antialias:!1}),this.renderer.setClearColor(this.styles.backgroundColor,1),this.container.appendChild(this.renderer.domElement),this.light=new Wkt.PointLight(16772287,1,0),this.scene.add(this.light),this.orbitControlParams=Ukt(Ukt({},Qkt),e.orbitControlParams),this.rectangleSelector=new Xkt.ScatterPlotRectangleSelector(this.container,(function(t){n.selectBoundingBox(t)}),this.styles),this.addInteractionListeners(),this.setDimensions(3),this.makeCamera(e.camera),this.resize()}return t.prototype.setParameters=function(t){void 0!==t.onClick&&(this.clickCallback=t.onClick),void 0!==t.onHover&&(this.hoverCallback=t.onHover),void 0!==t.onSelect&&(this.selectCallback=t.onSelect),void 0!==t.selectEnabled&&(this.selectEnabled=t.selectEnabled)},t.prototype.addInteractionListeners=function(){this.container.addEventListener("pointermove",this.onMouseMove.bind(this)),this.container.addEventListener("pointerdown",this.onMouseDown.bind(this)),this.container.addEventListener("pointerup",this.onMouseUp.bind(this)),this.container.addEventListener("click",this.onClick.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1)},t.prototype.addCameraControlsEventListeners=function(t){var e=this;t.addEventListener("start",(function(){e.stopOrbitAnimation(),e.onCameraMoveListeners.forEach((function(n){return n(e.camera.position,t.target)}))})),t.addEventListener("change",(function(){e.render()})),t.addEventListener("end",(function(){}))},t.prototype.makeOrbitControls=function(t,e){null!=this.orbitCameraControls&&this.orbitCameraControls.dispose();var n=new Hkt.OrbitControls(t,this.renderer.domElement);n.zoomSpeed=this.orbitControlParams.zoomSpeed,n.enableRotate=e,n.autoRotate=!1,n.enableKeys=!1,n.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,e?(n.mouseButtons.LEFT=Wkt.MOUSE.LEFT,n.mouseButtons.RIGHT=Wkt.MOUSE.RIGHT):(n.mouseButtons.LEFT=Wkt.MOUSE.RIGHT,n.mouseButtons.RIGHT=Wkt.MOUSE.LEFT),n.reset(),this.camera=t,this.orbitCameraControls=n,this.addCameraControlsEventListeners(this.orbitCameraControls)},t.prototype.makeCamera=function(t){void 0===t&&(t={});var e=this.makeDefaultCameraDef(this.dimensions,t);this.recreateCamera(e),3===this.dimensions&&this.styles.axesVisible?this.add3dAxes():this.remove3dAxesFromScene()},t.prototype.makeCamera3D=function(t,e,n){var r,i=e/n;(r=new Wkt.PerspectiveCamera(70,i,.01,100)).position.set(t.position[0],t.position[1],t.position[2]);var s=new Wkt.Vector3(t.target[0],t.target[1],t.target[2]);r.lookAt(s),r.zoom=t.zoom,r.updateProjectionMatrix(),this.camera=r,this.makeOrbitControls(r,!0)},t.prototype.makeCamera2D=function(t,e,n){var r,i=new Wkt.Vector3(t.target[0],t.target[1],t.target[2]),s=e/n,o=-1.2,a=1.2,l=-1.2,c=1.2;s>1?(o*=s,a*=s):(c/=s,l/=s),(r=new Wkt.OrthographicCamera(o,a,c,l,-1e3,1e3)).position.set(t.position[0],t.position[1],t.position[2]),r.up=new Wkt.Vector3(0,0,1),r.lookAt(i),r.zoom=t.zoom,r.updateProjectionMatrix(),this.camera=r,this.makeOrbitControls(r,!1)},t.prototype.makeDefaultCameraDef=function(t,e){void 0===e&&(e={});var n=2===t,r=n?Zkt:Ykt,i=n?Jkt:Kkt,s={orthographic:n,zoom:1,position:[r.x,r.y,r.z],target:[i.x,i.y,i.z]};return e.zoom&&(s.zoom=e.zoom),e.position&&(s.position=e.position),e.target&&(s.target=e.target),s},t.prototype.recreateCamera=function(t){t.orthographic?this.makeCamera2D(t,this.width,this.height):this.makeCamera3D(t,this.width,this.height),this.orbitCameraControls.minDistance=.05,this.orbitCameraControls.maxDistance=10,this.orbitCameraControls.update(),this.orbitAnimationOnNextCameraCreation&&this.startOrbitAnimation()},t.prototype.setInteractionMode=function(t){this.interactionMode=t,"SELECT"===t?(this.selecting=!0,this.container.style.cursor="crosshair",this.orbitCameraControls.enabled=!1):(this.selecting=!1,this.container.style.cursor="default",this.orbitCameraControls.enabled=!0)},t.prototype.onClick=function(t,e){if(void 0===e&&(e=!0),!t||!this.selecting){if(!this.isDragSequence&&e){if(this.selectEnabled){var n=null!=this.nearestPoint?[this.nearestPoint]:[];this.selectCallback(n)}this.clickCallback(this.nearestPoint)}this.isDragSequence=!1,this.render()}},t.prototype.onMouseDown=function(t){this.isDragSequence=!1,this.mouseIsDown=!0,this.selecting?(this.rectangleSelector.onMouseDown(t.offsetX,t.offsetY),this.setNearestPointToMouse(t)):!t.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Wkt.MOUSE.RIGHT?(this.orbitCameraControls.mouseButtons.ORBIT=Wkt.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=Wkt.MOUSE.RIGHT):t.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Wkt.MOUSE.LEFT&&(this.orbitCameraControls.mouseButtons.ORBIT=Wkt.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Wkt.MOUSE.LEFT)},t.prototype.onMouseUp=function(t){this.selecting&&(this.rectangleSelector.onMouseUp(),this.render()),this.mouseIsDown=!1},t.prototype.onMouseMove=function(t){this.isDragSequence=this.mouseIsDown,this.selecting&&this.mouseIsDown?(this.rectangleSelector.onMouseMove(t.offsetX,t.offsetY),this.render()):this.mouseIsDown||(this.setNearestPointToMouse(t),this.nearestPoint!=this.lastHovered&&(this.lastHovered=this.nearestPoint,this.hoverCallback(this.nearestPoint)))},t.prototype.onKeyDown=function(t){"Control"===t.key&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=Wkt.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Wkt.MOUSE.LEFT),"Shift"===t.key&&this.selectEnabled&&(this.selecting=!0,this.orbitCameraControls.enabled=!1,this.container.style.cursor="crosshair")},t.prototype.onKeyUp=function(t){"Control"===t.key&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=Wkt.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=Wkt.MOUSE.RIGHT),"Shift"===t.key&&this.selectEnabled&&(this.selecting=!1,this.orbitCameraControls.enabled=!0,this.container.style.cursor="default",this.render())},t.prototype.getPointIndicesFromBoundingBox=function(t){if(null==this.worldSpacePointPositions)return[];this.camera.updateMatrixWorld();var e=window.devicePixelRatio||1,n=Math.floor(t.x*e),r=Math.floor(t.y*e),i=Math.max(Math.floor(t.width*e),1),s=Math.max(Math.floor(t.height*e),1);if(i<=2&&s<=2)return this.getPointIndicesFromBoundingBoxPickingTexture(t);for(var o=this.renderer.domElement,a=o.width,l=o.height,c=[],u=new Wkt.Vector3,h=0;h<this.worldSpacePointPositions.length;h++){var d=3*h,p=Vkt(this.worldSpacePointPositions.slice(d,d+3),3),f=p[0],m=p[1],g=p[2];u.x=f,u.y=m,u.z=g;var y=u.project(this.camera),b=(y.x+1)*a/2,v=-(y.y-1)*l/2;b>=n&&b<=n+i&&v<=r&&v>=r-s&&c.push(h)}return c},t.prototype.getPointIndicesFromBoundingBoxPickingTexture=function(t){if(null==this.worldSpacePointPositions)return[];var e=this.worldSpacePointPositions.length/3,n=window.devicePixelRatio||1,r=Math.floor(t.x*n),i=Math.floor(t.y*n),s=Math.max(Math.floor(t.width*n),1),o=Math.max(Math.floor(t.height*n),1),a=new Uint8Array(s*o*4);this.renderer.readRenderTargetPixels(this.pickingTexture,r,this.pickingTexture.height-i,s,o,a);for(var l=new Uint8Array(this.worldSpacePointPositions.length),c=0;c<s*o;c++){var u=a[4*c]<<16|a[4*c+1]<<8|a[4*c+2];16777215!==u&&u<e&&(l[u]=1)}var h=[];for(c=0;c<l.length;c++)1===l[c]&&h.push(c);return h},t.prototype.selectBoundingBox=function(t){var e=this.getPointIndicesFromBoundingBox(t);this.selectCallback(e)},t.prototype.setNearestPointToMouse=function(t){if(null!=this.pickingTexture){var e={x:t.offsetX,y:t.offsetY,width:1,height:1},n=this.getPointIndicesFromBoundingBoxPickingTexture(e);this.nearestPoint=n.length?n[0]:null}else this.nearestPoint=null},t.prototype.computeLayoutValues=function(){return this.width=this.container.offsetWidth,this.height=Math.max(1,this.container.offsetHeight),[this.width,this.height]},t.prototype.sceneIs3D=function(){return 3===this.dimensions},t.prototype.remove3dAxesFromScene=function(){var t=this.scene.getObjectByName("axes");return null!=t&&this.scene.remove(t),t},t.prototype.add3dAxes=function(){var t=new Wkt.AxesHelper;t.name="axes",this.scene.add(t)},t.prototype.setDimensions=function(t){if(2!==t&&3!==t)throw new RangeError("dimensions must be 2 or 3");this.dimensions!==t&&(this.dimensions=t,this.makeCamera())},t.prototype.getCameraPosition=function(){var t=this.camera.position;return[t.x,t.y,t.z]},t.prototype.getCameraTarget=function(){var t=this.orbitCameraControls.target;return[t.x,t.y,t.z]},t.prototype.setCameraPositionAndTarget=function(t,e){this.stopOrbitAnimation(),this.camera.position.set(t[0],t[1],t[2]),this.orbitCameraControls.target.set(e[0],e[1],e[2]),this.orbitCameraControls.update(),this.render()},t.prototype.startOrbitAnimation=function(){this.sceneIs3D()&&(null!=this.orbitAnimationId&&this.stopOrbitAnimation(),this.orbitCameraControls.autoRotate=!0,this.orbitCameraControls.autoRotateSpeed=this.orbitControlParams.autoRotateSpeed,this.updateOrbitAnimation())},t.prototype.orbitIsAnimating=function(){return null!=this.orbitAnimationId},t.prototype.updateOrbitAnimation=function(){var t=this;this.orbitCameraControls.update(),this.orbitAnimationId=requestAnimationFrame((function(){return t.updateOrbitAnimation()}))},t.prototype.stopOrbitAnimation=function(){this.orbitCameraControls.autoRotate=!1,this.orbitCameraControls.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,null!=this.orbitAnimationId&&(cancelAnimationFrame(this.orbitAnimationId),this.orbitAnimationId=null)},t.prototype.setActiveVisualizers=function(t){var e,n,r,i,s=new Set(t.map((function(t){return t.id})));try{for(var o=jkt(this.visualizers.values()),a=o.next();!a.done;a=o.next()){var l=a.value;s.has(l.id)||(l.dispose(),this.visualizers.delete(l.id))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}try{for(var c=jkt(t),u=c.next();!u.done;u=c.next()){l=u.value;this.visualizers.set(l.id,l),l.setScene(this.scene),l.onResize(this.width,this.height),this.worldSpacePointPositions&&l.onPointPositionsChanged(this.worldSpacePointPositions)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}},t.prototype.disposeAllVisualizers=function(){this.visualizers.forEach((function(t){return t.dispose()})),this.visualizers.clear()},t.prototype.setPointPositions=function(t){this.worldSpacePointPositions=t,this.visualizers.forEach((function(e){return e.onPointPositionsChanged(t)}))},t.prototype.render=function(){var t=this.camera.position.clone();t.x+=1,t.y+=1,this.light.position.set(t.x,t.y,t.z);var e=this.camera instanceof Wkt.PerspectiveCamera?Gkt.CameraType.Perspective:Gkt.CameraType.Orthographic,n=[0,0];null!=this.worldSpacePointPositions&&(n=qkt.getNearFarPoints(this.worldSpacePointPositions,this.camera.position,this.orbitCameraControls.target));var r=new Gkt.RenderContext(this.camera,e,this.orbitCameraControls.target,this.width,this.height,n[0],n[1],this.styles.backgroundColor,this.pointColors,this.pointScaleFactors,this.labels,this.polylineColors,this.polylineOpacities,this.polylineWidths);this.visualizers.forEach((function(t){return t.onPickingRender(r)}));var i=this.remove3dAxesFromScene();this.renderer.setRenderTarget(this.pickingTexture),this.renderer.render(this.scene,this.camera),null!=i&&this.scene.add(i),this.visualizers.forEach((function(t){return t.onRender(r)})),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},t.prototype.setPointColors=function(t){this.pointColors=t},t.prototype.setPointScaleFactors=function(t){this.pointScaleFactors=t},t.prototype.setLabels=function(t){this.labels=t},t.prototype.setPolylineColors=function(t){this.polylineColors=t},t.prototype.setPolylineOpacities=function(t){this.polylineOpacities=t},t.prototype.setPolylineWidths=function(t){this.polylineWidths=t},t.prototype.resetZoom=function(){this.recreateCamera(this.makeDefaultCameraDef(this.dimensions)),this.render()},t.prototype.setDayNightMode=function(t){for(var e=this.container.querySelectorAll("canvas"),n=t?"invert(100%)":"",r=0;r<e.length;r++)e[r].style.filter=n},t.prototype.resize=function(t){void 0===t&&(t=!0);var e=Vkt([this.width,this.height],2),n=e[0],r=e[1],i=Vkt(this.computeLayoutValues(),2),s=i[0],o=i[1];if(3===this.dimensions){(a=this.camera).aspect=s/o,a.updateProjectionMatrix()}else{var a=this.camera,l=s/n,c=o/r,u=(a.right-a.left)*l/2,h=(a.top-a.bottom)*c/2;a.top=h,a.bottom=-h,a.left=-u,a.right=u,a.updateProjectionMatrix()}var d=window.devicePixelRatio||1;this.renderer.setPixelRatio(d),this.renderer.setSize(s,o);var p=new Wkt.Vector2;this.renderer.getSize(p);var f=this.renderer.getPixelRatio();this.pickingTexture=new Wkt.WebGLRenderTarget(p.width*f,p.height*f),this.pickingTexture.texture.minFilter=Wkt.LinearFilter,this.visualizers.forEach((function(t){return t.onResize(s,o)})),t&&this.render()},t.prototype.onCameraMove=function(t){this.onCameraMoveListeners.push(t)},t.prototype.clickOnPoint=function(t){this.nearestPoint=t,this.onClick(null,!1)},t}();Xpt.ScatterPlot=tTt;var eTt={},nTt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(eTt,"__esModule",{value:!0});var rTt=Nkt,iTt=new Map,sTt=/^(rgba|hsla)\((\d+),\s*(\d+%?),\s*(\d+%?)(?:,\s*(\d+(?:\.\d+)?))?\)$/;eTt.parseColor=function(t){if(iTt.has(t))return iTt.get(t);var e=function(t){var e=sTt.exec(t);if(e){var n=nTt(e,6);n[0];var r=n[1],i=n[2],s=n[3],o=n[4],a=n[5];return{colorString:r.replace("a","")+"("+i+","+s+","+o+")",opacity:parseFloat(a)}}return{colorString:t,opacity:1}}(t),n=e.colorString,r=e.opacity,i=new rTt.Color(n),s={r:i.r,g:i.g,b:i.b,opacity:r};return iTt.set(t,s),s};var oTt={},aTt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(oTt,"__esModule",{value:!0});var lTt=function(){function t(t,e){var n,r;void 0===e&&(e=[]),this.points=t,this.metadata=e;var i=t[0].length;if(2!==i&&3!==i)throw new Error("Points must be an array of either 2 or 3 dimensional number arrays");try{for(var s=aTt(t),o=s.next();!o.done;o=s.next()){if(i!==o.value.length)throw new Error("Points must be an array of either 2 or 3 dimensional number arrays")}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this.dimensions=i}return t.prototype.setSpriteMetadata=function(t){this.spriteMetadata=t},t}();oTt.Dataset=lTt;var cTt={};Object.defineProperty(cTt,"__esModule",{value:!0});cTt.makeStyles=function(t){var e={backgroundColor:"#ffffff",axesVisible:!0,fog:{color:"#ffffff",enabled:!0,threshold:5e3},label:{fontSize:10,scaleDefault:1,scaleLarge:2,fillColorSelected:"#000000",fillColorHover:"#000000",strokeColorSelected:"#ffffff",strokeColorHover:"#ffffff",strokeWidth:3,fillWidth:6},label3D:{fontSize:80,scale:2.2,color:"black",backgroundColor:"#ffffff",colorUnselected:"#ffffff",colorNoSelection:"#ffffff"},point:{colorUnselected:"rgba(227, 227, 227, 0.7)",colorNoSelection:"rgba(117, 117, 217, 0.7)",colorSelected:"rgba(250, 102, 102, 0.7)",colorHover:"rgba(118, 11, 79, 0.7)",scaleDefault:1,scaleSelected:1.2,scaleHover:1.2},polyline:{startHue:60,endHue:360,saturation:1,lightness:.3,defaultOpacity:.2,defaultLineWidth:2,selectedOpacity:.9,selectedLineWidth:3,deselectedOpacity:.05},select:{fill:"#dddddd",fillOpacity:.2,stroke:"#aaaaaa",strokeWidth:2,strokeDashArray:"10 5"},sprites:{minPointSize:5,imageSize:30,colorUnselected:"#ffffff",colorNoSelection:"#ffffff"}};if(void 0===t)return e;for(var n in e){var r=n;"object"==typeof e[r]&&"object"==typeof t[r]?e[r]=Object.assign(e[r],t[r]):void 0!==t[r]&&(e[r]=t[r])}return e};var uTt={};Object.defineProperty(uTt,"__esModule",{value:!0}),uTt.RGB_NUM_ELEMENTS=3,uTt.RGBA_NUM_ELEMENTS=4,uTt.XYZ_NUM_ELEMENTS=3,uTt.UV_NUM_ELEMENTS=2,uTt.INDEX_NUM_ELEMENTS=1,uTt.SCATTER_PLOT_CUBE_LENGTH=2;var hTt={};Object.defineProperty(hTt,"__esModule",{value:!0});var dTt=Nkt,pTt=Pkt,fTt=uTt,mTt=function(t,e){return"\n      attribute vec2 posObj;\n      attribute vec4 color;\n      varying vec2 vUv;\n      varying vec4 vColor;\n\n      void main() {\n        vUv = uv;\n        vColor = color;\n\n        // Rotate label to face camera.\n\n        vec4 vRight = vec4(\n          modelViewMatrix[0][0], modelViewMatrix[1][0], modelViewMatrix[2][0], 0);\n\n        vec4 vUp = vec4(\n          modelViewMatrix[0][1], modelViewMatrix[1][1], modelViewMatrix[2][1], 0);\n\n        vec4 vAt = -vec4(\n          modelViewMatrix[0][2], modelViewMatrix[1][2], modelViewMatrix[2][2], 0);\n\n        mat4 pointToCamera = mat4(vRight, vUp, vAt, vec4(0, 0, 0, 1));\n\n        vec2 scaledPos = posObj * "+1/t+" * "+e+";\n\n        vec4 posRotated = pointToCamera * vec4(scaledPos, 0, 1);\n        vec4 mvPosition = modelViewMatrix * (vec4(position, 0) + posRotated);\n        gl_Position = projectionMatrix * mvPosition;\n      }"},gTt=function(){function t(t){this.styles=t,this.id="3D_LABELS",this.labelStrings=[],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.uniforms={},this.totalVertexCount=0,this.labelVertexMap=[]}return t.prototype.createGlyphTexture=function(){var t=this.styles.label3D,e=t.fontSize,n=t.backgroundColor,r=t.color,i=document.createElement("canvas");i.width=8192,i.height=e;var s=i.getContext("2d");s.font="bold "+e+"px roboto",s.textBaseline="top",s.fillStyle=n,s.rect(0,0,i.width,i.height),s.fill(),s.fillStyle=r;for(var o=s.measureText(" ").width,a=new Float32Array(256),l=new Float32Array(256),c=0,u=0;u<256;u++){var h=" "+String.fromCharCode(u),d=s.measureText(h).width;a[u]=d-o,l[u]=c,s.fillText(h,c-o,0),c+=d}return{texture:pTt.createTextureFromCanvas(i),lengths:a,offsets:l}},t.prototype.processLabelVerts=function(t){var e=0;this.labelVertexMap=[];for(var n=0;n<t;n++){for(var r=this.labelStrings[n],i=[],s=0;s<r.length;s++){for(var o=0;o<6;o++)i.push(6*e+o);e++}this.labelVertexMap.push(i)}this.totalVertexCount=6*e},t.prototype.createColorBuffers=function(t){var e=this;this.pickingColors=new Float32Array(this.totalVertexCount*fTt.RGB_NUM_ELEMENTS),this.renderColors=new Float32Array(this.totalVertexCount*fTt.RGB_NUM_ELEMENTS);for(var n=function(t){var n=new dTt.Color(t);r.labelVertexMap[t].forEach((function(t){e.pickingColors[fTt.RGB_NUM_ELEMENTS*t]=n.r,e.pickingColors[fTt.RGB_NUM_ELEMENTS*t+1]=n.g,e.pickingColors[fTt.RGB_NUM_ELEMENTS*t+2]=n.b,e.renderColors[fTt.RGB_NUM_ELEMENTS*t]=1,e.renderColors[fTt.RGB_NUM_ELEMENTS*t+1]=1,e.renderColors[fTt.RGB_NUM_ELEMENTS*t+2]=1}))},r=this,i=0;i<t;i++)n(i)},t.prototype.createLabels=function(){var t=this,e=this.styles.label3D,n=e.fontSize,r=e.scale;if(null!=this.labelStrings&&null!=this.worldSpacePointPositions){var i=this.worldSpacePointPositions.length/fTt.XYZ_NUM_ELEMENTS;if(i===this.labelStrings.length){this.glyphTexture=this.createGlyphTexture(),this.uniforms={glyphTexture:{value:null},picking:{value:!1}},this.material=new dTt.ShaderMaterial({uniforms:this.uniforms,transparent:!0,vertexShader:mTt(n,r),fragmentShader:"\n      uniform sampler2D glyphTexture;\n      uniform bool picking;\n      varying vec2 vUv;\n      varying vec4 vColor;\n\n      void main() {\n        if (picking) {\n          gl_FragColor = vColor;\n        } else {\n          vec4 fromTexture = texture(glyphTexture, vUv);\n          gl_FragColor = vColor * fromTexture;\n        }\n      }"}),this.processLabelVerts(i),this.createColorBuffers(i);var s=new Float32Array(this.totalVertexCount*fTt.XYZ_NUM_ELEMENTS);this.positions=new dTt.BufferAttribute(s,fTt.XYZ_NUM_ELEMENTS);var o=new Float32Array(this.totalVertexCount*fTt.XYZ_NUM_ELEMENTS),a=new Float32Array(this.totalVertexCount*fTt.UV_NUM_ELEMENTS),l=new Float32Array(this.totalVertexCount*fTt.RGB_NUM_ELEMENTS),c=new dTt.BufferAttribute(o,2),u=new dTt.BufferAttribute(a,fTt.UV_NUM_ELEMENTS),h=new dTt.BufferAttribute(l,fTt.RGB_NUM_ELEMENTS);this.geometry=new dTt.BufferGeometry,this.geometry.setAttribute("posObj",c),this.geometry.setAttribute("position",this.positions),this.geometry.setAttribute("uv",u),this.geometry.setAttribute("color",h);for(var d=0,p=0;p<i;p++){for(var f=this.labelStrings[p],m=0,g=0;g<f.length;g++){var y=f.charCodeAt(g);m+=this.glyphTexture.lengths[y]}m/=-2;for(g=0;g<f.length;g++){y=f.charCodeAt(g);var b=this.glyphTexture.lengths[y],v=(m+b)/n,x=m/n,w=n/n;c.setXY(6*d+0,x,0),c.setXY(6*d+1,v,0),c.setXY(6*d+2,x,w),c.setXY(6*d+3,x,w),c.setXY(6*d+4,v,0),c.setXY(6*d+5,v,w);var S=this.glyphTexture.offsets[y],_=this.glyphTexture.offsets[y]+b;S/=8192,_/=8192;u.setXY(6*d+0,S,1),u.setXY(6*d+1,_,1),u.setXY(6*d+2,S,0),u.setXY(6*d+3,S,0),u.setXY(6*d+4,_,1),u.setXY(6*d+5,_,0),d++,m+=b}}var k=function(e){var n=pTt.vector3FromPackedArray(T.worldSpacePointPositions,e);T.labelVertexMap[e].forEach((function(e){t.positions.setXYZ(e,n.x,n.y,n.z)}))},T=this;for(p=0;p<i;p++)k(p);this.labelsMesh=new dTt.Mesh(this.geometry,this.material),this.labelsMesh.frustumCulled=!1,this.scene.add(this.labelsMesh)}}},t.prototype.colorLabels=function(t){if(null!=this.labelStrings&&null!=this.geometry&&null!=t){var e=this.geometry.getAttribute("color");e.array=this.renderColors;for(var n=t.length/fTt.RGBA_NUM_ELEMENTS,r=0,i=0;i<n;++i){for(var s=new dTt.Color(t[r],t[r+1],t[r+2]),o=this.labelVertexMap[i].length,a=0;a<o;++a)e.setXYZ(this.labelVertexMap[i][a],s.r,s.g,s.b);r+=fTt.RGBA_NUM_ELEMENTS}e.needsUpdate=!0}},t.prototype.setScene=function(t){this.scene=t},t.prototype.dispose=function(){this.labelsMesh&&(this.scene&&this.scene.remove(this.labelsMesh),this.labelsMesh=null),this.geometry&&(this.geometry.dispose(),this.geometry=null),null!=this.glyphTexture&&null!=this.glyphTexture.texture&&(this.glyphTexture.texture.dispose(),this.glyphTexture.texture=null)},t.prototype.onPickingRender=function(t){if(null!=this.geometry){this.material.uniforms.glyphTexture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!0;var e=this.geometry.getAttribute("color");e.array=this.pickingColors,e.needsUpdate=!0}else this.createLabels()},t.prototype.onRender=function(t){if(null!=this.geometry){this.colorLabels(t.pointColors),this.material.uniforms.glyphTexture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!1;var e=this.geometry.getAttribute("color");e.array=this.renderColors,e.needsUpdate=!0}else this.createLabels()},t.prototype.onPointPositionsChanged=function(t){this.worldSpacePointPositions=t,this.dispose()},t.prototype.setLabelStrings=function(t){this.labelStrings=t,this.dispose()},t.prototype.onResize=function(t,e){},t}();hTt.ScatterPlotVisualizer3DLabels=gTt;var yTt={};Object.defineProperty(yTt,"__esModule",{value:!0});var bTt=Nkt,vTt=Okt,xTt=Pkt,wTt=uTt,STt=function(t){return"\n    // Index of the specific vertex (passed in as bufferAttribute), and the\n    // variable that will be used to pass it to the fragment shader.\n    attribute float spriteIndex;\n    attribute vec4 color;\n    attribute float scaleFactor;\n\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n\n    uniform bool sizeAttenuation;\n    uniform float pointSize;\n    uniform float spritesPerRow;\n    uniform float spritesPerColumn;\n\n    varying float fogDepth;\n\n    void main() {\n      // Pass index and color values to fragment shader.\n      vColor = color;\n      xyIndex = vec2(mod(spriteIndex, spritesPerRow),\n                floor(spriteIndex / spritesPerColumn));\n\n      // Transform current vertex by modelViewMatrix (model world position and\n      // camera world position matrix).\n      vec4 cameraSpacePos = modelViewMatrix * vec4(position, 1.0);\n\n      // Project vertex in camera-space to screen coordinates using the camera's\n      // projection matrix.\n      gl_Position = projectionMatrix * cameraSpacePos;\n\n      // Create size attenuation (if we're in 3D mode) by making the size of\n      // each point inversly proportional to its distance to the camera.\n      float outputPointSize = pointSize;\n      if (sizeAttenuation) {\n        outputPointSize = -pointSize / cameraSpacePos.z;\n        fogDepth = pointSize / outputPointSize * 1.2;\n      } else {  // Create size attenuation (if we're in 2D mode)\n        const float PI = 3.1415926535897932384626433832795;\n        const float minScale = 0.1;  // minimum scaling factor\n        const float outSpeed = 2.0;  // shrink speed when zooming out\n        const float outNorm = (1. - minScale) / atan(outSpeed);\n        const float maxScale = 15.0;  // maximum scaling factor\n        const float inSpeed = 0.02;  // enlarge speed when zooming in\n        const float zoomOffset = 0.3;  // offset zoom pivot\n        float zoom = projectionMatrix[0][0] + zoomOffset;  // zoom pivot\n        float scale = zoom < 1. ? 1. + outNorm * atan(outSpeed * (zoom - 1.)) :\n                      1. + 2. / PI * (maxScale - 1.) * atan(inSpeed * (zoom - 1.));\n        outputPointSize = pointSize * scale;\n      }\n\n      gl_PointSize =\n        max(outputPointSize * scaleFactor, "+t.toFixed(1)+");\n    }"},_Tt="\n    bool point_in_unit_circle(vec2 spriteCoord) {\n      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);\n      return dot(centerToP, centerToP) < (0.5 * 0.5);\n    }\n\n    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {\n      vec3 v0 = vec3(0, 1, 0);\n      vec3 v1 = vec3(0.5, 0, 0);\n      vec3 v2 = vec3(1, 1, 0);\n      vec3 p = vec3(spriteCoord, 0);\n      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;\n      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;\n      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);\n    }\n\n    bool point_in_unit_square(vec2 spriteCoord) {\n      return true;\n    }\n  ",kTt="\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n\n    uniform sampler2D spriteTexture;\n    uniform float spritesPerRow;\n    uniform float spritesPerColumn;\n    uniform bool isImage;\n\n    "+bTt.ShaderChunk.common+"\n    "+_Tt+"\n    uniform vec3 fogColor;\n    varying float fogDepth;\n\t\tuniform float fogNear;\n    uniform float fogFar;\n\n    void main() {\n      if (isImage) {\n        // Coordinates of the vertex within the entire sprite image.\n        vec2 coords =\n          (gl_PointCoord + xyIndex) / vec2(spritesPerRow, spritesPerColumn);\n        gl_FragColor = vColor * texture(spriteTexture, coords);\n      } else {\n        bool inside = point_in_unit_circle(gl_PointCoord);\n        if (!inside) {\n          discard;\n        }\n        gl_FragColor = vColor;\n      }\n      float fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n      gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n    }",TTt=function(){function t(t,e){this.styles=t,this.id="SPRITES",this.isSpriteSheetMode=!1,this.spritesPerRow=0,this.spritesPerColumn=0,this.spriteDimensions=[0,0],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.standinTextureForPoints=xTt.createTextureFromCanvas(document.createElement("canvas")),e&&(this.spriteSheetParams=e,this.setSpriteSheet(e),this.isSpriteSheetMode=!0),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial()}return t.prototype.createUniforms=function(){return{spriteTexture:{type:"t"},spritesPerRow:{type:"f"},spritesPerColumn:{type:"f"},fogColor:{type:"c"},fogNear:{type:"f"},fogFar:{type:"f"},isImage:{type:"bool"},sizeAttenuation:{type:"bool"},pointSize:{type:"f"}}},t.prototype.createRenderMaterial=function(){this.isSpriteSheetMode;var t=this.createUniforms();return new bTt.ShaderMaterial({uniforms:t,vertexShader:STt(this.styles.sprites.minPointSize),fragmentShader:kTt,transparent:!0,depthFunc:bTt.LessDepth,fog:this.styles.fog.enabled,blending:bTt.NormalBlending})},t.prototype.createPickingMaterial=function(){var t=this.createUniforms();return new bTt.ShaderMaterial({uniforms:t,vertexShader:STt(this.styles.sprites.minPointSize),fragmentShader:"\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n    uniform bool isImage;\n\n    \n    bool point_in_unit_circle(vec2 spriteCoord) {\n      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);\n      return dot(centerToP, centerToP) < (0.5 * 0.5);\n    }\n\n    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {\n      vec3 v0 = vec3(0, 1, 0);\n      vec3 v1 = vec3(0.5, 0, 0);\n      vec3 v2 = vec3(1, 1, 0);\n      vec3 p = vec3(spriteCoord, 0);\n      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;\n      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;\n      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);\n    }\n\n    bool point_in_unit_square(vec2 spriteCoord) {\n      return true;\n    }\n  \n\n    varying float fogDepth;\n\n    void main() {\n      xyIndex; // Silence 'unused variable' warning.\n      fogDepth; // Silence 'unused variable' warning.\n      if (isImage) {\n        gl_FragColor = vColor;\n      } else {\n        bool inside = point_in_unit_circle(gl_PointCoord);\n        if (!inside) {\n          discard;\n        }\n        gl_FragColor = vColor;\n      }\n    }",transparent:!0,depthTest:!0,depthWrite:!0,fog:!1,blending:bTt.NormalBlending})},t.prototype.createPointSprites=function(t,e){var n=null!=e?e.length/wTt.XYZ_NUM_ELEMENTS:0,r=this.createGeometry(n);this.fog=new bTt.Fog(16777215),this.points=new bTt.Points(r,this.renderMaterial),this.points.frustumCulled=!1,null!=this.spriteIndexBufferAttribute&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute),t.add(this.points)},t.prototype.calculatePointSize=function(t){var e=this.styles.sprites.imageSize;if(this.texture)return t?e:this.spriteDimensions[0];var n=null!=this.worldSpacePointPositions?this.worldSpacePointPositions.length/wTt.XYZ_NUM_ELEMENTS:1,r=200/Math.log(n)/Math.log(8);return t?r:r/1.5},t.prototype.createGeometry=function(t){var e=t;this.pickingColors=new Float32Array(e*wTt.RGBA_NUM_ELEMENTS);for(var n=0,r=0;r<e;r++){var i=new bTt.Color(r);this.pickingColors[n++]=i.r,this.pickingColors[n++]=i.g,this.pickingColors[n++]=i.b,this.pickingColors[n++]=1}var s=new bTt.BufferGeometry;return s.setAttribute("position",new bTt.BufferAttribute(new Float32Array([]),wTt.XYZ_NUM_ELEMENTS)),s.setAttribute("color",new bTt.BufferAttribute(new Float32Array([]),wTt.RGBA_NUM_ELEMENTS)),s.setAttribute("scaleFactor",new bTt.BufferAttribute(new Float32Array([]),wTt.INDEX_NUM_ELEMENTS)),s.computeVertexNormals(),s},t.prototype.setFogDistances=function(t,e,n){var r=this.styles.fog,i=r.threshold,s=r.enabled;if(t&&s){this.fog.near=e;var o=e-n;this.fog.far=e-i*o}else this.fog.near=1/0,this.fog.far=1/0},t.prototype.dispose=function(){this.disposeGeometry(),this.disposeSpriteSheet()},t.prototype.disposeGeometry=function(){null!=this.points&&(this.scene.remove(this.points),this.points.geometry.dispose(),this.points=null,this.worldSpacePointPositions=null)},t.prototype.disposeSpriteSheet=function(){this.texture&&this.texture.dispose(),this.texture=null,this.renderMaterial=null,this.pickingMaterial=null,this.spriteSheetImage=null},t.prototype.setScene=function(t){this.scene=t},t.prototype.setSpriteSheet=function(t){var e=this,n=t.spriteDimensions,r=t.onImageLoad,i=t.spritesheetImage;if("string"==typeof i){var s=i;(i=new Image).src=s}this.spriteSheetImage=i,this.texture=xTt.createTextureFromImage(this.spriteSheetImage,(function(){e.spritesPerRow=e.spriteSheetImage.width/n[0],e.spritesPerColumn=e.spriteSheetImage.height/n[1],r()})),this.spriteDimensions=n,this.setSpriteIndexBuffer()},t.prototype.setSpriteIndexBuffer=function(){var t=this.spriteSheetParams.spriteIndices;this.spriteIndexBufferAttribute=new bTt.BufferAttribute(t,wTt.INDEX_NUM_ELEMENTS),null!=this.points&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute)},t.prototype.onPointPositionsChanged=function(t){null!=this.points&&this.worldSpacePointPositions.length!==t.length&&this.disposeGeometry(),this.worldSpacePointPositions=t,null==this.points&&this.createPointSprites(this.scene,t),this.spriteSheetParams&&this.setSpriteIndexBuffer(),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial();var e=this.points.geometry.getAttribute("position");e.array=t,e.count=t.length/wTt.XYZ_NUM_ELEMENTS,e.needsUpdate=!0},t.prototype.onPickingRender=function(t){var e=t.cameraType===vTt.CameraType.Perspective;this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerColumn,this.pickingMaterial.uniforms.sizeAttenuation.value=e,this.pickingMaterial.uniforms.pointSize.value=this.calculatePointSize(e),this.points.material=this.pickingMaterial;var n=this.points.geometry.getAttribute("color");n.array=this.pickingColors,n.count=this.pickingColors.length/wTt.RGBA_NUM_ELEMENTS,n.needsUpdate=!0;var r=this.points.geometry.getAttribute("scaleFactor");r.array=t.pointScaleFactors,r.count=t.pointScaleFactors.length,r.count=t.pointScaleFactors.length/wTt.INDEX_NUM_ELEMENTS,r.needsUpdate=!0},t.prototype.onRender=function(t){var e=t.camera instanceof bTt.PerspectiveCamera;this.setFogDistances(e,t.nearestCameraSpacePointZ,t.farthestCameraSpacePointZ),this.scene.fog=this.fog,this.scene.fog.color=new bTt.Color(t.backgroundColor),this.renderMaterial.uniforms.fogColor.value=this.scene.fog.color,this.renderMaterial.uniforms.fogNear.value=this.fog.near,this.renderMaterial.uniforms.fogFar.value=this.fog.far,this.renderMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.renderMaterial.uniforms.spritesPerColumn.value=this.spritesPerColumn,this.renderMaterial.uniforms.isImage.value=null!=this.texture,this.renderMaterial.uniforms.spriteTexture.value=null!=this.texture?this.texture:this.standinTextureForPoints,this.renderMaterial.uniforms.sizeAttenuation.value=e,this.renderMaterial.uniforms.pointSize.value=this.calculatePointSize(e),this.points.material=this.renderMaterial;var n=this.points.geometry.getAttribute("color");this.renderColors=t.pointColors,n.array=this.renderColors,n.count=this.renderColors.length/wTt.RGBA_NUM_ELEMENTS,n.needsUpdate=!0;var r=this.points.geometry.getAttribute("scaleFactor");r.array=t.pointScaleFactors,r.count=t.pointScaleFactors.length/wTt.INDEX_NUM_ELEMENTS,r.needsUpdate=!0},t.prototype.onResize=function(t,e){},t}();yTt.ScatterPlotVisualizerSprites=TTt;var ETt={},MTt={};Object.defineProperty(MTt,"__esModule",{value:!0});var CTt=function(){function t(t,e,n){this.bound=t,this.cellWidth=e,this.cellHeight=n,this.numHorizCells=Math.ceil(this.boundWidth(t)/e),this.numVertCells=Math.ceil(this.boundHeight(t)/n),this.grid=new Array(this.numHorizCells*this.numVertCells)}return t.prototype.boundWidth=function(t){return t.hiX-t.loX},t.prototype.boundHeight=function(t){return t.hiY-t.loY},t.prototype.boundsIntersect=function(t,e){return!(t.loX>e.hiX||t.loY>e.hiY||t.hiX<e.loX||t.hiY<e.loY)},t.prototype.insert=function(t,e){if(void 0===e&&(e=!1),t.hiX<this.bound.loX||t.loX>this.bound.hiX||t.hiY<this.bound.loY||t.loY>this.bound.hiY)return!1;for(var n=this.getCellX(t.loX),r=this.getCellX(t.hiX),i=this.getCellY(t.loY),s=this.getCellY(t.hiY),o=i*this.numHorizCells+n,a=o,l=i;l<=s;l++){for(var c=n;c<=r;c++){var u=this.grid[a++];if(u)for(var h=0;h<u.length;h++)if(this.boundsIntersect(t,u[h]))return!1}a+=this.numHorizCells-(r-n+1)}if(e)return!0;a=o;for(l=i;l<=s;l++){for(c=n;c<=r;c++)this.grid[a]?this.grid[a].push(t):this.grid[a]=[t],a++;a+=this.numHorizCells-(r-n+1)}return!0},t.prototype.getCellX=function(t){return Math.floor((t-this.bound.loX)/this.cellWidth)},t.prototype.getCellY=function(t){return Math.floor((t-this.bound.loY)/this.cellHeight)},t}();MTt.CollisionGrid=CTt;var ATt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(ETt,"__esModule",{value:!0});var NTt=Nkt,ITt=Okt,$Tt=MTt,RTt=Pkt,OTt=function(){function t(t,e){this.styles=e,this.id="CANVAS_LABELS",this.worldSpacePointPositions=new Float32Array(0),this.labelsActive=!0,this.canvas=document.createElement("canvas"),t.appendChild(this.canvas),this.gc=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none"}return t.prototype.removeAllLabels=function(){var t=this.canvas.width*window.devicePixelRatio,e=this.canvas.height*window.devicePixelRatio;this.gc.clearRect(0,0,t,e)},t.prototype.makeLabels=function(t){if(null!=t.labels&&0!==t.labels.pointIndices.length&&null!=this.worldSpacePointPositions){var e,n=t.labels,r=t.cameraType===ITt.CameraType.Perspective,i=parseInt(this.gc.font,10),s=window.devicePixelRatio,o=this.canvas.width*s,a=this.canvas.height*s,l={loX:0,hiX:o,loY:0,hiY:a};e=new $Tt.CollisionGrid(l,o/25,a/50);var c=[t.farthestCameraSpacePointZ,t.nearestCameraSpacePointZ],u=function(t){return RTt.scaleExponential(t,c,[.1,1])},h=t.camera.position,d=h.clone().sub(t.cameraTarget),p=new NTt.Vector3;this.gc.textBaseline="middle",this.gc.miterLimit=2;for(var f=Math.min(1e4,n.pointIndices.length),m=0;m<f;++m){var g,y=n.pointIndices[m];if(g=RTt.vector3FromPackedArray(this.worldSpacePointPositions,y),p.copy(h).sub(g),!(d.dot(p)<0)){var b=ATt(RTt.vector3DToScreenCoords(t.camera,t.screenWidth,t.screenHeight,g),2),v=b[0],x=b[1],w={loX:(v+=4)-2,hiX:v+1+2,loY:x-i/2-2,hiY:x+i/2+2};if(e.insert(w,!0)){var S=n.labelStrings[m],_=n.defaultFontSize*n.scaleFactors[m]*s;if(this.gc.font=_+"px roboto",w.hiX+=this.gc.measureText(S).width-1,e.insert(w)){var k=1;r&&1===n.useSceneOpacityFlags[m]&&(k=u(p.length())),this.gc.fillStyle=this.styleStringFromPackedRgba(n.fillColors,m,k),this.gc.strokeStyle=this.styleStringFromPackedRgba(n.strokeColors,m,k),this.gc.lineWidth=this.styles.label.strokeWidth,this.gc.strokeText(S,v,x),this.gc.lineWidth=this.styles.label.fillWidth,this.gc.fillText(S,v,x)}}}}}},t.prototype.styleStringFromPackedRgba=function(t,e,n){var r=3*e;return"rgba("+t[r]+","+t[r+1]+","+t[r+2]+","+n+")"},t.prototype.onResize=function(t,e){var n=window.devicePixelRatio;this.canvas.width=t*n,this.canvas.height=e*n,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"},t.prototype.dispose=function(){this.removeAllLabels()},t.prototype.onPointPositionsChanged=function(t){this.worldSpacePointPositions=t,this.removeAllLabels()},t.prototype.onRender=function(t){this.labelsActive&&(this.removeAllLabels(),this.makeLabels(t))},t.prototype.setScene=function(t){},t.prototype.onPickingRender=function(t){},t}();ETt.ScatterPlotVisualizerCanvasLabels=OTt;var PTt={},LTt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(PTt,"__esModule",{value:!0});var DTt=Nkt,FTt=Pkt,zTt=uTt,BTt=function(){function t(){this.id="POLYLINES",this.sequences=[],this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={},this.pointSequenceIndices=new Map}return t.prototype.getPointSequenceIndex=function(t){return this.pointSequenceIndices.get(t)},t.prototype.updateSequenceIndices=function(){for(var t=0;t<this.sequences.length;t++)for(var e=this.sequences[t],n=0;n<e.indices.length-1;n++){var r=e.indices[n];this.pointSequenceIndices.set(r,t),this.pointSequenceIndices.set(r+1,t)}},t.prototype.createPolylines=function(){var t,e;this.updateSequenceIndices();try{for(var n=LTt(this.polylines),r=n.next();!r.done;r=n.next()){var i=r.value;this.scene.remove(i),i.geometry.dispose()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.polylines=[];for(var s=0;s<this.sequences.length;s++){var o=new DTt.BufferGeometry;o.addAttribute("position",this.polylinePositionBuffer[s]),o.addAttribute("color",this.polylineColorBuffer[s]);var a=new DTt.LineBasicMaterial({linewidth:1,opacity:1,transparent:!0,vertexColors:!0});(i=new DTt.LineSegments(o,a)).frustumCulled=!1,this.polylines.push(i),this.scene.add(i)}},t.prototype.dispose=function(){var t,e;try{for(var n=LTt(this.polylines),r=n.next();!r.done;r=n.next()){var i=r.value;this.scene.remove(i),i.geometry.dispose()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={}},t.prototype.setScene=function(t){this.scene=t},t.prototype.setSequences=function(t){this.sequences=t},t.prototype.onPointPositionsChanged=function(t){if(null==t&&this.dispose(),null!=t&&0!==this.sequences.length){for(var e=0;e<this.sequences.length;e++){var n=2*((s=this.sequences[e]).indices.length-1),r=new Float32Array(n*zTt.XYZ_NUM_ELEMENTS);this.polylinePositionBuffer[e]=new DTt.BufferAttribute(r,zTt.XYZ_NUM_ELEMENTS);var i=new Float32Array(n*zTt.RGBA_NUM_ELEMENTS);this.polylineColorBuffer[e]=new DTt.BufferAttribute(i,zTt.RGBA_NUM_ELEMENTS)}for(e=0;e<this.sequences.length;e++){for(var s=this.sequences[e],o=0,a=0;a<s.indices.length-1;a++){var l=s.indices[a],c=s.indices[a+1],u=FTt.vector3FromPackedArray(t,l),h=FTt.vector3FromPackedArray(t,c);this.polylinePositionBuffer[e].setXYZ(o,u.x,u.y,u.z),this.polylinePositionBuffer[e].setXYZ(o+1,h.x,h.y,h.z),o+=2}this.polylinePositionBuffer[e].needsUpdate=!0}this.createPolylines()}},t.prototype.onRender=function(t){for(var e=0;e<this.polylines.length;e++){var n=this.polylines[e].material;n.opacity=t.polylineOpacities[e],n.linewidth=t.polylineWidths[e],this.polylineColorBuffer[e].array=t.polylineColors[e],this.polylineColorBuffer[e].needsUpdate=!0}},t.prototype.onPickingRender=function(t){},t.prototype.onResize=function(t,e){},t}();PTt.ScatterPlotVisualizerPolylines=BTt;var UTt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},VTt=yt&&yt.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(UTt(arguments[e]));return t},jTt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(qpt,"__esModule",{value:!0});var WTt=Xpt,HTt=eTt,GTt=oTt,qTt=Okt,XTt=cTt,YTt=Pkt,KTt=uTt,ZTt=hTt,JTt=yTt,QTt=ETt,tEt=PTt,eEt=function(){function t(t,e){var n=this;void 0===e&&(e={}),this.pointColorer=null,this.sequences=[],this.renderMode="POINT",this.rotateOnStart=!0,this.selectEnabled=!0,this.showLabelsOnHover=!0,this.hoverPointIndex=null,this.selectedPointIndices=new Set,this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.cameraMoveCallback=function(){},this.onHover=function(t){n.hoverCallback(t),n.hoverPointIndex=t,n.updateScatterPlotAttributes(),n.renderScatterPlot()},this.onClick=function(t){n.clickCallback(t)},this.select=function(t){n.selectEnabled&&(n.selectedPointIndices=new Set(t),n.updateScatterPlotAttributes(),n.renderScatterPlot())},this.onSelect=function(t){n.selectEnabled&&(n.selectCallback(t),n.select(t))},this.containerElement=t,this.styles=XTt.makeStyles(e.styles),this.setParameters(e),this.scatterPlot=new WTt.ScatterPlot(t,{camera:e.camera,onClick:this.onClick,onHover:this.onHover,onSelect:this.onSelect,selectEnabled:this.selectEnabled,styles:this.styles,orbitControlParams:e.orbitControls}),this.scatterPlot.onCameraMove(this.cameraMoveCallback)}return t.prototype.setParameters=function(t){void 0!==t.onClick&&(this.clickCallback=t.onClick),void 0!==t.onHover&&(this.hoverCallback=t.onHover),void 0!==t.onSelect&&(this.selectCallback=t.onSelect),void 0!==t.onCameraMove&&(this.cameraMoveCallback=t.onCameraMove),void 0!==t.pointColorer&&(this.pointColorer=t.pointColorer),void 0!==t.renderMode&&(this.renderMode=t.renderMode),void 0!==t.rotateOnStart&&(this.rotateOnStart=t.rotateOnStart),void 0!==t.selectEnabled&&(this.selectEnabled=t.selectEnabled),void 0!==t.showLabelsOnHover&&(this.showLabelsOnHover=t.showLabelsOnHover)},t.prototype.render=function(t){this.updateDataset(t),this.clearVisualizers(),this.setVisualizers(),this.rotateOnStart&&this.scatterPlot.startOrbitAnimation()},t.prototype.clearVisualizers=function(){this.canvasLabelsVisualizer=void 0,this.labels3DVisualizer=void 0,this.pointVisualizer=void 0,this.polylineVisualizer=void 0,this.spritesheetVisualizer=void 0,this.scatterPlot.disposeAllVisualizers()},t.prototype.renderScatterPlot=function(){this.dataset&&this.scatterPlot.render()},t.prototype.resetZoom=function(){this.scatterPlot.resetZoom()},t.prototype.setRenderMode=function(t){this.renderMode=t,this.setVisualizers(),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions()},t.prototype.setTextRenderMode=function(){this.setRenderMode("TEXT"),this.renderScatterPlot()},t.prototype.setPointRenderMode=function(){this.setRenderMode("POINT"),this.renderScatterPlot()},t.prototype.setSpriteRenderMode=function(){this.dataset&&this.dataset.spriteMetadata&&(this.setRenderMode("SPRITE"),this.renderScatterPlot())},t.prototype.setSequences=function(t){this.sequences=t,this.updatePolylineAttributes(),this.setVisualizers(),this.renderScatterPlot()},t.prototype.setPanMode=function(){this.scatterPlot.setInteractionMode("PAN")},t.prototype.setSelectMode=function(){this.scatterPlot.setInteractionMode("SELECT")},t.prototype.setDimensions=function(t){var e=t<2||t>3,n=this.dataset&&t>this.dataset.dimensions;if(e||n)throw new RangeError("Setting invalid dimensionality");this.scatterPlot.setDimensions(t),this.renderScatterPlot()},t.prototype.setPointColorer=function(t){this.pointColorer=t,this.updateScatterPlotAttributes(),this.renderScatterPlot()},t.prototype.callPointColorer=function(t,e){return t(e,this.selectedPointIndices,this.hoverPointIndex)},t.prototype.setHoverPointIndex=function(t){this.hoverPointIndex=t,this.updateScatterPlotAttributes(),this.scatterPlot.orbitIsAnimating()||this.renderScatterPlot()},t.prototype.resize=function(){this.scatterPlot.resize()},t.prototype.updateDataset=function(t){this.setDataset(t),this.scatterPlot.setDimensions(t.dimensions),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions(),this.renderScatterPlot()},t.prototype.isOrbiting=function(){return this.scatterPlot.orbitIsAnimating()},t.prototype.startOrbitAnimation=function(){this.scatterPlot.startOrbitAnimation()},t.prototype.stopOrbitAnimation=function(){this.scatterPlot.stopOrbitAnimation()},t.prototype.setDataset=function(t){this.dataset=t,this.labels3DVisualizer&&this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray())},t.prototype.updateScatterPlotPositions=function(){var t=this.dataset;if(t){var e=this.generatePointPositionArray(t);this.scatterPlot.setPointPositions(e)}},t.prototype.updateScatterPlotAttributes=function(){var t=this.dataset;if(t){var e=this.generatePointColorArray(t),n=this.generatePointScaleFactorArray(t),r=this.generateVisibleLabelRenderParams();this.scatterPlot.setPointColors(e),this.scatterPlot.setPointScaleFactors(n),this.scatterPlot.setLabels(r)}},t.prototype.updatePolylineAttributes=function(){var t=this.dataset;if(t){var e=this.generateLineSegmentColorMap(t),n=this.generateLineSegmentOpacityArray(t),r=this.generateLineSegmentWidthArray(t);this.scatterPlot.setPolylineColors(e),this.scatterPlot.setPolylineOpacities(n),this.scatterPlot.setPolylineWidths(r)}},t.prototype.generatePointPositionArray=function(t){var e,n,r=[0,0];e=YTt.extent(t.points.map((function(t){return t[0]}))),n=YTt.extent(t.points.map((function(t){return t[1]}))),3===t.dimensions&&(r=YTt.extent(t.points.map((function(t){return t[2]}))));var i=function(t){return Math.abs(t[1]-t[0])},s=i(e),o=i(n),a=i(r),l=Math.max(s,o,a),c=KTt.SCATTER_PLOT_CUBE_LENGTH/2,u=function(t,e){return[t/l*-e,e*(t/l)]},h=u(s,c),d=u(o,c),p=u(a,c),f=new Float32Array(3*t.points.length),m=0;return t.points.forEach((function(i,s){var o=t.points[s];f[m++]=YTt.scaleLinear(o[0],e,h),f[m++]=YTt.scaleLinear(o[1],n,d),3===t.dimensions?f[m++]=YTt.scaleLinear(o[2],r,p):f[m++]=0})),f},t.prototype.generateVisibleLabelRenderParams=function(){var t=this,e=t.hoverPointIndex,n=t.selectedPointIndices,r=t.styles,i=null!==e?1:0,s=new Uint32Array(i),o=new Float32Array(i),a=new Int8Array(i),l=new Uint8Array(3*i),c=new Uint8Array(3*i),u=[];o.fill(r.label.scaleDefault),a.fill(1);var h=0;if(null!==e){u.push(this.getLabelText(e)),s[h]=e,o[h]=r.label.scaleLarge,a[h]=0;var d=YTt.styleRgbFromHexColor(r.label.fillColorHover);YTt.packRgbIntoUint8Array(l,h,d[0],d[1],d[2]);var p=YTt.styleRgbFromHexColor(r.label.strokeColorHover);YTt.packRgbIntoUint8Array(c,h,p[0],p[1],p[1]),++h}d=YTt.styleRgbFromHexColor(r.label.fillColorSelected),p=YTt.styleRgbFromHexColor(r.label.strokeColorSelected);if(1===n.size){var f=VTt(n)[0];u.push(this.getLabelText(f)),s[h]=f,o[h]=r.label.scaleLarge,a[h]=0,YTt.packRgbIntoUint8Array(l,h,d[0],d[1],d[2]),YTt.packRgbIntoUint8Array(c,h,p[0],p[1],p[2])}return new qTt.LabelRenderParams(new Float32Array(s),u,o,a,r.label.fontSize,l,c)},t.prototype.generatePointScaleFactorArray=function(t){var e,n,r=this,i=r.hoverPointIndex,s=r.selectedPointIndices,o=r.styles.point,a=o.scaleDefault,l=o.scaleSelected,c=o.scaleHover,u=new Float32Array(t.points.length);u.fill(a),s.size;try{for(var h=jTt(s.values()),d=h.next();!d.done;d=h.next()){u[d.value]=l}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}return null!=i&&(u[i]=c),u},t.prototype.generatePointColorArray=function(t){var e,n,r=this,i=r.hoverPointIndex,s=r.pointColorer,o=r.selectedPointIndices,a=r.styles.point,l=a.colorHover,c=a.colorNoSelection,u=a.colorSelected,h=a.colorUnselected,d=new Float32Array(t.points.length*KTt.RGBA_NUM_ELEMENTS),p=h,f=c;"TEXT"===this.renderMode&&(p=this.styles.label3D.colorUnselected,f=this.styles.label3D.colorNoSelection),"SPRITE"===this.renderMode&&(p=this.styles.sprites.colorUnselected,f=this.styles.sprites.colorNoSelection);var m=t.points.length,g=this.selectedPointIndices.size;if(s)for(var y=0,b=0;b<m;++b){var v=HTt.parseColor(this.callPointColorer(s,b)||f);d[y++]=v.r,d[y++]=v.g,d[y++]=v.b,d[y++]=v.opacity}else{for(y=0,v=g>0?HTt.parseColor(p):HTt.parseColor(f),b=0;b<m;++b)d[y++]=v.r,d[y++]=v.g,d[y++]=v.b,d[y++]=v.opacity;v=HTt.parseColor(u);try{for(var x=jTt(o.values()),w=x.next();!w.done;w=x.next()){var S=w.value*KTt.RGBA_NUM_ELEMENTS;d[S++]=v.r,d[S++]=v.g,d[S++]=v.b,d[S++]=v.opacity}}catch(t){e={error:t}}finally{try{w&&!w.done&&(n=x.return)&&n.call(x)}finally{if(e)throw e.error}}if(null!=i){var _=HTt.parseColor(l),k=i*KTt.RGBA_NUM_ELEMENTS;d[k++]=_.r,d[k++]=_.g,d[k++]=_.b,d[k++]=_.opacity}}return d},t.prototype.generate3DLabelsArray=function(){var t=this.dataset;if(!t)return[];for(var e=[],n=t.points.length,r=0;r<n;++r)e.push(this.getLabelText(r));return e},t.prototype.generateLineSegmentColorMap=function(t){for(var e=this.pointColorer,n=this.styles,r={},i=0;i<this.sequences.length;i++){var s=this.sequences[i],o=new Float32Array(2*(s.indices.length-1)*3),a=0;if(e)for(var l=0;l<s.indices.length-1;l++){var c=HTt.parseColor(this.callPointColorer(e,s.indices[l])),u=HTt.parseColor(this.callPointColorer(e,s.indices[l+1]));o[a++]=c.r,o[a++]=c.g,o[a++]=c.b,o[a++]=u.r,o[a++]=u.g,o[a++]=u.b}else for(l=0;l<s.indices.length-1;l++){c=YTt.getDefaultPointInPolylineColor(l,s.indices.length,n.polyline.startHue,n.polyline.endHue,n.polyline.saturation,n.polyline.lightness),u=YTt.getDefaultPointInPolylineColor(l+1,s.indices.length,n.polyline.startHue,n.polyline.endHue,n.polyline.saturation,n.polyline.lightness);o[a++]=c.r,o[a++]=c.g,o[a++]=c.b,o[a++]=u.r,o[a++]=u.g,o[a++]=u.b}r[i]=o}return r},t.prototype.generateLineSegmentOpacityArray=function(t){var e=this.selectedPointIndices,n=this.styles,r=new Float32Array(this.sequences.length);if(e.size>0){r.fill(n.polyline.deselectedOpacity);var i=this.polylineVisualizer.getPointSequenceIndex(VTt(e)[0]);void 0!==i&&(r[i]=n.polyline.selectedOpacity)}else r.fill(n.polyline.defaultOpacity);return r},t.prototype.generateLineSegmentWidthArray=function(t){var e=this.selectedPointIndices,n=this.styles,r=new Float32Array(this.sequences.length);if(r.fill(n.polyline.defaultLineWidth),e.size>0){var i=this.polylineVisualizer.getPointSequenceIndex(VTt(e)[0]);void 0!==i&&(r[i]=n.polyline.selectedLineWidth)}return r},t.prototype.getLabelText=function(t){var e=this.dataset;if(!e)return"";var n=e.metadata[t];return n&&null!=n.label?""+n.label:""},t.prototype.initializeCanvasLabelsVisualizer=function(){return this.canvasLabelsVisualizer||(this.canvasLabelsVisualizer=new QTt.ScatterPlotVisualizerCanvasLabels(this.containerElement,this.styles)),this.canvasLabelsVisualizer},t.prototype.initialize3DLabelsVisualizer=function(){return this.labels3DVisualizer||(this.labels3DVisualizer=new ZTt.ScatterPlotVisualizer3DLabels(this.styles)),this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray()),this.labels3DVisualizer},t.prototype.initializePointVisualizer=function(){return this.pointVisualizer||(this.pointVisualizer=new JTt.ScatterPlotVisualizerSprites(this.styles)),this.pointVisualizer},t.prototype.initializeSpritesheetVisualizer=function(){var t=this,e=this.styles,n=this.dataset,r=n.spriteMetadata;if(!this.spritesheetVisualizer&&r){if(!r.spriteImage||!r.singleSpriteSize)return;var i=n.points.length,s=void 0;if(r.spriteIndices)s=new Float32Array(r.spriteIndices);else{s=new Float32Array(i);for(var o=0;o<i;++o)s[o]=o}var a=new JTt.ScatterPlotVisualizerSprites(e,{spritesheetImage:r.spriteImage,spriteDimensions:r.singleSpriteSize,spriteIndices:s,onImageLoad:function(){return t.renderScatterPlot()}});a.id="SPRITE_SHEET_VISUALIZER",this.spritesheetVisualizer=a}return this.spritesheetVisualizer},t.prototype.initializePolylineVisualizer=function(){return this.polylineVisualizer||(this.polylineVisualizer=new tEt.ScatterPlotVisualizerPolylines),this.polylineVisualizer.setSequences(this.sequences),this.polylineVisualizer},t.prototype.setVisualizers=function(){var t=this.dataset,e=this.renderMode,n=[];if("TEXT"===e){var r=this.initialize3DLabelsVisualizer();n.push(r)}else if("POINT"===e){r=this.initializePointVisualizer();n.push(r)}else if("SPRITE"===e&&t.spriteMetadata){(r=this.initializeSpritesheetVisualizer())&&n.push(r)}if(this.sequences.length>0){r=this.initializePolylineVisualizer();n.push(r)}if(("POINT"===e||"SPRITE"===e)&&this.showLabelsOnHover){r=this.initializeCanvasLabelsVisualizer();n.push(r)}this.scatterPlot.setActiveVisualizers(n)},t.Dataset=GTt.Dataset,t}();qpt.ScatterGL=eEt,Object.defineProperty(Gpt,"__esModule",{value:!0});var nEt=qpt,rEt=Gpt.ScatterGL=nEt.ScatterGL,iEt=oTt;function sEt(t){let e;return{c(){e=zT("div"),GT(e,"id","scatter-container"),GT(e,"class","svelte-f0tf1i")},m(n,r){LT(n,e,r),t[4](e)},p:uT,d(n){n&&DT(e),t[4](null)}}}function oEt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[sEt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),66&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function aEt(t,e,n){let r,i,{title:s}=e,{embedding:o}=e,{labels:a}=e;return hE((()=>{const t=document.getElementById("scatter-container");i=new rEt(t,{styles:{point:{scaleDefault:1.6,scaleSelected:2,scaleHover:2}}}),o.subscribe((t=>{if(t.length>0){let e=[];e=void 0===a||0===a.get().length?new Array(t.length).fill(0):a.get();const n=new rEt.Dataset(t);i.render(n);const r=Array.from(new Set(e)),s=[...new Array(r.length)].map(((t,e)=>Math.floor(255/r.length*e))),o=s.map((t=>`hsla(${t}, 100%, 50%, 0.1)`)),l=s.map((t=>`hsla(${t}, 100%, 50%, 0.75)`)),c=s.map((t=>`hsla(${t}, 100%, 50%, 1)`));i.setPointColorer(((t,n,i)=>n.size>0?n.has(t)?c[r.indexOf(e[t])]:o[r.indexOf(e[t])]:t===i?c[r.indexOf(e[t])]:l[r.indexOf(e[t])]))}})),a.subscribe((t=>{const e=Array.from(new Set(t)),n=[...new Array(e.length)].map(((t,n)=>Math.floor(255/e.length*n))),r=n.map((t=>`hsla(${t}, 100%, 50%, 0.1)`)),s=n.map((t=>`hsla(${t}, 100%, 50%, 0.75)`)),o=n.map((t=>`hsla(${t}, 100%, 50%, 1)`));i.setPointColorer(((n,i,a)=>i.size>0?i.has(n)?o[e.indexOf(t[n])]:r[e.indexOf(t[n])]:n===a?o[e.indexOf(t[n])]:s[e.indexOf(t[n])]))}))})),t.$$set=t=>{"title"in t&&n(0,s=t.title),"embedding"in t&&n(2,o=t.embedding),"labels"in t&&n(3,a=t.labels)},[s,r,o,a,function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}Gpt.Dataset=iEt.Dataset;class lEt extends QE{constructor(t){super(),JE(this,t,aEt,oEt,gT,{title:0,embedding:2,labels:3})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),NE()}get embedding(){return this.$$.ctx[2]}set embedding(t){this.$$set({embedding:t}),NE()}get labels(){return this.$$.ctx[3]}set labels(t){this.$$set({labels:t}),NE()}}class cEt extends SU{constructor(t,e){super(),this.title="Scatter plot",this.$data=t.hold(),this.$labels=e.hold(),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new lEt({target:e,props:{title:this.title,embedding:this.$data,labels:this.$labels}}))}}function uEt(...t){return new cEt(...t)}function hEt(t){let e,n;return e=new GM({props:{options:t[3],value:t[4]}}),e.$on("change",t[5]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.options=t[3]),16&n&&(r.value=t[4]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function dEt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[hEt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function pEt(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(u,(t=>n(3,r=t))),u),a=uT,l=()=>(a(),a=vT(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{options:u}=e;o();let{value:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"options"in t&&o(n(1,u=t.options)),"value"in t&&l(n(2,h=t.value))},[c,u,h,r,i,function({detail:t}){h.set(t)}]}class fEt extends QE{constructor(t){super(),JE(this,t,pEt,dEt,gT,{title:0,options:1,value:2})}}class mEt extends SU{constructor(t,e){super(),this.title="select",this.$options=new rU(t,!0),this.$value=new rU(void 0!==e?e:t[0],!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new fEt({target:e,props:{title:this.title,options:this.$options,value:this.$value}}))}}function gEt(...t){return new mEt(...t)}const{document:yEt}=WE;function bEt(t){let e;return{c(){e=UT("Clear")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function vEt(t){let e,n,r,i,s,o,a,l;return s=new nM({props:{size:"small",type:"danger",$$slots:{default:[bEt]},$$scope:{ctx:t}}}),s.$on("click",t[2]),{c(){e=zT("div"),n=zT("canvas"),r=VT(),i=zT("div"),YE(s.$$.fragment),GT(n,"id","fxid"),GT(n,"class","sketchpad-container svelte-1trukpy"),GT(n,"width","300"),GT(n,"height","300"),GT(i,"class","m-1"),GT(e,"class","w-full flex flex-col items-center box-border")},m(c,u){LT(c,e,u),RT(e,n),t[8](n),RT(e,r),RT(e,i),KE(s,i,null),o=!0,a||(l=[WT(n,"mousemove",t[3]),WT(n,"mousedown",t[4])],a=!0)},p(t,e){const n={};16384&e&&(n.$$scope={dirty:e,ctx:t}),s.$set(n)},i(t){o||(FE(s.$$.fragment,t),o=!0)},o(t){zE(s.$$.fragment,t),o=!1},d(n){n&&DT(e),t[8](null),ZE(s),a=!1,fT(l)}}}function xEt(t){let e,n,r,i,s;return n=new zL({props:{title:t[0],$$slots:{default:[vEt]},$$scope:{ctx:t}}}),{c(){e=VT(),YE(n.$$.fragment)},m(o,a){LT(o,e,a),KE(n,o,a),r=!0,i||(s=WT(yEt.body,"mouseup",t[5]),i=!0)},p(t,[e]){const r={};1&e&&(r.title=t[0]),16386&e&&(r.$$scope={dirty:e,ctx:t}),n.$set(r)},i(t){r||(FE(n.$$.fragment,t),r=!0)},o(t){zE(n.$$.fragment,t),r=!1},d(t){t&&DT(e),ZE(n,t),i=!1,s()}}}function wEt(t,e,n){let r,i,{title:s}=e,{strokeStart:o}=e,{strokeEnd:a}=e,l=!1,c={left:0,top:0},u={x:0,y:0};const h=fE();function d(){i.clearRect(0,0,r.width,r.height),i.fillStyle="white",i.fillRect(0,0,r.width,r.height),l=!1}function p(t){const e=t.clientX-c.left,n=t.clientY-c.top;l&&(i.beginPath(),i.strokeStyle="black",i.lineWidth=10,i.lineJoin="round",i.moveTo(u.x,u.y),i.lineTo(e,n),i.closePath(),i.stroke()),u.x=e,u.y=n}return hE((async()=>{await kE(),await kE(),i=r.getContext("2d"),d(),h("canvasElement",r)})),t.$$set=t=>{"title"in t&&n(0,s=t.title),"strokeStart"in t&&n(6,o=t.strokeStart),"strokeEnd"in t&&n(7,a=t.strokeEnd)},[s,r,d,p,function(t){const e=r.getBoundingClientRect();c={top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft},p(t),o.set(),l=!0},function(){l&&a.set(),l=!1},o,a,function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class SEt extends QE{constructor(t){super(),JE(this,t,wEt,xEt,gT,{title:0,strokeStart:6,strokeEnd:7})}}var _Et,kEt,TEt,EEt;class MEt extends SU{constructor(){super(),this.title="sketchPad",this.$images=new rU(JD()),this.$thumbnails=new rU(JD()),this.$strokeStart=new rU(JD()),this.$strokeEnd=new rU(JD()),_Et.set(this,60),kEt.set(this,void 0),TEt.set(this,void 0),EEt.set(this,void 0),this.setupCapture(),this.$strokeEnd.subscribe((()=>{this.capture()})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new SEt({target:e,props:{title:this.title,strokeStart:this.$strokeStart,strokeEnd:this.$strokeEnd}}),this.$$.app.$on("canvasElement",(t=>{this.sketchElement=t.detail,HB(this,EEt,this.sketchElement.getContext("2d"),"f")})))}setupCapture(){HB(this,kEt,document.createElement("canvas"),"f"),WB(this,kEt,"f").width=WB(this,_Et,"f"),WB(this,kEt,"f").height=WB(this,_Et,"f"),HB(this,TEt,WB(this,kEt,"f").getContext("2d"),"f")}capture(){const t=this.captureThumbnail();this.$thumbnails.set(t),this.$images.set(this.captureImage())}captureThumbnail(){return WB(this,TEt,"f").drawImage(this.sketchElement,0,0,WB(this,kEt,"f").width,WB(this,kEt,"f").height),WB(this,kEt,"f").toDataURL("image/jpeg")}captureImage(){return WB(this,EEt,"f").getImageData(0,0,this.sketchElement.width,this.sketchElement.height)}}function CEt(...t){return new MEt(...t)}function AEt(t){return"[object Date]"===Object.prototype.toString.call(t)}function NEt(t,e,n,r){if("number"==typeof n||AEt(n)){const i=r-n,s=(n-e)/(t.dt||1/60),o=(s+(t.opts.stiffness*i-t.opts.damping*s)*t.inv_mass)*t.dt;return Math.abs(o)<t.opts.precision&&Math.abs(i)<t.opts.precision?r:(t.settled=!1,AEt(n)?new Date(n.getTime()+o):n+o)}if(Array.isArray(n))return n.map(((i,s)=>NEt(t,e[s],n[s],r[s])));if("object"==typeof n){const i={};for(const s in n)i[s]=NEt(t,e[s],n[s],r[s]);return i}throw new Error(`Cannot spring ${typeof n} values`)}function IEt(t,e={}){const n=QM(t),{stiffness:r=.15,damping:i=.8,precision:s=.01}=e;let o,a,l,c=t,u=t,h=1,d=0,p=!1;function f(e,r={}){u=e;const i=l={};if(null==t||r.hard||m.stiffness>=1&&m.damping>=1)return p=!0,o=CT(),c=e,n.set(t=u),Promise.resolve();if(r.soft){const t=!0===r.soft?.5:+r.soft;d=1/(60*t),h=0}return a||(o=CT(),p=!1,a=$T((e=>{if(p)return p=!1,a=null,!1;h=Math.min(h+d,1);const r={inv_mass:h,opts:m,settled:!0,dt:60*(e-o)/1e3},i=NEt(r,c,t,u);return o=e,c=t,n.set(t=i),r.settled&&(a=null),!r.settled}))),new Promise((t=>{a.promise.then((()=>{i===l&&t()}))}))}const m={set:f,update:(e,n)=>f(e(u,t),n),subscribe:n.subscribe,stiffness:r,damping:i,precision:s};return m}function $Et(t,e,n){const r=t.slice();return r[28]=e[n],r[30]=n,r}function REt(t){let e,n,r,i,s=("label"===t[6]||"label"===t[7])&&OEt(t);return{c(){e=zT("span"),s&&s.c(),GT(e,"class","pip first"),GT(e,"style",n=t[14]+": 0%;"),tE(e,"selected",t[18](t[0])),tE(e,"in-range",t[17](t[0]))},m(n,o){LT(n,e,o),s&&s.m(e,null),r||(i=[WT(e,"click",(function(){mT(t[21](t[0]))&&t[21](t[0]).apply(this,arguments)})),WT(e,"touchend",HT((function(){mT(t[21](t[0]))&&t[21](t[0]).apply(this,arguments)})))],r=!0)},p(r,i){"label"===(t=r)[6]||"label"===t[7]?s?s.p(t,i):(s=OEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null),16384&i&&n!==(n=t[14]+": 0%;")&&GT(e,"style",n),262145&i&&tE(e,"selected",t[18](t[0])),131073&i&&tE(e,"in-range",t[17](t[0]))},d(t){t&&DT(e),s&&s.d(),r=!1,fT(i)}}}function OEt(t){let e,n,r=t[12](t[16](t[0]),0,0)+"",i=t[10]&&PEt(t),s=t[11]&&LEt(t);return{c(){e=zT("span"),i&&i.c(),n=UT(r),s&&s.c(),GT(e,"class","pipVal")},m(t,r){LT(t,e,r),i&&i.m(e,null),RT(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=PEt(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),69633&o&&r!==(r=t[12](t[16](t[0]),0,0)+"")&&XT(n,r),t[11]?s?s.p(t,o):(s=LEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&DT(e),i&&i.d(),s&&s.d()}}}function PEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[10]),GT(e,"class","pipVal-prefix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){1024&e&&XT(n,t[10])},d(t){t&&DT(e)}}}function LEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[11]),GT(e,"class","pipVal-suffix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){2048&e&&XT(n,t[11])},d(t){t&&DT(e)}}}function DEt(t){let e,n=Array(t[20]+1),r=[];for(let e=0;e<n.length;e+=1)r[e]=VEt($Et(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=jT()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);LT(t,e,n)},p(t,i){if(4120131&i){let s;for(n=Array(t[20]+1),s=0;s<n.length;s+=1){const o=$Et(t,n,s);r[s]?r[s].p(o,i):(r[s]=VEt(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){FT(r,t),t&&DT(e)}}}function FEt(t){let e,n,r,i,s,o=("label"===t[6]||"label"===t[9])&&zEt(t);return{c(){e=zT("span"),o&&o.c(),n=VT(),GT(e,"class","pip"),GT(e,"style",r=t[14]+": "+t[15](t[19](t[30]))+"%;"),tE(e,"selected",t[18](t[19](t[30]))),tE(e,"in-range",t[17](t[19](t[30])))},m(r,a){LT(r,e,a),o&&o.m(e,null),RT(e,n),i||(s=[WT(e,"click",(function(){mT(t[21](t[19](t[30])))&&t[21](t[19](t[30])).apply(this,arguments)})),WT(e,"touchend",HT((function(){mT(t[21](t[19](t[30])))&&t[21](t[19](t[30])).apply(this,arguments)})))],i=!0)},p(i,s){"label"===(t=i)[6]||"label"===t[9]?o?o.p(t,s):(o=zEt(t),o.c(),o.m(e,n)):o&&(o.d(1),o=null),573440&s&&r!==(r=t[14]+": "+t[15](t[19](t[30]))+"%;")&&GT(e,"style",r),786432&s&&tE(e,"selected",t[18](t[19](t[30]))),655360&s&&tE(e,"in-range",t[17](t[19](t[30])))},d(t){t&&DT(e),o&&o.d(),i=!1,fT(s)}}}function zEt(t){let e,n,r=t[12](t[19](t[30]),t[30],t[15](t[19](t[30])))+"",i=t[10]&&BEt(t),s=t[11]&&UEt(t);return{c(){e=zT("span"),i&&i.c(),n=UT(r),s&&s.c(),GT(e,"class","pipVal")},m(t,r){LT(t,e,r),i&&i.m(e,null),RT(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=BEt(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),561152&o&&r!==(r=t[12](t[19](t[30]),t[30],t[15](t[19](t[30])))+"")&&XT(n,r),t[11]?s?s.p(t,o):(s=UEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&DT(e),i&&i.d(),s&&s.d()}}}function BEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[10]),GT(e,"class","pipVal-prefix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){1024&e&&XT(n,t[10])},d(t){t&&DT(e)}}}function UEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[11]),GT(e,"class","pipVal-suffix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){2048&e&&XT(n,t[11])},d(t){t&&DT(e)}}}function VEt(t){let e,n=t[19](t[30])!==t[0]&&t[19](t[30])!==t[1],r=n&&FEt(t);return{c(){r&&r.c(),e=jT()},m(t,n){r&&r.m(t,n),LT(t,e,n)},p(t,i){524291&i&&(n=t[19](t[30])!==t[0]&&t[19](t[30])!==t[1]),n?r?r.p(t,i):(r=FEt(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},d(t){r&&r.d(t),t&&DT(e)}}}function jEt(t){let e,n,r,i,s=("label"===t[6]||"label"===t[8])&&WEt(t);return{c(){e=zT("span"),s&&s.c(),GT(e,"class","pip last"),GT(e,"style",n=t[14]+": 100%;"),tE(e,"selected",t[18](t[1])),tE(e,"in-range",t[17](t[1]))},m(n,o){LT(n,e,o),s&&s.m(e,null),r||(i=[WT(e,"click",(function(){mT(t[21](t[1]))&&t[21](t[1]).apply(this,arguments)})),WT(e,"touchend",HT((function(){mT(t[21](t[1]))&&t[21](t[1]).apply(this,arguments)})))],r=!0)},p(r,i){"label"===(t=r)[6]||"label"===t[8]?s?s.p(t,i):(s=WEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null),16384&i&&n!==(n=t[14]+": 100%;")&&GT(e,"style",n),262146&i&&tE(e,"selected",t[18](t[1])),131074&i&&tE(e,"in-range",t[17](t[1]))},d(t){t&&DT(e),s&&s.d(),r=!1,fT(i)}}}function WEt(t){let e,n,r=t[12](t[16](t[1]),t[20],100)+"",i=t[10]&&HEt(t),s=t[11]&&GEt(t);return{c(){e=zT("span"),i&&i.c(),n=UT(r),s&&s.c(),GT(e,"class","pipVal")},m(t,r){LT(t,e,r),i&&i.m(e,null),RT(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=HEt(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),1118210&o&&r!==(r=t[12](t[16](t[1]),t[20],100)+"")&&XT(n,r),t[11]?s?s.p(t,o):(s=GEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&DT(e),i&&i.d(),s&&s.d()}}}function HEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[10]),GT(e,"class","pipVal-prefix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){1024&e&&XT(n,t[10])},d(t){t&&DT(e)}}}function GEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[11]),GT(e,"class","pipVal-suffix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){2048&e&&XT(n,t[11])},d(t){t&&DT(e)}}}function qEt(t){let e,n,r,i=(t[6]&&!1!==t[7]||t[7])&&REt(t),s=(t[6]&&!1!==t[9]||t[9])&&DEt(t),o=(t[6]&&!1!==t[8]||t[8])&&jEt(t);return{c(){e=zT("div"),i&&i.c(),n=VT(),s&&s.c(),r=VT(),o&&o.c(),GT(e,"class","rangePips"),tE(e,"disabled",t[5]),tE(e,"hoverable",t[4]),tE(e,"vertical",t[2]),tE(e,"reversed",t[3]),tE(e,"focus",t[13])},m(t,a){LT(t,e,a),i&&i.m(e,null),RT(e,n),s&&s.m(e,null),RT(e,r),o&&o.m(e,null)},p(t,[a]){t[6]&&!1!==t[7]||t[7]?i?i.p(t,a):(i=REt(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),t[6]&&!1!==t[9]||t[9]?s?s.p(t,a):(s=DEt(t),s.c(),s.m(e,r)):s&&(s.d(1),s=null),t[6]&&!1!==t[8]||t[8]?o?o.p(t,a):(o=jEt(t),o.c(),o.m(e,null)):o&&(o.d(1),o=null),32&a&&tE(e,"disabled",t[5]),16&a&&tE(e,"hoverable",t[4]),4&a&&tE(e,"vertical",t[2]),8&a&&tE(e,"reversed",t[3]),8192&a&&tE(e,"focus",t[13])},i:uT,o:uT,d(t){t&&DT(e),i&&i.d(),s&&s.d(),o&&o.d()}}}function XEt(t,e,n){let r,i,s,o,a,{range:l=!1}=e,{min:c=0}=e,{max:u=100}=e,{step:h=1}=e,{values:d=[(u+c)/2]}=e,{vertical:p=!1}=e,{reversed:f=!1}=e,{hoverable:m=!0}=e,{disabled:g=!1}=e,{pipstep:y}=e,{all:b=!0}=e,{first:v}=e,{last:x}=e,{rest:w}=e,{prefix:S=""}=e,{suffix:_=""}=e,{formatter:k=((t,e)=>t)}=e,{focus:T}=e,{orientationStart:E}=e,{percentOf:M}=e,{moveHandle:C}=e,{fixFloat:A}=e;return t.$$set=t=>{"range"in t&&n(22,l=t.range),"min"in t&&n(0,c=t.min),"max"in t&&n(1,u=t.max),"step"in t&&n(23,h=t.step),"values"in t&&n(24,d=t.values),"vertical"in t&&n(2,p=t.vertical),"reversed"in t&&n(3,f=t.reversed),"hoverable"in t&&n(4,m=t.hoverable),"disabled"in t&&n(5,g=t.disabled),"pipstep"in t&&n(25,y=t.pipstep),"all"in t&&n(6,b=t.all),"first"in t&&n(7,v=t.first),"last"in t&&n(8,x=t.last),"rest"in t&&n(9,w=t.rest),"prefix"in t&&n(10,S=t.prefix),"suffix"in t&&n(11,_=t.suffix),"formatter"in t&&n(12,k=t.formatter),"focus"in t&&n(13,T=t.focus),"orientationStart"in t&&n(14,E=t.orientationStart),"percentOf"in t&&n(15,M=t.percentOf),"moveHandle"in t&&n(26,C=t.moveHandle),"fixFloat"in t&&n(16,A=t.fixFloat)},t.$$.update=()=>{41943047&t.$$.dirty&&n(27,r=y||((u-c)/h>=(p?50:100)?(u-c)/(p?10:20):1)),142606339&t.$$.dirty&&n(20,i=parseInt((u-c)/(h*r),10)),142671873&t.$$.dirty&&n(19,s=function(t){return A(c+t*h*r)}),16842752&t.$$.dirty&&n(18,o=function(t){return d.some((e=>A(e)===A(t)))}),20971520&t.$$.dirty&&n(17,a=function(t){return"min"===l?d[0]>t:"max"===l?d[0]<t:l?d[0]<t&&d[1]>t:void 0})},[c,u,p,f,m,g,b,v,x,w,S,_,k,T,E,M,A,a,o,s,i,function(t){g||C(void 0,t)},l,h,d,y,C,r]}_Et=new WeakMap,kEt=new WeakMap,TEt=new WeakMap,EEt=new WeakMap;class YEt extends QE{constructor(t){super(),JE(this,t,XEt,qEt,gT,{range:22,min:0,max:1,step:23,values:24,vertical:2,reversed:3,hoverable:4,disabled:5,pipstep:25,all:6,first:7,last:8,rest:9,prefix:10,suffix:11,formatter:12,focus:13,orientationStart:14,percentOf:15,moveHandle:26,fixFloat:16})}}function KEt(t,e,n){const r=t.slice();return r[64]=e[n],r[66]=n,r}function ZEt(t){let e,n,r=t[21](t[64],t[66],t[23](t[64]))+"",i=t[18]&&JEt(t),s=t[19]&&QEt(t);return{c(){e=zT("span"),i&&i.c(),n=UT(r),s&&s.c(),GT(e,"class","rangeFloat")},m(t,r){LT(t,e,r),i&&i.m(e,null),RT(e,n),s&&s.m(e,null)},p(t,o){t[18]?i?i.p(t,o):(i=JEt(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),10485761&o[0]&&r!==(r=t[21](t[64],t[66],t[23](t[64]))+"")&&XT(n,r),t[19]?s?s.p(t,o):(s=QEt(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&DT(e),i&&i.d(),s&&s.d()}}}function JEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[18]),GT(e,"class","rangeFloat-prefix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){262144&e[0]&&XT(n,t[18])},d(t){t&&DT(e)}}}function QEt(t){let e,n;return{c(){e=zT("span"),n=UT(t[19]),GT(e,"class","rangeFloat-suffix")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){524288&e[0]&&XT(n,t[19])},d(t){t&&DT(e)}}}function tMt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[7]&&ZEt(t);return{c(){e=zT("span"),n=zT("span"),r=VT(),p&&p.c(),GT(n,"class","rangeNub"),GT(e,"role","slider"),GT(e,"class","rangeHandle"),GT(e,"data-handle",t[66]),GT(e,"style",i=t[28]+": "+t[29][t[66]]+"%; z-index: "+(t[26]===t[66]?3:2)+";"),GT(e,"aria-valuemin",s=!0===t[2]&&1===t[66]?t[0][0]:t[3]),GT(e,"aria-valuemax",o=!0===t[2]&&0===t[66]?t[0][1]:t[4]),GT(e,"aria-valuenow",a=t[64]),GT(e,"aria-valuetext",l=""+(t[18]+t[21](t[64],t[66],t[23](t[64]))+t[19])),GT(e,"aria-orientation",c=t[6]?"vertical":"horizontal"),GT(e,"aria-disabled",t[10]),GT(e,"disabled",t[10]),GT(e,"tabindex",u=t[10]?-1:0),tE(e,"active",t[24]&&t[26]===t[66]),tE(e,"press",t[25]&&t[26]===t[66])},m(i,s){LT(i,e,s),RT(e,n),RT(e,r),p&&p.m(e,null),h||(d=[WT(e,"blur",t[34]),WT(e,"focus",t[35]),WT(e,"keydown",t[36])],h=!0)},p(t,n){t[7]?p?p.p(t,n):(p=ZEt(t),p.c(),p.m(e,null)):p&&(p.d(1),p=null),872415232&n[0]&&i!==(i=t[28]+": "+t[29][t[66]]+"%; z-index: "+(t[26]===t[66]?3:2)+";")&&GT(e,"style",i),13&n[0]&&s!==(s=!0===t[2]&&1===t[66]?t[0][0]:t[3])&&GT(e,"aria-valuemin",s),21&n[0]&&o!==(o=!0===t[2]&&0===t[66]?t[0][1]:t[4])&&GT(e,"aria-valuemax",o),1&n[0]&&a!==(a=t[64])&&GT(e,"aria-valuenow",a),11272193&n[0]&&l!==(l=""+(t[18]+t[21](t[64],t[66],t[23](t[64]))+t[19]))&&GT(e,"aria-valuetext",l),64&n[0]&&c!==(c=t[6]?"vertical":"horizontal")&&GT(e,"aria-orientation",c),1024&n[0]&&GT(e,"aria-disabled",t[10]),1024&n[0]&&GT(e,"disabled",t[10]),1024&n[0]&&u!==(u=t[10]?-1:0)&&GT(e,"tabindex",u),83886080&n[0]&&tE(e,"active",t[24]&&t[26]===t[66]),100663296&n[0]&&tE(e,"press",t[25]&&t[26]===t[66])},d(t){t&&DT(e),p&&p.d(),h=!1,fT(d)}}}function eMt(t){let e,n;return{c(){e=zT("span"),GT(e,"class","rangeBar"),GT(e,"style",n=t[28]+": "+t[32](t[29])+"%; "+t[27]+": "+t[33](t[29])+"%;")},m(t,n){LT(t,e,n)},p(t,r){939524096&r[0]&&n!==(n=t[28]+": "+t[32](t[29])+"%; "+t[27]+": "+t[33](t[29])+"%;")&&GT(e,"style",n)},d(t){t&&DT(e)}}}function nMt(t){let e,n;return e=new YEt({props:{values:t[0],min:t[3],max:t[4],step:t[5],range:t[2],vertical:t[6],reversed:t[8],orientationStart:t[28],hoverable:t[9],disabled:t[10],all:t[13],first:t[14],last:t[15],rest:t[16],pipstep:t[12],prefix:t[18],suffix:t[19],formatter:t[20],focus:t[24],percentOf:t[23],moveHandle:t[31],fixFloat:t[30]}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};1&n[0]&&(r.values=t[0]),8&n[0]&&(r.min=t[3]),16&n[0]&&(r.max=t[4]),32&n[0]&&(r.step=t[5]),4&n[0]&&(r.range=t[2]),64&n[0]&&(r.vertical=t[6]),256&n[0]&&(r.reversed=t[8]),268435456&n[0]&&(r.orientationStart=t[28]),512&n[0]&&(r.hoverable=t[9]),1024&n[0]&&(r.disabled=t[10]),8192&n[0]&&(r.all=t[13]),16384&n[0]&&(r.first=t[14]),32768&n[0]&&(r.last=t[15]),65536&n[0]&&(r.rest=t[16]),4096&n[0]&&(r.pipstep=t[12]),262144&n[0]&&(r.prefix=t[18]),524288&n[0]&&(r.suffix=t[19]),1048576&n[0]&&(r.formatter=t[20]),16777216&n[0]&&(r.focus=t[24]),8388608&n[0]&&(r.percentOf=t[23]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function rMt(t){let e,n,r,i,s,o,a=t[0],l=[];for(let e=0;e<a.length;e+=1)l[e]=tMt(KEt(t,a,e));let c=t[2]&&eMt(t),u=t[11]&&nMt(t);return{c(){e=zT("div");for(let t=0;t<l.length;t+=1)l[t].c();n=VT(),c&&c.c(),r=VT(),u&&u.c(),GT(e,"id",t[17]),GT(e,"class","rangeSlider"),tE(e,"range",t[2]),tE(e,"disabled",t[10]),tE(e,"hoverable",t[9]),tE(e,"vertical",t[6]),tE(e,"reversed",t[8]),tE(e,"focus",t[24]),tE(e,"min","min"===t[2]),tE(e,"max","max"===t[2]),tE(e,"pips",t[11]),tE(e,"pip-labels","label"===t[13]||"label"===t[14]||"label"===t[15]||"label"===t[16])},m(a,h){LT(a,e,h);for(let t=0;t<l.length;t+=1)l[t].m(e,null);RT(e,n),c&&c.m(e,null),RT(e,r),u&&u.m(e,null),t[50](e),i=!0,s||(o=[WT(window,"mousedown",t[39]),WT(window,"touchstart",t[39]),WT(window,"mousemove",t[40]),WT(window,"touchmove",t[40]),WT(window,"mouseup",t[41]),WT(window,"touchend",t[42]),WT(window,"keydown",t[43]),WT(e,"mousedown",t[37]),WT(e,"mouseup",t[38]),WT(e,"touchstart",HT(t[37])),WT(e,"touchend",HT(t[38]))],s=!0)},p(t,s){if(934020317&s[0]|56&s[1]){let r;for(a=t[0],r=0;r<a.length;r+=1){const i=KEt(t,a,r);l[r]?l[r].p(i,s):(l[r]=tMt(i),l[r].c(),l[r].m(e,n))}for(;r<l.length;r+=1)l[r].d(1);l.length=a.length}t[2]?c?c.p(t,s):(c=eMt(t),c.c(),c.m(e,r)):c&&(c.d(1),c=null),t[11]?u?(u.p(t,s),2048&s[0]&&FE(u,1)):(u=nMt(t),u.c(),FE(u,1),u.m(e,null)):u&&(LE(),zE(u,1,1,(()=>{u=null})),DE()),(!i||131072&s[0])&&GT(e,"id",t[17]),(!i||4&s[0])&&tE(e,"range",t[2]),(!i||1024&s[0])&&tE(e,"disabled",t[10]),(!i||512&s[0])&&tE(e,"hoverable",t[9]),(!i||64&s[0])&&tE(e,"vertical",t[6]),(!i||256&s[0])&&tE(e,"reversed",t[8]),(!i||16777216&s[0])&&tE(e,"focus",t[24]),(!i||4&s[0])&&tE(e,"min","min"===t[2]),(!i||4&s[0])&&tE(e,"max","max"===t[2]),(!i||2048&s[0])&&tE(e,"pips",t[11]),(!i||122880&s[0])&&tE(e,"pip-labels","label"===t[13]||"label"===t[14]||"label"===t[15]||"label"===t[16])},i(t){i||(FE(u),i=!0)},o(t){zE(u),i=!1},d(n){n&&DT(e),FT(l,n),c&&c.d(),u&&u.d(),t[50](null),s=!1,fT(o)}}}function iMt(t){if(!t)return-1;for(var e=0;t=t.previousElementSibling;)e++;return e}function sMt(t){return t.type.includes("touch")?t.touches[0]:t}function oMt(t,e,n){let r,i,s,o,a,l,c=uT;t.$$.on_destroy.push((()=>c()));let{slider:u}=e,{range:h=!1}=e,{pushy:d=!1}=e,{min:p=0}=e,{max:f=100}=e,{step:m=1}=e,{values:g=[(f+p)/2]}=e,{vertical:y=!1}=e,{float:b=!1}=e,{reversed:v=!1}=e,{hoverable:x=!0}=e,{disabled:w=!1}=e,{pips:S=!1}=e,{pipstep:_}=e,{all:k}=e,{first:T}=e,{last:E}=e,{rest:M}=e,{id:C}=e,{prefix:A=""}=e,{suffix:N=""}=e,{formatter:I=((t,e,n)=>t)}=e,{handleFormatter:$=I}=e,{precision:R=2}=e,{springValues:O={stiffness:.15,damping:.4}}=e;const P=fE();let L,D,F,z=0,B=!1,U=!1,V=!1,j=!1,W=g.length-1;const H=t=>parseFloat(t.toFixed(R));function G(){return u.getBoundingClientRect()}function q(t){const e=G();let n=0,r=0,i=0;y?(n=t.clientY-e.top,r=n/e.height*100,r=v?r:100-r):(n=t.clientX-e.left,r=n/e.width*100,r=v?100-r:r),i=(f-p)/100*r+p,X(W,i)}function X(t,e){return e=s(e),void 0===t&&(t=W),h&&(0===t&&e>g[1]?d?n(0,g[1]=e,g):e=g[1]:1===t&&e<g[0]&&(d?n(0,g[0]=e,g):e=g[0])),g[t]!==e&&n(0,g[t]=e,g),D!==e&&(!w&&P("change",{activeHandle:W,startValue:L,previousValue:void 0===D?L:D,value:g[W],values:g.map((t=>s(t)))}),D=e),e}function Y(){!w&&P("stop",{activeHandle:W,startValue:L,value:g[W],values:g.map((t=>s(t)))})}return t.$$set=t=>{"slider"in t&&n(1,u=t.slider),"range"in t&&n(2,h=t.range),"pushy"in t&&n(44,d=t.pushy),"min"in t&&n(3,p=t.min),"max"in t&&n(4,f=t.max),"step"in t&&n(5,m=t.step),"values"in t&&n(0,g=t.values),"vertical"in t&&n(6,y=t.vertical),"float"in t&&n(7,b=t.float),"reversed"in t&&n(8,v=t.reversed),"hoverable"in t&&n(9,x=t.hoverable),"disabled"in t&&n(10,w=t.disabled),"pips"in t&&n(11,S=t.pips),"pipstep"in t&&n(12,_=t.pipstep),"all"in t&&n(13,k=t.all),"first"in t&&n(14,T=t.first),"last"in t&&n(15,E=t.last),"rest"in t&&n(16,M=t.rest),"id"in t&&n(17,C=t.id),"prefix"in t&&n(18,A=t.prefix),"suffix"in t&&n(19,N=t.suffix),"formatter"in t&&n(20,I=t.formatter),"handleFormatter"in t&&n(21,$=t.handleFormatter),"precision"in t&&n(45,R=t.precision),"springValues"in t&&n(46,O=t.springValues)},t.$$.update=()=>{24&t.$$.dirty[0]&&n(49,i=function(t){return t<=p?p:t>=f?f:t}),56&t.$$.dirty[0]|262144&t.$$.dirty[1]&&n(48,s=function(t){if(t<=p)return H(p);if(t>=f)return H(f);let e=(t-p)%m,n=t-e;return 2*Math.abs(e)>=m&&(n+=e>0?m:-m),n=i(n),H(n)}),24&t.$$.dirty[0]&&n(23,r=function(t){let e=(t-p)/(f-p)*100;return isNaN(e)||e<=0?0:e>=100?100:H(e)}),12582937&t.$$.dirty[0]|229376&t.$$.dirty[1]&&(Array.isArray(g)||(n(0,g=[(f+p)/2]),console.error("'values' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)")),n(0,g=function(t){return"min"===h||"max"===h?t.slice(0,1):h?t.slice(0,2):t}(g.map((t=>s(t))))),z!==g.length?(n(22,F=IEt(g.map((t=>r(t))),O)),c(),c=vT(F,(t=>n(29,l=t)))):F.set(g.map((t=>r(t)))),n(47,z=g.length)),320&t.$$.dirty[0]&&n(28,o=y?v?"top":"bottom":v?"right":"left"),320&t.$$.dirty[0]&&n(27,a=y?v?"bottom":"top":v?"left":"right")},[g,u,h,p,f,m,y,b,v,x,w,S,_,k,T,E,M,C,A,N,I,$,F,r,B,V,W,a,o,l,H,X,function(t){return"min"===h?0:t[0]},function(t){return"max"===h?0:"min"===h?100-t[0]:100-t[1]},function(t){j&&(n(24,B=!1),U=!1,n(25,V=!1))},function(t){w||(n(26,W=iMt(t.target)),n(24,B=!0))},function(t){if(!w){const e=iMt(t.target);let n=t.ctrlKey||t.metaKey||t.shiftKey?10*m:m,r=!1;switch(t.key){case"PageDown":n*=10;case"ArrowRight":case"ArrowUp":X(e,g[e]+n),r=!0;break;case"PageUp":n*=10;case"ArrowLeft":case"ArrowDown":X(e,g[e]-n),r=!0;break;case"Home":X(e,p),r=!0;break;case"End":X(e,f),r=!0}r&&(t.preventDefault(),t.stopPropagation())}},function(t){if(!w){const e=t.target,r=sMt(t);n(24,B=!0),U=!0,n(25,V=!0),n(26,W=function(t){const e=G();let n,r=0,i=0,s=0;return y?(r=t.clientY-e.top,i=r/e.height*100,i=v?i:100-i):(r=t.clientX-e.left,i=r/e.width*100,i=v?100-i:i),s=(f-p)/100*i+p,!0===h&&g[0]===g[1]?s>g[1]?1:0:(n=g.indexOf([...g].sort(((t,e)=>Math.abs(s-t)-Math.abs(s-e)))[0]),n)}(r)),L=D=s(g[W]),!w&&P("start",{activeHandle:W,value:L,values:g.map((t=>s(t)))}),"touchstart"!==t.type||e.matches(".pipVal")||q(r)}},function(t){"touchend"===t.type&&Y(),n(25,V=!1)},function(t){j=!1,B&&t.target!==u&&!u.contains(t.target)&&n(24,B=!1)},function(t){w||U&&q(sMt(t))},function(t){if(!w){const e=t.target;U&&((e===u||u.contains(e))&&(n(24,B=!0),function(t){const e=u.querySelectorAll(".handle"),n=Array.prototype.includes.call(e,t),r=Array.prototype.some.call(e,(e=>e.contains(t)));return n||r}(e)||e.matches(".pipVal")||q(sMt(t))),Y())}U=!1,n(25,V=!1)},function(t){U=!1,n(25,V=!1)},function(t){w||(t.target===u||u.contains(t.target))&&(j=!0)},d,R,O,z,s,i,function(t){bE[t?"unshift":"push"]((()=>{u=t,n(1,u)}))}]}class aMt extends QE{constructor(t){super(),JE(this,t,oMt,rMt,gT,{slider:1,range:2,pushy:44,min:3,max:4,step:5,values:0,vertical:6,float:7,reversed:8,hoverable:9,disabled:10,pips:11,pipstep:12,all:13,first:14,last:15,rest:16,id:17,prefix:18,suffix:19,formatter:20,handleFormatter:21,precision:45,springValues:46},null,[-1,-1,-1])}}function lMt(t){let e,n;return e=new aMt({props:{values:t[12],min:t[13],max:t[14],step:t[15],range:t[5],float:t[6],vertical:t[7],pips:t[8],pipstep:t[9],formatter:t[10],all:"label",springValues:{stiffness:.2,damping:.8}}}),e.$on("stop",t[16]),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};4096&n&&(r.values=t[12]),8192&n&&(r.min=t[13]),16384&n&&(r.max=t[14]),32768&n&&(r.step=t[15]),32&n&&(r.range=t[5]),64&n&&(r.float=t[6]),128&n&&(r.vertical=t[7]),256&n&&(r.pips=t[8]),512&n&&(r.pipstep=t[9]),1024&n&&(r.formatter=t[10]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function cMt(t){let e,n,r;function i(e){t[17](e)}let s={min:t[13],max:t[14],step:t[15],range:t[5],float:t[6],vertical:t[7],pips:t[8],pipstep:t[9],formatter:t[10],all:"label",springValues:{stiffness:.2,damping:.8}};return void 0!==t[12]&&(s.values=t[12]),e=new aMt({props:s}),bE.push((()=>XE(e,"values",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};8192&r&&(i.min=t[13]),16384&r&&(i.max=t[14]),32768&r&&(i.step=t[15]),32&r&&(i.range=t[5]),64&r&&(i.float=t[6]),128&r&&(i.vertical=t[7]),256&r&&(i.pips=t[8]),512&r&&(i.pipstep=t[9]),1024&r&&(i.formatter=t[10]),!n&&4096&r&&(n=!0,i.values=t[12],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function uMt(t){let e,n,r,i;const s=[cMt,lMt],o=[];function a(t,e){return t[11]?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=jT()},m(t,n){o[e].m(t,n),LT(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(LE(),zE(o[l],1,1,(()=>{o[l]=null})),DE(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),FE(n,1),n.m(r.parentNode,r))},i(t){i||(FE(n),i=!0)},o(t){zE(n),i=!1},d(t){o[e].d(t),t&&DT(r)}}}function hMt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[uMt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),327648&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function dMt(t,e,n){let r,i,s,o,a=uT,l=()=>(a(),a=vT(g,(t=>n(12,r=t))),g),c=uT,u=()=>(c(),c=vT(y,(t=>n(13,i=t))),y),h=uT,d=()=>(h(),h=vT(b,(t=>n(14,s=t))),b),p=uT,f=()=>(p(),p=vT(v,(t=>n(15,o=t))),v);t.$$.on_destroy.push((()=>a())),t.$$.on_destroy.push((()=>c())),t.$$.on_destroy.push((()=>h())),t.$$.on_destroy.push((()=>p()));let{title:m}=e,{values:g}=e;l();let{min:y}=e;u();let{max:b}=e;d();let{step:v}=e;f();let{range:x}=e,{float:w}=e,{vertical:S}=e,{pips:_}=e,{pipstep:k}=e,{formatter:T}=e,{continuous:E}=e;return t.$$set=t=>{"title"in t&&n(0,m=t.title),"values"in t&&l(n(1,g=t.values)),"min"in t&&u(n(2,y=t.min)),"max"in t&&d(n(3,b=t.max)),"step"in t&&f(n(4,v=t.step)),"range"in t&&n(5,x=t.range),"float"in t&&n(6,w=t.float),"vertical"in t&&n(7,S=t.vertical),"pips"in t&&n(8,_=t.pips),"pipstep"in t&&n(9,k=t.pipstep),"formatter"in t&&n(10,T=t.formatter),"continuous"in t&&n(11,E=t.continuous)},[m,g,y,b,v,x,w,S,_,k,T,E,r,i,s,o,function({detail:t}){g.set(t.values)},function(t){r=t,g.set(r)}]}class pMt extends QE{constructor(t){super(),JE(this,t,dMt,hMt,gT,{title:0,values:1,min:2,max:3,step:4,range:5,float:6,vertical:7,pips:8,pipstep:9,formatter:10,continuous:11})}}class fMt extends SU{constructor({values:t=[.2],min:e=0,max:n=1,step:r=.01,range:i="min",float:s=!0,vertical:o=!1,pips:a=!1,pipstep:l,formatter:c=(t=>function(t,e){if(void 0===e||0==+e)return Math.round(t);let n=+t;const r=+e;if(isNaN(n)||"number"!=typeof r||r%1!=0)return NaN;let i=n.toString().split("e");return n=Math.round(+(i[0]+"e"+(i[1]?+i[1]+r:r))),i=n.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]-r:-r))}(t,3)),continuous:u=!0}={}){super(),this.title="slider",this.$values=new rU(t,!0),this.$min=new rU(e,!0),this.$max=new rU(n,!0),this.$step=new rU(r,!0),this.range=i,this.float=s,this.vertical=o,this.pips=a,this.pipstep=void 0!==l?l:Math.floor((n-e)/(10*r)),this.formatter=c,this.continuous=u,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new pMt({target:e,props:{title:this.title,values:this.$values,min:this.$min,max:this.$max,step:this.$step,range:this.range,float:this.float,vertical:this.vertical,pips:this.pips,pipstep:this.pipstep,formatter:this.formatter,continuous:this.continuous}}))}}function mMt(...t){return new fMt(...t)}function gMt(t){let e,n,r,i;return{c(){e=zT("div"),n=zT("textarea"),GT(n,"class","w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none svelte-1nngj94"),GT(n,"placeholder",t[2]),n.disabled=t[4],GT(e,"class","w-full svelte-1nngj94")},m(s,o){LT(s,e,o),RT(e,n),YT(n,t[5]),r||(i=WT(n,"input",t[6]),r=!0)},p(t,e){4&e&&GT(n,"placeholder",t[2]),16&e&&(n.disabled=t[4]),32&e&&YT(n,t[5])},d(t){t&&DT(e),r=!1,i()}}}function yMt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[gMt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),180&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function bMt(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(d,(t=>n(4,r=t))),d),a=uT,l=()=>(a(),a=vT(u,(t=>n(5,i=t))),u);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;l();let{placeholder:h}=e,{disabled:d}=e;return o(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&l(n(1,u=t.value)),"placeholder"in t&&n(2,h=t.placeholder),"disabled"in t&&o(n(3,d=t.disabled))},[c,u,h,d,r,i,function(){i=this.value,u.set(i)}]}class vMt extends QE{constructor(t){super(),JE(this,t,bMt,yMt,gT,{title:0,value:1,placeholder:2,disabled:3})}}class xMt extends SU{constructor(t="",e=""){super(),this.title="text area",this.$disabled=new rU(!1,!0),this.$value=new rU(t,!0),this.placeholder=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new vMt({target:e,props:{title:this.title,value:this.$value,placeholder:this.placeholder,disabled:this.$disabled}}))}}function wMt(...t){return new xMt(...t)}function SMt(t){let e,n,r,i,s;function o(e){t[5](e)}let a={type:"text",placeholder:"Enter a label..",disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new sM({props:a}),bE.push((()=>XE(r,"value",o))),{c(){e=zT("div"),n=zT("div"),YE(r.$$.fragment),GT(n,"class","md:flex md:items-center mb-2"),GT(e,"class","w-full max-w-sm")},m(t,i){LT(t,e,i),RT(e,n),KE(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],EE((()=>i=!1))),r.$set(n)},i(t){s||(FE(r.$$.fragment,t),s=!0)},o(t){zE(r.$$.fragment,t),s=!1},d(t){t&&DT(e),ZE(r)}}}function _Mt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[SMt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function kMt(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(u,(t=>n(3,r=t))),u),a=uT,l=()=>(a(),a=vT(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}class TMt extends QE{constructor(t){super(),JE(this,t,kMt,_Mt,gT,{title:0,value:1,disabled:2})}}class EMt extends SU{constructor(t){super(),this.title="text input",this.$value=new rU("",!0),this.$disabled=new rU(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new TMt({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function MMt(...t){return new EMt(...t)}function CMt(){const t=new Error("textField has been renamed to textInput");return t.name="Deprecation Notice",hU(t),MMt()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AMt(t){let e;return{c(){e=zT("p"),e.textContent="No model loaded"},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function NMt(t){let e,n,r,i;return{c(){e=zT("p"),n=UT("Model Loaded from "),r=UT(t[2]),i=UT(".")},m(t,s){LT(t,e,s),RT(e,n),RT(e,r),RT(e,i)},p(t,e){4&e&&XT(r,t[2])},d(t){t&&DT(e)}}}function IMt(t){let e;return{c(){e=zT("p"),e.textContent="Loading Model..."},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function $Mt(t){let e;function n(t,e){return"loading"===t[3]?IMt:"loaded"===t[3]?NMt:AMt}let r=n(t),i=r(t);return{c(){e=zT("div"),i.c(),GT(e,"class","p-2 text-sm text-gray-600")},m(t,n){LT(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&DT(e),i.d()}}}function RMt(t){let e,n;return e=new zL({props:{title:t[0],loading:"loading"===t[3],$$slots:{default:[$Mt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading="loading"===t[3]),268&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function OMt(t,e,n){let r,i,s,o=uT,a=()=>(o(),o=vT(d,(t=>n(7,s=t))),d);var l,c,u;t.$$.on_destroy.push((()=>o()));let{title:h}=e,{training:d}=e;return a(),t.$$set=t=>{"title"in t&&n(0,h=t.title),"training"in t&&a(n(1,d=t.training))},t.$$.update=()=>{128&t.$$.dirty&&n(3,r=s.status),240&t.$$.dirty&&n(2,i=(null===n(4,l=s.data)||void 0===l?void 0:l.source)?"datastore"===s.data.source?`datastore at ${null===n(5,c=s.data)||void 0===c?void 0:c.url}`:"url"===s.data.source?`url ${null===n(6,u=s.data)||void 0===u?void 0:u.url}`:"files":"unknown source")},[h,d,i,r,l,c,u,s]}Se().prototype.mul=function(t){return this.throwIfDisposed(),Si(this,t)};class PMt extends QE{constructor(t){super(),JE(this,t,OMt,RMt,gT,{title:0,training:1})}}function LMt(t,e){return t===e}function DMt(t,e){return t===e}class FMt extends Z2{constructor({inputType:t,taskType:e,segmentationOptions:n={applyArgmax:!1,output:"image"}}){super(),this.title="tfjs model",this.parameters={},this.segmentationOptions={applyArgmax:!1,output:"image",...n},this.inputType=t,this.taskType=e,this.$training.subscribe((({status:t})=>{"loaded"===t&&(this.inputShape=this.model.inputs[0].shape.map((t=>t&&t>0?t:1)))}))}train(){throw new uU("Model `TfModel` cannot be trained")}async predict(t){if(!this.model||"loaded"!==this.$training.get().status)throw new Error("Model is not loaded");const e=xr((()=>{const e=this.preprocess(t);return this.model.predict(e.expandDims(0)).gather(0)})),n=await this.postprocess(e);return e.dispose(),n}preprocess(t){if(LMt(this.inputType,"image"))return this.preprocessImage(t);if(LMt(this.inputType,"generic"))return rn(t);throw new Error("Invalid input data type")}preprocessImage(t){return Kc.resizeBilinear(Ur(t),[this.inputShape[1],this.inputShape[2]])}async postprocess(t){if(DMt(this.taskType,"classification")){const e=this.labels?t=>this.labels[t]:t=>t.toString(),n=xr((()=>t.argMax().dataSync()[0])),r=t.arraySync().reduce(((t,n,r)=>({...t,[e(r)]:n})),{});return{label:e(n),confidences:r}}if(DMt(this.taskType,"segmentation")){const[e,n]=t.shape,r=this.segmentationOptions.applyArgmax?xr((()=>t.argMax(-1).mul(.5))):t,i="image"===this.segmentationOptions.output?new ImageData(await Br(r),e,n):await r.array();return this.segmentationOptions.applyArgmax&&r.dispose(),i}if(DMt(this.taskType,"generic"))return t.array();throw new Error("Invalid output data type")}async loadFromFiles(t){this.$training.set({status:"loading"});try{const e=t.filter((t=>t.name.includes(".json"))),n=t.filter((t=>t.name.includes(".bin")));if(1!==e.length){const t=new Error("The provided files are not compatible with this model");throw t.name="File upload error",t}if(this.$training.set({status:"loading"}),t.length){const t=await Nq(e[0]);this.loadFn="graph-model"===t.format?jY:U0,this.model=await this.loadFn(K2([e[0],...n])),await this.warmup(),this.$training.set({status:"loaded",data:{source:"file"}})}}catch(t){throw this.$training.set({status:"error"}),t}}async loadFromUrl(t){this.$training.set({status:"loading"});try{const e=await fetch(t).then((t=>t.json()));this.loadFn="graph-model"===e.format?jY:U0,this.model=await this.loadFn(Y2(t)),await this.warmup(),this.$training.set({status:"loaded",data:{source:"url",url:t}})}catch(t){throw console.log("[tf-model] Loading error",t),this.$training.set({status:"error"}),t}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new PMt({target:e,props:{title:this.title,training:this.$training}}))}}function zMt(t){return new FMt(t)}function BMt(t){let e,n,r;function i(e){t[7](e)}let s={disabled:t[5],text:t[6]};return void 0!==t[4]&&(s.checked=t[4]),e=new ZM({props:s}),bE.push((()=>XE(e,"checked",i))),{c(){YE(e.$$.fragment)},m(t,n){KE(e,t,n),r=!0},p(t,r){const i={};32&r&&(i.disabled=t[5]),64&r&&(i.text=t[6]),!n&&16&r&&(n=!0,i.checked=t[4],EE((()=>n=!1))),e.$set(i)},i(t){r||(FE(e.$$.fragment,t),r=!0)},o(t){zE(e.$$.fragment,t),r=!1},d(t){ZE(e,t)}}}function UMt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[BMt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),368&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function VMt(t,e,n){let r,i,s,o=uT,a=()=>(o(),o=vT(f,(t=>n(4,r=t))),f),l=uT,c=()=>(l(),l=vT(m,(t=>n(5,i=t))),m),u=uT,h=()=>(u(),u=vT(p,(t=>n(6,s=t))),p);t.$$.on_destroy.push((()=>o())),t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u()));let{title:d}=e,{text:p}=e;h();let{checked:f}=e;a();let{disabled:m}=e;return c(),t.$$set=t=>{"title"in t&&n(0,d=t.title),"text"in t&&h(n(1,p=t.text)),"checked"in t&&a(n(2,f=t.checked)),"disabled"in t&&c(n(3,m=t.disabled))},[d,p,f,m,r,i,s,function(t){r=t,f.set(r)}]}jB([cU],FMt.prototype,"train",null),jB([cU],FMt.prototype,"predict",null),jB([cU],FMt.prototype,"preprocess",null),jB([cU],FMt.prototype,"preprocessImage",null),jB([cU],FMt.prototype,"postprocess",null),jB([cU],FMt.prototype,"loadFromFiles",null),jB([cU],FMt.prototype,"loadFromUrl",null);class jMt extends QE{constructor(t){super(),JE(this,t,VMt,UMt,gT,{title:0,text:1,checked:2,disabled:3})}}class WMt extends SU{constructor(t="toggle me"){super(),this.title="toggle",this.$checked=new rU(!1,!0),this.$disabled=new rU(!1,!0),this.$text=new rU(t,!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new jMt({target:e,props:{title:this.title,text:this.$text,checked:this.$checked,disabled:this.$disabled}}))}}function HMt(...t){return new WMt(...t)}function GMt(t){let e;return{c(){e=zT("div"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> \n    <p>Select one or several runs to display information</p>',GT(e,"class","empty svelte-yj1ygt")},m(t,n){LT(t,e,n)},p:uT,i:uT,o:uT,d(t){t&&DT(e)}}}function qMt(t){let e,n;return e=new ML({props:{columns:[{name:"field"},...t[2]],provider:t[1],selectable:!1}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.columns=[{name:"field"},...t[2]]),2&n&&(r.provider=t[1]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function XMt(t){let e,n,r,i;const s=[qMt,GMt],o=[];function a(t,e){return t[0].length>0?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=jT()},m(t,n){o[e].m(t,n),LT(t,r,n),i=!0},p(t,[i]){let l=e;e=a(t),e===l?o[e].p(t,i):(LE(),zE(o[l],1,1,(()=>{o[l]=null})),DE(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),FE(n,1),n.m(r.parentNode,r))},i(t){i||(FE(n),i=!0)},o(t){zE(n),i=!1},d(t){o[e].d(t),t&&DT(r)}}}function YMt(t,e,n){let r,i,s,o,{runs:a}=e;return t.$$set=t=>{"runs"in t&&n(0,a=t.runs)},t.$$.update=()=>{1&t.$$.dirty&&n(2,r=a.map(((t,e)=>({name:`Run ${e+1}`})))),1&t.$$.dirty&&n(4,i=a.length>0?Object.keys(a[0]).filter((t=>"logs"!==t)):[]),17&t.$$.dirty&&n(3,s=i.map((t=>a.map(((e,n)=>({[`Run ${n+1}`]:e[t]}))).reduce(((t,e)=>({...t,...e})),{field:t})))),8&t.$$.dirty&&n(1,o=new RL({data:s}))},[a,o,r,s,i]}class KMt extends QE{constructor(t){super(),JE(this,t,YMt,XMt,gT,{runs:0})}}function ZMt(t,e,n){const r=t.slice();return r[5]=e[n],r[6]=e,r[7]=n,r}function JMt(t){let e,n=t[7];const r=()=>t[3](e,n),i=()=>t[3](null,n);return{c(){e=zT("div"),GT(e,"class","card inner-card xl:flex-1 svelte-1o4ebpu")},m(t,n){LT(t,e,n),r()},p(e,s){n!==(t=e)[7]&&(i(),n=t[7],r())},d(t){t&&DT(e),i()}}}function QMt(t){let e,n=Object.values(t[0]),r=[];for(let e=0;e<n.length;e+=1)r[e]=JMt(ZMt(t,n,e));return{c(){e=zT("div");for(let t=0;t<r.length;t+=1)r[t].c();GT(e,"class","grid grid-cols-1 gap-1")},m(n,i){LT(n,e,i);for(let t=0;t<r.length;t+=1)r[t].m(e,null);t[4](e)},p(t,[i]){if(5&i){let s;for(n=Object.values(t[0]),s=0;s<n.length;s+=1){const o=ZMt(t,n,s);r[s]?r[s].p(o,i):(r[s]=JMt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},i:uT,o:uT,d(n){n&&DT(e),FT(r,n),t[4](null)}}}function tCt(t,e,n){let r,{charts:i}=e,s=[];return hE((async()=>{await kE(),await kE(),Object.keys(i).length>1&&r.clientWidth>700&&n(1,r.style.gridTemplateColumns="repeat(2, minmax(0, 1fr))",r);for(const[t,e]of Object.values(i).entries())e.mount(s[t])})),pE((()=>{for(const t of Object.values(i))t.destroy()})),t.$$set=t=>{"charts"in t&&n(0,i=t.charts)},[i,r,s,function(t,e){bE[t?"unshift":"push"]((()=>{s[e]=t,n(2,s)}))},function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class eCt extends QE{constructor(t){super(),JE(this,t,tCt,QMt,gT,{charts:0})}}class nCt extends SU{constructor(t,e={loss:["loss","lossVal"],accuracy:["acc","accVal"]}){if(super(),this.model=t,this.title="training plot",this.charts={},!t){const t=new Error("[training plot] No model was provided");t.name="Component Compatibility Error",hU(t)}if(!t.$training){const t=new Error("[training plot] The provided model is incompatible with the training plot component, missing `$training` stream");t.name="Component Compatibility Error",hU(t)}let n=e;"string"==typeof e&&(n=[e]),Array.isArray(n)&&(n=n.reduce(((t,e)=>({...t,[e]:e})),{}));const r={};for(const[t,e]of Object.entries(n)){const n=Array.isArray(e)?e:[e];this.charts[t]=_st({preset:"line-fast",options:{xlabel:"Epoch",ylabel:t}});for(const e of n)Object.keys(r).includes(e)||(r[e]=new rU([],!0)),this.charts[t].addSeries(r[e],e);this.charts[t].title=t}t.$training.subscribe((t=>{if("start"===t.status)!function(){for(const t of Object.values(r))t.set([])}();else if(t.data)for(const[e,n]of Object.entries(t.data)){if(!Object.keys(r).includes(e))return;Array.isArray(n)?r[e].set(n.map(((t,e)=>({x:e+1,y:t})))):r[e].set(r[e].get().concat([{x:r[e].get().length+1,y:n}]))}})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new eCt({target:e,props:{charts:this.charts}}))}}function rCt(...t){return new nCt(...t)}function iCt(t){let e;return{c(){e=zT("div"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> \n    <p>Select one or several runs to display information</p>',GT(e,"class","empty svelte-yj1ygt")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function sCt(t){let e;return{c(){e=zT("div")},m(n,r){LT(n,e,r),t[7](e)},p:uT,d(n){n&&DT(e),t[7](null)}}}function oCt(t){let e;function n(t,e){return t[0].length>0?sCt:iCt}let r=n(t),i=r(t);return{c(){i.c(),e=jT()},m(t,n){i.m(t,n),LT(t,e,n)},p(t,[s]){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},i:uT,o:uT,d(t){i.d(t),t&&DT(e)}}}function aCt(t,e,n){let r,i,s,o,a,{names:l}=e,{logs:c}=e;return pE((()=>{a&&a.destroy()})),t.$$set=t=>{"names"in t&&n(2,l=t.names),"logs"in t&&n(0,c=t.logs)},t.$$.update=()=>{9&t.$$.dirty&&(n(3,o=Array.from(new Set(c.map(Object.keys).flat()))),o.sort()),5&t.$$.dirty&&n(6,r=c.map(((t,e)=>Object.entries(t).reduce(((t,[n,r])=>({...t,[`${n} (${l[e]})`]:r})),{}))).reduce(((t,e)=>({...t,...e})),{})),72&t.$$.dirty&&n(5,i=o.reduce(((t,e)=>({...t,[e]:Object.keys(r).filter((t=>t.startsWith(`${e} (`)))})),{})),114&t.$$.dirty&&(a&&a.destroy(),n(4,a=rCt({$training:new rU({status:"success",data:r},!0)},i)),a.mount(s))},[c,s,l,o,a,i,r,function(t){bE[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}class lCt extends QE{constructor(t){super(),JE(this,t,aCt,oCt,gT,{names:2,logs:0})}}function cCt(t,e,n){const r=t.slice();return r[13]=e[n],r[15]=n,r}function uCt(t){let e;return{c(){e=UT("Graphs")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function hCt(t){let e;return{c(){e=UT("Metadata")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function dCt(t){let e;return{c(){e=UT("Parameters")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function pCt(t){let e;return{c(){e=UT("Model Summary")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function fCt(t){let e,n,r,i,s,o,a,l;return e=new oC({props:{$$slots:{default:[uCt]},$$scope:{ctx:t}}}),r=new oC({props:{$$slots:{default:[hCt]},$$scope:{ctx:t}}}),s=new oC({props:{$$slots:{default:[dCt]},$$scope:{ctx:t}}}),a=new oC({props:{$$slots:{default:[pCt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment),n=VT(),YE(r.$$.fragment),i=VT(),YE(s.$$.fragment),o=VT(),YE(a.$$.fragment)},m(t,c){KE(e,t,c),LT(t,n,c),KE(r,t,c),LT(t,i,c),KE(s,t,c),LT(t,o,c),KE(a,t,c),l=!0},p(t,n){const i={};65536&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const o={};65536&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const l={};65536&n&&(l.$$scope={dirty:n,ctx:t}),s.$set(l);const c={};65536&n&&(c.$$scope={dirty:n,ctx:t}),a.$set(c)},i(t){l||(FE(e.$$.fragment,t),FE(r.$$.fragment,t),FE(s.$$.fragment,t),FE(a.$$.fragment,t),l=!0)},o(t){zE(e.$$.fragment,t),zE(r.$$.fragment,t),zE(s.$$.fragment,t),zE(a.$$.fragment,t),l=!1},d(t){ZE(e,t),t&&DT(n),ZE(r,t),t&&DT(i),ZE(s,t),t&&DT(o),ZE(a,t)}}}function mCt(t){let e,n;return e=new lCt({props:{logs:t[4].map(kCt),names:t[4].map(TCt)}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.logs=t[4].map(kCt)),16&n&&(r.names=t[4].map(TCt)),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function gCt(t){let e,n;return e=new KMt({props:{runs:t[4]}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.runs=t[4]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function yCt(t){let e,n;return e=new KMt({props:{runs:t[4].map(ECt)}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.runs=t[4].map(ECt)),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function bCt(t){let e,n,r,i,s,o,a,l,c,u,h=t[15]+1+"",d=t[13]+"";return{c(){e=zT("div"),n=zT("h2"),r=UT("Model "),i=UT(h),s=VT(),o=zT("div"),a=zT("pre"),l=UT(d),c=zT("br"),u=VT(),GT(o,"class","summary svelte-y4izzs")},m(t,h){LT(t,e,h),RT(e,n),RT(n,r),RT(n,i),RT(e,s),RT(e,o),RT(o,a),RT(a,l),RT(a,c),RT(e,u)},p(t,e){16&e&&d!==(d=t[13]+"")&&XT(l,d)},d(t){t&&DT(e)}}}function vCt(t){let e,n=t[4].map(MCt),r=[];for(let e=0;e<n.length;e+=1)r[e]=bCt(cCt(t,n,e));return{c(){e=zT("div");for(let t=0;t<r.length;t+=1)r[t].c();GT(e,"class","summaries svelte-y4izzs")},m(t,n){LT(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,i){if(16&i){let s;for(n=t[4].map(MCt),s=0;s<n.length;s+=1){const o=cCt(t,n,s);r[s]?r[s].p(o,i):(r[s]=bCt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&DT(e),FT(r,t)}}}function xCt(t){let e,n,r,i,s,o,a,l,c,u;return e=new NL({props:{$$slots:{default:[fCt]},$$scope:{ctx:t}}}),r=new uC({props:{$$slots:{default:[mCt]},$$scope:{ctx:t}}}),s=new uC({props:{$$slots:{default:[gCt]},$$scope:{ctx:t}}}),a=new uC({props:{$$slots:{default:[yCt]},$$scope:{ctx:t}}}),c=new uC({props:{$$slots:{default:[vCt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment),n=VT(),YE(r.$$.fragment),i=VT(),YE(s.$$.fragment),o=VT(),YE(a.$$.fragment),l=VT(),YE(c.$$.fragment)},m(t,h){KE(e,t,h),LT(t,n,h),KE(r,t,h),LT(t,i,h),KE(s,t,h),LT(t,o,h),KE(a,t,h),LT(t,l,h),KE(c,t,h),u=!0},p(t,n){const i={};65536&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const o={};65552&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const l={};65552&n&&(l.$$scope={dirty:n,ctx:t}),s.$set(l);const u={};65552&n&&(u.$$scope={dirty:n,ctx:t}),a.$set(u);const h={};65552&n&&(h.$$scope={dirty:n,ctx:t}),c.$set(h)},i(t){u||(FE(e.$$.fragment,t),FE(r.$$.fragment,t),FE(s.$$.fragment,t),FE(a.$$.fragment,t),FE(c.$$.fragment,t),u=!0)},o(t){zE(e.$$.fragment,t),zE(r.$$.fragment,t),zE(s.$$.fragment,t),zE(a.$$.fragment,t),zE(c.$$.fragment,t),u=!1},d(t){ZE(e,t),t&&DT(n),ZE(r,t),t&&DT(i),ZE(s,t),t&&DT(o),ZE(a,t),t&&DT(l),ZE(c,t)}}}function wCt(t){let e,n,r,i,s,o,a;function l(e){t[10](e)}let c={columns:t[7],provider:t[6],actions:[...t[1].map(_Ct),{name:"delete",confirm:!0}]};return void 0!==t[4]&&(c.selection=t[4]),e=new ML({props:c}),bE.push((()=>XE(e,"selection",l))),t[11](e),e.$on("select",t[12]),o=new rC({props:{$$slots:{default:[xCt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment),r=VT(),i=zT("br"),s=VT(),YE(o.$$.fragment)},m(t,n){KE(e,t,n),LT(t,r,n),LT(t,i,n),LT(t,s,n),KE(o,t,n),a=!0},p(t,r){const i={};2&r&&(i.actions=[...t[1].map(_Ct),{name:"delete",confirm:!0}]),!n&&16&r&&(n=!0,i.selection=t[4],EE((()=>n=!1))),e.$set(i);const s={};65552&r&&(s.$$scope={dirty:r,ctx:t}),o.$set(s)},i(t){a||(FE(e.$$.fragment,t),FE(o.$$.fragment,t),a=!0)},o(t){zE(e.$$.fragment,t),zE(o.$$.fragment,t),a=!1},d(n){t[11](null),ZE(e,n),n&&DT(r),n&&DT(i),n&&DT(s),ZE(o,n)}}}function SCt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[wCt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),65562&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}const _Ct=t=>"string"==typeof t?{name:t}:t,kCt=t=>t.logs,TCt=t=>t.name,ECt=t=>t.params,MCt=t=>t.model?.summary||"No summary available";function CCt(t,e,n){let r,i=uT,s=()=>(i(),i=vT(u,(t=>n(4,r=t))),u);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{service:a}=e,{metrics:l}=e,{actions:c}=e,{selection:u}=e;s();const h=fE(),d=new OL({service:a,transform:{...l.reduce(((t,e)=>({...t,[e]:t=>e in t.logs?t.logs[e][t.logs[e].length-1]:"metrics not found"})),{}),...c.reduce(((t,e)=>({...t,["string"==typeof e?e:e.name]:()=>"string"==typeof e?e:e.name})),{})}});d.data.subscribe((()=>{u.set([])}));const p=[{name:"name",sortable:!0},{name:"start",sortable:!0,type:"date"},...l.map((t=>({name:t}))),{name:"epochs"},{name:"status"},...c.map((t=>({name:"string"==typeof t?t:t.name,type:"action"})))];let f;hE((async()=>{await kE(),await kE();for(const t of c){const e="string"==typeof t?t:t.name;f.$on(e,(({detail:t})=>{h(e,t)}))}}));return t.$$set=t=>{"title"in t&&n(0,o=t.title),"service"in t&&n(8,a=t.service),"metrics"in t&&n(9,l=t.metrics),"actions"in t&&n(1,c=t.actions),"selection"in t&&s(n(2,u=t.selection))},[o,c,u,f,r,h,d,p,a,l,function(t){r=t,u.set(r)},function(t){bE[t?"unshift":"push"]((()=>{f=t,n(3,f)}))},({detail:t})=>h("load",t)]}class ACt extends QE{constructor(t){super(),JE(this,t,CCt,SCt,gT,{title:0,service:8,metrics:9,actions:1,selection:2})}}function NCt(t,e){const n={...t};for(const[t,r]of Object.entries(e))n[t]=(n[t]||[]).concat([r]);return n}const ICt={metrics:["accuracy","accuracyVal","loss","lossVal"],actions:[]};class $Ct extends SU{constructor(t,e={}){super(),this.dataStore=t,this.title="Training History",this.$selection=new rU([],!0),this.$actions=new rU(null).skip(1),this.ready=Promise.resolve(),this.stopTracking=QB,this.lock=Promise.resolve(),this.options={...ICt,...e},this.lock=this.lock.then(QB),this.start(),this.ready=this.ready.then((()=>this.dataStore.connect())).then((()=>{this.runService=this.dataStore.service("runs")})).catch((()=>{aU.log("[dataset] dataStore connection failed")}))}track(t,e="anonymous"){return this.ready.then((()=>(this.stopTracking(),this.model=t,this.modelName=e,this.runService.find({query:{basename:e,$sort:{createdAt:-1},$select:["name"],$limit:1}})))).then((({data:t})=>t.length>0?parseInt(t[0].name.split(`${e}-`)[1])+1:1)).then((t=>{this.nextIndex=t,this.crtRun=null,this.stopTracking=this.model?this.model.$training.subscribe(this.trackTrainingStream):QB})),this}async trackTrainingStream(t){if("start"===t.status)this.crtRun=await this.runService.create({name:`${this.modelName}-${this.nextIndex++}`,basename:this.modelName,start:new Date(Date.now()).toISOString(),source:"js",status:t.status,epochs:t.epochs,params:Object.entries(this.model.parameters).map((([t,e])=>({[t]:e.get()}))).reduce(((t,e)=>({...t,...e})),{}),logs:{}});else if("epoch"===t.status)this.runService.patch(this.crtRun.id,{status:t.status,epoch:t.epoch,logs:NCt(this.crtRun.logs,t.data)});else if("success"===t.status){const e=await this.model.save(this.dataStore,this.modelName,{});this.runService.patch(this.crtRun.id,{status:t.status,epoch:t.epoch,logs:t.data,checkpoints:(this.crtRun.checkpoints||[]).concat([{id:e,name:`${this.crtRun.name}@final`,service:this.model.serviceName}])})}else"error"===t.status&&this.runService.patch(this.crtRun.id,{status:t.status})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.ready.then((()=>{this.$$.app=new ACt({target:e,props:{title:this.title,service:this.runService,metrics:this.options.metrics,actions:this.options.actions,selection:this.$selection}});for(const t of this.options.actions){const e="string"==typeof t?t:t.name;this.$$.app.$on(e,(({detail:t})=>{this.$actions.set({name:e,data:t})}))}})))}}var RCt;function OCt(...t){return new $Ct(...t)}jB([(RCt="lock",function(t,e,n){const r=n.value;return n.value=function(...t){const e=this[RCt].then((()=>r.apply(this,t)));return this[RCt]=e,e},n})],$Ct.prototype,"trackTrainingStream",null);var PCt={},LCt={},DCt={},FCt={},zCt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}};function BCt(t,e){return Math.floor(e()*t)}function UCt(t){for(var e=[],n=0;n<t;n++)e.push(void 0);return e}function VCt(t,e){return UCt(t).map((function(){return e}))}function jCt(t){return VCt(t,0)}function WCt(t){return t.reduce((function(t,e){return t+e}))}Object.defineProperty(FCt,"__esModule",{value:!0}),FCt.tauRandInt=BCt,FCt.tauRand=function(t){return t()},FCt.norm=function(t){var e,n,r=0;try{for(var i=zCt(t),s=i.next();!s.done;s=i.next()){var o=s.value;r+=Math.pow(o,2)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return Math.sqrt(r)},FCt.empty=UCt,FCt.range=function(t){return UCt(t).map((function(t,e){return e}))},FCt.filled=VCt,FCt.zeros=jCt,FCt.ones=function(t){return VCt(t,1)},FCt.linear=function(t,e,n){return UCt(n).map((function(r,i){return t+i*((e-t)/(n-1))}))},FCt.sum=WCt,FCt.mean=function(t){return WCt(t)/t.length},FCt.max=function(t){for(var e=0,n=0;n<t.length;n++)e=t[n]>e?t[n]:e;return e},FCt.max2d=function(t){for(var e=0,n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)e=t[n][r]>e?t[n][r]:e;return e},FCt.rejectionSample=function(t,e,n){for(var r=jCt(t),i=0;i<t;i++)for(var s=!0;s;){for(var o=BCt(e,n),a=!1,l=0;l<i;l++)if(o===r[l]){a=!0;break}a||(s=!1),r[i]=o}return r},FCt.reshape2d=function(t,e,n){var r=[],i=0;if(t.length!==e*n)throw new Error("Array dimensions must match input length.");for(var s=0;s<e;s++){for(var o=[],a=0;a<n;a++)o.push(t[i]),i+=1;r.push(o)}return r};var HCt=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(DCt,"__esModule",{value:!0});var GCt=HCt(FCt);function qCt(t,e){var n=function(n){return GCt.empty(t).map((function(){return GCt.filled(e,n)}))},r=[];return r.push(n(-1)),r.push(n(1/0)),r.push(n(0)),r}function XCt(t,e,n,r,i){e=Math.floor(e);var s=t[0][e],o=t[1][e];if(t[2][e],n>=o[0])return 0;for(var a=0;a<s.length;a++)if(r===s[a])return 0;return YCt(t,e,n,r,i)}function YCt(t,e,n,r,i){var s=t[0][e],o=t[1][e],a=t[2][e];if(n>=o[0])return 0;o[0]=n,s[0]=r,a[0]=i;for(var l=0,c=0;;){var u=2*l+1,h=u+1,d=t[0][0].length;if(u>=d)break;if(h>=d){if(!(o[u]>n))break;c=u}else if(o[u]>=o[h]){if(!(n<o[u]))break;c=u}else{if(!(n<o[h]))break;c=h}o[l]=o[c],s[l]=s[c],a[l]=a[c],l=c}return o[l]=n,s[l]=r,a[l]=i,1}function KCt(t,e,n,r){for(;2*r+1<n;){var i=2*r+1,s=i+1,o=r;if(t[o]<t[i]&&(o=i),s<n&&t[o]<t[s]&&(o=s),o===r)break;var a=t[r];t[r]=t[o],t[o]=a;var l=e[r];e[r]=e[o],e[o]=l,r=o}}DCt.makeHeap=qCt,DCt.rejectionSample=function(t,e,n){for(var r=GCt.zeros(t),i=0;i<t;i++){for(var s=!0,o=0;s;){o=GCt.tauRandInt(e,n);for(var a=!1,l=0;l<i;l++)if(o===r[l]){a=!0;break}a||(s=!1)}r[i]=o}return r},DCt.heapPush=XCt,DCt.uncheckedHeapPush=YCt,DCt.buildCandidates=function(t,e,n,r,i){for(var s=qCt(e,r),o=0;o<e;o++)for(var a=0;a<n;a++)if(!(t[0][o][a]<0)){var l=t[0][o][a],c=t[2][o][a],u=GCt.tauRand(i);XCt(s,o,u,l,c),XCt(s,l,u,o,c),t[2][o][a]=0}return s},DCt.deheapSort=function(t){for(var e=t[0],n=t[1],r=0;r<e.length;r++)for(var i=e[r],s=n[r],o=0;o<i.length-1;o++){var a=i.length-o-1,l=s.length-o-1,c=i[0];i[0]=i[a],i[a]=c;var u=s[0];s[0]=s[l],s[l]=u,KCt(s,i,l,0)}return{indices:e,weights:n}},DCt.smallestFlagged=function(t,e){for(var n=t[0][e],r=t[1][e],i=t[2][e],s=1/0,o=-1,a=0;a>n.length;a++)1===i[a]&&r[a]<s&&(s=r[a],o=a);return o>=0?(i[o]=0,Math.floor(n[o])):-1};var ZCt,JCt={},QCt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},tAt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},eAt=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(JCt,"__esModule",{value:!0});var nAt=eAt(FCt),rAt=function(){function t(t,e,n,r){if(this.entries=new Map,this.nRows=0,this.nCols=0,t.length!==e.length||t.length!==n.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=r[0],this.nCols=r[1];for(var i=0;i<n.length;i++){var s=t[i],o=e[i];this.checkDims(s,o);var a=this.makeKey(s,o);this.entries.set(a,{value:n[i],row:s,col:o})}}return t.prototype.makeKey=function(t,e){return t+":"+e},t.prototype.checkDims=function(t,e){if(!(t<this.nRows&&e<this.nCols))throw new Error("row and/or col specified outside of matrix dimensions")},t.prototype.set=function(t,e,n){this.checkDims(t,e);var r=this.makeKey(t,e);this.entries.has(r)?this.entries.get(r).value=n:this.entries.set(r,{value:n,row:t,col:e})},t.prototype.get=function(t,e,n){void 0===n&&(n=0),this.checkDims(t,e);var r=this.makeKey(t,e);return this.entries.has(r)?this.entries.get(r).value:n},t.prototype.getAll=function(t){void 0===t&&(t=!0);var e=[];return this.entries.forEach((function(t){e.push(t)})),t&&e.sort((function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row})),e},t.prototype.getDims=function(){return[this.nRows,this.nCols]},t.prototype.getRows=function(){return Array.from(this.entries,(function(t){var e=QCt(t,2);return e[0],e[1].row}))},t.prototype.getCols=function(){return Array.from(this.entries,(function(t){var e=QCt(t,2);return e[0],e[1].col}))},t.prototype.getValues=function(){return Array.from(this.entries,(function(t){var e=QCt(t,2);return e[0],e[1].value}))},t.prototype.forEach=function(t){this.entries.forEach((function(e){return t(e.value,e.row,e.col)}))},t.prototype.map=function(e){var n=[];this.entries.forEach((function(t){n.push(e(t.value,t.row,t.col))}));var r=[this.nRows,this.nCols];return new t(this.getRows(),this.getCols(),n,r)},t.prototype.toArray=function(){var t=this,e=nAt.empty(this.nRows).map((function(){return nAt.zeros(t.nCols)}));return this.entries.forEach((function(t){e[t.row][t.col]=t.value})),e},t}();JCt.SparseMatrix=rAt,JCt.transpose=function(t){var e=[],n=[],r=[];t.forEach((function(t,i,s){e.push(i),n.push(s),r.push(t)}));var i=[t.nCols,t.nRows];return new rAt(n,e,r,i)},JCt.identity=function(t){for(var e=QCt(t,1)[0],n=new rAt([],[],[],t),r=0;r<e;r++)n.set(r,r,1);return n},JCt.pairwiseMultiply=function(t,e){return sAt(t,e,(function(t,e){return t*e}))},JCt.add=function(t,e){return sAt(t,e,(function(t,e){return t+e}))},JCt.subtract=function(t,e){return sAt(t,e,(function(t,e){return t-e}))},JCt.maximum=function(t,e){return sAt(t,e,(function(t,e){return t>e?t:e}))},JCt.multiplyScalar=function(t,e){return t.map((function(t){return t*e}))},JCt.eliminateZeros=function(t){for(var e=new Set,n=t.getValues(),r=t.getRows(),i=t.getCols(),s=0;s<n.length;s++)0===n[s]&&e.add(s);var o=function(t,n){return!e.has(n)},a=n.filter(o),l=r.filter(o),c=i.filter(o);return new rAt(l,c,a,t.getDims())},JCt.normalize=function(t,e){var n,r;void 0===e&&(e="l2");var i=iAt[e],s=new Map;t.forEach((function(t,e,n){var r=s.get(e)||[];r.push(n),s.set(e,r)}));var o=new rAt([],[],[],t.getDims()),a=function(e){for(var n=s.get(e).sort(),r=n.map((function(n){return t.get(e,n)})),a=i(r),l=0;l<a.length;l++)o.set(e,n[l],a[l])};try{for(var l=tAt(s.keys()),c=l.next();!c.done;c=l.next()){a(c.value)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return o};var iAt=((ZCt={}).max=function(t){for(var e=-1/0,n=0;n<t.length;n++)e=t[n]>e?t[n]:e;return t.map((function(t){return t/e}))},ZCt.l1=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return t.map((function(t){return t/e}))},ZCt.l2=function(t){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n],2);return t.map((function(t){return Math.sqrt(Math.pow(t,2)/e)}))},ZCt);function sAt(t,e,n){for(var r=new Set,i=[],s=[],o=[],a=function(r,a){i.push(r),s.push(a);var l=n(t.get(r,a),e.get(r,a));o.push(l)},l=t.getValues(),c=t.getRows(),u=t.getCols(),h=0;h<l.length;h++){var d=(g=c[h])+":"+(y=u[h]);r.add(d),a(g,y)}var p=e.getValues(),f=e.getRows(),m=e.getCols();for(h=0;h<p.length;h++){var g,y;d=(g=f[h])+":"+(y=m[h]);r.has(d)||a(g,y)}var b=[t.nRows,t.nCols];return new rAt(i,s,o,b)}JCt.getCSR=function(t){var e=[];t.forEach((function(t,n,r){e.push({value:t,row:n,col:r})})),e.sort((function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row}));for(var n=[],r=[],i=[],s=-1,o=0;o<e.length;o++){var a=e[o],l=a.row,c=a.col,u=a.value;l!==s&&(s=l,i.push(o)),n.push(c),r.push(u)}return{indices:n,values:r,indptr:i}};var oAt={},aAt={},lAt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},cAt=yt&&yt.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(lAt(arguments[e]));return t},uAt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},hAt=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(aAt,"__esModule",{value:!0});var dAt=hAt(FCt),pAt=function(t,e,n,r){this.hyperplanes=t,this.offsets=e,this.children=n,this.indices=r};function fAt(t,e,n,r,i){if(void 0===n&&(n=30),e.length>n){var s=function(t,e,n){var r=t[0].length,i=dAt.tauRandInt(e.length,n),s=dAt.tauRandInt(e.length,n);s=(s+=i===s?1:0)%e.length;for(var o=e[i],a=e[s],l=0,c=dAt.zeros(r),u=0;u<c.length;u++)c[u]=t[o][u]-t[a][u],l-=c[u]*(t[o][u]+t[a][u])/2;var h=0,d=0,p=dAt.zeros(e.length);for(u=0;u<e.length;u++){for(var f=l,m=0;m<r;m++)f+=c[m]*t[e[u]][m];0===f?(p[u]=dAt.tauRandInt(2,n),0===p[u]?h+=1:d+=1):f>0?(p[u]=0,h+=1):(p[u]=1,d+=1)}var g=dAt.zeros(h),y=dAt.zeros(d);h=0,d=0;for(u=0;u<p.length;u++)0===p[u]?(g[h]=e[u],h+=1):(y[d]=e[u],d+=1);return{indicesLeft:g,indicesRight:y,hyperplane:c,offset:l}}(t,e,i),o=s.indicesLeft,a=s.indicesRight,l=s.hyperplane,c=s.offset;return{leftChild:fAt(t,o,n,r+1,i),rightChild:fAt(t,a,n,r+1,i),isLeaf:!1,hyperplane:l,offset:c}}return{indices:e,isLeaf:!0}}function mAt(t,e,n,r,i,s,o){var a;if(t.isLeaf)return r[s][0]=-o,(a=i[o]).splice.apply(a,cAt([0,t.indices.length],t.indices)),{nodeNum:s,leafNum:o+=1};e[s]=t.hyperplane,n[s]=t.offset,r[s][0]=s+1;var l=s,c=mAt(t.leftChild,e,n,r,i,s+1,o);return s=c.nodeNum,o=c.leafNum,r[l][1]=s+1,{nodeNum:(c=mAt(t.rightChild,e,n,r,i,s+1,o)).nodeNum,leafNum:c.leafNum}}function gAt(t){return t.isLeaf?1:1+gAt(t.leftChild)+gAt(t.rightChild)}function yAt(t){return t.isLeaf?1:yAt(t.leftChild)+yAt(t.rightChild)}function bAt(t,e,n,r){for(var i=e,s=0;s<n.length;s++)i+=t[s]*n[s];return 0===i?dAt.tauRandInt(2,r):i>0?0:1}aAt.FlatTree=pAt,aAt.makeForest=function(t,e,n,r){var i=Math.max(10,e),s=dAt.range(n).map((function(e,n){return function(t,e,n,r){void 0===e&&(e=30);var i=dAt.range(t.length);return fAt(t,i,e,n,r)}(t,i,n,r)})),o=s.map((function(t){return function(t,e){var n=gAt(t),r=yAt(t),i=dAt.range(n).map((function(){return dAt.zeros(t.hyperplane?t.hyperplane.length:0)})),s=dAt.zeros(n),o=dAt.range(n).map((function(){return[-1,-1]})),a=dAt.range(r).map((function(){return dAt.range(e).map((function(){return-1}))}));return mAt(t,i,s,o,a,0,0),new pAt(i,s,o,a)}(t,i)}));return o},aAt.makeLeafArray=function(t){var e,n;if(t.length>0){var r=[];try{for(var i=uAt(t),s=i.next();!s.done;s=i.next()){var o=s.value;r.push.apply(r,cAt(o.indices))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return[[-1]]},aAt.searchFlatTree=function(t,e,n){for(var r=0;e.children[r][0]>0;){r=0===bAt(e.hyperplanes[r],e.offsets[r],t,n)?e.children[r][0]:e.children[r][1]}var i=-1*e.children[r][0];return e.indices[i]};var vAt=yt&&yt.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},xAt=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(oAt,"__esModule",{value:!0});var wAt=xAt(DCt),SAt=xAt(JCt),_At=xAt(aAt),kAt=xAt(FCt);oAt.makeNNDescent=function(t,e){return function(n,r,i,s,o,a,l,c){void 0===s&&(s=10),void 0===o&&(o=50),void 0===a&&(a=.001),void 0===l&&(l=.5),void 0===c&&(c=!0);for(var u=n.length,h=wAt.makeHeap(n.length,i),d=0;d<n.length;d++)for(var p=wAt.rejectionSample(i,n.length,e),f=0;f<p.length;f++){var m=t(n[d],n[p[f]]);wAt.heapPush(h,d,m,p[f],1),wAt.heapPush(h,p[f],m,d,1)}if(c)for(var g=0;g<r.length;g++)for(d=0;d<r[g].length&&!(r[g][d]<0);d++)for(f=d+1;f<r[g].length&&!(r[g][f]<0);f++){m=t(n[r[g][d]],n[r[g][f]]);wAt.heapPush(h,r[g][d],m,r[g][f],1),wAt.heapPush(h,r[g][f],m,r[g][d],1)}for(g=0;g<s;g++){var y=wAt.buildCandidates(h,u,i,o,e),b=0;for(d=0;d<u;d++)for(f=0;f<o;f++){var v=Math.floor(y[0][d][f]);if(!(v<0||kAt.tauRand(e)<l))for(var x=0;x<o;x++){var w=Math.floor(y[0][d][x]),S=y[2][d][f],_=y[2][d][x];if(!(w<0||!S&&!_)){m=t(n[v],n[w]);b+=wAt.heapPush(h,v,m,w,1),b+=wAt.heapPush(h,w,m,v,1)}}}if(b<=a*i*n.length)break}return wAt.deheapSort(h)}},oAt.makeInitializations=function(t){return{initFromRandom:function(e,n,r,i,s){for(var o=0;o<r.length;o++)for(var a=kAt.rejectionSample(e,n.length,s),l=0;l<a.length;l++)if(!(a[l]<0)){var c=t(n[a[l]],r[o]);wAt.heapPush(i,o,c,a[l],1)}},initFromTree:function(e,n,r,i,s){for(var o=0;o<r.length;o++)for(var a=_At.searchFlatTree(r[o],e,s),l=0;l<a.length;l++){if(a[l]<0)return;var c=t(n[a[l]],r[o]);wAt.heapPush(i,o,c,a[l],1)}}}},oAt.makeInitializedNNSearch=function(t){return function(e,n,r,i){for(var s,o,a=SAt.getCSR(n),l=a.indices,c=a.indptr,u=0;u<i.length;u++)for(var h=new Set(r[0][u]);;){var d=wAt.smallestFlagged(r,u);if(-1===d)break;var p=l.slice(c[d],c[d+1]);try{for(var f=vAt(p),m=f.next();!m.done;m=f.next()){var g=m.value;if(g!==d&&-1!==g&&!h.has(g)){var y=t(e[g],i[u]);wAt.uncheckedHeapPush(r,u,y,g,1),h.add(g)}}}catch(t){s={error:t}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(s)throw s.error}}}return r}},oAt.initializeSearch=function(t,e,n,r,i,s,o){var a,l,c=wAt.makeHeap(n.length,r);if(i(r,e,n,c,o),t)try{for(var u=vAt(t),h=u.next();!h.done;h=u.next()){s(h.value,e,n,c,o)}}catch(t){a={error:t}}finally{try{h&&!h.done&&(l=u.return)&&l.call(u)}finally{if(a)throw a.error}}return c};const TAt=Object.prototype.toString;function EAt(t){return TAt.call(t).endsWith("Array]")}function MAt(t,e,n){let r=0;const i=n(e);for(let e=0;e<t.x.length;e++)r+=Math.abs(t.y[e]-i(t.x[e]));return r}function CAt(t,e,n,r,i){let s=n*r*r,o=_ct.eye(e.length,e.length,s);const a=i(e);let l=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)l[e]=a(t.x[e]);let c=function(t,e,n,r,i){const s=n.length,o=t.x.length;let a=new Array(s);for(let l=0;l<s;l++){a[l]=new Array(o);let s=n.slice();s[l]+=r;let c=i(s);for(let n=0;n<o;n++)a[l][n]=e[n]-c(t.x[n])}return new _ct(a)}(t,l,e,r,i),u=function(t,e){const n=t.x.length;let r=new Array(n);for(let i=0;i<n;i++)r[i]=[t.y[i]-e[i]];return new _ct(r)}(t,l),h=Ict(o.add(c.mmul(c.transpose())));return(e=(e=new _ct([e])).sub(h.mmul(c).mmul(u).mul(r).transpose())).to1DArray()}var AAt=Object.freeze({__proto__:null,default:function(t,e,n={}){let{maxIterations:r=100,gradientDifference:i=.1,damping:s=0,errorTolerance:o=.01,minValues:a,maxValues:l,initialValues:c}=n;if(s<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!EAt(t.x)||t.x.length<2||!EAt(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");let u=c||new Array(e.length).fill(1),h=u.length;if(l=l||new Array(h).fill(Number.MAX_SAFE_INTEGER),a=a||new Array(h).fill(Number.MIN_SAFE_INTEGER),l.length!==a.length)throw new Error("minValues and maxValues must be the same size");if(!EAt(u))throw new Error("initialValues must be an array");let d,p=MAt(t,u,e),f=p<=o;for(d=0;d<r&&!f;d++){u=CAt(t,u,s,i,e);for(let t=0;t<h;t++)u[t]=Math.min(Math.max(a[t],u[t]),l[t]);if(p=MAt(t,u,e),isNaN(p))break;f=p<=o}return{parameterValues:u,parameterError:p,iterations:d}}}),NAt=vt(AAt),IAt=yt&&yt.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},$At=yt&&yt.__generator||function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},RAt=yt&&yt.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},OAt=yt&&yt.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(RAt(arguments[e]));return t},PAt=yt&&yt.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},LAt=yt&&yt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(LCt,"__esModule",{value:!0});var DAt=PAt(DCt),FAt=PAt(JCt),zAt=PAt(oAt),BAt=PAt(aAt),UAt=PAt(FCt),VAt=LAt(NAt),jAt=function(){function t(t){void 0===t&&(t={});var e=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=WAt,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new HAt;var n=function(n){void 0!==t[n]&&(e[n]=t[n])};n("distanceFn"),n("learningRate"),n("localConnectivity"),n("minDist"),n("nComponents"),n("nEpochs"),n("nNeighbors"),n("negativeSampleRate"),n("random"),n("repulsionStrength"),n("setOpMixRatio"),n("spread"),n("transformQueueSize")}return t.prototype.fit=function(t){return this.initializeFit(t),this.optimizeLayout(),this.embedding},t.prototype.fitAsync=function(t,e){return void 0===e&&(e=function(){return!0}),IAt(this,void 0,void 0,(function(){return $At(this,(function(n){switch(n.label){case 0:return this.initializeFit(t),[4,this.optimizeLayoutAsync(e)];case 1:return n.sent(),[2,this.embedding]}}))}))},t.prototype.setSupervisedProjection=function(t,e){void 0===e&&(e={}),this.Y=t,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},t.prototype.setPrecomputedKNN=function(t,e){this.knnIndices=t,this.knnDistances=e},t.prototype.initializeFit=function(t){if(t.length<=this.nNeighbors)throw new Error("Not enough data points ("+t.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===t&&this.isInitialized)return this.getNEpochs();if(this.X=t,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(t);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(t,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(t),this.processGraphForSupervisedProjection();var n=this.initializeSimplicialSetEmbedding(),r=n.head,i=n.tail,s=n.epochsPerSample;return this.optimizationState.head=r,this.optimizationState.tail=i,this.optimizationState.epochsPerSample=s,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},t.prototype.makeSearchFns=function(){var t=zAt.makeInitializations(this.distanceFn),e=t.initFromTree,n=t.initFromRandom;this.initFromTree=e,this.initFromRandom=n,this.search=zAt.makeInitializedNNSearch(this.distanceFn)},t.prototype.makeSearchGraph=function(t){for(var e=this.knnIndices,n=this.knnDistances,r=[t.length,t.length],i=new FAt.SparseMatrix([],[],[],r),s=0;s<e.length;s++)for(var o=e[s],a=n[s],l=0;l<o.length;l++){var c=o[l],u=a[l];u>0&&i.set(s,c,u)}var h=FAt.transpose(i);return FAt.maximum(i,h)},t.prototype.transform=function(t){var e=this,n=this.X;if(void 0===n||0===n.length)throw new Error("No data has been fit.");var r=Math.floor(this.nNeighbors*this.transformQueueSize);r=Math.min(n.length,r);var i=zAt.initializeSearch(this.rpForest,n,t,r,this.initFromRandom,this.initFromTree,this.random),s=this.search(n,this.searchGraph,i,t),o=DAt.deheapSort(s),a=o.indices,l=o.weights;a=a.map((function(t){return t.slice(0,e.nNeighbors)})),l=l.map((function(t){return t.slice(0,e.nNeighbors)}));var c=Math.max(0,this.localConnectivity-1),u=this.smoothKNNDistance(l,this.nNeighbors,c),h=u.sigmas,d=u.rhos,p=this.computeMembershipStrengths(a,l,h,d),f=p.rows,m=p.cols,g=p.vals,y=[t.length,n.length],b=new FAt.SparseMatrix(f,m,g,y),v=FAt.normalize(b,"l1"),x=FAt.getCSR(v),w=t.length,S=ZAt(UAt.reshape2d(x.indices,w,this.nNeighbors),UAt.reshape2d(x.values,w,this.nNeighbors),this.embedding),_=this.nEpochs?this.nEpochs/3:b.nRows<=1e4?100:30,k=b.getValues().reduce((function(t,e){return e>t?e:t}),0);b=b.map((function(t){return t<k/_?0:t})),b=FAt.eliminateZeros(b);var T=this.makeEpochsPerSample(b.getValues(),_),E=b.getRows(),M=b.getCols();return this.assignOptimizationStateParameters({headEmbedding:S,tailEmbedding:this.embedding,head:E,tail:M,currentEpoch:0,nEpochs:_,nVertices:b.getDims()[1],epochsPerSample:T}),this.prepareForOptimizationLoop(),this.optimizeLayout()},t.prototype.processGraphForSupervisedProjection=function(){var t=this.Y,e=this.X;if(t){if(t.length!==e.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var n=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,t,n)}}},t.prototype.step=function(){var t=this.optimizationState.currentEpoch;return t<this.getNEpochs()&&this.optimizeLayoutStep(t),this.optimizationState.currentEpoch},t.prototype.getEmbedding=function(){return this.embedding},t.prototype.nearestNeighbors=function(t){var e=this.distanceFn,n=this.nNeighbors,r=zAt.makeNNDescent(e,this.random),i=5+Math.floor(function(t){return.5===t?0:Math.round(t)}(Math.pow(t.length,.5)/20)),s=Math.max(5,Math.floor(Math.round(function(t){return Math.log(t)/Math.log(2)}(t.length))));this.rpForest=BAt.makeForest(t,n,i,this.random);var o=r(t,BAt.makeLeafArray(this.rpForest),n,s);return{knnIndices:o.indices,knnDistances:o.weights}},t.prototype.fuzzySimplicialSet=function(t,e,n){void 0===n&&(n=1);var r=this,i=r.knnIndices,s=void 0===i?[]:i,o=r.knnDistances,a=void 0===o?[]:o,l=r.localConnectivity,c=this.smoothKNNDistance(a,e,l),u=c.sigmas,h=c.rhos,d=this.computeMembershipStrengths(s,a,u,h),p=d.rows,f=d.cols,m=d.vals,g=[t.length,t.length],y=new FAt.SparseMatrix(p,f,m,g),b=FAt.transpose(y),v=FAt.pairwiseMultiply(y,b),x=FAt.subtract(FAt.add(y,b),v),w=FAt.multiplyScalar(x,n),S=FAt.multiplyScalar(v,1-n);return FAt.add(w,S)},t.prototype.categoricalSimplicialSetIntersection=function(t,e,n,r){void 0===r&&(r=1);var i=YAt(t,e,r,n);return KAt(i=FAt.eliminateZeros(i))},t.prototype.smoothKNNDistance=function(t,e,n,r,i){void 0===n&&(n=1),void 0===r&&(r=64),void 0===i&&(i=1);for(var s=Math.log(e)/Math.log(2)*i,o=UAt.zeros(t.length),a=UAt.zeros(t.length),l=0;l<t.length;l++){var c=0,u=1/0,h=1,d=t[l],p=d.filter((function(t){return t>0}));if(p.length>=n){var f=Math.floor(n),m=n-f;f>0?(o[l]=p[f-1],m>1e-5&&(o[l]+=m*(p[f]-p[f-1]))):o[l]=m*p[0]}else p.length>0&&(o[l]=UAt.max(p));for(var g=0;g<r;g++){for(var y=0,b=1;b<t[l].length;b++){var v=t[l][b]-o[l];y+=v>0?Math.exp(-v/h):1}if(Math.abs(y-s)<1e-5)break;y>s?h=(c+(u=h))/2:(c=h,u===1/0?h*=2:h=(c+u)/2)}if(a[l]=h,o[l]>0){var x=UAt.mean(d);a[l]<.001*x&&(a[l]=.001*x)}else{var w=UAt.mean(t.map(UAt.mean));a[l]<.001*w&&(a[l]=.001*w)}}return{sigmas:a,rhos:o}},t.prototype.computeMembershipStrengths=function(t,e,n,r){for(var i=t.length,s=t[0].length,o=UAt.zeros(i*s),a=UAt.zeros(i*s),l=UAt.zeros(i*s),c=0;c<i;c++)for(var u=0;u<s;u++){var h=0;-1!==t[c][u]&&(h=t[c][u]===c?0:e[c][u]-r[c]<=0?1:Math.exp(-(e[c][u]-r[c])/n[c]),o[c*s+u]=c,a[c*s+u]=t[c][u],l[c*s+u]=h)}return{rows:o,cols:a,vals:l}},t.prototype.initializeSimplicialSetEmbedding=function(){for(var t=this,e=this.getNEpochs(),n=this.nComponents,r=this.graph.getValues(),i=0,s=0;s<r.length;s++){var o=r[s];i<r[s]&&(i=o)}var a=this.graph.map((function(t){return t<i/e?0:t}));this.embedding=UAt.zeros(a.nRows).map((function(){return UAt.zeros(n).map((function(){return 20*UAt.tauRand(t.random)-10}))}));var l=[],c=[],u=[],h=a.getAll();for(s=0;s<h.length;s++){var d=h[s];d.value&&(l.push(d.value),u.push(d.row),c.push(d.col))}return{head:c,tail:u,epochsPerSample:this.makeEpochsPerSample(l,e)}},t.prototype.makeEpochsPerSample=function(t,e){var n=UAt.filled(t.length,-1),r=UAt.max(t),i=t.map((function(t){return t/r*e}));return i.forEach((function(t,r){t>0&&(n[r]=e/i[r])})),n},t.prototype.assignOptimizationStateParameters=function(t){Object.assign(this.optimizationState,t)},t.prototype.prepareForOptimizationLoop=function(){var t=this,e=t.repulsionStrength,n=t.learningRate,r=t.negativeSampleRate,i=this.optimizationState,s=i.epochsPerSample,o=i.headEmbedding,a=i.tailEmbedding,l=o[0].length,c=o.length===a.length,u=s.map((function(t){return t/r})),h=OAt(u),d=OAt(s);this.assignOptimizationStateParameters({epochOfNextSample:d,epochOfNextNegativeSample:h,epochsPerNegativeSample:u,moveOther:c,initialAlpha:n,alpha:n,gamma:e,dim:l})},t.prototype.initializeOptimization=function(){var t=this.embedding,e=this.embedding,n=this.optimizationState,r=n.head,i=n.tail,s=n.epochsPerSample,o=this.getNEpochs(),a=this.graph.nCols,l=XAt(this.spread,this.minDist),c=l.a,u=l.b;this.assignOptimizationStateParameters({headEmbedding:t,tailEmbedding:e,head:r,tail:i,epochsPerSample:s,a:c,b:u,nEpochs:o,nVertices:a})},t.prototype.optimizeLayoutStep=function(t){for(var e=this.optimizationState,n=e.head,r=e.tail,i=e.headEmbedding,s=e.tailEmbedding,o=e.epochsPerSample,a=e.epochOfNextSample,l=e.epochOfNextNegativeSample,c=e.epochsPerNegativeSample,u=e.moveOther,h=e.initialAlpha,d=e.alpha,p=e.gamma,f=e.a,m=e.b,g=e.dim,y=e.nEpochs,b=e.nVertices,v=0;v<o.length;v++)if(!(a[v]>t)){var x=n[v],w=r[v],S=i[x],_=s[w],k=qAt(S,_),T=0;k>0&&(T=-2*f*m*Math.pow(k,m-1),T/=f*Math.pow(k,m)+1);for(var E=0;E<g;E++){var M=GAt(T*(S[E]-_[E]),4);S[E]+=M*d,u&&(_[E]+=-M*d)}a[v]+=o[v];for(var C=Math.floor((t-l[v])/c[v]),A=0;A<C;A++){var N=UAt.tauRandInt(b,this.random),I=s[N],$=qAt(S,I),R=0;if($>0)R=2*p*m,R/=(.001+$)*(f*Math.pow($,m)+1);else if(x===N)continue;for(E=0;E<g;E++){M=4;R>0&&(M=GAt(R*(S[E]-I[E]),4)),S[E]+=M*d}}l[v]+=C*c[v]}return e.alpha=h*(1-t/y),e.currentEpoch+=1,i},t.prototype.optimizeLayoutAsync=function(t){var e=this;return void 0===t&&(t=function(){return!0}),new Promise((function(n,r){var i=function(){return IAt(e,void 0,void 0,(function(){var e,s,o,a,l,c;return $At(this,(function(u){try{if(e=this.optimizationState,s=e.nEpochs,o=e.currentEpoch,this.embedding=this.optimizeLayoutStep(o),a=this.optimizationState.currentEpoch,l=!1===t(a),c=a===s,l||c)return[2,n(c)];setTimeout((function(){return i()}),0)}catch(t){r(t)}return[2]}))}))};setTimeout((function(){return i()}),0)}))},t.prototype.optimizeLayout=function(t){void 0===t&&(t=function(){return!0});for(var e=!1,n=[];!e;){var r=this.optimizationState,i=r.nEpochs,s=r.currentEpoch;n=this.optimizeLayoutStep(s);var o=this.optimizationState.currentEpoch,a=!1===t(o);e=o===i||a}return n},t.prototype.getNEpochs=function(){var t=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=t.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},t}();function WAt(t,e){for(var n=0,r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)}LCt.UMAP=jAt,LCt.euclidean=WAt,LCt.cosine=function(t,e){for(var n=0,r=0,i=0,s=0;s<t.length;s++)n+=t[s]*e[s],r+=Math.pow(t[s],2),i+=Math.pow(e[s],2);return 0===r&&0===i?0:0===r||0===i?1:1-n/Math.sqrt(r*i)};var HAt=function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0};function GAt(t,e){return t>e?e:t<-e?-e:t}function qAt(t,e){for(var n=0,r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return n}function XAt(t,e){var n=UAt.linear(0,3*t,300).map((function(t){return t<e?1:t})),r=UAt.zeros(n.length).map((function(r,i){return n[i]>=e?Math.exp(-(n[i]-e)/t):r})),i={x:n,y:r},s={damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01},o=VAt.default(i,(function(t){var e=RAt(t,2),n=e[0],r=e[1];return function(t){return 1/(1+n*Math.pow(t,2*r))}}),s).parameterValues,a=RAt(o,2);return{a:a[0],b:a[1]}}function YAt(t,e,n,r){return void 0===n&&(n=1),void 0===r&&(r=5),t.map((function(t,i,s){return-1===e[i]||-1===e[s]?t*Math.exp(-n):e[i]!==e[s]?t*Math.exp(-r):t}))}function KAt(t){t=FAt.normalize(t,"max");var e=FAt.transpose(t),n=FAt.pairwiseMultiply(e,t);return t=FAt.add(t,FAt.subtract(e,n)),FAt.eliminateZeros(t)}function ZAt(t,e,n){for(var r=UAt.zeros(t.length).map((function(t){return UAt.zeros(n[0].length)})),i=0;i<t.length;i++)for(var s=0;s<t[0].length;s++)for(var o=0;o<n[0].length;o++){var a=t[i][s];r[i][o]+=e[i][s]*n[a][o]}return r}LCt.findABParams=XAt,LCt.fastIntersection=YAt,LCt.resetLocalConnectivity=KAt,LCt.initTransform=ZAt,Object.defineProperty(PCt,"__esModule",{value:!0});var JAt,QAt,tNt,eNt,nNt,rNt,iNt,sNt,oNt,aNt,lNt,cNt,uNt=LCt,hNt=PCt.UMAP=uNt.UMAP;class dNt extends MX{constructor({nComponents:t=2,nNeighbors:e=15,minDist:n=.1,spread:r=1,supervised:i=!1}={}){super(),this.title="UMAP",this.serviceName="umap",this.parameters={nComponents:new rU(t,!0),nNeighbors:new rU(e,!0),minDist:new rU(n,!0),spread:new rU(r,!0),supervised:new rU(i,!0)}}async train(t){this.$training.set({status:"start",epochs:-1});const e=EX(t)?t.items():t,n=await e.toArray(),r=n.reduce(((t,{x:e})=>t.concat([e])),[]);if(this.model=new hNt({nComponents:this.parameters.nComponents.get()}),this.parameters.supervised.get()){const t=n.map((t=>t.y));this.model.setSupervisedProjection(t)}const i=this.model.initializeFit(r);this.$training.set({status:"start",epochs:i});for(let t=0;t<i;t++)this.model.step(),this.$training.set({status:"epoch",epoch:t+1,epochs:i,data:{embedding:this.model.getEmbedding()}});this.$training.set({status:"success",data:{embedding:this.model.getEmbedding()}})}async predict(t){return this.model?this.model.transform([t])[0]:null}save(){throw new Error("Umap does not support saving")}load(){throw new Error("Umap does not support loading")}download(){throw new Error("Umap does not support downloading")}upload(){throw new Error("Umap does not support uploading")}}function pNt(...t){return new dNt(...t)}function fNt(t){let e,n;return e=new XM({}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function mNt(t){let e,n,r,i,s,o,a,l,c,u,h;function d(e){t[10](e)}let p={text:"activate video"};void 0!==t[7]&&(p.checked=t[7]),i=new ZM({props:p}),bE.push((()=>XE(i,"checked",d)));let f=t[7]&&!t[8]&&fNt();return{c(){e=zT("div"),n=zT("div"),r=zT("div"),YE(i.$$.fragment),o=VT(),a=zT("div"),f&&f.c(),l=VT(),c=zT("video"),KT(n,"margin-left","10px"),GT(c,"id","webcam-video"),GT(c,"class","max-w-none svelte-18llgdn"),KT(c,"width",t[1]>t[2]?`${t[6]}px`:"auto"),KT(c,"height",t[1]>t[2]?"auto":t[6]*t[2]/t[1]+"px"),c.autoplay=!0,c.muted=!0,c.playsInline=!0,GT(a,"class","webcam-container svelte-18llgdn"),KT(a,"flex-direction",t[1]>t[2]?"column":"row"),KT(a,"height",t[6]*t[2]/t[1]+"px"),TE((()=>t[12].call(a))),GT(e,"class","webcam svelte-18llgdn")},m(s,d){LT(s,e,d),RT(e,n),RT(n,r),KE(i,r,null),RT(e,o),RT(e,a),f&&f.m(a,null),RT(a,l),RT(a,c),t[11](c),u=function(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");const n=zT("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=QT();let i;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=WT(window,"message",(t=>{t.source===n.contentWindow&&e()}))):(n.src="about:blank",n.onload=()=>{i=WT(n.contentWindow,"resize",e)}),RT(t,n),()=>{(r||i&&n.contentWindow)&&i(),DT(n)}}(a,t[12].bind(a)),h=!0},p(t,e){const n={};!s&&128&e&&(s=!0,n.checked=t[7],EE((()=>s=!1))),i.$set(n),t[7]&&!t[8]?f?384&e&&FE(f,1):(f=fNt(),f.c(),FE(f,1),f.m(a,l)):f&&(LE(),zE(f,1,1,(()=>{f=null})),DE()),(!h||70&e)&&KT(c,"width",t[1]>t[2]?`${t[6]}px`:"auto"),(!h||70&e)&&KT(c,"height",t[1]>t[2]?"auto":t[6]*t[2]/t[1]+"px"),(!h||6&e)&&KT(a,"flex-direction",t[1]>t[2]?"column":"row"),(!h||70&e)&&KT(a,"height",t[6]*t[2]/t[1]+"px")},i(t){h||(FE(i.$$.fragment,t),FE(f),h=!0)},o(t){zE(i.$$.fragment,t),zE(f),h=!1},d(n){n&&DT(e),ZE(i),f&&f.d(),t[11](null),u()}}}function gNt(t){let e,n;return e=new zL({props:{title:t[0],$$slots:{default:[mNt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16870&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function yNt(t,e,n){let r,i,s=uT,o=()=>(s(),s=vT(d,(t=>n(7,r=t))),d),a=uT,l=()=>(a(),a=vT(g,(t=>n(8,i=t))),g);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{width:u}=e,{height:h}=e,{active:d}=e;o();let p,f,{mediaStream:m}=e,{ready:g}=e;l();let y=QB;return hE((async()=>{await kE(),await kE(),y=m.subscribe((t=>{t&&n(5,p.srcObject=t,p)}))})),pE((()=>{y()})),t.$$set=t=>{"title"in t&&n(0,c=t.title),"width"in t&&n(1,u=t.width),"height"in t&&n(2,h=t.height),"active"in t&&o(n(3,d=t.active)),"mediaStream"in t&&n(9,m=t.mediaStream),"ready"in t&&l(n(4,g=t.ready))},[c,u,h,d,g,p,f,r,i,m,function(t){r=t,d.set(r)},function(t){bE[t?"unshift":"push"]((()=>{p=t,n(5,p)}))},function(){f=this.clientWidth,n(6,f)}]}class bNt extends QE{constructor(t){super(),JE(this,t,yNt,gNt,gT,{title:0,width:1,height:2,active:3,mediaStream:9,ready:4})}}class vNt extends SU{constructor({width:t=224,height:e=224,period:n=50}={}){super(),this.title="webcam",this.$active=new rU(!1,!0),this.$ready=new rU(!1,!0),this.$mediastream=new rU(void 0,!0),this.$images=new rU(JD(),!0),this.$thumbnails=new rU(JD(),!0),JAt.set(this,void 0),QAt.set(this,void 0),tNt.set(this,void 0),eNt.set(this,void 0),nNt.set(this,document.createElement("video")),rNt.set(this,60),iNt.set(this,QB),sNt.set(this,QB),oNt.set(this,void 0),aNt.set(this,void 0),lNt.set(this,void 0),cNt.set(this,void 0),HB(this,JAt,t,"f"),HB(this,QAt,e,"f"),this.period=n,this.setupCapture(),this.start(),WB(this,nNt,"f").autoplay=!0,HB(this,iNt,this.$active.subscribe((t=>{WB(this,sNt,"f").call(this),t?(this.loadCameras(),HB(this,sNt,function(t,e){let n,r=(new Date).getTime(),i=!1;return n=window.requestAnimationFrame((function s(){i||((new Date).getTime()-r>=e&&(t(),r=(new Date).getTime()),n=window.requestAnimationFrame(s))})),function(){window.cancelAnimationFrame(n),i=!0}}(this.process,this.period),"f")):this.stopCamera()})),"f")}getWidth(){return WB(this,JAt,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new bNt({target:e,props:{title:this.title,width:WB(this,JAt,"f"),height:WB(this,QAt,"f"),active:this.$active,mediaStream:this.$mediastream,ready:this.$ready}}))}stop(){if(super.stop(),WB(this,sNt,"f").call(this),WB(this,iNt,"f").call(this),this.$mediastream.get())for(const t of this.$mediastream.get().getTracks())t.stop()}setupCapture(){HB(this,oNt,document.createElement("canvas"),"f"),WB(this,oNt,"f").width=WB(this,rNt,"f"),WB(this,oNt,"f").height=WB(this,rNt,"f")*WB(this,QAt,"f")/WB(this,JAt,"f"),HB(this,aNt,WB(this,oNt,"f").getContext("2d"),"f"),HB(this,lNt,document.createElement("canvas"),"f"),WB(this,lNt,"f").width=WB(this,JAt,"f"),WB(this,lNt,"f").height=WB(this,QAt,"f"),HB(this,cNt,WB(this,lNt,"f").getContext("2d"),"f")}async loadCameras(){try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});HB(this,tNt,t.getVideoTracks()[0].getSettings().width,"f"),HB(this,eNt,t.getVideoTracks()[0].getSettings().height,"f"),this.loadSrcStream(t)}catch(t){hU(new Error("Webcam not supported"))}}loadSrcStream(t){this.$mediastream.set(t),WB(this,nNt,"f").srcObject=t,WB(this,nNt,"f").onloadedmetadata=()=>{this.$ready.set(!0)}}stopCamera(){if(this.$mediastream.get()){const t=this.$mediastream.get().getTracks();for(const e of t)e.stop(),WB(this,nNt,"f").srcObject=null;this.$ready.set(!1)}}process(){this.$ready.get()&&(this.$thumbnails.set(this.captureThumbnail()),this.$images.set(this.captureImage()))}captureThumbnail(){if(!this.$ready.get())return null;if(WB(this,QAt,"f")/WB(this,eNt,"f")>WB(this,JAt,"f")/WB(this,tNt,"f")){const t=WB(this,oNt,"f").height*WB(this,tNt,"f")/WB(this,eNt,"f");WB(this,aNt,"f").drawImage(WB(this,nNt,"f"),WB(this,oNt,"f").width/2-t/2,0,t,WB(this,oNt,"f").height)}else{const t=WB(this,oNt,"f").width*WB(this,eNt,"f")/WB(this,tNt,"f");WB(this,aNt,"f").drawImage(WB(this,nNt,"f"),0,WB(this,oNt,"f").height/2-t/2,WB(this,oNt,"f").width,t)}return WB(this,oNt,"f").toDataURL("image/jpeg")}captureImage(){if(!this.$ready.get())return null;if(WB(this,QAt,"f")/WB(this,eNt,"f")>WB(this,JAt,"f")/WB(this,tNt,"f")){const t=WB(this,QAt,"f")*WB(this,tNt,"f")/WB(this,eNt,"f");WB(this,cNt,"f").drawImage(WB(this,nNt,"f"),WB(this,JAt,"f")/2-t/2,0,t,WB(this,QAt,"f"))}else{const t=WB(this,JAt,"f")*WB(this,eNt,"f")/WB(this,tNt,"f");WB(this,cNt,"f").drawImage(WB(this,nNt,"f"),0,WB(this,QAt,"f")/2-t/2,WB(this,JAt,"f"),t)}return WB(this,cNt,"f").getImageData(0,0,WB(this,JAt,"f"),WB(this,QAt,"f"))}}function xNt(...t){return new vNt(...t)}function wNt(t){return"string"==typeof t}function SNt(t){return Array.isArray(t)}JAt=new WeakMap,QAt=new WeakMap,tNt=new WeakMap,eNt=new WeakMap,nNt=new WeakMap,rNt=new WeakMap,iNt=new WeakMap,sNt=new WeakMap,oNt=new WeakMap,aNt=new WeakMap,lNt=new WeakMap,cNt=new WeakMap;class _Nt{constructor(t,e=!0){this.name=t,this.showSidebar=e,this.components=[],this.componentsLeft=[]}use(...t){return this.components=this.components.concat(t),this}sidebar(...t){return this.componentsLeft=this.componentsLeft.concat(t),this}mount(){for(const t of this.components)if(SNt(t))for(const e of t)e.mount();else wNt(t)||t.mount();for(const t of this.componentsLeft)t.mount()}destroy(){for(const t of this.components)if(SNt(t))for(const e of t)e.destroy();else wNt(t)||t.destroy();for(const t of this.componentsLeft)t.destroy()}}class kNt{constructor(t,e){this.path=t,this.name=e,this.keys=[],this.fns=[],this.params={},this.regex=function(t,e,n,r){return t instanceof RegExp?t:(t instanceof Array&&(t=`(${t.join("|")})`),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,((t,n,r,i,s,o)=>(e.push({name:i,optional:!!o}),n=n||"",`${o?"":n}(?:${o?n:""}${r||""}${s||r&&"([^/.]+?)"||"([^/]+?)"})${o||""}`))).replace(/([/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp(`^${t}$`,n?"":"i"))}(this.path,this.keys,!1,!1)}addHandler(t){this.fns.push(t)}removeHandler(t){this.fns=this.fns.filter((e=>t===e))}run(t){for(const e of this.fns)e.apply(this,t)}match(t,e){const n=this.regex.exec(t);if(!n)return!1;for(let t=1,r=n.length;t<r;t++){const r=this.keys[t-1],i="string"==typeof n[t]?decodeURIComponent(n[t]):n[t];r&&(this.params[r.name]=i),e.push(i)}return!0}}function TNt(t,e){const n=[];return!!e.match(t,n)&&(e.run(n),!0)}class ENt{constructor(){this.map={},this.routes=[],this.addListener()}route(t,e){const n=t.split(" "),r=2===n.length?n[0]:null;t=2===n.length?n[1]:n[0],Object.keys(this.map).includes(t)||(this.map[t]=new kNt(t,r),this.routes.push(this.map[t])),this.map[t].addHandler(e),this.reload()}addListener(){window.addEventListener("hashchange",this.reload.bind(this),!1)}removeListener(){window.removeEventListener("hashchange",this.reload.bind(this))}reload(){const t=window.location.hash.substring(1);for(let e=0;e<this.routes.length;e++){if(TNt(t,this.routes[e]))return}}navigate(t,{silent:e=!1}={}){e&&this.removeListener(),setTimeout((()=>{window.location.hash=t,e&&setTimeout((()=>{this.addListener()}),1)}),1)}}function MNt(t,e,n){const r=t.slice();return r[1]=e[n],r}function CNt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function ANt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function NNt(t){let e,n,r=t[0].showSidebar&&INt(t),i=t[0].components,s=[];for(let e=0;e<i.length;e+=1)s[e]=DNt(MNt(t,i,e));return{c(){r&&r.c(),e=VT(),n=zT("div");for(let t=0;t<s.length;t+=1)s[t].c();GT(n,"class","right svelte-15dyumc"),tE(n,"fullw",!t[0].showSidebar)},m(t,i){r&&r.m(t,i),LT(t,e,i),LT(t,n,i);for(let t=0;t<s.length;t+=1)s[t].m(n,null)},p(t,o){if(t[0].showSidebar?r?r.p(t,o):(r=INt(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),1&o){let e;for(i=t[0].components,e=0;e<i.length;e+=1){const r=MNt(t,i,e);s[e]?s[e].p(r,o):(s[e]=DNt(r),s[e].c(),s[e].m(n,null))}for(;e<s.length;e+=1)s[e].d(1);s.length=i.length}1&o&&tE(n,"fullw",!t[0].showSidebar)},d(t){r&&r.d(t),t&&DT(e),t&&DT(n),FT(s,t)}}}function INt(t){let e,n=t[0].componentsLeft,r=[];for(let e=0;e<n.length;e+=1)r[e]=$Nt(ANt(t,n,e));return{c(){e=zT("div");for(let t=0;t<r.length;t+=1)r[t].c();GT(e,"class","left svelte-15dyumc")},m(t,n){LT(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,i){if(1&i){let s;for(n=t[0].componentsLeft,s=0;s<n.length;s+=1){const o=ANt(t,n,s);r[s]?r[s].p(o,i):(r[s]=$Nt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&DT(e),FT(r,t)}}}function $Nt(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[4]),GT(e,"class","card")},m(t,n){LT(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&GT(e,"id",n)},d(t){t&&DT(e)}}}function RNt(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[1].id),GT(e,"class","card")},m(t,n){LT(t,e,n)},p(t,r){1&r&&n!==(n=t[1].id)&&GT(e,"id",n)},d(t){t&&DT(e)}}}function ONt(t){let e,n,r=t[1]+"";return{c(){e=zT("h2"),n=UT(r),GT(e,"class","svelte-15dyumc")},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){1&e&&r!==(r=t[1]+"")&&XT(n,r)},d(t){t&&DT(e)}}}function PNt(t){let e,n,r=t[1],i=[];for(let e=0;e<r.length;e+=1)i[e]=LNt(CNt(t,r,e));return{c(){e=zT("div");for(let t=0;t<i.length;t+=1)i[t].c();n=VT(),GT(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){LT(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);RT(e,n)},p(t,s){if(1&s){let o;for(r=t[1],o=0;o<r.length;o+=1){const a=CNt(t,r,o);i[o]?i[o].p(a,s):(i[o]=LNt(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&DT(e),FT(i,t)}}}function LNt(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[4]),GT(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){LT(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&GT(e,"id",n)},d(t){t&&DT(e)}}}function DNt(t){let e,n;function r(t,n){return 1&n&&(e=null),null==e&&(e=!!Array.isArray(t[1])),e?PNt:"string"==typeof t[1]?ONt:RNt}let i=r(t,-1),s=i(t);return{c(){s.c(),n=jT()},m(t,e){s.m(t,e),LT(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&DT(n)}}}function FNt(t){let e,n=t[0]&&NNt(t);return{c(){n&&n.c(),e=jT()},m(t,r){n&&n.m(t,r),LT(t,e,r)},p(t,[r]){t[0]?n?n.p(t,r):(n=NNt(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:uT,o:uT,d(t){n&&n.d(t),t&&DT(e)}}}function zNt(t,e,n){let{dashboard:r}=e;return dE((()=>{r.mount()})),t.$$set=t=>{"dashboard"in t&&n(0,r=t.dashboard)},[r]}class BNt extends QE{constructor(t){super(),JE(this,t,zNt,FNt,gT,{dashboard:0})}}function UNt(t){let e;return{c(){e=UT("This dataset is empty")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function VNt(t){let e,n,r,i,s,o=t[3]?"s":"";return{c(){e=UT("This dataset contains "),n=UT(t[3]),r=UT(" instance"),i=UT(o),s=UT(".")},m(t,o){LT(t,e,o),LT(t,n,o),LT(t,r,o),LT(t,i,o),LT(t,s,o)},p(t,e){8&e&&XT(n,t[3]),8&e&&o!==(o=t[3]?"s":"")&&XT(i,o)},d(t){t&&DT(e),t&&DT(n),t&&DT(r),t&&DT(i),t&&DT(s)}}}function jNt(t){let e,n,r,i;return e=new nM({props:{$$slots:{default:[WNt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){YE(e.$$.fragment),n=VT(),r=zT("span"),GT(r,"class","w-1")},m(t,s){KE(e,t,s),LT(t,n,s),LT(t,r,s),i=!0},p(t,n){const r={};256&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(FE(e.$$.fragment,t),i=!0)},o(t){zE(e.$$.fragment,t),i=!1},d(t){ZE(e,t),t&&DT(n),t&&DT(r)}}}function WNt(t){let e;return{c(){e=UT("Download Dataset")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function HNt(t){let e;return{c(){e=UT("Upload Dataset")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function GNt(t){let e;return{c(){e=UT("Clear Dataset")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function qNt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].title+"";function y(t,e){return t[3]?VNt:UNt}let b=y(t),v=b(t),x=t[3]&&jNt(t);return l=new nM({props:{$$slots:{default:[HNt]},$$scope:{ctx:t}}}),l.$on("click",t[5]),f=new nM({props:{type:"danger",$$slots:{default:[GNt]},$$scope:{ctx:t}}}),f.$on("click",t[6]),{c(){e=zT("span"),n=UT(g),r=VT(),i=zT("p"),v.c(),s=VT(),o=zT("div"),x&&x.c(),a=VT(),YE(l.$$.fragment),c=VT(),u=zT("span"),h=VT(),d=zT("input"),p=VT(),YE(f.$$.fragment),GT(e,"class","card-title"),GT(i,"class","pb-2"),GT(u,"class","w-1"),GT(d,"type","file"),d.multiple=!0,GT(d,"class","hidden"),GT(o,"class","flex")},m(g,y){LT(g,e,y),RT(e,n),LT(g,r,y),LT(g,i,y),v.m(i,null),LT(g,s,y),LT(g,o,y),x&&x.m(o,null),RT(o,a),KE(l,o,null),RT(o,c),RT(o,u),RT(o,h),RT(o,d),t[7](d),RT(o,p),KE(f,o,null),m=!0},p(t,[e]){(!m||1&e)&&g!==(g=t[0].title+"")&&XT(n,g),b===(b=y(t))&&v?v.p(t,e):(v.d(1),v=b(t),v&&(v.c(),v.m(i,null))),t[3]?x?(x.p(t,e),8&e&&FE(x,1)):(x=jNt(t),x.c(),FE(x,1),x.m(o,a)):x&&(LE(),zE(x,1,1,(()=>{x=null})),DE());const r={};256&e&&(r.$$scope={dirty:e,ctx:t}),l.$set(r);const s={};256&e&&(s.$$scope={dirty:e,ctx:t}),f.$set(s)},i(t){m||(FE(x),FE(l.$$.fragment,t),FE(f.$$.fragment,t),m=!0)},o(t){zE(x),zE(l.$$.fragment,t),zE(f.$$.fragment,t),m=!1},d(n){n&&DT(e),n&&DT(r),n&&DT(i),v.d(),n&&DT(s),n&&DT(o),x&&x.d(),ZE(l),t[7](null),ZE(f)}}}function XNt(t,e,n){let r,i,s=uT;t.$$.on_destroy.push((()=>s()));let o,{dataset:a}=e;return hE((async()=>{await kE(),await kE(),o.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);a.upload(n)}))})),t.$$set=t=>{"dataset"in t&&n(0,a=t.dataset)},t.$$.update=()=>{1&t.$$.dirty&&(n(2,r=a.$count),s(),s=vT(r,(t=>n(3,i=t))))},[a,o,r,i,function(){a.download()},function(){null==o||o.click()},function(){a.clear()},function(t){bE[t?"unshift":"push"]((()=>{o=t,n(1,o)}))}]}class YNt extends QE{constructor(t){super(),JE(this,t,XNt,qNt,gT,{dataset:0})}}function KNt(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:tIt,then:JNt,catch:ZNt,value:4,blocks:[,,,]};return VE(n=t[0].connect(),i),{c(){e=jT(),i.block.c()},m(t,n){LT(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,1&r&&n!==(n=t[0].connect())&&VE(n,i)||jE(i,t,r)},i(t){r||(FE(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){zE(i.blocks[t])}r=!1},d(t){t&&DT(e),i.block.d(t),i.token=null,i=null}}}function ZNt(t){return{c:uT,m:uT,p:uT,i:uT,o:uT,d:uT}}function JNt(t){let e,n,r,i,s,o,a,l=t[4].email+"";return o=new nM({props:{$$slots:{default:[QNt]},$$scope:{ctx:t}}}),o.$on("click",t[3]),{c(){e=zT("p"),n=UT("Hello, "),r=UT(l),i=VT(),s=zT("div"),YE(o.$$.fragment),GT(e,"class","pb-2"),GT(s,"class","flex")},m(t,l){LT(t,e,l),RT(e,n),RT(e,r),LT(t,i,l),LT(t,s,l),KE(o,s,null),a=!0},p(t,e){(!a||1&e)&&l!==(l=t[4].email+"")&&XT(r,l);const n={};32&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n)},i(t){a||(FE(o.$$.fragment,t),a=!0)},o(t){zE(o.$$.fragment,t),a=!1},d(t){t&&DT(e),t&&DT(i),t&&DT(s),ZE(o)}}}function QNt(t){let e;return{c(){e=UT("Log out")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function tIt(t){let e,n;return e=new XM({}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p:uT,i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function eIt(t){let e,n,r,i=t[2].join(", ")+"";return{c(){e=zT("div"),n=UT("This data store contains the following services: "),r=UT(i)},m(t,i){LT(t,e,i),RT(e,n),RT(e,r)},p(t,e){4&e&&i!==(i=t[2].join(", ")+"")&&XT(r,i)},d(t){t&&DT(e)}}}function nIt(t){let e,n,r,i=t[0].requiresAuth&&KNt(t),s=t[2]&&eIt(t);return{c(){i&&i.c(),e=VT(),s&&s.c(),n=jT()},m(t,o){i&&i.m(t,o),LT(t,e,o),s&&s.m(t,o),LT(t,n,o),r=!0},p(t,r){t[0].requiresAuth?i?(i.p(t,r),1&r&&FE(i,1)):(i=KNt(t),i.c(),FE(i,1),i.m(e.parentNode,e)):i&&(LE(),zE(i,1,1,(()=>{i=null})),DE()),t[2]?s?s.p(t,r):(s=eIt(t),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(t){r||(FE(i),r=!0)},o(t){zE(i),r=!1},d(t){i&&i.d(t),t&&DT(e),s&&s.d(t),t&&DT(n)}}}function rIt(t){let e,n;return e=new zL({props:{title:"data store ("+t[0].location+")",$$slots:{default:[nIt]},$$scope:{ctx:t}}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title="data store ("+t[0].location+")"),37&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function iIt(t,e,n){let r,i,s=uT;t.$$.on_destroy.push((()=>s()));let{dataStore:o}=e;return t.$$set=t=>{"dataStore"in t&&n(0,o=t.dataStore)},t.$$.update=()=>{1&t.$$.dirty&&(n(1,r=o.$services),s(),s=vT(r,(t=>n(2,i=t))))},[o,r,i,function(){o.logout()}]}class sIt extends QE{constructor(t){super(),JE(this,t,iIt,rIt,gT,{dataStore:0})}}function oIt(t){let e;return{c(){e=UT("Download Model")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function aIt(t){let e;return{c(){e=UT("Upload Model")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function lIt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[0].title+"";return s=new nM({props:{$$slots:{default:[oIt]},$$scope:{ctx:t}}}),s.$on("click",t[2]),h=new nM({props:{$$slots:{default:[aIt]},$$scope:{ctx:t}}}),h.$on("click",t[3]),{c(){e=zT("span"),n=UT(p),r=VT(),i=zT("div"),YE(s.$$.fragment),o=VT(),a=zT("span"),l=VT(),c=zT("input"),u=VT(),YE(h.$$.fragment),GT(e,"class","card-title"),GT(a,"class","w-1"),GT(c,"type","file"),c.multiple=!0,GT(c,"class","hidden"),GT(i,"class","flex")},m(p,f){LT(p,e,f),RT(e,n),LT(p,r,f),LT(p,i,f),KE(s,i,null),RT(i,o),RT(i,a),RT(i,l),RT(i,c),t[4](c),RT(i,u),KE(h,i,null),d=!0},p(t,[e]){(!d||1&e)&&p!==(p=t[0].title+"")&&XT(n,p);const r={};32&e&&(r.$$scope={dirty:e,ctx:t}),s.$set(r);const i={};32&e&&(i.$$scope={dirty:e,ctx:t}),h.$set(i)},i(t){d||(FE(s.$$.fragment,t),FE(h.$$.fragment,t),d=!0)},o(t){zE(s.$$.fragment,t),zE(h.$$.fragment,t),d=!1},d(n){n&&DT(e),n&&DT(r),n&&DT(i),ZE(s),t[4](null),ZE(h)}}}function cIt(t){return"download"in t}function uIt(t,e,n){let r,{model:i}=e;return hE((async()=>{await kE(),await kE(),r.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);cIt(i)&&i.upload(...n)}))})),t.$$set=t=>{"model"in t&&n(0,i=t.model)},[i,r,function(){cIt(i)?i.download():hU(new Error("This model cannot be saved"))},function(){cIt(i)?null==r||r.click():hU(new Error("This model cannot be uploaded"))},function(t){bE[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class hIt extends QE{constructor(t){super(),JE(this,t,uIt,lIt,gT,{model:0})}}function dIt(t){let e;return{c(){e=UT("This batch prediction component is empty")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function pIt(t){let e,n,r,i,s=t[3]?"s":"";return{c(){e=UT("This batch prediction component contains\n    "),n=UT(t[3]),r=UT("\n    prediction"),i=UT(s)},m(t,s){LT(t,e,s),LT(t,n,s),LT(t,r,s),LT(t,i,s)},p(t,e){8&e&&XT(n,t[3]),8&e&&s!==(s=t[3]?"s":"")&&XT(i,s)},d(t){t&&DT(e),t&&DT(n),t&&DT(r),t&&DT(i)}}}function fIt(t){let e,n,r,i;return e=new nM({props:{$$slots:{default:[mIt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){YE(e.$$.fragment),n=VT(),r=zT("span"),GT(r,"class","w-1")},m(t,s){KE(e,t,s),LT(t,n,s),LT(t,r,s),i=!0},p(t,n){const r={};256&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(FE(e.$$.fragment,t),i=!0)},o(t){zE(e.$$.fragment,t),i=!1},d(t){ZE(e,t),t&&DT(n),t&&DT(r)}}}function mIt(t){let e;return{c(){e=UT("Download Predictions")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function gIt(t){let e;return{c(){e=UT("Upload Predictions")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function yIt(t){let e;return{c(){e=UT("Clear Predictions")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function bIt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].title+"";function y(t,e){return t[3]?pIt:dIt}let b=y(t),v=b(t),x=t[3]&&fIt(t);return l=new nM({props:{$$slots:{default:[gIt]},$$scope:{ctx:t}}}),l.$on("click",t[5]),f=new nM({props:{type:"danger",$$slots:{default:[yIt]},$$scope:{ctx:t}}}),f.$on("click",t[6]),{c(){e=zT("span"),n=UT(g),r=VT(),i=zT("p"),v.c(),s=VT(),o=zT("div"),x&&x.c(),a=VT(),YE(l.$$.fragment),c=VT(),u=zT("span"),h=VT(),d=zT("input"),p=VT(),YE(f.$$.fragment),GT(e,"class","card-title"),GT(i,"class","pb-2"),GT(u,"class","w-1"),GT(d,"type","file"),d.multiple=!0,GT(d,"class","hidden"),GT(o,"class","flex")},m(g,y){LT(g,e,y),RT(e,n),LT(g,r,y),LT(g,i,y),v.m(i,null),LT(g,s,y),LT(g,o,y),x&&x.m(o,null),RT(o,a),KE(l,o,null),RT(o,c),RT(o,u),RT(o,h),RT(o,d),t[7](d),RT(o,p),KE(f,o,null),m=!0},p(t,[e]){(!m||1&e)&&g!==(g=t[0].title+"")&&XT(n,g),b===(b=y(t))&&v?v.p(t,e):(v.d(1),v=b(t),v&&(v.c(),v.m(i,null))),t[3]?x?(x.p(t,e),8&e&&FE(x,1)):(x=fIt(t),x.c(),FE(x,1),x.m(o,a)):x&&(LE(),zE(x,1,1,(()=>{x=null})),DE());const r={};256&e&&(r.$$scope={dirty:e,ctx:t}),l.$set(r);const s={};256&e&&(s.$$scope={dirty:e,ctx:t}),f.$set(s)},i(t){m||(FE(x),FE(l.$$.fragment,t),FE(f.$$.fragment,t),m=!0)},o(t){zE(x),zE(l.$$.fragment,t),zE(f.$$.fragment,t),m=!1},d(n){n&&DT(e),n&&DT(r),n&&DT(i),v.d(),n&&DT(s),n&&DT(o),x&&x.d(),ZE(l),t[7](null),ZE(f)}}}function vIt(t,e,n){let r,i,s=uT;t.$$.on_destroy.push((()=>s()));let o,{prediction:a}=e;return hE((async()=>{await kE(),await kE(),o.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);a.upload(n)}))})),t.$$set=t=>{"prediction"in t&&n(0,a=t.prediction)},t.$$.update=()=>{1&t.$$.dirty&&(n(2,r=a.$count),s(),s=vT(r,(t=>n(3,i=t))))},[a,o,r,i,function(){a.download()},function(){null==o||o.click()},function(){a.clear()},function(t){bE[t?"unshift":"push"]((()=>{o=t,n(1,o)}))}]}class xIt extends QE{constructor(t){super(),JE(this,t,vIt,bIt,gT,{prediction:0})}}function wIt(t,e,n){const r=t.slice();return r[1]=e[n],r}function SIt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function _It(t,e,n){const r=t.slice();return r[7]=e[n],r}function kIt(t,e,n){const r=t.slice();return r[10]=e[n],r}function TIt(t,e,n){const r=t.slice();return r[13]=e[n],r}function EIt(t,e,n){const r=t.slice();return r[16]=e[n],r}function MIt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].xDataStores,y=[];for(let e=0;e<g.length;e+=1)y[e]=CIt(EIt(t,g,e));const b=t=>zE(y[t],1,1,(()=>{y[t]=null}));let v=t[0].xModels,x=[];for(let e=0;e<v.length;e+=1)x[e]=AIt(TIt(t,v,e));const w=t=>zE(x[t],1,1,(()=>{x[t]=null}));let S=t[0].xDatasets,_=[];for(let e=0;e<S.length;e+=1)_[e]=NIt(kIt(t,S,e));const k=t=>zE(_[t],1,1,(()=>{_[t]=null}));let T=t[0].xPredictions,E=[];for(let e=0;e<T.length;e+=1)E[e]=IIt(_It(t,T,e));const M=t=>zE(E[t],1,1,(()=>{E[t]=null}));let C=t[0].components,A=[];for(let e=0;e<C.length;e+=1)A[e]=LIt(wIt(t,C,e));return{c(){e=zT("div"),n=zT("h2"),n.textContent="Data Stores",r=VT();for(let t=0;t<y.length;t+=1)y[t].c();i=VT(),s=zT("h2"),s.textContent="Models",o=VT();for(let t=0;t<x.length;t+=1)x[t].c();a=VT(),l=zT("h2"),l.textContent="Datasets",c=VT();for(let t=0;t<_.length;t+=1)_[t].c();u=VT(),h=zT("h2"),h.textContent="Predictions",d=VT();for(let t=0;t<E.length;t+=1)E[t].c();p=VT(),f=zT("div");for(let t=0;t<A.length;t+=1)A[t].c();GT(e,"class","left svelte-inuorr"),GT(f,"class","right svelte-inuorr")},m(t,g){LT(t,e,g),RT(e,n),RT(e,r);for(let t=0;t<y.length;t+=1)y[t].m(e,null);RT(e,i),RT(e,s),RT(e,o);for(let t=0;t<x.length;t+=1)x[t].m(e,null);RT(e,a),RT(e,l),RT(e,c);for(let t=0;t<_.length;t+=1)_[t].m(e,null);RT(e,u),RT(e,h),RT(e,d);for(let t=0;t<E.length;t+=1)E[t].m(e,null);LT(t,p,g),LT(t,f,g);for(let t=0;t<A.length;t+=1)A[t].m(f,null);m=!0},p(t,n){if(1&n){let r;for(g=t[0].xDataStores,r=0;r<g.length;r+=1){const s=EIt(t,g,r);y[r]?(y[r].p(s,n),FE(y[r],1)):(y[r]=CIt(s),y[r].c(),FE(y[r],1),y[r].m(e,i))}for(LE(),r=g.length;r<y.length;r+=1)b(r);DE()}if(1&n){let r;for(v=t[0].xModels,r=0;r<v.length;r+=1){const i=TIt(t,v,r);x[r]?(x[r].p(i,n),FE(x[r],1)):(x[r]=AIt(i),x[r].c(),FE(x[r],1),x[r].m(e,a))}for(LE(),r=v.length;r<x.length;r+=1)w(r);DE()}if(1&n){let r;for(S=t[0].xDatasets,r=0;r<S.length;r+=1){const i=kIt(t,S,r);_[r]?(_[r].p(i,n),FE(_[r],1)):(_[r]=NIt(i),_[r].c(),FE(_[r],1),_[r].m(e,u))}for(LE(),r=S.length;r<_.length;r+=1)k(r);DE()}if(1&n){let r;for(T=t[0].xPredictions,r=0;r<T.length;r+=1){const i=_It(t,T,r);E[r]?(E[r].p(i,n),FE(E[r],1)):(E[r]=IIt(i),E[r].c(),FE(E[r],1),E[r].m(e,null))}for(LE(),r=T.length;r<E.length;r+=1)M(r);DE()}if(1&n){let e;for(C=t[0].components,e=0;e<C.length;e+=1){const r=wIt(t,C,e);A[e]?A[e].p(r,n):(A[e]=LIt(r),A[e].c(),A[e].m(f,null))}for(;e<A.length;e+=1)A[e].d(1);A.length=C.length}},i(t){if(!m){for(let t=0;t<g.length;t+=1)FE(y[t]);for(let t=0;t<v.length;t+=1)FE(x[t]);for(let t=0;t<S.length;t+=1)FE(_[t]);for(let t=0;t<T.length;t+=1)FE(E[t]);m=!0}},o(t){y=y.filter(Boolean);for(let t=0;t<y.length;t+=1)zE(y[t]);x=x.filter(Boolean);for(let t=0;t<x.length;t+=1)zE(x[t]);_=_.filter(Boolean);for(let t=0;t<_.length;t+=1)zE(_[t]);E=E.filter(Boolean);for(let t=0;t<E.length;t+=1)zE(E[t]);m=!1},d(t){t&&DT(e),FT(y,t),FT(x,t),FT(_,t),FT(E,t),t&&DT(p),t&&DT(f),FT(A,t)}}}function CIt(t){let e,n,r;return n=new sIt({props:{dataStore:t[16]}}),{c(){e=zT("div"),YE(n.$$.fragment),GT(e,"class","card")},m(t,i){LT(t,e,i),KE(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.dataStore=t[16]),n.$set(r)},i(t){r||(FE(n.$$.fragment,t),r=!0)},o(t){zE(n.$$.fragment,t),r=!1},d(t){t&&DT(e),ZE(n)}}}function AIt(t){let e,n,r;return n=new hIt({props:{model:t[13]}}),{c(){e=zT("div"),YE(n.$$.fragment),GT(e,"class","card")},m(t,i){LT(t,e,i),KE(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.model=t[13]),n.$set(r)},i(t){r||(FE(n.$$.fragment,t),r=!0)},o(t){zE(n.$$.fragment,t),r=!1},d(t){t&&DT(e),ZE(n)}}}function NIt(t){let e,n,r;return n=new YNt({props:{dataset:t[10]}}),{c(){e=zT("div"),YE(n.$$.fragment),GT(e,"class","card")},m(t,i){LT(t,e,i),KE(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.dataset=t[10]),n.$set(r)},i(t){r||(FE(n.$$.fragment,t),r=!0)},o(t){zE(n.$$.fragment,t),r=!1},d(t){t&&DT(e),ZE(n)}}}function IIt(t){let e,n,r,i;return n=new xIt({props:{prediction:t[7]}}),{c(){e=zT("div"),YE(n.$$.fragment),r=VT(),GT(e,"class","card")},m(t,s){LT(t,e,s),KE(n,e,null),RT(e,r),i=!0},p(t,e){const r={};1&e&&(r.prediction=t[7]),n.$set(r)},i(t){i||(FE(n.$$.fragment,t),i=!0)},o(t){zE(n.$$.fragment,t),i=!1},d(t){t&&DT(e),ZE(n)}}}function $It(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[1].id),GT(e,"class","card")},m(t,n){LT(t,e,n)},p(t,r){1&r&&n!==(n=t[1].id)&&GT(e,"id",n)},d(t){t&&DT(e)}}}function RIt(t){let e,n,r=t[1]+"";return{c(){e=zT("h2"),n=UT(r)},m(t,r){LT(t,e,r),RT(e,n)},p(t,e){1&e&&r!==(r=t[1]+"")&&XT(n,r)},d(t){t&&DT(e)}}}function OIt(t){let e,n,r=t[1],i=[];for(let e=0;e<r.length;e+=1)i[e]=PIt(SIt(t,r,e));return{c(){e=zT("div");for(let t=0;t<i.length;t+=1)i[t].c();n=VT(),GT(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){LT(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);RT(e,n)},p(t,s){if(1&s){let o;for(r=t[1],o=0;o<r.length;o+=1){const a=SIt(t,r,o);i[o]?i[o].p(a,s):(i[o]=PIt(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&DT(e),FT(i,t)}}}function PIt(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[4]),GT(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){LT(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&GT(e,"id",n)},d(t){t&&DT(e)}}}function LIt(t){let e,n;function r(t,n){return 1&n&&(e=null),null==e&&(e=!!Array.isArray(t[1])),e?OIt:"string"==typeof t[1]?RIt:$It}let i=r(t,-1),s=i(t);return{c(){s.c(),n=jT()},m(t,e){s.m(t,e),LT(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&DT(n)}}}function DIt(t){let e,n,r=t[0]&&MIt(t);return{c(){r&&r.c(),e=jT()},m(t,i){r&&r.m(t,i),LT(t,e,i),n=!0},p(t,[n]){t[0]?r?(r.p(t,n),1&n&&FE(r,1)):(r=MIt(t),r.c(),FE(r,1),r.m(e.parentNode,e)):r&&(LE(),zE(r,1,1,(()=>{r=null})),DE())},i(t){n||(FE(r),n=!0)},o(t){zE(r),n=!1},d(t){r&&r.d(t),t&&DT(e)}}}function FIt(t,e,n){let{settings:r}=e;return dE((()=>{r.mount()})),t.$$set=t=>{"settings"in t&&n(0,r=t.settings)},[r]}class zIt extends QE{constructor(t){super(),JE(this,t,FIt,DIt,gT,{settings:0})}}function BIt(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r[11]=n,r}function UIt(t){let e,n,r,i,s=t[9]+"";return{c(){e=zT("a"),n=UT(s),r=VT(),GT(e,"href",i=`#${t[8]}`),GT(e,"class","ml-2 mr-5 flex items-center hover:text-black border-solid border-0 border-b-2 border-transparent svelte-1ut593v"),tE(e,"active",!t[4]&&t[2]===t[9])},m(t,i){LT(t,e,i),RT(e,n),RT(e,r)},p(t,r){2&r&&s!==(s=t[9]+"")&&XT(n,s),2&r&&i!==(i=`#${t[8]}`)&&GT(e,"href",i),22&r&&tE(e,"active",!t[4]&&t[2]===t[9])},d(t){t&&DT(e)}}}function VIt(t){let e,n,r;return{c(){e=BT("svg"),n=BT("circle"),r=BT("path"),GT(n,"cx","12"),GT(n,"cy","12"),GT(n,"r","3"),GT(r,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"width","24"),GT(e,"height","24"),GT(e,"viewBox","0 0 24 24"),GT(e,"fill","none"),GT(e,"stroke","currentColor"),GT(e,"stroke-width","2"),GT(e,"stroke-linecap","round"),GT(e,"stroke-linejoin","round"),GT(e,"class","feather feather-settings")},m(t,i){LT(t,e,i),RT(e,n),RT(e,r)},p:uT,d(t){t&&DT(e)}}}function jIt(t){let e,n,r,i;return e=new nM({props:{round:!0,type:"danger",$$slots:{default:[WIt]},$$scope:{ctx:t}}}),e.$on("click",t[5]),{c(){YE(e.$$.fragment),n=VT(),r=zT("span"),GT(r,"class","w-1")},m(t,s){KE(e,t,s),LT(t,n,s),LT(t,r,s),i=!0},p(t,n){const r={};4096&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(FE(e.$$.fragment,t),i=!0)},o(t){zE(e.$$.fragment,t),i=!1},d(t){ZE(e,t),t&&DT(n),t&&DT(r)}}}function WIt(t){let e,n,r;return{c(){e=BT("svg"),n=BT("path"),r=BT("line"),GT(n,"d","M18.36 6.64a9 9 0 1 1-12.73 0"),GT(r,"x1","12"),GT(r,"y1","2"),GT(r,"x2","12"),GT(r,"y2","12"),GT(e,"xmlns","http://www.w3.org/2000/svg"),GT(e,"width","24"),GT(e,"height","24"),GT(e,"viewBox","0 0 24 24"),GT(e,"fill","none"),GT(e,"stroke","currentColor"),GT(e,"stroke-width","2"),GT(e,"stroke-linecap","round"),GT(e,"stroke-linejoin","round"),GT(e,"class","feather feather-power")},m(t,i){LT(t,e,i),RT(e,n),RT(e,r)},p:uT,d(t){t&&DT(e)}}}function HIt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m=Object.entries(t[1]),g=[];for(let e=0;e<m.length;e+=1)g[e]=UIt(BIt(t,m,e));u=new nM({props:{round:!0,$$slots:{default:[VIt]},$$scope:{ctx:t}}}),u.$on("click",t[6]);let y=t[3]&&jIt(t);return{c(){e=zT("header"),n=zT("div"),r=zT("a"),i=zT("span"),s=UT(t[0]),o=VT(),a=zT("nav");for(let t=0;t<g.length;t+=1)g[t].c();l=VT(),c=zT("div"),YE(u.$$.fragment),h=VT(),d=zT("span"),p=VT(),y&&y.c(),GT(i,"class","mx-3 text-lg"),GT(r,"href","#/"),GT(r,"class","flex p-3 title-font font-medium items-center text-gray-900 mb-4 md:mb-0 border-solid border-0 border-r border-gray-200 svelte-1ut593v"),GT(a,"class","flex items-stretch justify-start flex-wrap text-base grow mx-4"),GT(d,"class","w-1"),GT(c,"class","flex items-center"),GT(n,"class","mx-auto flex flex-wrap flex-col md:flex-row items-stretch w-full"),GT(e,"class","bg-white text-gray-700 body-font")},m(t,m){LT(t,e,m),RT(e,n),RT(n,r),RT(r,i),RT(i,s),RT(n,o),RT(n,a);for(let t=0;t<g.length;t+=1)g[t].m(a,null);RT(n,l),RT(n,c),KE(u,c,null),RT(c,h),RT(c,d),RT(c,p),y&&y.m(c,null),f=!0},p(t,[e]){if((!f||1&e)&&XT(s,t[0]),22&e){let n;for(m=Object.entries(t[1]),n=0;n<m.length;n+=1){const r=BIt(t,m,n);g[n]?g[n].p(r,e):(g[n]=UIt(r),g[n].c(),g[n].m(a,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=m.length}const n={};4096&e&&(n.$$scope={dirty:e,ctx:t}),u.$set(n),t[3]?y?(y.p(t,e),8&e&&FE(y,1)):(y=jIt(t),y.c(),FE(y,1),y.m(c,null)):y&&(LE(),zE(y,1,1,(()=>{y=null})),DE())},i(t){f||(FE(u.$$.fragment,t),FE(y),f=!0)},o(t){zE(u.$$.fragment,t),zE(y),f=!1},d(t){t&&DT(e),FT(g,t),ZE(u),y&&y.d()}}}function GIt(t,e,n){let{title:r}=e,{items:i}=e,{current:s}=e,{closable:o}=e,{showSettings:a=!1}=e;const l=fE();return t.$$set=t=>{"title"in t&&n(0,r=t.title),"items"in t&&n(1,i=t.items),"current"in t&&n(2,s=t.current),"closable"in t&&n(3,o=t.closable),"showSettings"in t&&n(4,a=t.showSettings)},[r,i,s,o,a,function(){setTimeout((()=>{l("quit")}),400)},function(){window.location.href=a?window.location.href.split("#")[0]+"#"+Object.keys(i)[Object.values(i).indexOf(s)]:window.location.href.split("#")[0]+"#settings"}]}class qIt extends QE{constructor(t){super(),JE(this,t,GIt,HIt,gT,{title:0,items:1,current:2,closable:3,showSettings:4,quit:5})}get quit(){return this.$$.ctx[5]}}function XIt(t){let e;return{c(){e=UT("")},m(t,n){LT(t,e,n)},p:uT,d(t){t&&DT(e)}}}function YIt(t){let e;function n(t,e){return t[1][0]===sU.Warning?JIt:t[1][0]===sU.Error?ZIt:KIt}let r=n(t),i=r(t);return{c(){i.c(),e=jT()},m(t,n){i.m(t,n),LT(t,e,n)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},d(t){i.d(t),t&&DT(e)}}}function KIt(t){let e,n=(t[1][1]||"")+"";return{c(){e=UT(n)},m(t,n){LT(t,e,n)},p(t,r){2&r&&n!==(n=(t[1][1]||"")+"")&&XT(e,n)},d(t){t&&DT(e)}}}function ZIt(t){let e,n,r=(t[1][1]||"")+"";return{c(){e=UT("Err:\n        "),n=UT(r)},m(t,r){LT(t,e,r),LT(t,n,r)},p(t,e){2&e&&r!==(r=(t[1][1]||"")+"")&&XT(n,r)},d(t){t&&DT(e),t&&DT(n)}}}function JIt(t){let e,n,r=(t[1][1]||"")+"";return{c(){e=UT("Warn:\n        "),n=UT(r)},m(t,r){LT(t,e,r),LT(t,n,r)},p(t,e){2&e&&r!==(r=(t[1][1]||"")+"")&&XT(n,r)},d(t){t&&DT(e),t&&DT(n)}}}function QIt(t){let e,n,r,i,s,o;function a(t,e){return t[1]?YIt:XIt}let l=a(t),c=l(t);return{c(){e=zT("footer"),n=zT("p"),c.c(),r=VT(),i=zT("p"),s=UT(" 2021 "),o=UT(t[0]),GT(n,"class","console svelte-i04gf3"),tE(n,"error",t[1]&&t[1][0]===sU.Error),tE(n,"warning",t[1]&&t[1][0]===sU.Warning),GT(i,"class","text-sm text-gray-500 sm:ml-4 sm:pl-4 sm:border-gray-200"),GT(e,"class","bg-white text-gray-600 border-t px-5 py-1 flex items-center justify-between flex-col sm:flex-row")},m(t,a){LT(t,e,a),RT(e,n),c.m(n,null),RT(e,r),RT(e,i),RT(i,s),RT(i,o)},p(t,[e]){l===(l=a(t))&&c?c.p(t,e):(c.d(1),c=l(t),c&&(c.c(),c.m(n,null))),2&e&&tE(n,"error",t[1]&&t[1][0]===sU.Error),2&e&&tE(n,"warning",t[1]&&t[1][0]===sU.Warning),1&e&&XT(o,t[0])},i:uT,o:uT,d(t){t&&DT(e),c.d()}}}function t$t(t,e,n){let r,{author:i}=e;const s=lU();return wT(t,s,(t=>n(1,r=t))),t.$$set=t=>{"author"in t&&n(0,i=t.author)},[i,r,s]}class e$t extends QE{constructor(t){super(),JE(this,t,t$t,QIt,gT,{author:0})}}function n$t(t){let e,n,r,i,s,o,a,l,c,u,h;r=new qIt({props:{title:t[0],items:t[10].reduce(t[12],{}),current:t[9],showSettings:t[8],closable:t[4]}}),r.$on("quit",t[5]);const d=[i$t,r$t],p=[];function f(t,e){return t[8]?0:t[9]?1:-1}return~(o=f(t))&&(a=p[o]=d[o](t)),c=new e$t({props:{author:t[1]}}),{c(){e=zT("div"),n=zT("div"),YE(r.$$.fragment),i=VT(),s=zT("main"),a&&a.c(),l=VT(),YE(c.$$.fragment),GT(s,"class","main-container svelte-1da5cws"),GT(n,"class","app-container svelte-1da5cws"),GT(e,"class","marcelle fixed h-screen w-full max-w-full overflow-y-scroll overflow-x-hidden top-0 left-0 z-50")},m(t,a){LT(t,e,a),RT(e,n),KE(r,n,null),RT(n,i),RT(n,s),~o&&p[o].m(s,null),RT(n,l),KE(c,n,null),h=!0},p(e,n){t=e;const i={};1&n&&(i.title=t[0]),1088&n&&(i.items=t[10].reduce(t[12],{})),512&n&&(i.current=t[9]),256&n&&(i.showSettings=t[8]),16&n&&(i.closable=t[4]),r.$set(i);let l=o;o=f(t),o===l?~o&&p[o].p(t,n):(a&&(LE(),zE(p[l],1,1,(()=>{p[l]=null})),DE()),~o?(a=p[o],a?a.p(t,n):(a=p[o]=d[o](t),a.c()),FE(a,1),a.m(s,null)):a=null);const u={};2&n&&(u.author=t[1]),c.$set(u)},i(e){h||(FE(r.$$.fragment,e),FE(a),FE(c.$$.fragment,e),TE((()=>{u||(u=UE(n,hM,{amount:10,duration:t[4]?400:0},!0)),u.run(1)})),h=!0)},o(e){zE(r.$$.fragment,e),zE(a),zE(c.$$.fragment,e),u||(u=UE(n,hM,{amount:10,duration:t[4]?400:0},!1)),u.run(0),h=!1},d(t){t&&DT(e),ZE(r),~o&&p[o].d(),ZE(c),t&&u&&u.end()}}}function r$t(t){let e,n;return e=new BNt({props:{dashboard:t[2][t[9]]}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};516&n&&(r.dashboard=t[2][t[9]]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function i$t(t){let e,n;return e=new zIt({props:{settings:t[3]}}),{c(){YE(e.$$.fragment)},m(t,r){KE(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.settings=t[3]),e.$set(r)},i(t){n||(FE(e.$$.fragment,t),n=!0)},o(t){zE(e.$$.fragment,t),n=!1},d(t){ZE(e,t)}}}function s$t(t){let e,n,r,i;document.title=e=t[0];let s=t[7]&&n$t(t);return{c(){n=VT(),s&&s.c(),r=jT()},m(t,e){LT(t,n,e),s&&s.m(t,e),LT(t,r,e),i=!0},p(t,[n]){(!i||1&n)&&e!==(e=t[0])&&(document.title=e),t[7]?s?(s.p(t,n),128&n&&FE(s,1)):(s=n$t(t),s.c(),FE(s,1),s.m(r.parentNode,r)):s&&(LE(),zE(s,1,1,(()=>{s=null})),DE())},i(t){i||(FE(s),i=!0)},o(t){zE(s),i=!1},d(t){t&&DT(n),s&&s.d(t),t&&DT(r)}}}function o$t(t){let e=t.replace(/^\s+|\s+$/g,"");e=e.toLowerCase();const n="/_,:;";for(let t=0,r=n.length;t<r;t++)e=e.replace(new RegExp(n.charAt(t),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(t));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e}function a$t(t,e,n){let r,i;const s=fE();let{title:o}=e,{author:a}=e,{dashboards:l={}}=e,{settings:c}=e,{page:u}=e,{closable:h}=e,d=!1;hE((()=>{n(7,d=!0)}));let p=!1,f=Object.keys(l)[0]||void 0;hE((()=>{try{const t=new ENt;t.route("settings",(()=>{n(8,p=!0),f&&l[f].destroy(),u.set("settings")})),i.forEach(((e,i)=>{t.route(e,(()=>{n(8,p=!1),f!==r[i]&&(f&&l[f].destroy(),n(9,f=r[i]),u.set(""===e?o$t(r[0]):e))}))}))}catch(t){console.log("Could not enable router",t)}}));return t.$$set=t=>{"title"in t&&n(0,o=t.title),"author"in t&&n(1,a=t.author),"dashboards"in t&&n(2,l=t.dashboards),"settings"in t&&n(3,c=t.settings),"page"in t&&n(11,u=t.page),"closable"in t&&n(4,h=t.closable)},t.$$.update=()=>{4&t.$$.dirty&&n(6,r=Object.keys(l)),64&t.$$.dirty&&n(10,i=[""].concat(r.slice(1).map(o$t)))},[o,a,l,c,h,function(){n(7,d=!1),setTimeout((()=>{s("quit")}),400)},r,d,p,f,i,u,(t,e,n)=>({...t,[e]:r[n]})]}class l$t extends QE{constructor(t){super(),JE(this,t,a$t,s$t,gT,{title:0,author:1,dashboards:2,settings:3,page:11,closable:4,quit:5})}get quit(){return this.$$.ctx[5]}}function c$t(t){return"string"==typeof t}function u$t(t){return Array.isArray(t)}class h$t{constructor(){this.name="settings",this.components=[],this.xModels=[],this.xDatasets=[],this.xPredictions=[],this.xDataStores=[]}use(...t){return this.components=this.components.concat(t),this}dataStores(...t){return this.xDataStores=t,this}models(...t){return this.xModels=t,this}datasets(...t){return this.xDatasets=t,this}predictions(...t){return this.xPredictions=t,this}mount(){for(const t of this.components)if(u$t(t))for(const e of t)e.mount();else c$t(t)||t.mount()}destroy(){for(const t of this.components)if(u$t(t))for(const e of t)e.destroy();else c$t(t)||t.destroy()}}class d$t{constructor({title:t="Hello, Marcelle!",author:e="author",closable:n=!1}){this.panels={},this.settings=new h$t,this.$active=new rU(!1,!0),this.$page=new rU("",!0),this.title=t,this.author=e,this.closable=n}page(t,e){return Object.keys(this.panels).includes(t)||(this.panels[t]=new _Nt(t,e)),this.panels[t]}show(){this.app=new l$t({target:document.body,props:{title:this.title,author:this.author,dashboards:this.panels,settings:this.settings,page:this.$page,closable:this.closable}}),this.$active.set(!0),this.app.$on("quit",(()=>{var t;this.$active.set(!1),null===(t=this.app)||void 0===t||t.$destroy();for(const t of Object.values(this.panels))t.destroy();this.app=void 0}))}hide(){var t;null===(t=this.app)||void 0===t||t.quit()}}function p$t(t){return new d$t(t)}function f$t(t,e,n){const r=t.slice();return r[4]=e[n],r}function m$t(t,e,n){const r=t.slice();return r[7]=e[n].id,r}function g$t(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[4].id)},m(t,n){LT(t,e,n)},p(t,r){8&r&&n!==(n=t[4].id)&&GT(e,"id",n)},d(t){t&&DT(e)}}}function y$t(t){let e,n,r=t[4],i=[];for(let e=0;e<r.length;e+=1)i[e]=b$t(m$t(t,r,e));return{c(){e=zT("div");for(let t=0;t<i.length;t+=1)i[t].c();n=VT(),GT(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){LT(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);RT(e,n)},p(t,s){if(8&s){let o;for(r=t[4],o=0;o<r.length;o+=1){const a=m$t(t,r,o);i[o]?i[o].p(a,s):(i[o]=b$t(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&DT(e),FT(i,t)}}}function b$t(t){let e,n;return{c(){e=zT("div"),GT(e,"id",n=t[7]),GT(e,"class","flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){LT(t,e,n)},p(t,r){8&r&&n!==(n=t[7])&&GT(e,"id",n)},d(t){t&&DT(e)}}}function v$t(t){let e,n;function r(t,n){return 8&n&&(e=null),null==e&&(e=!!Array.isArray(t[4])),e?y$t:g$t}let i=r(t,-1),s=i(t);return{c(){s.c(),n=jT()},m(t,e){s.m(t,e),LT(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&DT(n)}}}function x$t(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m=t[3],g=[];for(let e=0;e<m.length;e+=1)g[e]=v$t(f$t(t,m,e));return{c(){e=zT("div"),n=zT("div"),r=zT("div"),i=zT("h3"),s=UT(t[0]),o=UT(".\n        "),a=UT(t[1]),l=VT(),c=zT("div"),u=zT("p"),h=UT(t[2]),d=VT(),p=zT("div"),f=zT("div");for(let t=0;t<g.length;t+=1)g[t].c();GT(i,"class","text-lg leading-6 font-medium text-gray-900"),GT(i,"id","modal-headline"),GT(u,"class","text-sm leading-5 text-gray-500"),GT(c,"class","mt-2"),GT(r,"class","desc svelte-tq2nfn"),GT(f,"class","text-center"),GT(p,"class","components svelte-tq2nfn"),GT(n,"class","flex flex-col w-full"),GT(e,"class","bg-white px-4 pt-2 pb-4 sm:px-6 sm:pb-4 flex")},m(t,m){LT(t,e,m),RT(e,n),RT(n,r),RT(r,i),RT(i,s),RT(i,o),RT(i,a),RT(r,l),RT(r,c),RT(c,u),RT(u,h),RT(n,d),RT(n,p),RT(p,f);for(let t=0;t<g.length;t+=1)g[t].m(f,null)},p(t,[e]){if(1&e&&XT(s,t[0]),2&e&&XT(a,t[1]),4&e&&XT(h,t[2]),8&e){let n;for(m=t[3],n=0;n<m.length;n+=1){const r=f$t(t,m,n);g[n]?g[n].p(r,e):(g[n]=v$t(r),g[n].c(),g[n].m(f,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=m.length}},i:uT,o:uT,d(t){t&&DT(e),FT(g,t)}}}function w$t(t,e,n){let{index:r}=e,{title:i}=e,{description:s}=e,{components:o=[]}=e;return t.$$set=t=>{"index"in t&&n(0,r=t.index),"title"in t&&n(1,i=t.title),"description"in t&&n(2,s=t.description),"components"in t&&n(3,o=t.components)},[r,i,s,o]}class S$t extends QE{constructor(t){super(),JE(this,t,w$t,x$t,gT,{index:0,title:1,description:2,components:3})}}function _$t(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function k$t(t){let e;return{c(){e=UT("Close")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function T$t(t){let e,n,r;function i(){return t[6](t[12])}return{c(){e=zT("button"),GT(e,"class","page-button svelte-1r1rt01"),tE(e,"current",t[3]===t[12])},m(t,s){LT(t,e,s),n||(r=WT(e,"click",i),n=!0)},p(n,r){t=n,8&r&&tE(e,"current",t[3]===t[12])},d(t){t&&DT(e),n=!1,r()}}}function E$t(t){let e;return{c(){e=UT("Previous")},m(t,n){LT(t,e,n)},d(t){t&&DT(e)}}}function M$t(t){let e,n=t[3]>=t[0].length-1?"Finish":"Next";return{c(){e=UT(n)},m(t,n){LT(t,e,n)},p(t,r){9&r&&n!==(n=t[3]>=t[0].length-1?"Finish":"Next")&&XT(e,n)},d(t){t&&DT(e)}}}function C$t(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x;o=new S$t({props:{title:t[0][t[3]].attr.title,description:t[0][t[3]].attr.description,components:t[0][t[3]].components,index:t[3]+1}}),u=new nM({props:{type:"danger",$$slots:{default:[k$t]},$$scope:{ctx:t}}}),u.$on("click",t[2]);let w=Array(t[0].length),S=[];for(let e=0;e<w.length;e+=1)S[e]=T$t(_$t(t,w,e));return m=new nM({props:{disabled:t[3]<=0,$$slots:{default:[E$t]},$$scope:{ctx:t}}}),m.$on("click",t[7]),y=new nM({props:{variant:"filled",type:t[3]>=t[0].length-1?"success":"default",$$slots:{default:[M$t]},$$scope:{ctx:t}}}),y.$on("click",t[8]),{c(){e=zT("div"),n=zT("div"),r=zT("div"),i=VT(),s=zT("div"),YE(o.$$.fragment),a=VT(),l=zT("div"),c=zT("div"),YE(u.$$.fragment),h=VT(),d=zT("div");for(let t=0;t<S.length;t+=1)S[t].c();p=VT(),f=zT("div"),YE(m.$$.fragment),g=VT(),YE(y.$$.fragment),GT(r,"class","absolute inset-0 bg-gray-500 opacity-50"),GT(n,"class","absolute min-h-screen inset-0 transition-opacity"),GT(d,"class","text-center"),GT(f,"class","text-right"),GT(l,"class","bg-white border-t border-gray-300 px-4 py-2 grid grid-cols-3"),GT(s,"class","bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-3xl sm:w-full"),GT(e,"class","marcelle wizard svelte-1r1rt01")},m(w,_){LT(w,e,_),RT(e,n),RT(n,r),RT(e,i),RT(e,s),KE(o,s,null),RT(s,a),RT(s,l),RT(l,c),KE(u,c,null),RT(l,h),RT(l,d);for(let t=0;t<S.length;t+=1)S[t].m(d,null);RT(l,p),RT(l,f),KE(m,f,null),RT(f,g),KE(y,f,null),b=!0,v||(x=WT(r,"click",t[5]),v=!0)},p(t,[e]){const n={};9&e&&(n.title=t[0][t[3]].attr.title),9&e&&(n.description=t[0][t[3]].attr.description),9&e&&(n.components=t[0][t[3]].components),8&e&&(n.index=t[3]+1),o.$set(n);const r={};if(8192&e&&(r.$$scope={dirty:e,ctx:t}),u.$set(r),25&e){let n;for(w=Array(t[0].length),n=0;n<w.length;n+=1){const r=_$t(t,w,n);S[n]?S[n].p(r,e):(S[n]=T$t(r),S[n].c(),S[n].m(d,null))}for(;n<S.length;n+=1)S[n].d(1);S.length=w.length}const i={};8&e&&(i.disabled=t[3]<=0),8192&e&&(i.$$scope={dirty:e,ctx:t}),m.$set(i);const s={};9&e&&(s.type=t[3]>=t[0].length-1?"success":"default"),8201&e&&(s.$$scope={dirty:e,ctx:t}),y.$set(s)},i(t){b||(FE(o.$$.fragment,t),FE(u.$$.fragment,t),FE(m.$$.fragment,t),FE(y.$$.fragment,t),b=!0)},o(t){zE(o.$$.fragment,t),zE(u.$$.fragment,t),zE(m.$$.fragment,t),zE(y.$$.fragment,t),b=!1},d(t){t&&DT(e),ZE(o),ZE(u),FT(S,t),ZE(m),ZE(y),v=!1,x()}}}function A$t(t,e,n){let r,i=uT,s=()=>(i(),i=vT(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{pages:o}=e,{current:a}=e;function l(t){if(t>=0&&t<=o.length-1){for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.destroy();else t.destroy();a.set(t)}}s(),dE((()=>{for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.mount();else t.mount()})),pE((()=>{for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.destroy();else t.destroy()}));const c=fE();function u(){c("quit")}return t.$$set=t=>{"pages"in t&&n(0,o=t.pages),"current"in t&&s(n(1,a=t.current))},[o,a,u,r,l,function(){u()},t=>l(t),()=>{l(r-1)},()=>{a.get()<o.length-1?l(r+1):u()}]}class N$t extends QE{constructor(t){super(),JE(this,t,A$t,C$t,gT,{pages:0,current:1,quit:2})}get quit(){return this.$$.ctx[2]}}class I$t{constructor(t){this.pageFn=t,this.components=[],this.attr={title:"",description:""}}title(t){return this.attr.title=t,this}description(t){return this.attr.description=t,this}use(...t){return this.components=this.components.concat(t),this}page(){return this.pageFn()}}class $$t{constructor(){this.pages=[],this.app=void 0,this.$current=new rU(0,!0),this.$current.start()}page(){const t=new I$t(this.page.bind(this));return this.pages.push(t),t}show(){this.app=new N$t({target:document.body,props:{pages:this.pages,current:this.$current}}),this.app.$on("quit",(()=>{var t;null===(t=this.app)||void 0===t||t.$destroy(),this.app=void 0}))}hide(){var t;null===(t=this.app)||void 0===t||t.quit()}}function R$t(){return new $$t}export{gU as ArrayIterable,SU as Component,mU as LazyIterable,sU as LogLevel,MX as Model,Tq as ServiceIterable,rU as Stream,Z2 as TFJSBaseModel,R3 as TFJSCustomClassifier,$3 as TFJSCustomModel,W3 as account,Q3 as batchPrediction,a4 as button,x4 as cocoSsd,Ost as confidencePlot,tot as confusionMatrix,iU as createStream,p$t as dashboard,Cq as dataStore,TX as dataset,N3 as dataset2tfjs,bot as datasetBrowser,Xat as datasetScatter,llt as datasetTable,flt as detectionBoxes,Slt as fileUpload,_st as genericChart,lU as getLogStream,Clt as imageDisplay,Xlt as imageUpload,EX as isDataset,nU as isStream,yU as iterableFromArray,Eq as iterableFromService,Hct as kmeansClustering,Zct as knnClassifier,aU as logger,vU as mergeDeep,Qct as mlpClassifier,eut as mlpRegressor,xut as mobileNet,Fut as modelParameters,VL as notification,Wut as number,Kut as numberArray,aht as onnxModel,uht as pca,Hpt as poseDetection,t4 as predictionProgress,K3 as progressBar,uEt as scatterPlot,gEt as select,CEt as sketchPad,mMt as slider,Nst as text,wMt as textArea,CMt as textField,MMt as textInput,zMt as tfjsModel,hU as throwError,HMt as toggle,OCt as trainingHistory,rCt as trainingPlot,Z3 as trainingProgress,pNt as umap,xNt as webcam,R$t as wizard};
//# sourceMappingURL=marcelle.bundle.esm.js.map
