!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).marcelle={})}(this,(function(t){"use strict";function e(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class n{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class r{refCount(t){return i("refCount")}incRef(t){return i("incRef")}timerAvailable(){return!0}time(t){return i("time")}read(t){return i("read")}readSync(t){return i("readSync")}readToGPU(t,e){return i("readToGPU")}numDataIds(){return i("numDataIds")}disposeData(t,e){return i("disposeData")}write(t,e,n){return i("write")}move(t,e,n,r,s){return i("move")}memory(){return i("memory")}floatPrecision(){return i("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return i("dispose")}}function i(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function s(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,l(t,e,n)}function o(t,e,n){return Math.max(t,Math.min(e,n))}function a(t){return t%2==0?t:t+1}function l(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function c(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function u(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function h(t,e,n=""){u(m(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function d(t){u(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function p(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||C(t)&&!n)for(let r=0;r<t.length;++r)p(t[r],e,n);else e.push(t);return e}function f(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function m(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function g(t){return t%1==0}function y(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function b(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function v(t,e=(t=>0),n,r=setTimeout){return new Promise(((i,s)=>{let o=0;const a=()=>{if(t())return void i();o++;const l=e(o);null!=n&&o>=n?s():r(a,l)};a()}))}function x(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function w(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),u(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),u(t.every((t=>g(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function _(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:w(e,t).sort();let o=0;for(let e=0;e<t.length;++e){if(null!=s){if(s[o]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==s[o]||s[o]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),s[o]<=e&&o++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function S(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function k(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function T(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function E(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function M(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function C(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function A(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function N(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function I(t){return"string"==typeof t||t instanceof String}function $(t){return"boolean"==typeof t}function R(t){return"number"==typeof t}function O(t){return Array.isArray(t)?O(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":R(t)?"float32":I(t)?"string":$(t)?"bool":"float32"}function P(t){return!!(t&&t.constructor&&t.call&&t.apply)}function L(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function D(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function F(t,e,n,r=!1){const i=new Array;if(1===e.length){const s=e[0]*(r?2:1);for(let e=0;e<s;e++)i[e]=n[t+e]}else{const s=e[0],o=e.slice(1),a=o.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<s;e++)i[e]=F(t+e*a,o,n,r)}return i}function z(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return F(0,t,e,n)}function B(t,e){const n=U(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function U(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function V(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return z(t,new Float32Array(n));if("int32"===e)return z(t,new Int32Array(n));if("bool"===e)return z(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function j(t){t.forEach((e=>{u(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function W(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function H(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function G(t){return t&&t.then&&"function"==typeof t.then}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const q="tfjsflags";class X{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Y,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(G(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if(q in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function Y(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function K(){return J}let Z,J=null;function Q(){if(null==Z){let t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Z=t}return Z}function tt(t,e){const n=function(){const t=Q();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const et="Abs",nt="Acos",rt="Acosh",it="Add",st="AddN",ot="All",at="Any",lt="ArgMax",ct="ArgMin",ut="Asin",ht="Asinh",dt="Atan",pt="Atanh",ft="Atan2",mt="AvgPool",gt="AvgPoolGrad",yt="AvgPool3D",bt="AvgPool3DGrad",vt="BatchMatMul",xt="BatchToSpaceND",wt="Bincount",_t="BroadcastTo",St="BroadcastArgs",kt="Cast",Tt="Ceil",Et="ClipByValue",Mt="Complex",Ct="ComplexAbs",At="Concat",Nt="Conv2D",It="Conv2DBackpropFilter",$t="Conv2DBackpropInput",Rt="Conv3D",Ot="Conv3DBackpropFilterV2",Pt="Conv3DBackpropInputV2",Lt="Cos",Dt="Cosh",Ft="Cumprod",zt="Cumsum",Bt="CropAndResize",Ut="DenseBincount",Vt="DepthToSpace",jt="DepthwiseConv2dNative",Wt="DepthwiseConv2dNativeBackpropFilter",Ht="DepthwiseConv2dNativeBackpropInput",Gt="Diag",qt="Dilation2D",Xt="Dilation2DBackpropInput",Yt="Dilation2DBackpropFilter",Kt="RealDiv",Zt="Einsum",Jt="Elu",Qt="EluGrad",te="Erf",ee="Equal",ne="Exp",re="ExpandDims",ie="Expm1",se="FFT",oe="Fill",ae="FlipLeftRight",le="Floor",ce="FloorDiv",ue="FusedBatchNorm",he="GatherV2",de="GatherNd",pe="Greater",fe="GreaterEqual",me="Identity",ge="IFFT",ye="Imag",be="IsFinite",ve="IsInf",xe="IsNan",we="LeakyRelu",_e="Less",Se="LessEqual",ke="LinSpace",Te="Log",Ee="Log1p",Me="LogicalAnd",Ce="LogicalNot",Ae="LogicalOr",Ne="LogSoftmax",Ie="LRN",$e="LRNGrad",Re="Max",Oe="Maximum",Pe="MaxPool",Le="MaxPoolGrad",De="MaxPool3D",Fe="MaxPool3DGrad",ze="MaxPoolWithArgmax",Be="Mean",Ue="Min",Ve="Minimum",je="MirrorPad",We="Mod",He="Multinomial",Ge="Multiply",qe="Neg",Xe="NotEqual",Ye="NonMaxSuppressionV3",Ke="NonMaxSuppressionV4",Ze="NonMaxSuppressionV5",Je="OnesLike",Qe="OneHot",tn="Pack",en="PadV2",nn="Pow",rn="Prelu",sn="Prod",on="RaggedGather",an="RaggedTensorToTensor",ln="Range",cn="Real",un="Reciprocal",hn="Relu",dn="Reshape",pn="ResizeNearestNeighbor",fn="ResizeNearestNeighborGrad",mn="ResizeBilinear",gn="ResizeBilinearGrad",yn="Relu6",bn="Reverse",vn="Round",xn="Rsqrt",wn="ScatterNd",_n="SearchSorted",Sn="Select",kn="Selu",Tn="Slice",En="Sin",Mn="Sinh",Cn="Sign",An="Sigmoid",Nn="Softplus",In="Sqrt",$n="Sum",Rn="SpaceToBatchND",On="SplitV",Pn="Softmax",Ln="SparseFillEmptyRows",Dn="SparseReshape",Fn="SparseSegmentMean",zn="SparseSegmentSum",Bn="SparseToDense",Un="SquaredDifference",Vn="Square",jn="StridedSlice",Wn="StringNGrams",Hn="StringSplit",Gn="StringToHashBucketFast",qn="Sub",Xn="Tan",Yn="Tanh",Kn="Tile",Zn="TopK",Jn="Transform",Qn="Transpose",tr="Unique",er="Unpack",nr="UnsortedSegmentSum",rr="ZerosLike",ir="Step",sr="FromPixels",or="RotateWithOffset",ar="_FusedMatMul",lr="FusedConv2D",cr="FusedDepthwiseConv2D";
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function ur(...t){K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(...t)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const hr=tt("kernelRegistry",(()=>new Map)),dr=tt("gradRegistry",(()=>new Map));function pr(t,e){const n=br(t,e);return hr.get(n)}function fr(t){return dr.get(t)}function mr(t){const e=hr.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function gr(t){const{kernelName:e,backendName:n}=t,r=br(e,n);hr.has(r)&&ur(`The kernel '${e}' for backend '${n}' is already registered`),hr.set(r,t)}function yr(t){const{kernelName:e}=t;dr.has(e)&&K().getBool("DEBUG")&&ur(`Overriding the gradient for '${e}'`),dr.set(e,t)}function br(t,e){return`${e}_${t}`}var vr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function xr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function wr(t){var e=t.default;if("function"==typeof e){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var _r=kr,Sr=null;try{Sr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function kr(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function Tr(t){return!0===(t&&t.__isLong__)}kr.prototype.__isLong__,Object.defineProperty(kr.prototype,"__isLong__",{value:!0}),kr.isLong=Tr;var Er={},Mr={};function Cr(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=Mr[t])?r:(n=Nr(t,(0|t)<0?-1:0,!0),i&&(Mr[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=Er[t])?r:(n=Nr(t,t<0?-1:0,!1),i&&(Er[t]=n),n)}function Ar(t,e){if(isNaN(t))return e?zr:Fr;if(e){if(t<0)return zr;if(t>=Pr)return Wr}else{if(t<=-Lr)return Hr;if(t+1>=Lr)return jr}return t<0?Ar(-t,e).neg():Nr(t%Or|0,t/Or|0,e)}function Nr(t,e,n){return new kr(t,e,n)}kr.fromInt=Cr,kr.fromNumber=Ar,kr.fromBits=Nr;var Ir=Math.pow;function $r(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Fr;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return $r(t.substring(1),e,n).neg();for(var i=Ar(Ir(n,8)),s=Fr,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=Ar(Ir(n,a));s=s.mul(c).add(Ar(l))}else s=(s=s.mul(i)).add(Ar(l))}return s.unsigned=e,s}function Rr(t,e){return"number"==typeof t?Ar(t,e):"string"==typeof t?$r(t,e):Nr(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}kr.fromString=$r,kr.fromValue=Rr;var Or=4294967296,Pr=Or*Or,Lr=Pr/2,Dr=Cr(1<<24),Fr=Cr(0);kr.ZERO=Fr;var zr=Cr(0,!0);kr.UZERO=zr;var Br=Cr(1);kr.ONE=Br;var Ur=Cr(1,!0);kr.UONE=Ur;var Vr=Cr(-1);kr.NEG_ONE=Vr;var jr=Nr(-1,2147483647,!1);kr.MAX_VALUE=jr;var Wr=Nr(-1,-1,!0);kr.MAX_UNSIGNED_VALUE=Wr;var Hr=Nr(0,-2147483648,!1);kr.MIN_VALUE=Hr;var Gr=kr.prototype;Gr.toInt=function(){return this.unsigned?this.low>>>0:this.low},Gr.toNumber=function(){return this.unsigned?(this.high>>>0)*Or+(this.low>>>0):this.high*Or+(this.low>>>0)},Gr.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Hr)){var e=Ar(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=Ar(Ir(t,6),this.unsigned),s=this,o="";;){var a=s.div(i),l=(s.sub(a.mul(i)).toInt()>>>0).toString(t);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},Gr.getHighBits=function(){return this.high},Gr.getHighBitsUnsigned=function(){return this.high>>>0},Gr.getLowBits=function(){return this.low},Gr.getLowBitsUnsigned=function(){return this.low>>>0},Gr.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Hr)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Gr.isZero=function(){return 0===this.high&&0===this.low},Gr.eqz=Gr.isZero,Gr.isNegative=function(){return!this.unsigned&&this.high<0},Gr.isPositive=function(){return this.unsigned||this.high>=0},Gr.isOdd=function(){return 1==(1&this.low)},Gr.isEven=function(){return 0==(1&this.low)},Gr.equals=function(t){return Tr(t)||(t=Rr(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Gr.eq=Gr.equals,Gr.notEquals=function(t){return!this.eq(t)},Gr.neq=Gr.notEquals,Gr.ne=Gr.notEquals,Gr.lessThan=function(t){return this.comp(t)<0},Gr.lt=Gr.lessThan,Gr.lessThanOrEqual=function(t){return this.comp(t)<=0},Gr.lte=Gr.lessThanOrEqual,Gr.le=Gr.lessThanOrEqual,Gr.greaterThan=function(t){return this.comp(t)>0},Gr.gt=Gr.greaterThan,Gr.greaterThanOrEqual=function(t){return this.comp(t)>=0},Gr.gte=Gr.greaterThanOrEqual,Gr.ge=Gr.greaterThanOrEqual,Gr.compare=function(t){if(Tr(t)||(t=Rr(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Gr.comp=Gr.compare,Gr.negate=function(){return!this.unsigned&&this.eq(Hr)?Hr:this.not().add(Br)},Gr.neg=Gr.negate,Gr.add=function(t){Tr(t)||(t=Rr(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=0,c=0,u=0,h=0;return u+=(h+=i+(65535&t.low))>>>16,c+=(u+=r+a)>>>16,l+=(c+=n+o)>>>16,l+=e+s,Nr((u&=65535)<<16|(h&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},Gr.subtract=function(t){return Tr(t)||(t=Rr(t)),this.add(t.neg())},Gr.sub=Gr.subtract,Gr.multiply=function(t){if(this.isZero())return Fr;if(Tr(t)||(t=Rr(t)),Sr)return Nr(Sr.mul(this.low,this.high,t.low,t.high),Sr.get_high(),this.unsigned);if(t.isZero())return Fr;if(this.eq(Hr))return t.isOdd()?Hr:Fr;if(t.eq(Hr))return this.isOdd()?Hr:Fr;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Dr)&&t.lt(Dr))return Ar(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,l=65535&t.low,c=0,u=0,h=0,d=0;return h+=(d+=i*l)>>>16,u+=(h+=r*l)>>>16,h&=65535,u+=(h+=i*a)>>>16,c+=(u+=n*l)>>>16,u&=65535,c+=(u+=r*a)>>>16,u&=65535,c+=(u+=i*o)>>>16,c+=e*l+n*a+r*o+i*s,Nr((h&=65535)<<16|(d&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},Gr.mul=Gr.multiply,Gr.divide=function(t){if(Tr(t)||(t=Rr(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Sr)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Nr((this.unsigned?Sr.div_u:Sr.div_s)(this.low,this.high,t.low,t.high),Sr.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?zr:Fr;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return zr;if(t.gt(this.shru(1)))return Ur;r=zr}else{if(this.eq(Hr))return t.eq(Br)||t.eq(Vr)?Hr:t.eq(Hr)?Br:(e=this.shr(1).div(t).shl(1)).eq(Fr)?t.isNegative()?Br:Vr:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(Hr))return this.unsigned?zr:Fr;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Fr}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:Ir(2,i-48),o=Ar(e),a=o.mul(t);a.isNegative()||a.gt(n);)a=(o=Ar(e-=s,this.unsigned)).mul(t);o.isZero()&&(o=Br),r=r.add(o),n=n.sub(a)}return r},Gr.div=Gr.divide,Gr.modulo=function(t){return Tr(t)||(t=Rr(t)),Sr?Nr((this.unsigned?Sr.rem_u:Sr.rem_s)(this.low,this.high,t.low,t.high),Sr.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Gr.mod=Gr.modulo,Gr.rem=Gr.modulo,Gr.not=function(){return Nr(~this.low,~this.high,this.unsigned)},Gr.and=function(t){return Tr(t)||(t=Rr(t)),Nr(this.low&t.low,this.high&t.high,this.unsigned)},Gr.or=function(t){return Tr(t)||(t=Rr(t)),Nr(this.low|t.low,this.high|t.high,this.unsigned)},Gr.xor=function(t){return Tr(t)||(t=Rr(t)),Nr(this.low^t.low,this.high^t.high,this.unsigned)},Gr.shiftLeft=function(t){return Tr(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Nr(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Nr(0,this.low<<t-32,this.unsigned)},Gr.shl=Gr.shiftLeft,Gr.shiftRight=function(t){return Tr(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Nr(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Nr(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Gr.shr=Gr.shiftRight,Gr.shiftRightUnsigned=function(t){if(Tr(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?Nr(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Nr(32===t?e:e>>>t-32,0,this.unsigned)},Gr.shru=Gr.shiftRightUnsigned,Gr.shr_u=Gr.shiftRightUnsigned,Gr.toSigned=function(){return this.unsigned?Nr(this.low,this.high,!1):this},Gr.toUnsigned=function(){return this.unsigned?this:Nr(this.low,this.high,!0)},Gr.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Gr.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Gr.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},kr.fromBytes=function(t,e,n){return n?kr.fromBytesLE(t,e):kr.fromBytesBE(t,e)},kr.fromBytesLE=function(t,e){return new kr(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},kr.fromBytesBE=function(t,e){return new kr(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const qr=_r||e({__proto__:null,default:_r},[_r]);function Xr(t){return qr.fromString(t,!0,16)}const Yr=Xr("c3a5c85c97cb3127"),Kr=Xr("b492b66fbe98f273"),Zr=Xr("9ae16a3b2f90404f");function Jr(t){return t.xor(t.shru(47))}function Qr(t,e,n){const r=t.slice(e,e+n);return qr.fromBytes(Array.from(r),!0,!0)}function ti(t,e){return Qr(t,e,8)}function ei(t,e){return Qr(t,e,4)}function ni(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function ri(t,e,n=Xr("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function ii(t,e,n,r){return function(t,e,n,r,i,s){i=i.add(t),s=ni(s.add(i).add(r),21);const o=i;return i=(i=i.add(e)).add(n),s=s.add(ni(i,44)),[i.add(r),s.add(o)]}(ti(t,e),ti(t,e+8),ti(t,e+16),ti(t,e+24),n,r)}function si(t,e=t.length){const n=qr.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Zr.add(2*e),r=ti(t,0).add(Zr),i=ti(t,e-8);return ri(ni(i,37).mul(n).add(r),ni(r,25).add(i).mul(n),n)}if(e>=4){const n=Zr.add(2*e);return ri(ei(t,0).shl(3).add(e),ei(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return Jr(Zr.mul(n).xor(Yr.mul(r))).mul(Zr)}return Zr}(t,e):function(t,e=t.length){const n=Zr.add(2*e),r=ti(t,0).mul(Kr),i=ti(t,8),s=ti(t,e-8).mul(n),o=ti(t,e-16).mul(Zr);return ri(ni(r.add(i),43).add(ni(s,30)).add(o),r.add(ni(i.add(Zr),18)).add(s),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Zr.add(2*e),r=ti(t,0).mul(Zr),i=ti(t,8),s=ti(t,e-8).mul(n),o=ti(t,e-16).mul(Zr),a=ni(r.add(i),43).add(ni(s,30)).add(o),l=ri(a,r.add(ni(i.add(Zr),18)).add(s),n),c=ti(t,16).mul(n),u=ti(t,24),h=a.add(ti(t,e-32)).mul(n),d=l.add(ti(t,e-24)).mul(n);return ri(ni(c.add(u),43).add(ni(h,30)).add(d),c.add(ni(u.add(r),18)).add(h),n)}(t,e);let r=n,i=n.mul(Kr).add(113),s=Jr(i.mul(Zr).add(113)).mul(Zr),o=[qr.UZERO,qr.UZERO],a=[qr.UZERO,qr.UZERO];r=r.mul(Zr).add(ti(t,0));let l=0;const c=64*(e-1>>6),u=c+(e-1&63)-63;do{r=ni(r.add(i).add(o[0]).add(ti(t,l+8)),37).mul(Kr),i=ni(i.add(o[1]).add(ti(t,l+48)),42).mul(Kr),r=r.xor(a[1]),i=i.add(o[0]).add(ti(t,l+40)),s=ni(s.add(a[0]),33).mul(Kr),o=ii(t,l,o[1].mul(Kr),r.add(a[0])),a=ii(t,l+32,s.add(a[1]),i.add(ti(t,l+16))),[s,r]=[r,s],l+=64}while(l!==c);const h=Kr.add(s.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=ni(r.add(i).add(o[0]).add(ti(t,l+8)),37).mul(h),i=ni(i.add(o[1]).add(ti(t,l+48)),42).mul(h),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(ti(t,l+40))),s=ni(s.add(a[0]),33).mul(h),o=ii(t,l,o[1].mul(h),r.add(a[0])),a=ii(t,l+32,s.add(a[1]),i.add(ti(t,l+16))),[s,r]=[r,s],ri(ri(o[0],a[0],h).add(Jr(i).mul(Yr)).add(s),ri(o[1],a[1],h).add(r),h)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function oi(t,e){return"string"===e?ci(t):ai([t],e)}function ai(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=p(t)),K().getBool("DEBUG")&&T(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function li(){return K().platform.now()}function ci(t,e="utf-8"){return e=e||"utf-8",K().platform.encode(t,e)}function ui(t,e="utf-8"){return e=e||"utf-8",K().platform.decode(t,e)}var hi=Object.freeze({__proto__:null,createScalarValue:oi,toTypedArray:ai,now:li,fetch:function(t,e){return K().platform.fetch(t,e)},encodeString:ci,decodeString:ui,shuffle:s,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,l(t,n,r),l(e,n,r)},clamp:o,nearestLargerEven:a,swap:l,sum:c,randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n},assert:u,assertShapesMatch:h,assertNonNull:d,flatten:p,sizeFromShape:f,isScalarShape:function(t){return 0===t.length},arraysEqual:m,isInt:g,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:y,createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return s(e),e},rightPad:b,repeatedTry:v,inferFromImplicitShape:x,parseAxisParam:w,squeezeShape:_,getTypedArrayFromDType:S,getArrayFromDType:k,checkConversionForErrors:T,isValidDtype:E,hasEncodingLoss:M,isTypedArray:C,bytesPerElement:A,bytesFromStringArray:N,isString:I,isBoolean:$,isNumber:R,inferDtype:O,isFunction:P,nearestDivisor:L,computeStrides:D,toNestedArray:z,makeOnesTypedArray:B,makeZerosTypedArray:U,makeZerosNestedTypedArray:V,assertNonNegativeIntegerDimensions:j,locToIndex:W,indexToLoc:H,isPromise:G,hexToLong:Xr,fingerPrint64:si});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class di{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new fi)}profileKernel(t,e,n){let r;const i=()=>{r=n()};let s;const o=li();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(const t of r)t.dataSync();s=Promise.resolve({kernelMs:li()-o})}if(K().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{pi(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:s.then((t=>t.kernelMs)),extraInfo:s.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:s}=t;n.forEach((t=>{Promise.all([t.data(),r,s]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function pi(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class fi{logKernelProfile(t,e,n,r,i,s){const o="number"==typeof r?b(`${r}ms`,9):r.error,a=b(t,25),l=e.rank,c=e.size,u=b(e.shape.toString(),14);let h="";for(const t in i){const n=i[t];if(null!=n){const r=n.shape||e.shape,i=r.length;h+=`${t}: ${i}D ${i>0?r:""} `}}console.log(`%c${a}\t%c${o}\t%c${l}D ${u}\t%c${c}\t%c${h}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mi(t,e,n,r){const i=D(e),s=function(t,e,n,r){const i=f(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,l="complex64"===n?vi(t):t;if(a>1)for(let t=0;t<i/s;t++){const e=t*s;for(let t=0;t<s;t++)o[t]=Math.max(o[t],gi(l[e+t],0,n).length)}return o}(t,e,n,i),o=e.length,a=bi(t,e,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map((t=>"    "+t)).join("\n")),l.join("\n")}function gi(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:I(t)?`'${t}'`:"bool"===n?yi(t):parseFloat(t.toFixed(7)).toString(),b(r,e)}function yi(t){return 0===t?"false":"true"}function bi(t,e,n,r,i,s=!0){const o="complex64"===n?2:1,a=e[0],l=e.length;if(0===l){if("complex64"===n){return[gi(vi(t)[0],0,n)]}return"bool"===n?[yi(t[0])]:[t[0].toString()]}if(1===l){if(a>20){const e=3*o;let r=Array.from(t.slice(0,e)),s=Array.from(t.slice((a-3)*o,a*o));return"complex64"===n&&(r=vi(r),s=vi(s)),["["+r.map(((t,e)=>gi(t,i[e],n))).join(", ")+", ..., "+s.map(((t,e)=>gi(t,i[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?vi(t):Array.from(t)).map(((t,e)=>gi(t,i[e],n))).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),h=r[0]*o,d=[];if(a>20){for(let e=0;e<3;e++){const r=e*h,s=r+h;d.push(...bi(t.slice(r,s),c,n,u,i,!1))}d.push("...");for(let e=a-3;e<a;e++){const r=e*h,s=r+h;d.push(...bi(t.slice(r,s),c,n,u,i,e===a-1))}}else for(let e=0;e<a;e++){const r=e*h,s=r+h;d.push(...bi(t.slice(r,s),c,n,u,i,e===a-1))}const p=2===l?",":"";d[0]="["+d[0]+p;for(let t=1;t<d.length-1;t++)d[t]=" "+d[t]+p;let f=",\n";for(let t=2;t<l;t++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function vi(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class xi{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=f(t),null!=n){const t=n.length;u(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||k(e,this.size),this.strides=D(t)}set(t,...e){0===e.length&&(e=[0]),u(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return wi().makeTensor(this.values,this.shape,this.dtype)}}let wi=null,_i=null;class Si{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=f(t),this.strides=D(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return _i.buffer(this.shape,this.dtype,t)}bufferSync(){return _i.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return z(this.shape,t,"complex64"===this.dtype)}arraySync(){return z(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=wi().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>ui(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),wi().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=wi().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>ui(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await wi().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(wi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return _i.print(this,t)}clone(){return this.throwIfDisposed(),_i.clone(this)}toString(t=!1){return mi(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),_i.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),wi().makeVariable(this,t,e,n)}}function ki(){return tt("Tensor",(()=>Si))}Object.defineProperty(Si,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),ki();class Ti extends Si{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!m(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);wi().disposeTensor(this),this.dataId=t.dataId,wi().incRef(this,null)}dispose(){wi().disposeVariable(this),this.isDisposedInternal=!0}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
var Ei,Mi,Ci,Ai,Ni;Object.defineProperty(Ti,Symbol.hasInstance,{value:t=>t instanceof Si&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Ei||(Ei={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Mi||(Mi={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ci||(Ci={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ai||(Ai={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ni||(Ni={}));const Ii={float32:Ai,int32:Mi,bool:Ci,complex64:Ni};function $i(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Ii[t][e]}function Ri(t){return $i(t,"int32")}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Oi(t,e){if(t.dtype===e.dtype)return[t,e];const n=$i(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Pi(t,e){u(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Li(t,e){return e.some((e=>e.id===t.id))}function Di(t){const e=[];return Fi(t,e,new Set),e}function Fi(t,e,n){if(null==t)return;if(t instanceof Si)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const i=t;for(const t in i){const r=i[t];n.has(r)||(n.add(r),Fi(r,e,n))}}var zi=Object.freeze({__proto__:null,makeTypesMatch:Oi,assertTypesMatch:Pi,isTensorInList:Li,getTensorsInContainer:Di});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Bi(t){return null!=t.kernelName}class Ui{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Vi{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ui}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(ur(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new di(this.backendInstance),!0}setupRegisteredKernels(){mr(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){mr(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof r||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,ur(`Initialization of backend ${t} failed`),ur(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return ur(`Initialization of backend ${t} failed`),ur(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),s=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return Vi.nextTensorId++}nextVariableId(){return Vi.nextVariableId++}clone(t){const e=Wi.runKernel(me,{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return Wi.runKernel(kt,e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=pr(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-e-i-s;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),i=this.state.numBytes,s=this.state.numTensors;let o,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=Bi(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Bi(t)){const{kernelName:e,inputs:i,attrs:s}=t;null==this.backendName&&this.backend;const l=pr(e,this.backendName);u(null!=l,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),o=()=>{const t=this.backend.numDataIds();a=l.kernelFunc({inputs:i,attrs:s,backend:this.backend});const o=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,o);const c=o.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,i,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,i=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};o=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,i)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,t,n),n}}const{inputs:c,attrs:h}=t,d=Bi(t)?null:t.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(l,c,(()=>o())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs):e=o()})),r&&this.addTapeNode(l,c,e,d,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=fr(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let s;r.saveAllInputs?(u(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),s=Object.keys(e).map((t=>e[t]))):s=t.map((t=>e[t]));const o=n.filter(((t,e)=>i[e]));return s.concat(o)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=t;"string"===n&&I(t[0])&&(i=t.map((t=>ci(t))));const s=r.write(i,e,n),o=new Si(e,n,s,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const t=this.state.tensorInfo.get(s),e=N(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return o}makeTensorFromDataId(t,e,n,r){const i={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:i}=t,s=new Si(r,i,n,this.nextTensorId());return this.trackTensor(s,e),s}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new Ti(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*A(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Ti||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*A(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,s){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},a=fr(t);null!=a&&(r=a.gradFunc),null!=r&&(o.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=U(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],i,s))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Di(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(u(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));u(i instanceof Si,(()=>"The result y returned by f() must be a tensor."));const s=function(t,e,n){const r={},i={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const s=t[n],o=s.inputs;for(const t in o){const n=o[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){s.outputs.forEach((t=>r[t.id]=!0)),a=!0,i[s.id]=!0;break}if(a)break}}const s={};s[n.id]=!0;const o={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(s[n.outputs[t].id]){for(const t in r)s[r[t].id]=!0,o[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(i[n.id]&&o[n.id]){const t={};for(const e in n.inputs){const i=n.inputs[e];r[i.id]&&(t[e]=i)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,i);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?function(t){const e=B(f(t),"float32");return Wi.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach((e=>{const n=t[e.id];null!=n?o.push(n):o.push(null)})),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const e in s.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const i=n((()=>a[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const o=s.inputs[e];if(!m(i.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==t[o.id])t[o.id]=i;else{const e=t[o.id];t[o.id]=r(e,i),e.dispose()}}}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t,s,(t=>this.tidy(t)),Hi);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(t){return u(P(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;u(e.every((t=>t instanceof Si)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,i)=>(n=t(...e,i),u(n.value instanceof Si,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),u(P(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const i=n.gradFunc(t,r),s=Array.isArray(i)?i:[i];u(s.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),u(s.every((t=>t instanceof Si)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return s.forEach(((t,e)=>{o[e]=()=>t})),o},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=li(),n=await this.backend.time(t);return n.wallMs=li()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ui;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function ji(){const t=Q();if(null==t._tfengine){const e=new X(t);t._tfengine=new Vi(e)}var e;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */return e=t._tfengine.ENV,J=e,wi=()=>t._tfengine,t._tfengine}Vi.nextTensorId=0,Vi.nextVariableId=0;const Wi=ji();function Hi(t,e){const n={a:t,b:e};return Wi.runKernel(it,n)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */let Gi;function qi(t){if(void 0!==Gi)return Gi;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Xi(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Yi=Object.freeze({__proto__:null,mockIsMobile:function(t){Gi=t},isMobile:qi,isBrowser:Xi});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ki=K();
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Zi(t,e){let n=t;if(C(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||C(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&K().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ji(t,r,[]),r}function Ji(t,e,n){if(n=n||[],!Array.isArray(t)&&!C(t))return void u(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));u(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),u(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Ji(t[e],r,n.concat(e))}function Qi(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function ts(t,e,n,r="numeric"){if(t instanceof Si)return Qi(r,t.dtype,e,n),t;let i=O(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Qi(r,i,e,n),null==t||!C(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=Zi(t,i);C(t)||Array.isArray(t)||(t=[t]);const o="string"!==i?ai(t,i):p(t,[],!0);return Wi.makeTensor(o,s,i)}function es(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,i)=>ts(t,`${e}[${i}]`,n,r)))}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */Ki.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ki.registerFlag("IS_BROWSER",(()=>Xi())),Ki.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),Ki.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Ki.registerFlag("PROD",(()=>!1)),Ki.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Ki.getBool("DEBUG"))),Ki.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Ki.registerFlag("IS_TEST",(()=>!1)),Ki.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),Ki.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),Ki.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1)),Ki.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),Ki.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));const ns="__op";function rs(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=ns;const i=(...t)=>{Wi.startScope(n);try{const e=r(...t);return G(e)&&console.error("Cannot return a Promise inside of tidy."),Wi.endScope(e),e}catch(t){throw Wi.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const is=rs({complex_:function(t,e){const n=ts(t,"real","complex"),r=ts(e,"imag","complex");h(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return Wi.runKernel(Mt,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ss(t,e,n,r){if(null==r&&(r=O(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!C(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){j(e);const t=f(e),r=f(n);u(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],i=t!==n.length-1||r!==f(e.slice(t));u(n[t]===e[t]||!i,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return C(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?ai(t,r):p(t,[],!0),Wi.makeTensor(t,e,r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function os(t,e,n){return ss(t,e,Zi(t,n),n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const as={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function ls(t,e){const n=[],r=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let s=0;s<i.length;++s){const o=i[s],a=Array.isArray(t)?t[s].tensor:t[o];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${a.dtype}`);const l={name:o,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let i=0;for(let t=0;t<e.length;t++){const n=e[t],s=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(s,i),i+=4,r.set(n,i),i+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(l.group=e),n.push(l)}return{data:us(await Promise.all(r)),specs:n}}function cs(t,e){const n={};let r,i=0;for(const s of e){const e=s.name,o=s.dtype,a=s.shape,l=f(a);let c;if("quantization"in s){const n=s.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${s.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${s.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const a=as[n.dtype],u=t.slice(i,i+l*a),h="uint8"===n.dtype?new Uint8Array(u):new Uint16Array(u);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=xs()),c=r(h)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(h.length);for(let t=0;t<h.length;t++){const e=h[t];c[t]=Math.round(e*n.scale+n.min)}}i+=l*a}else if("string"===o){const e=f(s.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(i,i+4))[0];i+=4;const n=new Uint8Array(t.slice(i,i+e));c.push(n),i+=e}}else{const r=as[o],s=t.slice(i,i+l*r);if("float32"===o)c=new Float32Array(s);else if("int32"===o)c=new Int32Array(s);else if("bool"===o)c=new Uint8Array(s);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);{c=new Float32Array(s);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const i=os(t,a,"float32"),o=os(r,a,"float32");n[e]=is(i,o),i.dispose(),o.dispose()}}i+=l*r}"complex64"!==o&&(n[e]=os(c,a,o))}return n}function us(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let i=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),r.buffer}const hs="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ds(t){return hs?Buffer.byteLength(t):new Blob([t]).size}function ps(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function fs(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function ms(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function gs(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null!=t.weightsManifest){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),r}async function ys(t,e){let n,r;return null!=t.weightsManifest&&([n,r]=await e(t.weightsManifest)),gs(t,n,r)}function bs(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:ds(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:ds(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function vs(t){const e=[];for(const n of t)e.push(...n.weights);return e}function xs(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let i=0;i<r.length;i++){const o=r[i],a=t[n[o>>10]+(1023&o)]+e[o>>10];s[i]=a}return new Float32Array(i)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ws{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==ws.instance&&(ws.instance=new ws),ws.instance}static registerSaveRouter(t){ws.getInstance().saveRouters.push(t)}static registerLoadRouter(t){ws.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return ws.getHandlers(t,"save")}static getLoadHandlers(t,e){return ws.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?ws.getInstance().loadRouters:ws.getInstance().saveRouters).forEach((e=>{const i=e(t,n);null!==i&&r.push(i)})),r}}const _s=t=>ws.getSaveHandlers(t),Ss=(t,e)=>ws.getLoadHandlers(t,e)
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */,ks="tensorflowjs",Ts="models_store",Es="model_info_store";function Ms(){if(!K().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Cs(t){const e=t.result;e.createObjectStore(Ts,{keyPath:"modelPath"}),e.createObjectStore(Es,{keyPath:"modelPath"})}class As{constructor(t){if(this.indexedDB=Ms(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open(ks,1);r.onupgradeneeded=()=>Cs(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction(Ts,"readonly"),r=e.objectStore(Ts).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const r=bs(e),s=i.transaction(Es,"readwrite");let o=s.objectStore(Es);const a=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let l;a.onsuccess=()=>{l=i.transaction(Ts,"readwrite");const a=l.objectStore(Ts).put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{o=s.objectStore(Es);const e=o.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(a.error)),e.onerror=t=>(i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)}))}}As.URL_SCHEME="indexeddb://";const Ns=t=>{return K().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(As.URL_SCHEME)?(e=t.slice(As.URL_SCHEME.length),new As(e)):null;var e};ws.registerSaveRouter(Ns),ws.registerLoadRouter(Ns);class Is{constructor(){this.indexedDB=Ms()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open(ks,1);n.onupgradeneeded=()=>Cs(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(Es,"readonly"),s=i.objectStore(Es).getAll();s.onsuccess=()=>{const e={};for(const t of s.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},s.onerror=t=>(r.close(),e(s.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(As.URL_SCHEME)?e.slice(As.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open(ks,1);r.onupgradeneeded=()=>Cs(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(Es,"readwrite"),o=s.objectStore(Es),a=o.get(t);let l;a.onsuccess=()=>{if(null==a.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=o.delete(t),s=()=>{l=i.transaction(Ts,"readwrite");const r=l.objectStore(Ts).delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=s,r.onerror=t=>(s(),i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)}))}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $s="/",Rs="tensorflowjs_models",Os="info",Ps="model_topology",Ls="weight_specs",Ds="weight_data",Fs="model_metadata";function zs(t){return{info:[Rs,t,Os].join($s),topology:[Rs,t,Ps].join($s),weightSpecs:[Rs,t,Ls].join($s),weightData:[Rs,t,Ds].join($s),modelMetadata:[Rs,t,Fs].join($s)}}function Bs(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Us(t){const e=t.split($s);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join($s)}class Vs{constructor(t){if(!K().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=zs(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=bs(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(hs)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(t){throw Bs(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(hs){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(s),e}}Vs.URL_SCHEME="localstorage://";const js=t=>{return K().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Vs.URL_SCHEME)?(e=t.slice(Vs.URL_SCHEME.length),new Vs(e)):null;var e};ws.registerSaveRouter(js),ws.registerLoadRouter(js);class Ws{constructor(){u(K().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),u("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Rs+$s,n=$s+Os;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(n)){t[Us(i)]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){var e;const n=zs(t=(e=t).startsWith(Vs.URL_SCHEME)?e.slice(Vs.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Bs(n),r}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hs="://";class Gs{constructor(){this.managers={}}static getInstance(){return null==Gs.instance&&(Gs.instance=new Gs),Gs.instance}static registerManager(t,e){u(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith(Hs)&&(t=t.slice(0,t.indexOf(Hs))),u(t.length>0,(()=>"scheme must not be an empty string."));const n=Gs.getInstance();u(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=Gs.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Gs.getInstance().managers)}}function qs(t){if(-1===t.indexOf(Hs))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Gs.getSchemes().join(",")}`);return{scheme:t.split(Hs)[0],path:t.split(Hs)[1]}}async function Xs(t,e,n=!1){u(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=ws.getLoadHandlers(t);u(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),u(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const i=r[0],s=ws.getSaveHandlers(e);u(s.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),u(s.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const o=s[0],a=qs(t).scheme,l=qs(t).path,c=a===qs(t).scheme,h=await i.load();n&&c&&await Gs.getManager(a).removeModel(l);const d=await o.save(h);return n&&!c&&await Gs.getManager(a).removeModel(l),d.modelArtifactsInfo}async function Ys(){const t=Gs.getSchemes(),e={};for(const n of t){const t=await Gs.getManager(n).listModels();for(const r in t){e[n+Hs+r]=t[r]}}return e}async function Ks(t){const e=qs(t);return Gs.getManager(e.scheme).removeModel(e.path)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class Zs{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){window&&K().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(t),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(t=>{if(t.source===window&&t.data.name===this.messageName){t.stopPropagation();(0,this.functionRefs[t.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(t,e)}}if(K().get("IS_BROWSER")){K().setPlatform("browser",new Zs);try{Gs.registerManager(Vs.URL_SCHEME,new Ws)}catch(t){}try{Gs.registerManager(As.URL_SCHEME,new Is)}catch(t){}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Js=()=>require("node-fetch");let Qs;class to{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=K().global.fetch?K().global.fetch(t,e):(null==Qs&&(Qs=Js()),Qs(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function eo(t,e="float32",n){return e=e||"float32",j(t),new xi(t,e,n)}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */K().get("IS_NODE")&&!K().get("IS_BROWSER")&&K().setPlatform("node",new to);const no=rs({cast_:function(t,e){const n=ts(t,"x","cast");if(!E(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Wi.runKernel(kt,r,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ro=rs({clone_:function(t){const e={x:ts(t,"x","clone","string_or_numeric")};return Wi.runKernel(me,e)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function io(t,e=!1){console.log(t.toString(e))}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */ji();_i={buffer:eo,cast:no,clone:ro,print:io};function so(t){return new Promise((t=>setTimeout(t))).then(t)}class oo{constructor(t){if(!K().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(oo.URL_SCHEME)&&(t=t.slice(oo.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=ms(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await so((()=>i.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await so((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:bs(t)}}}}oo.URL_SCHEME="downloads://";class ao{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),i=r.modelTopology;if(null==i)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:i});const s=ys(r,(t=>this.loadWeights(t)));t(s)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),i=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(i).then((t=>[e,ps(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const i=new FileReader;i.onload=t=>{const e=t.target.result;n(e)},i.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),i.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>fs(t.name))),r={};for(const i of t)i.paths.forEach((t=>{const i=fs(t);if(-1!==e.indexOf(i))throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(e.push(i),-1===n.indexOf(i))throw new Error(`Weight file with basename '${i}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(i)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}function lo(t){return new ao(t)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function co(t,e,n,r){!function(t){u(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){u(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),u(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),u(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(t.map((s=>(s.then((s=>{const o=n+ ++i/t.length*(r-n);return e(o),s})),s))))}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function uo(t,e){null==e&&(e={});const n=null==e.fetchFunc?K().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=(null==e.onProgress?await Promise.all(r):await co(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(i):await co(i,e.onProgress,.5,1)}function ho(t){return async(e,n="",r)=>{const i=e.map((()=>!1)),s={},o=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const l="quantization"in t?t.quantization.dtype:t.dtype,c=as[l]*f(t.shape),u=()=>{i[e]=!0,null==s[e]&&(s[e]=[]),s[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(u(),o[n]=!0)})):u(),a.push(t.name),n+=c}))})),!o.every((t=>t))){const t=r.filter(((t,e)=>!o[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const l=i.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];l.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const u=await t(c),h={};let d=0;return l.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=u[d+t].byteLength;const i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(u[d+t]);o.set(e,a),a+=e.byteLength}s[t].forEach((t=>{const e=cs(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)h[t]=e[t]})),d+=n})),h}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */ws.registerSaveRouter((t=>K().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(oo.URL_SCHEME)?function(t="model"){return new oo(t)}(t.slice(oo.URL_SCHEME.length)):null));class po{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(u("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=K().platform.fetch,u(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&u(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=ms(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:bs(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return ys(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}(e),i=this.weightPathPrefix||n,s=vs(t),o=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):o.push(i+t+r);this.weightUrlConverter&&o.push(...await Promise.all(a));return[s,ps(await uo(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function fo(t){return null!=t.match(po.URL_SCHEME_REGEX)}po.URL_SCHEME_REGEX=/^https?:\/\//;const mo=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>fo(t))):fo(t),n)return go(t,e)}return null};function go(t,e){return new po(t,e)}function yo(t,e){return go(t,e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */ws.registerSaveRouter(mo),ws.registerLoadRouter(mo);class bo{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class vo{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class xo{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function wo(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new bo(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bo({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bo({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}function _o(t){return new vo(t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
var So=Object.freeze({__proto__:null,browserFiles:lo,browserHTTPRequest:yo,concatenateArrayBuffers:ps,decodeWeights:cs,encodeWeights:ls,fromMemory:function(t,e,n,r){const i=arguments;return new xo(wo(...i))},fromMemorySync:wo,getLoadHandlers:Ss,getModelArtifactsForJSON:ys,getModelArtifactsForJSONSync:gs,getModelArtifactsInfoForJSON:bs,getSaveHandlers:_s,getWeightSpecs:vs,http:go,isHTTPScheme:fo,loadWeights:async function(t,e="",n,r){return ho((t=>uo(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>ws.registerLoadRouter(t),registerSaveRouter:t=>ws.registerSaveRouter(t),weightsLoaderFactory:ho,withSaveHandler:_o,withSaveHandlerSync:function(t){return new vo(t)},copyModel:async function(t,e){return Xs(t,e,!1)},listModels:Ys,moveModel:async function(t,e){return Xs(t,e,!0)},removeModel:Ks});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ko=rs({matMul_:function(t,e,n=!1,r=!1){let i=ts(t,"a","matMul"),s=ts(e,"b","matMul");[i,s]=Oi(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return Wi.runKernel(vt,o,a)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const To=rs({oneHot_:function(t,e,n=1,r=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:ts(t,"indices","oneHot","int32")},o={dtype:i,depth:e,onValue:n,offValue:r};return Wi.runKernel(Qe,s,o)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Eo(){return Wi}function Mo(){return Wi.memory()}function Co(t,e){return Wi.tidy(t,e)}function Ao(t){Di(t).forEach((t=>t.dispose()))}function No(t){return Wi.keep(t)}function Io(){return Wi.backendName}function $o(t,e,n=1){return Wi.registerBackend(t,e,n)}function Ro(){return Wi.backend}const Oo=rs({imag_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const e={input:ts(t,"input","imag")};return Wi.runKernel(ye,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Po=rs({neg_:function(t){const e={x:ts(t,"x","neg")};return Wi.runKernel(qe,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Lo=rs({real_:function(t){const e={input:ts(t,"input","real")};return Wi.runKernel(cn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Do=rs({transpose_:function(t,e,n){const r=ts(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),u(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{u(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const i={x:r},s={perm:e};return"complex64"===r.dtype?Co((()=>{let t=Lo(r),e=Oo(r);return t=Wi.runKernel(Qn,{x:t},s),e=Wi.runKernel(Qn,{x:e},s),n&&(e=Po(e)),is(t,e)})):Wi.runKernel(Qn,i,s)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fo=rs({confusionMatrix_:function(t,e,n){const r=ts(t,"labels","confusionMatrix"),i=ts(e,"predictions","confusionMatrix");u(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),u(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),u(1===i.rank,(()=>`Expected the rank of predictions to be 1, but got ${i.rank}`)),u(r.shape[0]===i.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`)),u(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const s=To(no(r,"int32"),n),o=To(no(i,"int32"),n),a=Do(s),l=ko(a,o);return no(l,"int32")}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var zo=Object.freeze({__proto__:null,confusionMatrix:Fo});
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Bo(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&r.unshift(s)}return r}function Uo(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,o=e[s];(null==i||1===i&&o>1)&&n.unshift(s)}return n}function Vo(t,e){const n=[],r=Math.max(t.length,e.length);for(let i=0;i<r;i++){let r=t[t.length-i-1];null==r&&(r=1);let s=e[e.length-i-1];if(null==s&&(s=1),1===r)n.unshift(s);else if(1===s)n.unshift(r);else{if(r!==s){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var jo=Object.freeze({__proto__:null,getBroadcastDims:Bo,getReductionAxes:Uo,assertAndGetBroadcastShape:Vo});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Wo(t,e,n){if(d(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Zi(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ss(t,e,r,n)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */let Ho;function Go(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)s=!0;else if(null!=t.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(null!=pr(sr,Wi.backendName)){const n={pixels:t},r={numChannels:e};return Wi.runKernel(sr,n,r)}const[l,c]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let u,h;if(o)u=t.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)u=t.data;else if(s||i||a){if(null==Ho)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ho=new OffscreenCanvas(1,1).getContext("2d")}else Ho=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Ho.canvas.width=l,Ho.canvas.height=c,Ho.drawImage(t,0,0,l,c),u=Ho.getImageData(0,0,l,c).data}if(4===e)h=new Int32Array(u);else{const t=l*c;h=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)h[n*e+t]=u[4*n+t]}return Wo(h,[c,l,e],"int32")}function qo(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}async function Xo(t,e){let n=ts(t,"img","toPixels");if(!(t instanceof Si)){const t=n;n=no(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),s=2===n.rank?1:n.shape[2];if(s>4||2===s)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const o=await n.data(),a="float32"===n.dtype?255:1,l=new Uint8ClampedArray(i*r*4);for(let t=0;t<r*i;++t){const e=[0,0,0,255];for(let r=0;r<s;r++){const i=o[t*s+r];if("float32"===n.dtype){if(i<0||i>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${i}.`)}else if("int32"===n.dtype&&(i<0||i>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${i}.`);1===s?(e[0]=i*a,e[1]=i*a,e[2]=i*a):e[r]=i*a}const r=4*t;l[r+0]=Math.round(e[0]),l[r+1]=Math.round(e[1]),l[r+2]=Math.round(e[2]),l[r+3]=Math.round(e[3])}if(null!=e){e.width=i,e.height=r;const t=e.getContext("2d"),n=new ImageData(l,i,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),l}const Yo=rs({fromPixels_:Go});var Ko=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(K().getBool("WRAP_TO_IMAGEBITMAP")&&qo(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return Go(n,e)},toPixels:Xo,fromPixels:Yo});function Zo(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===f(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,s=i[i.length-1];let o=1;for(let t=0;t<i.length-1;++t)o*=i[t];const a=t.shape,l=i.slice();l.pop();let c=1;for(let t=s;t<n;++t)c*=a[t],l.push(a[t]);const u=[...D(t.shape).map((t=>t/c)),1].slice(0,s);return[l,o,c,u]}var Jo=Object.freeze({__proto__:null,prepareAndValidate:Zo});function Qo(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(s+" update.rank != "+(i+t.length-r));for(let t=0;t<i;++t)if(n.shape[t]!==e.shape[t])throw new Error(s+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-i;++e)if(n.shape[e+i]!==t[e+r])throw new Error(s+` updates.shape[${e+i}] (${n.shape[e+i]}) != shape[${e+i}] (${t[e+i]})`)}function ta(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Qo(n,e,t)}function ea(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let o=1;for(let t=i;t<s;++t)o*=n[t];const a=i<1?1:i;return{sliceRank:i,numUpdates:f(e.shape)/a,sliceSize:o,strides:[...D(n.slice(0,i)),1],outputSize:f(n)}}var na=Object.freeze({__proto__:null,validateUpdateShape:Qo,validateInput:ta,calculateShapes:ea});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ra(t,e,n){const r=t.shape.length;u(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),u(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let i=0;i<r;++i)u(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function ia(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function sa(t,e,n,r){const i=[...t];for(let t=i.length;t<r.length;t++)i.push(1);for(let t=0;t<n;t++)0===t?i[e]=1:(i.splice(e,0,1),i.pop());return i}function oa(t,e,n){return n<=t?n:n-(e-1)}function aa(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function la(t,e,n,r,i){const s=[...i],o=aa(n,e);for(let i=0;i<s.length;i++)if(o.indexOf(i)>-1)s[i]=0;else{const o=oa(e,n,i);let a=r[o];t&1<<o&&(a=0),s[i]=a}return s}function ca(t,e,n,r,i){const s=[...i],a=aa(n,e);for(let i=0;i<s.length;i++)if(a.indexOf(i)>-1)s[i]=Number.MAX_SAFE_INTEGER;else{const o=oa(e,n,i);let a=r[o];t&1<<o&&(a=Number.MAX_SAFE_INTEGER),s[i]=a}for(let t=0;t<s.length;t++){const e=i[t];s[t]<0&&(s[t]+=e),s[t]=o(0,s[t],i[t])}return s}function ua(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function ha(t,e,n,r,i,s){let a=e[i];const l=n[i]||1;(t&1<<i||s&1<<i||null==a)&&(a=l>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const c=r[i];return a<0&&(a+=c),a=o(0,a,c-1),a}function da(t,e,n,r,i,s){let a=e[i];const l=n[i]||1;(t&1<<i||s&1<<i||null==a)&&(a=l>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const c=r[i];return a<0&&(a+=c),a=l>0?o(0,a,c):o(-1,a,c-1),a}function pa(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function fa(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function ma(t,e,n){let r;const i=t.shape.length;let s;return r="number"==typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),r.forEach((t=>{u(-1!==t,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,s=s.map(((e,n)=>e>=0?e:(u(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,s]}function ga(t,e,n,r,i,s,o,a,l){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=o&&0!=(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let t=0;t<h.dims;t++)u&&0!=(1<<t&a)&&h.numAddAxisAfterEllipsis++,1<<t&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let p=!0,f=!0,m=!0;const g=[],y=[];for(let e=0;e<t.length;++e){if(0===d.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(d.shrinkAxisMask&1<<e),r=t[e];if(-1===r){g.push(n?1:-1);continue}const i=[d.beginMask&1<<e,d.endMask&1<<e],s=[d.strides[e]>0?0:-1,d.strides[e]>0?r:r-1];if(n&&d.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[e];const o=!!(d.beginMask&1<<e&&d.endMask&1<<e);if(d.beginValid&&d.endValid){if(n){const t=d.begin[e]<0?r+d.begin[e]:d.begin[e];if(d.begin[e]=t,d.end[e]=d.begin[e]+1,t<0||t>=r)throw Error(`slice index ${d.begin[e]} of dimension ${e} out of bounds.`)}else d.begin[e]=ya(d.begin[e],0,d.strides[e],r,i,s),d.end[e]=ya(d.end[e],1,d.strides[e],r,i,s);const t=1===d.strides[e]&&0===d.begin[e]&&d.end[e]===r;p=p&&t,f=f&&(0===e&&1===d.strides[e]||t)}else p=p&&1===d.strides[e]&&o,f=f&&(0===e&&1===d.strides[e]||o);let a,l=!1;if(d.beginValid&&d.endValid?(a=d.end[e]-d.begin[e],l=!0):n?(a=1,l=!0):o&&r>=0&&(a=d.strides[e]<0?-r:r,l=!0),l){let t;t=0===a||a<0!=d.strides[e]<0?0:Math.trunc(a/d.strides[e])+(a%d.strides[e]!=0?1:0),g.push(t)}else g.push(-1)}for(let t=0;t<d.finalShapeGatherIndices.length;++t){const e=d.finalShapeGatherIndices[t];e>=0?y.push(g[e]):-2===e&&y.push(1)}const b=y.filter(((t,e)=>-2!==d.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function ya(t,e,n,r,i,s){if(i[e])return n>0?s[e]:s[e+1&1];{const e=t<0?r+t:t;return e<s[0]?s[0]:e>s[1]?s[1]:e}}var ba=Object.freeze({__proto__:null,assertParamsValid:ra,maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:ia,stridesWithElidedDims:sa,getNormalizedAxes:function(t,e,n,r,i,s,o,a,l){const c=t.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(e.length&&n>0){const l=e[0],c=n+1;u=la(o,l,c,r,t),h=ca(a,l,c,i,t),d=sa(s,l,c,t)}else for(let e=0;e<c;e++)u[e]=ha(o,r,s,t,e,l),h[e]=da(a,i,s,t,e,l),d[e]=ua(s,e,l);return{begin:u,end:h,strides:d}},startIndicesWithElidedDims:la,stopIndicesWithElidedDims:ca,stridesForAxis:ua,startForAxis:ha,stopForAxis:da,isSliceContinous:pa,computeFlatOffset:fa,parseSliceParams:ma,sliceInfo:ga});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class va{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class xa{constructor(){this.classNameMap={}}static getMap(){return null==xa.instance&&(xa.instance=new xa),xa.instance}static register(t){xa.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function wa(t){u(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),u("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),u(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),xa.register(t)}var _a=Object.freeze({__proto__:null,Serializable:va,SerializationMap:xa,registerClass:wa});
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Sa(){return 32===Wi.backend.floatPrecision()?.001:.1}function ka(t,e,n){let r=!0;if((C(t)||C(e))&&(r=!1),C(t)&&C(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Zi(t),r=Zi(e);if(!m(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=C(t)?t:p(t),s=C(e)?e:p(e);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.\nActual:   ${i}.\nExpected: ${s}.`);for(let t=0;t<s.length;++t){const e=i[t],r=s[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${i}.\nExpected: ${s}.`)}"undefined"!=typeof expect&&expect().nothing()}function Ta(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Ea=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Sa()),ka(t,e,((t,e)=>Ta(t,e,n)))},testEpsilon:Sa,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e())),"undefined"!=typeof expect&&expect().nothing()},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return I(t)||I(t[0])||I(e)||I(e[0])?ka(t,n,((t,e)=>t==e)):ka(t,e,((t,e)=>Ta(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Sa()),!Ta(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);"undefined"!=typeof expect&&expect().nothing()},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=ci(r)}return e},createVideoElement:function(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise((t=>{e.addEventListener("loadeddata",(n=>t(e))),e.load()}))},play:async function(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise((e=>{t.requestVideoFrameCallback(e)}))}});
/** @license See the LICENSE file. */const Ma=rs({add_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e){let n=ts(t,"a","add"),r=ts(e,"b","add");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(it,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ca=rs({floorDiv_:function(t,e){let n=ts(t,"a","floorDiv"),r=ts(e,"b","floorDiv");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(ce,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Aa=rs({div_:function(t,e){let n=ts(t,"a","div"),r=ts(e,"b","div");if([n,r]=Oi(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Ca(n,r);const i={a:n,b:r};return Wi.runKernel(Kt,i,{})}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Na=rs({mul_:function(t,e){let n=ts(t,"a","mul"),r=ts(e,"b","mul");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(Ge,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ia=rs({abs_:function(t){const e=ts(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return Wi.runKernel(Ct,t)}{const t={x:e};return Wi.runKernel(et,t)}}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $a=rs({acos_:function(t){const e={x:ts(t,"x","acos")};return Wi.runKernel(nt,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ra=rs({acosh_:function(t){const e={x:ts(t,"x","acosh")};return Wi.runKernel(rt,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Oa=rs({addN_:function(t){u(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),u(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>ts(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!m(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return Wi.runKernel(st,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Pa=rs({all_:function(t,e=null,n=!1){const r={x:ts(t,"x","all","bool")},i={axis:e,keepDims:n};return Wi.runKernel(ot,r,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const La=rs({any_:function(t,e=null,n=!1){const r={x:ts(t,"x","any","bool")},i={axis:e,keepDims:n};return Wi.runKernel(at,r,i)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Da=rs({argMax_:function(t,e=0){const n={x:ts(t,"x","argMax")},r={axis:e};return Wi.runKernel(lt,n,r)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fa=rs({argMin_:function(t,e=0){const n={x:ts(t,"x","argMin")},r={axis:e};return Wi.runKernel(ct,n,r)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const za=rs({asin_:function(t){const e={x:ts(t,"x","asin")};return Wi.runKernel(ut,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ba=rs({asinh_:function(t){const e={x:ts(t,"x","asinh")};return Wi.runKernel(ht,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ua=rs({atan_:function(t){const e={x:ts(t,"x","atan")};return Wi.runKernel(dt,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Va=rs({atan2_:function(t,e){let n=ts(t,"a","atan2"),r=ts(e,"b","atan2");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(ft,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ja=rs({atanh_:function(t){const e={x:ts(t,"x","atanh")};return Wi.runKernel(pt,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Wa(t,e,n,r,i="NHWC",s){return qa(t,[...e,t[3]],n,s,r,null,null,nl(i))}function Ha(t,e,n,r,i,s,o="channelsLast"){const[a,l]=Ka(e);let c;if("channelsLast"===o)c=[a,l,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);c=[a,l,t[1],t[1]]}return qa(t,c,n,r,i,s,!1,o)}function Ga(t,e,n,r,i,s,o="NDHWC"){const[a,l,c]=Za(e);let u,h;if("NDHWC"===o)h="channelsLast",u=[a,l,c,t[4],t[4]];else{if("NCDHW"!==o)throw new Error(`Unknown dataFormat ${o}`);h="channelsFirst",u=[a,l,c,t[1],t[1]]}return Xa(t,u,n,r,i,!1,h,s)}function qa(t,e,n,r,i,s,o=!1,a="channelsLast"){let[l,c,u,h]=[-1,-1,-1,-1];if("channelsLast"===a)[l,c,u,h]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,h,c,u]=t}const[d,p,,f]=e,[m,g]=Ka(n),[y,b]=Ka(r),v=Ja(d,y),x=Ja(p,b),{padInfo:w,outHeight:_,outWidth:S}=function(t,e,n,r,i,s,o,a,l){let c,u,h;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=Ya(t,e,n));const s=t[0],o=t[1],a=Qa((s-e+2*r)/n+1,i),l=Qa((o-e+2*r)/n+1,i);return[a,l]}([e,n],s,r,t,a);u=i[0],h=i[1]}else if("same"===t){u=Math.ceil(e/r),h=Math.ceil(n/i);const t=Math.max(0,(u-1)*r+s-e),a=Math.max(0,(h-1)*i+o-n),l=Math.floor(t/2),d=t-l,p=Math.floor(a/2);c={top:l,bottom:d,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/r),h=Math.ceil((n-o+1)/i);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const d="channelsLast"===l?t[1][0]:t[2][0],p="channelsLast"===l?t[1][1]:t[2][1],f="channelsLast"===l?t[2][0]:t[3][0],m="channelsLast"===l?t[2][1]:t[3][1];c={top:d,bottom:p,left:f,right:m,type:0===d&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},u=Qa((e-s+d+p)/r+1,a),h=Qa((n-o+f+m)/i+1,a)}}return{padInfo:c,outHeight:u,outWidth:h}}(i,c,u,m,g,v,x,s,a),k=o?f*h:f;let T;return"channelsFirst"===a?T=[l,k,_,S]:"channelsLast"===a&&(T=[l,_,S,k]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:h,outHeight:_,outWidth:S,outChannels:k,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:t,outShape:T,filterShape:e}}function Xa(t,e,n,r,i,s=!1,o="channelsLast",a){let[l,c,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,h,d]=t;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,d,c,u,h]=t}const[p,f,m,,g]=e,[y,b,v]=Za(n),[x,w,_]=Za(r),S=Ja(p,x),k=Ja(f,w),T=Ja(m,_),{padInfo:E,outDepth:M,outHeight:C,outWidth:A}=function(t,e,n,r,i,s,o,a,l,c,u){let h,d,p,f;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,i,s){null==i&&(i=Ya(t,e,r));const o=t[0],a=t[1],l=t[2],c=Qa((o-e+2*i)/r+1,s),u=Qa((a-e+2*i)/r+1,s),h=Qa((l-e+2*i)/r+1,s);return[c,u,h,n]}([e,n,r,1],a,1,i,t,u);d=s[0],p=s[1],f=s[2]}else if("same"===t){d=Math.ceil(e/i),p=Math.ceil(n/s),f=Math.ceil(r/o);const t=(d-1)*i+a-e,u=(p-1)*s+l-n,m=(f-1)*o+c-r,g=Math.floor(t/2),y=t-g,b=Math.floor(u/2),v=u-b,x=Math.floor(m/2);h={top:b,bottom:v,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-a+1)/i),p=Math.ceil((n-l+1)/s),f=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(i,c,u,h,y,b,v,S,k,T,a),N=s?g*d:g;let I;return"channelsFirst"===o?I=[l,N,M,C,A]:"channelsLast"===o&&(I=[l,M,C,A,N]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:M,outHeight:C,outWidth:A,outChannels:N,padInfo:E,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:k,effectiveFilterWidth:T,dilationDepth:x,dilationHeight:w,dilationWidth:_,inShape:t,outShape:I,filterShape:e}}function Ya(t,e,n,r=1){const i=Ja(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function Ka(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Za(t){return"number"==typeof t?[t,t,t]:t}function Ja(t,e){return e<=1?t:t+(t-1)*(e-1)}function Qa(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function tl(t){const[e,n,r]=Ka(t);return 1===e&&1===n&&1===r}function el(t,e){return tl(t)||tl(e)}function nl(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function rl(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)u(g(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{u(g(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const il=rs({reshape_:function(t,e){const n={x:ts(t,"x","reshape","string_or_numeric")},r={shape:e};return Wi.runKernel(dn,n,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const sl=rs({avgPool_:function(t,e,n,r,i){const s=ts(t,"x","avgPool","float32");u(el(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let o=s,a=!1;3===s.rank&&(a=!0,o=il(s,[1,s.shape[0],s.shape[1],s.shape[2]])),u(4===o.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`)),rl("avgPool",r,i);const l={x:o},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let h=Wi.runKernel(mt,l,c);return h=no(h,s.dtype),a?il(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ol=rs({avgPool3d_:function(t,e,n,r,i,s="NDHWC"){const o=ts(t,"x","avgPool3d","float32");let a=o,l=!1;4===o.rank&&(l=!0,a=il(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),u(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),u("NDHWC"===s,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),rl("avgPool3d",r,i);const c={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let d=Wi.runKernel(yt,c,h);return d=no(d,a.dtype),l?il(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const al=rs({concat_:function(t,e=0){u(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=es(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return ro(n[0]);const r=n,i={axis:e};return Wi.runKernel(At,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ll=rs({sigmoid_:function(t){const e={x:ts(t,"x","sigmoid","float32")};return Wi.runKernel(An,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cl=rs({slice_:function(t,e,n){const r=ts(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:e,size:n};return Wi.runKernel(Tn,i,s)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ul=rs({tanh_:function(t){const e={x:ts(t,"x","tanh","float32")};return Wi.runKernel(Yn,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hl=rs({basicLSTMCell_:function(t,e,n,r,i,s){const o=ts(t,"forgetBias","basicLSTMCell"),a=ts(e,"lstmKernel","basicLSTMCell"),l=ts(n,"lstmBias","basicLSTMCell"),c=ts(r,"data","basicLSTMCell"),u=ts(i,"c","basicLSTMCell"),h=ts(s,"h","basicLSTMCell"),d=al([c,h],1),p=ko(d,a),f=Ma(p,l),m=f.shape[0],g=f.shape[1]/4,y=[m,g],b=cl(f,[0,0],y),v=cl(f,[0,g],y),x=cl(f,[0,2*g],y),w=cl(f,[0,3*g],y),_=Ma(Na(ll(b),ul(v)),Na(u,ll(Ma(o,x))));return[_,Na(ul(_),ll(w))]}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dl=rs({batchToSpaceND_:function(t,e,n){const r=ts(t,"x","batchToSpaceND"),i=e.reduce(((t,e)=>t*e));u(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),u(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),u(r.shape[0]%i==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`));const s={x:r},o={blockShape:e,crops:n};return Wi.runKernel(xt,s,o)}});const pl=rs({batchNorm_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i,s){null==s&&(s=.001);const o=ts(t,"x","batchNorm"),a=ts(e,"mean","batchNorm"),l=ts(n,"variance","batchNorm");let c,h;null!=i&&(c=ts(i,"scale","batchNorm")),null!=r&&(h=ts(r,"offset","batchNorm")),u(a.rank===l.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),u(null==h||a.rank===h.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),u(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const d=function(t){let e;return e=0===t.rank||1===t.rank?il(t,[1,1,1,t.size]):2===t.rank?il(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?il(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(o),p={x:d,scale:c,offset:h,mean:a,variance:l},f={varianceEpsilon:s},m=Wi.runKernel(ue,p,f);return il(m,o.shape)}});const fl=rs({batchNorm2d_:function(t,e,n,r,i,s){const o=ts(t,"x","batchNorm"),a=ts(e,"mean","batchNorm"),l=ts(n,"variance","batchNorm");let c,h;return null!=i&&(c=ts(i,"scale","batchNorm")),null!=r&&(h=ts(r,"offset","batchNorm")),u(2===o.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`)),u(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),u(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=c&&u(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=h&&u(2===h.rank||1===h.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`)),pl(o,a,l,h,c,s)}});const ml=rs({batchNorm3d_:function(t,e,n,r,i,s){const o=ts(t,"x","batchNorm"),a=ts(e,"mean","batchNorm"),l=ts(n,"variance","batchNorm");let c,h;return null!=i&&(c=ts(i,"scale","batchNorm")),null!=r&&(h=ts(r,"offset","batchNorm")),u(3===o.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`)),u(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),u(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=c&&u(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=h&&u(3===h.rank||1===h.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`)),pl(o,a,l,h,c,s)}});const gl=rs({batchNorm4d_:function(t,e,n,r,i,s){const o=ts(t,"x","batchNorm"),a=ts(e,"mean","batchNorm"),l=ts(n,"variance","batchNorm");let c,h;return null!=i&&(c=ts(i,"scale","batchNorm")),null!=r&&(h=ts(r,"offset","batchNorm")),u(4===o.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`)),u(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),u(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=c&&u(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=h&&u(4===h.rank||1===h.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`)),pl(o,a,l,h,c,s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yl=rs({bincount_:function(t,e,n){const r=ts(t,"x","bincount"),i=ts(e,"weights","bincount");u("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),u(n>=0,(()=>`size must be non-negative, but got ${n}.`)),u(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const s={x:r,weights:i},o={size:n};return Wi.runKernel(wt,s,o)}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bl=rs({broadcastArgs_:function(t,e){const n=ts(t,"s0","broadcastArgs","int32"),r=ts(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return Wi.runKernel(St,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vl=rs({broadcastTo_:function(t,e){let n=ts(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=il(n,t)}const i=n.shape,s=Array.from(e);for(let t=e.length-1;t>=0;t--)if(i[t]===e[t])s[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const o=s.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===o.length)return ro(n);const a={x:n},l={reps:s};return Wi.runKernel(Kn,a,l)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xl=rs({ceil_:function(t){const e={x:ts(t,"x","ceil","float32")};return Wi.runKernel(Tt,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function wl(t,e,n){const r={shape:t,value:e,dtype:n};return Wi.runKernel(oe,{},r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _l=rs({clipByValue_:function(t,e,n){const r=ts(t,"x","clipByValue");if(u(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`)),e===n)return wl(r.shape,e,r.dtype);const i={x:r},s={clipValueMin:e,clipValueMax:n};return Wi.runKernel(Et,i,s)}});const Sl=rs({concat1d_:function(t){return al(t,0)}});const kl=rs({concat2d_:function(t,e){return al(t,e)}});const Tl=rs({concat3d_:function(t,e){return al(t,e)}});const El=rs({concat4d_:function(t,e){return al(t,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ml=rs({conv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=ts(t,"x","conv2d","float32"),l=ts(e,"filter","conv2d","float32");let c=a,h=!1;3===a.rank&&(h=!0,c=il(a,[1,a.shape[0],a.shape[1],a.shape[2]])),u(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),u(4===l.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`)),rl("conv2d",r,o);const d="NHWC"===i?c.shape[3]:c.shape[1];u(d===l.shape[2],(()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`)),u(el(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const p={x:c,filter:l},f={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},m=Wi.runKernel(Nt,p,f);return h?il(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Cl=rs({conv1d_:function(t,e,n,r,i="NWC",s=1,o){const a=ts(t,"x","conv1d"),l=ts(e,"filter","conv1d");let c=a,h=!1;2===a.rank&&(h=!0,c=il(a,[1,a.shape[0],a.shape[1]])),u(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),u(3===l.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`)),rl("conv1d",r,o),u(c.shape[2]===l.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`)),u(el(n,s),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`)),u("NWC"===i,(()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`));const d=il(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=il(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=Ml(p,d,[1,n],r,"NHWC",[1,s],o);return il(f,h?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Al=rs({conv2DBackpropInput_:function(t,e,n,r,i,s="NHWC",o){u(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,l=e,c=!1;3===e.rank&&(c=!0,l=il(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),u(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),u(4===l.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`)),u(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const h="NHWC"===s?a[3]:a[1],d="NHWC"===s?l.shape[3]:l.shape[1];u(h===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[2]}.`)),u(d===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`)),rl("conv2dDerInput",i,o);const p={dy:l,filter:n},f={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},m=Wi.runKernel($t,p,f);return c?il(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Nl=rs({conv2dTranspose_:function(t,e,n,r,i,s){const o=ts(t,"x","conv2dTranspose"),a=ts(e,"filter","conv2dTranspose");return Al(n,o,a,r,i,"NHWC",s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Il=rs({conv3d_:function(t,e,n,r,i="NDHWC",s=[1,1,1]){const o=ts(t,"x","conv3d"),a=ts(e,"filter","conv3d");let l=o,c=!1;4===o.rank&&(c=!0,l=il(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),u(5===l.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`)),u(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),u(l.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),u(el(n,s),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),u("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`));const h={x:l,filter:a},d={strides:n,pad:r,dataFormat:i,dilations:s},p=Wi.runKernel(Rt,h,d);return c?il(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $l=rs({conv3DBackpropInput_:function(t,e,n,r,i){u(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let s=t,o=e,a=!1;4===e.rank&&(a=!0,o=il(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const l=s[4],c=o.shape[4];u(5===s.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`)),u(5===o.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`)),u(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),u(l===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`)),u(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const h={dy:o,filter:n},d={pad:i,strides:r,inputShape:s},p=Wi.runKernel(Pt,h,d);return a?il(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});const Rl=rs({conv3dTranspose_:function(t,e,n,r,i){const s=ts(t,"x","conv3dTranspose"),o=ts(e,"filter","conv3dTranspose");return $l(n,s,o,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ol=rs({cos_:function(t){const e={x:ts(t,"x","cos","float32")};return Wi.runKernel(Lt,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Pl=rs({cosh_:function(t){const e={x:ts(t,"x","cosh","float32")};return Wi.runKernel(Dt,e)}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ll=rs({cumprod_:function(t,e=0,n=!1,r=!1){const i={x:ts(t,"x","cumprod")},s={axis:e,exclusive:n,reverse:r};return Wi.runKernel(Ft,i,s)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Dl=rs({cumsum_:function(t,e=0,n=!1,r=!1){const i={x:ts(t,"x","cumsum")},s={axis:e,exclusive:n,reverse:r};return Wi.runKernel(zt,i,s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fl=rs({denseBincount_:function(t,e,n,r=!1){const i=ts(t,"x","denseBincount"),s=ts(e,"weights","denseBincount");u("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),u(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),u(n>=0,(()=>`size must be non-negative, but got ${n}.`)),u(s.size===i.size||0===s.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`));const o={x:i,weights:s},a={size:n,binaryOutput:r};return Wi.runKernel(Ut,o,a)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zl=rs({depthToSpace_:function(t,e,n="NHWC"){const r=ts(t,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];u(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),u(i*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),u(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),u(o%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`));const a={x:r},l={blockSize:e,dataFormat:n};return Wi.runKernel(Vt,a,l)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bl=rs({depthwiseConv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=ts(t,"x","depthwiseConv2d","float32"),l=ts(e,"filter","depthwiseConv2d","float32");let c=a,h=!1;3===a.rank&&(h=!0,c=il(a,[1,a.shape[0],a.shape[1],a.shape[2]])),u(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),u(4===l.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`));const d="NHWC"===i?c.shape[3]:c.shape[1];u(d===l.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`)),rl("depthwiseConv2d",r,o);const p={x:c,filter:l},f={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},m=Wi.runKernel(jt,p,f);return h?il(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ul=rs({diag_:function(t){const e={x:ts(t,"x","diag")};return Wi.runKernel(Gt,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vl=rs({dilation2d_:function(t,e,n,r,i=[1,1],s="NHWC"){const o=ts(t,"x","dilation2d"),a=ts(e,"filter","dilation2d");u(3===o.rank||4===o.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`)),u(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),u("NHWC"===s,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`));let l=o,c=!1;3===o.rank&&(l=il(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);const h={x:l,filter:a},d={strides:n,pad:r,dilations:i},p=Wi.runKernel(qt,h,d);return c?il(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const jl=rs({equal_:function(t,e){let n=ts(t,"a","equal","string_or_numeric"),r=ts(e,"b","equal","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(ee,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Wl=rs({where_:function(t,e,n){const r=ts(e,"a","where"),i=ts(n,"b","where"),s=ts(t,"condition","where","bool"),o=Vo(Vo(s.shape,r.shape),i.shape),a={condition:vl(s,o),t:vl(r,o),e:vl(i,o)};return Wi.runKernel(Sn,a)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hl=rs({zerosLike_:function(t){const e={x:ts(t,"x","zerosLike")};return Wi.runKernel(rr,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Gl=rs({divNoNan_:function(t,e){let n=ts(t,"a","div"),r=ts(e,"b","div");[n,r]=Oi(n,r);const i=Aa(n,r),s=Hl(i),o=jl(r,s);return Wl(o,s,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ql=rs({dot_:function(t,e){const n=ts(t,"t1","dot"),r=ts(e,"t2","dot");u(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(u(i===s,(()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`)),1===n.rank&&1===r.rank){const t=il(n,[1,-1]),e=il(r,[-1,1]),i=ko(t,e);return il(i,[])}if(1===n.rank&&2===r.rank){const t=il(n,[1,-1]),e=il(r,[r.shape[0],r.shape[1]]),i=ko(t,e);return il(i,[i.size])}if(2===n.rank&&1===r.rank){const t=il(r,[-1,1]),e=ko(n,t);return il(e,[e.size])}{const t=il(r,[r.shape[0],r.shape[1]]);return ko(n,t)}}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Xl=rs({einsum_:function(t,...e){const n=e.map(((t,e)=>ts(t,`tensors${e}`,"einsum"))),r={equation:t};return Wi.runKernel(Zt,n,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yl=rs({elu_:function(t){const e={x:ts(t,"x","elu","float32")};return Wi.runKernel(Jt,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Kl=rs({erf_:function(t){let e=ts(t,"x","erf");u("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=no(e,"float32"));const n={x:e};return Wi.runKernel(te,n)}});
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Zl(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Jl(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?i.push(t[s++]):i.push(e[o++]);return i}function Ql(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((e=>t[e]))]}function tc(t,e){return Jl(t,e.map((t=>1)),e)}function ec(t,e,n){u(Zl(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function nc(t,e){if(Zl(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function rc(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function ic(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const sc=rs({max_:function(t,e=null,n=!1){const r={x:ts(t,"x","max")},i={reductionIndices:e,keepDims:n};return Wi.runKernel(Re,r,i)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const oc=rs({min_:function(t,e=null,n=!1){const r={x:ts(t,"x","min")},i={axis:e,keepDims:n};return Wi.runKernel(Ue,r,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ac=rs({pow_:function(t,e){let n=ts(t,"base","pow"),r=ts(e,"exp","pow");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(nn,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lc(t,e){if((C(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&C(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ss(t,[],[],e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cc=rs({sqrt_:function(t){const e={x:ts(t,"x","sqrt","float32")};return Wi.runKernel(In,e)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uc=rs({square_:function(t){const e=ts(t,"x","square");return Wi.runKernel("Square",{x:e},{})}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hc=rs({sum_:function(t,e=null,n=!1){let r=ts(t,"x","sum");"bool"===r.dtype&&(r=no(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Wi.runKernel($n,i,s)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dc(t,e,n=null){if(0===t.rank)return Ia(t);if(1!==t.rank&&null===n)return dc(il(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return hc(Ia(t),n);if(e===1/0)return sc(Ia(t),n);if(e===-1/0)return oc(Ia(t),n);if("euclidean"===e||2===e)return cc(hc(ac(Ia(t),lc(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return sc(hc(Ia(t),n[0]),n[1]-1);if(e===1/0)return sc(hc(Ia(t),n[1]),n[0]);if(e===-1/0)return oc(hc(Ia(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return cc(hc(uc(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const pc=rs({norm_:function(t,e="euclidean",n=null,r=!1){const i=dc(t=ts(t,"x","norm"),e,n);let s=i.shape;if(r){const e=w(n,t.shape);s=tc(i.shape,e)}return il(i,s)}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const fc=rs({euclideanNorm_:function(t,e=null,n=!1){return pc(t,"euclidean",e,n)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mc=rs({exp_:function(t){const e={x:ts(t,"x","exp")};return Wi.runKernel(ne,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gc=rs({expandDims_:function(t,e=0){const n=ts(t,"x","expandDims","string_or_numeric");u(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},i={dim:e};return Wi.runKernel(re,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yc=rs({expm1_:function(t){const e={x:ts(t,"x","expm1")};return Wi.runKernel(ie,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bc=rs({tile_:function(t,e){const n=ts(t,"x","tile","string_or_numeric");u(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},i={reps:e};return Wi.runKernel(Kn,r,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vc=rs({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=eo([t,e],r),s=t<=e?t:e;for(let t=0;t<s;++t)i.set(1,t,t);const o=il(i.toTensor(),[t,e]);if(null==n)return o;if(1===n.length)return bc(gc(o,0),[n[0],1,1]);if(2===n.length)return bc(gc(gc(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return bc(gc(gc(gc(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xc=rs({floor_:function(t){const e={x:ts(t,"x","floor","float32")};return Wi.runKernel(le,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const wc=rs({gather_:function(t,e,n=0,r=0){const i={x:ts(t,"x","gather"),indices:ts(e,"indices","gather","int32")},s={axis:n,batchDims:r};return Wi.runKernel(he,i,s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _c=rs({greater_:function(t,e){let n=ts(t,"a","greater","string_or_numeric"),r=ts(e,"b","greater","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(pe,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Sc=rs({greaterEqual_:function(t,e){let n=ts(t,"a","greaterEqual","string_or_numeric"),r=ts(e,"b","greaterEqual","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(fe,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const kc=rs({isFinite_:function(t){const e={x:ts(t,"x","isFinite")};return Wi.runKernel(be,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Tc=rs({isInf_:function(t){const e={x:ts(t,"x","isInf")};return Wi.runKernel(ve,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ec=rs({isNaN_:function(t){const e={x:ts(t,"x","isNaN")};return Wi.runKernel(xe,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Mc=rs({leakyRelu_:function(t,e=.2){const n={x:ts(t,"x","leakyRelu")},r={alpha:e};return Wi.runKernel(we,n,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Cc=rs({less_:function(t,e){let n=ts(t,"a","less","string_or_numeric"),r=ts(e,"b","less","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(_e,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ac=rs({lessEqual_:function(t,e){let n=ts(t,"a","lessEqual","string_or_numeric"),r=ts(e,"b","lessEqual","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Se,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Nc(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return Wi.runKernel(ke,{},r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ic=rs({localResponseNormalization_:function(t,e=5,n=1,r=1,i=.5){const s=ts(t,"x","localResponseNormalization");u(4===s.rank||3===s.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`)),u(g(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let o=s,a=!1;3===s.rank&&(a=!0,o=il(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:r,beta:i},h=Wi.runKernel(Ie,l,c);return a?il(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $c=rs({log_:function(t){const e={x:ts(t,"x","log","float32")};return Wi.runKernel(Te,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Rc=rs({log1p_:function(t){const e={x:ts(t,"x","log1p")};return Wi.runKernel(Ee,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Oc(t,e){u(P(t),(()=>"The f passed in variableGrads(f) must be a function")),u(null==e||Array.isArray(e)&&e.every((t=>t instanceof Ti)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in Wi.registeredVariables)e.push(Wi.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,i=e.length;e=e.filter((t=>t.trainable)),u(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`));const{value:s,grads:o}=Wi.gradients(t,e,null,!0);u(o.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),u(0===s.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=o[e]&&(a[t.name]=o[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:s,grads:a}}function Pc(t){return Wi.customGrad(t)}function Lc(t){if(t.filter((t=>null==t)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Dc=rs({softplus_:function(t){const e={x:ts(t,"x","softplus")};return Wi.runKernel(Nn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fc=rs({logSigmoid_:function(t){const e=ts(t,"x","logSigmoid"),n=Pc((t=>({value:Po(Dc(Po(t))),gradFunc:e=>Na(e,ll(Po(t)))})));return n(e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zc=rs({sub_:function(t,e){let n=ts(t,"a","sub"),r=ts(e,"b","sub");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(qn,i)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bc=rs({logSoftmax_:function(t,e=-1){const n=ts(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=Pc(((t,n)=>{const r=sc(t,e,!0),i=zc(t,r),s=zc(no(i,"float32"),$c(hc(mc(i),e,!0)));n([s]);return{value:s,gradFunc:(t,n)=>{const[r]=n,i=mc(r);return zc(t,Na(hc(t,e,!0),i))}}}));return r(n)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Uc=rs({logSumExp_:function(t,e=null,n=!1){const r=ts(t,"x","logSumExp"),i=w(e,r.shape),s=sc(r,i,!0),o=zc(r,s),a=mc(o),l=hc(a,i),c=$c(l),u=Ma(il(s,c.shape),c);if(n){const t=tc(u.shape,i);return il(u,t)}return u}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vc=rs({logicalAnd_:function(t,e){const n=ts(t,"a","logicalAnd","bool"),r=ts(e,"b","logicalAnd","bool");Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Me,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const jc=rs({logicalNot_:function(t){const e={x:ts(t,"x","logicalNot","bool")};return Wi.runKernel(Ce,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Wc=rs({logicalOr_:function(t,e){const n=ts(t,"a","logicalOr","bool"),r=ts(e,"b","logicalOr","bool");Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Ae,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hc=rs({logicalXor_:function(t,e){const n=ts(t,"a","logicalXor","bool"),r=ts(e,"b","logicalXor","bool");return Vo(n.shape,r.shape),Vc(Wc(t,e),jc(Vc(t,e)))}}),Gc=2147483648;
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const qc=rs({searchSorted_:function(t,e,n="left"){const r=ts(t,"sortedSequence","searchSorted"),i=ts(e,"values","searchSorted"),s=r.shape[r.shape.length-1],o=i.shape[i.shape.length-1],a=il(r,[-1,s]),l=il(i,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(f(l.shape)>=Gc)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=Gc)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:l},u={side:n};return Wi.runKernel(_n,c,u)}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Xc(t,e){return qc(t,e,"left")}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yc=rs({maxPool_:function(t,e,n,r,i){const s=ts(t,"x","maxPool");let o=s,a=!1;3===s.rank&&(a=!0,o=il(s,[1,s.shape[0],s.shape[1],s.shape[2]])),u(4===o.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`)),u(el(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),rl("maxPool",r,i);const l={x:o},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i},h=Wi.runKernel(Pe,l,c);return a?il(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Kc=rs({maxPool3d_:function(t,e=[1,1,1],n,r,i,s="NDHWC"){const o=ts(t,"x","maxPool3d");let a=o,l=!1;4===o.rank&&(l=!0,a=il(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),u(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),u("NDHWC"===s,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),rl("maxPool3d",r,i);const c={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},d=Wi.runKernel(De,c,h);return l?il(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Zc=rs({maxPoolWithArgmax_:function(t,e,n,r,i=!1){const s={x:ts(t,"x","maxPoolWithArgmax")},o={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},a=Wi.runKernel(ze,s,o);return{result:a[0],indexes:a[1]}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Jc=rs({maximum_:function(t,e){let n=ts(t,"a","maximum"),r=ts(e,"b","maximum");[n,r]=Oi(n,r),"bool"===n.dtype&&(n=no(n,"int32"),r=no(r,"int32")),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Oe,i)}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qc=rs({mean_:function(t,e=null,n=!1){const r={x:ts(t,"x","mean")},i={axis:e,keepDims:n};return Wi.runKernel(Be,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tu(t,e="float32"){if("complex64"===e){const e=tu(t,"float32"),n=tu(t,"float32");return is(e,n)}const n=U(f(t),e);return Wi.makeTensor(n,t,e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function eu(t,e="float32"){if("complex64"===e){const e=eu(t,"float32"),n=tu(t,"float32");return is(e,n)}const n=B(f(t),e);return Wi.makeTensor(n,t,e)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nu(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=ts(t,"x","meshgrid",t instanceof Si?t.dtype:"float32");if(void 0===e)return[r];let i=ts(e,"y","meshgrid",e instanceof Si?e.dtype:"float32");const s=f(r.shape),o=f(i.shape);return"xy"===n?(r=il(r,[1,-1]),i=il(i,[-1,1]),[ko(eu([o,1],r.dtype),r),ko(i,eu([1,s],i.dtype))]):(r=il(r,[-1,1]),i=il(i,[1,-1]),[ko(r,eu([1,o],r.dtype)),ko(eu([s,1],i.dtype),i)])}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ru=rs({minimum_:function(t,e){let n=ts(t,"a","minimum"),r=ts(e,"b","minimum");[n,r]=Oi(n,r),"bool"===n.dtype&&(n=no(n,"int32"),r=no(r,"int32")),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Ve,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const iu=rs({mirrorPad_:function(t,e,n){u("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=ts(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");u(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const i="reflect"===n?1:0;for(let t=0;t<r.rank;t++)u(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),u(e[t][0]>=0&&e[t][0]<=r.shape[t]-i&&e[t][1]>=0&&e[t][1]<=r.shape[t]-i,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-i} or less than 0 for input of shape ${r.shape}`));const s={paddings:e,mode:n},o={x:r};return Wi.runKernel(je,o,s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const su=rs({mod_:function(t,e){let n=ts(t,"a","mod"),r=ts(e,"b","mod");[n,r]=Oi(n,r);const i={a:n,b:r};return Wi.runKernel(We,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ou=rs({moments_:function(t,e=null,n=!1){const r=w(e,(t=ts(t,"x","moments")).shape),i=Qc(t,r,n);let s=i.shape;n||(s=tc(i.shape,r));const o=uc(zc(no(t,"float32"),il(i,s)));return{mean:i,variance:Qc(o,r,n)}}});const au=rs({multiRNNCell_:function(t,e,n,r){const i=ts(e,"data","multiRNNCell"),s=es(n,"c","multiRNNCell"),o=es(r,"h","multiRNNCell");let a=i;const l=[];for(let e=0;e<t.length;e++){const n=t[e](a,s[e],o[e]);l.push(n[0]),l.push(n[1]),a=n[1]}const c=[],u=[];for(let t=0;t<l.length;t+=2)c.push(l[t]),u.push(l[t+1]);return[c,u]}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lu=rs({multinomial_:function(t,e,n,r=!1){const i=ts(t,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const a={logits:1===o?il(i,[1,-1]):i},l={numSamples:e,seed:n,normalized:r},c=Wi.runKernel(He,a,l);return 1===o?il(c,[c.size]):c}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cu=rs({notEqual_:function(t,e){let n=ts(t,"a","notEqual","string_or_numeric"),r=ts(e,"b","notEqual","string_or_numeric");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Xe,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uu=rs({onesLike_:function(t){const e={x:ts(t,"x","onesLike")};return Wi.runKernel(Je,e)}});const hu=rs({outerProduct_:function(t,e){const n=ts(t,"v1","outerProduct"),r=ts(e,"v2","outerProduct");u(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const i=il(n,[-1,1]),s=il(r,[1,-1]);return ko(i,s)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const du=rs({pad_:function(t,e,n=0){const r=ts(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},s={x:r};return Wi.runKernel(en,s,i)}});const pu=rs({pad1d_:function(t,e,n=0){return u(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),du(t,[e],n)}});const fu=rs({pad2d_:function(t,e,n=0){return u(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),du(t,e,n)}});const mu=rs({pad3d_:function(t,e,n=0){return u(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),du(t,e,n)}});const gu=rs({pad4d_:function(t,e,n=0){return u(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),du(t,e,n)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yu=rs({spaceToBatchND_:function(t,e,n){const r=ts(t,"x","spaceToBatchND");u(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),u(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),u(r.shape.reduce(((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const i={x:r},s={blockShape:e,paddings:n};return Wi.runKernel(Rn,i,s)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bu=rs({pool_:function(t,e,n,r,i,s,o){null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");const a=ts(t,"x","maxPool");let l=a,c=!1;3===a.rank&&(c=!0,l=il(a,[1,a.shape[0],a.shape[1],a.shape[2]])),u(el(s,i),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`));const h=Ha(l.shape,e,s,i,r),d=[h.dilationHeight,h.dilationWidth];let p;p="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),i=r.map((t=>Math.floor(t/2))),s=r.map(((t,e)=>t-i[e]));return r.map(((t,e)=>[i[e],s[e]]))}([h.filterHeight,h.filterWidth],d):[[0,0],[0,0]];const f=1===d[0]&&1===d[1],[m,g]=function(t,e,n){const r=n.map((t=>t[0])),i=n.map((t=>t[1])),s=t.concat(r,i),o=e.map(((t,e)=>(t-s[e]%t)%t)),a=i.map(((t,e)=>t+o[e])),l=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,o[e]]));return[l,c]}([h.inHeight,h.inWidth],d,p),y=f?r:"valid",b=f?l:yu(l,d,m),v=("avg"===n?()=>sl(b,e,s,y,o):()=>Yc(b,e,s,y,o))(),x=f?v:dl(v,d,g);return c?il(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vu=rs({prelu_:function(t,e){const n={x:ts(t,"x","prelu"),alpha:ts(e,"alpha","prelu")};return Wi.runKernel(rn,n)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xu=rs({prod_:function(t,e=null,n=!1){let r=ts(t,"x","prod");"bool"===r.dtype&&(r=no(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Wi.runKernel(sn,i,s)}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const wu=rs({raggedGather_:function(t,e,n,r){const i=t.map(((t,e)=>ts(t,`tensors${e}`,"raggedGather","int32"))),s={paramsNestedSplits:i,paramsDenseValues:ts(e,"paramsDenseValues","raggedGather"),indices:ts(n,"indices","raggedGather","int32")},o={outputRaggedRank:r},a=Wi.runKernel(on,s,o);return{outputNestedSplits:a.slice(0,a.length-1),outputDenseValues:a[a.length-1]}}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _u=rs({raggedTensorToTensor_:function(t,e,n,r,i){const s=ts(t,"shape","raggedTensorToTensor","int32"),o=ts(e,"values","raggedTensorToTensor"),a=ts(n,"defaultValue","raggedTensorToTensor",o.dtype),l=r.map(((t,e)=>ts(t,`tensors${e}`,"raggedTensorToTensor","int32"))),c={shape:s,values:o,defaultValue:a,rowPartitionTensors:l},u={rowPartitionTypes:i};return Wi.runKernel(an,c,u)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Su=rs({rand_:function(t,e,n){const r=f(t);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);i=new Uint8Array(r)}for(let t=0;t<r;t++)i[t]=e();return Wi.makeTensor(i,t,n)}});var ku={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=String(e);for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function s(t,e){var n=new r(t),s=e&&e.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.alea=s}(0,t,!1)}(ku);var Tu={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xor128=s}(0,t,!1)}(Tu);var Eu={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xorwow=s}(0,t,!1)}(Eu);var Mu={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.x&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xorshift7=s}(0,t,!1)}(Mu);var Cu={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],l=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,l=Math.max(l,e.length)),i=0,s=-32;s<l;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,i=0==(n=a[127&s]^=r+o)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=o,t.X=a,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function s(t,e){null==t&&(t=+new Date);var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&(s.X&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.xor4096=s}(0,t,!1)}(Cu);var Au={exports:{}};!function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function s(t,e){var n=new r(t),s=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&i(s,n),o.state=function(){return i(n,{})}),o}e&&e.exports?e.exports=s:n&&n.amd?n((function(){return s})):this.tychei=s}(0,t,!1)}(Au);var Nu={exports:{}},Iu=wr(Object.freeze({__proto__:null,default:{}}));!function(t){!function(e,n,r){var i,s=256,o=r.pow(s,6),a=r.pow(2,52),l=2*a,c=255;function u(t,c,u){var g=[],y=f(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(n)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(s):(t=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(t)),m(t)}catch(t){var r=e.navigator,o=r&&r.plugins;return[+new Date,e,o,e.screen,m(n)]}}():t,3),g),b=new h(g),v=function(){for(var t=b.g(6),e=o,n=0;t<a;)t=(t+n)*s,e*=s,n=b.g(1);for(;t>=l;)t/=2,e/=2,n>>>=1;return(t+n)/e};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,f(m(b.S),n),(c.pass||u||function(t,e,n,i){return i&&(i.S&&d(i,b),t.state=function(){return d(b,{})}),n?(r.random=t,e):t})(v,y,"global"in c?c.global:this==r,c.state)}function h(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<s;)a[i]=i++;for(i=0;i<s;i++)a[i]=a[o=c&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=c&i+1],n=n*s+a[c&(a[i]=a[o=c&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(s)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function f(t,e){for(var n,r=t+"",i=0;i<r.length;)e[c&i]=c&(n^=19*e[c&i])+r.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(f(r.random(),n),t.exports){t.exports=u;try{i=Iu}catch(t){}}else r.seedrandom=u}("undefined"!=typeof self?self:vr,[],Math)}(Nu);var $u=ku.exports,Ru=Tu.exports,Ou=Eu.exports,Pu=Mu.exports,Lu=Cu.exports,Du=Au.exports,Fu=Nu.exports;Fu.alea=$u,Fu.xor128=Ru,Fu.xorwow=Ou,Fu.xorshift7=Pu,Fu.xor4096=Lu,Fu.tychei=Du;var zu=Fu;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Bu{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=i||Math.random();this.random=zu.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,s;do{r=2*this.random()-1,i=2*this.random()-1,s=r*r+i*i}while(s>=1||0===s);const o=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*r*o,e=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Uu{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const i=r||Math.random();this.randu=zu.alea(i.toString()),this.randn=new Bu(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,i,s;for(;;){do{r=this.randn.nextValue(),s=1+this.c*r}while(s<=0);if(s*=s*s,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-s+Math.log(s)),i=this.randu(),i<e||Math.log(i)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class Vu{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=zu.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ju=rs({randomGamma_:function(t,e,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const s=new Uu(e,n,r,i),o=eo(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Wu=rs({randomNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const s=new Bu(e,n,r,!1,i),o=eo(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hu=rs({randomStandardNormal_:function(t,e,n){if(null!=e&&"bool"===e)throw new Error(`Unsupported data type ${e}`);return Wu(t,0,1,e,n)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Gu=rs({randomUniform_:function(t,e=0,n=1,r="float32",i){const s=eo(t,r),o=new Vu(e,n,null,i);for(let t=0;t<s.values.length;t++)s.values[t]=o.nextValue();return s.toTensor()}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function qu(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return Wi.runKernel(ln,{},i)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Xu=rs({reciprocal_:function(t){const e={x:ts(t,"x","reciprocal")};return Wi.runKernel(un,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yu=rs({relu_:function(t){const e={x:ts(t,"x","relu")};return Wi.runKernel(hn,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ku=rs({relu6_:function(t){const e={x:ts(t,"x","relu6")};return Wi.runKernel(yn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Zu=rs({reverse_:function(t,e){const n={x:ts(t,"x","reverse")},r={dims:e};return Wi.runKernel(bn,n,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ju=rs({reverse1d_:function(t){const e=ts(t,"x","reverse");return u(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),Zu(e,0)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qu=rs({reverse2d_:function(t,e){const n=ts(t,"x","reverse");return u(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),Zu(n,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const th=rs({reverse3d_:function(t,e){const n=ts(t,"x","reverse");return u(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),Zu(n,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const eh=rs({reverse4d_:function(t,e){const n=ts(t,"x","reverse");return u(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),Zu(n,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const nh=rs({round_:function(t){const e={x:ts(t,"x","round")};return Wi.runKernel(vn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rh=rs({rsqrt_:function(t){const e={x:ts(t,"x","rsqrt","float32")};return Wi.runKernel(xn,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ih=rs({selu_:function(t){const e={x:ts(t,"x","selu")};return Wi.runKernel(kn,e)}});const sh=rs({separableConv2d_:function(t,e,n,r,i,s=[1,1],o="NHWC"){const a=ts(t,"x","separableConv2d"),l=ts(e,"depthwiseFilter","separableConv2d"),c=ts(n,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(3===a.rank&&(d=!0,h=il(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");u(4===h.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`)),u(4===l.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`)),u(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`)),u(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),u(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const p=l.shape[2],f=l.shape[3];u(c.shape[2]===p*f,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`));const m=Bl(h,l,r,i,o,s),g=Ml(m,c,1,"valid",o);return d?il(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const oh=async function(t,e){const n=ts(t,"x","setdiff1d"),r=ts(e,"y","setdiff1d");u(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),u(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),u(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let t=0;t<i.length;t++)o.has(i[t])||a++;const l=new xi([a],n.dtype),c=new xi([a],"int32");for(let t=0,e=0;t<i.length;t++)o.has(i[t])||(l.values[e]=i[t],c.values[e]=t,e++);return[l.toTensor(),c.toTensor()]};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ah=rs({sign_:function(t){const e={x:ts(t,"x","sign")};return Wi.runKernel(Cn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lh=rs({sin_:function(t){const e={x:ts(t,"x","sin","float32")};return Wi.runKernel(En,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ch=rs({sinh_:function(t){const e={x:ts(t,"x","sinh")};return Wi.runKernel(Mn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uh=rs({slice1d_:function(t,e,n){const r=ts(t,"x","slice1d");return u(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),cl(r,[e],[n])}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hh=rs({slice2d_:function(t,e,n){const r=ts(t,"x","slice2d");return u(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),cl(r,e,n)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dh=rs({slice3d_:function(t,e,n){const r=ts(t,"x","slice3d");return u(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),cl(r,e,n)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ph=rs({slice4d_:function(t,e,n){const r=ts(t,"x","slice4d");return u(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),cl(r,e,n)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const fh=rs({softmax_:function(t,e=-1){const n=ts(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return Wi.runKernel(Pn,r,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mh=rs({fft_:function(t){u("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Wi.runKernel(se,e)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gh=rs({ifft_:function(t){u("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Wi.runKernel(ge,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yh=rs({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=il(t,[n,e]);r=gh(i)}else{const i=[n,2*(e-1)],s=il(Lo(t),[n,e]),o=il(Oo(t),[n,e]),a=Zu(cl(s,[0,1],[n,e-2]),1),l=Na(Zu(cl(o,[0,1],[n,e-2]),1),lc(-1)),c=al([s,a],1),u=al([o,l],1),h=il(is(c,u),[i[0],i[1]]);r=gh(h)}if(r=Lo(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=il(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bh=rs({split_:function(t,e,n=0){const r={x:ts(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Wi.runKernel(On,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vh=rs({rfft_:function(t,e){u("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(null!=e&&e<n){const r=t.shape.map((t=>0)),s=t.shape.map((t=>t));s[t.shape.length-1]=e,i=cl(t,r,s),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,i=al([t,tu(r)],t.shape.length-1),n=e}else i=t;const s=Hl(i),o=il(is(i,s),[r,n]),a=mh(o),l=Math.floor(n/2)+1,c=Lo(a),h=Oo(a),d=bh(c,[l,n-l],c.shape.length-1),p=bh(h,[l,n-l],h.shape.length-1),f=i.shape.slice();return f[i.shape.length-1]=l,il(is(d[0],p[0]),f)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xh=rs({squaredDifference_:function(t,e){let n=ts(t,"a","squaredDifference"),r=ts(e,"b","squaredDifference");[n,r]=Oi(n,r),Vo(n.shape,r.shape);const i={a:n,b:r};return Wi.runKernel(Un,i,{})}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const wh=rs({squeeze_:function(t,e){const n=ts(t,"x","squeeze","string_or_numeric");return il(n,_(n.shape,e).newShape)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _h=rs({stack_:function(t,e=0){const n=es(t,"tensors","stack","string_or_numeric");u(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&u(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,i={axis:e};return Wi.runKernel(tn,r,i)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Sh=rs({step_:function(t,e=0){const n={x:ts(t,"x","step")},r={alpha:e};return Wi.runKernel(ir,n,r)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const kh=rs({stridedSlice_:function(t,e,n,r,i=0,s=0,o=0,a=0,l=0){const c={x:ts(t,"x","stridedSlice","string_or_numeric")},u={begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return Wi.runKernel(jn,c,u)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Th=rs({tan_:function(t){const e={x:ts(t,"x","tan","float32")};return Wi.runKernel(Xn,e)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Eh(t,e){d(t);const n=Zi(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ss(t,null,n,e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Mh(t,e,n){if(d(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Zi(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ss(t,e,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ch(t,e,n){if(d(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Zi(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ss(t,e,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ah(t,e,n){if(d(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Zi(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ss(t,e,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Nh(t,e,n){if(d(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Zi(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ss(t,e=e||r,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ih=rs({topk_:function(t,e=1,n=!0){const r=ts(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const s={x:r},o={k:e,sorted:n},[a,l]=Wi.runKernel(Zn,s,o);return{values:a,indices:l}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $h=rs({truncatedNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new Bu(e,n,r,!0,i),o=eo(t,r);for(let t=0;t<o.values.length;t++)o.values[t]=s.nextValue();return o.toTensor()}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Rh=rs({unique_:function(t,e=0){const n=ts(t,"x","unique","string_or_numeric");u(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},i={axis:e},[s,o]=Wi.runKernel(tr,r,i);return{values:s,indices:o}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Oh=rs({unsortedSegmentSum_:function(t,e,n){const r=ts(t,"x","unsortedSegmentSum"),i=ts(e,"segmentIds","unsortedSegmentSum","int32");u(g(n),(()=>"numSegments must be of dtype int"));const s={x:r,segmentIds:i},o={numSegments:n};return Wi.runKernel(nr,s,o)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ph=rs({unstack_:function(t,e=0){const n=ts(t,"x","unstack","string_or_numeric");u(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},i={axis:e};return Wi.runKernel(er,r,i)}});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Lh(t,e){return qc(t,e,"right")}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Dh(t,e=!0,n,r){return Wi.makeVariable(t,e,n,r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Fh(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=eo(t,"int32"),i=eo([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const s=r.indexToLoc(n[e]),o=e*t.length;i.values.set(s,o)}return i.toTensor()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zh=async function(t){const e=ts(t,"condition","whereAsync","bool"),n=await e.data(),r=Fh(e.shape,n);return t!==e&&e.dispose(),r};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bh=async function(t,e,n){const r=ts(t,"tensor","boolMask"),i=ts(e,"mask","boolMask","bool"),s=null==n?0:n,o=i.rank,a=r.shape;u(o>0,(()=>"mask cannot be scalar")),h(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let t=s;t<s+o;t++)l*=a[t];const c=a.slice(0,s).concat([l],a.slice(s+o)),d=il(r,c),p=il(i,[-1]),f=await zh(p),m=wh(f,[1]),g=wc(d,m,s);return t!==r&&r.dispose(),e!==i&&i.dispose(),m.dispose(),d.dispose(),p.dispose(),f.dispose(),g};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Uh=rs({movingAverage_:function(t,e,n,r,i=!0){const s=ts(t,"v","movingAverage"),o=ts(e,"x","movingAverage"),a=ts(n,"decay","movingAverage");Pi(s,o),u(m(s.shape,o.shape),(()=>"Shape mismatch in v and x"));const l=lc(1),c=zc(l,a);let h=Na(zc(o,s),c);if(i){u(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=ts(r,"step","movingAverage");h=Aa(h,zc(l,ac(a,t)))}return Ma(s,h)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vh=rs({scatterND_:function(t,e,n){const r=ts(t,"indices","scatterND","int32"),i=ts(e,"updates","scatterND");ta(i,r,n);const s={indices:r,updates:i},o={shape:n};return Wi.runKernel(wn,s,o)}});const jh=rs({sparseToDense_:
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r=0){const i=ts(t,"sparseIndices","sparseToDense","int32"),s=ts(e,"sparseValues","sparseToDense","string_or_numeric"),o=ts(r,"defaultValue","sparseToDense",s.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,s=t.rank>1?t.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=e.size;if(0!==e.rank&&(1!==e.rank||o!==i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},l={outputShape:n};return Wi.runKernel(Bn,a,l)}});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Wh=rs({gatherND_:function(t,e){const n=ts(e,"indices","gatherND","int32"),r={params:ts(t,"x","gatherND","string_or_numeric"),indices:n};return Wi.runKernel(de,r)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hh=rs({dropout_:
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r){const i=ts(t,"x","dropout");if(u("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),u(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof Si?i.clone():i;const s=function(t,e){if(null==e)return t.shape.slice();if(m(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),o=1-e,a=Aa(xc(Ma(Gu(s,0,1,"float32",r),o)),o);return Na(i,a)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Gh(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function qh(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let s=0;s<t;++s){const o=2*Math.PI*s/(t+r-1);i[s]=e-n*Math.cos(o)}return Eh(i,"float32")}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Xh=async function(t,e,n=1){const r=ts(t,"predictions","inTopK"),i=ts(e,"targets","inTopK");u(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),u(r.rank-1===i.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`)),h(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];u(n>0&&n<=s,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`));const o=await r.data(),a=await i.data(),[l,c]=[o.length/s,s],d=S("bool",l);for(let t=0;t<l;t++){const e=t*c,r=o.subarray(e,e+c),i=[];for(let t=0;t<r.length;t++)i.push({value:r[t],index:t});i.sort(((t,e)=>e.value-t.value)),d[t]=0;for(let e=0;e<n;e++)if(i[e].index===a[t]){d[t]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),os(d,i.shape,"bool")};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yh=rs({conv2DBackpropFilter_:function(t,e,n,r,i,s="NHWC",o){let a=t;3===t.rank&&(a=il(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=il(e,[1,e.shape[0],e.shape[1],e.shape[2]])),u(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),u(4===l.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`)),u(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===s?a.shape[3]:a.shape[1],h="NHWC"===s?l.shape[3]:l.shape[1];u(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),u(h===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${n[3]}).`)),rl("conv2dDerFilter",i,o);const d={x:a,dy:l},p={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return Wi.runKernel(It,d,p)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Kh(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return Na(t,Sh(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Zh(t,e){let n=e;const r=Uo(t.shape,e.shape);return r.length>0&&(n=hc(n,r)),il(n,t.shape)}function Jh(t,e,n,r){if("linear"===e)return t;if("relu"===e)return Yu(t);if("elu"===e)return Yl(t);if("relu6"===e)return Ku(t);if("prelu"===e)return vu(t,n);if("leakyrelu"===e)return Mc(t,r);if("sigmoid"===e)return ll(t);throw new Error(`Unknown fused activation ${e}.`)}const Qh=(t,e)=>!(t>0)||"linear"===e;
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const td=rs({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",!1===Qh(Wi.state.gradientDepth,l)){u("NHWC"===i,(()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let d=Ml(t,e,n,r,i,s,o);return null!=a&&(d=Ma(d,a)),Jh(d,l,c,h)}const d=ts(t,"x","conv2d","float32"),p=ts(e,"filter","conv2d","float32");let f=d,m=!1;3===d.rank&&(m=!0,f=il(d,[1,d.shape[0],d.shape[1],d.shape[2]])),u(4===f.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`)),u(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),rl("fused conv2d",r,o);const g="NHWC"===i?f.shape[3]:f.shape[1];u(p.shape[2]===g,(()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`)),u(el(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const y=qa(f.shape,p.shape,n,s,r,o);let b,v;if(null!=a&&(b=ts(a,"bias","fused conv2d"),[b]=Oi(b,d),"NHWC"===i?Vo(y.outShape,b.shape):(u(b.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`)),u(0===b.shape.length||b.shape[0]===y.outChannels||1===b.shape[0],(()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(u(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)u(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{Vo(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}v=ts(c,"prelu weights","fused conv2d")}const x=(t,e)=>{u("NHWC"===i,(()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`));const[o,a,c,h]=e,d=Kh(t,c,l);u(tl(s),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const p=[Al(a.shape,d,o,n,r),Yh(a,d,o.shape,n,r)];if(null!=h){const t=Zh(h,d);p.push(t)}return p},w={x:f,filter:p,bias:b,preluActivationWeights:v},_={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:h};if(null==a){const t=Pc(((t,e,n)=>{let r=Wi.runKernel(lr,w,_);return n([e,t,r]),m&&(r=il(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}));return t(f,p)}{const t=Pc(((t,e,n,r)=>{let i=Wi.runKernel(lr,w,_);return r([e,t,i,n]),m&&(i=il(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:x}}));return t(f,p,b)}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ed=rs({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,s=[1,1],o){let a=t;3===t.rank&&(a=il(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=il(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return Wi.runKernel(Wt,c,u)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const nd=rs({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,s=[1,1],o){let a=e,l=!1;3===e.rank&&(l=!0,a=il(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:t},h=Wi.runKernel(Ht,c,u);return l?il(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rd=rs({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(!1===Qh(Wi.state.gradientDepth,l)){let u=Bl(t,e,n,r,i,s,o);return null!=a&&(u=Ma(u,a)),Jh(u,l,c,h)}const d=ts(t,"x","depthwiseConv2d","float32"),p=ts(e,"filter","depthwiseConv2d","float32");let f=d,m=!1;3===d.rank&&(m=!0,f=il(d,[1,d.shape[0],d.shape[1],d.shape[2]])),u(4===f.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`)),u(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),u(f.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==s&&(s=[1,1]),u(el(n,s),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),rl("fused depthwiseConv2d",r,o);const g=qa(f.shape,p.shape,n,s,r,o,!0);let y,b;null!=a&&(y=ts(a,"bias","fused conv2d"),[y]=Oi(y,d),Vo(g.outShape,y.shape)),null!=c&&(b=ts(c,"prelu weights","fused depthwiseConv2d"));const v=(t,e)=>{u(tl(s),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`));const[i,a,c,h]=e,d=Kh(t,c,l),p=nd(a.shape,d,i,n,r,s,o),f=ed(a,d,i.shape,n,r,s,o);if(null!=h){return[p,f,Zh(y,d)]}return[p,f]},x={x:f,filter:p,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l,leakyreluAlpha:h};if(null==a){const t=Pc(((t,e,n)=>{let r=Wi.runKernel(cr,x,w);return n([e,t,r]),m&&(r=il(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return t(f,p)}{const t=Pc(((t,e,n,r)=>{let i=Wi.runKernel(cr,x,w);return r([e,t,i,n]),m&&(i=il(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}}));return t(f,p,y)}}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const id=rs({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(!1===Qh(Wi.state.gradientDepth,s)){let l=ko(t,e,n,r);return null!=i&&(l=Ma(l,i)),Jh(l,s,o,a)}let l=ts(t,"a","fused matMul"),c=ts(e,"b","fused matMul");[l,c]=Oi(l,c);const h=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=n?l.shape[l.rank-1]:l.shape[l.rank-2],m=r?c.shape[c.rank-2]:c.shape[c.rank-1],g=l.shape.slice(0,-2),y=c.shape.slice(0,-2),b=f(g),v=f(y);u(h===d,(()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=Vo(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([p,m]),w=il(l,n?[b,h,p]:[b,p,h]),_=il(c,r?[v,m,d]:[v,d,m]);let S,k;null!=i&&(S=ts(i,"bias","fused matMul"),[S]=Oi(S,l),Vo(x,S.shape)),null!=o&&(k=ts(o,"prelu weights","fused matMul"));const T=(t,e)=>{const[o,a,l,c]=e,u=Kh(il(t,l.shape),l,s);let h,d;if(n||r?!n&&r?(h=ko(u,a,!1,!1),d=ko(u,o,!0,!1)):n&&!r?(h=ko(a,u,!1,!0),d=ko(o,u,!1,!1)):(h=ko(a,u,!0,!0),d=ko(u,o,!0,!0)):(h=ko(u,a,!1,!0),d=ko(o,u,!0,!1)),null!=i){return[h,d,Zh(c,u)]}return[h,d]},E={a:w,b:_,bias:S,preluActivationWeights:k},M={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};if(null==i){const t=Pc(((t,e,n)=>{const r=Wi.runKernel(ar,E,M);return n([t,e,r]),{value:il(r,x),gradFunc:T}}));return t(w,_)}{const t=Pc(((t,e,n,r)=>{const i=Wi.runKernel(ar,E,M);return r([t,e,i,n]),{value:il(i,x),gradFunc:T}}));return t(w,_,S)}}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var sd=Object.freeze({__proto__:null,conv2d:td,depthwiseConv2d:rd,matMul:id});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const od=rs({hammingWindow_:function(t){return qh(t,.54,.46)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ad=rs({hannWindow_:function(t){return qh(t,.5,.5)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ld=rs({frame_:function(t,e,n,r=!1,i=0){let s=0;const o=[];for(;s+e<=t.size;)o.push(cl(t,s,e)),s+=n;if(r)for(;s<t.size;){const r=s+e-t.size,a=al([cl(t,s,e-r),wl([r],i)]);o.push(a),s+=n}return 0===o.length?Mh([],[0,e]):il(al(o),[o.length,e])}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cd=rs({stft_:function(t,e,n,r,i=ad){null==r&&(r=Gh(e));const s=ld(t,e,n),o=Na(s,i(e));return vh(o,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ud=rs({cropAndResize_:function(t,e,n,r,i="bilinear",s=0){const o=ts(t,"image","cropAndResize"),a=ts(e,"boxes","cropAndResize","float32"),l=ts(n,"boxInd","cropAndResize","int32"),c=a.shape[0];u(4===o.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`)),u(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),u(1===l.rank&&l.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),u(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),u(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),u("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const h={image:o,boxes:a,boxInd:l},d={method:i,extrapolationValue:s,cropSize:r};return Wi.runKernel(Bt,h,d)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hd=rs({flipLeftRight_:function(t){const e=ts(t,"image","flipLeftRight","float32");u(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return Wi.runKernel(ae,n,{})}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dd=rs({grayscaleToRGB_:function(t){const e=ts(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];u(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),u(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,bc(e,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const pd=rs({rotateWithOffset_:function(t,e,n=0,r=.5){const i=ts(t,"image","rotateWithOffset","float32");u(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const s={image:i},o={radians:e,fillValue:n,center:r};return Wi.runKernel(or,s,o)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fd(t,e,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);const o=t.shape[0];return n=Math.min(n,o),u(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),u(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),u(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),u(1===e.rank,(()=>"scores must be a 1D tensor")),u(e.shape[0]===o,(()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`)),u(0<=s&&s<=1,(()=>`softNmsSigma must be in [0, 1], but was '${s}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const md=rs({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=ts(t,"boxes","nonMaxSuppression","float32"),o=ts(e,"scores","nonMaxSuppression","float32"),a=fd(s,o,n,r,i),l={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold};return Wi.runKernel(Ye,{boxes:s,scores:o},l)}});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gd(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(e,t[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t,e,n||yd)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function yd(t,e){return t>e?1:t<e?-1:0}function bd(t,e,n,r,i){return wd(t,e,n,r,i,0)}function vd(t,e,n,r,i,s){return wd(t,e,n,r,i,0,!1,s,!0)}function xd(t,e,n,r,i,s){return wd(t,e,n,r,i,s,!0)}function wd(t,e,n,r,i,s,o=!1,a=!1,l=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>i&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(kd);const u=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:s,suppressBeginIndex:o}=e;if(n<i)break;let a=!1;for(let n=h.length-1;n>=o;--n){const o=_d(t,s,h[n]);if(o>=r){a=!0;break}if(e.score=e.score*Sd(r,u,o),e.score<=i)break}e.suppressBeginIndex=h.length,a||(e.score===n?(h.push(s),d.push(e.score)):e.score>i&&gd(c,e,kd))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),l&&(m.validOutputs=p),m}function _d(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(a-s)*(l-o),f=(h-c)*(d-u);if(p<=0||f<=0)return 0;const m=Math.max(s,c),g=Math.max(o,u),y=Math.min(a,h),b=Math.min(l,d),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(p+f-v)}function Sd(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function kd(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Td=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=ts(t,"boxes","nonMaxSuppressionAsync"),o=ts(e,"scores","nonMaxSuppressionAsync"),a=fd(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([s.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:h}=bd(c,u,n,r,i);return s!==t&&s.dispose(),o!==e&&o.dispose(),Eh(h,"int32")};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ed=rs({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=ts(t,"boxes","nonMaxSuppression"),a=ts(e,"scores","nonMaxSuppression"),l=fd(o,a,n,r,i,s),c={boxes:o,scores:a},u={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},h=Wi.runKernel(Ze,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Md=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=ts(t,"boxes","nonMaxSuppressionAsync"),a=ts(e,"scores","nonMaxSuppressionAsync"),l=fd(o,a,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:p}=xd(u,h,n,r,i,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Eh(d,"int32"),selectedScores:Eh(p)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Cd=rs({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=ts(t,"boxes","nonMaxSuppression"),a=ts(e,"scores","nonMaxSuppression"),l=fd(o,a,n,r,i,null),c={boxes:o,scores:a},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s},h=Wi.runKernel(Ke,c,u);return{selectedIndices:h[0],validOutputs:h[1]}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ad=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=ts(t,"boxes","nonMaxSuppressionAsync"),a=ts(e,"scores","nonMaxSuppressionAsync"),l=fd(o,a,n,r,i,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:m}=vd(d,p,c,u,h,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Eh(f,"int32"),validOutputs:lc(m,"int32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Nd=rs({resizeBilinear_:function(t,e,n=!1,r=!1){const i=ts(t,"images","resizeBilinear");u(3===i.rank||4===i.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`)),u(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),u(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=il(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},c=Wi.runKernel(mn,a,l);return o?il(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Id=rs({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const i=ts(t,"images","resizeNearestNeighbor");u(3===i.rank||4===i.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`)),u(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),u("float32"===i.dtype||"int32"===i.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),u(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let s=i,o=!1;3===i.rank&&(o=!0,s=il(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},c=Wi.runKernel(pn,a,l);return o?il(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $d=rs({threshold_:function(t,e="binary",n=!1,r=.5){const i=ts(t,"image","threshold"),s=i.shape[0]*i.shape[1];let o,a,l,c,h=Na(Eh([r]),255);if(u(3===i.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`)),u(3===i.shape[2]||1===i.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`)),u("int32"===i.dtype||"float32"===i.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`)),u("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===i.shape[2]){[o,a,l]=bh(i,[1,1,1],-1);const t=Na(o,.2989),e=Na(a,.587),n=Na(l,.114);c=Ma(Ma(t,e),n)}else c=t;if("otsu"===e){h=function(t,e){let n,r,i,s,o,a,l=Eh([-1]),c=Eh([0]),u=Eh([0]);for(let h=0;h<t.size-1;h++){n=cl(t,0,h+1),r=cl(t,h+1),o=Aa(hc(n),e),a=Aa(hc(r),e);const d=hc(Na(n,qu(0,n.size)));i=Aa(d,hc(n));const p=wl(r.shape,n.size),f=Ma(qu(0,r.size),p),m=Na(r,f);s=Aa(hc(m),hc(r));const g=zc(i,s),y=zc(i,s),b=Na(o,a);u=Na(Na(b,g),y);const v=_c(u,c);c=Wl(v,u,c),l=Wl(v,Eh([h]),l)}return l}(yl(no(nh(c),"int32"),os([]),256),s)}const d=n?Ac(c,h):_c(c,h);return no(Na(d,255),"int32")}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Rd=rs({transform_:function(t,e,n="nearest",r="constant",i=0,s){const o=ts(t,"image","transform","float32"),a=ts(e,"transforms","transform","float32");u(4===o.rank,(()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`)),u(2===a.rank&&(a.shape[0]===o.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),u(null==s||2===s.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`));const l={image:o,transforms:a},c={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return Wi.runKernel(Jn,l,c)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Od=rs({bandPart_:function(t,e,n){u(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),u(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=ts(t,"a","bandPart");u(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[s,o]=r.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);e<0&&(e=s),n<0&&(n=o);const a=il(qu(0,s,1,"int32"),[-1,1]),l=qu(0,o,1,"int32"),c=zc(a,l),h=Vc(Ac(c,lc(+e,"int32")),Sc(c,lc(-n,"int32"))),d=tu([s,o],r.dtype);return il(_h(Ph(il(r,[-1,s,o])).map((t=>Wl(h,t,d)))),i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Pd=rs({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,u(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)u(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=bh(t,t.shape[0],0).map((t=>wh(t,[0])));u(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(Wi.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=Na(hc(Na(n[r],t)),n[r]);t=zc(t,e)}return Aa(t,pc(t,"euclidean"))})));return e?_h(n,0):n}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ld(t,e=!1){return Wi.tidy((()=>{u(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let i=vc(n),s=ro(t);const o=Mh([[1]],[1,1]);let a=ro(o);const l=n>=r?r:n;for(let t=0;t<l;++t){const e=s,l=a,c=i;[a,s,i]=Wi.tidy((()=>{const e=cl(s,[t,t],[n-t,1]),l=pc(e),c=cl(s,[t,t],[1,1]),u=Wl(_c(c,0),Mh([[-1]]),Mh([[1]])),h=zc(c,Na(u,l)),d=Aa(e,h);a=1===d.shape[0]?ro(o):al([o,cl(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=Po(Aa(ko(u,h),l)),f=cl(s,[t,0],[n-t,r]),m=Na(p,a),g=Do(a);if(0===t)s=zc(f,ko(m,ko(g,f)));else{const e=zc(f,ko(m,ko(g,f)));s=al([cl(s,[0,0],[t,r]),e],0)}const y=Do(m),b=cl(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=zc(b,ko(ko(b,a),y));else{const e=zc(b,ko(ko(b,a),y));i=al([cl(i,[0,0],[n,t]),e],1)}return[a,s,i]})),Ao([e,l,c])}return!e&&n>r&&(i=cl(i,[0,0],[n,r]),s=cl(s,[0,0],[r,r])),[i,s]}))}const Dd=rs({qr_:function(t,e=!1){if(u(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Ld(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=Ph(il(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];r.forEach((t=>{const[n,r]=Ld(t,e);i.push(n),s.push(r)}));return[il(_h(i,0),t.shape),il(_h(s,0),t.shape)]}}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Fd;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Fd||(Fd={}));const zd=rs({computeWeightedLoss_:function(t,e,n=Fd.SUM_BY_NONZERO_WEIGHTS){const r=ts(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=ts(e,"weights","computeWeightedLoss"));const s=null==i?r:Na(r,i);if(n===Fd.NONE)return s;if(n===Fd.SUM)return hc(s);if(n===Fd.MEAN){if(null==i)return Qc(s);{const t=r.size/i.size,e=Aa(hc(s),hc(i));return t>1?Aa(e,lc(t)):e}}if(n===Fd.SUM_BY_NONZERO_WEIGHTS){if(null==i)return Aa(hc(s),lc(r.size));{const t=Na(i,eu(r.shape)),e=no(hc(cu(t,lc(0))),"float32");return Aa(hc(s),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bd=rs({absoluteDifference_:function(t,e,n,r=Fd.SUM_BY_NONZERO_WEIGHTS){const i=ts(t,"labels","absoluteDifference"),s=ts(e,"predictions","absoluteDifference");let o=null;null!=n&&(o=ts(n,"weights","absoluteDifference")),h(i.shape,s.shape,"Error in absoluteDifference: ");const a=Ia(zc(i,s));return zd(a,o,r)}});const Ud=rs({cosineDistance_:function(t,e,n,r,i=Fd.SUM_BY_NONZERO_WEIGHTS){const s=ts(t,"labels","cosineDistance"),o=ts(e,"predictions","cosineDistance");let a=null;null!=r&&(a=ts(r,"weights","cosineDistance")),h(s.shape,o.shape,"Error in cosineDistance: ");const l=lc(1),c=zc(l,hc(Na(s,o),n,!0));return zd(c,a,i)}});const Vd=rs({hingeLoss_:function(t,e,n,r=Fd.SUM_BY_NONZERO_WEIGHTS){let i=ts(t,"labels","hingeLoss");const s=ts(e,"predictions","hingeLoss");let o=null;null!=n&&(o=ts(n,"weights","hingeLoss")),h(i.shape,s.shape,"Error in hingeLoss: ");const a=lc(1);i=zc(Na(lc(2),i),a);const l=Yu(zc(a,Na(i,s)));return zd(l,o,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const jd=rs({huberLoss_:function(t,e,n,r=1,i=Fd.SUM_BY_NONZERO_WEIGHTS){const s=ts(t,"labels","huberLoss"),o=ts(e,"predictions","huberLoss");let a=null;null!=n&&(a=ts(n,"weights","huberLoss")),h(s.shape,o.shape,"Error in huberLoss: ");const l=lc(r),c=Ia(zc(o,s)),u=ru(c,l),d=zc(c,u),p=Ma(Na(lc(.5),uc(u)),Na(l,d));return zd(p,a,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Wd=rs({logLoss_:function(t,e,n,r=1e-7,i=Fd.SUM_BY_NONZERO_WEIGHTS){const s=ts(t,"labels","logLoss"),o=ts(e,"predictions","logLoss");let a=null;null!=n&&(a=ts(n,"weights","logLoss")),h(s.shape,o.shape,"Error in logLoss: ");const l=lc(1),c=lc(r),u=Po(Na(s,$c(Ma(o,c)))),d=Na(zc(l,s),$c(Ma(zc(l,o),c))),p=zc(u,d);return zd(p,a,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hd=rs({meanSquaredError_:function(t,e,n,r=Fd.SUM_BY_NONZERO_WEIGHTS){const i=ts(t,"labels","meanSquaredError"),s=ts(e,"predictions","meanSquaredError");let o=null;null!=n&&(o=ts(n,"weights","meanSquaredError")),h(i.shape,s.shape,"Error in meanSquaredError: ");const a=xh(i,s);return zd(a,o,r)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Gd=rs({sigmoidCrossEntropy_:function(t,e,n,r=0,i=Fd.SUM_BY_NONZERO_WEIGHTS){let s=ts(t,"multiClassLabels","sigmoidCrossEntropy");const o=ts(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=ts(n,"weights","sigmoidCrossEntropy")),h(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=lc(r),e=lc(1),n=lc(.5);s=Ma(Na(s,zc(e,t)),Na(n,t))}const l=function(t,e){const n=ts(t,"labels","sigmoidCrossEntropyWithLogits"),r=ts(e,"logits","sigmoidCrossEntropyWithLogits");h(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Yu(r),s=Na(r,n),o=Rc(mc(Po(Ia(r))));return Ma(zc(i,s),o)}(s,o);return zd(l,a,i)}});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const qd=rs({softmaxCrossEntropy_:function(t,e,n,r=0,i=Fd.SUM_BY_NONZERO_WEIGHTS){let s=ts(t,"onehotLabels","softmaxCrossEntropy");const o=ts(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=ts(n,"weights","softmaxCrossEntropy")),h(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const t=lc(r),e=lc(1),n=lc(s.shape[1]);s=Ma(Na(s,zc(e,t)),Aa(t,n))}const l=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=Pc(((t,e,r)=>{const i=Uc(e,[n],!0),s=zc(no(e,"float32"),i);r([t,s]);const o=Po(Na(s,t));return{value:hc(o,[n]),gradFunc:(t,e)=>{const[r,i]=e,s=tc(t.shape,[n]);return[Na(il(t,s),zc(no(r,"float32"),mc(i))),Na(il(t,s),zc(mc(i),no(r,"float32")))]}}}));return r(t,e)}(s,o);return zd(l,a,i)}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Xd=rs({sparseFillEmptyRows_:function(t,e,n,r){const i=ts(t,"indices","sparseFillEmptyRows","int32"),s=ts(e,"values","sparseFillEmptyRows"),o=ts(n,"denseShape","sparseFillEmptyRows","int32"),a=ts(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(2!==i.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==s.rank)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:i,values:s,denseShape:o,defaultValue:a},c=Wi.runKernel(Ln,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yd=rs({sparseReshape_:function(t,e,n){const r=ts(t,"inputIndices","sparseReshape","int32"),i=ts(e,"inputShape","sparseReshape","int32"),s=ts(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==i.rank)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(1!==s.rank)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=Wi.runKernel(Dn,o);return{outputIndices:a[0],outputShape:a[1]}}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Kd=rs({sparseSegmentMean_:function(t,e,n){const r=ts(t,"data","sparseSegmentMean"),i=ts(e,"indices","sparseSegmentMean","int32"),s=ts(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Wi.runKernel(Fn,o)}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Zd=rs({sparseSegmentSum_:function(t,e,n){const r=ts(t,"data","sparseSegmentSum"),i=ts(e,"indices","sparseSegmentSum","int32"),s=ts(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return Wi.runKernel(zn,o)}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Jd=rs({stringNGrams_:function(t,e,n,r,i,s,o,a){const l=ts(t,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=ts(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:c},d=Wi.runKernel(Wn,h,u);return{nGrams:d[0],nGramsSplits:d[1]}}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qd=rs({stringSplit_:function(t,e,n=!0){const r=ts(t,"input","stringSplit","string"),i=ts(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==i.rank)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=Wi.runKernel(Hn,o,s);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tp=rs({stringToHashBucketFast_:function(t,e){const n=ts(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return Wi.runKernel(Gn,i,r)}}),ep={fft:mh,ifft:gh,rfft:vh,irfft:yh},np={hammingWindow:od,hannWindow:ad,frame:ld,stft:cd},rp={flipLeftRight:hd,grayscaleToRGB:dd,resizeNearestNeighbor:Id,resizeBilinear:Nd,rotateWithOffset:pd,cropAndResize:ud,nonMaxSuppression:md,nonMaxSuppressionAsync:Td,nonMaxSuppressionWithScore:Ed,nonMaxSuppressionWithScoreAsync:Md,nonMaxSuppressionPadded:Cd,nonMaxSuppressionPaddedAsync:Ad,threshold:$d,transform:Rd},ip={bandPart:Od,gramSchmidt:Pd,qr:Dd},sp={absoluteDifference:Bd,computeWeightedLoss:zd,cosineDistance:Ud,hingeLoss:Vd,huberLoss:jd,logLoss:Wd,meanSquaredError:Hd,sigmoidCrossEntropy:Gd,softmaxCrossEntropy:qd},op={sparseFillEmptyRows:Xd,sparseReshape:Yd,sparseSegmentMean:Kd,sparseSegmentSum:Zd},ap={stringNGrams:Jd,stringSplit:Qd,stringToHashBucketFast:tp};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class lp extends va{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return Ao(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return Oc(t,e)}dispose(){null!=this.iterations_&&Ao(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:lc(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(lp,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class cp extends lp{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Wi.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Wi.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:Co((()=>Hl(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:Co((()=>Hl(r).variable(false)))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Co((()=>{const t=Ma(Na(s,this.rho),Na(uc(i),1-this.rho)),e=Na(Aa(cc(Ma(o,this.epsilon)),cc(Ma(s,this.epsilon))),i),n=Ma(Na(o,this.rho),Na(uc(e),1-this.rho));s.assign(t),o.assign(n);const a=Ma(Na(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Ao(this.accumulatedGrads.map((t=>t.variable))),Ao(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}cp.className="Adadelta",wa(cp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class up extends lp{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Wi.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:Co((()=>wl(r.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable;Co((()=>{const t=Ma(s,uc(i));s.assign(t);const e=Ma(Na(Aa(i,cc(Ma(t,Wi.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Ao(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}up.className="Adagrad",wa(up);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class hp extends lp{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Co((()=>{this.accBeta1=lc(e).variable(),this.accBeta2=lc(n).variable()})),null==r&&(this.epsilon=Wi.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);Co((()=>{const n=zc(1,this.accBeta1),r=zc(1,this.accBeta2);e.forEach(((e,i)=>{const s=Wi.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:Co((()=>Hl(s).variable(false)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:Co((()=>Hl(s).variable(false)))});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,c=Ma(Na(a,this.beta1),Na(o,1-this.beta1)),u=Ma(Na(l,this.beta2),Na(uc(o),1-this.beta2)),h=Aa(c,n),d=Aa(u,r);a.assign(c),l.assign(u);const p=Ma(Na(Aa(h,Ma(cc(d),this.epsilon)),-this.learningRate),s);s.assign(p)})),this.accBeta1.assign(Na(this.accBeta1,this.beta1)),this.accBeta2.assign(Na(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ao(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&Ao(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),Co((()=>{this.accBeta1.assign(ac(this.beta1,this.iterations_+1)),this.accBeta2.assign(ac(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}hp.className="Adam",wa(hp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class dp extends lp{constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Co((()=>{this.iteration=lc(0).variable(),this.accBeta1=lc(e).variable()})),null==r&&(this.epsilon=Wi.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);Co((()=>{const n=zc(1,this.accBeta1),r=Aa(-this.learningRate,Ma(Na(this.iteration,this.decay),1));e.forEach(((e,i)=>{const s=Wi.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:Hl(s).variable(false)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:Hl(s).variable(false)});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,c=Ma(Na(a,this.beta1),Na(o,1-this.beta1)),u=Na(l,this.beta2),h=Ia(o),d=Jc(u,h);a.assign(c),l.assign(d);const p=Ma(Na(Aa(r,n),Aa(c,Ma(d,this.epsilon))),s);s.assign(p)})),this.iteration.assign(Ma(this.iteration,1)),this.accBeta1.assign(Na(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ao(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&Ao(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}dp.className="Adamax",wa(dp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class pp extends lp{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=Wi.registeredVariables[e];Co((()=>{const t=Ma(Na(this.c,r),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=No(lc(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}pp.className="SGD",wa(pp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class fp extends pp{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=lc(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Wi.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:Co((()=>Hl(r).variable(t)))}}const i=this.accumulations[n].variable,s=Array.isArray(t)?t[n].tensor:t[e];null!=s&&Co((()=>{let t;const e=Ma(Na(this.m,i),s);t=this.useNesterov?Ma(Na(this.c,Ma(s,Na(e,this.m))),r):Ma(Na(this.c,e),r),i.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Ao(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}fp.className="Momentum",wa(fp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class mp extends lp{constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Wi.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Wi.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:Co((()=>Hl(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:Co((()=>Hl(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:Co((()=>Hl(r).variable(i)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;Co((()=>{const t=Ma(Na(o,this.decay),Na(uc(s),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=Ma(Na(e,this.decay),Na(s,1-this.decay)),l=Aa(Na(s,this.learningRate),cc(zc(t,Ma(uc(i),this.epsilon)))),c=Ma(Na(a,this.momentum),l);o.assign(t),e.assign(i),a.assign(c);const u=zc(r,c);r.assign(u)}else{const t=Ma(Na(o,this.decay),Na(uc(s),1-this.decay)),e=Ma(Na(a,this.momentum),Aa(Na(s,this.learningRate),cc(Ma(t,this.epsilon))));o.assign(t),a.assign(e);const n=zc(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Ao(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&Ao(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&Ao(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}mp.className="RMSProp",wa(mp);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class gp{static sgd(t){return new pp(t)}static momentum(t,e,n=!1){return new fp(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new mp(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new hp(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new cp(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new dp(t,e,n,r,i)}static adagrad(t,e=.1){return new up(t,e)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yp={sgd:gp.sgd,momentum:gp.momentum,adadelta:gp.adadelta,adagrad:gp.adagrad,rmsprop:gp.rmsprop,adamax:gp.adamax,adam:gp.adam},bp="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function vp(){return new Promise((t=>bp((()=>t()))))}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function xp(t,e){const n=t[0].length;t.forEach(((t,e)=>{u(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),u(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,i)=>{for(let s=0;s<n;s++)u(s===e||t[s]===r[s],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function wp(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var _p;function Sp(t,e,n){let r=new Array;if(null==n&&null==e)return r;if(null==e)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(null==n)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${s} but shape[${i+t}] = ${a}`)}else r[o]=s}return r}function kp(t){const e={FIRST_DIM_SIZE:_p.FIRST_DIM_SIZE,VALUE_ROWIDS:_p.VALUE_ROWIDS,ROW_LENGTHS:_p.ROW_LENGTHS,ROW_SPLITS:_p.ROW_SPLITS,ROW_LIMITS:_p.ROW_LIMITS,ROW_STARTS:_p.ROW_STARTS},n=[];for(const r of t){if(!(r in e))break;n.push(e[r])}return n}function Tp(t){return 0===t.length?0:t[0]===_p.FIRST_DIM_SIZE?t.length-1:t.length}function Ep(t,e){if(null==t||null==e)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const n=t[i],r=e[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${n} but ragged tensor input.flatValues.shape[${i-t.length}] = ${r}`)}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */!function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"}(_p||(_p={}));function Mp(t){return t<=30?t:L(t,Math.floor(Math.sqrt(t)))}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Cp(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ap(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function Np(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function Ip(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?i.push(e[n-1]*t[n]):i.push(t[n]/e[n-1]):i.push(t[n]);return i}function $p(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function Rp(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Op=1.7580993408473768,Pp=1.0507009873554805,Lp=.3275911,Dp=.254829592,Fp=-.284496736,zp=1.421413741,Bp=-1.453152027,Up=1.061405429;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Vp(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function jp(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function Wp(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function Hp(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function Gp(t,e){return{real:t[2*e],imag:t[2*e+1]}}function qp(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Xp(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function Yp(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Kp="->",Zp=/->/g;function Jp(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Zp,"").length)/Kp.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=t.split(Kp);u(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const s=r.split(","),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<i.length;++t){const e=i[t];if(!s.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const l=new Array(s.length);for(let t=0;t<o;++t){if(new Set(s[t].split("")).size!==s[t].length)throw new Error(`Found duplicate axes in input component ${s[t]}. Support for duplicate axes in input is not implemented yet.`);l[t]=[];for(let e=0;e<s[t].length;++e)l[t].push(a.indexOf(s[t][e]))}const c=a.length,h=[];for(let t=i.length;t<c;++t)h.push(t);return{allDims:a,summedDims:h,idDims:l}}function Qp(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function tf(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const i=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=i[n]:u(r[e[t][n]]===i[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`))}}function ef(t,e){const n=t,r=[];let i=0;0===t.length&&n.push(-1),i=t.length+1;for(let t=0;t<i;++t)r.push([]);const s=[];for(let t=0;t<n.length;++t){const i=rf(e,n[t]);for(const e of i)-1===s.indexOf(e)&&(r[t].push(e),s.push(e))}return{path:n,steps:r}}function nf(t){return t.every(((t,e)=>t===e))}function rf(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function sf(t,e,n=0){let r=[];if("number"==typeof e)u(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0);u(i<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}u(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function of(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function af(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function lf(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cf(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function uf(t,e){return`size ${t} must be non-negative, not ${e}`}function hf(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function df(t,e){return`Input to reshape is a SparseTensor with ${f(t)}\n  dense values, but the requested shape requires a multiple of ${f(e)}. inputShape=${t} outputShape= ${e}`}function pf(t,e){return`Input to reshape is a tensor with ${f(t)} dense values, but the requested shape has ${f(e)}. inputShape=${t} outputShape=${e}`}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ff(){return"segment ids must be >= 0"}function mf(){return"segment ids are not increasing"}function gf(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function yf(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bf(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=L(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=L(t,n+1);return n}function vf(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)s!==e?r.push(t[s]):r.push(n);return r}function xf(t,e,n,r){const i=e.shape.length,s=t.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let e=0;e<r;++e)a.push(t.shape[e]),l*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<i;t++)a.push(e.shape[t]);for(let e=n+1;e<s;e++)a.push(t.shape[e]),u*=t.shape[e];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}var wf=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:bf,computeOutShape:vf,collectGatherOpShapeInfo:xf});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function _f(t){try{return t.map((t=>ui(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Sf(t){return t.map((t=>ci(t)))}var kf=Object.freeze({__proto__:null,slice_util:ba,segment_util:wf,fromUint8ToStringArray:_f,fromStringArrayToUint8:Sf,upcastType:$i,axesAreInnerMostDims:Zl,combineLocations:Jl,computeOutAndReduceShapes:Ql,expandShapeToKeepDim:tc,assertAxesAreInnerMostDims:ec,getAxesPermutation:nc,getUndoAxesPermutation:rc,getInnerMostAxes:ic,getBroadcastDims:Bo,getReductionAxes:Uo,assertAndGetBroadcastShape:Vo,assertParamsConsistent:xp,computeOutShape:wp,computeDilation2DInfo:Wa,computePool2DInfo:Ha,computePool3DInfo:Ga,computeConv2DInfo:qa,computeConv3DInfo:Xa,computeDefaultPad:Ya,tupleValuesAreOne:tl,eitherStridesOrDilationsAreOne:el,convertConv2DDataFormat:nl,checkPadOnDimRoundingMode:rl,getFusedDyActivation:Kh,getFusedBiasGradient:Zh,applyActivation:Jh,shouldFuse:Qh,get RowPartitionType(){return _p},combineRaggedTensorToTensorShapes:Sp,getRowPartitionTypesHelper:kp,getRaggedRank:Tp,validateDefaultValueShape:Ep,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Mp,getImageCenter:Cp,getReshaped:Ap,getPermuted:Np,getReshapedPermuted:Ip,getSliceBeginCoords:$p,getSliceSize:Rp,prepareAndValidate:Zo,validateUpdateShape:Qo,validateInput:ta,calculateShapes:ea,SELU_SCALEALPHA:Op,SELU_SCALE:Pp,ERF_P:Lp,ERF_A1:Dp,ERF_A2:Fp,ERF_A3:zp,ERF_A4:Bp,ERF_A5:Up,warn:ur,log:function(...t){K().getBool("IS_TEST")||K().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:Vp,splitRealAndImagArrays:jp,complexWithEvenIndex:Wp,complexWithOddIndex:Hp,getComplexWithIndex:Gp,assignToTypedArray:qp,exponents:Xp,exponent:Yp,decodeEinsumEquation:Jp,getEinsumPermutation:Qp,checkEinsumDimSizes:tf,getEinsumComputePath:ef,isIdentityPermutation:nf,prepareSplitSize:sf,getSparseFillEmptyRowsIndicesDenseShapeMismatch:of,getSparseFillEmptyRowsNegativeIndexErrorMessage:af,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:lf,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:cf,getSparseReshapeNegativeOutputDimErrorMessage:uf,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:hf,getSparseReshapeInputOutputMultipleErrorMessage:df,getSparseReshapeInputOutputMismatchErrorMessage:pf,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:ff,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:mf,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gf,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:yf}),Tf=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:bd,nonMaxSuppressionV4Impl:vd,nonMaxSuppressionV5Impl:xd,whereImpl:Fh}),Ef=Object.freeze({__proto__:null,AdadeltaOptimizer:cp,AdagradOptimizer:up,AdamOptimizer:hp,AdamaxOptimizer:dp,MomentumOptimizer:fp,Optimizer:lp,OptimizerConstructors:gp,RMSPropOptimizer:mp,SGDOptimizer:pp,Tensor:Si,TensorBuffer:xi,Variable:Ti,get Rank(){return Ei},sumOutType:Ri,upcastType:$i,get Reduction(){return Fd},customGrad:Pc,grad:function(t){return u(P(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=ts(e,"x","tf.grad","string_or_numeric"),i=null!=n?ts(n,"dy","tf.grad"):null;return Wi.tidy((()=>{const{value:e,grads:n}=Wi.gradients((()=>t(r)),[r],i);return null!=i&&h(e.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Lc(n),n[0]}))}},grads:function(t){return u(P(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{u(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=es(e,"args","tf.grads","string_or_numeric"),i=null!=n?ts(n,"dy","tf.grads"):null;return Wi.tidy((()=>{const{value:e,grads:n}=Wi.gradients((()=>t(...r)),r,i);return null!=i&&h(e.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Lc(n),n}))}},valueAndGrad:function(t){return u(P(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{u(e instanceof Si,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),u(null==n||n instanceof Si,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:i}=Wi.gradients((()=>t(e)),[e],n);return Lc(r),{grad:r[0],value:i}}},valueAndGrads:function(t){return u(P(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{u(Array.isArray(e)&&e.every((t=>t instanceof Si)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),u(null==n||n instanceof Si,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=Wi.gradients((()=>t(...e)),e,n);return null!=n&&h(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Lc(r.grads),r}},variableGrads:Oc,Environment:X,env:K,get ENV(){return J},nextFrame:vp,KernelBackend:r,DataStorage:n,abs:Ia,acos:$a,acosh:Ra,add:Ma,addN:Oa,all:Pa,any:La,argMax:Da,argMin:Fa,asin:za,asinh:Ba,atan:Ua,atan2:Va,atanh:ja,avgPool:sl,avgPool3d:ol,basicLSTMCell:hl,batchToSpaceND:dl,batchNorm:pl,batchNorm2d:fl,batchNorm3d:ml,batchNorm4d:gl,bincount:yl,broadcastArgs:bl,broadcastTo:vl,buffer:eo,cast:no,ceil:xl,clipByValue:_l,clone:ro,complex:is,concat:al,concat1d:Sl,concat2d:kl,concat3d:Tl,concat4d:El,conv1d:Cl,conv2d:Ml,conv2dTranspose:Nl,conv3d:Il,conv3dTranspose:Rl,cos:Ol,cosh:Pl,cumprod:Ll,cumsum:Dl,denseBincount:Fl,depthToSpace:zl,depthwiseConv2d:Bl,diag:Ul,dilation2d:Vl,div:Aa,divNoNan:Gl,dot:ql,einsum:Xl,elu:Yl,equal:jl,erf:Kl,euclideanNorm:fc,exp:mc,expandDims:gc,expm1:yc,eye:vc,fill:wl,floor:xc,floorDiv:Ca,gather:wc,greater:_c,greaterEqual:Sc,imag:Oo,isFinite:kc,isInf:Tc,isNaN:Ec,leakyRelu:Mc,less:Cc,lessEqual:Ac,linspace:Nc,localResponseNormalization:Ic,log:$c,log1p:Rc,logSigmoid:Fc,logSoftmax:Bc,logSumExp:Uc,logicalAnd:Vc,logicalNot:jc,logicalOr:Wc,logicalXor:Hc,lowerBound:Xc,matMul:ko,max:sc,maxPool:Yc,maxPool3d:Kc,maxPoolWithArgmax:Zc,maximum:Jc,mean:Qc,meshgrid:nu,min:oc,minimum:ru,mirrorPad:iu,mod:su,moments:ou,mul:Na,multiRNNCell:au,multinomial:lu,neg:Po,notEqual:cu,oneHot:To,ones:eu,onesLike:uu,outerProduct:hu,pad:du,pad1d:pu,pad2d:fu,pad3d:mu,pad4d:gu,pool:bu,pow:ac,prelu:vu,print:io,prod:xu,raggedGather:wu,raggedTensorToTensor:_u,rand:Su,randomGamma:ju,randomNormal:Wu,randomStandardNormal:Hu,randomUniform:Gu,range:qu,real:Lo,reciprocal:Xu,relu:Yu,relu6:Ku,reshape:il,reverse:Zu,reverse1d:Ju,reverse2d:Qu,reverse3d:th,reverse4d:eh,round:nh,rsqrt:rh,scalar:lc,selu:ih,separableConv2d:sh,setdiff1dAsync:oh,sigmoid:ll,sign:ah,sin:lh,sinh:ch,slice:cl,slice1d:uh,slice2d:hh,slice3d:dh,slice4d:ph,softmax:fh,softplus:Dc,spaceToBatchND:yu,fft:mh,ifft:gh,irfft:yh,rfft:vh,split:bh,sqrt:cc,square:uc,squaredDifference:xh,squeeze:wh,stack:_h,step:Sh,stridedSlice:kh,sub:zc,sum:hc,tan:Th,tanh:ul,tensor:os,tensor1d:Eh,tensor2d:Mh,tensor3d:Wo,tensor4d:Ch,tensor5d:Ah,tensor6d:Nh,tile:bc,topk:Ih,truncatedNormal:$h,unique:Rh,unsortedSegmentSum:Oh,unstack:Ph,upperBound:Lh,variable:Dh,where:Wl,whereAsync:zh,zeros:tu,zerosLike:Hl,op:rs,OP_SCOPE_SUFFIX:ns,booleanMaskAsync:Bh,transpose:Do,norm:pc,movingAverage:Uh,scatterND:Vh,searchSorted:qc,sparseToDense:jh,gatherND:Wh,dropout:Hh,enclosingPowerOfTwo:Gh,cosineWindow:qh,inTopKAsync:Xh,image:rp,linalg:ip,losses:sp,spectral:ep,fused:sd,signal:np,sparse:op,string:ap,train:yp,enableProdMode:function(){K().set("PROD",!0)},enableDebugMode:function(){K().set("DEBUG",!0)},disableDeprecationWarnings:function(){K().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){K().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){Wi.disposeVariables()},engine:Eo,memory:Mo,profile:function(t){return Wi.profile(t)},tidy:Co,dispose:Ao,keep:No,time:function(t){return Wi.time(t)},setBackend:function(t){return Wi.setBackend(t)},ready:function(){return Wi.ready()},getBackend:Io,removeBackend:function(t){Wi.removeBackend(t)},findBackend:function(t){return Wi.findBackend(t)},findBackendFactory:function(t){return Wi.findBackendFactory(t)},registerBackend:$o,backend:Ro,setPlatform:function(t,e){K().setPlatform(t,e)},getKernel:pr,getGradient:fr,getKernelsForBackend:mr,registerKernel:gr,registerGradient:yr,unregisterKernel:function(t,e){const n=br(t,e);if(!hr.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);hr.delete(n)},unregisterGradient:function(t){if(!dr.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);dr.delete(t)},copyRegisteredKernels:function(t,e){mr(t).forEach((t=>{gr(Object.assign({},t,{backendName:e}))}))},Abs:et,Acos:nt,Acosh:rt,Add:it,AddN:st,All:ot,Any:at,ArgMax:lt,ArgMin:ct,Asin:ut,Asinh:ht,Atan:dt,Atanh:pt,Atan2:ft,AvgPool:mt,AvgPoolGrad:gt,AvgPool3D:yt,AvgPool3DGrad:bt,BatchMatMul:vt,BatchToSpaceND:xt,Bincount:wt,BroadcastTo:_t,BroadcastArgs:St,Cast:kt,Ceil:Tt,ClipByValue:Et,Complex:Mt,ComplexAbs:Ct,Concat:At,Conv2D:Nt,Conv2DBackpropFilter:It,Conv2DBackpropInput:$t,Conv3D:Rt,Conv3DBackpropFilterV2:Ot,Conv3DBackpropInputV2:Pt,Cos:Lt,Cosh:Dt,Cumprod:Ft,Cumsum:zt,CropAndResize:Bt,DenseBincount:Ut,DepthToSpace:Vt,DepthwiseConv2dNative:jt,DepthwiseConv2dNativeBackpropFilter:Wt,DepthwiseConv2dNativeBackpropInput:Ht,Diag:Gt,Dilation2D:qt,Dilation2DBackpropInput:Xt,Dilation2DBackpropFilter:Yt,RealDiv:Kt,Einsum:Zt,Elu:Jt,EluGrad:Qt,Erf:te,Equal:ee,Exp:ne,ExpandDims:re,Expm1:ie,FFT:se,Fill:oe,FlipLeftRight:ae,Floor:le,FloorDiv:ce,FusedBatchNorm:ue,GatherV2:he,GatherNd:de,Greater:pe,GreaterEqual:fe,Identity:me,IFFT:ge,Imag:ye,IsFinite:be,IsInf:ve,IsNan:xe,LeakyRelu:we,Less:_e,LessEqual:Se,LinSpace:ke,Log:Te,Log1p:Ee,LogicalAnd:Me,LogicalNot:Ce,LogicalOr:Ae,LogicalXor:"LogicalXor",LogSoftmax:Ne,LowerBound:"LowerBound",LRN:Ie,LRNGrad:$e,Max:Re,Maximum:Oe,MaxPool:Pe,MaxPoolGrad:Le,MaxPool3D:De,MaxPool3DGrad:Fe,MaxPoolWithArgmax:ze,Mean:Be,Min:Ue,Minimum:Ve,MirrorPad:je,Mod:We,Multinomial:He,Multiply:Ge,Neg:qe,NotEqual:Xe,NonMaxSuppressionV3:Ye,NonMaxSuppressionV4:Ke,NonMaxSuppressionV5:Ze,OnesLike:Je,OneHot:Qe,Pack:tn,PadV2:en,Pool:"Pool",Pow:nn,Prelu:rn,Prod:sn,RaggedGather:on,RaggedTensorToTensor:an,Range:ln,Real:cn,Reciprocal:un,Relu:hn,Reshape:dn,ResizeNearestNeighbor:pn,ResizeNearestNeighborGrad:fn,ResizeBilinear:mn,ResizeBilinearGrad:gn,Relu6:yn,Reverse:bn,Round:vn,Rsqrt:xn,ScatterNd:wn,SearchSorted:_n,Select:Sn,Selu:kn,Slice:Tn,Sin:En,Sinh:Mn,Sign:Cn,Sigmoid:An,Softplus:Nn,Sqrt:In,Sum:$n,SpaceToBatchND:Rn,SplitV:On,Softmax:Pn,SparseFillEmptyRows:Ln,SparseReshape:Dn,SparseSegmentMean:Fn,SparseSegmentSum:zn,SparseToDense:Bn,SquaredDifference:Un,Square:Vn,StridedSlice:jn,StringNGrams:Wn,StringSplit:Hn,StringToHashBucketFast:Gn,Sub:qn,Tan:Xn,Tanh:Yn,Tile:Kn,TopK:Zn,Transform:Jn,Transpose:Qn,Unique:tr,Unpack:er,UnsortedSegmentSum:nr,UpperBound:"UpperBound",ZerosLike:rr,Step:ir,FromPixels:sr,RotateWithOffset:or,_FusedMatMul:ar,FusedConv2D:lr,FusedDepthwiseConv2D:cr,version_core:"3.21.0",browser:Ko,io:So,math:zo,serialization:_a,test_util:Ea,util:hi,backend_util:kf,broadcast_util:jo,tensor_util:zi,slice_util:ba,gather_util:Jo,scatter_util:na,device_util:Yi,kernel_impls:Tf});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Mf(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&u("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Cf=Fh;class Af extends r{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new n(this,Eo())}nextDataId(){return Af.nextDataId++}write(t,e,n){this.firstUse&&(this.firstUse=!1,K().get("IS_NODE")&&ur("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:n,refCount:1}),r}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&I(n[0])){const i=n.map((t=>ci(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){if(this.data.has(t)){return this.data.get(t).refCount}return 0}incRef(t){this.data.get(t).refCount++}decRef(t){if(this.data.has(t)){this.data.get(t).refCount--}}move(t,e,n,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){return Vp(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return this.data.get(t).values}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>ui(t)));return eo(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return eo(t.shape,t.dtype,e)}makeOutput(t,e,n){return Eo().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(t);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=li();t();return{kernelMs:li()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Mf([t],"where");const e=this.readSync(t.dataId);return Cf(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Nf(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}Af.nextDataId=0;const If={kernelName:et,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend;Mf(e,"abs");let r=new Float32Array(f(e.shape));return r=Nf(n.data.get(e.dataId).values),n.makeOutput(r,e.shape,e.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function $f(t){return(e,n,r,i,s)=>{const o=Vo(e,n),a=o.length,l=D(o),c=S(s,f(o)),u=e.length,h=n.length,d=D(e),p=D(n),m=Bo(e,o),g=Bo(n,o);if(m.length+g.length===0)for(let e=0;e<c.length;++e)c[e]=t(r[e%r.length],i[e%i.length]);else for(let e=0;e<c.length;++e){const n=H(e,a,l),s=n.slice(-u);m.forEach((t=>s[t]=0));const o=W(s,u,d),f=n.slice(-h);g.forEach((t=>f[t]=0));const y=W(f,h,p);c[e]=t(r[o],i[y])}return[c,o]}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Rf(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64");return n.data.get(a.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const Of={kernelName:Mt,backendName:"cpu",kernelFunc:Rf};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Pf(t,e,n="float32"){if("complex64"===n){return Rf({inputs:{real:Pf(t,e,"float32"),imag:Pf(t,e,"float32")},backend:t})}const r=U(f(e),n);return t.makeTensorInfo(e,n,r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Lf(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Df={kernelName:me,backendName:"cpu",kernelFunc:Lf};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ff(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const zf={kernelName:cn,backendName:"cpu",kernelFunc:Ff};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Bf(t,e,n,r){if("int32"===r){return[e,"int32",Int32Array.from(t)]}if("bool"===r){const r=ai([0],n),[i,s]=$f(((t,e)=>t!==e?1:0))(e,[],t,r,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Uf(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return Lf({inputs:{x:i},backend:n});const t=Pf(n,i.shape,i.dtype),e=Uf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=Rf({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),r}if("complex64"===i.dtype){const t=Ff({inputs:{input:i},backend:n}),e=Uf({inputs:{x:t},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(t),e}if(!M(i.dtype,s)){const t=Lf({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,l,c]=Bf(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,l,c)}const Vf={kernelName:kt,backendName:"cpu",kernelFunc:Uf};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function jf(t,e,n,r){return null==n?({inputs:n,backend:i})=>{const{a:s,b:o}=n,a=i;Mf([s,o],t);const l=a.data.get(s.dataId).values,c=a.data.get(o.dataId).values,u="string"===s.dtype?_f(l):l,h="string"===s.dtype?_f(c):c,d=r||s.dtype,[p,f]=e(s.shape,o.shape,u,h,d);return a.makeTensorInfo(f,d,p)}:({inputs:t,backend:i})=>{const{a:s,b:o}=t,a=i;if("complex64"===s.dtype||"complex64"===o.dtype){const t=Uf({inputs:{x:s},backend:a,attrs:{dtype:"complex64"}}),e=a.data.get(t.dataId),r=e.complexTensorInfos.real,i=e.complexTensorInfos.imag,l=a.data.get(r.dataId).values,c=a.data.get(i.dataId).values,u=Uf({inputs:{x:o},backend:a,attrs:{dtype:"complex64"}}),h=a.data.get(u.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=a.data.get(d.dataId).values,m=a.data.get(p.dataId).values,[g,y,b]=n(s.shape,o.shape,l,c,f,m),v=a.makeTensorInfo(b,"float32",g),x=a.makeTensorInfo(b,"float32",y),w=Rf({inputs:{real:v,imag:x},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(x),w}{const t=a.data.get(s.dataId).values,n=a.data.get(o.dataId).values,i=r||s.dtype,[l,c]=e(s.shape,o.shape,t,n,i);return a.makeTensorInfo(c,i,l)}}}function Wf(t){return(e,n,r,i,s,o)=>{const a=Vo(e,n),l=f(a),c=a.length,u=D(a),h=S("float32",l),d=S("float32",l),p=Bo(e,a),m=Bo(n,a),g=Vp(r,i),y=Vp(s,o),b=e.length,v=D(e),x=n.length,w=D(n);if(p.length+m.length===0)for(let e=0;e<h.length;e++){const n=e%g.length,r=e%y.length,i=t(g[2*n],g[2*n+1],y[2*r],y[2*r+1]);h[e]=i.real,d[e]=i.imag}else for(let e=0;e<h.length;e++){const n=H(e,c,u),r=n.slice(-b);p.forEach((t=>r[t]=0));const i=W(r,b,v),s=n.slice(-x);m.forEach((t=>s[t]=0));const o=W(s,x,w),a=t(g[2*i],g[2*i+1],y[2*o],y[2*o+1]);h[e]=a.real,d[e]=a.imag}return[h,d,a]}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hf=$f(((t,e)=>t+e)),Gf=Wf(((t,e,n,r)=>({real:t+n,imag:e+r}))),qf=jf(it,Hf,Gf),Xf={kernelName:it,backendName:"cpu",kernelFunc:qf};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Yf(t,e,n,r,i){const s=f(r),o=U(i,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=i||(o[r]+=s>0?e[n]:1)}return o}function Kf(t,e,n,r=!1){const i=t.shape[0],s=t.shape[1],o=eo([i,n],e.dtype);for(let a=0;a<i;a++)for(let i=0;i<s;i++){const s=t.get(a,i);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(r?o.set(1,a,s):e.size>0?o.set(o.get(a,s)+e.get(a,i),a,s):o.set(o.get(a,s)+1,a,s))}return o}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Zf(t){return(e,n,r)=>{const i=S(n,e.length);for(let n=0;n<e.length;++n)i[n]=t(e[n],r);return i}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Jf(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(Mf(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=f(o.shape),u=n||o.dtype,h=k(u,c);for(let t=0;t<c;++t)h[t]=e(l[t],i);return a.makeTensorInfo(o.shape,u,h)}}function Qf(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;if(Mf(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=s,l=a.data.get(o.dataId).values,c=n||o.dtype,u=e(l,c,i);return a.makeTensorInfo(o.shape,c,u)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tm=Zf((t=>Math.ceil(t))),em=Qf(Tt,tm),nm={kernelName:Tt,backendName:"cpu",kernelFunc:em};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function rm(t,e,n,r){const i=k(n,f(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=f(t.shape);i.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const s="string"===n?_f(t.vals):t.vals;let o=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+r;for(let e=0;e<t.shape[1];++e)i[a+e]=s[o++]}r+=t.shape[1]}))}return i}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const im=$f(((t,e)=>t===e?1:0)),sm=jf(ee,im,null,"bool"),om={kernelName:ee,backendName:"cpu",kernelFunc:sm},am=Zf((t=>Math.exp(t))),lm=Qf(ne,am,"float32"),cm={kernelName:ne,backendName:"cpu",kernelFunc:lm},um=Zf((t=>Math.expm1(t))),hm=Qf(ie,um),dm={kernelName:ie,backendName:"cpu",kernelFunc:hm},pm=Zf((t=>Math.floor(t))),fm=Qf(le,pm),mm={kernelName:le,backendName:"cpu",kernelFunc:fm};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function gm(t,e,n,r,i,s,o,a,l){const c=eo([r,s],n);for(let n=0;n<r;n++){const r=[];let u=0;for(let e=0;e<i;e++){const s=t[n*i+e];u+=s*o[e],r.push(s)}if(u<0||u>=l/s)throw new Error(`Invalid indices: ${r} does not index into ${a}`);for(let t=0;t<s;t++)c.values[n*s+t]=e.get(...e.indexToLoc(u*s+t))}return c}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ym(t,e,n){const r=eo(n,t.dtype);for(let n=0;n<r.size;++n){const i=r.indexToLoc(n).slice(),s=i[0],o=i[2],a=e.locToIndex([s,o]);i[2]=e.values[a];const l=t.locToIndex(i);0<=l&&l<t.values.length&&(r.values[n]=t.values[l])}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bm=$f(((t,e)=>t>e?1:0)),vm=jf(pe,bm,null,"bool"),xm={kernelName:pe,backendName:"cpu",kernelFunc:vm},wm=$f(((t,e)=>t>=e?1:0)),_m=jf(fe,wm,null,"bool"),Sm={kernelName:fe,backendName:"cpu",kernelFunc:_m},km=$f(((t,e)=>t<e?1:0)),Tm=jf(_e,km,null,"bool"),Em={kernelName:_e,backendName:"cpu",kernelFunc:Tm},Mm=$f(((t,e)=>t<=e?1:0)),Cm=jf(Se,Mm,null,"bool"),Am={kernelName:Se,backendName:"cpu",kernelFunc:Cm};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Nm(t,e,n){const r=(e-t)/(n-1),i=U(n,"float32");i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+r;return i}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Im=Zf((t=>Math.log(t))),$m=Qf(Te,Im),Rm={kernelName:Te,backendName:"cpu",kernelFunc:$m};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Om(t,e,n,r){const i=S(r,f(n));for(let n=0;n<i.length;++n){const r=n*e;let s=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>s)&&(s=e)}i[n]=s}return i}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Pm=$f(((t,e)=>Math.max(t,e))),Lm=jf(Oe,Pm),Dm={kernelName:Oe,backendName:"cpu",kernelFunc:Lm},Fm=$f(((t,e)=>Math.min(t,e))),zm=jf(Ve,Fm),Bm={kernelName:Ve,backendName:"cpu",kernelFunc:zm},Um=$f(((t,e)=>t*e)),Vm=Wf(((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n}))),jm=jf(Ge,Um,Vm),Wm={kernelName:Ge,backendName:"cpu",kernelFunc:jm};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Hm(t,e,n){const r=oi(-1,n);return Um([],e,r,t,n)}const Gm={kernelName:qe,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;Mf(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=Hm(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}},qm=$f(((t,e)=>t!==e?1:0)),Xm=jf(Xe,qm,null,"bool"),Ym={kernelName:Xe,backendName:"cpu",kernelFunc:Xm};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Km(t,e,n,r,i){const s=e.length,o=f(e),a=D(e),l=D(i),c=S(n,f(i));for(let e=0;e<o;++e){const n=H(e,s,a),i=new Array(n.length);for(let t=0;t<i.length;t++)i[t]=n[r[t]];c[W(i,s,l)]=t[e]}return c}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Zm(t){const{inputs:e,attrs:n,backend:r}=t,{x:i}=e,{perm:s}=n;Mf(i,"transpose");const o=i.shape.length,a=new Array(o);for(let t=0;t<a.length;t++)a[t]=i.shape[s[t]];const l=Km(r.data.get(i.dataId).values,i.shape,i.dtype,s,a);return{dataId:r.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const Jm={kernelName:Qn,backendName:"cpu",kernelFunc:Zm};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Qm(t,e,n,r){const[i,s]=Ql(t,r),o=$i(e,"int32"),a=U(f(i),o),l=f(s);for(let t=0;t<a.length;++t){const e=t*l;let r=1;for(let t=0;t<l;++t)r*=n[e+t];a[t]=r}return{outVals:a,outShape:i,outDtype:o}}const tg={kernelName:sn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;Mf(i,"prod");const a=i.shape.length,l=w(s,i.shape),c=nc(l,a);let u=l,h=i;const d=[];null!=c&&(h=Zm({inputs:{x:i},backend:n,attrs:{perm:c}}),d.push(h),u=ic(u.length,a));const p=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:g}=Qm(h.shape,h.dtype,p,u);let y=m;return o&&(y=tc(m,l)),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,g,f)}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function eg(t,e,n,r){const i=[];let s=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map((()=>[0]));!function(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let t=1;t<r.length;++t)if(r[t-1]>r[t])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let t=0;t<e.length-1;++t){l*=e[t];const n=e[t+1];for(let e=1;e<l+1;++e)a[t].push(e*n)}for(let r=0;r<t.length;++r){let o=t[r],l=t[r]+1;for(let t=0;t<n.length;++t){const r=n[t],i=t+e.length-1;if(i>=0){const t=a[i],e=t[t.length-1]-r[o];for(let t=o;t<l;++t)a[i].push(r[t+1]+e)}o=r[o],l=r[l]}l!==o&&(i.push([o,l]),s+=l-o)}return{outSplits:a,valueSlices:i,numValues:s}}function ng(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function rg(t,e,n,r,i){const s=e.slice();s[0]=i;const o=k(n,f(s)),a=t.length;return function(t,e,n,r,i,s){const o=ng(e,2)[1],a=ng(s,2)[1];let l=0;for(const e of n)for(let n=e[0];n<e[1];++n){for(let e=0;e<r;++e)i[l*a+e]=t[n*o+e];++l}}(t,e,r,0===a?0:a/e[0],o,s),[o,s]}function ig(t,e,n,r,i,s,o,a){if(0===t.length)throw new Error("paramsNestedSplits must be non empty");if(0===e[0].length)throw new Error("Split tensors must not be scalars");if(function(t,e,n){t.forEach(((t,r)=>{if(t<0||t>=n){const i=H(r,e.length,D(e)).join(",");throw new Error(`indices[${i}] = ${t} is not in [0, ${n})`)}}))}(s,o,e[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:u,numValues:h}=eg(s,o,t,l),d=function(t){const e=[];for(let n=0;n<t.length;++n){const r=k("int32",t[n].length);e.push(r),t[n].forEach(((t,e)=>r[e]=t))}return e}(c),p=rg(n,r,i,u,h);return[d,p[0],p[1]]}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var sg=_p;class og{constructor(t,e,n,r,i,s,o,a,l,c){this.shape=t,this.shapeShape=e,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=o,this.rowPartitionValues=a,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=kp(c),this.raggedRank=Tp(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===sg.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===sg.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case sg.VALUE_ROWIDS:return og.getMaxWidthValueRowID(e);case sg.ROW_SPLITS:return og.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${sg[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(0===e||1===e)return 0;let n=0;for(let r=0;r<e-1;++r){const e=t[r+1]-t[r];e>n&&(n=e)}return n}static getMaxWidthValueRowID(t){const e=t.length;if(0===e)return 0;let n=0,r=t[0],i=0;for(let s=1;s<e;++s){const e=t[s];e!==r&&(r=e,i=Math.max(s-n,i),n=s)}return Math.max(e-n,i)}tensorShapeFromTensor(t,e,n=!0){if(0===e.length){if(-1===t[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return lg(t,n)}calculateOutputSize(t){const e=this.valuesShape;Ep(this.defaultValueShape,e);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Sp(this.raggedRank,n,e);r[0]<0&&(r[0]=t);for(let t=1;t<=this.raggedRank;++t)r[t]<0&&(r[t]=this.getMaxWidth(t));return r}calculateFirstParentOutputIndex(t,e,n){const r=Math.min(t,n),i=[];let s=0;for(let t=0;t<r;++t,s+=e)i.push(s);for(let e=r;e<t;++e)i.push(-1);return u(i.length===t,(()=>"Final length of result must be equal to firstDimension.")),i}calculateOutputIndexRowSplit(t,e,n,r){const i=t.length,s=[];for(let o=0;o<i-1;++o){const i=t[o+1]-t[o];let a=Math.min(r,i),l=e[o];-1===l&&(a=0);for(let t=0;t<a;++t)s.push(l),l+=n;for(let t=0;t<i-a;++t)s.push(-1)}if(i>0&&s.length!==t[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(t,e,n,r){const i=t.length,s=[];if(0===i)return[];let o=0,a=t[0];if(a>=e.length)throw new Error(`Got currentValueRowId=${a}, which is not less than ${e.length}`);let l=e[a];s.push(l);for(let c=1;c<i;++c){const i=t[c];if(i===a)l>=0&&(++o,o<r?l+=n:l=-1);else{if(o=0,a=i,i>=e.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${e.length}`);l=e[i]}s.push(l)}if(s.length!==t.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(t,e,n,r){const i=this.getRowPartitionTensor(t),s=this.getRowPartitionTypeByDimension(t);switch(s){case sg.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,n,r);case sg.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,n,r);default:throw new Error(`Unsupported partition type: ${sg[s]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case sg.FIRST_DIM_SIZE:return t[0];case sg.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case sg.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${sg[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),e=this.calculateOutputSize(t),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let t=n.length-2;t>=0;--t)n[t]=n[t+1]*e[t+1];const r=lg(e,!1),i=k(this.valuesDType,f(r));if(n[0]*e[0]>0){let s=this.calculateFirstParentOutputIndex(t,n[0],e[0]);for(let t=1;t<=this.raggedRank;++t){s=this.calculateOutputIndex(t-1,s,n[t],e[t])}this.setOutput(this.raggedRank,s,i,r)}return[r,i]}setOutput(t,e,n,r){if(0===n.length)return;const i=this.values,s=n;let o=r.slice();o=o.slice(t+1);const a=f(o),l=e.length;let c=this.defaultValue;if(c.length!==a&&1!==c.length){const t=this.defaultValueShape;Co((()=>{const e=il(c,t),n=vl(e,o);c=n.dataSync()}))}let u=0,h=0,d=0;for(let t=0;t<=l;++t){let r=t<l?e[t]:-1;if(r!==d){if(h<d){const t=i.subarray(u*a);ag(s.subarray(h*a),t,(d-h)*a)}if(t>=l){const t=n.length;r=Math.floor(t/a)}if(r>d)if(1===this.defaultValue.length)s.subarray(d*a,r*a).fill(this.defaultValue[0]),d=r;else for(;r>d;){ag(s.slice(d*a),c,a),++d}r<0?(u=t+1,h=d):(u=t,h=d,d=h+1)}else++d}}}function ag(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function lg(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function cg(t,e,n,r,i,s,o,a,l,c){return new og(t,e,n,r,i,s,o,a,l,c).compute()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ug(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return U(0,r);const i=U(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+n;return i}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hg=Zf((t=>1/Math.sqrt(t))),dg=Qf(xn,hg),pg={kernelName:xn,backendName:"cpu",kernelFunc:dg};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function fg(t,e,n,r,i,s,o,a,l,c){const u=[r/i,i],h=t.values,d=e.values;if(0===r)return eo(n,e.dtype);const p=eo(u,e.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let t=0;t<s;t++){const s=[];let l=0;for(let e=0;e<o;e++){const n=h[t*o+e];s.push(n),l+=n*a[e]}if(l<0||l>=r/i)throw new Error(`Invalid indices: ${s} does not index into ${n}`);for(let n=0;n<i;n++)c?p.values[l*i+n]+=d[t*i+n]:p.values[l*i+n]=0===e.rank?d[0]:d[t*i+n]}return p}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mg=Zf((t=>1/(1+Math.exp(-t)))),gg=Jf(An,(t=>1/(1+Math.exp(-t)))),yg={kernelName:An,backendName:"cpu",kernelFunc:gg};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function bg(t,e,n,r,i){const s=pa(r,e,n),o=f(n),a=D(r);if(s){const n=fa(e,a);return"string"===i?t.slice(n,n+o):t.subarray(n,n+o)}const l=eo(r,i,"string"===i?_f(t):t),c=eo(n,i);for(let t=0;t<c.size;++t){const n=c.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));c.set(l.get(...r),...n)}return"string"===i?Sf(c.values):c.values}function vg(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r;Mf(i,"slice");const[a,l]=ma(i,s,o);ra(i,a,l);const c=bg(n.data.get(i.dataId).values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,c)}const xg={kernelName:Tn,backendName:"cpu",kernelFunc:vg};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function wg(t,e,n,r,i,s,o){const a=e[0],l=s[0],c=new Array(l),u=new Array(a),h=e[1];if(0===l){if(0!==a)throw new Error(of(a));return[k(n,0),[0,h],k(i,0),c,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let e=0;e<a;++e){const n=t[e*h];if(n<0)throw new Error(af(e,n));if(n>=l)throw new Error(lf(e,n,l));++f[n],d=d&&n>=p,p=n}let m=!0;for(let t=0;t<l;++t){const e=0===f[t];c[t]=e,m=m&&!e,f[t]=Math.max(f[t],1),t>0&&(f[t]+=f[t-1])}if(m&&d){const e=t,n=r;for(let t=0;t<a;++t)u[t]=t;return[e,[a,h],n,c,u]}{const e=f[l-1],s=k(n,e*h),d=k(i,e),p=new Array(l).fill(0);for(let e=0;e<a;++e){const n=t[e*h],i=p[n],o=(0===n?0:f[n-1])+i;p[n]++;for(let n=0;n<h;++n)s[o*h+n]=t[e*h+n];d[o]=r[e],u[e]=o}for(let t=0;t<l;++t){if(0===p[t]){const e=0===t?0:f[t-1];s[e*h+0]=t;for(let t=1;t<h;++t)s[e*h+t]=0;d[e]=o}}return[s,[e,h],d,c,u]}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function _g(t,e,n,r,i){const s=f(r),o=e[0],a=i.length,l=[];let c=1,u=-1;for(let t=0;t<a;++t){const e=i[t];if(-1===e){if(-1!==u)throw new Error(cf(u,t));u=t,l.push(1)}else{if(e<0)throw new Error(uf(t,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(s/c);if(c*t!==s)throw new Error(df(r,l));l[u]=t}if(f(l)!==s)throw new Error(pf(r,l));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let t=h-2;t>=0;--t)d[t]=d[t+1]*r[t+1]}const p=[];if(a>0){p[a-1]=1;for(let t=a-2;t>=0;--t)p[t]=p[t+1]*l[t+1]}const m=k(n,o*a);for(let e=0;e<o;++e){let n=0;for(let r=0;r<h;++r)n+=t[e*h+r]*d[r];for(let t=0;t<a;++t)m[e*a+t]=Math.trunc(n/p[t]),n%=p[t]}return[m,[o,a],l]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Sg(t,e,n,r,i,s=!1,o=0){const a=r.length,l=[e[0],t.length/e[0]],c=l[1],u=a>0?i[a-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=e.slice();h[0]=u;const d=k(n,h.reduce(((t,e)=>t*e),1));if(0===a)return u>0&&d.fill(o),[d,h];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,m=0,g=i[p];for(;;){let e=0;if(f<a){if(e=i[f],g===e){++f;continue}if(g>=e)throw new Error("segment ids are not increasing")}if(g<0||g>=u)throw new Error(gf(g,u));g>m&&d.fill(o,m*c,g*c);for(let e=p;e<f;++e){const n=r[e];if(n<0||n>=l[0])throw new Error(yf(e,r[e],l[0]));for(let e=0;e<c;e++)d[g*c+e]+=t[n*c+e]}if(s)for(let t=0;t<c;t++)d[g*c+t]/=f-p;if(p=f,++f,m=g+1,g=e,f>a)break}return m<u&&d.fill(o,m*c,u*c),[d,h]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const kg=Zf((t=>Math.sqrt(t))),Tg=Jf(In,(t=>Math.sqrt(t))),Eg={kernelName:In,backendName:"cpu",kernelFunc:Tg},Mg=$f(((t,e)=>{const n=t-e;return n*n})),Cg=jf(Un,Mg),Ag={kernelName:Un,backendName:"cpu",kernelFunc:Cg};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Ng(t,e,n,r){const i=eo(t,e.dtype);for(let t=0;t<i.size;t++){const s=i.indexToLoc(t),o=new Array(s.length);for(let t=0;t<o.length;t++)o[t]=s[t]*n[t]+r[t];i.set(e.get(...o),...s)}return i}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Ig{constructor(t,e,n,r,i,s){this.separator=ci(t),this.nGramWidths=e,this.leftPad=ci(n),this.rightPad=ci(r),this.padWidth=i,this.preserveShort=s}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,i,s){for(let o=0;o<i;++o){const a=this.getPadWidth(s),l=Math.max(0,a-o),c=Math.max(0,a-(i-(o+1))),u=s-(l+c),h=e+(l>0?0:o-a);let d=0;d+=l*this.leftPad.length;for(let e=0;e<u;++e)d+=t[h+e].length;d+=c*this.rightPad.length;d+=(l+c+u-1)*this.separator.length,n[r+o]=new Uint8Array(d);const p=n[r+o];let f=0;const m=t=>t.forEach((t=>p[f++]=t));for(let t=0;t<l;++t)m(this.leftPad),m(this.separator);for(let e=0;e<u-1;++e)m(t[h+e]),m(this.separator);if(u>0){m(t[h+u-1]);for(let t=0;t<c;++t)m(this.separator),m(this.rightPad)}else{for(let t=0;t<c-1;++t)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let i=1;i<r;++i){let r=e[i]>=t;if(r=r&&e[i]<=n,!r)throw new Error(`Invalid split value ${e[i]}, must be in [${t}, ${n}]`);t=e[i]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const i=r-1,s=k("int32",r);if(0===n||0===r){const t=new Array(n);for(let t=0;t<=i;++t)s[t]=0;return[t,s]}s[0]=0;for(let t=1;t<=i;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),s[t]=s[t-1]+r}const o=new Array(s[i]);for(let n=0;n<i;++n){const r=e[n];let i=s[n];if(this.nGramWidths.forEach((s=>{const a=e[n+1]-e[n],l=this.getNumNGrams(a,s);this.createNGrams(t,r,o,i,l,s),i+=l})),this.preserveShort&&i===s[n]){const s=e[n+1]-e[n];if(0===s)continue;const a=s+2*this.padWidth,l=1;this.createNGrams(t,r,o,i,l,a)}}return[o,s]}}function $g(t,e,n,r,i,s,o,a){return new Ig(n,r,i,s,o,a).compute(t,e)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Rg(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const i=e[0];let s=t.indexOf(i);for(;-1!==s;){const e=t.subarray(0,s);n&&0===e.length||r.push(e),s=(t=t.subarray(s+1)).indexOf(i)}return void(n&&0===t.length||r.push(t))}let i=0;for(let s=0;s<t.length+1;s++)if(s===t.length||-1!==e.indexOf(t[s])){const e=t.subarray(i,s);n&&0===e.length||r.push(e),i=s+1}}function Og(t,e,n){const r=t.length,i=[];let s=0,o=0;const a=new Array(r);for(let l=0;l<r;++l){const r=i.length;Rg(t[l],e,n,i);const c=i.length-r;a[l]=c,s+=c,o=Math.max(o,c)}const l=k("int32",2*s),c=new Array(s),u=[r,o];let h=0;for(let t=0;t<r;++t)for(let e=0;e<a[t];++e)l[2*h]=t,l[2*h+1]=e,c[h]=i[h],++h;return[l,c,u]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Pg(t,e){const n=k("int32",t.length);for(let r=0;r<t.length;++r)n[r]=si(t[r]).modulo(e).getLowBitsUnsigned();return n}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Lg=$f(((t,e)=>t-e)),Dg=Wf(((t,e,n,r)=>({real:t-n,imag:e-r}))),Fg=jf(qn,Lg,Dg),zg={kernelName:qn,backendName:"cpu",kernelFunc:Fg};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Bg(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const r=eo(n,t.dtype);for(let e=0;e<r.values.length;++e){const n=r.indexToLoc(e),i=new Array(t.rank);for(let e=0;e<i.length;e++)i[e]=n[e]%t.shape[e];const s=t.locToIndex(i);r.values[e]=t.values[s]}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ug=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function Vg(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const i=r-n+1,s=e-n+1,o=Math.log(i),a=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*a*(i-a)/i)*Math.sign(s-i/2);Vg(t,e,Math.max(n,Math.floor(e-s*a/i+l)),Math.min(r,Math.floor(e+(i-s)*a/i+l)))}const i=t[e];let s=n,o=r;for(l(t,n,e),Ug(t[r],i)>0&&l(t,n,r);s<o;){for(l(t,s,o),s++,o--;Ug(t[s],i)<0;)s+=1;for(;Ug(t[o],i)>0;)o-=1}0===Ug(t[n],i)?l(t,n,o):(o+=1,l(t,o,r)),o<=e&&(n=o+1),e<=o&&(r=o-1)}}function jg(t,e,n,r,i){const s=e[e.length-1],[o,a]=[t.length/s,s],l=S(n,o*r),c=S("int32",o*r);for(let e=0;e<o;e++){const n=e*a,s=t.subarray(n,n+a);let o=new Array(s.length);s.forEach(((t,e)=>o[e]={value:t,index:e})),r<o.length&&(Vg(o,r),o=o.slice(0,r)),i&&o.sort(Ug);const u=e*r,h=l.subarray(u,u+r),d=c.subarray(u,u+r);for(let t=0;t<r;t++)h[t]=o[t].value,d[t]=o[t].index}const u=e.slice();return u[u.length-1]=r,[eo(u,n,l),eo(u,"int32",c)]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Wg(t,e,n,r){const i=w(e,n)[0],s=[1,n[0],1];for(let t=0;t<i;t++)s[0]*=n[t];s[1]=n[i];for(let t=i+1;t<n.length;t++)s[2]*=n[t];const o={},a=new Int32Array(n[i]),l=new xi(s,r,t),c=[],u=1===s[0]&&1===s[2];for(let e=0;e<n[i];e++){let n;if(u)n=t[e].toString();else{const t=[];for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)t.push(l.get(n,e,r));n=t.join(",")}if(void 0!==o[n])a[e]=o[n];else{const t=Object.keys(o).length;o[n]=t,a[e]=t,c.push(e)}}const h=s.slice();h[1]=Object.keys(o).length;const d=new xi(h,r);c.forEach(((t,e)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)d.set(l.get(n,t,r),n,e,r)}));const p=n.slice();return p[i]=h[1],{outputValues:d.values,outputShape:p,indices:a}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Hg=Object.freeze({__proto__:null,simpleAbsImpl:Nf,addImpl:Hf,bincountImpl:Yf,bincountReduceImpl:Kf,castImpl:Bf,ceilImpl:tm,concatImpl:rm,equalImpl:im,expImpl:am,expm1Impl:um,floorImpl:pm,gatherNdImpl:gm,gatherV2Impl:ym,greaterImpl:bm,greaterEqualImpl:wm,lessImpl:km,lessEqualImpl:Mm,linSpaceImpl:Nm,logImpl:Im,maxImpl:Om,maximumImpl:Pm,minimumImpl:Fm,multiplyImpl:Um,negImpl:Hm,notEqualImpl:qm,prodImpl:Qm,raggedGatherImpl:ig,raggedTensorToTensorImpl:cg,rangeImpl:ug,rsqrtImpl:hg,scatterImpl:fg,sigmoidImpl:mg,sliceImpl:bg,sparseFillEmptyRowsImpl:wg,sparseReshapeImpl:_g,sparseSegmentReductionImpl:Sg,sqrtImpl:kg,squaredDifferenceImpl:Mg,stridedSliceImpl:Ng,stringNGramsImpl:$g,stringSplitImpl:Og,stringToHashBucketFastImpl:Pg,subImpl:Lg,tileImpl:Bg,topKImpl:jg,transposeImpl:Km,uniqueImpl:Wg});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */$o("cpu",(()=>new Af),1);
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const Gg=Jf(Jt,(t=>t>=0?t:Math.exp(t)-1)),qg={kernelName:Jt,backendName:"cpu",kernelFunc:Gg};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Xg(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r;Mf([i],"leakyRelu");const o=f(i.shape),a=n.data.get(i.dataId).values,l=S("float32",o);for(let t=0;t<a.length;t++)l[t]=a[t]<0?s*a[t]:a[t];return n.makeTensorInfo(i.shape,"float32",l)}const Yg={kernelName:we,backendName:"cpu",kernelFunc:Xg},Kg=$f(((t,e)=>t<0?e*t:t));
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Zg(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e;Mf([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,l]=Kg(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Jg={kernelName:rn,backendName:"cpu",kernelFunc:Zg},Qg=Jf(hn,(t=>Math.max(0,t))),ty={kernelName:hn,backendName:"cpu",kernelFunc:Qg},ey=Jf(yn,(t=>Math.min(Math.max(0,t),6))),ny={kernelName:yn,backendName:"cpu",kernelFunc:ey};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function ry(t,e,n,r,i){if("linear"===n)return Lf({inputs:{x:e},backend:t});if("relu"===n)return Qg({inputs:{x:e},backend:t});if("elu"===n)return Gg({inputs:{x:e},backend:t});if("relu6"===n)return ey({inputs:{x:e},backend:t});if("prelu"===n)return Zg({inputs:{x:e,alpha:r},backend:t});if("leakyrelu"===n)return Xg({inputs:{x:e},backend:t,attrs:{alpha:i}});if("sigmoid"===n)return gg({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function iy(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=f(i.shape),a=x(s,o),l=f(a);u(o===l,(()=>`The new shape (${a}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(null!=c.complexTensorInfos){const t=c.complexTensorInfos.real,e=c.complexTensorInfos.imag;t.shape=a,e.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const sy={kernelName:dn,backendName:"cpu",kernelFunc:iy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function oy(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;Mf([i,s],"matMul");const l=i.shape.length,c=s.shape.length,h=o?i.shape[l-2]:i.shape[l-1],d=a?s.shape[c-1]:s.shape[c-2],p=o?i.shape[l-1]:i.shape[l-2],m=a?s.shape[c-2]:s.shape[c-1],g=i.shape.slice(0,-2),y=s.shape.slice(0,-2),b=f(g),v=f(y),x=Vo(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([p,m]);u(h===d,(()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`));const w=a?[v,m,d]:[v,d,m],_=iy({inputs:{x:i},backend:n,attrs:{shape:o?[b,h,p]:[b,p,h]}}),S=iy({inputs:{x:s},backend:n,attrs:{shape:w}}),k=o?_.shape[1]:_.shape[2],T=o?_.shape[2]:_.shape[1],E=a?S.shape[1]:S.shape[2],M=Math.max(b,v),C=n.data.get(_.dataId).values,A=n.data.get(S.dataId).values,N=D(_.shape),I=D(S.shape),[$,R,O]=o?[N[0],1,N[1]]:[N[0],N[1],1],[P,L,F]=a?[1,I[1],I[0]]:[I[1],1,I[0]],z=T*E,B=eo([M,T,E],_.dtype),U=B.values,V=n.blockSize;for(let t=0;t<M;t++)for(let e=0;e<T;e+=V)for(let n=0;n<E;n+=V)for(let r=0;r<k;r+=V){const i=Math.min(e+V,T),s=Math.min(n+V,E),o=Math.min(r+V,k);for(let a=e;a<i;a++)for(let e=n;e<s;e++){let n=0;for(let i=r;i<o;i++){const r=Math.min(t,b-1)*$,s=Math.min(t,v-1)*F;n+=C[r+a*R+i*O]*A[i*P+e*L+s]}U[t*z+(a*E+e)]+=n}}return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(x,B.dtype,B.values)}const ay={kernelName:vt,backendName:"cpu",kernelFunc:oy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ly={kernelName:ar,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;let d,p,f;const m=[];d=oy({inputs:{a:i,b:s},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(p=qf({inputs:{a:d,b:o},backend:n}),m.push(d),d=p),u&&(f=ry(n,d,u,a,h),m.push(d),d=f);for(const t of m)n.disposeIntermediateTensorInfo(t);return d}},cy=Jf(nt,(t=>Math.acos(t))),uy={kernelName:nt,backendName:"cpu",kernelFunc:cy},hy=Jf(rt,(t=>Math.acosh(t))),dy={kernelName:rt,backendName:"cpu",kernelFunc:hy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const py={kernelName:st,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n}=t,r=e;Mf(e,"addN");const i=r.map((t=>n.data.get(t.dataId).values)),s=eo(r[0].shape,r[0].dtype),o=s.values;for(let t=0;t<r.length;t++){const e=i[t];for(let t=0;t<o.length;t++)o[t]+=e[t]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const fy={kernelName:ot,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;Mf(i,"all");const a=w(s,i.shape);let l=a;const c=nc(l,i.shape.length);let u=i;null!=c&&(u=Zm({inputs:{x:i},backend:n,attrs:{perm:c}}),l=ic(l.length,i.shape.length)),ec("all",l,u.shape.length);const[h,d]=Ql(u.shape,l),p=f(d),m=U(f(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*p;let n=g[e];for(let t=0;t<p;++t){const r=g[e+t];n=n&&r}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=iy({inputs:{x:y},backend:n,attrs:{shape:tc(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const my={kernelName:at,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;Mf(i,"any");const a=w(s,i.shape);let l=a;const c=nc(l,i.shape.length);let u=i;null!=c&&(u=Zm({inputs:{x:i},backend:n,attrs:{perm:c}}),l=ic(l.length,i.shape.length)),ec("any",l,u.shape.length);const[h,d]=Ql(u.shape,l),p=f(d),m=U(f(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*p;let n=g[e];for(let t=0;t<p;++t){const r=g[e+t];n=n||r}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=iy({inputs:{x:y},backend:n,attrs:{shape:tc(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gy={kernelName:lt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;Mf(i,"argMax");let o=w(s,i.shape);const a=nc(o,i.shape.length);let l=i;const c=[];null!=a&&(l=Zm({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=ic(o.length,l.shape.length)),o=[o[0]],ec("argMax",o,l.shape.length);const[u,h]=Ql(l.shape,o),d=U(f(u),"int32"),p=f(h),m=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*p;let n=m[e],r=0;for(let t=0;t<p;++t){const i=m[e+t];i>n&&(n=i,r=t)}d[t]=r}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yy={kernelName:ct,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;Mf(i,"argMin");let o=w(s,i.shape);const a=nc(o,i.shape.length);let l=i;const c=[];null!=a&&(l=Zm({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=ic(o.length,l.shape.length)),o=[o[0]],ec("argMin",o,l.shape.length);const[u,h]=Ql(l.shape,o),d=U(f(u),"int32"),p=f(h),m=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*p;let n=m[e],r=0;for(let t=0;t<p;++t){const i=m[e+t];i<n&&(n=i,r=t)}d[t]=r}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}},by=Jf(ut,(t=>Math.asin(t))),vy={kernelName:ut,backendName:"cpu",kernelFunc:by},xy=Jf(ht,(t=>Math.asinh(t))),wy={kernelName:ht,backendName:"cpu",kernelFunc:xy},_y=Jf(dt,(t=>Math.atan(t))),Sy={kernelName:dt,backendName:"cpu",kernelFunc:_y},ky=$f(((t,e)=>Math.atan2(t,e))),Ty=jf(ft,ky),Ey={kernelName:ft,backendName:"cpu",kernelFunc:Ty},My=Jf(pt,(t=>Math.atanh(t))),Cy={kernelName:pt,backendName:"cpu",kernelFunc:My};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Ay(t,e,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,u=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,p=i.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=eo(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let e=0;e<i.batchSize;++e){const n=e*y,m=e*r[0];for(let e=0;e<i.inChannels;++e)for(let y=0;y<i.outHeight;++y){const x=y*o-d,w=Math.max(0,x),_=Math.min(i.inHeight,u+x),S=n+y*b;for(let n=0;n<i.outWidth;++n){const o=n*a-p,u=Math.max(0,o),d=Math.min(i.inWidth,h+o);let y=f,b=0,x=0;for(let n=w;n<_;n+=l){const i=m+n*r[1];for(let n=u;n<d;n+=c){const o=t[i+n*r[2]+e];"max"===s&&o>y?y=o:"avg"===s&&(b+=o,x++)}if(isNaN(y))break}g[S+n*v+e]="avg"===s?b/x:y}}}return m}function Ny(t,e,n,r,i=!1,s=!1){const o=eo(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=eo(e,n,t);for(let t=0;t<r.batchSize;++t)for(let e=0;e<r.inChannels;++e)for(let n=0;n<r.outHeight;++n){const g=n*a-p;let y=g;for(;y<0;)y+=c;const b=Math.min(r.inHeight,h+g);for(let a=0;a<r.outWidth;++a){const h=a*l-f;let p=h;for(;p<0;)p+=u;const v=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,w=-1;for(let n=y;n<b;n+=c){const o=n-g;for(let a=p;a<v;a+=u){const l=a-h,c=m.get(t,n,a,e);c>x&&(x=c,w=i?s?((t*r.inHeight+n)*r.inWidth+a)*r.inChannels+e:(n*r.inWidth+a)*r.inChannels+e:o*d+l)}}o.set(w,t,n,a,e)}}return o}function Iy(t,e,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,u=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,y=i.padInfo.left,b="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=eo(i.outShape,n),x=v.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[2]*i.outShape[3]*i.outShape[4],S=i.outShape[3]*i.outShape[4],k=i.outShape[4];for(let e=0;e<i.batchSize;++e){const n=e*w,v=e*r[0];for(let e=0;e<i.inChannels;++e)for(let w=0;w<i.outDepth;++w){const T=w*o-m;let E=T;for(;E<0;)E+=c;const M=Math.min(i.inDepth,d+T),C=n+w*_;for(let n=0;n<i.outHeight;++n){const o=n*a-g;let d=o;for(;d<0;)d+=u;const m=Math.min(i.inHeight,p+o),w=C+n*S;for(let n=0;n<i.outWidth;++n){const o=n*l-y;let a=o;for(;a<0;)a+=h;const p=Math.min(i.inWidth,f+o),g=w+n*k;let _=b,S=0,T=0;for(let n=E;n<M;n+=c){const i=v+n*r[1];for(let n=d;n<m;n+=u){const o=i+n*r[2];for(let n=a;n<p;n+=h){const i=t[o+n*r[3]+e];if("max"===s&&i>_?_=i:"avg"===s&&(S+=i,T++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}x[g+e]="avg"===s?S/T:_}}}}return v}const $y={kernelName:mt,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;Mf(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;u(el(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=Ha(i.shape,s,o,1,a,l);let h;if(1===c.filterWidth&&1===c.filterHeight&&m(c.inShape,c.outShape))h=Lf({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=D(i.shape),r=Ay(t,i.shape,i.dtype,e,c,"avg");h=n.makeTensorInfo(c.outShape,i.dtype,r.values)}return h}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ry={kernelName:yt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;Mf(i,"avgPool3d");const u=Ga(i.shape,s,o,1,a,l,c),h=Iy(n.data.get(i.dataId).values,i.shape,i.dtype,D(i.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Oy={kernelName:bt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;Mf([i,s],"avgPool3DGrad");const u=Ga(s.shape,o,a,1,l,c),h=u.strideDepth,d=u.strideHeight,p=u.strideWidth,f=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,b=u.dilationHeight,v=u.dilationWidth,x=u.effectiveFilterDepth,w=u.effectiveFilterHeight,_=u.effectiveFilterWidth,S=x-1-u.padInfo.front,k=_-1-u.padInfo.left,T=w-1-u.padInfo.top,E=eo(s.shape,"float32"),M=1/(f*m*g),C=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-S,o=r-T,a=i-k;let l=0;for(let n=0;n<x;n+=y){const r=(s+n)/h;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let n=0;n<w;n+=b){const i=(o+n)/d;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let n=0;n<_;n+=v){const s=(a+n)/p;if(s<0||s>=u.outWidth||Math.floor(s)!==s)continue;l+=C.get(t,r,i,s,e)}}}E.set(l*M,t,n,r,i,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Py={kernelName:gt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;Mf([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Ha(o.shape,a,l,1,c),h=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,b=u.effectiveFilterWidth,v=b-1-u.padInfo.left,x=y-1-u.padInfo.top,w=eo(o.shape,"float32"),_=1/(p*f),S=n.data.get(i.dataId).values,k=eo(i.shape,"float32",S);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const i=n-x,s=r-v;let o=0;for(let n=0;n<y;n+=m){const r=(i+n)/h;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let n=0;n<b;n+=g){const i=(s+n)/d;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;o+=k.get(t,r,i,e)}}w.set(o*_,t,n,r,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ly={kernelName:ue,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,scale:s,offset:o,mean:a,variance:l}=e;u(a.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),u(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),u(null==s||a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),Mf([i,a,l,s,o],"batchNorm");let{varianceEpsilon:c}=r;null==c&&(c=.001);const h=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,p=n.data.get(l.dataId).values,f=s?n.data.get(s.dataId).values:new Float32Array([1]),m=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(h.length),y=m.length,b=f.length,v=p.length,x=d.length;let w=0,_=0,S=0,k=0;for(let t=0;t<h.length;++t)g[t]=m[w++]+(h[t]-d[_++])*f[S++]/Math.sqrt(p[k++]+c),w>=y&&(w=0),_>=x&&(_=0),S>=b&&(S=0),k>=v&&(k=0);return n.makeTensorInfo(i.shape,i.dtype,g)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Dy={kernelName:xt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;Mf([i],"batchToSpaceND");const a=s.reduce(((t,e)=>t*e)),l=Ap(i.shape,s,a),c=Np(l.length,s.length),u=Ip(i.shape,s,a),h=$p(o,s.length),d=Rp(u,o,s.length),p=iy({inputs:{x:i},backend:n,attrs:{shape:l}}),f=Zm({inputs:{x:p},backend:n,attrs:{perm:c}}),m=iy({inputs:{x:f},backend:n,attrs:{shape:u}}),g=vg({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fy={kernelName:wt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=Yf(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,a)}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zy={kernelName:St,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=Vo(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},By=Jf(Et,((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t})),Uy={kernelName:Et,backendName:"cpu",kernelFunc:By},Vy={kernelName:Ct,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(f(e.shape)),i=n.data.get(e.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values;for(let t=0;t<a.length;t++){const e=a[t],n=l[t];r[t]=Math.hypot(e,n)}return n.makeOutput(r,e.shape,"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function jy(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const Wy={kernelName:ye,backendName:"cpu",kernelFunc:jy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Hy(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=w(i,e[0].shape)[0];xp(e.map((t=>t.shape)),s);let o=wp(e.map((t=>t.shape)),s);if(0===f(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>f(t.shape)>0));if(1===a.length)return Lf({inputs:{x:a[0]},backend:n});if("complex64"===a[0].dtype){const t=a.map((t=>Ff({inputs:{input:t},backend:n}))),e=a.map((t=>jy({inputs:{input:t},backend:n}))),r=Hy({inputs:t,backend:n,attrs:{axis:s}}),i=Hy({inputs:e,backend:n,attrs:{axis:s}}),o=Rf({inputs:{real:r,imag:i},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),o}const l=a.map((t=>{const e=f(t.shape.slice(s));return iy({inputs:{x:t},backend:n,attrs:{shape:[-1,e]}})})),c=l.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));o=wp(l.map((t=>t.shape)),1);const u=1===l[0].shape[0],h=rm(c,o,e[0].dtype,u),d=wp(a.map((t=>t.shape)),s),p=n.makeTensorInfo(d,e[0].dtype,h);return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}const Gy={kernelName:At,backendName:"cpu",kernelFunc:Hy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function qy(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;Mf([i,s],"conv2d");const h=nl(l),d=qa(i.shape,s.shape,o,c,a,u,!1,h),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,x=new xi(d.outShape,i.dtype),w=D(i.shape),_=D(s.shape),S=w[0],k=v?w[1]:w[2],T=v?w[2]:1,E=v?1:w[1],M=x.strides[0],C=v?x.strides[1]:x.strides[2],A=v?x.strides[2]:1,N=v?1:x.strides[1],I=n.data.get(i.dataId).values,$=n.data.get(s.dataId).values,R=x.values;for(let t=0;t<d.batchSize;++t){const e=t*S,n=t*M;for(let t=0;t<d.outHeight;++t){const r=n+t*C,i=t*d.strideHeight-b;for(let t=0;t<p;++t){const n=i+t*m;if(n<0||n>=d.inHeight)continue;const s=t*_[0],o=e+n*k;for(let t=0;t<d.outWidth;++t){const e=r+t*A,n=t*d.strideWidth-y;for(let t=0;t<f;++t){const r=n+t*g;if(r<0||r>=d.inWidth)continue;const i=o+r*T;let a=s+t*_[1];for(let t=0;t<d.inChannels;++t){const n=I[i+t*E];for(let t=0;t<d.outChannels;++t)R[e+t*N]+=n*$[a+t];a+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,R)}const Xy={kernelName:Nt,backendName:"cpu",kernelFunc:qy};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yy={kernelName:It,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;Mf([i,s],"conv2dBackpropFilter");const h=nl(l),d=qa(i.shape,u,o,1,a,c,!1,h),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=d,y="channelsLast"===d.dataFormat,b=new xi(d.filterShape,"float32"),v=d.padInfo.left,x=d.padInfo.top,w=n.data.get(i.dataId).values,_=n.data.get(s.dataId).values,S=new xi(i.shape,i.dtype,w),k=new xi(s.shape,s.dtype,_);for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((x-t)/p)),n=Math.min(d.outHeight,(d.inHeight+x-t)/p);for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((v-r)/f)),s=Math.min(d.outWidth,(d.inWidth+v-r)/f);for(let o=0;o<d.inChannels;++o)for(let a=0;a<d.outChannels;++a){let l=0;for(let c=0;c<d.batchSize;++c)for(let u=e;u<n;++u){const e=t+u*p-x;for(let t=i;t<s;++t){const n=r+t*f-v;l+=y?S.get(c,e,n,o)*k.get(c,u,t,a):S.get(c,o,e,n)*k.get(c,a,u,t)}}b.set(l,t,r,o,a)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ky={kernelName:$t,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;Mf([i,s],"conv2dBackpropInput");const h=D(s.shape),d=D(i.shape);let p=nl(c);const f=qa(o,s.shape,a,1,l,u,!1,p),m=new xi(f.inShape,"float32"),g=m.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,x,w]=h,{batchSize:_,filterHeight:S,filterWidth:k,inChannels:T,inHeight:E,inWidth:M,outChannels:C,outHeight:A,outWidth:N,strideHeight:I,strideWidth:$}=f;p=f.dataFormat;const R=S-1-f.padInfo.top,O=k-1-f.padInfo.left,P="channelsLast"===p,L=m.strides[0],F=P?m.strides[1]:m.strides[2],z=P?m.strides[2]:1,B=P?1:m.strides[1],U=d[0],V=P?d[1]:d[2],j=P?d[2]:1,W=P?1:d[1];for(let t=0;t<_;++t)for(let e=0;e<T;++e)for(let n=0;n<E;++n){const r=n-R,i=Math.max(0,Math.ceil(r/I)),s=Math.min(A,(S+r)/I);for(let o=0;o<M;++o){const a=o-O,l=Math.max(0,Math.ceil(a/$)),c=Math.min(N,(k+a)/$);let u=0;for(let n=i;n<s;++n){const i=n*I-r;for(let r=l;r<c;++r){const s=U*t+V*n+j*r,o=v*(S-1-i)+x*(k-1-(r*$-a))+w*e;for(let t=0;t<C;++t){u+=y[s+W*t]*b[o+t]}}}g[L*t+F*n+z*o+B*e]=u}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Zy={kernelName:Rt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r;Mf([i,s],"conv3d");const c=Xa(i.shape,s.shape,o,l,a),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=c,y=g.front,b=g.left,v=g.top,x=new xi(c.outShape,i.dtype),w=n.data.get(i.dataId).values,_=n.data.get(s.dataId).values,S=x.values,k=D(i.shape),T=D(s.shape);for(let t=0;t<c.batchSize;++t){const e=t*k[0],n=t*x.strides[0];for(let t=0;t<c.outDepth;++t){const r=n+t*x.strides[1],i=t*c.strideDepth-y;for(let t=0;t<u;++t){const n=i+t*p;if(n<0||n>=c.inDepth)continue;const s=t*T[0],o=e+n*k[1];for(let t=0;t<c.outHeight;++t){const e=r+t*x.strides[2],n=t*c.strideHeight-v;for(let t=0;t<h;++t){const r=n+t*f;if(r<0||r>=c.inHeight)continue;const i=s+t*T[1],a=o+r*k[2];for(let t=0;t<c.outWidth;++t){const n=e+t*c.outChannels,r=t*c.strideWidth-b;for(let t=0;t<d;++t){const e=r+t*m;if(e<0||e>=c.inWidth)continue;const s=i+t*T[2],o=a+e*c.inChannels;let l=s;for(let t=0;t<c.inChannels;++t){const e=w[o+t];for(let t=0;t<c.outChannels;++t)S[n+t]+=e*_[l+t];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Jy={kernelName:Ot,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r;Mf([i,s],"conv3dBackpropFilterV2");const c=D(i.shape),u=D(s.shape),h=Xa(i.shape,l,o,1,a),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new xi(h.filterShape,"float32"),v=b.values,[x,w,_,S]=b.strides,k=n.data.get(s.dataId).values,[T,E,M,C]=u,A=n.data.get(i.dataId).values,[N,I,$,R]=c,O=h.padInfo.front,P=h.padInfo.left,L=h.padInfo.top;for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((O-t)/d)),n=Math.min(h.outDepth,(h.inDepth+O-t)/d),r=t*x;for(let i=0;i<g;++i){const s=Math.max(0,Math.ceil((L-i)/p)),o=Math.min(h.outHeight,(h.inHeight+L-i)/p),a=i*w+r;for(let r=0;r<y;++r){const l=Math.max(0,Math.ceil((P-r)/f)),c=Math.min(h.outWidth,(h.inWidth+P-r)/f),u=r*_+a;for(let a=0;a<h.inChannels;++a){const m=a*S+u;for(let u=0;u<h.outChannels;++u){let g=0;for(let m=0;m<h.batchSize;++m){const h=m*N,y=m*T;for(let m=e;m<n;++m){const e=(t+m*d-O)*I+h,n=m*E+y;for(let t=s;t<o;++t){const s=(i+t*p-L)*$+e,o=t*M+n;for(let t=l;t<c;++t){const e=t*C+o;g+=A[(r+t*f-P)*R+s+a]*k[e+u]}}}}v[m+u]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qy={kernelName:Pt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r;Mf([i],"conv3dBackpropInputV2");const c=D(i.shape),u=D(s.shape),h=Xa(l,s.shape,a,1,o),d=new xi(h.inShape,"float32"),p=d.values,[f,m,g,y]=d.strides,b=n.data.get(i.dataId).values,[v,x,w,_]=c,S=n.data.get(s.dataId).values,[k,T,E,M]=u,{batchSize:C,filterDepth:A,filterHeight:N,filterWidth:I,inChannels:$,inDepth:R,inHeight:O,inWidth:P,outChannels:L,outDepth:F,outHeight:z,outWidth:B,strideDepth:U,strideHeight:V,strideWidth:j}=h,W=A-1-h.padInfo.front,H=N-1-h.padInfo.top,G=I-1-h.padInfo.left;for(let t=0;t<C;++t)for(let e=0;e<$;++e)for(let n=0;n<R;++n){const r=n-W,i=Math.max(0,Math.ceil(r/U)),s=Math.min(F,(A+r)/U);for(let o=0;o<O;++o){const a=o-H,l=Math.max(0,Math.ceil(a/V)),c=Math.min(z,(N+a)/V);for(let u=0;u<P;++u){const h=u-G,d=Math.max(0,Math.ceil(h/j)),C=Math.min(B,(I+h)/j);let $=0;for(let n=i;n<s;++n){const i=n*U-r;for(let r=l;r<c;++r){const s=r*V-a;for(let o=d;o<C;++o){const a=v*t+x*n+w*r+_*o,l=k*(A-1-i)+T*(N-1-s)+E*(I-1-(o*j-h))+M*e;for(let t=0;t<L;++t){$+=b[a+t]*S[l+t]}}}}p[f*t+m*n+g*o+y*u+e]=$}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},tb=Jf(Lt,(t=>Math.cos(t))),eb={kernelName:Lt,backendName:"cpu",kernelFunc:tb},nb=Jf(Dt,(t=>Math.cosh(t))),rb={kernelName:Dt,backendName:"cpu",kernelFunc:nb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ib={kernelName:Bt,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[u,h,d,p]=i.shape,f=s.shape[0],[m,g]=a,y=eo([f,m,g,p],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,w=D(i.shape),_=D(y.shape);for(let t=0;t<f;t++){const e=4*t,n=b[e],r=b[e+1],i=b[e+2],s=b[e+3],o=v[t];if(o>=u)continue;const a=m>1?(i-n)*(h-1)/(m-1):0,f=g>1?(s-r)*(d-1)/(g-1):0;for(let e=0;e<m;e++){const u=m>1?n*(h-1)+e*a:.5*(n+i)*(h-1);if(u<0||u>h-1)for(let n=0;n<g;n++)for(let r=0;r<p;r++){const i=r+n*_[2]+e*_[1]+t*_[0];y.values[i]=c}else if("bilinear"===l){const n=Math.floor(u),i=Math.ceil(u),a=u-n;for(let l=0;l<g;l++){const u=g>1?r*(d-1)+l*f:.5*(r+s)*(d-1);if(u<0||u>d-1){for(let n=0;n<p;n++){const r=n+l*_[2]+e*_[1]+t*_[0];y.values[r]=c}continue}const h=Math.floor(u),m=Math.ceil(u),b=u-h;for(let r=0;r<p;r++){let s=r+h*w[2]+n*w[1]+o*w[0];const c=x[s];s=r+m*w[2]+n*w[1]+o*w[0];const u=x[s];s=r+h*w[2]+i*w[1]+o*w[0];const d=x[s];s=r+m*w[2]+i*w[1]+o*w[0];const p=c+(u-c)*b,f=d+(x[s]-d)*b;s=r+l*_[2]+e*_[1]+t*_[0],y.values[s]=p+(f-p)*a}}}else for(let n=0;n<g;++n){const i=g>1?r*(d-1)+n*f:.5*(r+s)*(d-1);if(i<0||i>d-1){for(let r=0;r<p;r++){const i=r+n*_[2]+e*_[1]+t*_[0];y.values[i]=c}continue}const a=Math.round(i),l=Math.round(u);for(let r=0;r<p;r++){const i=r+a*w[2]+l*w[1]+o*w[0],s=r+n*_[2]+e*_[1]+t*_[0];y.values[s]=x[i]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const sb={kernelName:Ft,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;Mf(i,"cumprod");const l=nc([s],i.shape.length);let c=i;null!=l&&(c=Zm({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=ic(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=$i(c.dtype,"int32"),d=B(f(c.shape),h),p=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],g=a?(t,e)=>t+m-e-1:(t,e)=>t+e;for(let t=0;t<p.length;t+=m)for(let e=0;e<m;e++){const n=g(t,e);if(0===e)d[n]=o?1:p[n];else{const r=g(t,e-1);d[n]=o?p[r]*d[r]:p[n]*d[r]}}const y=n.makeTensorInfo(c.shape,h,d);if(null!=l){const t=Zm({inputs:{x:y},backend:n,attrs:{perm:rc(l)}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(c),t}return y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ob={kernelName:zt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;Mf(i,"cumsum");const l=nc([s],i.shape.length);let c=i;null!=l&&(c=Zm({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=ic(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=$i(c.dtype,"int32"),d=U(f(c.shape),h),p=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],g=a?(t,e)=>t+m-e-1:(t,e)=>t+e;for(let t=0;t<p.length;t+=m)for(let e=0;e<m;e++){const n=g(t,e);if(0===e)d[n]=o?0:p[n];else{const r=g(t,e-1);d[n]=o?p[r]+d[r]:p[n]+d[r]}}const y=n.makeTensorInfo(c.shape,h,d);if(null!=l){const t=Zm({inputs:{x:y},backend:n,attrs:{perm:rc(l)}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(c),t}return y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ab={kernelName:Ut,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=Yf(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,t)}if(2===i.shape.length){const t=Kf(n.bufferSync(i),n.bufferSync(s),o,a);return n.makeTensorInfo(t.shape,s.dtype,t.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lb={kernelName:Vt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r;u("NHWC"===o,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`));const a=i.shape[0],l=i.shape[1],c=i.shape[2],h=i.shape[3],d=l*s,p=c*s,f=h/(s*s),m=n.data.get(i.dataId).values,g=new Float32Array(a*d*p*f);let y=0;for(let t=0;t<a;++t)for(let e=0;e<d;++e){const n=Math.floor(e/s),r=e%s;for(let e=0;e<p;++e){const i=Math.floor(e/s),o=(r*s+e%s)*f;for(let e=0;e<f;++e){const r=e+o+h*(i+c*(n+l*t));g[y++]=m[r]}}}return n.makeTensorInfo([a,d,p,f],i.dtype,g)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cb(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;Mf([i,s],"depthwiseConv2DNative");const h=D(i.shape),d=D(s.shape);let p=l;null==p&&(p=[1,1]),u(el(o,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`));const f=qa(i.shape,s.shape,o,p,a,c,!0),{filterHeight:m,filterWidth:g,dilationHeight:y,dilationWidth:b,padInfo:v}=f,x=v.left,w=v.top,_=f.outChannels/f.inChannels,S=new xi(f.outShape,i.dtype),k=n.data.get(i.dataId).values,T=n.data.get(s.dataId).values,E=S.values;for(let t=0;t<f.batchSize;++t){const e=t*h[0],n=t*S.strides[0];for(let t=0;t<f.outHeight;++t){const r=n+t*S.strides[1],i=t*f.strideHeight-w;for(let t=0;t<m;++t){const n=i+t*y;if(n<0||n>=f.inHeight)continue;const s=t*d[0],o=e+n*h[1];for(let t=0;t<f.outWidth;++t){const e=r+t*S.strides[2],n=t*f.strideWidth-x;for(let t=0;t<g;++t){const r=n+t*b;if(r<0||r>=f.inWidth)continue;const i=s+t*d[1],a=o+r*f.inChannels;let l=e,c=i;for(let t=0;t<f.inChannels;++t){const e=k[a+t];for(let t=0;t<_;++t)E[l+t]+=e*T[c+t];l+=_,c+=_}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const ub={kernelName:jt,backendName:"cpu",kernelFunc:cb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hb={kernelName:Wt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;Mf([i,s],"depthwiseConv2dNativeBackpropFilter");const h=qa(i.shape,u,o,a,l,c,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=h,g=new xi(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,x=n.data.get(i.dataId).values,w=new xi(i.shape,i.dtype,x),_=n.data.get(s.dataId).values,S=new xi(s.shape,s.dtype,_);for(let t=0;t<f;++t){const e=Math.max(0,Math.ceil((b-t)/d)),n=Math.min(h.outHeight,(h.inHeight+b-t)/d);for(let r=0;r<m;++r){const i=Math.max(0,Math.ceil((y-r)/p)),s=Math.min(h.outWidth,(h.inWidth+y-r)/p);for(let o=0;o<h.outChannels;++o){const a=Math.trunc(o/v),l=o%v;let c=0;for(let l=0;l<h.batchSize;++l)for(let u=e;u<n;++u){const e=t+u*d-b;for(let t=i;t<s;++t){const n=r+t*p-y;c+=w.get(l,e,n,a)*S.get(l,u,t,o)}}g.set(c,t,r,a,l)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const db={kernelName:Ht,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;Mf([i,s],"depthwiseConv2DNativeBackpropInput");const h=D(i.shape),d=D(s.shape),p=qa(u,s.shape,o,a,l,c,!0),f=new xi(p.inShape,"float32"),m=f.values,[g,y,b]=f.strides,v=n.data.get(i.dataId).values,[x,w,_]=h,S=n.data.get(s.dataId).values,[k,T,E]=d,{batchSize:M,filterHeight:C,filterWidth:A,inChannels:N,inHeight:I,inWidth:$,outChannels:R,outHeight:O,outWidth:P,strideHeight:L,strideWidth:F}=p,z=C-1-p.padInfo.top,B=A-1-p.padInfo.left,U=R/N;for(let t=0;t<M;++t)for(let e=0;e<N;++e)for(let n=0;n<I;++n){const r=n-z,i=Math.max(0,Math.ceil(r/L)),s=Math.min(O,(C+r)/L);for(let o=0;o<$;++o){const a=o-B,l=Math.max(0,Math.ceil(a/F)),c=Math.min(P,(A+a)/F);let u=0;for(let n=i;n<s;++n){const i=n*L-r;for(let r=l;r<c;++r){const s=x*t+w*n+_*r,o=k*(C-1-i)+T*(A-1-(r*F-a))+E*e;for(let t=0;t<U;++t){u+=v[s+(e*U+t)]*S[o+t]}}}m[g*t+y*n+b*o+e]=u}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const pb={kernelName:Gt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=f(r.shape),s=n.data.get(r.dataId).values,o=eo([i,i],r.dtype),a=o.values;for(let t=0;t<s.length;t++)a[t*i+t]=s[t];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,o.dtype,o.values)}},fb={kernelName:qt,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i}=t,{strides:s,pad:o,dilations:a}=n,l=e,c=l.data.get(r.dataId).values,u=r.shape.length,h=l.data.get(i.dataId).values,d=i.shape.length,{batchSize:p,inHeight:m,inWidth:g,inChannels:y,outHeight:b,outWidth:v,padInfo:x,strideHeight:w,strideWidth:_,filterHeight:S,filterWidth:T,dilationHeight:E,dilationWidth:M,outShape:C}=Wa(r.shape,i.shape,s,o,"NHWC",a),A=f(C),N=C.length,I=k(r.dtype,A);for(let t=0;t<p;++t)for(let e=0;e<b;++e){const n=e*w-x.top;for(let s=0;s<v;++s){const o=s*_-x.left;for(let a=0;a<y;++a){let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<S;++e){const s=n+e*E;if(s>=0&&s<m)for(let n=0;n<T;++n){const p=o+n*M;if(p>=0&&p<g){const o=W([t,s,p,a],u,D(r.shape)),f=W([e,n,a],d,D(i.shape)),m=c[o]+h[f];m>l&&(l=m)}}}I[W([t,e,s,a],N,D(C))]=l}}}return{dataId:l.write(ai(I,r.dtype),C,r.dtype),shape:C,dtype:r.dtype}}},mb={kernelName:Yt,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=z(r.shape,c.data.get(r.dataId).values),d=z(i.shape,c.data.get(i.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:_,filterWidth:S,dilationHeight:k,dilationWidth:T,outShape:E}=Wa(r.shape,i.shape,o,a,"NHWC",l);u(s.rank===E.length,(()=>`Error in Dilation2DBackpropFilter, dy must have the same rank as output ${E.length}, but got ${s.rank}`));const M=z(E,c.data.get(s.dataId).values),C=V(i.shape,i.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*x-v.top;for(let r=0;r<b;++r){const i=r*w-v.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=0,l=0;for(let e=0;e<_;++e){const r=n+e*k;if(r>=0&&r<f)for(let n=0;n<S;++n){const c=i+n*T;if(c>=0&&c<m){const i=h[t][r][c][s]+d[e][n][s];i>o&&(o=i,a=e,l=n)}}}C[a][l][s]+=M[t][e][r][s]}}}return{dataId:c.write(ai(C,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},gb={kernelName:Xt,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:o,pad:a,dilations:l}=n,c=e,h=z(r.shape,c.data.get(r.dataId).values),d=z(i.shape,c.data.get(i.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:_,filterWidth:S,dilationHeight:k,dilationWidth:T,outShape:E}=Wa(r.shape,i.shape,o,a,"NHWC",l);u(s.rank===E.length,(()=>`Error in Dilation2DBackpropInput, dy must have the same rank as output ${E.length}, but got ${s.rank}`));const M=z(E,c.data.get(s.dataId).values),C=V(r.shape,r.dtype);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*x-v.top;for(let r=0;r<b;++r){const i=r*w-v.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=n<0?0:n,l=i<0?0:i;for(let e=0;e<_;++e){const r=n+e*k;if(r>=0&&r<f)for(let n=0;n<S;++n){const c=i+n*T;if(c>=0&&c<m){const i=h[t][r][c][s]+d[e][n][s];i>o&&(o=i,a=r,l=c)}}}C[t][a][l][s]+=M[t][e][r][s]}}}return{dataId:c.write(ai(C,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function yb(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;let a;Mf(i,"sum"),a="bool"===i.dtype?Uf({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):Lf({inputs:{x:i},backend:n});const l=a.shape.length,c=w(s,a.shape),u=nc(c,l);let h=c,d=a;null!=u&&(d=Zm({inputs:{x:a},backend:n,attrs:{perm:u}}),h=ic(h.length,l)),ec("sum",h,d.shape.length);const[p,m]=Ql(d.shape,h);let g=Pf(n,p,$i(d.dtype,"int32"));const y=f(m),b=n.data.get(g.dataId).values,v=n.data.get(d.dataId).values;for(let t=0;t<b.length;++t){const e=t*y;let n=0;for(let t=0;t<y;++t)n+=v[e+t];b[t]=n}if(o){const t=g;g=iy({inputs:{x:g},backend:n,attrs:{shape:tc(g.shape,c)}}),n.disposeIntermediateTensorInfo(t)}return n.disposeIntermediateTensorInfo(a),null!=u&&n.disposeIntermediateTensorInfo(d),g}const bb={kernelName:$n,backendName:"cpu",kernelFunc:yb};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vb={kernelName:Zt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=Jp(i,s.length);tf(o.length,l,s);const{path:c,steps:u}=ef(a,l),h=u.length;let d=null,p=o.length;const f=[];for(let t=0;t<h;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=Qp(p,l[e]);let i;nf(t)?i=s[e]:(i=Zm({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);m(i.shape,o)||(i=iy({inputs:{x:i},backend:n,attrs:{shape:o}}),f.push(i)),null===d?d=i:(d=jm({inputs:{a:i,b:d},backend:n}),f.push(d))}t<h-1&&(c[t]>=0&&(d=yb({inputs:{x:d},backend:n,attrs:{axis:c[t]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const t of f)t!==d&&n.disposeIntermediateTensorInfo(t);return d}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xb={kernelName:Qt,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{dy:r,y:i}=e;Mf([r,i],"eluGrad");const s=new Float32Array(f(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let t=0;t<o.length;++t){const e=o[t];s[t]=e>=1?a[t]:a[t]*(e+1)}return n.makeTensorInfo(i.shape,"float32",s)}},wb=Jf(te,(t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+.3275911*n);return e*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),_b={kernelName:te,backendName:"cpu",kernelFunc:wb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Sb(t){const{inputs:e,backend:n,attrs:r}=t,{input:i}=e,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(u(-(o+1)<=s,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),l=o+s+1),a.splice(l,0,1),iy({inputs:{x:i},backend:n,attrs:{shape:a}})}const kb={kernelName:re,backendName:"cpu",kernelFunc:Sb},Tb=$f(((t,e)=>t/e)),Eb=jf(Kt,Tb),Mb={kernelName:Kt,backendName:"cpu",kernelFunc:Eb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Cb(t,e,n){const r=t.shape,i=r[0],s=r[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[i,s],u=f(c),h=S("float32",u),d=S("float32",u);for(let t=0;t<i;t++){const r=vg({inputs:{x:a},backend:n,attrs:{begin:[t,0],size:[1,s]}}),i=vg({inputs:{x:l},backend:n,attrs:{begin:[t,0],size:[1,s]}}),o=Rf({inputs:{real:r,imag:i},backend:n}),{real:c,imag:u}=Ab(o,e,n),p=Vp(c,u);for(let e=0;e<s;e++){const n=Gp(p,e);h[t*s+e]=n.real,d[t*s+e]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o)}const p=n.makeTensorInfo(c,"float32",h),m=n.makeTensorInfo(c,"float32",d),g=Rf({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}function Ab(t,e,n){const r=f(t.shape),i=n.data.get(t.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((a=r)&a-1)){const i=Nb(s,o,r,e,n),a=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(a,"float32",i.real),e=n.makeTensorInfo(a,"float32",i.imag),s=n.makeTensorInfo([],"float32",oi(r,"float32")),o=Lf({inputs:{x:s},backend:n}),l=Mb.kernelFunc({inputs:{a:t,b:s},backend:n}),c=Mb.kernelFunc({inputs:{a:e,b:o},backend:n}),u=n.data.get(l.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:h}}return i}{const t=function(t,e,n){const r=new Float32Array(2*e);for(let i=0;i<e;i++){let s=0,o=0;for(let r=0;r<e;r++){const a=Yp(i*r,e,n),l=Gp(t,r);s+=l.real*a.real-l.imag*a.imag,o+=l.real*a.imag+l.imag*a.real}n&&(s/=e,o/=e),qp(r,s,o,i)}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(Vp(s,o),r,e);return jp(t)}var a}function Nb(t,e,n,r,i){if(1===n)return{real:t,imag:e};const s=Vp(t,e),o=n/2,a=Wp(s),l=a.real,c=a.imag,u=[l.length],h=i.makeTensorInfo(u,"float32",l),d=i.makeTensorInfo(u,"float32",c),p=Rf({inputs:{real:h,imag:d},backend:i}),f=Hp(s),m=f.real,g=f.imag,y=[m.length],b=i.makeTensorInfo(y,"float32",m),v=i.makeTensorInfo(y,"float32",g),x=Rf({inputs:{real:b,imag:v},backend:i}),w=Nb(l,c,o,r,i),_=w.real,S=w.imag,k=[_.length],T=i.makeTensorInfo(k,"float32",_),E=i.makeTensorInfo(k,"float32",S),M=Rf({inputs:{real:T,imag:E},backend:i}),C=Nb(m,g,o,r,i),A=C.real,N=C.imag,I=[A.length],$=i.makeTensorInfo(I,"float32",A),R=i.makeTensorInfo(I,"float32",N),O=Rf({inputs:{real:$,imag:R},backend:i}),P=Xp(n,r),L=[P.real.length],D=i.makeTensorInfo(L,"float32",P.real),F=i.makeTensorInfo(L,"float32",P.imag),z=Rf({inputs:{real:D,imag:F},backend:i}),B=jm({inputs:{a:z,b:O},backend:i}),U=qf({inputs:{a:M,b:B},backend:i}),V=Fg({inputs:{a:M,b:B},backend:i}),j=Ff({inputs:{input:U},backend:i}),W=Ff({inputs:{input:V},backend:i}),H=jy({inputs:{input:U},backend:i}),G=jy({inputs:{input:V},backend:i}),q=Hy({inputs:[j,W],backend:i,attrs:{axis:0}}),X=Hy({inputs:[H,G],backend:i,attrs:{axis:0}}),Y=i.data.get(q.dataId).values,K=i.data.get(X.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(X),{real:Y,imag:K}}const Ib={kernelName:se,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=f(r.shape),s=r.shape[r.shape.length-1],o=iy({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=Cb(o,!1,n),l=iy({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function $b(t){const{backend:e,attrs:n}=t,{shape:r,value:i,dtype:s}=n,o=s||O(i),a=k(o,f(r));return function(t,e,n){t.fill(e)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(a,i),e.makeTensorInfo(r,o,a)}const Rb={kernelName:oe,backendName:"cpu",kernelFunc:$b};const Ob={kernelName:ae,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,i=n,s=S(r.dtype,f(r.shape)),[o,a,l,c]=r.shape,u=i.data.get(r.dataId).values;for(let t=0;t<o;t++){const e=t*l*a*c;for(let t=0;t<a;t++){const n=t*(l*c);for(let t=0;t<l;t++){const r=t*c;for(let i=0;i<c;i++){const o=Math.round(l-t-1),a=e+n+r+i;let h=u[a];if(o>=0&&o<l){h=u[e+n+o*c+i]}s[a]=h}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Pb=$f(((t,e)=>Math.floor(t/e))),Lb=jf(ce,Pb,null,"int32"),Db={kernelName:ce,backendName:"cpu",kernelFunc:Lb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Fb={kernelName:lr,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=qy({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const t=m;if("NCHW"===u&&1===o.shape.length&&1!==o.shape[0]){const t=iy({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=qf({inputs:{a:m,b:t},backend:n}),n.disposeIntermediateTensorInfo(t)}else m=qf({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(t)}if(p){const t=m;if("NCHW"===u&&"prelu"===p&&1===a.shape.length&&1!==a.shape[0]){const t=iy({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=ry(n,m,p,t,f),n.disposeIntermediateTensorInfo(t)}else m=ry(n,m,p,a,f);n.disposeIntermediateTensorInfo(t)}return m}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zb={kernelName:cr,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=cb({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const t=m;m=qf({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=m;m=ry(n,m,p,a,f),n.disposeIntermediateTensorInfo(t)}return m}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bb={kernelName:de,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=f(r.shape),o=i.shape,a=o[o.length-1],[l,c,u,h]=Zo(r,i);if(0===c)return n.makeTensorInfo(l,r.dtype,[]);const d=gm(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,c,a,u,h,r.shape,s);return n.makeTensorInfo(l,r.dtype,d.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ub={kernelName:he,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r;Mf([i,s],"gatherV2");const l=w(o,i.shape)[0],c=n.data.get(s.dataId).values,h=i.shape[l];for(let t=0;t<c.length;++t){const e=c[t];u(e<=h-1&&e>=0,(()=>`GatherV2: the index value ${e} is not in [0, ${h-1}]`))}let d=a;null==a&&(d=0);const p=f(s.shape),m=xf(i,s,l,d),g=iy({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),y=iy({inputs:{x:s},backend:n,attrs:{shape:[m.batchSize,p/m.batchSize]}}),b=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],v=n.bufferSync(y),x=ym(n.bufferSync(g),v,b);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vb={kernelName:ge,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=f(r.shape),s=r.shape[r.shape.length-1],o=iy({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),a=Cb(o,!0,n),l=iy({inputs:{x:a},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}},jb=Jf(be,(t=>Number.isFinite(t)?1:0),"bool"),Wb={kernelName:be,backendName:"cpu",kernelFunc:jb},Hb=Jf(ve,(t=>Math.abs(t)===1/0?1:0),"bool"),Gb={kernelName:ve,backendName:"cpu",kernelFunc:Hb},qb=Jf(xe,(t=>Number.isNaN(t)?1:0),"bool"),Xb={kernelName:xe,backendName:"cpu",kernelFunc:qb};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yb={kernelName:ke,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=Nm(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},Kb=Jf(Ee,(t=>Math.log1p(t))),Zb={kernelName:Ee,backendName:"cpu",kernelFunc:Kb},Jb=$f(((t,e)=>t&&e)),Qb=jf(Me,Jb,null,"bool"),tv={kernelName:Me,backendName:"cpu",kernelFunc:Qb},ev=Jf(Ce,(t=>t?0:1),"bool"),nv={kernelName:Ce,backendName:"cpu",kernelFunc:ev},rv=$f(((t,e)=>t||e)),iv=jf(Ae,rv,null,"bool"),sv={kernelName:Ae,backendName:"cpu",kernelFunc:iv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ov={kernelName:Ie,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r;Mf(i,"LRN");const c=i.shape[3],u=c-1,h=n.data.get(i.dataId).values,d=f(i.shape),p=new Float32Array(d);function m(t){const e=t%c;let n=t-e+Math.max(0,e-s);const r=t-e+Math.min(e+s,u);let i=0;for(;n<=r;n++){const t=h[n];i+=t*t}return i}for(let t=0;t<d;t++){const e=m(t),n=h[t]*Math.pow(o+a*e,-l);p[t]=n}return n.makeTensorInfo(i.shape,i.dtype,p)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const av={kernelName:$e,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r;Mf(o,"LRNGrad");const h=f(o.shape),d=o.shape[3],p=n.data.get(o.dataId).values,m=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,y=new Float32Array(h),b=h;for(let t=0;t<b;t++){const e=t%d,n=t-e+Math.max(0,e-a),r=t-e+Math.min(d,e+a+1);let i=0;for(let t=n;t<r;t++)i+=Math.pow(m[t],2);i=c*i+l;for(let e=n;e<r;e++){let n=-2*c*u*m[e]*g[t]/i;t===e&&(n+=Math.pow(i,-u)),n*=p[t],y[e]+=n}}return n.makeTensorInfo(o.shape,i.dtype,y)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lv(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=n;let l=i.shape;const c=l.length,u=w(s,l);let h=u;const d=nc(h,c);let p=a.data.get(i.dataId).values;if(null!=d){const t=new Array(c);for(let e=0;e<t.length;e++)t[e]=l[d[e]];p=Km(p,l,i.dtype,d,t),h=ic(h.length,c),l=t}Mf(i,"max"),ec("max",h,c);const[m,g]=Ql(l,h),y=Om(p,f(g),m,i.dtype),b=a.write(y,m,i.dtype);let v=m;if(o){v=tc(m,u)}return{dataId:b,shape:v,dtype:i.dtype}}const cv={kernelName:Re,backendName:"cpu",kernelFunc:lv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uv={kernelName:Pe,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;Mf(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;u(el(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=Ha(i.shape,s,o,1,a,l);let h;if(1===c.filterWidth&&1===c.filterHeight&&m(c.inShape,c.outShape))h=Lf({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=D(i.shape),r=Ay(t,i.shape,i.dtype,e,c,"max");h=n.makeTensorInfo(c.outShape,i.dtype,r.values)}return h}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hv={kernelName:De,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r;Mf(i,"maxPool3d");const u=Ga(i.shape,s,o,1,a,l,c),h=Iy(n.data.get(i.dataId).values,i.shape,i.dtype,D(i.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dv={kernelName:Fe,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=r;Mf([i,s],"maxPool3DGrad");const u=Ga(s.shape,o,a,1,l,c),h=function(t,e){const n=eo(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const b=y*r-d;let v=b;for(;v<0;)v+=o;const x=Math.min(e.inDepth,c+b);for(let r=0;r<e.outHeight;++r){const c=r*i-p;let d=c;for(;d<0;)d+=a;const w=Math.min(e.inHeight,u+c);for(let i=0;i<e.outWidth;++i){const p=i*s-f;let _=p;for(;_<0;)_+=l;const S=Math.min(e.inWidth,h+p);let k=Number.NEGATIVE_INFINITY,T=-1;for(let e=v;e<x;e+=o){const n=e-b;for(let r=d;r<w;r+=a){const i=r-c;for(let s=_;s<S;s+=l){const o=s-p,a=t.get(m,e,r,s,g);a>=k&&(k=a,T=n*u*h+i*u+o)}}}n.set(T,m,y,r,i,g)}}}return n}(n.bufferSync(s),u),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.dilationDepth,g=u.dilationHeight,y=u.dilationWidth,b=u.effectiveFilterDepth,v=u.effectiveFilterHeight,x=u.effectiveFilterWidth,w=b-1-u.padInfo.front,_=x-1-u.padInfo.left,S=v-1-u.padInfo.top,k=eo(s.shape,"float32"),T=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-w,o=r-S,a=i-_;let l=0;for(let n=0;n<b;n+=m){const r=(s+n)/d;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let i=0;i<v;i+=g){const s=(o+i)/p;if(!(s<0||s>=u.outHeight||Math.floor(s)!==s))for(let o=0;o<x;o+=y){const c=(a+o)/f;if(c<0||c>=u.outWidth||Math.floor(c)!==c)continue;const d=b*v*x-1-h.get(t,r,s,c,e)===n*v*x+i*x+o?1:0;if(0===d)continue;l+=T.get(t,r,s,c,e)*d}}}k.set(l,t,n,r,i,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const pv={kernelName:Le,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;Mf([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=Ha(a.shape,l,c,1,u,h),p=n.data.get(a.dataId).values,f=eo(d.outShape,a.dtype,Ny(p,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,x=d.effectiveFilterWidth,w=x-1-d.padInfo.left,_=v-1-d.padInfo.top,S=eo(a.shape,"float32"),k=n.data.get(i.dataId).values,T=eo(i.shape,"float32",k);for(let t=0;t<d.batchSize;++t)for(let e=0;e<d.inChannels;++e)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){const i=n-_,s=r-w;let o=0;for(let n=0;n<v;n+=y){const r=(i+n)/m;if(!(r<0||r>=d.outHeight||Math.floor(r)!==r))for(let i=0;i<x;i+=b){const a=(s+i)/g;if(a<0||a>=d.outWidth||Math.floor(a)!==a)continue;const l=v*x-1-f.get(t,r,a,e)===n*x+i?1:0;if(0===l)continue;o+=T.get(t,r,a,e)*l}}S.set(o,t,n,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const fv={kernelName:ze,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;Mf(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,u=Ha(r.shape,i,s,[1,1],o),[h,d]=function(t,e,n,r,i){const s=Ay(t,0,n,D(e),i,"max"),o=Ny(t,e,n,i,!0,r);return[s.values,o.values]}(c,r.shape,r.dtype,a,u),p=l.write(h,u.outShape,r.dtype),f=l.write(d,u.outShape,r.dtype);return[{dataId:p,shape:u.outShape,dtype:r.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mv={kernelName:Be,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=w(s,i.shape),l=f(Ql(i.shape,a)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const h=Uf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(h);const d=Eb({inputs:{a:h,b:u},backend:n});c.push(d);const p=yb({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:o}});return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gv={kernelName:Ue,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;Mf(i,"min");const a=w(s,i.shape);let l=a;const c=nc(l,i.shape.length);let u=i;null!=c&&(u=Zm({inputs:{x:i},backend:n,attrs:{perm:c}}),l=ic(l.length,i.shape.length)),ec("min",l,u.shape.length);const[h,d]=Ql(u.shape,l),p=f(d),m=U(f(h),u.dtype),g=n.data.get(u.dataId).values;for(let t=0;t<m.length;++t){const e=t*p;let n=g[e];for(let t=0;t<p;++t){const r=g[e+t];(Number.isNaN(r)||r<n)&&(n=r)}m[t]=n}null!=c&&n.disposeIntermediateTensorInfo(u);const y=n.makeTensorInfo(h,u.dtype,m);if(o){const t=iy({inputs:{x:y},backend:n,attrs:{shape:tc(h,a)}});return n.disposeIntermediateTensorInfo(y),t}return y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yv={kernelName:je,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,mode:o}=r;Mf(i,"mirrorPad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),c=s.map(((t,e)=>t[0]+i.shape[e])),u="reflect"===o?0:1,h=n.data.get(i.dataId).values,d=i.shape.length,p=D(i.shape),m=f(a),g=a.length,y=D(a),b=S(i.dtype,m);for(let t=0;t<m;t++){let e=H(t,g,y);for(let t=0;t<g;t++)e[t]<l[t]?e[t]=2*l[t]-e[t]-u:e[t]>=c[t]&&(e[t]=2*(c[t]-1)-e[t]+u);e=e.map(((t,e)=>t-l[e]));const n=W(e,d,p);b[t]=h[n]}return{dataId:n.write(b,a,i.dtype),shape:a,dtype:i.dtype}}},bv=$f(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),vv=jf(We,bv),xv={kernelName:We,backendName:"cpu",kernelFunc:vv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function wv(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=i.shape.length;let a=s;if(-1===a&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=w([a],i.shape),c=lv({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=tc(c.shape,l),h=iy({inputs:{x:c},backend:n,attrs:{shape:u}}),d=Fg({inputs:{a:i,b:h},backend:n}),p=lm({inputs:{x:d},backend:n}),f=yb({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=iy({inputs:{x:f},backend:n,attrs:{shape:u}}),g=Eb({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const _v={kernelName:Pn,backendName:"cpu",kernelFunc:wv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Sv={kernelName:He,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r;Mf(i,"multinomial");const l=a?i:wv({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,d=[c,s],p=U(f(d),"int32");for(let t=0;t<c;++t){const e=t*u,n=new Float32Array(u-1);n[0]=h[e];for(let t=1;t<n.length;++t)n[t]=n[t-1]+h[e+t];const r=zu.alea(o.toString()),i=t*s;for(let t=0;t<s;++t){const e=r();p[i+t]=n.length;for(let r=0;r<n.length;r++)if(e<n[r]){p[i+t]=r;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}},kv=bd;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Tv={kernelName:Ye,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;Mf(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:h}=kv(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},Ev=vd;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Mv={kernelName:Ke,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Mf(i,"NonMaxSuppressionPadded");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:d,validOutputs:p}=Ev(u,h,o,a,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Cv=xd;
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Av={kernelName:Ze,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Mf(i,"NonMaxSuppressionWithScore");const u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,d=o,p=a,f=l,m=c,{selectedIndices:g,selectedScores:y}=Cv(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Nv={kernelName:Qe,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:l}=r;Mf(i,"oneHot");const c=f(i.shape),u=new Float32Array(c*o);u.fill(l);const h=n.data.get(i.dataId).values;for(let t=0;t<c;++t)h[t]>=0&&h[t]<o&&(u[t*o+h[t]]=a);return n.makeTensorInfo([...i.shape,o],s,u)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Iv(t){const{inputs:e,backend:n}=t,{x:r}=e;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const t=Ff({inputs:{input:r},backend:n}),e=Iv({inputs:{x:t},backend:n}),i=jy({inputs:{input:r},backend:n}),s=Iv({inputs:{x:i},backend:n}),o=Rf({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return $b({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const $v={kernelName:rr,backendName:"cpu",kernelFunc:Iv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Rv={kernelName:Je,backendName:"cpu",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const e=Ff({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=jy({inputs:{input:i},backend:r}),o=Iv({inputs:{x:s},backend:r}),a=Rf({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return $b({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ov(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return Sb({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{h(s,t.shape,"All tensors passed to stack must have matching shapes"),u(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],l=Hy({inputs:e.map((t=>{const e=Sb({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}const Pv={kernelName:tn,backendName:"cpu",kernelFunc:Ov};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Lv={kernelName:en,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;Mf(i,"pad");const a=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),c=n.data.get(i.dataId).values,u=f(i.shape),h=i.shape.length,d=D(i.shape),p=f(a),m=a.length,g=D(a),y=S(i.dtype,p);0!==o&&y.fill(o);for(let t=0;t<u;t++){y[W(H(t,h,d).map(((t,e)=>t+l[e])),m,g)]=c[t]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}},Dv=$f(((t,e)=>Math.pow(t,e))),Fv=jf(nn,Dv),zv={kernelName:nn,backendName:"cpu",kernelFunc:Fv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bv={kernelName:on,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,a=i.map((t=>n.data.get(t.dataId).values)),l=i.map((t=>t.shape)),c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values,[h,d,p]=ig(a,l,c,s.shape,s.dtype,u,o.shape),f=h.map((t=>n.makeTensorInfo([t.length],"int32",t))),m=n.makeTensorInfo(p,s.dtype,d);return f.concat([m])}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Uv={kernelName:an,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,h=n.data.get(o.dataId).values,d=a.map((t=>n.data.get(t.dataId).values)),p=a.map((t=>t.shape)),[f,m]=cg(c,i.shape,u,s.shape,s.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vv={kernelName:ln,backendName:"cpu",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,dtype:s,step:o}=n,a=ug(r,i,o,s);return e.makeTensorInfo([a.length],s,a)}},jv=Jf(un,(t=>1/t)),Wv={kernelName:un,backendName:"cpu",kernelFunc:jv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hv={kernelName:mn,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;Mf(i,"resizeBilinear");const l=D(i.shape),[c,u]=a,[h,d,p,m]=i.shape,g=n.data.get(i.dataId).values,y=new Float32Array(f([h,c,u,m])),b=[s&&c>1?d-1:d,s&&u>1?p-1:p],v=[s&&c>1?c-1:c,s&&u>1?u-1:u];let x=0;const w=b[0]/v[0],_=b[1]/v[1];for(let t=0;t<h;t++)for(let e=0;e<c;e++){let n;n=o?w*(e+.5)-.5:w*e;const r=Math.max(0,Math.floor(n)),i=n-r,s=Math.min(d-1,Math.ceil(n)),a=t*l[0]+r*l[1],c=t*l[0]+s*l[1];for(let t=0;t<u;t++){let e;e=o?_*(t+.5)-.5:_*t;const n=Math.max(0,Math.floor(e)),r=e-n,s=Math.min(p-1,Math.ceil(e)),u=a+n*l[2],h=c+n*l[2],d=a+s*l[2],f=c+s*l[2];for(let t=0;t<m;t++){const e=g[u+t],n=g[h+t],s=e+(g[d+t]-e)*r,o=s+(n+(g[f+t]-n)*r-s)*i;y[x++]=o}}}return n.makeTensorInfo([h,c,u,m],"float32",y)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Gv={kernelName:gn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;Mf([s,i],"resizeBilinearGrad");const a=D(i.shape),[l,c,u,h]=i.shape,[,d,p]=s.shape,f=new Float32Array(l*c*u*h),m=[o&&d>1?c-1:c,o&&p>1?u-1:u],g=[o&&d>1?d-1:d,o&&p>1?p-1:p],y=m[0]/g[0],b=m[1]/g[1],v=n.data.get(s.dataId).values;let x=0;for(let t=0;t<l;t++){const e=t*a[0];for(let t=0;t<d;t++){const n=t*y,r=Math.floor(n),i=Math.min(Math.ceil(n),c-1),s=e+r*a[1],o=e+i*a[1],l=n-r,d=1-l;for(let t=0;t<p;t++){const e=t*b,n=Math.floor(e),r=Math.min(Math.ceil(e),u-1),i=e-n,c=1-i,p=s+n*a[2],m=s+r*a[2],g=o+n*a[2],y=o+r*a[2],w=d*c,_=d*i,S=l*c,k=l*i;for(let t=0;t<h;t++){const e=v[x++];f[p+t]+=e*w,f[m+t]+=e*_,f[g+t]+=e*S,f[y+t]+=e*k}}}}return n.makeTensorInfo([l,u,c,h],"float32",f)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const qv={kernelName:pn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r;Mf(i,"resizeNearestNeighbor");const l=D(i.shape),[c,u]=a,[h,d,p,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(h*c*u*f),y=[s&&c>1?d-1:d,s&&u>1?p-1:p],b=[s&&c>1?c-1:c,s&&u>1?u-1:u],v=y[0]/b[0],x=y[1]/b[1];let w=0;for(let t=0;t<h;t++){const e=t*l[0];for(let t=0;t<c;t++){const n=o?v*(t+.5):v*t;let r=Math.min(d-1,s?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const i=e+r*l[1];for(let t=0;t<u;t++){const e=o?x*(t+.5):x*t;let n=Math.min(p-1,s?Math.round(e):Math.floor(e));o&&(n=Math.max(0,n));const r=i+n*l[2];for(let t=0;t<f;t++){const e=m[r+t];g[w++]=e}}}}return n.makeTensorInfo([h,c,u,f],i.dtype,g)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Xv={kernelName:fn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r;Mf([s,i],"resizeNearestNeighborGrad");const a=D(i.shape),l=D(s.shape),[c,u,h,d]=i.shape,[,p,f]=s.shape,m=new Float32Array(c*u*h*d),g=n.data.get(s.dataId).values,y=[o&&p>1?u-1:u,o&&f>1?h-1:h],b=[o&&p>1?p-1:p,o&&f>1?f-1:f],v=y[0]/b[0],x=y[1]/b[1],w=1/v,_=1/x,S=2*Math.ceil(w)+2,k=2*Math.ceil(_)+2;for(let t=0;t<c;t++){const e=t*a[0];for(let t=0;t<u;t++){const n=e+t*a[1],r=Math.floor(t*w),i=Math.floor(r-S/2);for(let r=0;r<h;r++){const s=n+r*a[2],c=Math.floor(r*_),y=Math.floor(c-k/2);for(let n=0;n<d;n++){let a=0;for(let s=0;s<S;s++){const c=s+i;if(c<0||c>=p)continue;const d=e+c*l[1],m=c*v;if(t===Math.min(u-1,o?Math.round(m):Math.floor(m)))for(let t=0;t<k;t++){const e=t+y;if(e<0||e>=f)continue;const i=d+e*l[2],s=e*x;r===Math.min(h-1,o?Math.round(s):Math.floor(s))&&(a+=g[i+n])}}m[s+n]=a}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Yv={kernelName:bn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r;Mf(i,"reverse");const o=i.shape.length,a=w(s,i.shape);if(0===o)return Lf({inputs:{x:i},backend:n});const l=new xi(i.shape,i.dtype),c=n.bufferSync(i);for(let t=0;t<l.size;t++){const e=l.indexToLoc(t),n=e.slice();a.forEach((t=>n[t]=i.shape[t]-1-n[t])),l.set(c.get(...n),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},Kv={kernelName:or,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=S(r.dtype,f(r.shape)),[c,u,h,d]=r.shape,[p,m]=Cp(o,u,h),g=Math.sin(i),y=Math.cos(i),b=a.data.get(r.dataId).values;for(let t=0;t<c;t++){const e=t*h*u*d;for(let t=0;t<u;t++){const n=t*(h*d);for(let r=0;r<h;r++){const i=r*d;for(let o=0;o<d;o++){const a=[c,t,r,o],f=a[2],v=a[1];let x=(f-p)*y-(v-m)*g,w=(f-p)*g+(v-m)*y;x=Math.round(x+p),w=Math.round(w+m);let _=s;if("number"!=typeof s&&(_=3===o?255:s[o]),x>=0&&x<h&&w>=0&&w<u){_=b[e+w*(h*d)+x*d+o]}l[e+n+i+o]=_}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Zv=Jf(vn,(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1})),Jv={kernelName:vn,backendName:"cpu",kernelFunc:Zv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qv={kernelName:wn,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=ea(0,i,o),d=fg(n.bufferSync(i),n.bufferSync(s),o,h,c,l,a,u,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tx(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<e?n=i+1:r=i;return r}function ex(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<=e?n=i+1:r=i;return r}const nx={kernelName:_n,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=function(t,e,n,r,i,s){const o=k("int32",n*i);for(let a=0;a<n;++a){const n=t.slice(a*r,(a+1)*r),l=a*i;for(let t=0;t<i;++t)o[l+t]="left"===s?tx(n,e[t+l]):ex(n,e[t+l])}return o}(n.data.get(i.dataId).values,n.data.get(s.dataId).values,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",a)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rx={kernelName:Sn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e;Mf([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=$i(i.dtype,s.dtype),h=U(f(i.shape),u);let d=0;const p=0===o||o>1||1===i.shape.length?1:f(i.shape.slice(1));for(let t=0;t<a.length;t++)for(let e=0;e<p;e++)1===a[t]?h[d++]=l[t]:h[d++]=c[t];return n.makeTensorInfo(i.shape,u,h)}},ix=Jf(kn,(t=>t>=0?1.0507009873554805*t:1.7580993408473768*(Math.exp(t)-1))),sx={kernelName:kn,backendName:"cpu",kernelFunc:ix},ox=Jf(Cn,(t=>t<0?-1:t>0?1:0)),ax={kernelName:Cn,backendName:"cpu",kernelFunc:ox},lx=Jf(En,(t=>Math.sin(t))),cx={kernelName:En,backendName:"cpu",kernelFunc:lx},ux=Jf(Mn,(t=>Math.sinh(t))),hx={kernelName:Mn,backendName:"cpu",kernelFunc:ux},dx=Math.log(1.1920928955078125e-7)+2,px=Jf(Nn,(t=>{const e=t>-dx,n=t<dx,r=Math.exp(t);let i;return i=n?r:e?t:Math.log(1+r),i})),fx={kernelName:Nn,backendName:"cpu",kernelFunc:px};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mx={kernelName:Rn,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;Mf([i],"spaceToBatchND");const a=f(s),l=[[0,0]];l.push(...o);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const c=Lv.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),u=Ap(c.shape,s,a,!1),h=Np(u.length,s.length,!1),d=Ip(c.shape,s,a,!1),p=iy({inputs:{x:c},backend:n,attrs:{shape:u}}),m=Zm({inputs:{x:p},backend:n,attrs:{perm:h}}),g=iy({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gx={kernelName:Ln,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n        ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[h,d,p,f,m]=wg(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yx={kernelName:Dn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[c,u,h]=_g(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bx={kernelName:Fn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=Sg(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vx={kernelName:zn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[c,u]=Sg(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xx={kernelName:Bn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=ea(0,i,a),p=!1,f=n.bufferSync(i);let m;switch(s.dtype){case"bool":m=fg(f,n.bufferSync(s),a,d,u,c,l,h,Boolean(n.data.get(o.dataId).values[0]),p);break;case"float32":m=fg(f,n.bufferSync(s),a,d,u,c,l,h,n.data.get(o.dataId).values[0],p);break;case"int32":m=fg(f,n.bufferSync(s),a,d,u,c,l,h,n.data.get(o.dataId).values[0],p);break;case"string":m=fg(f,n.bufferSync(s),a,d,u,c,l,h,ui(n.data.get(o.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const wx={kernelName:On,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=w(o,i.shape)[0],l=sf(i,s,a),c=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map((t=>{const e=[...u];e[a]=t;const r=vg({inputs:{x:i},backend:n,attrs:{begin:c,size:e}});return c[a]+=t,r}))}},_x={kernelName:Vn,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;Mf(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let t=0;t<i.length;++t){const e=i[t];s[t]=e*e}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},Sx=Jf(ir,((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha})),kx={kernelName:ir,backendName:"cpu",kernelFunc:Sx};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Tx={kernelName:jn,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r;Mf(i,"stridedSlice");const{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:v,end:x,strides:w}=ga(i.shape,s,o,a,l,c,h,d,p);let _;if(g)_=iy({inputs:{x:i},backend:n,attrs:{shape:m}});else if(y||b){u(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=ia(v,x,w),e=vg({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});_=iy({inputs:{x:e},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(e)}else{const t=Ng(f,n.bufferSync(i),w,v);_=n.makeTensorInfo(m,t.dtype,t.values)}return _}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ex={kernelName:Wn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,d=n.data.get(u.dataId).values,p=n.data.get(h.dataId).values,[f,m]=$g(d,p,i,s,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Mx={kernelName:Hn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values[0],[c,u,h]=Og(a,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Cx={kernelName:Gn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=Pg(n.data.get(s.dataId).values,i);return n.makeTensorInfo(s.shape,"int32",o)}},Ax=Jf(Xn,(t=>Math.tan(t))),Nx={kernelName:Xn,backendName:"cpu",kernelFunc:Ax},Ix=Jf(Yn,(t=>Math.tanh(t)));
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $x={kernelName:Kn,backendName:"cpu",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;Mf(i,"tile");const o=Bg(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Rx={kernelName:Zn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r;Mf(i,"topk");const a=n.data.get(i.dataId).values,[l,c]=jg(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ox={kernelName:Jn,backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[u,h,d,p]=i.shape,[m,g]=null!=c?c:[h,d],y=[u,m,g,p],b=D(i.shape),v=b[0],x=b[1],w=b[2],_=D(y),k=_[0],T=_[1],E=_[2],M=S(i.dtype,f(y));M.fill(l);const C=r.data.get(i.dataId).values,A=r.data.get(s.dataId).values;for(let t=0;t<u;++t){const e=1===s.shape[0]?A:A.subarray(8*t,8*t+8);for(let n=0;n<m;++n)for(let r=0;r<g;++r)for(let i=0;i<p;++i){let s;const c=e[6]*r+e[7]*n+1;if(0===c)continue;const u=(e[0]*r+e[1]*n+e[2])/c,p=(e[3]*r+e[4]*n+e[5])/c,f=Px(u,d,a),m=Px(p,h,a);switch(o){case"nearest":s=Dx(C,h,d,v,x,w,t,m,f,i,l);break;case"bilinear":s=Fx(C,h,d,v,x,w,t,m,f,i,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}M[t*k+n*T+r*E+i]=s}return r.makeTensorInfo(y,i.dtype,M)}return{dataId:r.write(M,y,i.dtype),shape:i.shape,dtype:i.dtype}}};function Px(t,e,n){switch(n){case"reflect":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=2*e;n<t&&(n=t*Math.trunc(-n/t)+n),n=n<-e?n+t:-n-1}else if(n>e-1)if(e<=1)n=0;else{const t=2*e;n-=t*Math.trunc(n/t),n>=e&&(n=t-n-1)}return o(0,n,e-1)}(t,e);case"wrap":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=e-1;n+=e*(Math.trunc(-n/t)+1)}else if(n>e-1)if(e<=1)n=0;else{const t=e-1;n-=e*Math.trunc(n/t)}return o(0,n,e-1)}(t,e);case"nearest":return function(t,e){return o(0,t,e-1)}(t,e);default:return function(t,e){return t}(t)}}function Lx(t,e,n,r,i,s,o,a,l,c,u){return 0<=a&&a<e&&0<=l&&l<n?t[o*r+a*i+l*s+c]:u}function Dx(t,e,n,r,i,s,o,a,l,c,u){return Lx(t,e,n,r,i,s,o,Math.round(a),Math.round(l),c,u)}function Fx(t,e,n,r,i,s,o,a,l,c,u){const h=Math.floor(a),d=Math.floor(l),p=h+1,f=d+1;return(p-a)*((f-l)*Lx(t,e,n,r,i,s,o,h,d,c,u)+(l-d)*Lx(t,e,n,r,i,s,o,h,f,c,u))+(a-h)*((f-l)*Lx(t,e,n,r,i,s,o,p,d,c,u)+(l-d)*Lx(t,e,n,r,i,s,o,p,f,c,u))}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zx={kernelName:tr,backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;Mf(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:c}=Wg(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bx={kernelName:er,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],l=new Array(o-1);let c=0;for(let t=0;t<o;t++)t!==s&&(l[c++]=i.shape[t]);const u=new Array(o).fill(0),h=i.shape.slice();h[s]=1;const d=new Array(a);for(let t=0;t<d.length;t++){u[s]=t;const e=vg({inputs:{x:i},backend:n,attrs:{begin:u,size:h}});d[t]=iy({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Ux={kernelName:nr,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r;Mf(i,"unsortedSegmentSum");const a=[],l=[],c=i.shape.length-s.shape.length;let u=s;for(let t=0;t<c;++t){const e=Sb({inputs:{input:u},backend:n,attrs:{dim:t+1}});u=e,l.push(e)}for(let t=0;t<o;++t){const e=oi(t,"int32"),r=n.makeTensorInfo([],"int32",e),s=sm({inputs:{a:r,b:u},backend:n}),o=Uf({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),c=jm({inputs:{a:o,b:i},backend:n}),h=yb({inputs:{x:c},backend:n,attrs:{axis:0,keepDims:!1}});a.push(h),l.push(r),l.push(s),l.push(o),l.push(c),l.push(h)}const h=Ov({inputs:a,backend:n,attrs:{axis:0}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},Vx=[ly,If,uy,dy,Xf,py,fy,my,gy,yy,vy,wy,Sy,Ey,Cy,$y,Ry,Oy,Py,ay,Ly,Dy,Fy,zy,Vf,nm,Uy,Of,Vy,Gy,Xy,Yy,Ky,Zy,Jy,Qy,eb,rb,ib,sb,ob,ab,lb,ub,hb,db,pb,fb,mb,gb,vb,qg,xb,om,_b,cm,kb,dm,Ib,Rb,Ob,mm,Db,Fb,zb,Bb,Ub,xm,Sm,Df,Vb,Wy,Wb,Gb,Xb,Yg,Em,Am,Yb,Rm,Zb,tv,nv,sv,ov,av,cv,Dm,uv,hv,dv,pv,fv,mv,gv,Bm,yv,xv,Sv,Wm,Gm,Tv,Mv,Av,Ym,Nv,Rv,Pv,Lv,zv,Jg,tg,Bv,Uv,Vv,zf,Mb,Wv,ty,ny,sy,Hv,Gv,qv,Xv,Yv,Kv,Jv,pg,Qv,nx,rx,sx,yg,ax,cx,hx,xg,_v,fx,mx,gx,yx,bx,vx,xx,wx,Eg,_x,Ag,kx,Tx,Ex,Mx,Cx,zg,bb,Nx,{kernelName:Yn,backendName:"cpu",kernelFunc:Ix},$x,Rx,Ox,Jm,zx,Bx,Ux,$v];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const t of Vx)gr(t);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const jx={},Wx={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Hx(t,e){if(!(t in jx)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t):e;n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete jx[t]}),!1),K().getBool("SOFTWARE_WEBGL_ENABLED")&&(Wx.failIfMajorPerformanceCaveat=!1);if(1===t)return n.getContext("webgl",Wx)||n.getContext("experimental-webgl",Wx);return n.getContext("webgl2",Wx)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;jx[t]=n}const n=jx[t];return null==n||n.isContextLost()?(delete jx[t],Hx(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),jx[t])}var Gx,qx,Xx;function Yx(t,e){return[e,t]}function Kx(t){const e=f(t);return y(Math.ceil(e/4))}function Zx(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Jx(t,e){const n=t;let r,i,s,o,a,l,c,u,h,d;return 2===K().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=t.RGBA,i=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,h=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Qx(t,e){const n=e();return K().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Gx||(Gx={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(qx||(qx={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xx||(Xx={}));function tw(t){return!!(K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function ew(t,e){return uw(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}const nw=/ERROR: [0-9]+:([0-9]+):/g;function rw(t,e){const n=nw.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const r=+n[1],i=t.split("\n"),s=i.length.toString().length+2,o=i.map(((t,e)=>b((e+1).toString(),s)+t));let a=0;for(let t=0;t<o.length;t++)a=Math.max(o[t].length,a);const l=o.slice(0,r-1),c=o.slice(r-1,r),u=o.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${b(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function iw(t,e){if(Qx(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function sw(t,e,n,r,i,s,o){const a=t.getAttribLocation(e,n);return-1!==a&&(Qx(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),Qx(t,(()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,s,o))),Qx(t,(()=>t.enableVertexAttribArray(a))),!0)}function ow(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),Qx(t,(()=>t.activeTexture(t.TEXTURE0+n))),Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function aw(t,e,n){Qx(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),Qx(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function lw(t,e){Qx(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),Qx(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function cw(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function uw(t,e,n){const r=Qx(t,(()=>e()));if(null==r)throw new Error(n);return r}function hw(t,e=2){return f(t.slice(0,t.length-e))}function dw(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function pw(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[hw(t),...dw(t)]),e}function fw(t){return t%2==0}function mw(t,e){if(m(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(fw(n)&&fw(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&fw(t[0])&&fw(e[0])}let gw,yw;function bw(t,e){return null!=t.getExtension(e)}function vw(t){try{if(null!=Hx(t))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function xw(t){if(0===t)return!1;const e=Hx(t);if(1!==t){if(bw(e,"EXT_color_buffer_float"))return ww(e);const t="EXT_color_buffer_half_float";if(bw(e,t)){const n=e.getExtension(t);return function(t,e){const n=Jx(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,s=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}(e,n)}return!1}if(!bw(e,"OES_texture_float"))return!1;if(!bw(e,"WEBGL_color_buffer_float"))return!1;return ww(e)}function ww(t){const e=Jx(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function _w(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&u("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Sw=K();
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function kw(){let t,e,n,r,i,s,o,a,l,c;return 2===K().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=K().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Tw(t,e,n="index"){const r=D(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / ${e}`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${e}`:`index -= ${t[i]} * ${e}`};`)).join("")}function Ew(t,e,n="index"){const r=D(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / outShapeStrides[${i}]`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`};`)).join("")}function Mw(t,e,n="index"){const r=t.map(((t,e)=>e)),i=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),i=new Array(n-1);i[n-2]=r[n-1];for(let t=n-3;t>=0;--t)i[t]=`(${i[t+1]} * ${r[t+1]})`;return i}(r,e);return i.map(((e,r)=>`${`int ${t[r]} = ${n} / ${i[r]}`}; ${r===i.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${i[r]}`:`index -= ${t[r]} * ${i[r]}`};`)).join("")}function Cw(t){const e=D(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}Sw.registerFlag("HAS_WEBGL",(()=>Sw.getNumber("WEBGL_VERSION")>0)),Sw.registerFlag("WEBGL_VERSION",(()=>vw(2)?2:vw(1)?1:0)),Sw.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Sw.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Sw.get("WEBGL_VERSION"))),Sw.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Sw.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Sw.registerFlag("WEBGL_PACK",(()=>Sw.getBool("HAS_WEBGL"))),Sw.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_CLIP",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_PACK_REDUCE",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_CONV_IM2COL",(()=>Sw.getBool("WEBGL_PACK"))),Sw.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==gw){const e=Hx(t);gw=e.getParameter(e.MAX_TEXTURE_SIZE)}return gw}(Sw.getNumber("WEBGL_VERSION")))),Sw.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==yw){const e=Hx(t);yw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,yw)}(Sw.getNumber("WEBGL_VERSION")))),Sw.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=Sw.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=Hx(t);return e=bw(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:bw(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),Sw.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Sw.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!qi())),Sw.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=Hx(t);if(1===t){if(!bw(e,"OES_texture_float"))return!1}else if(!bw(e,"EXT_color_buffer_float"))return!1;return ww(e)}(Sw.getNumber("WEBGL_VERSION")))),Sw.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Sw.getBool("WEBGL_FORCE_F16_TEXTURES")&&Sw.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Sw.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>xw(Sw.getNumber("WEBGL_VERSION")))),Sw.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=Sw.getNumber("WEBGL_VERSION"))&&null!=Hx(t).fenceSync;var t})),Sw.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Sw.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Sw.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),Sw.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>qi()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),Sw.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Sw.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Sw.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Sw.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),Sw.registerFlag("WEBGL_EXP_CONV",(()=>!1)),Sw.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>Sw.getBool("IS_TEST"))),Sw.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),Sw.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),Sw.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1));const Aw="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:Nw}=kf;
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Iw(t,e,n){const r=[];if(t.forEach((t=>{const e=f(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=Vw(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const i=r.join("\n"),s=t.map((t=>function(t,e,n=!1,r){let i="";i+=n?Rw(t,r):$w(t,r);const s=t.shapeInfo.logicalShape,o=e.logicalShape;s.length<=o.length&&(i+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=Nw(t.shapeInfo.logicalShape,e.logicalShape),l=Uw(o),c=o-s;let u;const h=["x","y","z","w","u","v"];u=0===s?"":o<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${h[t+c]} = 0;`)).join("\n");let d="";d=o<2&&s>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${h[e+c]}`)).join(", ");let p="return outputValue;";const m=1===f(t.shapeInfo.logicalShape),g=1===f(e.logicalShape);if(1!==s||m||g){if(m&&!g)p=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=s-2,e=s-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?p="return vec4(outputValue.x);":a.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${l} coords = getOutputCoords();\n      ${u}\n      vec4 outputValue = get${r}(${d});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&null==t.shapeInfo.flatOffset&&m(o,s))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=Uw(l),u=Nw(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const p=["x","y","z","w","u","v"];d=0===a?"":l<2&&u.length>=1?"coords = 0;":u.map((t=>`coords.${p[t+h]} = 0;`)).join("\n");let f="";f=l<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+h]}`)).join(", ");return`\n    float ${i}() {\n      ${c} coords = getOutputCoords();\n      ${d}\n      return get${r}(${f});\n    }\n  `}(t,e));return i}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=e.texShape,a=kw(),l=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(a);let c,u,h=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${Ow}\n    ${Pw}\n    ${Lw}\n  `}(a);e.isPacked?(c=function(t,e,n){switch(t.length){case 0:return Fw();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(m(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),s=i*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),s=i*Math.ceil(t[t.length-2]/2);let o=s,a="",l="b, r, c";for(let e=2;e<t.length-1;e++)o*=t[t.length-e-1],a=`\n      int b${e} = index / ${o};\n      index -= b${e} * ${o};\n    `+a,l=`b${e}, `+l;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${t.length}(${l});\n    }\n  `}(t,e,n)}}(e.logicalShape,o,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(a)):(c=function(t,e,n){switch(t.length){case 0:return Fw();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(m(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${Ew(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=Tw(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${Ew(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=Tw(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=Tw(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=Tw(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,o,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(a)),n.packedInputs&&(h+=Dw);return[h,l,u,i,c,s,n.userCode].join("\n")}function $w(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=t.shapeInfo.texShape;if(1===i&&1===s)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=zw(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[a,l]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${a}, ${l}, ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${Bw(t)}\n      }\n    `;const i=t.shapeInfo.texShape,s=i[0],o=i[1];if(1===o&&1===s)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=zw(n);if(1===o)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===s)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape;if(null!=s&&m(n,s)){if(e)return`\n      float ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=s[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:o,keptDims:a}=_(n),l=o;if(l.length<n.length){const n=["row","col"];return`\n      ${$w(jw(t,l),e)}\n      float ${i}(int row, int col) {\n        return ${i}(${Ww(n,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${Bw(t)}\n      }\n    `;const c=s[0],u=s[1],h=zw(r);if(1===u)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===c)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${i}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${c}, ${u}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=_(n),c=a;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${$w(jw(t,c),e)}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${Ww(n,l)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${o}, 1)));\n        ${Bw(t)}\n      }\n    `;const u=t.shapeInfo.texShape,h=u[0],d=u[1],p=t.shapeInfo.flatOffset;if(d===s&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(d===o&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const f=zw(r);if(e)return`\n    float ${i}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${o} + depth + ${f};\n        vec2 uv = uvFromFlat(${h}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:l,keptDims:c}=_(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${$w(jw(t,l),e)}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${Ww(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${o}, ${s}, 1)));\n        ${Bw(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===s&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=zw(r);if(e)return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],s=e[3]*i,o=e[2]*s,a=e[1]*o,{newShape:l,keptDims:c}=_(e);if(l.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${$w(jw(t,l))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${Ww(e,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${o}, ${s}, ${i})) +\n          depth3;\n        ${Bw(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===i&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=zw(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} + depth * ${s} +\n          depth2 * ${i} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=_(e);if(i.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${$w(jw(t,i))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${Ww(e,s)});\n      }\n    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${c}, ${l}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${Bw(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${l}, ${a}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===o&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=zw(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${c} + depth * ${l} +\n          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Rw(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=kw();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,s=kw();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${o[0]}, ${o[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],l=kw();if(null!=s&&m(n,s))return e?`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${i}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=["b","row","col"];return`\n        ${Rw(jw(t,n.slice(1)),e)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${Ww(s,r)});\n        }\n      `}const a=kw();if(e)return`\n    vec4 ${i}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${c}, ${h}, ${u}, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=kw();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);\n    }\n  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],h=Math.ceil(s[o-1]/2);let d=h*Math.ceil(s[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let t=2;t<o-1;t++)p=`int b${t}, `+p,d*=s[o-t-1],f=`b${t} * ${d} + `+f;return`\n    vec4 ${r}(${p}) {\n      int index = ${f};\n      int texR = index / ${u};\n      int texC = index - texR * ${u};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const Ow="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pw="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Lw="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Dw="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Fw(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function zw(t){return`offset${t}`}function Bw(t){const e=t.name,n=f(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function Uw(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Vw(t,e,n){const{newShape:r,keptDims:i}=_(e),s=e.length,o=t&&3===s&&1===e[0],a=o?e.slice(1):r,l=!t&&s>1&&!m(e,n)&&r.length<s||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:i}}function jw(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Ww(t,e){return e.map((e=>t[e])).join(", ")}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Hw(t,e,n,r){const i=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=i.map((t=>t.shapeInfo)),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=Iw(i,o,e),l=function(t,e){const n=uw(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(Qx(t,(()=>t.shaderSource(n,e))),Qx(t,(()=>t.compileShader(n))),K().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw rw(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t.gl,a),c=t.createProgram(l);return K().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o},Gw(t,e,c))}function Gw(t,e,n){const r={},i={},s={},o=[];let a,l,c,u=null,h=null;h=t.getUniformLocation(n,"NAN",!1),1===K().getNumber("WEBGL_VERSION")&&(u=t.getUniformLocation(n,"INFINITY",!1));const d=!1;for(let o=0;o<e.variableNames.length;o++){const a=e.variableNames[o];r[a]=t.getUniformLocation(n,a,d),r[`offset${a}`]=t.getUniformLocation(n,`offset${a}`,d),e.enableShapeUniforms&&(i[`${a}Shape`]=t.getUniformLocation(n,`${a}Shape`,d),s[`${a}TexShape`]=t.getUniformLocation(n,`${a}TexShape`,d))}return e.enableShapeUniforms&&(a=t.getUniformLocation(n,"outShape",d),c=t.getUniformLocation(n,"outShapeStrides",d),l=t.getUniformLocation(n,"outTexShape",d)),e.customUniforms&&e.customUniforms.forEach(((e,r)=>{o[r]=t.getUniformLocation(n,e.name,d)})),{uniformLocations:r,customUniformLocations:o,infLoc:u,nanLoc:h,inShapesLocations:i,inTexShapesLocations:s,outShapeLocation:a,outShapeStridesLocation:c,outTexShapeLocation:l}}function qw(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,i=e[n],s=i.shape;if(!m(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(t.isUniform&&i.isUniform)return;const o=t.texShape,a=i.isUniform?null:i.texData.texShape;if(!m(o,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${a} must match`)}))}function Xw(t){return K().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Yw{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Gx.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=kw();this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Ew(["r","c","d"],t):Tw(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Kw{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Gx.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=kw();this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Ew(["r","c","d"],t):Tw(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Zw{constructor(t){this.variableNames=["A"],this.outTexUsage=qx.DOWNLOAD;const e=kw();this.outputShape=t,this.userCode=`\n      ${Aw}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Jw{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=qx.DOWNLOAD;const e=kw();this.outputShape=t,this.userCode=`\n      ${Aw}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Qw{constructor(t,e=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=kw();this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length);let r="result";e&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cw(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class t_{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=kw();this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){const s=2*e+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${s}] = values[0];\n            } else if (offset == 1) {\n              result[${s}] = values[1];\n            } else if (offset == 2) {\n              result[${s}] = values[2];\n            } else {\n              result[${s}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cw(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function e_(t){const e=kw();return function(t,e){const n=uw(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(Qx(t,(()=>t.shaderSource(n,e))),Qx(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function n_(t){return function(t,e){const n=uw(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return Qx(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),Qx(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function r_(t){return function(t,e){const n=uw(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return Qx(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),Qx(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function i_(t,e,n,r,i,s){!function(t,e){const n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const o=function(t){return uw(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return Qx(t,(()=>t.bindTexture(a,o))),Qx(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),Qx(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),Qx(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),Qx(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===K().getNumber("WEBGL_VERSION")?Qx(t,(()=>t.texImage2D(a,0,r,e,n,0,i,s,null))):Qx(t,(()=>t.texStorage2D(a,1,r,e,n))),Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:o,texShape:[n,e]}}function s_(t){return t.internalFormatFloat}function o_(t){return t.internalFormatHalfFloat}function a_(t){return t.downloadTextureFormat}function l_(t){return t.internalFormatPackedFloat}function c_(t){return t.internalFormatPackedHalfFloat}function u_(t,e,n,r,i,s,o,a){const l=t,c=new Float32Array(function(t,e){const[n,r]=Zx(t,e);return n*r*4}(s,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class h_{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=K().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){jx[t]=e}(e,t)):this.gl=Hx(e);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===K().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=ew(this.gl,t),bw(this.gl,e))this.textureHalfFloatExtension=ew(this.gl,e);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),bw(this.gl,r))this.colorBufferHalfFloatExtension=ew(this.gl,r);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",bw(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!bw(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=n_(this.gl),this.indexBuffer=r_(this.gl),this.framebuffer=function(t){return uw(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Jx(this.gl,this.textureHalfFloatExtension)}get debug(){return K().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Qx(t,(()=>t.finish())),Qx(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),Qx(t,(()=>t.deleteFramebuffer(this.framebuffer))),Qx(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),Qx(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),Qx(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Yx(e,n);return i_(t,i,s,s_(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Yx(e,n);return i_(t,i,s,o_(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Yx(e,n);return i_(t,i,s,a_(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===K().getNumber("WEBGL_VERSION")?Qx(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):Qx(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===K().getNumber("WEBGL_VERSION")?Qx(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):Qx(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,i,s){let o,a,l;Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,l=s.internalFormatPackedFloat),o.set(i),2===K().getNumber("WEBGL_VERSION")?Qx(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,o))):Qx(t,(()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,a,o))),Qx(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Zx(e,n);return i_(t,i,s,c_(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=Zx(e,n);return i_(t,i,s,l_(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(lw(this.gl,this.framebuffer),this.outputTexture=null),Qx(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,r){const[i,s]=Yx(e,n),o=new Uint8Array(e*n*4);return Qx(t,(()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,o))),new Float32Array(o.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,i,s){return u_(this.gl,t,0,0,0,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const i=t.createBuffer();Qx(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const s=16*e*n;return Qx(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ))),Qx(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),Qx(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(K().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const r=new Float32Array(e*n*4);return Qx(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=e_(e));const n=function(t){return uw(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);return Qx(e,(()=>e.attachShader(n,this.vertexShader))),Qx(e,(()=>e.attachShader(n,t))),function(t,e){if(Qx(t,(()=>t.linkProgram(e))),!K().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,n),this.debug&&iw(e,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(t,e,n){return Qx(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),sw(t,e,"clipSpacePos",n,3,20,0)&&sw(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),n}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Qx(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&iw(this.gl,this.program),Qx(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return uw(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),Qx(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){Qx(t,(()=>ow(t,e,r))),Qx(t,(()=>t.uniform1i(n,r)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=Zx(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&iw(this.gl,this.program),cw(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),Qx(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Qx(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=ew(this.gl,2===K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await v((()=>this.disposed||this.isQueryAvailable(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in K().platform&&(n=K().platform.setTimeoutCustom.bind(K().platform)),v((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),aw(this.gl,t,this.framebuffer),this.debug&&cw(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(aw(this.gl,this.outputTexture,this.framebuffer),this.debug&&cw(this.gl)):lw(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;aw(r,t,this.framebuffer),this.debug&&cw(r),this.outputTexture=t,Qx(r,(()=>r.viewport(0,0,e,n))),Qx(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),Qx(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:d_,bincountImpl:p_,bincountReduceImpl:f_,castImpl:m_,ceilImpl:g_,concatImpl:y_,equalImpl:b_,expImpl:v_,expm1Impl:x_,floorImpl:w_,gatherNdImpl:__,gatherV2Impl:S_,greaterImpl:k_,greaterEqualImpl:T_,lessImpl:E_,lessEqualImpl:M_,linSpaceImpl:C_,logImpl:A_,maxImpl:N_,maximumImpl:I_,minimumImpl:$_,multiplyImpl:R_,negImpl:O_,notEqualImpl:P_,prodImpl:L_,raggedGatherImpl:D_,raggedTensorToTensorImpl:F_,rangeImpl:z_,rsqrtImpl:B_,scatterImpl:U_,sigmoidImpl:V_,simpleAbsImpl:j_,sliceImpl:W_,sparseFillEmptyRowsImpl:H_,sparseReshapeImpl:G_,sparseSegmentReductionImpl:q_,sqrtImpl:X_,stridedSliceImpl:Y_,stringNGramsImpl:K_,stringSplitImpl:Z_,stringToHashBucketFastImpl:J_,subImpl:Q_,tileImpl:tS,topKImpl:eS,transposeImpl:nS,uniqueImpl:rS}=Hg;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function iS(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function sS(t,e){return 1===e?[t]:iS(t,e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class oS{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Xw(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=sS("rc",this.rank),e=Uw(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),i=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${i}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)i=`${t[t.length-1-e]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class aS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length);let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var r,i;
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */this.userCode=`\n      ${r=e,i=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${i?Mw(["r","c","d"],"inputShape"):Tw(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cw(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class lS{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const r=uS(e,n),i=hS(t,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const s=cS(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const t=this.freeTextures[i].shift();return this.usedTextures[i].push(t),t}let o;return r===Xx.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===Xx.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===Xx.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===Xx.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===Xx.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const i=uS(n,r),s=hS(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);const o=cS(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=K().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=o):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[s],c=l.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function cS(t,e,n,r,i){const s=function(t,e){switch(t){case Xx.PACKED_2X2_FLOAT32:return l_(e);case Xx.PACKED_2X2_FLOAT16:return c_(e);case Xx.UNPACKED_FLOAT32:return s_(e);case Xx.UNPACKED_FLOAT16:return o_(e);case Xx.PACKED_4X1_UNSIGNED_BYTE:return a_(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let o;if(i){const[e,n]=Zx(t[0],t[1]);o=e*n}else{const[e,n]=Yx(t[0],t[1]);o=e*n}const a=function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,s);return o*a}function uS(t,e){if(t===qx.UPLOAD)return Xx.PACKED_2X2_FLOAT32;if(t===qx.RENDER||null==t)return function(t){return K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Xx.PACKED_2X2_FLOAT32:Xx.UNPACKED_FLOAT32:t?Xx.PACKED_2X2_FLOAT16:Xx.UNPACKED_FLOAT16}(e);if(t===qx.DOWNLOAD||t===qx.PIXELS)return Xx.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function hS(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class dS{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const pS="return abs(x);",fS="return x;";class mS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class gS{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length);const e=t.length,n=sS("rc",e),r=Uw(e),i=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),s=n.slice(-2),o=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const yS=Fh,bS={};const vS=K().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class xS extends r{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!K().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof h_)e=t;else{const n=Hx(K().getNumber("WEBGL_VERSION"),t);e=new h_(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=Hx(K().getNumber("WEBGL_VERSION"));e=new h_(t),this.binaryCache=((r=K().getNumber("WEBGL_VERSION"))in bS||(bS[r]={}),bS[r]),this.gpgpuCreatedLocally=!0}var r;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new lS(this.gpgpu),this.numMBBeforeWarning=null==K().global.screen?1024:K().global.screen.height*K().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new n(this,Eo())}nextDataId(){return xS.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,e,n){if((K().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||K().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:qx.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,i){if(K().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:qx.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:i,slice:s,shape:o,isPacked:a}=e;if(null!=s){let e;e=a?new mS(o,fS):new dS(o,fS);const n=this.runWebGLProgram(e,[{dataId:t,shape:o,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=li()),"complex64"===r){u=Vp(this.readSync(i.real.dataId),this.readSync(i.imag.dataId))}else u=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=li()-c),this.convertAndCacheOnCPU(t,u)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:i,dtype:s,complexTensorInfos:o,isPacked:a}=e;if(null!=i){let e;e=a?new mS(r,fS):new dS(r,fS);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:s}],s),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if(K().getBool("DEBUG")&&!K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===K().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==s&&K().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(t);const e=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(e.texture.texture,...Kx(r))}if(this.pendingRead.set(t,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const t=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);c=Vp(t[0],t[1])}else if(null==u)c=this.getValuesFromTexture(t);else{const t=f(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,t)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const t=this.gpgpu.gl;Qx(t,(()=>t.deleteBuffer(u)))}const h=this.convertAndCacheOnCPU(t,c),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach((t=>t(h))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Eo().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,isPacked:a,texture:l}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=a?new mS(i,fS):new dS(i,fS);const r=this.runWebGLProgram(n,[{dataId:t,shape:i,dtype:o}],o),s=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),s}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),u=Eo().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>ui(t)));return eo(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return eo(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!tw(n)){if(K().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),i=f(e);if(K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...Kx(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),s}const s=K().getBool("WEBGL_PACK")&&!0===r,o=s?pw(e):e,a=s?new Jw(o):new Zw(o),l=this.runWebGLProgram(a,[{shape:o,dtype:n,dataId:t}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const i=p(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),s=p(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(i);o.kernelMs=c(t),o.getExtraProfileInfo=()=>t.map(((t,e)=>({name:s[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:li(),endMs:null}}endTimer(t){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=li(),t)}async getQueryTime(t){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:s,slice:o}=this.texData.get(t),a=o&&o.origDataId||t,l=this.dataRefCount.get(a);l>1?this.dataRefCount.set(a,l-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,s)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=vS){return K().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&f(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){ur("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return yS(t.shape,e)}packedUnaryOp(t,e,n){const r=new mS(t.shape,e),i=this.compileAndRun(r,[t],n);return Eo().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=j_(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,pS,t.dtype);const e=new dS(t.shape,pS),n=this.compileAndRun(e,[t]);return Eo().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&I(n[0])){const i=n.map((t=>ci(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return Eo().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new gS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new oS(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[hw(t.shape),...dw(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[hw(e),...dw(e)],s=new aS(i,n),o=[n],a=this.runWebGLProgram(s,[r],t.dtype,o,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:i,dtype:s}=n;if(null!=e){u(f(i)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const o=pw(i);let a;a=r?new Kw(o):new Yw(o);const l=[null!=e?e:Kx(o)];return{dtype:s,shape:i,dataId:this.runWebGLProgram(a,[{shape:o,dtype:s,dataId:t}],s,l,!0,e).dataId}}runWebGLProgram(t,e,n,r,i=!1,s){const o=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(o.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===Gx.DENSE){const e=null!=s?s:Kx(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===f(o.shape))return a.values=S(o.dtype,0),o;const l=[],c=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&f(e.shape)<=K().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),l.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!mw(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),l.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const u={shape:o.shape,texData:a,isUniform:!1},h=function(t,e,n){let r="";e.concat(n).forEach((e=>{const i=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const s=e.texData.texShape,{useSqueezeShape:o,uniformShape:a,keptDims:l}=Vw(t.packedInputs,e.shape,s);let c="",u="",h="";if(1===a.length&&t.packedInputs){const t=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];c=`${t[0]>1}_${t[1]>1}`}else if(2!==a.length||t.packedInputs){if(a.length>2&&!t.packedInputs){const t=D(a);h=`${t[0]===s[1]}_${t[t.length-1]===s[1]}`}}else u=`${a[0]>1}_${a[1]>1}`;const d=e.shape.length,p=2===a.length&&m(e.shape,s),g=1===f(e.shape),y=Bo(e.shape,n.shape),b=!t.packedInputs&&d===n.shape.length&&m(s,n.texData.texShape),v=t.packedInputs||a.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${d}_${b}_${o?l:""}_${a.length}_${g}_${y}_${p}_${c}_${u}_${h}_${v}_${i}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${i}`}}));const i=t.userCode;let s=t.constructor.name;return s+="_"+r+"_"+i+`${K().getNumber("WEBGL_VERSION")}`,s}(t,c,u),d=this.getAndSaveBinary(h,(()=>Hw(this.gpgpu,t,c,u))),p=null!=this.activeTimers;let g;p&&(g=this.startTimer()),K().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,i){e.program.enableShapeUniforms||(qw(e.inShapeInfos,n),qw([e.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):t.setOutputMatrixTexture(s.texture,o[0],o[1]),t.setProgram(e.webGLProgram),1===K().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,r)=>{const i=e.program.variableNames[r],s=e.uniformLocations[i],o=e.uniformLocations[`offset${i}`],a=e.inShapesLocations[`${i}Shape`],l=e.inTexShapesLocations[`${i}TexShape`];if(a){const{uniformShape:r}=Vw(e.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:t.gl.uniform1iv(a,new Int32Array(r));break;case 2:t.gl.uniform2iv(a,new Int32Array(r));break;case 3:t.gl.uniform3iv(a,new Int32Array(r));break;case 4:t.gl.uniform4iv(a,new Int32Array(r))}}if(l&&t.gl.uniform2i(l,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(f(n.shape)<2)t.gl.uniform1f(s,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(s,e)}else null!=n.texData.slice&&null!=o&&t.gl.uniform1i(o,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture.texture,s,r)}));const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=D(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i&&e.program.customUniforms.forEach(((n,r)=>{const s=e.customUniformLocations[r],o=i[r];if("float"===n.type)t.gl.uniform1fv(s,o);else if("vec2"===n.type)t.gl.uniform2fv(s,o);else if("vec3"===n.type)t.gl.uniform3fv(s,o);else if("vec4"===n.type)t.gl.uniform4fv(s,o);else if("int"===n.type)t.gl.uniform1iv(s,o);else if("ivec2"===n.type)t.gl.uniform2iv(s,o);else if("ivec3"===n.type)t.gl.uniform3iv(s,o);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(s,o)}})),t.executeProgram()}(this.gpgpu,d,c,u,r),l.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));const y=K().get("WEBGL_FLUSH_THRESHOLD");if(y>0){const t=li();t-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!K().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===i){const t=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),t}return o}compileAndRun(t,e,n,r,i=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!K().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Co((()=>{if(!K().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=K().getBool("DEBUG");K().set("DEBUG",!1);const e=this.abs(lc(1e-8)).dataSync()[0];if(K().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:i,texture:s,usage:o,isPacked:l}=e;if(null!=s)return;const c=null!=this.activeTimers;let u;c&&(u=li());let h=e.texShape;if(null==h&&(h=function(t,e=!1){let n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=K().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&K().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n*=2,r*=2,t=t.map(((e,n)=>n>=t.length-2?a(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=_(t);t=e.newShape}let i=f(t),s=null;t.length<=1&&i<=n?s=[1,i]:2===t.length&&t[0]<=n&&t[1]<=n?s=t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const o=null!=s&&Math.max(...s)>r&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(null==s||o)if(e){const e=hw(t);let n=2,r=2;t.length&&([n,r]=dw(t)),i=e*(n/2)*(r/2),s=y(i).map((t=>2*t))}else s=y(i);return s}(n,l),e.texShape=h),null!=i){const t=pw(n);let s,o=h[1],a=h[0];const d=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!l&&d||([o,a]=Zx(h[0],h[1])),s=l?new t_(t,d):new Qw(t,d);const p=d?[a,o]:h,f=this.makeTensorInfo(p,r),m=this.texData.get(f.dataId);m.usage=d?qx.PIXELS:qx.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),o,a,i);const g=[[a,o]],y=!0,b=this.runWebGLProgram(s,[f],r,g,y),v=this.texData.get(b.dataId);e.texShape=v.texShape,e.isPacked=v.isPacked,e.usage=v.usage,K().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(e.texture=v.texture,e.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(f),c&&(this.uploadWaitMs+=li()-u)}else{const t=this.acquireTexture(h,o,r,l);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*A(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await vp(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw rw(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:e,customUniformLocations:n,infLoc:r,nanLoc:i,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:a,outShapeStridesLocation:l,outTexShapeLocation:c}=Gw(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=i,t.inShapesLocations=s,t.inTexShapesLocations=o,t.outShapeLocation=a,t.outShapeStridesLocation=l,t.outTexShapeLocation=c}}}xS.nextDataId=0,Xi()&&$o("webgl",(()=>new xS),2)
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */;class wS{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=Vo(e,n),this.enableShapeUniforms=Xw(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class _S{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Vo(e,n);const i=this.outputShape.length;this.enableShapeUniforms=Xw(i);let s="";if(r)if(0===i||1===f(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(s=`\n          ${Uw(i)} coords = getOutputCoords();\n        `,1===i)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=sS("coords",i);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= outShape[${i} - 2];\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= outShape[${i} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function SS(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const kS={kernelName:me,backendName:"webgl",kernelFunc:SS};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function TS(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=SS({inputs:{x:r},backend:n}),l=SS({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:l},s}const ES={kernelName:Mt,backendName:"webgl",kernelFunc:TS},MS="return (a < 0.) ? b * a : a;",CS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const AS={kernelName:we,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r,o=n.makeTensorInfo([],"float32",oi(s,"float32")),a=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _S(CS,i.shape,o.shape):new wS(MS,i.shape,o.shape),l=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),l}},NS="return (a < 0.) ? b * a : a;",IS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const $S={kernelName:rn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _S(IS,r.shape,i.shape):new wS(NS,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function RS({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&null!=n){const t=a.texData.get(o.dataId),e=n(t.values,l);return a.makeTensorInfo(o.shape,l,e)}let c;return c=K().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new mS(o.shape,e):new dS(o.shape,t),a.runWebGLProgram(c,[o],l)}}function OS({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(r&&"complex64"===l.dtype){const e=u.texData.get(l.dataId),n=u.texData.get(c.dataId),[r,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,i={dataId:n.dataId,dtype:n.dtype,shape:l.shape},s={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o=new wS(t,l.shape,c.shape);return u.runWebGLProgram(o,[i,s],$i(n.dtype,r.dtype))})),s=TS({inputs:{real:r,imag:i},backend:u});return u.disposeIntermediateTensorInfo(r),u.disposeIntermediateTensorInfo(i),s}const h=s||$i(l.dtype,c.dtype);if(("string"===l.dtype||"string"===c.dtype||u.shouldExecuteOnCPU([l,c]))&&null!=i){const t=u.texData.get(l.dataId).values,e=u.texData.get(c.dataId).values,n="string"===l.dtype?_f(t):t,r="string"===l.dtype?_f(e):e,[s,o]=i(l.shape,c.shape,n,r,h),a=u.makeTensorInfo(o,h);return u.texData.get(a.dataId).values=s,a}let d;return d=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new _S(e,l.shape,c.shape,n):new wS(t,l.shape,c.shape),u.runWebGLProgram(d,[l,c],h)}}function PS(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?IS:NS;if("leakyrelu"===t)return e?CS:MS;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class LS{constructor(t,e,n,r=!1,i=!1,s=!1,o=null,a=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Xw(this.outputShape.length);const c=r?t[1]:t[2],u=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";o&&(m=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";t[0]<e[0]?b=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(v=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${u}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${u}; i++) {\n          int batchA = ${b};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DS="return areal * breal - aimag * bimag;",FS="return areal * bimag + aimag * breal;";class zS{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Vo(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const BS="return a * b;";function US(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=$i(r.dtype,i.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),s=new zS(DS,r.shape,i.shape),o=new zS(FS,r.shape,i.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(s,a,"float32"),c=n.runWebGLProgram(o,a,"float32"),u=TS({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([r,i])){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),[o,a]=R_(r.shape,i.shape,t.values,e.values,s),l=n.makeTensorInfo(a,s);return n.texData.get(l.dataId).values=o,l}let o;return o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _S(BS,r.shape,i.shape):new wS(BS,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const VS={kernelName:Ge,backendName:"webgl",kernelFunc:US};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function jS(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,o=n,a=f(i.shape),l=x(s,a),c=f(l);u(a===c,(()=>`The new shape (${l}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const h=o.texData.get(i.dataId);return!h.isPacked||mw(i.shape,l)||null!==h.texture&&mw(h.shape,l)?(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):function(t,e,n){const r=[hw(t.shape),...dw(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[hw(e),...dw(e)],o=new aS(s,r),a=[r],l=n.runWebGLProgram(o,[i],t.dtype,a,!0);return{dataId:l.dataId,shape:e,dtype:l.dtype}}(i,l,o)}const WS={kernelName:dn,backendName:"webgl",kernelFunc:jS};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class HS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];const o=4*Math.floor(n/4),a=n%4;let l="sumValue += dot(values, ones);";if(null!=e){const t=1/e;l=`sumValue += dot(values * ${g(t)?t.toPrecision(2):t}, ones);`}let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class GS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];let o="0.0",a="";"prod"===e?o="1.0":"min"===e?(o="1.0 / 1e-20",a="min"):"max"===e&&(o="-1.0 / 1e-20",a="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?l="sumValue":"prod"===e?l="prodValue":"all"===e?l="allValue":"any"===e&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${a}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===e?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";i%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${l});\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function qS(t,e,n,r){const i=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=Mp(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let s=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:l,outSize:c}=i[o];let u,h;u="mean"===n?0===o?new HS({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new HS({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):new GS({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),h=s,s=r.runWebGLProgram(u,[s],e),h.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(h)}return s}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class XS{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const r=Uw(this.rank),i=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let e=0;e<t.length;e++)r[t[e]]=n[e];return r.join()}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class YS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Uw(this.rank),i=iS("rc",this.rank),s=new Array(this.rank);for(let t=0;t<e.length;t++)s[e[t]]=i[t];const o=`vec2(${s.slice(-2).join()})`,a=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${a}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${a}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function KS(t,e,n){const r=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YS(t.shape,e):new XS(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function ZS(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r;return function(t,e,n,r){const i=e,s=t.shape.length,o=w(i,t.shape);let a=o;const l=nc(a,s),c=null!=l;let u=t;c&&(u=KS(t,l,r),a=ic(a.length,s)),ec("sum",a,s);const[h,d]=Ql(u.shape,a);let p=h;n&&(p=tc(h,o));const m=f(d),g=jS({inputs:{x:u},attrs:{shape:[f(t.shape)/m,m]},backend:r}),y=qS(g,Ri(t.dtype),"sum",r),b=jS({inputs:{x:y},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(u),b}(i,s,o,n)}const JS={kernelName:$n,backendName:"webgl",kernelFunc:ZS};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function QS(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:s}=r,o=n,a=i.shape.length,l=new Array(a);for(let t=0;t<l.length;t++)l[t]=i.shape[s[t]];let c;if(o.shouldExecuteOnCPU([i])){const t=o.texData.get(i.dataId).values,e=nS(t,i.shape,i.dtype,s,l);c=o.makeTensorInfo(l,i.dtype);o.texData.get(c.dataId).values=e}else c=KS(i,s,o);return c}const tk={kernelName:Qn,backendName:"webgl",kernelFunc:QS};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ek({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,h=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],p=r?e.shape[h-1]:e.shape[h-2],m=n?t.shape[c-1]:t.shape[c-2],g=r?e.shape[h-2]:e.shape[h-1],y=t.shape.slice(0,-2),b=e.shape.slice(0,-2),v=f(y),x=f(b),w=Vo(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([m,g]);u(d===p,(()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const _=n?[v,d,m]:[v,m,d],S=r?[x,g,p]:[x,p,g],k=jS({inputs:{x:t},backend:i,attrs:{shape:_}}),T=jS({inputs:{x:e},backend:i,attrs:{shape:S}}),E=[k,T],M=Math.max(v,x),C=n?k.shape[1]:k.shape[2],A=null!=s,N=null!=o,I="leakyrelu"===l,$=null!=l?PS(l,!0):null;let R;if((1===m||1===g)&&C>1e3&&!1===(A||N||I||null!=$)){let t=k,e=T;n&&(t=QS({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),E.push(t)),r&&(e=QS({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),E.push(e));const s=1===g;let o=t;1!==g&&(o=jS({inputs:{x:t},backend:i,attrs:{shape:[M,C,1]}}),E.push(o));const a=1===g?2:1;let l=e;s&&(l=jS({inputs:{x:e},backend:i,attrs:{shape:[M,1,C]}}),E.push(l));const c=US({inputs:{a:o,b:l},backend:i});R=ZS({inputs:{x:c},backend:i,attrs:{axis:a,keepDims:!0}}),E.push(c)}else{const l=$i(t.dtype,e.dtype),c=new LS(_,S,[M,m,g],n,r,A,$,N,I),u=[k,T];if(null!=s&&u.push(s),N&&u.push(o),I){const t=i.makeTensorInfo([],"float32",oi(a,"float32"));u.push(t),E.push(t)}R=i.runWebGLProgram(c,u,l)}const O=jS({inputs:{x:R},backend:i,attrs:{shape:w}});E.push(R);for(const t of E)i.disposeIntermediateTensorInfo(t);return O}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const nk={kernelName:ar,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;return ek({a:i,b:s,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}},rk="return abs(x);";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ik={kernelName:et,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=j_(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let i;return i=K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new mS(r.shape,rk):new dS(r.shape,rk),n.runWebGLProgram(i,[r],r.dtype)}},sk=RS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),ok={kernelName:nt,backendName:"webgl",kernelFunc:sk},ak=RS({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),lk={kernelName:rt,backendName:"webgl",kernelFunc:ak},ck="return a + b;",uk=OS({opSnippet:ck,packedOpSnippet:ck,supportsComplex:!0,cpuKernelImpl:d_}),hk={kernelName:it,backendName:"webgl",kernelFunc:uk};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class dk{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class pk{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const fk={kernelName:st,backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,i=n;if(1===i.length)return SS({inputs:{x:i[0]},backend:r});if(i.length>K().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(i.length/2),n=t({inputs:i.slice(0,e),backend:r}),s=t({inputs:i.slice(e),backend:r});return t({inputs:[n,s],backend:r})}const s=i.map((t=>t.dtype)).reduce(((t,e)=>$i(t,e))),o=i.map((t=>t.shape)),a=K().getBool("WEBGL_PACK")?new pk(i[0].shape,o):new dk(i[0].shape,o);return r.runWebGLProgram(a,i,s)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mk={kernelName:ot,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=w(s,i.shape);let c=l;const u=nc(c,a);let h=i;null!=u&&(h=QS({inputs:{x:i},backend:n,attrs:{perm:u}}),c=ic(c.length,a)),ec("all",c,a);const[d,p]=Ql(h.shape,c),m=jS({inputs:{x:h},backend:n,attrs:{shape:[-1,f(p)]}}),g=qS(m,m.dtype,"all",n);let y;if(o){y=jS({inputs:{x:g},backend:n,attrs:{shape:tc(d,l)}})}else y=jS({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gk={kernelName:at,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=w(s,i.shape);let c=l;const u=nc(c,a);let h=i;null!=u&&(h=QS({inputs:{x:i},backend:n,attrs:{perm:u}}),c=ic(c.length,a)),ec("any",c,a);const[d,p]=Ql(h.shape,c),m=jS({inputs:{x:h},backend:n,attrs:{shape:[-1,f(p)]}}),g=qS(m,m.dtype,"any",n);let y;if(o){y=jS({inputs:{x:g},backend:n,attrs:{shape:tc(d,l)}})}else y=jS({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class yk{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:s}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];const o="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${o} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class bk{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,u(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=t[t.length-1],s=Math.ceil(i/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,a=o.length,l=Uw(a),c=sS("coords",a);let h,d;if(1===s){d=a+1;const t=Uw(d);h=`\n        ${t} sourceLocR = ${t}(${c.join()}, 0);\n        ++${c[a-1]};\n        ${t} sourceLocG = ${t}(${c.join()}, 0);\n        ++${c[a-2]};\n        ${t} sourceLocA = ${t}(${c.join()}, 0);\n        --${c[a-1]};\n        ${t} sourceLocB = ${t}(${c.join()}, 0);\n        --${c[a-2]};`}else d=a,h=`\n        ${l} sourceLocR = coords;\n        ++${c[a-1]};\n        ${l} sourceLocG = coords;\n        ++${c[a-2]};\n        ${l} sourceLocA = coords;\n        --${c[a-1]};\n        ${l} sourceLocB = coords;\n        --${c[a-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],m=p.map((t=>"int "+t)),g=sS("sourceLocR",d-1).concat("inIdx.r"),y=sS("sourceLocG",d-1).concat("inIdx.g"),b=sS("sourceLocB",d-1).concat("inIdx.b"),v=sS("sourceLocA",d-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,_=`vec4(\n            getAChannel(${g.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${b.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,S=r?"":`\n      float getBestIndicesAChannel(${m.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${m.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${S}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${c[a-1]} < ${o[a-1]-1};\n        bool hasNextRow = ${c[a-2]} < ${o[a-2]-1};\n        ${h}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${_};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${w}\n          vec4 candidate = ${_};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function vk(t,e,n,r=null){let i=e.shape[0],s=e.shape[1];null!=r&&(i=r.shape[0],s=r.shape[1]);const o=Mp(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},l=new yk(a,n,null==r),c=[e];null!=r&&c.push(r);const u=t.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const h=vk(t,e,n,u);return t.disposeIntermediateTensorInfo(u),h}function xk(t,e,n,r=null){const i=null!=r?r.shape:e.shape,s=Mp(i[i.length-1]),o=new bk(i,s,n,null==r),a=null==r?[e]:[e,r],l=t.runWebGLProgram(o,a,"int32");if(l.shape.length===e.shape.length){const r=xk(t,e,n,l);return t.disposeIntermediateTensorInfo(l),r}return l}function wk(t,e,n,r){const i=[n];if(ec("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!K().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],s=t.texData.get(e.dataId);let o=e;null!==s&&s.isPacked&&(o=t.unpackTensor(e),n.push(o));const[a,l]=Ql(o.shape,i),c=f(l),u=jS({inputs:{x:o},backend:t,attrs:{shape:[-1,c]}});n.push(u);const h=vk(t,u,r);n.push(h);const d=jS({inputs:{x:h},backend:t,attrs:{shape:a}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),d}return xk(t,e,r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _k={kernelName:lt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=w(s,i.shape);const a=nc(o,i.shape.length);let l=i;const c=[];null!=a&&(l=QS({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=ic(o.length,l.shape.length)),ec("argMax",[o[0]],l.shape.length);const u=wk(n,l,o[0],"max");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Sk={kernelName:ct,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let o=w(s,i.shape);const a=nc(o,i.shape.length);let l=i;const c=[];null!=a&&(l=QS({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(l),o=ic(o.length,l.shape.length)),ec("argMin",[o[0]],l.shape.length);const u=wk(n,l,o[0],"min");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}},kk=RS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),Tk={kernelName:ut,backendName:"webgl",kernelFunc:kk},Ek=RS({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),Mk={kernelName:ht,backendName:"webgl",kernelFunc:Ek},Ck=RS({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),Ak={kernelName:dt,backendName:"webgl",kernelFunc:Ck},Nk=OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),Ik={kernelName:ft,backendName:"webgl",kernelFunc:Nk},$k=RS({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),Rk={kernelName:pt,backendName:"webgl",kernelFunc:$k};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class Ok{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,g=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${a});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${u};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / count");const v=4*Math.floor(s/4),x=s%4,w=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${u};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}class Pk{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideDepth,a=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,u=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${a}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${u}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(x="avgValue / count");const w=4*Math.floor(s/4),_=s%4,S=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${a}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${v};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${v});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${S}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${S}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Lk={kernelName:mt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;_w(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;u(el(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=Ha(i.shape,s,o,1,a,l);if(1===c.filterWidth&&1===c.filterHeight&&m(c.inShape,c.outShape))return SS({inputs:{x:i},backend:n});const h=new Ok(c,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Dk={kernelName:yt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=Ga(i.shape,s,o,[1,1,1],a,l,c),h=new Pk(u,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Fk{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=a-1-t.padInfo.top,u=l-1-t.padInfo.left,h=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${u});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${o}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class zk{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=u-1-t.padInfo.front,f=h-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${u};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Bk={kernelName:bt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=Ga(o.shape,a,l,[1,1,1],c,u),d=new zk(h);return n.runWebGLProgram(d,[i],o.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Uk={kernelName:gt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s;_w([i,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=Ha(o.shape,a,l,1,c),h=new Fk(u);return n.runWebGLProgram(h,[i],o.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Vk={kernelName:vt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:o,transposeB:a}=r;return ek({a:i,b:s,transposeA:o,transposeB:a,backend:n})}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class jk{constructor(t,e,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Vo(t,e),Vo(t,n);let o="0.0";null!=r&&(Vo(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="1.0";null!=i&&(Vo(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Wk{constructor(t,e,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Vo(t,e),Vo(t,n);let o="vec4(0.0)";null!=r&&(Vo(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=i&&(Vo(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Hk={kernelName:ue,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=t;u(i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),u(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),u(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);const c=[r,i,s];let h=null;null!=o&&(h=o.shape,c.push(o));let d=null;null!=a&&(d=a.shape,c.push(a));const p=K().getBool("WEBGL_PACK_NORMALIZATION")?new Wk(r.shape,i.shape,s.shape,h,d,l):new jk(r.shape,i.shape,s.shape,h,d,l);return e.runWebGLProgram(p,c,c[0].dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class Gk{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=Uw(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return qk.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(this.rank);let r;const i=t.map(((t,e)=>`sourceLoc.${qk[e]} = start[${e}] + coords.${qk[e]};`));r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${i.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const qk=["x","y","z","w","u","v"];class Xk{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=Uw(this.rank),n=sS("coords",this.rank),r=sS("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${o}\n        ${a}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Yk(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:o}=r,[a,l]=ma(i,s,o);if(ra(i,a,l),0===f(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const t=n.texData.get(i.dataId),e=W_(t.values,a,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,e)}const{isPacked:c}=n.texData.get(i.dataId),u=pa(i.shape,a,l);if(c||!u){const t=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xk(l):new Gk(l),e=[a];return n.runWebGLProgram(t,[i],i.dtype,e)}return n.uploadToGPU(i.dataId),function(t,e,n,r){const i=r.texData.get(t.dataId),s=r.makeTensorInfo(n,t.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=fa(e,D(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),s}(i,a,l,n)}const Kk={kernelName:Tn,backendName:"webgl",kernelFunc:Yk},Zk={kernelName:xt,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:o}=r;u(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),l=Ap(i.shape,s,a),c=Np(l.length,s.length),h=Ip(i.shape,s,a),d=$p(o,s.length),p=Rp(h,o,s.length),f=[],m=jS({inputs:{x:i},backend:n,attrs:{shape:l}}),g=QS({inputs:{x:m},backend:n,attrs:{perm:c}}),y=jS({inputs:{x:g},backend:n,attrs:{shape:h}}),b=Yk({inputs:{x:y},backend:n,attrs:{begin:d,size:p}});return f.push(m),f.push(g),f.push(y),f.forEach((t=>n.disposeIntermediateTensorInfo(t))),b}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Jk={kernelName:wt,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o}=r,a=n.readSync(i.dataId),l=n.readSync(s.dataId),c=p_(a,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Qk={kernelName:St,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=Vo(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},tT=OS({opSnippet:"return float(a != b);",cpuKernelImpl:P_,dtype:"bool"}),eT={kernelName:Xe,backendName:"webgl",kernelFunc:tT};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function nT(t){const{inputs:e,backend:n}=t,{input:r}=e;return SS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const rT={kernelName:cn,backendName:"webgl",kernelFunc:nT};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const iT={kernelName:kt,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function t(e){const{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{dtype:o}=i;if("complex64"===o){if("complex64"===s.dtype)return SS({inputs:{x:s},backend:r});const e=tu(s.shape),n=t({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),i=TS({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===s.dtype){const e=nT({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(e),n}if(!M(s.dtype,o)){const t=SS({inputs:{x:s},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:o}}if(r.shouldExecuteOnCPU([s])){const t=r.texData.get(s.dataId).values,[e,n,i]=m_(t,s.shape,s.dtype,o);return r.makeTensorInfo(e,n,i)}if("int32"===o)return function(t,e){const n=new dS(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===o){const t=r.makeTensorInfo([],"bool",S("bool",1)),e=tT({inputs:{a:s,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}},sT="return ceil(x);",oT=RS({opSnippet:sT,packedOpSnippet:sT,cpuKernelImpl:g_}),aT={kernelName:Tt,backendName:"webgl",kernelFunc:oT};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class lT{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class cT{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uT={kernelName:Et,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:s,clipValueMax:o}=r;let a;a=K().getBool("WEBGL_PACK_CLIP")?new cT(i.shape):new lT(i.shape);const l=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,l)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class hT{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dT(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const pT={kernelName:Ct,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),s=new hT(r.shape),o=[dT(r,i.complexTensorInfos.real),dT(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class fT{constructor(t){this.outputShape=[],this.outputShape=wp(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const r=e.length,i=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class mT{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=wp(t,e);const n=this.outputShape,r=n.length,i=Uw(r),s=sS("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let n=1;n<a.length;n++)a[n]=a[n-1]+t[n][e];const l=o[e],c=o.slice(-2),u=o.join();let h=`if (${l} < ${a[0]}) {\n        return getChannel(\n            getT0(${u}), vec2(${c.join()}));\n        }`;for(let t=1;t<a.length;t++){const e=a[t-1];h+=`\n        if (${l} < ${a[t]}  && ${l} >= ${a[t-1]}) {\n          return getChannel(\n            getT${t}(${gT(o,l,e)}),\n            vec2(${gT(c,l,e)}));\n        }`}const d=a.length,p=a[a.length-1];h+=`\n        return getChannel(\n          getT${d}(${gT(o,l,p)}),\n          vec2(${gT(c,l,p)}));`,this.userCode=`\n      float getValue(${o.map((t=>"int "+t))}) {\n        ${h}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function gT(t,e,n){const r=t.indexOf(e);return t.map(((t,e)=>e===r?`${t} - ${n}`:t)).join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function yT(t){const{inputs:e,backend:n}=t,{input:r}=e;return SS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const bT={kernelName:ye,backendName:"webgl",kernelFunc:yT};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function vT(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>nT({inputs:{input:t},backend:n}))),i=t.map((t=>yT({inputs:{input:t},backend:n}))),s=vT(r,e,n),o=vT(i,e,n),a=TS({inputs:{real:s,imag:o},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),i.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),a}let i=n.shouldExecuteOnCPU(t);if("string"===r&&(i=!0),i){const i=t.map((t=>{const r=f(t.shape.slice(e));return jS({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),s=i.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),o=wp(i.map((t=>t.shape)),1),a=1===i[0].shape[0],l=y_(s,o,r,a),c=wp(t.map((t=>t.shape)),e),u=n.makeTensorInfo(c,r,l);return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}const s=K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(t.length>s){const r=[];for(let i=0;i<t.length;i+=s){const o=t.slice(i,i+s);r.push(vT(o,e,n))}const i=vT(r,e,n);for(const t of r)n.disposeIntermediateTensorInfo(t);return i}if(K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const i=new mT(t.map((t=>t.shape)),e);return n.runWebGLProgram(i,t,r)}const{tensors2D:o,outShape:a}=function(t,e,n){const r=wp(t.map((t=>t.shape)),e);return{tensors2D:t.map((t=>jS({inputs:{x:t},attrs:{shape:[-1,f(t.shape.slice(e))]},backend:n}))),outShape:r}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t,e,n),l=new fT(o.map((t=>t.shape))),c=n.runWebGLProgram(l,o,r);o.forEach((t=>n.disposeIntermediateTensorInfo(t)));const u=jS({inputs:{x:c},attrs:{shape:a},backend:n});return n.disposeIntermediateTensorInfo(c),u}function xT(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=w(i,e[0].shape)[0];xp(e.map((t=>t.shape)),s);const o=wp(e.map((t=>t.shape)),s);if(0===f(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>f(t.shape)>0));return 1===a.length?SS({inputs:{x:a[0]},backend:n}):vT(a,s,n)}const wT={kernelName:At,backendName:"webgl",kernelFunc:xT};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class _T{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const s=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,u=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",x="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${a}, ${l});\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class ST{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,u=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${s}, ${o});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${u}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class kT{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Xw(this.outputShape.length);const s=t.padInfo.left,o=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,u=t.filterWidth,h=u;let d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<u;t++)d+=`\n           vec4 xTexelC${2*t};\n           int xTexelC${2*t}Ready;\n           vec4 xTexelC${2*t+1};\n           int xTexelC${2*t+1}Ready;\n           vec4 xC${t};`;d+=`\n     for (int r = 0; r < ${c}; r++) {\n      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {\n       `;for(let t=0;t<u;t++)d+=`\n           xTexelC${2*t} = vec4(0.0);\n           xTexelC${2*t}Ready = 0;\n           xTexelC${2*t+1} = vec4(0.0);\n           xTexelC${2*t+1}Ready = 0;\n           xC${t} = vec4(0.0);`;d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let e=0;e<(h+1)/2;e++){const n=2*e;if(d+=`\n           xC = xCCorner + ${n*l};\n           `,1===o){if(n<u&&(s%2==1?(d+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,d+=1===l&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):d+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<u)){const t=s%2==0?a(l):l;l%2==0&&s%2==1||l%2!=0&&s%2!=1?(d+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,d+=l>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):d+=1===t?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${t};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<u&&(s%2==1?(d+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<u&&(d+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(d+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<u&&(d+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<u&&(d+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${t.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<u&&(d+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${t.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:i?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,f="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${p}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${d}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${m}\n         ${f}\n         setOutput(result);\n       }\n     `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TT{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Xw(this.outputShape.length);const{dataFormat:n}=e,r=kw(),i="channelsLast"===n,s=i?1:2,o=i?2:3,a=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)l+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${t};\n\n          ${a}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${o}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${i}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${r.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ET(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&1===n&&t[0]>1?[t[0],1]:null}function MT({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=r.texData.get(t.dataId),h=n.inChannels,d=l[0]*l[1]*l[2],p=n.outChannels,f="channelsLast"===n.dataFormat;let g;const y=[];if(null!=s){const t=ET(s.shape,f);null!=t&&(s=jS({inputs:{x:s},backend:r,attrs:{shape:t}}),y.push(s))}if(null!=i){const t=ET(i.shape,f);null!=t&&(i=jS({inputs:{x:i},backend:r,attrs:{shape:t}}),y.push(i))}if(!((1===d||1===p)&&h>1e3)&&c.isPacked&&f&&null!=c.texture&&l[2]%2!=0&&m(c.shape.slice(-3),l.slice(-3))){const h=l[0]*l[1]*(l[2]+1),d={dataId:t.dataId,shape:[1,h,n.inChannels],dtype:t.dtype},p=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,u(mw(c.shape,d.shape),(()=>`packed reshape ${c.shape} to ${d.shape} isn't free`));const f=jS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(f);const m=ek({a:d,b:f,backend:r,transposeA:false,transposeB:false,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),b=r.texData.get(m.dataId);u(b.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=p,b.shape=n.outShape,g=SS({inputs:{x:m},backend:r}),g.shape=n.outShape,y.push(m)}else{const l=n.outHeight*n.outWidth,c=jS({inputs:{x:t},backend:r,attrs:{shape:f?[n.batchSize,l,n.inChannels]:[n.batchSize,n.inChannels,l]}}),u=jS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=ek({a:f?c:u,b:f?u:c,transposeA:!f,transposeB:false,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});g=jS({inputs:{x:h},backend:r,attrs:{shape:n.outShape}}),y.push(c),y.push(u),y.push(h)}for(const t of y)r.disposeIntermediateTensorInfo(t);return g}function CT({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:h,outHeight:d,dataFormat:p}=n,m="channelsLast"===p,g=l*c*u,y=d*h,b=[n.batchSize,g,y],v=[];if(null!=s){const t=ET(s.shape,m);null!=t&&(s=jS({inputs:{x:s},backend:r,attrs:{shape:t}}),v.push(s))}if(null!=i){const t=ET(i.shape,m);null!=t&&(i=jS({inputs:{x:i},backend:r,attrs:{shape:t}}),v.push(i))}const x=jS({inputs:{x:e},backend:r,attrs:{shape:[1,g,f(e.shape)/g]}});v.push(x);const w=new TT(b,n),_=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],S=r.runWebGLProgram(w,[t],"float32",_),k=jS({inputs:{x:S},backend:r,attrs:{shape:b}});v.push(S),v.push(k);const T=null!=i,E=null!=s,M="leakyrelu"===a,C=a?PS(a,!0):null,A=new LS(m?k.shape:x.shape,m?x.shape:k.shape,m?[n.batchSize,y,n.outChannels]:[n.batchSize,n.outChannels,y],!0,!1,T,C,E,M),N=m?[k,x]:[x,k];if(i&&N.push(i),E&&N.push(s),M){const t=r.makeTensorInfo([],"float32",oi(o,"float32"));N.push(t),v.push(t)}const I=r.runWebGLProgram(A,N,"float32"),$=jS({inputs:{x:I},backend:r,attrs:{shape:n.outShape}});v.push(I);for(const t of v)r.disposeIntermediateTensorInfo(t);return $}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const AT={kernelName:Nt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,h=nl(l),d=qa(i.shape,s.shape,o,c,a,u,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&K().getBool("WEBGL_EXP_CONV")){const t=new kT(d),e=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(t,[i,s],"float32",e)}else if(K().getBool("WEBGL_CONV_IM2COL"))p=CT({x:i,filter:s,convInfo:d,backend:n});else{const t=new _T(d);p=n.runWebGLProgram(t,[i,s],"float32")}else p=MT({x:i,filter:s,convInfo:d,backend:n});const f=jS({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class NT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${s}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class IT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s="channelsLast"===t.dataFormat,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,l=s?1:2,c=s?2:3,u=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${u}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class $T{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,s=t.padInfo.top,o=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${o};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class RT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.front,l=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${l}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const OT={kernelName:It,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,h=nl(l),d=qa(i.shape,u,o,1,a,c,!1,h),p=new NT(d);return n.runWebGLProgram(p,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const PT={kernelName:$t,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,h=nl(c),d=qa(o,s.shape,a,1,l,u,!1,h),p=new IT(d);return n.runWebGLProgram(p,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const LT={kernelName:Rt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=Xa(i.shape,s.shape,o,l,a),u=new ST(c);return n.runWebGLProgram(u,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DT={kernelName:Ot,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,pad:a,filterShape:l}=r,c=Xa(i.shape,l,o,1,a),u=new $T(c);return n.runWebGLProgram(u,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const FT={kernelName:Pt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:o,strides:a,inputShape:l}=r,c=Xa(l,s.shape,a,1,o),u=new RT(c);return n.runWebGLProgram(u,[i,s],"float32")}},zT=RS({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),BT={kernelName:Lt,backendName:"webgl",kernelFunc:zT},UT=RS({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),VT={kernelName:Dt,backendName:"webgl",kernelFunc:UT};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class jT{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,o,a,l]=t,[c]=e,[u,h]=n;this.outputShape=[c,u,h,l];const d="bilinear"===r?1:0,[p,f]=[o-1+".0",a-1+".0"],[m,g,y]=u>1?[""+(o-1)/(u-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,v,x]=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const WT={kernelName:Bt,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=r,u=new jT(i.shape,s.shape,a,l,c);return n.runWebGLProgram(u,[i,s,o],"float32")}};var HT;!function(t){t.Prod="*",t.Sum="+"}(HT||(HT={}));class GT{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,s=this.op===HT.Prod?"1.0":"0.0",o=n?s:`getX(${qT(i,"coords",this.op)})`,a=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=r?"end != "+(a-1):"end != 0",c=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${a}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${Uw(i)} coords = getOutputCoords();\n        int end = ${XT(i,"coords",this.op)};\n        float val = ${o};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${c};\n          ${XT(i,"coords",this.op)} = idx;\n          val ${this.op}= getX(${qT(i,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function qT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function XT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function YT(t,e,n,r,i,s){const o=e.shape.length,a=nc([r],o);let l=e;null!=a&&(l=QS({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=ic(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const u=l.shape[c];let h=SS({inputs:{x:l},backend:n});for(let e=0;e<=Math.ceil(Math.log2(u))-1;e++){const r=new GT(t,l.shape,!1,s),i=[[e]],o=h;h=n.runWebGLProgram(r,[h],h.dtype,i),n.disposeIntermediateTensorInfo(o)}if(i){const e=new GT(t,l.shape,i,s),r=h;h=n.runWebGLProgram(e,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=a){const t=QS({inputs:{x:h},backend:n,attrs:{perm:rc(a)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),t}return h}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const KT={kernelName:Ft,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return YT(HT.Prod,i,n,s,o,a)}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ZT={kernelName:zt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:o,reverse:a}=r;return YT(HT.Sum,i,n,s,o,a)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const JT={kernelName:Ut,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:o,binaryOutput:a}=r;if(1===i.shape.length){const t=n.readSync(i.dataId),e=n.readSync(s.dataId),r=p_(t,e,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,r)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(s),r=f_(t,e,o,a);return n.makeTensorInfo(r.shape,s.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class QT{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tE={kernelName:Vt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:o}=r,a=i.shape[0],l=("NHWC"===o?i.shape[1]:i.shape[2])*s,c=("NHWC"===o?i.shape[2]:i.shape[3])*s,u=("NHWC"===o?i.shape[3]:i.shape[1])/(s*s),h=new QT("NHWC"===o?[a,l,c,u]:[a,u,l,c],s,o);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class eE{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Xw(this.outputShape.length);const s=t.filterHeight,o=t.filterWidth,a=t.outChannels/t.inChannels;let l="",c="";n&&(l=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const u=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${u}\n        ${c}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class nE{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Xw(this.outputShape.length);const s=t.outChannels/t.inChannels,o=t.padInfo.left,l=t.strideWidth,c=t.dilationWidth,u=t.filterHeight,h=t.filterWidth,d=h;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<h;t++)p+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;p+=`\n    for (int r = 0; r < ${u}; r++) {\n      `;for(let t=0;t<h;t++)p+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(d+1)/2;t++){const e=2*t;if(p+=`\n          xC = xCCorner + ${e*c};\n          `,1===l){if(e<h&&(o%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,p+=1===c&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<h)){const t=o%2==0?a(c):c;c%2==0&&o%2==1||c%2!=0&&o%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,p+=c>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):p+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<h&&(o%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<h&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<h&&(p+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<h&&(p+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<h&&(p+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let f="",m="";n&&(f=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");const g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${f}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${g}\n        ${m}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rE={kernelName:jt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=r;let h=l;null==h&&(h=[1,1]),u(el(o,h),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`));const d=qa(i.shape,s.shape,o,h,a,c,!0);let p;p=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new nE(d):new eE(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(p,[i,s],"float32",f)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class iE{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class sE{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.top,o=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const oE={kernelName:Wt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,h=qa(i.shape,u,o,a,l,c,!0),d=new iE(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const aE={kernelName:Ht,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,h=qa(u,s.shape,o,a,l,c,!0),d=new sE(h);return n.runWebGLProgram(d,[i,s],"float32")}};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class lE{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cE={kernelName:Gt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],s=f(r.shape),o=jS({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new lE(s),l=n.runWebGLProgram(a,[o],o.dtype),c=jS({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class uE{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:i,strideWidth:s,filterHeight:o,filterWidth:a,dilationHeight:l,dilationWidth:c}=t,{top:u,left:h}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${s});\n      const ivec2 pads = ivec2(${u}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${o}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const hE={kernelName:qt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:o,pad:a,dilations:l}=r,c=Wa(i.shape,s.shape,o,a,"NHWC",l);let u;const h=new uE(c);u=n.runWebGLProgram(h,[i,s],"float32");const d=jS({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dE={kernelName:Zt,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:o,summedDims:a,idDims:l}=Jp(i,s.length);tf(o.length,l,s);const{path:c,steps:u}=ef(a,l),h=u.length;let d=null,p=o.length;const f=[];for(let t=0;t<h;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=Qp(p,l[e]);let i;nf(t)?i=s[e]:(i=QS({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(i));const o=i.shape.slice();for(let t=0;t<r.length;++t)o.splice(r[t],0,1);m(i.shape,o)||(i=jS({inputs:{x:i},backend:n,attrs:{shape:o}}),f.push(i)),null===d?d=i:(d=US({inputs:{a:i,b:d},backend:n}),f.push(d))}t<h-1&&(c[t]>=0&&(d=ZS({inputs:{x:d},backend:n,attrs:{axis:c[t]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const t of f)t!==d&&n.disposeIntermediateTensorInfo(t);return d}},pE=RS({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),fE={kernelName:Jt,backendName:"webgl",kernelFunc:pE},mE={kernelName:Qt,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _S("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new wS("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)}},gE=OS({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:b_}),yE={kernelName:ee,backendName:"webgl",kernelFunc:gE},bE=RS({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${Lp};\n  float a1 = ${Dp};\n  float a2 = ${Fp};\n  float a3 = ${zp};\n  float a4 = ${Bp};\n  float a5 = ${Up};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),vE={kernelName:te,backendName:"webgl",kernelFunc:bE},xE=RS({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:v_,dtype:"float32"}),wE={kernelName:ne,backendName:"webgl",kernelFunc:xE};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function _E(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(u(-(o+1)<=i,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),l=o+i+1),a.splice(l,0,1),jS({inputs:{x:s},backend:r,attrs:{shape:a}})}const SE={kernelName:re,backendName:"webgl",kernelFunc:_E},kE="return exp(x) - 1.0;",TE=RS({opSnippet:kE,packedOpSnippet:kE,cpuKernelImpl:x_}),EE={kernelName:ie,backendName:"webgl",kernelFunc:TE};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class ME{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0";let o;if("real"===t)o="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function CE(t,e,n){const r=n.texData.get(t.dataId),i=f(t.shape),s=t.shape[t.shape.length-1],o=jS({inputs:{x:t},backend:n,attrs:{shape:[i/s,s]}}),a=o.shape,l=new ME("real",a,e),c=new ME("imag",a,e),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:a},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:a}],h=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(c,u,"float32"),p=TS({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const m=jS({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(p),m}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const AE={kernelName:se,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return CE(r,!1,n)}};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class NE{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function IE(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||O(i),"string"===s){const t=k(s,f(r));return t.fill(i),e.makeTensorInfo(r,s,t)}{const t=new NE(r,i),n=[[i]];return e.runWebGLProgram(t,[],s,n)}}const $E={kernelName:oe,backendName:"webgl",kernelFunc:IE};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class RE{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const OE={kernelName:ae,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new RE(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},PE="return floor(x);",LE=RS({opSnippet:PE,packedOpSnippet:PE,cpuKernelImpl:w_}),DE={kernelName:le,backendName:"webgl",kernelFunc:LE},FE=OS({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),zE={kernelName:ce,backendName:"webgl",kernelFunc:FE};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class BE{constructor(t){this.variableNames=["A"];const e=kw(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class UE{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=kw(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const VE={kernelName:sr,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,c]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[c,l],h=[c,l,s];if(a||o){const t=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=jE&&t===WE||(WE=t,jE=document.createElement("canvas").getContext("2d",{willReadFrequently:WE})),jE.canvas.width=l,jE.canvas.height=c,jE.drawImage(i,0,0,l,c),i=jE.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=qx.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const p=K().getBool("WEBGL_PACK")?new UE(h):new BE(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */};let jE,WE=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const HE={kernelName:lr,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=nl(u),g=qa(i.shape,s.shape,l,h,c,d,!1,m);let y;const b=[],v=null!=o,x=null!=a,w="leakyrelu"===p,_=()=>{const t=[i,s],e=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=jS({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return b.push(e),e}return t};if(v&&t.push(e(o,u)),x&&t.push(e(a,u)),w){const e=n.makeTensorInfo([],"float32",oi(f,"float32"));t.push(e),b.push(e)}return t};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&K().getBool("WEBGL_EXP_CONV")){const t=p?PS(p,!0):null,e=new kT(g,v,t,x,w),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],i=_();y=n.runWebGLProgram(e,i,"float32",r)}else if(K().getBool("WEBGL_CONV_IM2COL"))y=CT({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const t=p?PS(p,!1):null,e=new _T(g,v,t,x,w),r=_();y=n.runWebGLProgram(e,r,"float32")}else y=MT({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});const S=jS({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),S}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const GE={kernelName:cr,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[];let g=h;null==g&&(g=[1,1]),u(el(l,g),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`));const y=qa(i.shape,s.shape,l,g,c,d,!0),b=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,v=p?PS(p,b):null,x=[i,s],w=null!=o,_=null!=a,S="leakyrelu"===p;if(w&&x.push(o),_&&x.push(a),S){const t=n.makeTensorInfo([],"float32",oi(f,"float32"));x.push(t),m.push(t)}let k;k=b?new nE(y,w,v,_,S):new eE(y,w,v,_,S);const T=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],E=n.runWebGLProgram(k,x,"float32",T);return m.forEach((t=>n.disposeIntermediateTensorInfo(t))),E}};class qE{constructor(t,e,n,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=Uw(n.length);let s="\n    int index;";for(let t=0;t<this.sliceDim;t++)s+=`\n          index = round(getIndices(coords[0], ${t}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[t]};\n          flattenIndex += index * ${this.strides[t]};`;this.userCode=`\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${s}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const XE={kernelName:de,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=i.shape,o=s[s.length-1],a=f(r.shape),[l,c,u,h]=Zo(r,i),d=jS({inputs:{x:i},backend:n,attrs:{shape:[c,o]}}),p=jS({inputs:{x:r},backend:n,attrs:{shape:[f(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const t=n.readSync(i.dataId),e=n.bufferSync(r),s=__(t,e,r.dtype,c,o,u,h,r.shape,a);return n.makeTensorInfo(l,r.dtype,s.values)}const m=new qE(o,h,[c,u],r.shape),g=n.runWebGLProgram(m,[p,d],p.dtype),y=jS({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),y}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class YE{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=Uw(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function KE(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:o,batchDims:a}=r,l=w(o,i.shape)[0];if(K().get("DEBUG")){const t=n.readSync(s.dataId),e=i.shape[l];for(let n=0;n<t.length;++n){const r=t[n];u(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const c=xf(i,s,l,a),h=f(s.shape),d=[],p=jS({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),m=jS({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,h/c.batchSize]}});d.push(p),d.push(m);const g=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){const t=n.bufferSync(m),e=n.bufferSync(p),r=S_(e,t,g);return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const y=new YE(p.shape,g),b=n.runWebGLProgram(y,[p,m],p.dtype);d.push(b);const v=jS({inputs:{x:b},backend:n,attrs:{shape:c.outputShape}});return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}const ZE={kernelName:he,backendName:"webgl",kernelFunc:KE},JE=OS({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:k_,dtype:"bool"}),QE={kernelName:pe,backendName:"webgl",kernelFunc:JE},tM=OS({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:T_}),eM={kernelName:fe,backendName:"webgl",kernelFunc:tM};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const nM={kernelName:ge,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n}=t,{input:r}=e;return CE(r,!0,n)}},rM=RS({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),iM={kernelName:be,backendName:"webgl",kernelFunc:rM},sM=RS({opSnippet:"return float(isinf(x));",dtype:"bool"}),oM={kernelName:ve,backendName:"webgl",kernelFunc:sM},aM=RS({opSnippet:"return float(isnan(x));",dtype:"bool"}),lM={kernelName:xe,backendName:"webgl",kernelFunc:aM},cM=OS({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:E_,dtype:"bool"}),uM={kernelName:_e,backendName:"webgl",kernelFunc:cM},hM=OS({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:M_,dtype:"bool"}),dM={kernelName:Se,backendName:"webgl",kernelFunc:hM};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const pM={kernelName:ke,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,o=C_(r,i,s);return e.makeTensorInfo([o.length],"float32",o)}},fM=RS({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:A_}),mM={kernelName:Te,backendName:"webgl",kernelFunc:fM},gM=RS({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),yM={kernelName:Ee,backendName:"webgl",kernelFunc:gM},bM=OS({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),vM={kernelName:Me,backendName:"webgl",kernelFunc:bM},xM=RS({opSnippet:"return float(!(x >= 1.0));"}),wM={kernelName:Ce,backendName:"webgl",kernelFunc:xM},_M=OS({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),SM={kernelName:Ae,backendName:"webgl",kernelFunc:_M};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class kM{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TM{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const EM={kernelName:Ie,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=r,c=K().getBool("WEBGL_PACK_NORMALIZATION")?new TM(i.shape,s,o,a,l):new kM(i.shape,s,o,a,l);return n.runWebGLProgram(c,[i],i.dtype)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class MM{constructor(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const CM={kernelName:$e,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r,h=new MM(i.shape,a,l,c,u);return n.runWebGLProgram(h,[i,s,o],i.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function AM(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,l=w(s,i.shape);let c=l;const u=nc(c,a),h=null!=u,d=n.shouldExecuteOnCPU([i]);let p=i;if(h){if(d){const t=n.texData.get(p.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=i.shape[u[t]];const r=nS(t,i.shape,i.dtype,u,e);p=n.makeTensorInfo(e,i.dtype);n.texData.get(p.dataId).values=r}else p=KS(i,u,n);c=ic(c.length,a)}ec("max",c,a);const[m,g]=Ql(p.shape,c);let y,b=m;if(o&&(b=tc(m,l)),d){const t=n.texData.get(p.dataId).values,e=N_(t,f(g),b,i.dtype);y=n.makeTensorInfo(b,i.dtype);n.texData.get(y.dataId).values=e}else y=
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r){const i=f(e),s=jS({inputs:{x:t},attrs:{shape:[f(t.shape)/i,i]},backend:r}),o=qS(s,t.dtype,"max",r),a=jS({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(p,g,b,n);return h&&n.disposeIntermediateTensorInfo(p),y}const NM={kernelName:Re,backendName:"webgl",kernelFunc:AM},IM=OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:I_}),$M={kernelName:Oe,backendName:"webgl",kernelFunc:IM};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const RM={kernelName:Pe,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;_w(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=r;u(el(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=Ha(i.shape,s,o,1,a,l);if(1===c.filterWidth&&1===c.filterHeight&&m(c.inShape,c.outShape))return SS({inputs:{x:i},backend:n});const h=new Ok(c,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const OM={kernelName:De,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=Ga(i.shape,s,o,[1,1,1],a,c,l),h=new Pk(u,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PM{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,s=t.effectiveFilterWidth,o=i-1-t.padInfo.top,a=s-1-t.padInfo.left,l=i*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class LM{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=a-1-t.padInfo.front,h=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=a*l*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${u}, ${h}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${o}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DM={kernelName:Fe,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,h=Ga(o.shape,a,l,[1,1,1],c,u),d=new Pk(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),f=new LM(h),m=n.runWebGLProgram(f,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const FM={kernelName:Le,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:o}=e,a=s;_w([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=Ha(a.shape,l,c,1,u,h),p=new Ok(d,"max",!0),f=n.runWebGLProgram(p,[a],a.dtype),m=new PM(d),g=n.runWebGLProgram(m,[i,f],a.dtype);return n.disposeIntermediateTensorInfo(f),g}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const zM={kernelName:ze,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;u(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const c=[1,1];u(el(s,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`));const h=Ha(r.shape,i,s,c,o),[d,p]=function(t,e,n,r){let i=new Ok(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");return i=new Ok(n,"max",!0,!0,e),[s,r.runWebGLProgram(i,[t],"float32")]}(r,a,h,l);return[d,p]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const BM={kernelName:Be,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:s}=e,o=n,a=r.shape.length,l=w(s,r.shape);let c=l;const u=nc(c,a),h=null!=u,d=o.shouldExecuteOnCPU([r]),p=[];let m=r;if(h){if(d){const t=o.texData.get(m.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=r.shape[u[t]];const n=nS(t,r.shape,r.dtype,u,e);m=o.makeTensorInfo(e,r.dtype);o.texData.get(m.dataId).values=n}else m=KS(r,u,o);p.push(m),c=ic(c.length,a)}ec("sum",c,a);const[g,y]=Ql(m.shape,c);let b=g;i&&(b=tc(g,l));const v=function(t,e,n,r){const i=f(e),s=jS({inputs:{x:t},attrs:{shape:[f(t.shape)/i,i]},backend:r}),o=qS(s,"float32","mean",r),a=jS({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}(m,y,b,o);for(const t of p)o.disposeIntermediateTensorInfo(t);return v}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const UM={kernelName:Ue,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=w(s,i.shape);let c=l;const u=nc(c,a);let h=i;null!=u&&(h=QS({inputs:{x:i},backend:n,attrs:{perm:u}}),c=ic(c.length,i.shape.length)),ec("min",c,a);const[d,p]=Ql(h.shape,c),m=jS({inputs:{x:h},backend:n,attrs:{shape:[-1,f(p)]}}),g=qS(m,m.dtype,"min",n);let y;if(o){y=jS({inputs:{x:g},backend:n,attrs:{shape:tc(d,l)}})}else y=jS({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=u&&n.disposeIntermediateTensorInfo(h),y}},VM=OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:$_}),jM={kernelName:Ve,backendName:"webgl",kernelFunc:VM};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class WM{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Uw(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class HM{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Uw(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=sS("rc",r),l=sS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,h="reflect"===n?0:1;let d="";if(1===r){const t=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n      `}else{const t=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n        rc = outputLoc;\n        ${a[r-2]} += 1;\n        if(${a[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${l.join()}), ${u});\n          ${a[r-1]} += 1;\n          if(${c}) {\n            ${t}\n            result[3] = getChannel(getX(${l.join()}), ${u});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const GM={kernelName:je,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:s}=n,o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HM(r.shape,i,s):new WM(r.shape,i,s);return e.runWebGLProgram(o,[r],r.dtype)}},qM=OS({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),XM={kernelName:We,backendName:"webgl",kernelFunc:qM};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class YM{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const KM=OS({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),ZM={kernelName:Kt,backendName:"webgl",kernelFunc:KM},JM="return a - b;",QM=OS({opSnippet:JM,packedOpSnippet:JM,supportsComplex:!0,cpuKernelImpl:Q_}),tC={kernelName:qn,backendName:"webgl",kernelFunc:QM};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function eC(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,o=w([s],i.shape),a=AM({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=tc(a.shape,o),c=jS({inputs:{x:a},backend:n,attrs:{shape:l}}),u=QM({inputs:{a:i,b:c},backend:n}),h=xE({inputs:{x:u},backend:n}),d=ZS({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=jS({inputs:{x:d},backend:n,attrs:{shape:l}}),f=KM({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const nC={kernelName:Pn,backendName:"webgl",kernelFunc:eC};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rC={kernelName:He,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:o,normalized:a}=r,l=a?i:eC({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new YM(c,u,s),d=[[o]],p=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),p}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const iC={kernelName:qe,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,i]=O_(t.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,e)}let i;return i=K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new mS(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new dS(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(i,[r],r.dtype)}},sC=bd;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const oC={kernelName:Ye,backendName:"webgl",kernelFunc:function(t){ur("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,c=n.readSync(i.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=sC(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},aC=vd;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lC={kernelName:Ke,backendName:"webgl",kernelFunc:function(t){ur("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=aC(u,h,o,a,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},cC=xd;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const uC={kernelName:Ze,backendName:"webgl",kernelFunc:function(t){ur("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=n.readSync(i.dataId),h=n.readSync(s.dataId),d=o,p=a,f=l,m=c,{selectedIndices:g,selectedScores:y}=cC(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class hC{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const dC={kernelName:Qe,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:o,onValue:a,offValue:l}=r,c=f(i.shape),u=new hC(c,o,a,l),h=jS({inputs:{x:i},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);const p=jS({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,o]}});return n.disposeIntermediateTensorInfo(d),p}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function pC(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=nT({inputs:{input:r},backend:n}),e=pC({inputs:{x:t},backend:n}),i=yT({inputs:{input:r},backend:n}),s=pC({inputs:{x:i},backend:n}),o=TS({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}return IE({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const fC={kernelName:rr,backendName:"webgl",kernelFunc:pC};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mC={kernelName:Je,backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const e=nT({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=yT({inputs:{input:i},backend:r}),o=pC({inputs:{x:s},backend:r}),a=TS({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),a}return IE({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const gC={kernelName:tn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return _E({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,o=e[0].dtype;e.forEach((t=>{h(s,t.shape,"All tensors passed to stack must have matching shapes"),u(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],l=xT({inputs:e.map((t=>{const e=_E({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class yC{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Uw(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class bC{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=Uw(r),s=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=sS("rc",r),l=sS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${a[r-1]} += 1;\n       if(${c}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${c}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===r?2:4;t<e;t++)p+=`\n        ${h[t]}\n        if (${d}) {\n          result[${t}] = float(value);\n        } else {\n          ${i} source = rc - start;\n          result[${t}] = getChannel(getX(${l.join()}), ${u});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vC=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:o}=r;if(0===f(i.shape)){const t=s.map(((t,e)=>t[0]+i.shape[e]+t[1]));return IE({backend:n,attrs:{shape:t,value:o,dtype:i.dtype}})}const a=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bC(i.shape,s,o):new yC(i.shape,s,o),l=[[o]];return n.runWebGLProgram(a,[i],i.dtype,l)},xC={kernelName:en,backendName:"webgl",kernelFunc:vC},wC=OS({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),_C={kernelName:nn,backendName:"webgl",kernelFunc:wC};const SC={kernelName:sn,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:o}=r,a=i.shape.length,l=[],c=w(s,i.shape);let u=c;const h=nc(u,a);let d,p=i;if(null!=h&&(p=QS({inputs:{x:i},backend:n,attrs:{perm:h}}),u=ic(u.length,a),l.push(p)),ec("prod",u,a),n.shouldExecuteOnCPU([p])){const t=n.texData.get(p.dataId).values,{outVals:e,outShape:r,outDtype:i}=L_(p.shape,p.dtype,t,u);d=n.makeTensorInfo(r,i,e)}else{const[t,e]=Ql(p.shape,u),r=f(e),s=jS({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),o=qS(s,Ri(i.dtype),"prod",n);d=jS({inputs:{x:o},backend:n,attrs:{shape:t}}),l.push(s),l.push(o)}if(o){l.push(d);const t=tc(d.shape,c);d=jS({inputs:{x:d},backend:n,attrs:{shape:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const kC={kernelName:on,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=e,{outputRaggedRank:a}=r,l=i.map((t=>n.readSync(t.dataId))),c=i.map((t=>t.shape)),u=n.readSync(s.dataId),h=n.readSync(o.dataId),[d,p,f]=D_(l,c,u,s.shape,s.dtype,h,o.shape,a),m=d.map((t=>n.makeTensorInfo([t.length],"int32",t))),g=n.makeTensorInfo(f,s.dtype,p);return m.concat([g])}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const TC={kernelName:an,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=n.readSync(i.dataId),u=n.readSync(s.dataId),h=n.readSync(o.dataId),d=a.map((t=>n.readSync(t.dataId))),p=a.map((t=>t.shape)),[f,m]=F_(c,i.shape,u,s.shape,s.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}},EC=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:s,dtype:o}=n,a=z_(r,i,s,o);return e.makeTensorInfo([a.length],o,a)},MC={kernelName:ln,backendName:"webgl",kernelFunc:EC},CC=RS({opSnippet:"return 1.0 / x;"}),AC={kernelName:un,backendName:"webgl",kernelFunc:CC},NC=RS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),IC={kernelName:hn,backendName:"webgl",kernelFunc:NC},$C=RS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),RC={kernelName:yn,backendName:"webgl",kernelFunc:$C};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class OC{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PC{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let h;h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const LC={kernelName:mn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new PC(i.shape,l,c,s,o):new OC(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],"float32")}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DC{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],c=a[0]/l[0],u=a[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const FC={kernelName:gn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new DC(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class zC{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class BC{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,a,l]=t;this.outputShape=[s,e,n,l];const c=[r&&e>1?o-1:o,r&&n>1?a-1:a],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const UC={kernelName:pn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:o,size:a}=r,[l,c]=a,u=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new BC(i.shape,l,c,s,o):new zC(i.shape,l,c,s,o);return n.runWebGLProgram(u,[i],i.dtype)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class VC{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,o]=t,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],c=a[0]/l[0],u=a[1]/l[1],h=1/c,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const jC={kernelName:fn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:o}=r,a=new VC(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class WC{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),i=Uw(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class HC{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=sS("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=Uw(n);function a(n){const r=t.map(((r,i)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(i,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return a(t)}(r.slice())};\n          if(${i}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",a(t)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const GC={kernelName:bn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r,o=i.shape.length,a=w(s,i.shape);if(0===o)return SS({inputs:{x:i},backend:n});const l=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HC(i.shape,a):new WC(i.shape,a);return n.runWebGLProgram(l,[i],i.dtype)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class qC{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let i="";i="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${i}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const XC={kernelName:or,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=new qC(r.shape,s),[c,u]=Cp(o,r.shape[1],r.shape[2]),h=[[c,u,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(l,[r],r.dtype,h)}},YC=RS({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),KC={kernelName:vn,backendName:"webgl",kernelFunc:YC},ZC=RS({opSnippet:"return inversesqrt(x);",cpuKernelImpl:B_}),JC={kernelName:xn,backendName:"webgl",kernelFunc:ZC};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class QC{constructor(t,e,n,r,i,s,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const a=Uw(i.length),l=Uw(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const u=`getIndices(${c})`;let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d=`getUpdates(${h})`,p=e>1?"strides[j]":"strides";this.userCode=`\n        ${a} strides = ${a}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${u});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${d};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tA={kernelName:wn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=ea(0,i,o),d=[h/c,c];if(0===h)return n.makeTensorInfo(o,i.dtype);const p=jS({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),f=jS({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new QC(l,a,p.shape.length,f.shape.length,u,d),y=n.runWebGLProgram(g,[f,p,m],f.dtype),b=jS({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class eA{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,s=2===K().getNumber("WEBGL_VERSION")?"while (left < right) {":i,o="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${s}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${o} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const nA={kernelName:_n,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:o}=r,a=new eA(i.shape[0],i.shape[1],s.shape[1],o),l=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",l)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class rA{constructor(t,e,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],o=[];for(let r=0;r<e.length;r++)o.push(`${n[r]}`),r<t&&s.push(`${n[r]}`);r=s.join(),i=o.join()}const s=Uw(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const iA={kernelName:Sn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e,o=new rA(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],$i(i.dtype,s.dtype))}},sA=RS({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ${Pp};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),oA={kernelName:kn,backendName:"webgl",kernelFunc:sA},aA=RS({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:V_}),lA={kernelName:An,backendName:"webgl",kernelFunc:aA},cA=RS({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),uA={kernelName:Cn,backendName:"webgl",kernelFunc:cA},hA=RS({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),dA={kernelName:En,backendName:"webgl",kernelFunc:hA},pA=RS({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),fA={kernelName:Mn,backendName:"webgl",kernelFunc:pA},mA=RS({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),gA={kernelName:Nn,backendName:"webgl",kernelFunc:mA},yA={kernelName:Rn,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:o}=r;u(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=s.reduce(((t,e)=>t*e)),l=[[0,0]];l.push(...o);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const c=[],h=vC({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),d=Ap(h.shape,s,a,!1),p=Np(d.length,s.length,!1),f=Ip(h.shape,s,a,!1),m=jS({inputs:{x:h},backend:n,attrs:{shape:d}}),g=QS({inputs:{x:m},backend:n,attrs:{perm:p}}),y=jS({inputs:{x:g},backend:n,attrs:{shape:f}});return c.push(h),c.push(m),c.push(g),c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bA={kernelName:Ln,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:o}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n         ${i.shape}`);if(0!==o.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,d,p,f,m]=H_(a,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const vA={kernelName:Dn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,h]=G_(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const xA={kernelName:Fn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=q_(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const wA={kernelName:zn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),l=n.readSync(s.dataId),[c,u]=q_(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(u,r.dtype,c)}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const _A={kernelName:Bn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=ea(0,i,a);if("string"===s.dtype){const t=n.bufferSync(i),e=n.bufferSync(s),r=ui(n.readSync(o.dataId)[0]),p=U_(t,e,a,d,u,c,l,h,r,false);return n.makeTensorInfo(a,p.dtype,p.values)}const p=new QC(c,l,i.shape.length,s.shape.length,h,[d,1],false),f=n.runWebGLProgram(p,[s,i,o],s.dtype),m=jS({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(f),m}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const SA={kernelName:On,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:o}=r,a=w(o,i.shape)[0],l=sf(i,s,a),c=i.shape.length,u=new Array(c).fill(0),h=i.shape.slice();return l.map((t=>{const e=[...h];e[a]=t;const r=Yk({inputs:{x:i},backend:n,attrs:{begin:u,size:e}});return u[a]+=t,r}))}},kA="return sqrt(x);",TA=RS({opSnippet:kA,packedOpSnippet:kA,cpuKernelImpl:X_}),EA={kernelName:In,backendName:"webgl",kernelFunc:TA},MA={kernelName:Vn,backendName:"webgl",kernelFunc:RS({opSnippet:"return x * x;"})},CA="return (a - b) * (a - b);",AA=OS({opSnippet:CA,packedOpSnippet:CA}),NA={kernelName:Un,backendName:"webgl",kernelFunc:AA};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const IA={kernelName:ir,backendName:"webgl",kernelFunc:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,s=new dS(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class $A{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=Uw(n.length),s=Uw(n.length);let o="";if(1===r)o="coords * strides + begin";else{let t=0;o=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const RA={kernelName:jn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:y,isSimpleSlice:b,begin:v,end:x,strides:w}=ga(i.shape,s,o,a,l,c,h,d,p);let _;if(g)_=jS({inputs:{x:i},backend:n,attrs:{shape:m}});else if(y||b){u(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=ia(v,x,w),e=Yk({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});_=jS({inputs:{x:e},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([i])){const t=n.readSync(i.dataId),e=eo(i.shape,i.dtype,t),r=Y_(f,e,w,v);_=n.makeTensorInfo(m,i.dtype,r.values)}else{const t=new $A(v,w,f);_=n.runWebGLProgram(t,[i],i.dtype)}}const S=jS({inputs:{x:_},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(_),S}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const OA={kernelName:Wn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=e,d=n.readSync(u.dataId),p=n.readSync(h.dataId),[f,m]=K_(d,p,i,s,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const PA={kernelName:Hn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:o}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==o.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId)[0],[c,u,h]=Z_(a,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const LA={kernelName:Gn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=J_(o,i);return n.makeTensorInfo(s.shape,"int32",a)}},DA=RS({opSnippet:"return tan(x);"}),FA={kernelName:Xn,backendName:"webgl",kernelFunc:DA},zA=RS({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),BA={kernelName:Yn,backendName:"webgl",kernelFunc:zA};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class UA{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const r=Uw(this.rank),i=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let e=0;e<t.length;e++)r.push(`imod(${n[e]}, ${t[e]})`);return r.join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function VA(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;if("string"===i.dtype||i.shape.length>5){const t=n.readSync(i.dataId),e="string"===i.dtype?t.map((t=>ui(t))):t,r=eo(i.shape,i.dtype,e),o=tS(r,s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new UA(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const jA={kernelName:Kn,backendName:"webgl",kernelFunc:VA};class WA{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class HA{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function GA(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function qA(t){let e=1;for(;e<t;)e*=2;return e}const XA={kernelName:Zn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:o}=r,a=K().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=K().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([i])||u<a||s>l){const t=n.readSync(i.dataId),[e,r]=eS(t,c,i.dtype,s,o);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===s)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[i,IE({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(i.dataId),d=null!==h&&h.isPacked,p=d?n.unpackTensor(i):i,m=f(c)/u,g=jS({inputs:{x:p},attrs:{shape:[m,u]},backend:n});d&&GA(n,p);const y=qA(s),b=qA(u);let v=null;const x=()=>null===v?[g,g]:[g,v],w=(t,e,r)=>{const i=x(),s=new WA(r),o=[[u],[null===v?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],a=v;v=n.runWebGLProgram(s,i,"int32",o),GA(n,a)};for(let t=1;t<y;t*=2){const e=2*t;for(let n=t;n>=1;n/=2)w(e,n,[m,b])}for(let t=b;t>y;t/=2){const e=x(),r=new HA([m,t/2]),i=[[u],[null===v?1:0],[y]],s=v;v=n.runWebGLProgram(r,e,"int32",i),GA(n,s);const o=y/2,a=2*o;for(let t=o;t>=1;t/=2)w(a,t,v.shape)}let _=v;v=Yk({inputs:{x:v},backend:n,attrs:{begin:0,size:[m,s]}}),GA(n,_);let S=KE({inputs:{x:g,indices:v},backend:n,attrs:{axis:1,batchDims:1}});GA(n,g);const k=c.slice(0,-1);k.push(s),_=v,v=jS({inputs:{x:v},attrs:{shape:k},backend:n}),GA(n,_);const T=S;return S=jS({inputs:{x:S},attrs:{shape:k},backend:n}),GA(n,T),[S,v]}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class YA{constructor(t,e,n,r,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const o="nearest"===n?1:2;let a;switch(r){case"constant":default:a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${a} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${i});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${i});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${o} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const KA={kernelName:Jn,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=r,[u,h,d,p]=i.shape,[f,m]=null!=c?c:[h,d],g=new YA(h,d,o,a,l,[u,f,m,p]);return n.runWebGLProgram(g,[i,s],"float32")}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ZA={kernelName:tr,backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;_w(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:l,indices:c}=rS(o,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const JA={kernelName:er,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,l=i.shape[s],c=new Array(a-1);let u=0;for(let t=0;t<a;t++)t!==s&&(c[u++]=o.shape[t]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[s]=1;const f=new Array(l);for(let t=0;t<f.length;t++){d[s]=t;const e=Yk({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),r=jS({inputs:{x:e},backend:n,attrs:{shape:c}});f[t]=r,h.push(e)}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class QA{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=t.numSegments,o=s*Math.ceil(i/n);this.outputShape=[r,o];const a=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";i%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let h="";i%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${c}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${c}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${c}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tN={kernelName:nr,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:o}=r,a=i.shape.length,l=[];let c=0;const u=nc([c],a);let h=i;null!=u&&(h=QS({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(h),c=ic(1,a)[0]);const d=vf(h.shape,c,o),p=f([h.shape[c]]),m=jS({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(m);const g=Ri(i.dtype),y=(t,e,r,i,s)=>{const o=t.shape[0],a=t.shape[1],c=bf(a,s),u=new QA({windowSize:c,inSize:a,batchSize:o,numSegments:s},e),h=n.compileAndRun(u,[t,r],i);if(l.push(h),h.shape[1]===s)return h;const d=EC({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=VA({inputs:{x:d},backend:n,attrs:{reps:[a/c]}});l.push(d),l.push(p);return y(h,e,p,i,s)},b=jS({inputs:{x:y(m,"unsortedSegmentSum",s,g,o)},backend:n,attrs:{shape:d}});let v=b;if(null!=u){l.push(b);const t=rc(u);v=QS({inputs:{x:v},backend:n,attrs:{perm:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}},eN=[nk,ik,ok,lk,hk,fk,mk,gk,_k,Sk,Tk,Mk,Ak,Ik,Rk,Lk,Dk,Bk,Uk,Vk,Hk,Zk,Jk,Qk,iT,aT,uT,ES,pT,wT,AT,OT,PT,LT,DT,FT,BT,VT,WT,KT,ZT,JT,tE,rE,oE,aE,cE,hE,dE,fE,mE,yE,vE,wE,SE,EE,AE,$E,OE,DE,zE,VE,HE,GE,XE,ZE,QE,eM,kS,nM,bT,iM,oM,lM,AS,uM,dM,pM,mM,yM,vM,wM,SM,EM,CM,NM,$M,RM,OM,DM,FM,zM,BM,UM,jM,GM,XM,rC,VS,iC,oC,lC,uC,eT,dC,mC,gC,xC,_C,$S,SC,kC,TC,MC,rT,ZM,AC,IC,RC,WS,LC,FC,UC,jC,GC,XC,KC,JC,tA,nA,iA,oA,lA,uA,dA,fA,Kk,nC,gA,yA,bA,vA,xA,wA,_A,SA,EA,MA,NA,IA,RA,OA,PA,LA,tC,JS,FA,BA,jA,XA,KA,tk,ZA,JA,tN,fC];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const t of eN)gr(t);function nN(){}const rN=t=>t;function iN(t){return t()}function sN(){return Object.create(null)}function oN(t){t.forEach(iN)}function aN(t){return"function"==typeof t}function lN(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let cN;function uN(t,e){return cN||(cN=document.createElement("a")),cN.href=e,t===cN.href}function hN(t,...e){if(null==t)return nN;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function dN(t){let e;return hN(t,(t=>e=t))(),e}function pN(t,e,n){t.$$.on_destroy.push(hN(e,n))}function fN(t,e,n,r){if(t){const i=mN(t,e,n,r);return t[0](i)}}function mN(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function gN(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|i[r];return t}return e.dirty|i}return e.dirty}function yN(t,e,n,r,i,s){if(i){const o=mN(e,n,r,s);t.p(o,i)}}function bN(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}const vN="undefined"!=typeof window;let xN=vN?()=>window.performance.now():()=>Date.now(),wN=vN?t=>requestAnimationFrame(t):nN;const _N=new Set;function SN(t){_N.forEach((e=>{e.c(t)||(_N.delete(e),e.f())})),0!==_N.size&&wN(SN)}function kN(t){let e;return 0===_N.size&&wN(SN),{promise:new Promise((n=>{_N.add(e={c:t,f:n})})),abort(){_N.delete(e)}}}function TN(t,e){t.appendChild(e)}function EN(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function MN(t){const e=IN("style");return function(t,e){TN(t.head||t,e),e.sheet}(EN(t),e),e.sheet}function CN(t,e,n){t.insertBefore(e,n||null)}function AN(t){t.parentNode.removeChild(t)}function NN(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function IN(t){return document.createElement(t)}function $N(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function RN(t){return document.createTextNode(t)}function ON(){return RN(" ")}function PN(){return RN("")}function LN(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function DN(t){return function(e){return e.preventDefault(),t.call(this,e)}}function FN(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function zN(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:FN(t,e,n)}function BN(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function UN(t,e){t.value=null==e?"":e}function VN(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function jN(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}let WN;function HN(){if(void 0===WN){WN=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){WN=!0}}return WN}function GN(t,e,n){t.classList[n?"add":"remove"](e)}function qN(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}class XN{constructor(t=!1){this.is_svg=!1,this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){this.e||(this.is_svg?this.e=$N(e.nodeName):this.e=IN(e.nodeName),this.t=e,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)CN(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(AN)}}const YN=new Map;let KN,ZN=0;function JN(t,e,n,r,i,s,o,a=0){const l=16.666/r;let c="{\n";for(let t=0;t<=1;t+=l){const r=e+(n-e)*s(t);c+=100*t+`%{${o(r,1-r)}}\n`}const u=c+`100% {${o(n,1-n)}}\n}`,h=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${a}`,d=EN(t),{stylesheet:p,rules:f}=YN.get(d)||function(t,e){const n={stylesheet:MN(e),rules:{}};return YN.set(t,n),n}(d,t);f[h]||(f[h]=!0,p.insertRule(`@keyframes ${h} ${u}`,p.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${h} ${r}ms linear ${i}ms 1 both`,ZN+=1,h}function QN(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),i=n.length-r.length;i&&(t.style.animation=r.join(", "),ZN-=i,ZN||wN((()=>{ZN||(YN.forEach((t=>{const{ownerNode:e}=t.stylesheet;e&&AN(e)})),YN.clear())})))}function tI(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i="none"===r.transform?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function eI(t){KN=t}function nI(){if(!KN)throw new Error("Function called outside component initialization");return KN}function rI(t){nI().$$.on_mount.push(t)}function iI(t){nI().$$.after_update.push(t)}function sI(t){nI().$$.on_destroy.push(t)}function oI(){const t=nI();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=qN(e,n,{cancelable:r});return i.slice().forEach((e=>{e.call(t,s)})),!s.defaultPrevented}return!0}}function aI(t){return nI().$$.context.get(t)}function lI(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const cI=[],uI=[],hI=[],dI=[],pI=Promise.resolve();let fI=!1;function mI(){fI||(fI=!0,pI.then(_I))}function gI(){return mI(),pI}function yI(t){hI.push(t)}function bI(t){dI.push(t)}const vI=new Set;let xI,wI=0;function _I(){const t=KN;do{for(;wI<cI.length;){const t=cI[wI];wI++,eI(t),SI(t.$$)}for(eI(null),cI.length=0,wI=0;uI.length;)uI.pop()();for(let t=0;t<hI.length;t+=1){const e=hI[t];vI.has(e)||(vI.add(e),e())}hI.length=0}while(cI.length);for(;dI.length;)dI.pop()();fI=!1,vI.clear(),eI(t)}function SI(t){if(null!==t.fragment){t.update(),oN(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(yI)}}function kI(){return xI||(xI=Promise.resolve(),xI.then((()=>{xI=null}))),xI}function TI(t,e,n){t.dispatchEvent(qN(`${e?"intro":"outro"}${n}`))}const EI=new Set;let MI;function CI(){MI={r:0,c:[],p:MI}}function AI(){MI.r||oN(MI.c),MI=MI.p}function NI(t,e){t&&t.i&&(EI.delete(t),t.i(e))}function II(t,e,n,r){if(t&&t.o){if(EI.has(t))return;EI.add(t),MI.c.push((()=>{EI.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}const $I={duration:0};function RI(t,e,n,r){let i=e(t,n),s=r?0:1,o=null,a=null,l=null;function c(){l&&QN(t,l)}function u(t,e){const n=t.b-s;return e*=Math.abs(n),{a:s,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(e){const{delay:n=0,duration:r=300,easing:h=rN,tick:d=nN,css:p}=i||$I,f={start:xN()+n,b:e};e||(f.group=MI,MI.r+=1),o||a?a=f:(p&&(c(),l=JN(t,s,e,r,n,h,p)),e&&d(0,1),o=u(f,r),yI((()=>TI(t,e,"start"))),kN((e=>{if(a&&e>a.start&&(o=u(a,r),a=null,TI(t,o.b,"start"),p&&(c(),l=JN(t,s,o.b,o.duration,0,h,i.css))),o)if(e>=o.end)d(s=o.b,1-s),TI(t,o.b,"end"),a||(o.b?c():--o.group.r||oN(o.group.c)),o=null;else if(e>=o.start){const t=e-o.start;s=o.a+o.d*h(t/o.duration),d(s,1-s)}return!(!o&&!a)})))}return{run(t){aN(i)?kI().then((()=>{i=i(),h(t)})):h(t)},end(){c(),o=a=null}}}function OI(t,e){const n=e.token={};function r(t,r,i,s){if(e.token!==n)return;e.resolved=s;let o=e.ctx;void 0!==i&&(o=o.slice(),o[i]=s);const a=t&&(e.current=t)(o);let l=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(CI(),II(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),AI())})):e.block.d(1),a.c(),NI(a,1),a.m(e.mount(),e.anchor),l=!0),e.block=a,e.blocks&&(e.blocks[r]=a),l&&_I()}if((i=t)&&"object"==typeof i&&"function"==typeof i.then){const n=nI();if(t.then((t=>{eI(n),r(e.then,1,e.value,t),eI(null)}),(t=>{if(eI(n),r(e.catch,2,e.error,t),eI(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}var i}function PI(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}const LI="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function DI(t,e){II(t,1,1,(()=>{e.delete(t.key)}))}function FI(t,e){t.f(),DI(t,e)}function zI(t,e,n,r,i,s,o,a,l,c,u,h){let d=t.length,p=s.length,f=d;const m={};for(;f--;)m[t[f].key]=f;const g=[],y=new Map,b=new Map;for(f=p;f--;){const t=h(i,s,f),a=n(t);let l=o.get(a);l?r&&l.p(t,e):(l=c(a,t),l.c()),y.set(a,g[f]=l),a in m&&b.set(a,Math.abs(f-m[a]))}const v=new Set,x=new Set;function w(t){NI(t,1),t.m(a,u),o.set(t.key,t),u=t.first,p--}for(;d&&p;){const e=g[p-1],n=t[d-1],r=e.key,i=n.key;e===n?(u=e.first,d--,p--):y.has(i)?!o.has(r)||v.has(r)?w(e):x.has(i)?d--:b.get(r)>b.get(i)?(x.add(r),w(e)):(v.add(i),d--):(l(n,o),d--)}for(;d--;){const e=t[d];y.has(e.key)||l(e,o)}for(;p;)w(g[p-1]);return g}function BI(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function UI(t){t&&t.c()}function VI(t,e,n,r){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),r||yI((()=>{const e=t.$$.on_mount.map(iN).filter(aN);t.$$.on_destroy?t.$$.on_destroy.push(...e):oN(e),t.$$.on_mount=[]})),s.forEach(yI)}function jI(t,e){const n=t.$$;null!==n.fragment&&(oN(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function WI(t,e,n,r,i,s,o,a=[-1]){const l=KN;eI(t);const c=t.$$={fragment:null,ctx:[],props:s,update:nN,not_equal:i,bound:sN(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:sN(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},((e,n,...r)=>{const s=r.length?r[0]:n;return c.ctx&&i(c.ctx[e],c.ctx[e]=s)&&(!c.skip_bound&&c.bound[e]&&c.bound[e](s),u&&function(t,e){-1===t.$$.dirty[0]&&(cI.push(t),mI(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n})):[],c.update(),u=!0,oN(c.before_update),c.fragment=!!r&&r(c.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(t),t.forEach(AN)}else c.fragment&&c.fragment.c();e.intro&&NI(t.$$.fragment),VI(t,e.target,e.anchor,e.customElement),_I()}eI(l)}class HI{$destroy(){jI(this,1),this.$destroy=nN}$on(t,e){if(!aN(e))return nN;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function GI(t){let e,n,r,i,s;const o=t[9].default,a=fN(o,t,t[8],null);return{c(){e=ON(),n=IN("button"),a&&a.c(),FN(n,"class","marcelle svelte-babmty"),n.disabled=t[2],GN(n,"outline","outline"===t[1]),GN(n,"filled","filled"===t[1]),GN(n,"light","light"===t[1]),GN(n,"success","success"===t[3]),GN(n,"warning","warning"===t[3]),GN(n,"danger","danger"===t[3]),GN(n,"size-small","small"===t[4]),GN(n,"size-large","large"===t[4]),GN(n,"round",t[5])},m(o,l){CN(o,e,l),CN(o,n,l),a&&a.m(n,null),r=!0,i||(s=[LN(document.body,"mouseup",(function(){aN(t[0]&&t[7])&&(t[0]&&t[7]).apply(this,arguments)})),LN(n,"click",t[10]),LN(n,"mousedown",t[6])],i=!0)},p(e,[i]){t=e,a&&a.p&&(!r||256&i)&&yN(a,o,t,t[8],r?gN(o,t[8],i,null):bN(t[8]),null),(!r||4&i)&&(n.disabled=t[2]),(!r||2&i)&&GN(n,"outline","outline"===t[1]),(!r||2&i)&&GN(n,"filled","filled"===t[1]),(!r||2&i)&&GN(n,"light","light"===t[1]),(!r||8&i)&&GN(n,"success","success"===t[3]),(!r||8&i)&&GN(n,"warning","warning"===t[3]),(!r||8&i)&&GN(n,"danger","danger"===t[3]),(!r||16&i)&&GN(n,"size-small","small"===t[4]),(!r||16&i)&&GN(n,"size-large","large"===t[4]),(!r||32&i)&&GN(n,"round",t[5])},i(t){r||(NI(a,t),r=!0)},o(t){II(a,t),r=!1},d(t){t&&AN(e),t&&AN(n),a&&a.d(t),i=!1,oN(s)}}}function qI(t,e,n){let{$$slots:r={},$$scope:i}=e,{variant:s="outline"}=e,{disabled:o=!1}=e,{type:a="default"}=e,{size:l="medium"}=e,{round:c=!1}=e,{pressed:u=!1}=e;const h=oI();return t.$$set=t=>{"variant"in t&&n(1,s=t.variant),"disabled"in t&&n(2,o=t.disabled),"type"in t&&n(3,a=t.type),"size"in t&&n(4,l=t.size),"round"in t&&n(5,c=t.round),"pressed"in t&&n(0,u=t.pressed),"$$scope"in t&&n(8,i=t.$$scope)},[u,s,o,a,l,c,function(){n(0,u=!0),h("pressed",u)},function(){n(0,u=!1),h("pressed",u)},i,r,function(e){lI.call(this,t,e)}]}class XI extends HI{constructor(t){super(),WI(this,t,qI,GI,lN,{variant:1,disabled:2,type:3,size:4,round:5,pressed:0})}}function YI(t){let e,n,r;return{c(){e=IN("input"),FN(e,"class","marcelle svelte-t20lcy"),e.disabled=t[2],FN(e,"type",t[3]),FN(e,"placeholder",t[1]),e.value=t[0]},m(i,s){CN(i,e,s),n||(r=LN(e,"input",t[4]),n=!0)},p(t,[n]){4&n&&(e.disabled=t[2]),8&n&&FN(e,"type",t[3]),2&n&&FN(e,"placeholder",t[1]),1&n&&e.value!==t[0]&&(e.value=t[0])},i:nN,o:nN,d(t){t&&AN(e),n=!1,r()}}}function KI(t,e,n){let{placeholder:r=""}=e,{disabled:i=!1}=e,{type:s="text"}=e,{value:o=null}=e;return t.$$set=t=>{"placeholder"in t&&n(1,r=t.placeholder),"disabled"in t&&n(2,i=t.disabled),"type"in t&&n(3,s=t.type),"value"in t&&n(0,o=t.value)},[o,r,i,s,function(t){n(0,o=t.currentTarget.value)}]}class ZI extends HI{constructor(t){super(),WI(this,t,KI,YI,lN,{placeholder:1,disabled:2,type:3,value:0})}}function JI(t){let e,n,r,i,s,o,a,l;const c=t[3].default,u=fN(c,t,t[2],null);return{c(){e=IN("div"),n=IN("div"),r=IN("div"),i=ON(),s=IN("div"),u&&u.c(),FN(r,"class","absolute inset-0 bg-gray-500 opacity-50"),FN(n,"class","overlay svelte-nr9mik"),FN(s,"class","modal svelte-nr9mik"),FN(e,"class","modal-container svelte-nr9mik")},m(c,h){CN(c,e,h),TN(e,n),TN(n,r),TN(e,i),TN(e,s),u&&u.m(s,null),o=!0,a||(l=LN(r,"click",t[0]),a=!0)},p(t,[e]){u&&u.p&&(!o||4&e)&&yN(u,c,t,t[2],o?gN(c,t[2],e,null):bN(t[2]),null)},i(t){o||(NI(u,t),o=!0)},o(t){II(u,t),o=!1},d(t){t&&AN(e),u&&u.d(t),a=!1,l()}}}function QI(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=oI();function o(){s("quit")}return t.$$set=t=>{"$$scope"in t&&n(2,i=t.$$scope)},[function(){o()},o,i,r]}class t$ extends HI{constructor(t){super(),WI(this,t,QI,JI,lN,{quit:1})}get quit(){return this.$$.ctx[1]}}function e$(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}function n$(t){const e=t-1;return e*e*e+1}function r$(t,{delay:e=0,duration:n=400,easing:r=e$,amount:i=5,opacity:s=0}={}){const o=getComputedStyle(t),a=+o.opacity,l="none"===o.filter?"":o.filter,c=a*(1-s);return{delay:e,duration:n,easing:r,css:(t,e)=>`opacity: ${a-c*e}; filter: ${l} blur(${e*i}px);`}}function i$(t,{delay:e=0,duration:n=400,easing:r=n$}={}){const i=getComputedStyle(t),s=+i.opacity,o=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:e,duration:n,easing:r,css:t=>`overflow: hidden;opacity: ${Math.min(20*t,1)*s};height: ${t*o}px;padding-top: ${t*a}px;padding-bottom: ${t*l}px;margin-top: ${t*c}px;margin-bottom: ${t*u}px;border-top-width: ${t*h}px;border-bottom-width: ${t*d}px;`}}function s$(t,{delay:e=0,duration:n=400,easing:r=n$,start:i=0,opacity:s=0}={}){const o=getComputedStyle(t),a=+o.opacity,l="none"===o.transform?"":o.transform,c=1-i,u=a*(1-s);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${l} scale(${1-c*e});\n\t\t\topacity: ${a-u*e}\n\t\t`}}function o$(t,{from:e,to:n},r={}){const i=getComputedStyle(t),s="none"===i.transform?"":i.transform,[o,a]=i.transformOrigin.split(" ").map(parseFloat),l=e.left+e.width*o/n.width-(n.left+o),c=e.top+e.height*a/n.height-(n.top+a),{delay:u=0,duration:h=(t=>120*Math.sqrt(t)),easing:d=n$}=r;return{delay:u,duration:aN(h)?h(Math.sqrt(l*l+c*c)):h,easing:d,css:(t,r)=>{const i=r*l,o=r*c,a=t+r*e.width/n.width,u=t+r*e.height/n.height;return`transform: ${s} translate(${i}px, ${o}px) scale(${a}, ${u});`}}}function a$(t,e,n){const r=t.slice();return r[5]=e[n].title,r[6]=e[n].message,r[7]=e[n].type,r[8]=e[n].id,r}function l$(t){let e;return{c(){e=$N("path"),FN(e,"d","M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0\n                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 5h2v6H9V5zm0 8h2v2H9v-2z")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function c$(t){let e;return{c(){e=$N("path"),FN(e,"d","M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0\n                4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function u$(t,e){let n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,_,S,k,T=e[5]+"",E=e[6]+"",M=nN;function C(t,e){return"default"===t[7]?c$:"danger"===t[7]?l$:void 0}let A=C(e),N=A&&A(e);function I(){return e[3](e[8])}return{key:t,first:null,c(){n=IN("div"),r=IN("div"),i=IN("div"),s=$N("svg"),N&&N.c(),o=ON(),a=IN("div"),l=IN("p"),c=RN(T),u=ON(),h=IN("p"),d=RN(E),p=ON(),f=IN("div"),m=$N("svg"),g=$N("title"),y=RN("Close"),b=$N("path"),v=ON(),FN(s,"class","notification-svg mr-4 svelte-r4ekig"),FN(s,"xmlns","http://www.w3.org/2000/svg"),FN(s,"viewBox","0 0 20 20"),GN(s,"default","default"===e[7]),GN(s,"danger","danger"===e[7]),FN(i,"class","py-1"),FN(l,"class","my-1 font-bold"),FN(h,"class","my-1 text-sm"),FN(b,"d","M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1\n              1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10\n              8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0\n              1.698z"),FN(m,"class","notification-svg ml-4 cursor-pointer svelte-r4ekig"),FN(m,"role","button"),FN(m,"xmlns","http://www.w3.org/2000/svg"),FN(m,"viewBox","0 0 20 20"),GN(m,"default","default"===e[7]),GN(m,"danger","danger"===e[7]),FN(r,"class","flex items-start"),FN(n,"class","notification-card svelte-r4ekig"),FN(n,"role","alert"),GN(n,"default","default"===e[7]),GN(n,"danger","danger"===e[7]),this.first=n},m(t,e){CN(t,n,e),TN(n,r),TN(r,i),TN(i,s),N&&N.m(s,null),TN(r,o),TN(r,a),TN(a,l),TN(l,c),TN(a,u),TN(a,h),TN(h,d),TN(r,p),TN(r,f),TN(f,m),TN(m,g),TN(g,y),TN(m,b),TN(n,v),_=!0,S||(k=LN(m,"click",I),S=!0)},p(t,r){A!==(A=C(e=t))&&(N&&N.d(1),N=A&&A(e),N&&(N.c(),N.m(s,null))),(!_||1&r)&&GN(s,"default","default"===e[7]),(!_||1&r)&&GN(s,"danger","danger"===e[7]),(!_||1&r)&&T!==(T=e[5]+"")&&BN(c,T),(!_||1&r)&&E!==(E=e[6]+"")&&BN(d,E),(!_||1&r)&&GN(m,"default","default"===e[7]),(!_||1&r)&&GN(m,"danger","danger"===e[7]),(!_||1&r)&&GN(n,"default","default"===e[7]),(!_||1&r)&&GN(n,"danger","danger"===e[7])},r(){w=n.getBoundingClientRect()},f(){!function(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,tI(t,i)}}(n),M(),tI(n,w)},a(){M(),M=function(t,e,n,r){if(!e)return nN;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return nN;const{delay:s=0,duration:o=300,easing:a=rN,start:l=xN()+s,end:c=l+o,tick:u=nN,css:h}=n(t,{from:e,to:i},r);let d,p=!0,f=!1;function m(){h&&QN(t,d),p=!1}return kN((t=>{if(!f&&t>=l&&(f=!0),f&&t>=c&&(u(1,0),m()),!p)return!1;if(f){const e=0+1*a((t-l)/o);u(e,1-e)}return!0})),h&&(d=JN(t,0,1,o,s,a,h)),s||(f=!0),u(0,1),m}(n,w,o$,{})},i(t){_||(yI((()=>{x||(x=RI(n,r$,{amount:10},!0)),x.run(1)})),_=!0)},o(t){x||(x=RI(n,r$,{amount:10},!1)),x.run(0),_=!1},d(t){t&&AN(n),N&&N.d(),t&&x&&x.end(),S=!1,k()}}}function h$(t){let e,n,r=[],i=new Map,s=t[0].slice(0,10);const o=t=>t[8];for(let e=0;e<s.length;e+=1){let n=a$(t,s,e),a=o(n);i.set(a,r[e]=u$(a,n))}return{c(){e=IN("div");for(let t=0;t<r.length;t+=1)r[t].c();FN(e,"class","marcelle notification-container svelte-r4ekig")},m(t,i){CN(t,e,i);for(let t=0;t<r.length;t+=1)r[t].m(e,null);n=!0},p(t,[n]){if(3&n){s=t[0].slice(0,10),CI();for(let t=0;t<r.length;t+=1)r[t].r();r=zI(r,n,o,1,t,s,i,e,FI,u$,null,a$);for(let t=0;t<r.length;t+=1)r[t].a();AI()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)NI(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)II(r[t]);n=!1},d(t){t&&AN(e);for(let t=0;t<r.length;t+=1)r[t].d()}}}function d$(t,e,n){let{notifications:r=[]}=e;function i(t){n(0,r=r.filter((e=>e.id!==t)))}let s=1;return t.$$set=t=>{"notifications"in t&&n(0,r=t.notifications)},[r,i,function({title:t,message:e,type:o="default",duration:a=3e3}){const l={id:s,title:t,message:e,type:o};s+=1,n(0,r=[...r,l]),a>0&&setTimeout((()=>{i(l.id)}),a)},t=>i(t)]}class p$ extends HI{constructor(t){super(),WI(this,t,d$,h$,lN,{notifications:0,add:2})}get add(){return this.$$.ctx[2]}}function f$(t){let e,n,r,i,s,o,a,l,c,u;return{c(){e=IN("div"),n=IN("button"),r=RN("-"),i=ON(),s=IN("input"),o=ON(),a=IN("button"),l=RN("+"),n.disabled=t[1],FN(n,"class","left svelte-9ymaj0"),FN(s,"type","number"),FN(s,"inputmode","decimal"),s.value=t[0],s.disabled=t[1],VN(s,"width","80px"),FN(s,"class","svelte-9ymaj0"),a.disabled=t[1],FN(a,"class","right svelte-9ymaj0"),FN(e,"class","flex")},m(h,d){CN(h,e,d),TN(e,n),TN(n,r),TN(e,i),TN(e,s),TN(e,o),TN(e,a),TN(a,l),c||(u=[LN(n,"click",t[3]),LN(s,"change",t[2]),LN(a,"click",t[4])],c=!0)},p(t,[e]){2&e&&(n.disabled=t[1]),1&e&&s.value!==t[0]&&(s.value=t[0]),2&e&&(s.disabled=t[1]),2&e&&(a.disabled=t[1])},i:nN,o:nN,d(t){t&&AN(e),c=!1,oN(u)}}}function m$(t,e,n){let{disabled:r=!1}=e,{value:i}=e;return t.$$set=t=>{"disabled"in t&&n(1,r=t.disabled),"value"in t&&n(0,i=t.value)},[i,r,function(t){const e=t.target,r=parseFloat(e.value);Number.isNaN(r)?e.value=i.toString():n(0,i=r)},()=>{n(0,i-=1)},()=>{n(0,i+=1)}]}class g$ extends HI{constructor(t){super(),WI(this,t,m$,f$,lN,{disabled:1,value:0})}}function y$(t,e,n){const r=t.slice();return r[12]=e[n],r[14]=n,r}function b$(t){let e,n,r,i,s,o,a,l,c,u=t[0],h=[];for(let e=0;e<u.length;e+=1)h[e]=v$(y$(t,u,e));return{c(){e=IN("div");for(let t=0;t<h.length;t+=1)h[t].c();n=ON(),r=IN("button"),i=RN("-"),s=ON(),o=IN("button"),a=RN("+"),r.disabled=t[1],FN(r,"class","left svelte-9ymaj0"),o.disabled=t[1],FN(o,"class","right svelte-9ymaj0"),VN(o,"border-left","none"),FN(e,"class","flex items-center")},m(u,d){CN(u,e,d);for(let t=0;t<h.length;t+=1)h[t].m(e,null);TN(e,n),TN(e,r),TN(r,i),TN(e,s),TN(e,o),TN(o,a),l||(c=[LN(r,"click",t[10]),LN(o,"click",t[11])],l=!0)},p(t,i){if(31&i){let r;for(u=t[0],r=0;r<u.length;r+=1){const s=y$(t,u,r);h[r]?h[r].p(s,i):(h[r]=v$(s),h[r].c(),h[r].m(e,n))}for(;r<h.length;r+=1)h[r].d(1);h.length=u.length}2&i&&(r.disabled=t[1]),2&i&&(o.disabled=t[1])},d(t){t&&AN(e),NN(h,t),l=!1,oN(c)}}}function v$(t){let e,n,r,i,s,o,a,l,c,u,h;function d(){return t[7](t[14])}function p(...e){return t[8](t[14],...e)}function f(){return t[9](t[14])}return{c(){e=IN("div"),n=IN("button"),r=RN("-"),i=ON(),s=IN("input"),a=ON(),l=IN("button"),c=RN("+"),n.disabled=t[1],FN(n,"class","left svelte-9ymaj0"),FN(s,"type","number"),FN(s,"inputmode","decimal"),s.value=o=t[12],s.disabled=t[1],VN(s,"width","80px"),FN(s,"class","svelte-9ymaj0"),l.disabled=t[1],FN(l,"class","right svelte-9ymaj0"),FN(e,"class","flex mr-2")},m(t,o){CN(t,e,o),TN(e,n),TN(n,r),TN(e,i),TN(e,s),TN(e,a),TN(e,l),TN(l,c),u||(h=[LN(n,"click",d),LN(s,"change",p),LN(l,"click",f)],u=!0)},p(e,r){t=e,2&r&&(n.disabled=t[1]),1&r&&o!==(o=t[12])&&s.value!==o&&(s.value=o),2&r&&(s.disabled=t[1]),2&r&&(l.disabled=t[1])},d(t){t&&AN(e),u=!1,oN(h)}}}function x$(t){let e,n=t[0]&&Array.isArray(t[0]),r=n&&b$(t);return{c(){r&&r.c(),e=PN()},m(t,n){r&&r.m(t,n),CN(t,e,n)},p(t,[i]){1&i&&(n=t[0]&&Array.isArray(t[0])),n?r?r.p(t,i):(r=b$(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:nN,o:nN,d(t){r&&r.d(t),t&&AN(e)}}}function w$(t,e,n){let{disabled:r=!1}=e,{value:i}=e;function s(t,e){const r=t.target,s=parseFloat(r.value);Number.isNaN(s)?r.value=i[e].toString():n(0,i[e]=s,i)}function o(t){const e=i.slice();e[t]-=1,n(0,i=e)}function a(t){const e=i.slice();e[t]+=1,n(0,i=e)}function l(){const t=i.slice();t.push(t.length?t[t.length-1]:0),n(0,i=t)}function c(){n(0,i=i.slice(0,i.length-1))}return t.$$set=t=>{"disabled"in t&&n(1,r=t.disabled),"value"in t&&n(0,i=t.value)},[i,r,s,o,a,l,c,t=>o(t),(t,e)=>s(e,t),t=>a(t),()=>c(),()=>l()]}class _$ extends HI{constructor(t){super(),WI(this,t,w$,x$,lN,{disabled:1,value:0})}}function S$(t,e,n){const r=t.slice();return r[7]=e[n],r}function k$(t){let e,n;return{c(){e=$N("svg"),n=$N("path"),FN(n,"d","M10 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0-6a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"),FN(e,"class","fill-current inline-block h-5 w-5"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"viewBox","0 0 20 20")},m(t,r){CN(t,e,r),TN(e,n)},p:nN,d(t){t&&AN(e)}}}function T$(t){let e,n,r,i,s,o=t[0],a=[];for(let e=0;e<o.length;e+=1)a[e]=E$(S$(t,o,e));return{c(){e=IN("div"),n=IN("div"),r=IN("div");for(let t=0;t<a.length;t+=1)a[t].c();FN(r,"class","py-1"),FN(r,"role","menu"),FN(r,"aria-orientation","vertical"),FN(r,"aria-labelledby","options-menu"),FN(n,"class","origin-top-right absolute right-0 mt-1 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"),FN(e,"class","origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg z-50"),GN(e,"hidden",!1)},m(t,i){CN(t,e,i),TN(e,n),TN(n,r);for(let t=0;t<a.length;t+=1)a[t].m(r,null);s=!0},p(t,e){if(9&e){let n;for(o=t[0],n=0;n<o.length;n+=1){const i=S$(t,o,n);a[n]?a[n].p(i,e):(a[n]=E$(i),a[n].c(),a[n].m(r,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}},i(t){s||(yI((()=>{i||(i=RI(e,i$,{duration:100},!0)),i.run(1)})),s=!0)},o(t){i||(i=RI(e,i$,{duration:100},!1)),i.run(0),s=!1},d(t){t&&AN(e),NN(a,t),t&&i&&i.end()}}}function E$(t){let e,n,r,i,s,o=t[7].text+"";function a(){return t[5](t[7])}return{c(){e=IN("button"),n=RN(o),r=ON(),FN(e,"class","text-sm py-2 px-4 font-normal block w-full whitespace-no-wrap bg-transparent text-gray-800 hover:bg-gray-100 border-0 cursor-pointer")},m(t,o){CN(t,e,o),TN(e,n),TN(e,r),i||(s=LN(e,"click",a),i=!0)},p(e,r){t=e,1&r&&o!==(o=t[7].text+"")&&BN(n,o)},d(t){t&&AN(e),i=!1,s()}}}function M$(t){let e,n,r,i,s,o,a;r=new XI({props:{size:"small",round:!0,$$slots:{default:[k$]},$$scope:{ctx:t}}}),r.$on("click",t[2]);let l=t[1]&&T$(t);return{c(){e=ON(),n=IN("div"),UI(r.$$.fragment),i=ON(),l&&l.c(),FN(n,"class","relative")},m(c,u){CN(c,e,u),CN(c,n,u),VI(r,n,null),TN(n,i),l&&l.m(n,null),s=!0,o||(a=LN(document.body,"click",t[4]),o=!0)},p(t,[e]){const i={};1024&e&&(i.$$scope={dirty:e,ctx:t}),r.$set(i),t[1]?l?(l.p(t,e),2&e&&NI(l,1)):(l=T$(t),l.c(),NI(l,1),l.m(n,null)):l&&(CI(),II(l,1,1,(()=>{l=null})),AI())},i(t){s||(NI(r.$$.fragment,t),NI(l),s=!0)},o(t){II(r.$$.fragment,t),II(l),s=!1},d(t){t&&AN(e),t&&AN(n),jI(r),l&&l.d(),o=!1,a()}}}function C$(t,e,n){let{actions:r=[]}=e;const i=oI();let s=!1;function o(t){i("select",t)}return t.$$set=t=>{"actions"in t&&n(0,r=t.actions)},[r,s,function(t){t.stopPropagation(),n(1,s=!s)},o,()=>{n(1,s=!1)},t=>o(t.code)]}class A$ extends HI{constructor(t){super(),WI(this,t,C$,M$,lN,{actions:0})}}function N$(t){let e,n;return{c(){e=IN("div"),FN(e,"class","progress-line svelte-1w3676e"),FN(e,"style",n=t[0]>=0?`--bar-mr: ${100-Math.floor(100*t[0])}%;`:"--bar-mr: 0px"),GN(e,"thin",t[2]),GN(e,"indeterminate",void 0===t[0]||null===t[0]||t[0]<0),GN(e,"gray","idle"===t[1]),GN(e,"green","success"===t[1]),GN(e,"red","danger"===t[1])},m(t,n){CN(t,e,n)},p(t,[r]){1&r&&n!==(n=t[0]>=0?`--bar-mr: ${100-Math.floor(100*t[0])}%;`:"--bar-mr: 0px")&&FN(e,"style",n),4&r&&GN(e,"thin",t[2]),1&r&&GN(e,"indeterminate",void 0===t[0]||null===t[0]||t[0]<0),2&r&&GN(e,"gray","idle"===t[1]),2&r&&GN(e,"green","success"===t[1]),2&r&&GN(e,"red","danger"===t[1])},i:nN,o:nN,d(t){t&&AN(e)}}}function I$(t,e,n){let{progress:r}=e,{type:i="default"}=e,{thin:s=!1}=e;return t.$$set=t=>{"progress"in t&&n(0,r=t.progress),"type"in t&&n(1,i=t.type),"thin"in t&&n(2,s=t.thin)},[r,i,s]}class $$ extends HI{constructor(t){super(),WI(this,t,I$,N$,lN,{progress:0,type:1,thin:2})}}function R$(t,e,n){const r=t.slice();return r[7]=e[n],r}function O$(t){let e,n;return{c(){e=IN("option"),n=RN(t[2]),e.__value="",e.value=e.__value,e.disabled=!0,FN(e,"class","svelte-g3sqa4")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){4&e&&BN(n,t[2])},d(t){t&&AN(e)}}}function P$(t){let e,n,r,i=t[7]+"";return{c(){e=IN("option"),n=RN(i),e.__value=r=t[7],e.value=e.__value,FN(e,"class","svelte-g3sqa4")},m(t,r){CN(t,e,r),TN(e,n)},p(t,s){2&s&&i!==(i=t[7]+"")&&BN(n,i),2&s&&r!==(r=t[7])&&(e.__value=r,e.value=e.__value)},d(t){t&&AN(e)}}}function L$(t){let e,n,r,i,s,o,a,l=t[2]&&O$(t),c=t[1],u=[];for(let e=0;e<c.length;e+=1)u[e]=P$(R$(t,c,e));return{c(){e=IN("div"),n=IN("select"),l&&l.c(),r=PN();for(let t=0;t<u.length;t+=1)u[t].c();i=ON(),s=IN("div"),s.innerHTML='<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path></svg>',FN(n,"class","svelte-g3sqa4"),void 0===t[0]&&yI((()=>t[5].call(n))),GN(n,"small","small"===t[3]),FN(s,"class","pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"),FN(e,"class","select-container svelte-g3sqa4")},m(c,h){CN(c,e,h),TN(e,n),l&&l.m(n,null),TN(n,r);for(let t=0;t<u.length;t+=1)u[t].m(n,null);jN(n,t[0]),TN(e,i),TN(e,s),o||(a=[LN(n,"change",t[5]),LN(n,"change",t[6])],o=!0)},p(t,[e]){if(t[2]?l?l.p(t,e):(l=O$(t),l.c(),l.m(n,r)):l&&(l.d(1),l=null),2&e){let r;for(c=t[1],r=0;r<c.length;r+=1){const i=R$(t,c,r);u[r]?u[r].p(i,e):(u[r]=P$(i),u[r].c(),u[r].m(n,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=c.length}3&e&&jN(n,t[0]),8&e&&GN(n,"small","small"===t[3])},i:nN,o:nN,d(t){t&&AN(e),l&&l.d(),NN(u,t),o=!1,oN(a)}}}function D$(t,e,n){let{options:r}=e,{value:i=""}=e,{placeholder:s="Select an Option"}=e,{size:o="normal"}=e;const a=oI();return t.$$set=t=>{"options"in t&&n(1,r=t.options),"value"in t&&n(0,i=t.value),"placeholder"in t&&n(2,s=t.placeholder),"size"in t&&n(3,o=t.size)},[i,r,s,o,a,function(){i=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(0,i),n(1,r)},t=>a("change",t.currentTarget.value)]}class F$ extends HI{constructor(t){super(),WI(this,t,D$,L$,lN,{options:1,value:0,placeholder:2,size:3})}}function z$(t){let e;return{c(){e=IN("span"),e.innerHTML='<span class="spinner svelte-l56ytt"><span class="dot1 svelte-l56ytt"></span>  <span class="dot2 svelte-l56ytt"></span></span>',FN(e,"class","spinner-container svelte-l56ytt")},m(t,n){CN(t,e,n)},p:nN,i:nN,o:nN,d(t){t&&AN(e)}}}class B$ extends HI{constructor(t){super(),WI(this,t,null,z$,lN,{})}}function U$(t){let e,n,r,i,s,o,a,l,c;return{c(){e=IN("label"),n=IN("input"),r=ON(),i=IN("span"),i.innerHTML='<span class="track svelte-16fu7e0"></span> \n    <span class="thumb svelte-16fu7e0"></span>',s=ON(),o=IN("span"),a=RN(t[1]),FN(n,"type","checkbox"),n.disabled=t[2],FN(n,"class","svelte-16fu7e0"),FN(i,"class","switch svelte-16fu7e0"),FN(o,"class","ml-2 cursor-pointer"),FN(e,"class","marcelle")},m(u,h){CN(u,e,h),TN(e,n),n.checked=t[0],TN(e,r),TN(e,i),TN(e,s),TN(e,o),TN(o,a),l||(c=LN(n,"change",t[3]),l=!0)},p(t,[e]){4&e&&(n.disabled=t[2]),1&e&&(n.checked=t[0]),2&e&&BN(a,t[1])},i:nN,o:nN,d(t){t&&AN(e),l=!1,c()}}}function V$(t,e,n){let{text:r=""}=e,{checked:i=!1}=e,{disabled:s=!1}=e;return t.$$set=t=>{"text"in t&&n(1,r=t.text),"checked"in t&&n(0,i=t.checked),"disabled"in t&&n(2,s=t.disabled)},[i,r,s,function(){i=this.checked,n(0,i)}]}class j$ extends HI{constructor(t){super(),WI(this,t,V$,U$,lN,{text:1,checked:0,disabled:2})}}const W$=[];function H$(t,e=nN){let n;const r=new Set;function i(e){if(lN(t,e)&&(t=e,n)){const e=!W$.length;for(const e of r)e[1](),W$.push(e,t);if(e){for(let t=0;t<W$.length;t+=2)W$[t][0](W$[t+1]);W$.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,o=nN){const a=[s,o];return r.add(a),1===r.size&&(n=e(i)||nN),s(t),()=>{r.delete(a),0===r.size&&(n(),n=null)}}}}function G$(t){let e,n;const r=t[1].default,i=fN(r,t,t[0],null);return{c(){e=IN("div"),i&&i.c(),FN(e,"class","tabs")},m(t,r){CN(t,e,r),i&&i.m(e,null),n=!0},p(t,[e]){i&&i.p&&(!n||1&e)&&yN(i,r,t,t[0],n?gN(r,t[0],e,null):bN(t[0]),null)},i(t){n||(NI(i,t),n=!0)},o(t){II(i,t),n=!1},d(t){t&&AN(e),i&&i.d(t)}}}const q$={};function X$(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=[],o=[],a=H$(null),l=H$(null);var c,u;return c=q$,u={registerTab:t=>{s.push(t),a.update((e=>e||t)),sI((()=>{const e=s.indexOf(t);s.splice(e,1),a.update((n=>n===t?s[e]||s[s.length-1]:n))}))},registerPanel:t=>{o.push(t),l.update((e=>e||t)),sI((()=>{const e=o.indexOf(t);o.splice(e,1),l.update((n=>n===t?o[e]||o[o.length-1]:n))}))},selectTab:t=>{const e=s.indexOf(t);a.set(t),l.set(o[e])},selectedTab:a,selectedPanel:l},nI().$$.context.set(c,u),t.$$set=t=>{"$$scope"in t&&n(0,i=t.$$scope)},[i,r]}class Y$ extends HI{constructor(t){super(),WI(this,t,X$,G$,lN,{})}}function K$(t){let e,n,r,i;const s=t[5].default,o=fN(s,t,t[4],null);return{c(){e=IN("div"),o&&o.c(),FN(e,"class","text-sm font-semibold text-gray-600 cursor-pointer mx-4 p-2 hover:text-gray-800 svelte-13dez5h"),FN(e,"role","tab"),GN(e,"selected",t[0]===t[1])},m(s,a){CN(s,e,a),o&&o.m(e,null),n=!0,r||(i=LN(e,"click",t[6]),r=!0)},p(t,[r]){o&&o.p&&(!n||16&r)&&yN(o,s,t,t[4],n?gN(s,t[4],r,null):bN(t[4]),null),(!n||3&r)&&GN(e,"selected",t[0]===t[1])},i(t){n||(NI(o,t),n=!0)},o(t){II(o,t),n=!1},d(t){t&&AN(e),o&&o.d(t),r=!1,i()}}}function Z$(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerTab:a,selectTab:l,selectedTab:c}=aI(q$);pN(t,c,(t=>n(0,r=t))),a(o);return t.$$set=t=>{"$$scope"in t&&n(4,s=t.$$scope)},[r,o,l,c,s,i,()=>l(o)]}class J$ extends HI{constructor(t){super(),WI(this,t,Z$,K$,lN,{})}}function Q$(t){let e;const n=t[4].default,r=fN(n,t,t[3],null);return{c(){r&&r.c()},m(t,n){r&&r.m(t,n),e=!0},p(t,i){r&&r.p&&(!e||8&i)&&yN(r,n,t,t[3],e?gN(n,t[3],i,null):bN(t[3]),null)},i(t){e||(NI(r,t),e=!0)},o(t){II(r,t),e=!1},d(t){r&&r.d(t)}}}function tR(t){let e,n,r=t[0]===t[1]&&Q$(t);return{c(){r&&r.c(),e=PN()},m(t,i){r&&r.m(t,i),CN(t,e,i),n=!0},p(t,[n]){t[0]===t[1]?r?(r.p(t,n),1&n&&NI(r,1)):(r=Q$(t),r.c(),NI(r,1),r.m(e.parentNode,e)):r&&(CI(),II(r,1,1,(()=>{r=null})),AI())},i(t){n||(NI(r),n=!0)},o(t){II(r),n=!1},d(t){r&&r.d(t),t&&AN(e)}}}function eR(t,e,n){let r,{$$slots:i={},$$scope:s}=e;const o={},{registerPanel:a,selectedPanel:l}=aI(q$);return pN(t,l,(t=>n(0,r=t))),a(o),t.$$set=t=>{"$$scope"in t&&n(3,s=t.$$scope)},[r,o,l,s,i]}class nR extends HI{constructor(t){super(),WI(this,t,eR,tR,lN,{})}}function rR(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function iR(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function sR(t){return sR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sR(t)}function oR(t){iR(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"===sR(t)&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}var aR={};function lR(){return aR}function cR(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function uR(t,e){iR(2,arguments);var n=oR(t),r=oR(e),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function hR(t,e){iR(2,arguments);var n=oR(t),r=oR(e),i=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return 12*i+s}function dR(t,e){return iR(2,arguments),oR(t).getTime()-oR(e).getTime()}var pR={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}};function fR(t){return t?pR[t]:pR.trunc}function mR(t){iR(1,arguments);var e=oR(t);return e.setHours(23,59,59,999),e}function gR(t){iR(1,arguments);var e=oR(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function yR(t){iR(1,arguments);var e=oR(t);return mR(e).getTime()===gR(e).getTime()}function bR(t,e){iR(2,arguments);var n,r=oR(t),i=oR(e),s=uR(r,i),o=Math.abs(hR(r,i));if(o<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*o);var a=uR(r,i)===-s;yR(oR(t))&&1===o&&1===uR(t,i)&&(a=!1),n=s*(o-Number(a))}return 0===n?0:n}function vR(t,e,n){iR(2,arguments);var r=dR(t,e)/1e3;return fR(null==n?void 0:n.roundingMethod)(r)}function xR(t){iR(1,arguments);var e=1,n=oR(t),r=n.getUTCDay(),i=(r<e?7:0)+r-e;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function wR(t){iR(1,arguments);var e=oR(t),n=e.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=xR(r),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var o=xR(s);return e.getTime()>=i.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}function _R(t){iR(1,arguments);var e=wR(t),n=new Date(0);n.setUTCFullYear(e,0,4),n.setUTCHours(0,0,0,0);var r=xR(n);return r}var SR=6048e5;function kR(t){iR(1,arguments);var e=oR(t),n=xR(e).getTime()-_R(e).getTime();return Math.round(n/SR)+1}function TR(t,e){var n,r,i,s,o,a,l,c;iR(1,arguments);var u=lR(),h=rR(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.weekStartsOn)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==n?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var d=oR(t),p=d.getUTCDay(),f=(p<h?7:0)+p-h;return d.setUTCDate(d.getUTCDate()-f),d.setUTCHours(0,0,0,0),d}function ER(t,e){var n,r,i,s,o,a,l,c;iR(1,arguments);var u=oR(t),h=u.getUTCFullYear(),d=lR(),p=rR(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.firstWeekContainsDate)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:d.firstWeekContainsDate)&&void 0!==r?r:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setUTCFullYear(h+1,0,p),f.setUTCHours(0,0,0,0);var m=TR(f,e),g=new Date(0);g.setUTCFullYear(h,0,p),g.setUTCHours(0,0,0,0);var y=TR(g,e);return u.getTime()>=m.getTime()?h+1:u.getTime()>=y.getTime()?h:h-1}function MR(t,e){var n,r,i,s,o,a,l,c;iR(1,arguments);var u=lR(),h=rR(null!==(n=null!==(r=null!==(i=null!==(s=null==e?void 0:e.firstWeekContainsDate)&&void 0!==s?s:null==e||null===(o=e.locale)||void 0===o||null===(a=o.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(l=u.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==n?n:1),d=ER(t,e),p=new Date(0);p.setUTCFullYear(d,0,h),p.setUTCHours(0,0,0,0);var f=TR(p,e);return f}var CR=6048e5;function AR(t,e){iR(1,arguments);var n=oR(t),r=TR(n,e).getTime()-MR(n,e).getTime();return Math.round(r/CR)+1}var NR={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function IR(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width?String(e.width):t.defaultWidth,r=t.formats[n]||t.formats[t.defaultWidth];return r}}var $R={date:IR({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:IR({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:IR({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},RR={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function OR(t){return function(e,n){var r;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&t.formattingValues){var i=t.defaultFormattingWidth||t.defaultWidth,s=null!=n&&n.width?String(n.width):i;r=t.formattingValues[s]||t.formattingValues[i]}else{var o=t.defaultWidth,a=null!=n&&n.width?String(n.width):t.defaultWidth;r=t.values[a]||t.values[o]}return r[t.argumentCallback?t.argumentCallback(e):e]}}var PR={ordinalNumber:function(t,e){var n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:OR({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:OR({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:OR({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:OR({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:OR({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function LR(t){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;var o,a=s[0],l=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?FR(l,(function(t){return t.test(a)})):DR(l,(function(t){return t.test(a)}));o=t.valueCallback?t.valueCallback(c):c,o=n.valueCallback?n.valueCallback(o):o;var u=e.slice(a.length);return{value:o,rest:u}}}function DR(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n]))return n}function FR(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n}var zR,BR={ordinalNumber:(zR={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(t){return parseInt(t,10)}},function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.match(zR.matchPattern);if(!n)return null;var r=n[0],i=t.match(zR.parsePattern);if(!i)return null;var s=zR.valueCallback?zR.valueCallback(i[0]):i[0];s=e.valueCallback?e.valueCallback(s):s;var o=t.slice(r.length);return{value:s,rest:o}}),era:LR({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:LR({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:LR({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:LR({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:LR({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},UR={code:"en-US",formatDistance:function(t,e,n){var r,i=NR[t];return r="string"==typeof i?i:1===e?i.one:i.other.replace("{{count}}",e.toString()),null!=n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:$R,formatRelative:function(t,e,n,r){return RR[t]},localize:PR,match:BR,options:{weekStartsOn:0,firstWeekContainsDate:1}};function VR(t,e){if(null==t)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function jR(t){return VR({},t)}var WR=1440,HR=43200;function GR(t,e,n){var r,i;iR(2,arguments);var s=lR(),o=null!==(r=null!==(i=null==n?void 0:n.locale)&&void 0!==i?i:s.locale)&&void 0!==r?r:UR;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var a=uR(t,e);if(isNaN(a))throw new RangeError("Invalid time value");var l,c,u=VR(jR(n),{addSuffix:Boolean(null==n?void 0:n.addSuffix),comparison:a});a>0?(l=oR(e),c=oR(t)):(l=oR(t),c=oR(e));var h,d=vR(c,l),p=(cR(c)-cR(l))/1e3,f=Math.round((d-p)/60);if(f<2)return null!=n&&n.includeSeconds?d<5?o.formatDistance("lessThanXSeconds",5,u):d<10?o.formatDistance("lessThanXSeconds",10,u):d<20?o.formatDistance("lessThanXSeconds",20,u):d<40?o.formatDistance("halfAMinute",0,u):d<60?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",1,u):0===f?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",f,u);if(f<45)return o.formatDistance("xMinutes",f,u);if(f<90)return o.formatDistance("aboutXHours",1,u);if(f<WR){var m=Math.round(f/60);return o.formatDistance("aboutXHours",m,u)}if(f<2520)return o.formatDistance("xDays",1,u);if(f<HR){var g=Math.round(f/WR);return o.formatDistance("xDays",g,u)}if(f<86400)return h=Math.round(f/HR),o.formatDistance("aboutXMonths",h,u);if((h=bR(c,l))<12){var y=Math.round(f/HR);return o.formatDistance("xMonths",y,u)}var b=h%12,v=Math.floor(h/12);return b<3?o.formatDistance("aboutXYears",v,u):b<9?o.formatDistance("overXYears",v,u):o.formatDistance("almostXYears",v+1,u)}function qR(t){return qR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qR(t)}function XR(t,e){return XR=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},XR(t,e)}function YR(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ZR(t);if(e){var i=ZR(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return KR(this,n)}}function KR(t,e){return!e||"object"!==qR(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ZR(t){return ZR=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ZR(t)}function JR(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function QR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tO(t,e,n){return e&&QR(t.prototype,e),n&&QR(t,n),t}var eO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&XR(t,e)}(n,t);var e=YR(n);function n(t,r,i,s,o){var a;return JR(this,n),(a=e.call(this)).value=t,a.validateValue=r,a.setValue=i,a.priority=s,o&&(a.subPriority=o),a}return tO(n,[{key:"validate",value:function(t,e){return this.validateValue(t,this.value,e)}},{key:"set",value:function(t,e,n){return this.setValue(t,e,this.value,n)}}]),n}(function(){function t(){var e,n,r;JR(this,t),r=0,(n="subPriority")in(e=this)?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r}return tO(t,[{key:"validate",value:function(t,e){return!0}}]),t}());function nO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var rO=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,n=[{key:"run",value:function(t,e,n,r){var i=this.parse(t,e,n,r);return i?{setter:new eO(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}},{key:"validate",value:function(t,e,n){return!0}}],n&&nO(e.prototype,n),r&&nO(e,r),t}();function iO(t){return iO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iO(t)}function sO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function aO(t,e){return aO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},aO(t,e)}function lO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=hO(t);if(e){var i=hO(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return cO(this,n)}}function cO(t,e){return!e||"object"!==iO(e)&&"function"!=typeof e?uO(t):e}function uO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hO(t){return hO=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hO(t)}function dO(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pO=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&aO(t,e)}(s,t);var e,n,r,i=lO(s);function s(){var t;sO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return dO(uO(t=i.call.apply(i,[this].concat(n))),"priority",140),dO(uO(t),"incompatibleTokens",["R","u","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"G":case"GG":case"GGG":return n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"});case"GGGGG":return n.era(t,{width:"narrow"});default:return n.era(t,{width:"wide"})||n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"})}}},{key:"set",value:function(t,e,n){return e.era=n,t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t}}],n&&oO(e.prototype,n),r&&oO(e,r),s}(rO),fO=/^(1[0-2]|0?\d)/,mO=/^(3[0-1]|[0-2]?\d)/,gO=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,yO=/^(5[0-3]|[0-4]?\d)/,bO=/^(2[0-3]|[0-1]?\d)/,vO=/^(2[0-4]|[0-1]?\d)/,xO=/^(1[0-1]|0?\d)/,wO=/^(1[0-2]|0?\d)/,_O=/^[0-5]?\d/,SO=/^[0-5]?\d/,kO=/^\d/,TO=/^\d{1,2}/,EO=/^\d{1,3}/,MO=/^\d{1,4}/,CO=/^-?\d+/,AO=/^-?\d/,NO=/^-?\d{1,2}/,IO=/^-?\d{1,3}/,$O=/^-?\d{1,4}/,RO=/^([+-])(\d{2})(\d{2})?|Z/,OO=/^([+-])(\d{2})(\d{2})|Z/,PO=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,LO=/^([+-])(\d{2}):(\d{2})|Z/,DO=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function FO(t,e){return t?{value:e(t.value),rest:t.rest}:t}function zO(t,e){var n=e.match(t);return n?{value:parseInt(n[0],10),rest:e.slice(n[0].length)}:null}function BO(t,e){var n=e.match(t);return n?"Z"===n[0]?{value:0,rest:e.slice(1)}:{value:("+"===n[1]?1:-1)*(36e5*(n[2]?parseInt(n[2],10):0)+6e4*(n[3]?parseInt(n[3],10):0)+1e3*(n[5]?parseInt(n[5],10):0)),rest:e.slice(n[0].length)}:null}function UO(t){return zO(CO,t)}function VO(t,e){switch(t){case 1:return zO(kO,e);case 2:return zO(TO,e);case 3:return zO(EO,e);case 4:return zO(MO,e);default:return zO(new RegExp("^\\d{1,"+t+"}"),e)}}function jO(t,e){switch(t){case 1:return zO(AO,e);case 2:return zO(NO,e);case 3:return zO(IO,e);case 4:return zO($O,e);default:return zO(new RegExp("^-?\\d{1,"+t+"}"),e)}}function WO(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function HO(t,e){var n,r=e>0,i=r?e:1-e;if(i<=50)n=t||100;else{var s=i+50;n=t+100*Math.floor(s/100)-(t>=s%100?100:0)}return r?n:1-n}function GO(t){return t%400==0||t%4==0&&t%100!=0}function qO(t){return qO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qO(t)}function XO(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function YO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function KO(t,e){return KO=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},KO(t,e)}function ZO(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=tP(t);if(e){var i=tP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return JO(this,n)}}function JO(t,e){return!e||"object"!==qO(e)&&"function"!=typeof e?QO(t):e}function QO(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tP(t){return tP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},tP(t)}function eP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&KO(t,e)}(s,t);var e,n,r,i=ZO(s);function s(){var t;XO(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return eP(QO(t=i.call.apply(i,[this].concat(n))),"priority",130),eP(QO(t),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return{year:t,isTwoDigitYear:"yy"===e}};switch(e){case"y":return FO(VO(4,t),r);case"yo":return FO(n.ordinalNumber(t,{unit:"year"}),r);default:return FO(VO(e.length,t),r)}}},{key:"validate",value:function(t,e){return e.isTwoDigitYear||e.year>0}},{key:"set",value:function(t,e,n){var r=t.getUTCFullYear();if(n.isTwoDigitYear){var i=HO(n.year,r);return t.setUTCFullYear(i,0,1),t.setUTCHours(0,0,0,0),t}var s="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(s,0,1),t.setUTCHours(0,0,0,0),t}}],n&&YO(e.prototype,n),r&&YO(e,r),s}(rO);function rP(t){return rP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rP(t)}function iP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oP(t,e){return oP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oP(t,e)}function aP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=uP(t);if(e){var i=uP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return lP(this,n)}}function lP(t,e){return!e||"object"!==rP(e)&&"function"!=typeof e?cP(t):e}function cP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uP(t){return uP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},uP(t)}function hP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var dP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oP(t,e)}(s,t);var e,n,r,i=aP(s);function s(){var t;iP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return hP(cP(t=i.call.apply(i,[this].concat(n))),"priority",130),hP(cP(t),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return{year:t,isTwoDigitYear:"YY"===e}};switch(e){case"Y":return FO(VO(4,t),r);case"Yo":return FO(n.ordinalNumber(t,{unit:"year"}),r);default:return FO(VO(e.length,t),r)}}},{key:"validate",value:function(t,e){return e.isTwoDigitYear||e.year>0}},{key:"set",value:function(t,e,n,r){var i=ER(t,r);if(n.isTwoDigitYear){var s=HO(n.year,i);return t.setUTCFullYear(s,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),TR(t,r)}var o="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(o,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),TR(t,r)}}],n&&sP(e.prototype,n),r&&sP(e,r),s}(rO);function pP(t){return pP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pP(t)}function fP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function gP(t,e){return gP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},gP(t,e)}function yP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xP(t);if(e){var i=xP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return bP(this,n)}}function bP(t,e){return!e||"object"!==pP(e)&&"function"!=typeof e?vP(t):e}function vP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xP(t){return xP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xP(t)}function wP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gP(t,e)}(s,t);var e,n,r,i=yP(s);function s(){var t;fP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return wP(vP(t=i.call.apply(i,[this].concat(n))),"priority",130),wP(vP(t),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return jO("R"===e?4:e.length,t)}},{key:"set",value:function(t,e,n){var r=new Date(0);return r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0),xR(r)}}])&&mP(e.prototype,n),r&&mP(e,r),s}(rO);function SP(t){return SP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SP(t)}function kP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function TP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function EP(t,e){return EP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},EP(t,e)}function MP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=NP(t);if(e){var i=NP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return CP(this,n)}}function CP(t,e){return!e||"object"!==SP(e)&&"function"!=typeof e?AP(t):e}function AP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function NP(t){return NP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},NP(t)}function IP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&EP(t,e)}(s,t);var e,n,r,i=MP(s);function s(){var t;kP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return IP(AP(t=i.call.apply(i,[this].concat(n))),"priority",130),IP(AP(t),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return jO("u"===e?4:e.length,t)}},{key:"set",value:function(t,e,n){return t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t}}])&&TP(e.prototype,n),r&&TP(e,r),s}(rO);function RP(t){return RP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RP(t)}function OP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function PP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function LP(t,e){return LP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},LP(t,e)}function DP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=BP(t);if(e){var i=BP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return FP(this,n)}}function FP(t,e){return!e||"object"!==RP(e)&&"function"!=typeof e?zP(t):e}function zP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function BP(t){return BP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},BP(t)}function UP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var VP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&LP(t,e)}(s,t);var e,n,r,i=DP(s);function s(){var t;OP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return UP(zP(t=i.call.apply(i,[this].concat(n))),"priority",120),UP(zP(t),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"Q":case"QQ":return VO(e.length,t);case"Qo":return n.ordinalNumber(t,{unit:"quarter"});case"QQQ":return n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(t,{width:"narrow",context:"formatting"});default:return n.quarter(t,{width:"wide",context:"formatting"})||n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=1&&e<=4}},{key:"set",value:function(t,e,n){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t}}],n&&PP(e.prototype,n),r&&PP(e,r),s}(rO);function jP(t){return jP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jP(t)}function WP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function HP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function GP(t,e){return GP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},GP(t,e)}function qP(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=KP(t);if(e){var i=KP(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return XP(this,n)}}function XP(t,e){return!e||"object"!==jP(e)&&"function"!=typeof e?YP(t):e}function YP(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function KP(t){return KP=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},KP(t)}function ZP(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var JP=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&GP(t,e)}(s,t);var e,n,r,i=qP(s);function s(){var t;WP(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ZP(YP(t=i.call.apply(i,[this].concat(n))),"priority",120),ZP(YP(t),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"q":case"qq":return VO(e.length,t);case"qo":return n.ordinalNumber(t,{unit:"quarter"});case"qqq":return n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(t,{width:"narrow",context:"standalone"});default:return n.quarter(t,{width:"wide",context:"standalone"})||n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=1&&e<=4}},{key:"set",value:function(t,e,n){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t}}],n&&HP(e.prototype,n),r&&HP(e,r),s}(rO);function QP(t){return QP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QP(t)}function tL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function eL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nL(t,e){return nL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nL(t,e)}function rL(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=oL(t);if(e){var i=oL(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return iL(this,n)}}function iL(t,e){return!e||"object"!==QP(e)&&"function"!=typeof e?sL(t):e}function sL(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oL(t){return oL=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},oL(t)}function aL(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var lL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nL(t,e)}(s,t);var e,n,r,i=rL(s);function s(){var t;tL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return aL(sL(t=i.call.apply(i,[this].concat(n))),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),aL(sL(t),"priority",110),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return t-1};switch(e){case"M":return FO(zO(fO,t),r);case"MM":return FO(VO(2,t),r);case"Mo":return FO(n.ordinalNumber(t,{unit:"month"}),r);case"MMM":return n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(t,{width:"narrow",context:"formatting"});default:return n.month(t,{width:"wide",context:"formatting"})||n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t}}],n&&eL(e.prototype,n),r&&eL(e,r),s}(rO);function cL(t){return cL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cL(t)}function uL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dL(t,e){return dL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},dL(t,e)}function pL(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gL(t);if(e){var i=gL(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fL(this,n)}}function fL(t,e){return!e||"object"!==cL(e)&&"function"!=typeof e?mL(t):e}function mL(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gL(t){return gL=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gL(t)}function yL(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dL(t,e)}(s,t);var e,n,r,i=pL(s);function s(){var t;uL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return yL(mL(t=i.call.apply(i,[this].concat(n))),"priority",110),yL(mL(t),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return t-1};switch(e){case"L":return FO(zO(fO,t),r);case"LL":return FO(VO(2,t),r);case"Lo":return FO(n.ordinalNumber(t,{unit:"month"}),r);case"LLL":return n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(t,{width:"narrow",context:"standalone"});default:return n.month(t,{width:"wide",context:"standalone"})||n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t}}],n&&hL(e.prototype,n),r&&hL(e,r),s}(rO);function vL(t){return vL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vL(t)}function xL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _L(t,e){return _L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_L(t,e)}function SL(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=EL(t);if(e){var i=EL(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kL(this,n)}}function kL(t,e){return!e||"object"!==vL(e)&&"function"!=typeof e?TL(t):e}function TL(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function EL(t){return EL=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},EL(t)}function ML(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var CL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_L(t,e)}(s,t);var e,n,r,i=SL(s);function s(){var t;xL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ML(TL(t=i.call.apply(i,[this].concat(n))),"priority",100),ML(TL(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"w":return zO(yO,t);case"wo":return n.ordinalNumber(t,{unit:"week"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=53}},{key:"set",value:function(t,e,n,r){return TR(function(t,e,n){iR(2,arguments);var r=oR(t),i=rR(e),s=AR(r,n)-i;return r.setUTCDate(r.getUTCDate()-7*s),r}(t,n,r),r)}}],n&&wL(e.prototype,n),r&&wL(e,r),s}(rO);function AL(t){return AL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AL(t)}function NL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function IL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $L(t,e){return $L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$L(t,e)}function RL(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=LL(t);if(e){var i=LL(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return OL(this,n)}}function OL(t,e){return!e||"object"!==AL(e)&&"function"!=typeof e?PL(t):e}function PL(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function LL(t){return LL=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},LL(t)}function DL(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var FL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$L(t,e)}(s,t);var e,n,r,i=RL(s);function s(){var t;NL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return DL(PL(t=i.call.apply(i,[this].concat(n))),"priority",100),DL(PL(t),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"I":return zO(yO,t);case"Io":return n.ordinalNumber(t,{unit:"week"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=53}},{key:"set",value:function(t,e,n){return xR(function(t,e){iR(2,arguments);var n=oR(t),r=rR(e),i=kR(n)-r;return n.setUTCDate(n.getUTCDate()-7*i),n}(t,n))}}],n&&IL(e.prototype,n),r&&IL(e,r),s}(rO);function zL(t){return zL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zL(t)}function BL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function UL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function VL(t,e){return VL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},VL(t,e)}function jL(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=GL(t);if(e){var i=GL(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return WL(this,n)}}function WL(t,e){return!e||"object"!==zL(e)&&"function"!=typeof e?HL(t):e}function HL(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function GL(t){return GL=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},GL(t)}function qL(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var XL=[31,28,31,30,31,30,31,31,30,31,30,31],YL=[31,29,31,30,31,30,31,31,30,31,30,31],KL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&VL(t,e)}(s,t);var e,n,r,i=jL(s);function s(){var t;BL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return qL(HL(t=i.call.apply(i,[this].concat(n))),"priority",90),qL(HL(t),"subPriority",1),qL(HL(t),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"d":return zO(mO,t);case"do":return n.ordinalNumber(t,{unit:"date"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){var n=GO(t.getUTCFullYear()),r=t.getUTCMonth();return n?e>=1&&e<=YL[r]:e>=1&&e<=XL[r]}},{key:"set",value:function(t,e,n){return t.setUTCDate(n),t.setUTCHours(0,0,0,0),t}}],n&&UL(e.prototype,n),r&&UL(e,r),s}(rO);function ZL(t){return ZL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZL(t)}function JL(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function QL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tD(t,e){return tD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tD(t,e)}function eD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=iD(t);if(e){var i=iD(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return nD(this,n)}}function nD(t,e){return!e||"object"!==ZL(e)&&"function"!=typeof e?rD(t):e}function rD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function iD(t){return iD=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},iD(t)}function sD(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var oD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tD(t,e)}(s,t);var e,n,r,i=eD(s);function s(){var t;JL(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return sD(rD(t=i.call.apply(i,[this].concat(n))),"priority",90),sD(rD(t),"subpriority",1),sD(rD(t),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"D":case"DD":return zO(gO,t);case"Do":return n.ordinalNumber(t,{unit:"date"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return GO(t.getUTCFullYear())?e>=1&&e<=366:e>=1&&e<=365}},{key:"set",value:function(t,e,n){return t.setUTCMonth(0,n),t.setUTCHours(0,0,0,0),t}}],n&&QL(e.prototype,n),r&&QL(e,r),s}(rO);function aD(t,e,n){var r,i,s,o,a,l,c,u;iR(2,arguments);var h=lR(),d=rR(null!==(r=null!==(i=null!==(s=null!==(o=null==n?void 0:n.weekStartsOn)&&void 0!==o?o:null==n||null===(a=n.locale)||void 0===a||null===(l=a.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==s?s:h.weekStartsOn)&&void 0!==i?i:null===(c=h.locale)||void 0===c||null===(u=c.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==r?r:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=oR(t),f=rR(e),m=p.getUTCDay(),g=f%7,y=(g+7)%7,b=(y<d?7:0)+f-m;return p.setUTCDate(p.getUTCDate()+b),p}function lD(t){return lD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lD(t)}function cD(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uD(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hD(t,e){return hD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hD(t,e)}function dD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=mD(t);if(e){var i=mD(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return pD(this,n)}}function pD(t,e){return!e||"object"!==lD(e)&&"function"!=typeof e?fD(t):e}function fD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mD(t){return mD=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mD(t)}function gD(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var yD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hD(t,e)}(s,t);var e,n,r,i=dD(s);function s(){var t;cD(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return gD(fD(t=i.call.apply(i,[this].concat(n))),"priority",90),gD(fD(t),"incompatibleTokens",["D","i","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"E":case"EE":case"EEE":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=aD(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&uD(e.prototype,n),r&&uD(e,r),s}(rO);function bD(t){return bD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bD(t)}function vD(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xD(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wD(t,e){return wD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wD(t,e)}function _D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=TD(t);if(e){var i=TD(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return SD(this,n)}}function SD(t,e){return!e||"object"!==bD(e)&&"function"!=typeof e?kD(t):e}function kD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function TD(t){return TD=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},TD(t)}function ED(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var MD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wD(t,e)}(s,t);var e,n,r,i=_D(s);function s(){var t;vD(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ED(kD(t=i.call.apply(i,[this].concat(n))),"priority",90),ED(kD(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n,r){var i=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"e":case"ee":return FO(VO(e.length,t),i);case"eo":return FO(n.ordinalNumber(t,{unit:"day"}),i);case"eee":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"eeeee":return n.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=aD(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&xD(e.prototype,n),r&&xD(e,r),s}(rO);function CD(t){return CD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CD(t)}function AD(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ND(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ID(t,e){return ID=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ID(t,e)}function $D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=PD(t);if(e){var i=PD(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return RD(this,n)}}function RD(t,e){return!e||"object"!==CD(e)&&"function"!=typeof e?OD(t):e}function OD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function PD(t){return PD=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},PD(t)}function LD(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var DD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ID(t,e)}(s,t);var e,n,r,i=$D(s);function s(){var t;AD(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return LD(OD(t=i.call.apply(i,[this].concat(n))),"priority",90),LD(OD(t),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n,r){var i=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"c":case"cc":return FO(VO(e.length,t),i);case"co":return FO(n.ordinalNumber(t,{unit:"day"}),i);case"ccc":return n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});case"ccccc":return n.day(t,{width:"narrow",context:"standalone"});case"cccccc":return n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});default:return n.day(t,{width:"wide",context:"standalone"})||n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(t,e){return e>=0&&e<=6}},{key:"set",value:function(t,e,n,r){return(t=aD(t,n,r)).setUTCHours(0,0,0,0),t}}],n&&ND(e.prototype,n),r&&ND(e,r),s}(rO);function FD(t){return FD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},FD(t)}function zD(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function BD(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function UD(t,e){return UD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},UD(t,e)}function VD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=HD(t);if(e){var i=HD(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return jD(this,n)}}function jD(t,e){return!e||"object"!==FD(e)&&"function"!=typeof e?WD(t):e}function WD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function HD(t){return HD=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},HD(t)}function GD(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&UD(t,e)}(s,t);var e,n,r,i=VD(s);function s(){var t;zD(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return GD(WD(t=i.call.apply(i,[this].concat(n))),"priority",90),GD(WD(t),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){var r=function(t){return 0===t?7:t};switch(e){case"i":case"ii":return VO(e.length,t);case"io":return n.ordinalNumber(t,{unit:"day"});case"iii":return FO(n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r);case"iiiii":return FO(n.day(t,{width:"narrow",context:"formatting"}),r);case"iiiiii":return FO(n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r);default:return FO(n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"}),r)}}},{key:"validate",value:function(t,e){return e>=1&&e<=7}},{key:"set",value:function(t,e,n){return t=function(t,e){iR(2,arguments);var n=rR(e);n%7==0&&(n-=7);var r=1,i=oR(t),s=i.getUTCDay(),o=((n%7+7)%7<r?7:0)+n-s;return i.setUTCDate(i.getUTCDate()+o),i}(t,n),t.setUTCHours(0,0,0,0),t}}],n&&BD(e.prototype,n),r&&BD(e,r),s}(rO);function XD(t){return XD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XD(t)}function YD(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function KD(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ZD(t,e){return ZD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ZD(t,e)}function JD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=eF(t);if(e){var i=eF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return QD(this,n)}}function QD(t,e){return!e||"object"!==XD(e)&&"function"!=typeof e?tF(t):e}function tF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eF(t){return eF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},eF(t)}function nF(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var rF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ZD(t,e)}(s,t);var e,n,r,i=JD(s);function s(){var t;YD(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return nF(tF(t=i.call.apply(i,[this].concat(n))),"priority",80),nF(tF(t),"incompatibleTokens",["b","B","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"a":case"aa":case"aaa":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(WO(n),0,0,0),t}}],n&&KD(e.prototype,n),r&&KD(e,r),s}(rO);function iF(t){return iF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iF(t)}function sF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function aF(t,e){return aF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},aF(t,e)}function lF(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=hF(t);if(e){var i=hF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return cF(this,n)}}function cF(t,e){return!e||"object"!==iF(e)&&"function"!=typeof e?uF(t):e}function uF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hF(t){return hF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hF(t)}function dF(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&aF(t,e)}(s,t);var e,n,r,i=lF(s);function s(){var t;sF(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return dF(uF(t=i.call.apply(i,[this].concat(n))),"priority",80),dF(uF(t),"incompatibleTokens",["a","B","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"b":case"bb":case"bbb":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(WO(n),0,0,0),t}}],n&&oF(e.prototype,n),r&&oF(e,r),s}(rO);function fF(t){return fF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fF(t)}function mF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yF(t,e){return yF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yF(t,e)}function bF(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wF(t);if(e){var i=wF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return vF(this,n)}}function vF(t,e){return!e||"object"!==fF(e)&&"function"!=typeof e?xF(t):e}function xF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wF(t){return wF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wF(t)}function _F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var SF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yF(t,e)}(s,t);var e,n,r,i=bF(s);function s(){var t;mF(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return _F(xF(t=i.call.apply(i,[this].concat(n))),"priority",80),_F(xF(t),"incompatibleTokens",["a","b","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"B":case"BB":case"BBB":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(t,{width:"narrow",context:"formatting"});default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(t,e,n){return t.setUTCHours(WO(n),0,0,0),t}}],n&&gF(e.prototype,n),r&&gF(e,r),s}(rO);function kF(t){return kF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kF(t)}function TF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function EF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function MF(t,e){return MF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},MF(t,e)}function CF(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=IF(t);if(e){var i=IF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return AF(this,n)}}function AF(t,e){return!e||"object"!==kF(e)&&"function"!=typeof e?NF(t):e}function NF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function IF(t){return IF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},IF(t)}function $F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var RF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&MF(t,e)}(s,t);var e,n,r,i=CF(s);function s(){var t;TF(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return $F(NF(t=i.call.apply(i,[this].concat(n))),"priority",70),$F(NF(t),"incompatibleTokens",["H","K","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"h":return zO(wO,t);case"ho":return n.ordinalNumber(t,{unit:"hour"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=12}},{key:"set",value:function(t,e,n){var r=t.getUTCHours()>=12;return r&&n<12?t.setUTCHours(n+12,0,0,0):r||12!==n?t.setUTCHours(n,0,0,0):t.setUTCHours(0,0,0,0),t}}],n&&EF(e.prototype,n),r&&EF(e,r),s}(rO);function OF(t){return OF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},OF(t)}function PF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function LF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function DF(t,e){return DF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},DF(t,e)}function FF(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=UF(t);if(e){var i=UF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return zF(this,n)}}function zF(t,e){return!e||"object"!==OF(e)&&"function"!=typeof e?BF(t):e}function BF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function UF(t){return UF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},UF(t)}function VF(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var jF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&DF(t,e)}(s,t);var e,n,r,i=FF(s);function s(){var t;PF(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return VF(BF(t=i.call.apply(i,[this].concat(n))),"priority",70),VF(BF(t),"incompatibleTokens",["a","b","h","K","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"H":return zO(bO,t);case"Ho":return n.ordinalNumber(t,{unit:"hour"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=23}},{key:"set",value:function(t,e,n){return t.setUTCHours(n,0,0,0),t}}],n&&LF(e.prototype,n),r&&LF(e,r),s}(rO);function WF(t){return WF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WF(t)}function HF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qF(t,e){return qF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qF(t,e)}function XF(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ZF(t);if(e){var i=ZF(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return YF(this,n)}}function YF(t,e){return!e||"object"!==WF(e)&&"function"!=typeof e?KF(t):e}function KF(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ZF(t){return ZF=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ZF(t)}function JF(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var QF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qF(t,e)}(s,t);var e,n,r,i=XF(s);function s(){var t;HF(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return JF(KF(t=i.call.apply(i,[this].concat(n))),"priority",70),JF(KF(t),"incompatibleTokens",["h","H","k","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"K":return zO(xO,t);case"Ko":return n.ordinalNumber(t,{unit:"hour"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=11}},{key:"set",value:function(t,e,n){return t.getUTCHours()>=12&&n<12?t.setUTCHours(n+12,0,0,0):t.setUTCHours(n,0,0,0),t}}],n&&GF(e.prototype,n),r&&GF(e,r),s}(rO);function tz(t){return tz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tz(t)}function ez(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nz(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rz(t,e){return rz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},rz(t,e)}function iz(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=az(t);if(e){var i=az(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return sz(this,n)}}function sz(t,e){return!e||"object"!==tz(e)&&"function"!=typeof e?oz(t):e}function oz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function az(t){return az=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},az(t)}function lz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var cz=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rz(t,e)}(s,t);var e,n,r,i=iz(s);function s(){var t;ez(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return lz(oz(t=i.call.apply(i,[this].concat(n))),"priority",70),lz(oz(t),"incompatibleTokens",["a","b","h","H","K","t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"k":return zO(vO,t);case"ko":return n.ordinalNumber(t,{unit:"hour"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=1&&e<=24}},{key:"set",value:function(t,e,n){var r=n<=24?n%24:n;return t.setUTCHours(r,0,0,0),t}}],n&&nz(e.prototype,n),r&&nz(e,r),s}(rO);function uz(t){return uz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uz(t)}function hz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dz(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pz(t,e){return pz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pz(t,e)}function fz(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=yz(t);if(e){var i=yz(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return mz(this,n)}}function mz(t,e){return!e||"object"!==uz(e)&&"function"!=typeof e?gz(t):e}function gz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yz(t){return yz=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},yz(t)}function bz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vz=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pz(t,e)}(s,t);var e,n,r,i=fz(s);function s(){var t;hz(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return bz(gz(t=i.call.apply(i,[this].concat(n))),"priority",60),bz(gz(t),"incompatibleTokens",["t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"m":return zO(_O,t);case"mo":return n.ordinalNumber(t,{unit:"minute"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=59}},{key:"set",value:function(t,e,n){return t.setUTCMinutes(n,0,0),t}}],n&&dz(e.prototype,n),r&&dz(e,r),s}(rO);function xz(t){return xz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xz(t)}function wz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sz(t,e){return Sz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Sz(t,e)}function kz(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mz(t);if(e){var i=Mz(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tz(this,n)}}function Tz(t,e){return!e||"object"!==xz(e)&&"function"!=typeof e?Ez(t):e}function Ez(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mz(t){return Mz=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mz(t)}function Cz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Az=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sz(t,e)}(s,t);var e,n,r,i=kz(s);function s(){var t;wz(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Cz(Ez(t=i.call.apply(i,[this].concat(n))),"priority",50),Cz(Ez(t),"incompatibleTokens",["t","T"]),t}return e=s,n=[{key:"parse",value:function(t,e,n){switch(e){case"s":return zO(SO,t);case"so":return n.ordinalNumber(t,{unit:"second"});default:return VO(e.length,t)}}},{key:"validate",value:function(t,e){return e>=0&&e<=59}},{key:"set",value:function(t,e,n){return t.setUTCSeconds(n,0),t}}],n&&_z(e.prototype,n),r&&_z(e,r),s}(rO);function Nz(t){return Nz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nz(t)}function Iz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rz(t,e){return Rz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rz(t,e)}function Oz(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Dz(t);if(e){var i=Dz(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Pz(this,n)}}function Pz(t,e){return!e||"object"!==Nz(e)&&"function"!=typeof e?Lz(t):e}function Lz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dz(t){return Dz=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Dz(t)}function Fz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var zz=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rz(t,e)}(s,t);var e,n,r,i=Oz(s);function s(){var t;Iz(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Fz(Lz(t=i.call.apply(i,[this].concat(n))),"priority",30),Fz(Lz(t),"incompatibleTokens",["t","T"]),t}return e=s,(n=[{key:"parse",value:function(t,e){return FO(VO(e.length,t),(function(t){return Math.floor(t*Math.pow(10,3-e.length))}))}},{key:"set",value:function(t,e,n){return t.setUTCMilliseconds(n),t}}])&&$z(e.prototype,n),r&&$z(e,r),s}(rO);function Bz(t){return Bz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bz(t)}function Uz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vz(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jz(t,e){return jz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},jz(t,e)}function Wz(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qz(t);if(e){var i=qz(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hz(this,n)}}function Hz(t,e){return!e||"object"!==Bz(e)&&"function"!=typeof e?Gz(t):e}function Gz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qz(t){return qz=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},qz(t)}function Xz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yz=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jz(t,e)}(s,t);var e,n,r,i=Wz(s);function s(){var t;Uz(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Xz(Gz(t=i.call.apply(i,[this].concat(n))),"priority",10),Xz(Gz(t),"incompatibleTokens",["t","T","x"]),t}return e=s,(n=[{key:"parse",value:function(t,e){switch(e){case"X":return BO(RO,t);case"XX":return BO(OO,t);case"XXXX":return BO(PO,t);case"XXXXX":return BO(DO,t);default:return BO(LO,t)}}},{key:"set",value:function(t,e,n){return e.timestampIsSet?t:new Date(t.getTime()-n)}}])&&Vz(e.prototype,n),r&&Vz(e,r),s}(rO);function Kz(t){return Kz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kz(t)}function Zz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jz(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qz(t,e){return Qz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qz(t,e)}function tB(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=rB(t);if(e){var i=rB(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eB(this,n)}}function eB(t,e){return!e||"object"!==Kz(e)&&"function"!=typeof e?nB(t):e}function nB(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rB(t){return rB=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},rB(t)}function iB(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var sB=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qz(t,e)}(s,t);var e,n,r,i=tB(s);function s(){var t;Zz(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return iB(nB(t=i.call.apply(i,[this].concat(n))),"priority",10),iB(nB(t),"incompatibleTokens",["t","T","X"]),t}return e=s,(n=[{key:"parse",value:function(t,e){switch(e){case"x":return BO(RO,t);case"xx":return BO(OO,t);case"xxxx":return BO(PO,t);case"xxxxx":return BO(DO,t);default:return BO(LO,t)}}},{key:"set",value:function(t,e,n){return e.timestampIsSet?t:new Date(t.getTime()-n)}}])&&Jz(e.prototype,n),r&&Jz(e,r),s}(rO);function oB(t){return oB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oB(t)}function aB(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cB(t,e){return cB=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},cB(t,e)}function uB(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=pB(t);if(e){var i=pB(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return hB(this,n)}}function hB(t,e){return!e||"object"!==oB(e)&&"function"!=typeof e?dB(t):e}function dB(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pB(t){return pB=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},pB(t)}function fB(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var mB=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&cB(t,e)}(s,t);var e,n,r,i=uB(s);function s(){var t;aB(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return fB(dB(t=i.call.apply(i,[this].concat(n))),"priority",40),fB(dB(t),"incompatibleTokens","*"),t}return e=s,(n=[{key:"parse",value:function(t){return UO(t)}},{key:"set",value:function(t,e,n){return[new Date(1e3*n),{timestampIsSet:!0}]}}])&&lB(e.prototype,n),r&&lB(e,r),s}(rO);function gB(t){return gB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gB(t)}function yB(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vB(t,e){return vB=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vB(t,e)}function xB(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=SB(t);if(e){var i=SB(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return wB(this,n)}}function wB(t,e){return!e||"object"!==gB(e)&&"function"!=typeof e?_B(t):e}function _B(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function SB(t){return SB=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},SB(t)}function kB(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var TB=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vB(t,e)}(s,t);var e,n,r,i=xB(s);function s(){var t;yB(this,s);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return kB(_B(t=i.call.apply(i,[this].concat(n))),"priority",20),kB(_B(t),"incompatibleTokens","*"),t}return e=s,(n=[{key:"parse",value:function(t){return UO(t)}},{key:"set",value:function(t,e,n){return[new Date(n),{timestampIsSet:!0}]}}])&&bB(e.prototype,n),r&&bB(e,r),s}(rO);function EB(t){let e;return{c(){e=RN(t[1])},m(t,n){CN(t,e,n)},p(t,n){2&n&&BN(e,t[1])},i:nN,o:nN,d(t){t&&AN(e)}}}function MB(t){let e,n=t[1].toPrecision(2)+"";return{c(){e=RN(n)},m(t,n){CN(t,e,n)},p(t,r){2&r&&n!==(n=t[1].toPrecision(2)+"")&&BN(e,n)},i:nN,o:nN,d(t){t&&AN(e)}}}function CB(t){let e,n,r,i=LB(t[1]).join(", ")+"";return{c(){e=RN("Array("),n=RN(i),r=RN(")")},m(t,i){CN(t,e,i),CN(t,n,i),CN(t,r,i)},p(t,e){2&e&&i!==(i=LB(t[1]).join(", ")+"")&&BN(n,i)},i:nN,o:nN,d(t){t&&AN(e),t&&AN(n),t&&AN(r)}}}function AB(t){let e,n=t[3](t[1])+"";return{c(){e=RN(n)},m(t,n){CN(t,e,n)},p(t,r){2&r&&n!==(n=t[3](t[1])+"")&&BN(e,n)},i:nN,o:nN,d(t){t&&AN(e)}}}function NB(t){let e;const n=t[4].default,r=fN(n,t,t[7],null);return{c(){r&&r.c()},m(t,n){r&&r.m(t,n),e=!0},p(t,i){r&&r.p&&(!e||128&i)&&yN(r,n,t,t[7],e?gN(n,t[7],i,null):bN(t[7]),null)},i(t){e||(NI(r,t),e=!0)},o(t){II(r,t),e=!1},d(t){r&&r.d(t)}}}function IB(t){let e,n;return e=new XI({props:{size:"small",$$slots:{default:[OB]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};130&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function $B(t){let e,n,r,i,s=t[1].text+"";return{c(){e=IN("sl-button"),n=RN(s),zN(e,"type","text"),zN(e,"size","small")},m(s,o){CN(s,e,o),TN(e,n),r||(i=LN(e,"click",t[5]),r=!0)},p(t,e){2&e&&s!==(s=t[1].text+"")&&BN(n,s)},i:nN,o:nN,d(t){t&&AN(e),r=!1,i()}}}function RB(t){let e,n;return{c(){e=IN("img"),FN(e,"alt","thumbnail"),uN(e.src,n=t[1])||FN(e,"src",n),FN(e,"width","30"),FN(e,"height","30"),FN(e,"class","rounded-md")},m(t,n){CN(t,e,n)},p(t,r){2&r&&!uN(e.src,n=t[1])&&FN(e,"src",n)},i:nN,o:nN,d(t){t&&AN(e)}}}function OB(t){let e;return{c(){e=RN(t[1])},m(t,n){CN(t,e,n)},p(t,n){2&n&&BN(e,t[1])},d(t){t&&AN(e)}}}function PB(t){let e,n,r,i;const s=[RB,$B,IB,NB,AB,CB,MB,EB],o=[];function a(t,e){return"image"===t[0]?0:"link"===t[0]?1:"action"===t[0]?2:"slot"===t[0]?3:"date"===t[0]?4:"array"===t[0]?5:"number"==typeof t[1]?6:7}return n=a(t),r=o[n]=s[n](t),{c(){e=IN("td"),r.c(),FN(e,"class","svelte-1w1eb18")},m(t,r){CN(t,e,r),o[n].m(e,null),i=!0},p(t,[i]){let l=n;n=a(t),n===l?o[n].p(t,i):(CI(),II(o[l],1,1,(()=>{o[l]=null})),AI(),r=o[n],r?r.p(t,i):(r=o[n]=s[n](t),r.c()),NI(r,1),r.m(e,null))},i(t){i||(NI(r),i=!0)},o(t){II(r),i=!1},d(t){t&&AN(e),o[n].d()}}}function LB(t){return Array.isArray(t)?t.length>0&&Array.isArray(t[0])?[t.length,...LB(t[0])]:[t.length]:[]}function DB(t,e,n){let{$$slots:r={},$$scope:i}=e,{type:s="generic"}=e,{value:o=null}=e;const a=oI();return t.$$set=t=>{"type"in t&&n(0,s=t.type),"value"in t&&n(1,o=t.value),"$$scope"in t&&n(7,i=t.$$scope)},[s,o,a,function(t){try{return function(t,e){return iR(1,arguments),GR(t,Date.now(),e)}(Date.parse(t),{includeSeconds:!0,addSuffix:!0})}catch(e){return console.log("Date Parsing Error",t,e),t}},r,()=>{console.log("GOTO:",o.href)},()=>a("action",o),i]}new pO,new nP,new dP,new _P,new $P,new VP,new JP,new lL,new bL,new CL,new FL,new KL,new oD,new yD,new MD,new DD,new qD,new rF,new pF,new SF,new RF,new jF,new QF,new cz,new vz,new Az,new zz,new Yz,new sB,new mB,new TB;class FB extends HI{constructor(t){super(),WI(this,t,DB,PB,lN,{type:0,value:1})}}function zB(t){let e,n,r,i;const s=[UB,BB],o=[];function a(t,e){return t[2]?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=PN()},m(t,n){o[e].m(t,n),CN(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(CI(),II(o[l],1,1,(()=>{o[l]=null})),AI(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),NI(n,1),n.m(r.parentNode,r))},i(t){i||(NI(n),i=!0)},o(t){II(n),i=!1},d(t){o[e].d(t),t&&AN(r)}}}function BB(t){let e,n;return e=new XI({props:{round:!0,size:"small",$$slots:{default:[VB]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};64&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function UB(t){let e,n;return e=new XI({props:{round:!0,size:"small",$$slots:{default:[jB]},$$scope:{ctx:t}}}),e.$on("click",t[3]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};64&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function VB(t){let e,n;return{c(){e=$N("svg"),n=$N("path"),FN(n,"stroke-linecap","round"),FN(n,"stroke-linejoin","round"),FN(n,"stroke-width","2"),FN(n,"d","M16 17l-4 4m0 0l-4-4m4 4V3"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"class","h-6 w-6"),FN(e,"fill","none"),FN(e,"viewBox","0 0 24 24"),FN(e,"stroke","currentColor")},m(t,r){CN(t,e,r),TN(e,n)},p:nN,d(t){t&&AN(e)}}}function jB(t){let e,n;return{c(){e=$N("svg"),n=$N("path"),FN(n,"stroke-linecap","round"),FN(n,"stroke-linejoin","round"),FN(n,"stroke-width","2"),FN(n,"d","M8 7l4-4m0 0l4 4m-4-4v18"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"class","h-6 w-6"),FN(e,"fill","none"),FN(e,"viewBox","0 0 24 24"),FN(e,"stroke","currentColor")},m(t,r){CN(t,e,r),TN(e,n)},p:nN,d(t){t&&AN(e)}}}function WB(t){let e,n,r,i,s,o,a=t[1]&&zB(t);return{c(){e=IN("th"),n=IN("span"),r=IN("span"),i=RN(t[0]),s=ON(),a&&a.c(),VN(r,"margin-top","0.5rem"),VN(r,"margin-bottom","0.5rem"),VN(n,"display","flex"),VN(n,"justify-content","space-between"),VN(n,"align-items","center"),FN(e,"class","svelte-1310j1m")},m(t,l){CN(t,e,l),TN(e,n),TN(n,r),TN(r,i),TN(n,s),a&&a.m(n,null),o=!0},p(t,[e]){(!o||1&e)&&BN(i,t[0]),t[1]?a?(a.p(t,e),2&e&&NI(a,1)):(a=zB(t),a.c(),NI(a,1),a.m(n,null)):a&&(CI(),II(a,1,1,(()=>{a=null})),AI())},i(t){o||(NI(a),o=!0)},o(t){II(a),o=!1},d(t){t&&AN(e),a&&a.d()}}}function HB(t,e,n){let{name:r="name"}=e,{sortable:i=!1}=e,{sorting:s={col:"",ascending:!0}}=e;const o=oI();let a=!0;return t.$$set=t=>{"name"in t&&n(0,r=t.name),"sortable"in t&&n(1,i=t.sortable),"sorting"in t&&n(4,s=t.sorting)},t.$$.update=()=>{17&t.$$.dirty&&s.col===r&&n(2,a=s.ascending)},[r,i,a,function(){n(2,a=!a),o("sort",{col:r,ascending:a})},s]}class GB extends HI{constructor(t){super(),WI(this,t,HB,WB,lN,{name:0,sortable:1,sorting:4})}}function qB(t,e,n){const r=t.slice();return r[10]=e[n].name,r[11]=e[n].multiple,r[12]=e[n].confirm,r}function XB(t){let e,n=t[10]+"";return{c(){e=RN(n)},m(t,n){CN(t,e,n)},p(t,r){2&r&&n!==(n=t[10]+"")&&BN(e,n)},d(t){t&&AN(e)}}}function YB(t){let e,n;return e=new XI({props:{size:"small",disabled:!1===t[11]&&t[0].length>1,type:"delete"===t[10]?"danger":"default",$$slots:{default:[XB]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[7](t[10],t[12])})),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(n,r){t=n;const i={};3&r&&(i.disabled=!1===t[11]&&t[0].length>1),2&r&&(i.type="delete"===t[10]?"danger":"default"),32770&r&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function KB(t){let e,n;return e=new t$({props:{$$slots:{default:[QB]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};32780&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function ZB(t){let e;return{c(){e=RN("Cancel")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function JB(t){let e;return{c(){e=RN("Confirm")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function QB(t){let e,n,r,i,s,o,a,l,c,u,h,d,p;return l=new XI({props:{type:"danger",$$slots:{default:[ZB]},$$scope:{ctx:t}}}),l.$on("click",t[8]),d=new XI({props:{variant:"filled",$$slots:{default:[JB]},$$scope:{ctx:t}}}),d.$on("click",t[4]),{c(){e=IN("div"),n=IN("p"),r=RN("Do you want to "),i=RN(t[2]),s=RN(" the selected items?"),o=ON(),a=IN("div"),UI(l.$$.fragment),c=ON(),u=IN("span"),h=ON(),UI(d.$$.fragment),FN(u,"class","w-2"),FN(a,"class","w-full flex justify-end"),FN(e,"class","p-8")},m(t,f){CN(t,e,f),TN(e,n),TN(n,r),TN(n,i),TN(n,s),TN(e,o),TN(e,a),VI(l,a,null),TN(a,c),TN(a,u),TN(a,h),VI(d,a,null),p=!0},p(t,e){(!p||4&e)&&BN(i,t[2]);const n={};32768&e&&(n.$$scope={dirty:e,ctx:t}),l.$set(n);const r={};32768&e&&(r.$$scope={dirty:e,ctx:t}),d.$set(r)},i(t){p||(NI(l.$$.fragment,t),NI(d.$$.fragment,t),p=!0)},o(t){II(l.$$.fragment,t),II(d.$$.fragment,t),p=!1},d(t){t&&AN(e),jI(l),jI(d)}}}function tU(t){let e,n,r,i,s=t[1],o=[];for(let e=0;e<s.length;e+=1)o[e]=YB(qB(t,s,e));const a=t=>II(o[t],1,1,(()=>{o[t]=null}));let l=t[3]&&KB(t);return{c(){e=IN("div");for(let t=0;t<o.length;t+=1)o[t].c();n=ON(),l&&l.c(),r=PN(),FN(e,"class","actions")},m(t,s){CN(t,e,s);for(let t=0;t<o.length;t+=1)o[t].m(e,null);CN(t,n,s),l&&l.m(t,s),CN(t,r,s),i=!0},p(t,[n]){if(35&n){let r;for(s=t[1],r=0;r<s.length;r+=1){const i=qB(t,s,r);o[r]?(o[r].p(i,n),NI(o[r],1)):(o[r]=YB(i),o[r].c(),NI(o[r],1),o[r].m(e,null))}for(CI(),r=s.length;r<o.length;r+=1)a(r);AI()}t[3]?l?(l.p(t,n),8&n&&NI(l,1)):(l=KB(t),l.c(),NI(l,1),l.m(r.parentNode,r)):l&&(CI(),II(l,1,1,(()=>{l=null})),AI())},i(t){if(!i){for(let t=0;t<s.length;t+=1)NI(o[t]);NI(l),i=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)II(o[t]);II(l),i=!1},d(t){t&&AN(e),NN(o,t),t&&AN(n),l&&l.d(t),t&&AN(r)}}}function eU(t,e,n){let{provider:r}=e,{actions:i}=e,{selected:s}=e;const o=oI();let a="",l=!1;async function c(){if("delete"===a)for(const t of s)await r.delete(t);else o("action",[a,s]);n(3,l=!1),n(0,s=[]),o("selected",s)}function u(t,e){n(2,a=t),a&&0!==s.length&&(e?n(3,l=!0):c())}return t.$$set=t=>{"provider"in t&&n(6,r=t.provider),"actions"in t&&n(1,i=t.actions),"selected"in t&&n(0,s=t.selected)},[s,i,a,l,c,u,r,(t,e)=>u(t,e),()=>{n(3,l=!1)}]}class nU extends HI{constructor(t){super(),WI(this,t,eU,tU,lN,{provider:6,actions:1,selected:0})}}function rU(t){let e,n,r;function i(e){t[11](e)}let s={provider:t[1],actions:t[2]};return void 0!==t[0]&&(s.selected=t[0]),e=new nU({props:s}),uI.push((()=>BI(e,"selected",i))),e.$on("selected",t[12]),e.$on("action",t[13]),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};2&r&&(i.provider=t[1]),4&r&&(i.actions=t[2]),!n&&1&r&&(n=!0,i.selected=t[0],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function iU(t){let e,n;return{c(){e=$N("svg"),n=$N("path"),FN(n,"stroke-linecap","round"),FN(n,"stroke-linejoin","round"),FN(n,"stroke-width","2"),FN(n,"d","M15 19l-7-7 7-7"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"class","h-3 w-3"),FN(e,"fill","none"),FN(e,"viewBox","0 0 24 24"),FN(e,"stroke","currentColor")},m(t,r){CN(t,e,r),TN(e,n)},p:nN,d(t){t&&AN(e)}}}function sU(t){let e,n;return{c(){e=$N("svg"),n=$N("path"),FN(n,"stroke-linecap","round"),FN(n,"stroke-linejoin","round"),FN(n,"stroke-width","2"),FN(n,"d","M9 5l7 7-7 7"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"class","h-3 w-3"),FN(e,"fill","none"),FN(e,"viewBox","0 0 24 24"),FN(e,"stroke","currentColor")},m(t,r){CN(t,e,r),TN(e,n)},p:nN,d(t){t&&AN(e)}}}function oU(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,_,S,k,T,E=t[2].length>0&&t[0].length>0&&rU(t);return l=new F$({props:{size:"small",options:["10","20","50","all"],value:t[5].toString()}}),l.$on("change",t[14]),y=new XI({props:{round:!0,disabled:1===t[3],$$slots:{default:[iU]},$$scope:{ctx:t}}}),y.$on("click",t[15]),_=new XI({props:{round:!0,disabled:t[3]===t[6],$$slots:{default:[sU]},$$scope:{ctx:t}}}),_.$on("click",t[17]),{c(){e=IN("div"),n=IN("div"),E&&E.c(),r=ON(),i=IN("div"),s=IN("div"),o=RN("Items per page:\n\t\t\t"),a=IN("div"),UI(l.$$.fragment),c=ON(),u=IN("div"),h=RN(t[7]),d=RN("-"),p=RN(t[8]),f=RN(" of "),m=RN(t[4]),g=ON(),UI(y.$$.fragment),b=ON(),v=IN("input"),w=ON(),UI(_.$$.fragment),FN(n,"class","actions"),FN(a,"class","w-12 ml-2"),FN(s,"class","flex items-center mx-4"),FN(u,"class","mx-3"),FN(v,"class","marcelle w-8 rounded mr-1 mb-1 bg-white text-gray-600 border border-solid border-gray-300 text-center focus:outline-none focus:ring-blue-400 focus:ring-2 focus:ring-opacity-50 active:ring-blue-400 active:ring-4 active:ring-opacity-50"),v.value=x=t[3].toString(),FN(i,"class","flex items-center"),FN(e,"class","table-footer svelte-13k2ee6")},m(x,M){CN(x,e,M),TN(e,n),E&&E.m(n,null),TN(e,r),TN(e,i),TN(i,s),TN(s,o),TN(s,a),VI(l,a,null),TN(i,c),TN(i,u),TN(u,h),TN(u,d),TN(u,p),TN(u,f),TN(u,m),TN(i,g),VI(y,i,null),TN(i,b),TN(i,v),TN(i,w),VI(_,i,null),S=!0,k||(T=LN(v,"blur",t[16]),k=!0)},p(t,[e]){t[2].length>0&&t[0].length>0?E?(E.p(t,e),5&e&&NI(E,1)):(E=rU(t),E.c(),NI(E,1),E.m(n,null)):E&&(CI(),II(E,1,1,(()=>{E=null})),AI());const r={};32&e&&(r.value=t[5].toString()),l.$set(r),(!S||128&e)&&BN(h,t[7]),(!S||256&e)&&BN(p,t[8]),(!S||16&e)&&BN(m,t[4]);const i={};8&e&&(i.disabled=1===t[3]),262144&e&&(i.$$scope={dirty:e,ctx:t}),y.$set(i),(!S||8&e&&x!==(x=t[3].toString())&&v.value!==x)&&(v.value=x);const s={};72&e&&(s.disabled=t[3]===t[6]),262144&e&&(s.$$scope={dirty:e,ctx:t}),_.$set(s)},i(t){S||(NI(E),NI(l.$$.fragment,t),NI(y.$$.fragment,t),NI(_.$$.fragment,t),S=!0)},o(t){II(E),II(l.$$.fragment,t),II(y.$$.fragment,t),II(_.$$.fragment,t),S=!1},d(t){t&&AN(e),E&&E.d(),jI(l),jI(y),jI(_),k=!1,T()}}}function aU(t,e,n){let r,{provider:i}=e,{actions:s}=e,{selected:o}=e,a=1,l=1,c=0,u=0,h=0,d=()=>{};function p(t){n(3,a=t),i.page(t)}return t.$$set=t=>{"provider"in t&&n(1,i=t.provider),"actions"in t&&n(2,s=t.actions),"selected"in t&&n(0,o=t.selected)},t.$$.update=()=>{2&t.$$.dirty&&n(5,r=i.options.itemsPerPage),1082&t.$$.dirty&&(d(),n(10,d=i.total.subscribe((t=>{void 0===t||0===t?(n(6,l=1),n(7,c=0),n(8,u=0),n(4,h=0)):(n(6,l=Math.ceil(h/r)),n(7,c=(a-1)*r+1),n(8,u=Math.min(h||0,a*r)),n(4,h=t))}))))},[o,i,s,a,h,r,l,c,u,p,d,function(t){o=t,n(0,o)},function(e){lI.call(this,t,e)},function(e){lI.call(this,t,e)},({detail:t})=>{const e="all"===t?h:parseInt(t);i.paginate(e),n(5,r=e)},()=>{p(a-1)},t=>{let e=parseInt(t.currentTarget.value);isNaN(e)||p(Math.max(1,Math.min(l,e)))},()=>{p(a+1)}]}class lU extends HI{constructor(t){super(),WI(this,t,aU,oU,lN,{provider:1,actions:2,selected:0})}}function cU(t,e,n){const r=t.slice();return r[22]=e[n],r[24]=n,r}function uU(t,e,n){const r=t.slice();return r[25]=e[n].type,r[26]=e[n].name,r}function hU(t,e,n){const r=t.slice();return r[26]=e[n].name,r[29]=e[n].sortable,r}function dU(t){let e,n,r,i,s,o,a,l;return{c(){e=IN("div"),n=IN("sl-alert"),r=IN("sl-icon"),i=ON(),s=IN("strong"),s.textContent="Table Data Error",o=IN("br"),a=ON(),l=RN(t[9]),zN(r,"slot","icon"),zN(r,"name","check2-circle"),zN(n,"type","danger"),zN(n,"open",""),FN(e,"class","service-error")},m(t,c){CN(t,e,c),TN(e,n),TN(n,r),TN(n,i),TN(n,s),TN(n,o),TN(n,a),TN(n,l)},p(t,e){512&e[0]&&BN(l,t[9])},d(t){t&&AN(e)}}}function pU(t){let e,n=!t[4]&&fU(t);return{c(){e=IN("th"),n&&n.c(),FN(e,"class","svelte-12gp9na")},m(t,r){CN(t,e,r),n&&n.m(e,null)},p(t,r){t[4]?n&&(n.d(1),n=null):n?n.p(t,r):(n=fU(t),n.c(),n.m(e,null))},d(t){t&&AN(e),n&&n.d()}}}function fU(t){let e,n,r,i;return{c(){e=IN("input"),FN(e,"type","checkbox"),e.checked=n=t[6].length>0&&t[6].length===t[10].length},m(n,s){CN(n,e,s),r||(i=LN(e,"click",t[12]),r=!0)},p(t,r){1088&r[0]&&n!==(n=t[6].length>0&&t[6].length===t[10].length)&&(e.checked=n)},d(t){t&&AN(e),r=!1,i()}}}function mU(t){let e,n;return e=new GB({props:{name:t[26],sortable:t[29],sorting:t[7]}}),e.$on("sort",t[11]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};1&n[0]&&(r.name=t[26]),1&n[0]&&(r.sortable=t[29]),128&n[0]&&(r.sorting=t[7]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function gU(t){let e,n;return e=new FB({props:{type:"slot",$$slots:{default:[yU]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};64&n[0]|2&n[1]&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function yU(t){let e,n,r,i;function s(...e){return t[16](t[24],...e)}return{c(){e=IN("input"),FN(e,"type","checkbox"),e.checked=n=t[6].includes(t[24])},m(t,n){CN(t,e,n),r||(i=LN(e,"click",s),r=!0)},p(r,i){t=r,64&i[0]&&n!==(n=t[6].includes(t[24]))&&(e.checked=n)},d(t){t&&AN(e),r=!1,i()}}}function bU(t){let e,n;return e=new FB({props:{type:t[25],value:t[22][t[26]]}}),e.$on("action",(function(...e){return t[17](t[24],...e)})),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(n,r){t=n;const i={};1&r[0]&&(i.type=t[25]),1025&r[0]&&(i.value=t[22][t[26]]),e.$set(i)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function vU(t){let e,n,r,i,s=t[3]&&gU(t),o=t[0],a=[];for(let e=0;e<o.length;e+=1)a[e]=bU(uU(t,o,e));const l=t=>II(a[t],1,1,(()=>{a[t]=null}));return{c(){e=IN("tr"),s&&s.c(),n=ON();for(let t=0;t<a.length;t+=1)a[t].c();r=ON(),FN(e,"class","svelte-12gp9na")},m(t,o){CN(t,e,o),s&&s.m(e,null),TN(e,n);for(let t=0;t<a.length;t+=1)a[t].m(e,null);TN(e,r),i=!0},p(t,i){if(t[3]?s?(s.p(t,i),8&i[0]&&NI(s,1)):(s=gU(t),s.c(),NI(s,1),s.m(e,n)):s&&(CI(),II(s,1,1,(()=>{s=null})),AI()),17409&i[0]){let n;for(o=t[0],n=0;n<o.length;n+=1){const s=uU(t,o,n);a[n]?(a[n].p(s,i),NI(a[n],1)):(a[n]=bU(s),a[n].c(),NI(a[n],1),a[n].m(e,r))}for(CI(),n=o.length;n<a.length;n+=1)l(n);AI()}},i(t){if(!i){NI(s);for(let t=0;t<o.length;t+=1)NI(a[t]);i=!0}},o(t){II(s),a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)II(a[t]);i=!1},d(t){t&&AN(e),s&&s.d(),NN(a,t)}}}function xU(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[9]&&dU(t),f=t[3]&&pU(t),m=t[0],g=[];for(let e=0;e<m.length;e+=1)g[e]=mU(hU(t,m,e));const y=t=>II(g[t],1,1,(()=>{g[t]=null}));let b=t[10],v=[];for(let e=0;e<b.length;e+=1)v[e]=vU(cU(t,b,e));const x=t=>II(v[t],1,1,(()=>{v[t]=null}));function w(e){t[18](e)}let _={provider:t[1],actions:t[2]};return void 0!==t[6]&&(_.selected=t[6]),u=new lU({props:_}),uI.push((()=>BI(u,"selected",w))),u.$on("action",t[19]),{c(){p&&p.c(),e=ON(),n=IN("div"),r=IN("table"),i=IN("thead"),s=IN("tr"),f&&f.c(),o=ON();for(let t=0;t<g.length;t+=1)g[t].c();a=ON(),l=IN("tbody");for(let t=0;t<v.length;t+=1)v[t].c();c=ON(),UI(u.$$.fragment),FN(s,"class","svelte-12gp9na"),FN(i,"class","svelte-12gp9na"),FN(l,"class","svelte-12gp9na"),FN(r,"class","svelte-12gp9na"),FN(n,"class","marcelle table-container svelte-12gp9na")},m(t,h){p&&p.m(t,h),CN(t,e,h),CN(t,n,h),TN(n,r),TN(r,i),TN(i,s),f&&f.m(s,null),TN(s,o);for(let t=0;t<g.length;t+=1)g[t].m(s,null);TN(r,a),TN(r,l);for(let t=0;t<v.length;t+=1)v[t].m(l,null);TN(n,c),VI(u,n,null),d=!0},p(t,n){if(t[9]?p?p.p(t,n):(p=dU(t),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null),t[3]?f?f.p(t,n):(f=pU(t),f.c(),f.m(s,o)):f&&(f.d(1),f=null),2177&n[0]){let e;for(m=t[0],e=0;e<m.length;e+=1){const r=hU(t,m,e);g[e]?(g[e].p(r,n),NI(g[e],1)):(g[e]=mU(r),g[e].c(),NI(g[e],1),g[e].m(s,null))}for(CI(),e=m.length;e<g.length;e+=1)y(e);AI()}if(25673&n[0]){let e;for(b=t[10],e=0;e<b.length;e+=1){const r=cU(t,b,e);v[e]?(v[e].p(r,n),NI(v[e],1)):(v[e]=vU(r),v[e].c(),NI(v[e],1),v[e].m(l,null))}for(CI(),e=b.length;e<v.length;e+=1)x(e);AI()}const r={};2&n[0]&&(r.provider=t[1]),4&n[0]&&(r.actions=t[2]),!h&&64&n[0]&&(h=!0,r.selected=t[6],bI((()=>h=!1))),u.$set(r)},i(t){if(!d){for(let t=0;t<m.length;t+=1)NI(g[t]);for(let t=0;t<b.length;t+=1)NI(v[t]);NI(u.$$.fragment,t),d=!0}},o(t){g=g.filter(Boolean);for(let t=0;t<g.length;t+=1)II(g[t]);v=v.filter(Boolean);for(let t=0;t<v.length;t+=1)II(v[t]);II(u.$$.fragment,t),d=!1},d(t){p&&p.d(t),t&&AN(e),t&&AN(n),f&&f.d(),NN(g,t),NN(v,t),jI(u)}}}function wU(t,e,n){let r,i,s,o,a=nN,l=nN;t.$$.on_destroy.push((()=>a())),t.$$.on_destroy.push((()=>l()));let{columns:c}=e,{provider:u}=e,{actions:h=[]}=e,{selectable:d=!0}=e,{singleSelection:p=!1}=e,{selection:f=[]}=e,m=[];const g=oI();let y={col:"",ascending:!0};async function b(){n(15,f=await Promise.all(m.map(u.get.bind(u)))),g("selection",f)}function v(t,e){p?(n(6,m=e.currentTarget.checked?[t]:[]),b()):e.currentTarget.checked?m.includes(t)||(n(6,m=m.concat([t])),b()):(n(6,m=m.filter((e=>e!==t))),b())}async function x([t,e]){const n=Array.isArray(e)?await Promise.all(e.map(u.get.bind(u))):await u.get(e);g(t,n)}return t.$$set=t=>{"columns"in t&&n(0,c=t.columns),"provider"in t&&n(1,u=t.provider),"actions"in t&&n(2,h=t.actions),"selectable"in t&&n(3,d=t.selectable),"singleSelection"in t&&n(4,p=t.singleSelection),"selection"in t&&n(15,f=t.selection)},t.$$.update=()=>{2&t.$$.dirty[0]&&(n(5,r=u.data),l(),l=hN(r,(t=>n(10,o=t)))),2&t.$$.dirty[0]&&(n(8,i=u.error),a(),a=hN(i,(t=>n(9,s=t)))),32800&t.$$.dirty[0]&&n(6,m=f.map((t=>dN(r).indexOf(t))))},[c,u,h,d,p,r,m,y,i,s,o,function({detail:t}){n(7,y=t),u.sort(t)},function(){m.length===dN(r).length?n(6,m=[]):n(6,m=dN(r).map(((t,e)=>e))),b()},v,x,f,(t,e)=>v(t,e),(t,{detail:e})=>{x([e,t])},function(t){m=t,n(6,m),n(15,f),n(5,r),n(1,u)},({detail:t})=>x(t)]}class _U extends HI{constructor(t){super(),WI(this,t,wU,xU,lN,{columns:0,provider:1,actions:2,selectable:3,singleSelection:4,selection:15},null,[-1,-1])}}function SU(t){let e,n;const r=t[1].default,i=fN(r,t,t[0],null);return{c(){e=IN("div"),i&&i.c(),FN(e,"class","flex border-solid border-0 border-b border-gray-200 mb-2")},m(t,r){CN(t,e,r),i&&i.m(e,null),n=!0},p(t,[e]){i&&i.p&&(!n||1&e)&&yN(i,r,t,t[0],n?gN(r,t[0],e,null):bN(t[0]),null)},i(t){n||(NI(i,t),n=!0)},o(t){II(i,t),n=!1},d(t){t&&AN(e),i&&i.d(t)}}}function kU(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=t=>{"$$scope"in t&&n(0,i=t.$$scope)},[i,r]}class TU extends HI{constructor(t){super(),WI(this,t,kU,SU,lN,{})}}const EU={itemsPerPage:10};class MU{options;data=H$([]);total=H$(0);error=H$(null);constructor(t=EU){this.options={...EU,...t}}paginate(t){this.options.itemsPerPage=t,this.update()}async get(t){const e=dN(this.data);return t>=0&&t<e.length?e[t]:null}}class CU extends MU{rawData;currentPage=1;constructor({data:t,...e}){super(e),this.rawData=t,this.total.set(t.length),this.data.set(this.rawData.slice(0,this.options.itemsPerPage))}async update(){this.page(this.currentPage)}async page(t){this.data.set(this.rawData.slice((t-1)*this.options.itemsPerPage,Math.min(t*this.options.itemsPerPage,this.rawData.length))),this.currentPage=t}async sort(t){this.rawData.sort(((e,n)=>e[t.col]>n[t.col]?t.ascending?1:-1:e[t.col]<n[t.col]?t.ascending?-1:1:0)),this.page(this.currentPage)}async delete(t){return this.rawData.splice(t,1),this.page(this.currentPage),null}}class AU extends MU{service;query;transform;constructor({service:t,columns:e,transform:n,...r}){super(r),this.service=t,this.transform=n||{},this.query={$sort:{updatedAt:-1},$limit:this.options.itemsPerPage},e&&(this.query.$select=e.map((t=>t.name)).concat(["id"])),this.update(),this.service.on("created",this.update.bind(this)),this.service.on("patched",this.update.bind(this)),this.service.on("updated",this.update.bind(this)),this.service.on("removed",this.update.bind(this))}paginate(t){super.paginate(t),this.query.$limit=this.options.itemsPerPage,this.update()}async update(){try{const t=await this.service.find({query:this.query}),e=t.data.map(((t,e)=>{const n=Object.entries(this.transform).map((([n,r])=>{try{return{[n]:r(t,e)}}catch(t){return{[n]:"transform error"}}})).reduce(((t,e)=>({...t,...e})),{});return{...t,...n}}));this.data.set(e),this.total.set(t.total),this.error.set(null)}catch(t){this.data.set([]),this.total.set(0),this.error.set(t)}}async page(t){this.query.$skip=(t-1)*this.query.$limit,this.update()}async sort(t){const{col:e,ascending:n}=t;e?this.query.$sort={[e]:n?1:-1}:delete this.query.$sort,this.update()}async delete(t){const e=dN(this.data)[t];return await this.service.remove(e.id),this.update(),e}}function NU(t){let e,n,r;return n=new $$({props:{progress:t[2],thin:!0}}),{c(){e=IN("div"),UI(n.$$.fragment),FN(e,"class","absolute top-0 left-0 right-0")},m(t,i){CN(t,e,i),VI(n,e,null),r=!0},p(t,e){const r={};4&e&&(r.progress=t[2]),n.$set(r)},i(t){r||(NI(n.$$.fragment,t),r=!0)},o(t){II(n.$$.fragment,t),r=!1},d(t){t&&AN(e),jI(n)}}}function IU(t){let e,n;return e=new B$({}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function $U(t){let e,n,r,i,s,o,a,l=!1!==t[2]&&NU(t),c=t[1]&&IU();const u=t[4].default,h=fN(u,t,t[3],null);return{c(){e=IN("div"),l&&l.c(),n=ON(),r=IN("span"),i=RN(t[0]),s=ON(),c&&c.c(),o=ON(),h&&h.c(),FN(r,"class","card-title"),FN(e,"class","card-container svelte-xnhseh")},m(t,u){CN(t,e,u),l&&l.m(e,null),TN(e,n),TN(e,r),TN(r,i),TN(e,s),c&&c.m(e,null),TN(e,o),h&&h.m(e,null),a=!0},p(t,[r]){!1!==t[2]?l?(l.p(t,r),4&r&&NI(l,1)):(l=NU(t),l.c(),NI(l,1),l.m(e,n)):l&&(CI(),II(l,1,1,(()=>{l=null})),AI()),(!a||1&r)&&BN(i,t[0]),t[1]?c?2&r&&NI(c,1):(c=IU(),c.c(),NI(c,1),c.m(e,o)):c&&(CI(),II(c,1,1,(()=>{c=null})),AI()),h&&h.p&&(!a||8&r)&&yN(h,u,t,t[3],a?gN(u,t[3],r,null):bN(t[3]),null)},i(t){a||(NI(l),NI(c),NI(h,t),a=!0)},o(t){II(l),II(c),II(h,t),a=!1},d(t){t&&AN(e),l&&l.d(),c&&c.d(),h&&h.d(t)}}}function RU(t,e,n){let{$$slots:r={},$$scope:i}=e,{title:s}=e,{loading:o=!1}=e,{progress:a=!1}=e;return t.$$set=t=>{"title"in t&&n(0,s=t.title),"loading"in t&&n(1,o=t.loading),"progress"in t&&n(2,a=t.progress),"$$scope"in t&&n(3,i=t.$$scope)},[s,o,a,i,r]}class OU extends HI{constructor(t){super(),WI(this,t,RU,$U,lN,{title:0,loading:1,progress:2})}}let PU,LU;function DU({title:t,message:e,duration:n=3e3,type:r="default"}){PU||(PU=document.createElement("div"),PU.id="notification-container",document.body.appendChild(PU),LU=new p$({target:PU})),null==LU||LU.add({title:t,message:e,duration:n,type:r})}
/** @license MIT License (c) copyright 2010-2016 original author or authors */function FU(t,e){for(var n=e.length,r=new Array(n+1),i=0;i<n;++i)r[i]=e[i];return r[n]=t,r}function zU(t,e,n){for(var r=e,i=0,s=n.length;i<s;++i)r=t(r,n[i],i);return r}function BU(t,e){if(t<0)throw new TypeError("i must be >= 0");var n=e.length;return 0===n||t>=n?e:1===n?[]:function(t,e,n){var r,i=new Array(n);for(r=0;r<t;++r)i[r]=e[r];for(r=t;r<n;++r)i[r]=e[r+1];return i}(t,e,n-1)}function UU(t,e){for(var n=0,r=e.length;n<r;++n)if(t===e[n])return n;return-1}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var VU=function(t){return t},jU=function(t,e){return t(e)};function WU(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return function(e){return t(n,e)};default:return t(n,r)}}}function HU(t){return function e(n,r,i){switch(arguments.length){case 0:return e;case 1:return WU((function(e,r){return t(n,e,r)}));case 2:return function(e){return t(n,r,e)};default:return t(n,r,i)}}}var GU=function(){function t(t,e,n,r,i){this.time=t,this.localOffset=e,this.period=n,this.task=r,this.scheduler=i,this.active=!0}return t.prototype.run=function(){return this.task.run(this.time-this.localOffset)},t.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},t.prototype.dispose=function(){return this.active=!1,this.scheduler.cancel(this),this.task.dispose()},t}(),qU=function(){function t(t,e){this.origin=t,this.scheduler=e}return t.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},t.prototype.scheduleTask=function(t,e,n,r){return this.scheduler.scheduleTask(t+this.origin,e,n,r)},t.prototype.relative=function(e){return new t(e+this.origin,this.scheduler)},t.prototype.cancel=function(t){return this.scheduler.cancel(t)},t.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)},t}();function XU(t){try{return t.run()}catch(e){return t.error(e)}}
/** @license MIT License (c) copyright 2010-2017 original author or authors */var YU=function(){function t(t,e){var n=this;this._runReadyTasksBound=function(){return n._runReadyTasks()},this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0}return t.prototype.currentTime=function(){return this.timer.now()},t.prototype.scheduleTask=function(t,e,n,r){var i=this.currentTime()+Math.max(0,e),s=new GU(i,t,n,r,this);return this.timeline.add(s),this._scheduleNextRun(),s},t.prototype.relative=function(t){return new qU(t,this)},t.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},t.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},t.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun()},t.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},t.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},t.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},t.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),XU),this._scheduleNextRun()},t}(),KU=function(){function t(){this.tasks=[]}return t.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},t.prototype.isEmpty=function(){return 0===this.tasks.length},t.prototype.add=function(t){JU(t,this.tasks)},t.prototype.remove=function(t){var e=eV(QU(t),this.tasks);if(e>=0&&e<this.tasks.length){var n=this.tasks[e].events,r=UU(t,n);if(r>=0)return n.splice(r,1),0===n.length&&this.tasks.splice(e,1),!0}return!1},t.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)tV(t,this.tasks[e])},t.prototype.runTasks=function(t,e){for(var n=this.tasks,r=n.length,i=0;i<r&&n[i].time<=t;)++i;this.tasks=n.slice(i);for(var s=0;s<i;++s)this.tasks=ZU(e,n[s].events,this.tasks)},t}();
/** @license MIT License (c) copyright 2010-2017 original author or authors */function ZU(t,e,n){for(var r=0;r<e.length;++r){var i=e[r];i.active&&(t(i),i.period>=0&&i.active&&(i.time=i.time+i.period,JU(i,n)))}return n}function JU(t,e){var n=e.length,r=QU(t);if(0!==n){var i=eV(r,e);i>=n?e.push(nV(r,[t])):function(t,e,n,r){var i=e[r];n===i.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var n=0;n<e.length;n++)if(t.time<e[n].time){e.splice(n,0,t);break}}(t,e)}(t,i.events):e.splice(r,0,nV(n,[t]))}(t,e,r,i)}else e.push(nV(r,[t]))}function QU(t){return Math.floor(t.time)}function tV(t,e){e.events=function(t,e){for(var n=e.length,r=new Array(n),i=0,s=void 0,o=0;o<n;++o)t(s=e[o])||(r[i]=s,++i);return r.length=i,r}(t,e.events)}function eV(t,e){for(var n,r,i=0,s=e.length;i<s;){if(t===(r=e[n=Math.floor((i+s)/2)]).time)return n;t<r.time?s=n:i=n+1}return s}var nV=function(t,e){return{time:t,events:e}},rV=function(){function t(t){this._clock=t}return t.prototype.now=function(){return this._clock.now()},t.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new iV(t);return function(t){Promise.resolve(t).then(XU)}(e),e}(t):setTimeout(t,e)},t.prototype.clearTimer=function(t){return t instanceof iV?t.cancel():clearTimeout(t)},t}(),iV=function(){function t(t){this.f=t,this.active=!0}return t.prototype.run=function(){if(this.active)return this.f()},t.prototype.error=function(t){throw t},t.prototype.cancel=function(){this.active=!1},t}();
/** @license MIT License (c) copyright 2010-2017 original author or authors */var sV=function(){function t(t,e){this.origin=e,this.clock=t}return t.prototype.now=function(){return this.clock.now()-this.origin},t}(),oV=function(){function t(t,e){this.origin=e,this.hrtime=t}return t.prototype.now=function(){var t=this.hrtime(this.origin);return(1e9*t[0]+t[1])/1e6},t}(),aV=function(t){return new sV(t,t.now())},lV=function(){return"undefined"!=typeof performance&&"function"==typeof performance.now?aV(performance):"undefined"!=typeof process&&"function"==typeof process.hrtime?new oV(process.hrtime,process.hrtime()):aV(Date)},cV=function(t){return t.currentTime()},uV=WU((function(t,e){return e.scheduleTask(0,0,-1,t)})),hV=HU((function(t,e,n){return n.scheduleTask(0,t,-1,e)})),dV=HU((function(t,e,n){return n.scheduleTask(0,0,t,e)})),pV=function(t){return t.dispose()},fV=WU((function(t,e){return new qU(t,e)})),mV=function(){return new rV(lV())},gV=function(){return yV},yV=new(function(){function t(){}return t.prototype.dispose=function(){},t}()),bV=function(t){return new vV(t)},vV=function(){function t(t){this.disposed=!1,this.disposable=t}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable&&(this.disposable.dispose(),this.disposable=void 0))},t}(),xV=function(t){var e=zU(_V,[],t);return 0===e.length?gV():new SV(e)},wV=WU((function(t,e){return xV([t,e])})),_V=function(t,e){return function(t){return t===yV}(e)?t:e instanceof SV?function(t,e){var n=t.length,r=e.length,i=new Array(n+r),s=0;for(s=0;s<n;s++)i[s]=t[s];for(var o=0;o<r;o++)i[s++]=e[o];return i}(t,e.disposables):FU(e,t)},SV=function(){function t(t){this.disposables=t}return t.prototype.dispose=function(){EV(kV(this.disposables))},t}(),kV=function(t){return zU(TV,[],t)},TV=function(t,e){try{e.dispose()}catch(e){t.push(e)}return t},EV=function(t){if(t.length>0)throw new MV(t.length+" errors",t)},MV=function t(e,n){this.name="DisposeAllError",this.message=e,this.errors=n,Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.stack=""+this.stack+CV(this.errors)};MV.prototype=Object.create(Error.prototype);var CV=function(t){return zU(AV,"",t)},AV=function(t,e,n){return t+"\n["+(n+1)+"] "+e.stack},NV=HU((function(t,e,n){try{e.dispose()}catch(e){n.error(t,e)}})),IV=function(t,e){return IV=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},IV(t,e)};function $V(t,e){function n(){this.constructor=t}IV(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}
/** @license MIT License (c) copyright 2010-2016 original author or authors */function RV(t){setTimeout(OV,0,t)}function OV(t){throw t}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var PV=function(t,e){return new zV(t,e)},LV=function(t){return new BV(t)},DV=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.dispose=function(){this.active=!1},t.prototype.run=function(t){this.active&&this.runIfActive(t)},t.prototype.error=function(t,e){if(!this.active)return RV(e);this.sink.error(t,e)},t}(),FV=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.runEvent=e,i.value=n,i}return $V(e,t),e.prototype.runIfActive=function(t){this.runEvent(t,this.value,this.sink)},e}(DV),zV=function(t){function e(e,n){var r=t.call(this,n)||this;return r.value=e,r}return $V(e,t),e.prototype.runIfActive=function(t){this.sink.event(t,this.value)},e}(DV),BV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $V(e,t),e.prototype.runIfActive=function(t){this.sink.end(t)},e}(DV),UV=function(t){function e(e,n){var r=t.call(this,n)||this;return r.value=e,r}return $V(e,t),e.prototype.runIfActive=function(t){this.sink.error(t,this.value)},e}(DV),VV=function(){return GV},jV=function(t){return t===GV},WV=function(t){return t.some(jV)},HV=function(){function t(){}return t.prototype.run=function(t,e){return uV(LV(t),e)},t}(),GV=new HV,qV=function(){return XV},XV=new(function(){function t(){}return t.prototype.run=function(){return gV()},t}()),YV=function(t,e){return new KV(t,e)},KV=function(){function t(t,e){this.time=t,this.value=e}return t.prototype.run=function(t,e){return hV(this.time,function(t,e,n){return new FV(t,e,n)}(ZV,this.value,t),e)},t}();function ZV(t,e,n){n.event(t,e),n.end(t)}
/** @license MIT License (c) copyright 2010-2017 original author or authors */var JV=function(t){return YV(0,t)},QV=function(){function t(t){this.period=t}return t.prototype.run=function(t,e){return dV(this.period,PV(void 0,t),e)},t}(),tj=function(){function t(){this.disposable=void 0,this.disposed=!1}return t.prototype.setDisposable=function(t){if(void 0!==this.disposable)throw new Error("setDisposable called more than once");this.disposable=t,this.disposed&&t.dispose()},t.prototype.dispose=function(){this.disposed||(this.disposed=!0,void 0!==this.disposable&&this.disposable.dispose())},t}(),ej=WU((function(t,e){return new Promise((function(n,r){return function(t,e,n,r){var i=new tj,s=new nj(n,r,i);i.setDisposable(t.run(s,e))}(t,e,n,r)}))}));
/** @license MIT License (c) copyright 2010-2016 original author or authors */var nj=function(){function t(t,e,n){this._end=t,this._error=e,this._disposable=n,this.active=!0}return t.prototype.event=function(){},t.prototype.end=function(){this.active&&this.dispose(this._error,this._end,void 0)},t.prototype.error=function(t,e){this.dispose(this._error,this._error,e)},t.prototype.dispose=function(t,e,n){this.active=!1,function(t,e,n,r){try{r.dispose()}catch(e){return void t(e)}e(n)}(t,e,n,this._disposable)},t}();var rj=function(t,e,n){return n.run(t,e)},ij=function(){function t(t,e){this.sink=e,this.offset=t}return t.prototype.event=function(t,e){this.sink.event(t+this.offset,e)},t.prototype.error=function(t,e){this.sink.error(t+this.offset,e)},t.prototype.end=function(t){this.sink.end(t+this.offset)},t}(),sj=function(t,e){return new oj(t,e)},oj=function(){function t(t,e){this.origin=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(aj(this.origin,t),fV(this.origin,e))},t}(),aj=function(t,e){return e instanceof ij?new ij(t+e.offset,e.sink):new ij(t,e)},lj=function(){function t(t){this.sink=t}return t.prototype.end=function(t){return this.sink.end(t)},t.prototype.error=function(t,e){return this.sink.error(t,e)},t}(),cj=function(){function t(t,e,n){this.step=t,this.seed=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new uj(this.step,this.seed,t),e)},t}(),uj=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.step=e,i.seed=n,i}return $V(e,t),e.prototype.event=function(t,e){var n=this.step(this.seed,e);this.seed=n.seed,this.sink.event(t,n.value)},e}(lj),hj=function(){function t(t,e,n){this.source=n,this.f=t,this.value=e}return t.prototype.run=function(t,e){var n=uV(PV(this.value,t),e),r=this.source.run(new dj(this.f,this.value,t),e);return wV(n,r)},t}(),dj=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.f=e,i.value=n,i}return $V(e,t),e.prototype.event=function(t,e){var n=this.f;this.value=n(this.value,e),this.sink.event(t,this.value)},e}(lj),pj=function(t,e){return new fj(t,e)},fj=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new mj(this.f,this.source,t,e)},t}(),mj=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.f=e,s.scheduler=i,s.active=!0,s.disposable=bV(n.run(s,i)),s}return $V(e,t),e.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},e.prototype.end=function(t){this.active&&(NV(t,this.disposable,this.sink),this.startNext(t,this.sink))},e.prototype.startNext=function(t,e){try{this.disposable=this.continue(this.f,t,e)}catch(n){e.error(t,n)}},e.prototype.continue=function(t,e,n){return rj(n,this.scheduler,sj(e,t()))},e.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()},e}(lj),gj=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new yj(this.p,t),e)},t.create=function(e,n){return jV(n)?n:n instanceof t?new t(bj(n.p,e),n.source):new t(e,n)},t}(),yj=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r}return $V(e,t),e.prototype.event=function(t,e){(0,this.p)(e)&&this.sink.event(t,e)},e}(lj),bj=function(t,e){return function(n){return t(n)&&e(n)}},vj=function(){function t(t,e,n){this.p=t,this.f=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new xj(this.p,this.f,t),e)},t}(),xj=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.p=e,i.f=n,i}return $V(e,t),e.prototype.event=function(t,e){var n=this.f;(0,this.p)(e)&&this.sink.event(t,n(e))},e}(lj),wj=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new _j(this.f,t),e)},t.create=function(e,n){return jV(n)?VV():n instanceof t?new t(function(t,e){return function(n){return t(e(n))}}(e,n.f),n.source):n instanceof gj?new vj(n.p,e,n.source):new t(e,n)},t}(),_j=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r}return $V(e,t),e.prototype.event=function(t,e){var n=this.f;this.sink.event(t,n(e))},e}(lj),Sj=function(t,e){return wj.create(t,e)},kj=function(){function t(t,e){this.source=e,this.f=t}return t.prototype.run=function(t,e){return this.source.run(new Tj(this.f,t),e)},t}(),Tj=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r}return $V(e,t),e.prototype.event=function(t,e){(0,this.f)(e),this.sink.event(t,e)},e}(lj),Ej=function(t){function e(e,n){var r=t.call(this,n)||this;return r.index=e,r.active=!0,r.value=void 0,r}return $V(e,t),e.prototype.event=function(t,e){this.active&&(this.value=e,this.sink.event(t,this))},e.prototype.end=function(t){this.active&&(this.active=!1,this.sink.event(t,this))},e}(lj);
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function Mj(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}
/** @license MIT License (c) copyright 2010 original author or authors */var Cj=function(t,e,n){return Aj(t,[e,n])},Aj=function(t,e){return 0===e.length||WV(e)?VV():1===e.length?Sj(t,e[0]):new Nj(t,e)},Nj=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new Ij(r,i.length,t,this.f),o=void 0,a=0;a<n;++a)o=i[a]=new Ej(a,s),r[a]=this.sources[a].run(o,e);return xV(r)},t}(),Ij=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.disposables=e,s.f=i,s.awaiting=n,s.values=new Array(n),s.hasValue=new Array(n).fill(!1),s.activeCount=n,s}return $V(e,t),e.prototype.event=function(t,e){if(e.active){var n=e.index,r=this.updateReady(n);this.values[n]=e.value,0===r&&this.sink.event(t,Mj(this.f,this.values))}else this.dispose(t,e.index)},e.prototype.updateReady=function(t){return this.awaiting>0&&(this.hasValue[t]||(this.hasValue[t]=!0,this.awaiting-=1)),this.awaiting},e.prototype.dispose=function(t,e){NV(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(lj);
/** @license MIT License (c) copyright 2010 original author or authors */
var $j=function(t,e){return Rj(VU,t,e)},Rj=function(t,e,n){return jV(n)?VV():new Oj(t,e,n)},Oj=function(){function t(t,e,n){this.f=t,this.concurrency=e,this.source=n}return t.prototype.run=function(t,e){return new Pj(this.f,this.concurrency,this.source,t,e)},t}(),Pj=function(){function t(t,e,n,r,i){this.f=t,this.concurrency=e,this.sink=r,this.scheduler=i,this.pending=[],this.current=[],this.disposable=bV(n.run(this,i)),this.active=!0}return t.prototype.event=function(t,e){this.addInner(t,e)},t.prototype.addInner=function(t,e){this.current.length<this.concurrency?this.startInner(t,e):this.pending.push(e)},t.prototype.startInner=function(t,e){try{this.initInner(t,e)}catch(e){this.error(t,e)}},t.prototype.initInner=function(t,e){var n=new Dj(t,this,this.sink);n.disposable=Lj(this.f,t,e,n,this.scheduler),this.current.push(n)},t.prototype.end=function(t){this.active=!1,NV(t,this.disposable,this.sink),this.checkEnd(t)},t.prototype.error=function(t,e){this.active=!1,this.sink.error(t,e)},t.prototype.dispose=function(){this.active=!1,this.pending.length=0,this.disposable.dispose(),xV(this.current).dispose()},t.prototype.endInner=function(t,e){var n=this.current.indexOf(e);n>=0&&this.current.splice(n,1),NV(t,e,this);var r=this.pending;r.length>0?this.startInner(t,r.shift()):this.checkEnd(t)},t.prototype.checkEnd=function(t){this.active||0!==this.current.length||this.sink.end(t)},t}(),Lj=function(t,e,n,r,i){return t(n).run(r,fV(e,i))},Dj=function(){function t(t,e,n){this.time=t,this.outer=e,this.sink=n,this.disposable=gV()}return t.prototype.event=function(t,e){this.sink.event(t+this.time,e)},t.prototype.end=function(t){this.outer.endInner(t+this.time,this)},t.prototype.error=function(t,e){this.outer.error(t+this.time,e)},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),Fj=function(t){return $j(1/0,t)};var zj=function(t){return Bj(Uj(t))},Bj=function(t){return 0===t.length?VV():1===t.length?t[0]:new Wj(zU(jj,[],t))},Uj=function(t){return t.filter(Vj)},Vj=function(t){return!jV(t)},jj=function(t,e){return t.concat(e instanceof Wj?e.sources:e)},Wj=function(){function t(t){this.sources=t}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new Hj(r,i,t),o=void 0,a=0;a<n;++a)o=i[a]=new Ej(a,s),r[a]=this.sources[a].run(o,e);return xV(r)},t}(),Hj=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.disposables=e,i.activeCount=n.length,i}return $V(e,t),e.prototype.event=function(t,e){e.active?this.sink.event(t,e.value):this.dispose(t,e.index)},e.prototype.dispose=function(t,e){NV(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(lj),Gj=function(t,e,n){return jV(n)||jV(e)?VV():new qj(t,e,n)},qj=function(){function t(t,e,n){this.f=t,this.values=e,this.sampler=n}return t.prototype.run=function(t,e){var n=new Xj(this.f,t),r=this.values.run(n.latest,e),i=this.sampler.run(n,e);return wV(i,r)},t}(),Xj=function(t){function e(e,n){var r=t.call(this,n)||this;return r.f=e,r.latest=new Yj(r),r}return $V(e,t),e.prototype.event=function(t,e){if(this.latest.hasValue){var n=this.f;this.sink.event(t,n(this.latest.value,e))}},e}(lj),Yj=function(t){function e(e){var n=t.call(this,e)||this;return n.hasValue=!1,n}return $V(e,t),e.prototype.event=function(t,e){this.value=e,this.hasValue=!0},e.prototype.end=function(){},e}(lj),Kj=function(t,e){var n=Math.max(0,t);return{min:n,max:Math.max(n,e)}},Zj=function(t,e){return Jj(0,t,e)},Jj=function(t,e,n){return Qj(Kj(t,e),n)},Qj=function(t,e){return tW(t,e)?VV():e instanceof wj?nW(t,e):e instanceof iW?rW(t,e):eW(t,e)},tW=function(t,e){return jV(e)||(n=t).min>=n.max;var n},eW=function(t,e){return(n=t).min<=0&&n.max===1/0?e:new iW(t,e);var n},nW=function(t,e){return wj.create(e.f,Qj(t,e.source))},rW=function(t,e){return Qj((n=e.bounds,r=t,Kj(n.min+r.min,Math.min(n.max,n.min+r.max))),e.source);var n,r},iW=function(){function t(t,e){this.source=e,this.bounds=t}return t.prototype.run=function(t,e){var n=new tj,r=new sW(this.bounds.min,this.bounds.max-this.bounds.min,t,n);return n.setDisposable(this.source.run(r,e)),n},t}(),sW=function(t){function e(e,n,r,i){var s=t.call(this,r)||this;return s.skip=e,s.take=n,s.disposable=i,s}return $V(e,t),e.prototype.event=function(t,e){this.skip>0?this.skip-=1:0!==this.take&&(this.take-=1,this.sink.event(t,e),0===this.take&&(this.disposable.dispose(),this.sink.end(t)))},e}(lj),oW=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){var n=new tj,r=new aW(this.p,t,n);return n.setDisposable(this.source.run(r,e)),n},t}(),aW=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.p=e,i.active=!0,i.disposable=r,i}return $V(e,t),e.prototype.event=function(t,e){if(this.active){var n=this.p;this.active=n(e),this.active?this.sink.event(t,e):(this.disposable.dispose(),this.sink.end(t))}},e}(lj),lW=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new cW(this.p,t),e)},t}(),cW=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r.skipping=!0,r}return $V(e,t),e.prototype.event=function(t,e){if(this.skipping){var n=this.p;if(this.skipping=n(e),this.skipping)return}this.sink.event(t,e)},e}(lj),uW=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new hW(this.p,t),e)},t}(),hW=function(t){function e(e,n){var r=t.call(this,n)||this;return r.p=e,r.skipping=!1,r}return $V(e,t),e.prototype.event=function(t,e){if(!this.skipping){var n=this.p;this.skipping=n(e),this.sink.event(t,e),this.skipping&&this.sink.end(t)}},e}(lj),dW=function(t,e,n){return jV(n)||0===e.length?VV():new fW(t,e,Zj(e.length,n))},pW=function(t){return t},fW=function(){function t(t,e,n){this.f=t,this.items=e,this.source=n}return t.prototype.run=function(t,e){return this.source.run(new mW(this.f,this.items,t),e)},t}(),mW=function(t){function e(e,n,r){var i=t.call(this,r)||this;return i.f=e,i.items=n,i.index=0,i}return $V(e,t),e.prototype.event=function(t,e){var n=this.f;this.sink.event(t,n(this.items[this.index],e)),this.index+=1},e}(lj),gW=function(){function t(){this.head=0,this.tail=0,this.capacityMask=3,this.list=new Array(4)}return t.prototype.push=function(t){var e=this.tail;return this.list[e]=t,this.tail=e+1&this.capacityMask,this.tail===this.head&&this.growArray(),this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.shift=function(){var t=this.head;if(t!==this.tail){var e=this.list[t];return this.list[t]=void 0,this.head=t+1&this.capacityMask,t<2&&this.tail>1e4&&this.tail<=this.list.length>>>2&&this.shrinkArray(),e}},t.prototype.isEmpty=function(){return this.head===this.tail},t.prototype.length=function(){return this.head===this.tail?0:this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.growArray=function(){this.head&&(this.list=this.copyArray(),this.head=0),this.tail=this.list.length,this.list.length*=2,this.capacityMask=this.capacityMask<<1|1},t.prototype.shrinkArray=function(){this.list.length>>>=1,this.capacityMask>>>=1},t.prototype.copyArray=function(){var t,e=[],n=this.list,r=n.length;for(t=this.head;t<r;t++)e.push(n[t]);for(t=0;t<this.tail;t++)e.push(n[t]);return e},t}();var yW=function(t,e){return 0===e.length||WV(e)?VV():1===e.length?Sj(t,e[0]):new bW(t,e)},bW=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var n=this.sources.length,r=new Array(n),i=new Array(n),s=new Array(n),o=new vW(this.f,s,i,t),a=void 0,l=0;l<n;++l)s[l]=new gW,a=i[l]=new Ej(l,o),r[l]=this.sources[l].run(a,e);return xV(r)},t}(),vW=function(t){function e(e,n,r,i){var s=t.call(this,i)||this;return s.f=e,s.sinks=r,s.buffers=n,s}return $V(e,t),e.prototype.event=function(t,e){if(e.active){var n=this.buffers,r=n[e.index];if(r.push(e.value),1===r.length()){if(!function(t){for(var e=0,n=t.length;e<n;++e)if(t[e].isEmpty())return!1;return!0}
/** @license MIT License (c) copyright 2010-2016 original author or authors */(n))return;xW(this.f,t,n,this.sink),function(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n].isEmpty()&&!e[n].active)return!0;return!1}(this.buffers,this.sinks)&&this.sink.end(t)}}else this.dispose(t,e.index)},e.prototype.dispose=function(t,e){this.buffers[e].isEmpty()&&this.sink.end(t)},e}(lj),xW=function(t,e,n,r){return r.event(e,Mj(t,function(t,e){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=t(e[i]);return r}(wW,n)))},wW=function(t){return t.shift()};var _W=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){var n=new SW(t,e);return wV(n,this.source.run(n,e))},t}(),SW=function(){function t(t,e){this.sink=t,this.scheduler=e,this.current=null,this.ended=!1}return t.prototype.event=function(t,e){this.disposeCurrent(t),this.current=new kW(e,t,1/0,this,this.sink,this.scheduler)},t.prototype.end=function(t){this.ended=!0,this.checkEnd(t)},t.prototype.error=function(t,e){this.ended=!0,this.sink.error(t,e)},t.prototype.dispose=function(){return this.disposeCurrent(cV(this.scheduler))},t.prototype.disposeCurrent=function(t){if(null!==this.current)return this.current.dispose(t)},t.prototype.disposeInner=function(t,e){e.dispose(t),e===this.current&&(this.current=null)},t.prototype.checkEnd=function(t){this.ended&&null===this.current&&this.sink.end(t)},t.prototype.endInner=function(t,e){this.disposeInner(t,e),this.checkEnd(t)},t.prototype.errorInner=function(t,e,n){this.disposeInner(t,n),this.sink.error(t,e)},t}(),kW=function(){function t(t,e,n,r,i,s){this.min=e,this.max=n,this.outer=r,this.sink=i,this.disposable=t.run(this,fV(e,s))}return t.prototype.event=function(t,e){var n=Math.max(0,t+this.min);n<this.max&&this.sink.event(n,e)},t.prototype.end=function(t){this.outer.endInner(t+this.min,this)},t.prototype.error=function(t,e){this.outer.errorInner(t+this.min,e,this)},t.prototype.dispose=function(t){NV(t,this.disposable,this.sink)},t}();var TW=function(t,e){return jV(e)?VV():new EW(t,e)},EW=function(){function t(t,e){this.equals=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new MW(this.equals,t),e)},t}(),MW=function(t){function e(e,n){var r=t.call(this,n)||this;return r.equals=e,r.value=void 0,r.init=!0,r}return $V(e,t),e.prototype.event=function(t,e){this.init?(this.init=!1,this.value=e,this.sink.event(t,e)):this.equals(this.value,e)||(this.value=e,this.sink.event(t,e))},e}(lj);function CW(t,e){return t===e}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var AW=function(t,e){return new IW(t,e)},NW=function(t,e){return new $W(t,e)},IW=function(){function t(t,e){this.maxSignal=t,this.source=e}return t.prototype.run=function(t,e){var n=new tj,r=this.source.run(t,e),i=this.maxSignal.run(new PW(t,n),e);return n.setDisposable(wV(r,i)),n},t}(),$W=function(){function t(t,e){this.minSignal=t,this.source=e}return t.prototype.run=function(t,e){var n=new OW(this.minSignal,t,e),r=this.source.run(new RW(n,t),e);return wV(n,r)},t}(),RW=function(t){function e(e,n){var r=t.call(this,n)||this;return r.min=e,r}return $V(e,t),e.prototype.event=function(t,e){this.min.allow&&this.sink.event(t,e)},e}(lj),OW=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.allow=!1,i.disposable=e.run(i,r),i}return $V(e,t),e.prototype.event=function(){this.allow=!0,this.dispose()},e.prototype.end=function(){},e.prototype.dispose=function(){this.disposable.dispose()},e}(lj),PW=function(t){function e(e,n){var r=t.call(this,e)||this;return r.disposable=n,r}return $V(e,t),e.prototype.event=function(t){this.disposable.dispose(),this.sink.end(t)},e.prototype.end=function(){},e}(lj),LW=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){var n=new DW(this.dt,t,e);return wV(n,this.source.run(n,e))},t}(),DW=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.dt=e,i.scheduler=r,i.tasks=[],i}return $V(e,t),e.prototype.dispose=function(){this.tasks.forEach(pV)},e.prototype.event=function(t,e){this.tasks.push(hV(this.dt,PV(e,this.sink),this.scheduler))},e.prototype.end=function(){this.tasks.push(hV(this.dt,LV(this.sink),this.scheduler))},e}(lj),FW=function(t,e){return jV(e)?VV():e instanceof wj?zW(t,e):e instanceof UW?BW(t,e):new UW(t,e)},zW=function(t,e){return wj.create(e.f,FW(t,e.source))},BW=function(t,e){return new UW(Math.max(t,e.period),e.source)},UW=function(){function t(t,e){this.period=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new VW(this.period,t),e)},t}(),VW=function(t){function e(e,n){var r=t.call(this,n)||this;return r.time=0,r.period=e,r}return $V(e,t),e.prototype.event=function(t,e){t>=this.time&&(this.time=t+this.period,this.sink.event(t,e))},e}(lj),jW=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){return new WW(this.dt,this.source,t,e)},t}(),WW=function(){function t(t,e,n,r){this.dt=t,this.sink=n,this.scheduler=r,this.timer=null,this.disposable=e.run(this,r)}return t.prototype.event=function(t,e){this.clearTimer(),this.value=e,this.timer=hV(this.dt,new HW(this,e),this.scheduler)},t.prototype.handleEventFromTask=function(t,e){this.clearTimer(),this.sink.event(t,e)},t.prototype.end=function(t){this.clearTimer()&&(this.sink.event(t,this.value),this.value=void 0),this.sink.end(t)},t.prototype.error=function(t,e){this.clearTimer(),this.sink.error(t,e)},t.prototype.dispose=function(){this.clearTimer(),this.disposable.dispose()},t.prototype.clearTimer=function(){return null!==this.timer&&(this.timer.dispose(),this.timer=null,!0)},t}(),HW=function(){function t(t,e){this.sink=t,this.value=e}return t.prototype.run=function(t){this.sink.handleEventFromTask(t,this.value)},t.prototype.error=function(t,e){this.sink.error(t,e)},t.prototype.dispose=function(){},t}(),GW=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){return this.source.run(new qW(t,e),e)},t}(),qW=function(){function t(t,e){var n=this;this.eventBound=function(t){return n.sink.event(cV(n.scheduler),t)},this.endBound=function(){return n.sink.end(cV(n.scheduler))},this.errorBound=function(t){return n.sink.error(cV(n.scheduler),t)},this.sink=t,this.scheduler=e,this.queue=Promise.resolve()}return t.prototype.event=function(t,e){var n=this;this.queue=this.queue.then((function(){return n.handlePromise(e)})).catch(this.errorBound)},t.prototype.end=function(){this.queue=this.queue.then(this.endBound).catch(this.errorBound)},t.prototype.error=function(t,e){var n=this;this.queue=this.queue.then((function(){return n.errorBound(e)})).catch(RV)},t.prototype.handlePromise=function(t){return t.then(this.eventBound)},t}(),XW=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},t.prototype.end=function(t){this.active&&(this.disable(),this.sink.end(t))},t.prototype.error=function(t,e){this.disable(),this.sink.error(t,e)},t.prototype.disable=function(){return this.active=!1,this.sink},t}();
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function YW(t,e,n){try{n.event(t,e)}catch(e){n.error(t,e)}}function KW(t,e){try{e.end(t)}catch(n){e.error(t,n)}}
/** @license MIT License (c) copyright 2010-2016 original author or authors */var ZW=function(){function t(t){this.value=t}return t.prototype.run=function(t,e){return uV(function(t,e){return new UV(t,e)}(this.value,t),e)},t}(),JW=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new QW(this.f,this.source,t,e)},t}(),QW=function(){function t(t,e,n,r){this.f=t,this.sink=new XW(n),this.scheduler=r,this.disposable=e.run(this,r)}return t.prototype.event=function(t,e){YW(t,e,this.sink)},t.prototype.end=function(t){KW(t,this.sink)},t.prototype.error=function(t,e){var n=this.sink.disable();NV(t,this.disposable,this.sink),this._startNext(t,e,n)},t.prototype._startNext=function(t,e,n){try{this.disposable=this._continue(this.f,t,e,n)}catch(e){n.error(t,e)}},t.prototype._continue=function(t,e,n,r){return rj(r,this.scheduler,sj(e,t(n)))},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),tH=function(){function t(t){this.source=new eH(t)}return t.prototype.run=function(t,e){return this.source.run(t,e)},t}(),eH=function(){function t(t){this.source=t,this.sinks=[],this.disposable=gV()}return t.prototype.run=function(t,e){return 1===this.add(t)&&(this.disposable=this.source.run(this,e)),bV(new nH(this,t))},t.prototype.dispose=function(){var t=this.disposable;return this.disposable=gV(),t.dispose()},t.prototype.add=function(t){return this.sinks=FU(t,this.sinks),this.sinks.length},t.prototype.remove=function(t){var e=UU(t,this.sinks);return e>=0&&(this.sinks=BU(e,this.sinks)),this.sinks.length},t.prototype.event=function(t,e){var n=this.sinks;if(1===n.length)return n[0].event(t,e);for(var r=0;r<n.length;++r)YW(t,e,n[r])},t.prototype.end=function(t){for(var e=this.sinks,n=0;n<e.length;++n)KW(t,e[n])},t.prototype.error=function(t,e){for(var n=this.sinks,r=0;r<n.length;++r)n[r].error(t,e)},t}(),nH=function(){function t(t,e){this.source=t,this.sink=e}return t.prototype.dispose=function(){0===this.source.remove(this.sink)&&this.source.dispose()},t}(),rH=WU(sj),iH=HU((function(t,e,n){return jV(n)?VV():new cj(t,e,n)})),sH=HU((function(t,e,n){return new hj(t,e,n)})),oH=WU((function(t,e){return pj((function(){return e}),JV(t))})),aH=WU(Sj),lH=WU((function(t,e){return Sj((function(){return t}),e)})),cH=WU((function(t,e){return new kj(t,e)})),uH=WU((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return Cj(jU,t,e)})),hH=WU((function(t,e){return Rj(t,1/0,e)})),dH=WU(pj),pH=WU((function(t,e){return Rj(t,1,e)})),fH=WU($j),mH=HU(Rj),gH=WU((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return zj([t,e])})),yH=HU(Cj),bH=WU((function(t,e){return Gj((function(t){return t}),t,e)})),vH=HU(Gj),xH=HU(dW),wH=WU((function(t,e){return dW(pW,t,e)})),_H=HU((
/** @license MIT License (c) copyright 2010 original author or authors */
function(t,e,n){return yW(t,[e,n])})),SH=WU((
/** @license MIT License (c) copyright 2010-2016 original author or authors */
function(t,e){return gj.create(t,e)})),kH=WU(TW),TH=WU(Zj),EH=WU((function(t,e){return Jj(t,1/0,e)})),MH=HU(Jj),CH=WU((function(t,e){return jV(e)?VV():new oW(t,e)})),AH=WU((function(t,e){return jV(e)?VV():new lW(t,e)})),NH=WU((function(t,e){return jV(e)?VV():new uW(t,e)})),IH=WU(AW),$H=WU(NW),RH=WU((function(t,e){return AW(Fj(t),NW(t,e))})),OH=WU((function(t,e){return t<=0?e:new LW(t,e)})),PH=WU(FW),LH=WU((function(t,e){return jV(e)?VV():new jW(t,e)})),DH=WU((function(t,e){return jV(e)?VV():new JW(t,e)}));function FH(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function zH(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function BH(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n}var UH,VH,jH,WH=function(){var t=[];return[function(e){return HH(t,e)},new GH(t)]},HH=function(t,e){return t.forEach((function(t){var n=t.sink;return function(t,e,n){try{n.event(t,e)}catch(e){n.error(t,e)}}(t.scheduler.currentTime(),e,n)}))},GH=function(){function t(t){this.sinks=t}return t.prototype.run=function(t,e){var n={sink:t,scheduler:e};return this.sinks.push(n),new qH(n,this.sinks)},t}(),qH=function(){function t(t,e){this.sink=t,this.sinks=e}return t.prototype.dispose=function(){var t=this.sinks.indexOf(this.sink);t>=0&&this.sinks.splice(t,1)},t}();function XH(){}function YH(t){}const KH=new YU(mV(),new KU);function ZH(t){return t&&"object"==typeof t&&void 0!==t.run&&void 0!==t.id}class JH{constructor(t,e){this.id=JH.nextId++,this.subscribers=[],this.value=void 0,this.ready=!1,UH.set(this,void 0),VH.set(this,!1),jH.set(this,void 0),BH(this,UH,!!e,"f");const[n,r]=WH(),[i,s]=WH();let o;this.stopStream=n,this.set=t=>{this.value=t,i(t)},ZH(t)?(o=t,void 0===e&&BH(this,UH,t.holding,"f"),t.holding&&(this.value=t.value)):!function(t){return t&&"object"==typeof t&&void 0!==t.run}(t)?(o=aH((()=>this.value),JV(t)),this.value=t):o=t,this.stream=function(t){return t instanceof tH||jV(t)?t:new tH(t)}(cH(this.runListeners.bind(this),IH(r,gH(o,s))))}get(){return this.value}get holding(){return zH(this,UH,"f")}run(t,e){return this.stream.run(t,e)}runListeners(t){this.value=t;for(const e of this.subscribers)e(t)}subscribe(t=YH,e=XH){zH(this,UH,"f")&&zH(this,VH,"f")&&t(this.value);const n=n=>{e(),t(n)};return this.subscribers.push(n),zH(this,VH,"f")||this.start(),()=>{const t=this.subscribers.indexOf(n);-1!==t&&this.subscribers.splice(t,1)}}async start(){return zH(this,VH,"f")||(JH.numActive++,ej(this.stream,KH).then((()=>{JH.numActive--})),BH(this,VH,!0,"f"),BH(this,jH,new Promise(((t,e)=>{uV({run:()=>{this.ready=!0,t()},error(t){e(t)},dispose(){}},KH)})),"f")),zH(this,jH,"f")}stop(){this.stopStream(void 0),BH(this,VH,!1,"f")}hold(t=!0){return BH(this,UH,t,"f"),this}thru(t){return new JH(t(this))}startWith(t){const e=new JH(oH(t,this));return this.holding&&(e.value=t),e}continueWith(t){const e=new JH(dH(t,this));return this.holding&&(e.value=this.value),e}map(t){const e=new JH(aH(t,this));return this.holding&&(e.value=t(this.value)),e}constant(t){const e=new JH(lH(t,this));return this.holding&&(e.value=t),e}tap(t){const e=new JH(cH(t,this));return this.holding&&(e.value=this.value),e}ap(t){const e=new JH(uH(t,this));return this.holding&&t.holding&&(e.value=t.get()(this.value)),e}scan(t,e){const n=new JH(sH(t,e,this));return this.holding&&(n.value=e),n}loop(t,e){return new JH(iH(t,e,this))}withItems(t){return new JH(wH(t,this))}zipItems(t,e){return new JH(xH(t,e,this))}switchLatest(){return new JH(jV(t=this)?VV():new _W(t));var t}join(){return new JH(Fj(this))}chain(t){return new JH(hH(t,this))}concatMap(t){return new JH(pH(t,this))}mergeConcurrently(t){return new JH(fH(t,this))}mergeMapConcurrently(t,e){return new JH(mH(t,e,this))}merge(t){const e=new JH(gH(t,this));return this.holding&&(e.value=this.value),e}combine(t,e){const n=new JH(yH(t,e,this));return this.holding&&(n.value=t(e.value,this.value)),n}zip(t,e){const n=new JH(_H(t,e,this));return this.holding&&(n.value=t(e.value,this.value)),n}resample(t){return new JH(bH(this,t))}sample(t){return new JH(bH(t,this))}snapshot(t,e){return new JH(vH(t,e,this))}filter(t){const e=new JH(SH(t,this));return this.holding&&t(this.value)&&(e.value=this.value),e}skipRepeats(){const t=new JH(TW(CW,this));return this.holding&&(t.value=this.value),t}skipRepeatsWith(t){return new JH(kH(t,this))}slice(t,e){return new JH(MH(t,e,this))}take(t){return new JH(TH(t,this))}skip(t){return new JH(EH(t,this))}takeWhile(t){return new JH(CH(t,this))}skipWhile(t){return new JH(AH(t,this))}skipAfter(t){return new JH(NH(t,this))}until(t){return new JH(IH(t,this))}since(t){return new JH($H(t,this))}during(t){return new JH(RH(t,this))}delay(t){return new JH(OH(t,this))}withLocalTime(t){return new JH(rH(t,this))}throttle(t){return new JH(PH(t,this))}debounce(t){return new JH(LH(t,this))}awaitPromises(){return new JH(jV(t=this)?VV():new GW(t));var t}recoverWith(t){return new JH(DH(t,this))}static empty(){return new JH(VV())}static never(){return new JH(qV())}static now(t){return new JH(JV(t))}static at(t,e){return new JH(YV(t,e))}static periodic(t){return new JH(function(t){return new QV(t)}(t))}static throwError(t){return new JH(function(t){return new ZW(t)}(t))}}var QH;UH=new WeakMap,VH=new WeakMap,jH=new WeakMap,JH.nextId=0,JH.numActive=0,t.LogLevel=void 0,(QH=t.LogLevel||(t.LogLevel={}))[QH.Debug=0]="Debug",QH[QH.Info=1]="Info",QH[QH.Warning=2]="Warning",QH[QH.Error=3]="Error";const tG=new JH(qV()),eG={log(...e){console.log(...e),tG.set([t.LogLevel.Info,e.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},debug(...e){tG.set([t.LogLevel.Debug,e.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},info(...t){this.log(...t)},warning(...e){tG.set([t.LogLevel.Warning,e.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])},error(...e){console.error(...e),tG.set([t.LogLevel.Error,e.filter((t=>void 0!==t)).map((t=>t.toString())).join(" ")])}};function nG(){return tG}function rG(t,e,n){const r=n.value;return n.value=function(...t){try{return r.apply(this,t)}catch(t){return eG.error(t),DU({title:t.name,message:t.message,type:"danger"}),t}},n}class iG extends Error{constructor(t){super(t),this.name="Training Error"}}function sG(t,{duration:e=3e3}={}){eG.error(`${t.name}: ${t.message}`,t),DU({title:t.name,message:t.message,type:"danger",duration:e})}function oG(t,e){return async function*(){let n=0;for await(const r of t())e(r,n++)&&(yield await r)}}function aG(t,e){return async function*(){let n=0;for await(const r of t())yield await e(r,n++)}}function lG(t,e){return async function*(){yield*await t(),yield*await e}}class cG{constructor(t){this.source=t}[Symbol.asyncIterator](){return this.source()[Symbol.asyncIterator]()}entries(){return new cG(aG(this.source,((t,e)=>[e,t])))}keys(){return new cG(aG(this.source,((t,e)=>e)))}values(){return new cG(this.source)}forEach(t){return async function(t,e){let n=0;for await(const r of t())e(r,n++)}(this.source,t)}concat(t){return"function"==typeof t[Symbol.iterator]?new cG(lG(this.source,async function*(t){yield*t}(t))):function(t){return"function"==typeof t[Symbol.asyncIterator]}(t)?new cG(lG(this.source,t)):new cG(lG(this.source,async function*(t){yield t}(t)))}reduce(t,e){return async function(t,e,n){let[r,i]=[-1,n];for await(const s of t())i=0==++r&&void 0===n?s:e(i,s,r);if(void 0===n&&-1===r)throw new Error("Sequence contains no elements.");return i}(this.source,t,e)}filter(t){return new cG(oG(this.source,t))}take(t){return new cG(function(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){let n=e;for await(const e of t()){if(0==n--)return;yield await e}}}(this.source,t))}skip(t){return new cG(function(t,e){if(e<0)throw Error("Negative count is not supported, use await and sync iterator instead.");return async function*(){yield*oG(t,((t,n)=>n>=e))()}}(this.source,t))}map(t){return new cG(aG(this.source,t))}zip(t){return new cG((e=this.source,n=t,async function*(){const t=n()[Symbol.asyncIterator]();for await(const n of e()){const e=await t.next();if(e.done)return;yield[n,e.value]}}));var e,n}toArray(){return async function(t){const e=[];for await(const n of t())e.push(n);return e}(this.source)}}class uG extends cG{constructor(t){super((async function*(){for(const e of t)yield e}))}}function hG(t){return t&&"object"==typeof t&&!Array.isArray(t)}function dG(t,...e){if(!e.length)return t;const n=e.shift(),r={...t};if(hG(t)&&hG(n))for(const t in n)hG(n[t])?(r[t]||Object.assign(r,{[t]:{}}),r[t]=dG(r[t],n[t])):Object.assign(r,{[t]:n[t]});return dG(r,...e)}window&&(window.onerror=t=>{"string"==typeof t&&DU({title:"An error occurred",message:t,type:"danger"})},window.addEventListener("unhandledrejection",(t=>{DU({title:"An error occurred",message:t.reason,type:"danger"})})));function pG(t,{include:e,exclude:n}={}){const r=t=>{const r=e=>"string"==typeof e?t===e:e.test(t);return e?e.some(r):!n||!n.some(r)};for(const[e,n]of(t=>{const e=new Set;do{for(const n of Reflect.ownKeys(t))e.add([t,n])}while((t=Reflect.getPrototypeOf(t))&&t!==Object.prototype);return e})(t.constructor.prototype)){if("constructor"===n||!r(n))continue;const i=Reflect.getOwnPropertyDescriptor(e,n);i&&"function"==typeof i.value&&(t[n]=t[n].bind(t))}return t}let fG=0;class mG{constructor(){this.id=`component-${String(fG++).padStart(3,"0")}`,this.$$={streams:[],app:void 0},pG(this)}destroy(){var t;null===(t=this.$$.app)||void 0===t||t.$destroy(),this.$$.app=void 0}start(){this.$$.streams=Object.entries(this).filter((([t,e])=>"$"===t[0]&&ZH(e))).map((([,t])=>(t.start(),t)))}stop(){for(const t of this.$$.streams)t.stop()}dispose(){this.destroy(),this.stop()}}var gG={exports:{}},yG=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bG=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],vG=function(t){var e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var i=yG.exec(t||""),s={},o=14;o--;)s[bG[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(t,e){var n=/\/{2,9}/g,r=e.replace(n,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||r.splice(0,1);"/"==e.substr(e.length-1,1)&&r.splice(r.length-1,1);return r}(0,s.path),s.queryKey=function(t,e){var n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}(0,s.query),s};var xG={exports:{}},wG={exports:{}},_G=1e3,SG=6e4,kG=60*SG,TG=24*kG,EG=365.25*TG,MG=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*EG;case"days":case"day":case"d":return n*TG;case"hours":case"hour":case"hrs":case"hr":case"h":return n*kG;case"minutes":case"minute":case"mins":case"min":case"m":return n*SG;case"seconds":case"second":case"secs":case"sec":case"s":return n*_G;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===n&&!1===isNaN(t))return e.long?function(t){return CG(t,TG,"day")||CG(t,kG,"hour")||CG(t,SG,"minute")||CG(t,_G,"second")||t+" ms"}(t):function(t){if(t>=TG)return Math.round(t/TG)+"d";if(t>=kG)return Math.round(t/kG)+"h";if(t>=SG)return Math.round(t/SG)+"m";if(t>=_G)return Math.round(t/_G)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function CG(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}!function(t,e){function n(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,s=r-(n||r);t.diff=s,t.prev=n,t.curr=r,n=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var l=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;l++;var i=e.formatters[r];if("function"==typeof i){var s=o[l];n=i.call(t,s),o.splice(l,1),l--}return n})),e.formatArgs.call(t,o);var c=i.log||e.log||console.log.bind(console);c.apply(t,o)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),i.destroy=r,"function"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var s=e.instances[n];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=MG,e.instances=[],e.names=[],e.skips=[],e.formatters={}}(wG,wG.exports),function(t,e){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=wG.exports).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(s=i))})),t.splice(s,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())}(xG,xG.exports);var AG=vG,NG=xG.exports("socket.io-client:url"),IG=function(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(NG("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),NG("parse %s",t),n=AG(t));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(e&&e.port===n.port?"":":"+n.port),n};var $G={},RG={exports:{}};!function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}(RG);var OG={},PG={}.toString,LG=Array.isArray||function(t){return"[object Array]"==PG.call(t)},DG=function(t){return FG&&Buffer.isBuffer(t)||zG&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))},FG="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,zG="function"==typeof ArrayBuffer;var BG=LG,UG=DG,VG=Object.prototype.toString,jG="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===VG.call(Blob),WG="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===VG.call(File);function HG(t,e){if(!t)return t;if(UG(t)){var n={_placeholder:!0,num:e.length};return e.push(t),n}if(BG(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=HG(t[i],e);return r}if("object"==typeof t&&!(t instanceof Date)){r={};for(var s in t)r[s]=HG(t[s],e);return r}return t}function GG(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(BG(t))for(var n=0;n<t.length;n++)t[n]=GG(t[n],e);else if("object"==typeof t)for(var r in t)t[r]=GG(t[r],e);return t}OG.deconstructPacket=function(t){var e=[],n=t.data,r=t;return r.data=HG(n,e),r.attachments=e.length,{packet:r,buffers:e}},OG.reconstructPacket=function(t,e){return t.data=GG(t.data,e),t.attachments=void 0,t},OG.removeBlobs=function(t,e){var n=0,r=t;!function t(i,s,o){if(!i)return i;if(jG&&i instanceof Blob||WG&&i instanceof File){n++;var a=new FileReader;a.onload=function(){o?o[s]=this.result:r=this.result,--n||e(r)},a.readAsArrayBuffer(i)}else if(BG(i))for(var l=0;l<i.length;l++)t(i[l],l,i);else if("object"==typeof i&&!UG(i))for(var c in i)t(i[c],c,i)}(r),n||e(r)},function(t){var e=xG.exports("socket.io-parser"),n=RG.exports,r=OG,i=LG,s=DG;function o(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=o,t.Decoder=c;var a=t.ERROR+'"encode error"';function l(n){var r=""+n.type;if(t.BINARY_EVENT!==n.type&&t.BINARY_ACK!==n.type||(r+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(r+=n.nsp+","),null!=n.id&&(r+=n.id),null!=n.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(n.data);if(!1===i)return a;r+=i}return e("encoded %j as %s",n,r),r}function c(){this.reconstructor=null}function u(t){this.reconPack=t,this.buffers=[]}function h(e){return{type:t.ERROR,data:"parser error: "+e}}o.prototype.encode=function(n,i){(e("encoding packet %j",n),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type)?function(t,e){function n(t){var n=r.deconstructPacket(t),i=l(n.packet),s=n.buffers;s.unshift(i),e(s)}r.removeBlobs(t,n)}(n,i):i([l(n)])},n(c.prototype),c.prototype.add=function(n){var r;if("string"==typeof n)r=function(n){var r=0,s={type:Number(n.charAt(0))};if(null==t.types[s.type])return h("unknown packet type "+s.type);if(t.BINARY_EVENT===s.type||t.BINARY_ACK===s.type){for(var o=r+1;"-"!==n.charAt(++r)&&r!=n.length;);var a=n.substring(o,r);if(a!=Number(a)||"-"!==n.charAt(r))throw new Error("Illegal attachments");s.attachments=Number(a)}if("/"===n.charAt(r+1)){for(o=r+1;++r;){if(","===(c=n.charAt(r)))break;if(r===n.length)break}s.nsp=n.substring(o,r)}else s.nsp="/";var l=n.charAt(r+1);if(""!==l&&Number(l)==l){for(o=r+1;++r;){var c;if(null==(c=n.charAt(r))||Number(c)!=c){--r;break}if(r===n.length)break}s.id=Number(n.substring(o,r+1))}if(n.charAt(++r)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(n.substr(r));if(!(!1!==u&&(s.type===t.ERROR||i(u))))return h("invalid payload");s.data=u}return e("decoded %s as %j",n,s),s}(n),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new u(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!s(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(n))&&(this.reconstructor=null,this.emit("decoded",r))}},c.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=r.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}($G);var qG={exports:{}},XG={},YG={exports:{}};try{YG.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){YG.exports=!1}var KG,ZG,JG="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),QG=YG.exports,tq=JG,eq=function(t){var e=t.xdomain,n=t.xscheme,r=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||QG))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(t){}if(!e)try{return new(tq[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}},nq={exports:{}},rq={},iq=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e};function sq(){if(ZG)return KG;ZG=1;var t=LG,e=Object.prototype.toString,n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===e.call(Blob),r="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===e.call(File);return KG=function e(i){if(!i||"object"!=typeof i)return!1;if(t(i)){for(var s=0,o=i.length;s<o;s++)if(e(i[s]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(i)||"function"==typeof ArrayBuffer&&i instanceof ArrayBuffer||n&&i instanceof Blob||r&&i instanceof File)return!0;if(i.toJSON&&"function"==typeof i.toJSON&&1===arguments.length)return e(i.toJSON(),!0);for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&e(i[a]))return!0;return!1},KG}var oq=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(n-e),o=e,a=0;o<n;o++,a++)s[a]=i[o];return s.buffer},aq=function(t,e,n){var r=!1;return n=n||lq,i.count=t,0===t?e():i;function i(t,s){if(i.count<=0)throw new Error("after called too many times");--i.count,t?(r=!0,e(t),e=n):0!==i.count||r||e(null,s)}};function lq(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var cq,uq,hq,dq=String.fromCharCode;function pq(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function fq(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function mq(t,e){return dq(t>>e&63|128)}function gq(t,e){if(0==(4294967168&t))return dq(t);var n="";return 0==(4294965248&t)?n=dq(t>>6&31|192):0==(4294901760&t)?(fq(t,e)||(t=65533),n=dq(t>>12&15|224),n+=mq(t,6)):0==(4292870144&t)&&(n=dq(t>>18&7|240),n+=mq(t,12),n+=mq(t,6)),n+=dq(63&t|128)}function yq(){if(hq>=uq)throw Error("Invalid byte index");var t=255&cq[hq];if(hq++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function bq(t){var e,n;if(hq>uq)throw Error("Invalid byte index");if(hq==uq)return!1;if(e=255&cq[hq],hq++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|yq())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|yq()<<6|yq())>=2048)return fq(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|yq()<<12|yq()<<6|yq())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var vq,xq,wq,_q,Sq,kq={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=pq(t),i=r.length,s=-1,o="";++s<i;)o+=gq(r[s],n);return o},decode:function(t,e){var n=!1!==(e=e||{}).strict;cq=pq(t),uq=cq.length,hq=0;for(var r,i=[];!1!==(r=bq(n));)i.push(r);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=dq((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=dq(e);return i}(i)}},Tq={};function Eq(){if(wq)return xq;wq=1;var t=void 0!==t?t:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,e=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),n=e&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),r=t&&t.prototype.append&&t.prototype.getBlob;function i(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t}))}function s(e,n){n=n||{};var r=new t;return i(e).forEach((function(t){r.append(t)})),n.type?r.getBlob(n.type):r.getBlob()}function o(t,e){return new Blob(i(t),e||{})}return"undefined"!=typeof Blob&&(s.prototype=Blob.prototype,o.prototype=Blob.prototype),xq=e?n?Blob:o:r?s:void 0}function Mq(){if(Sq)return _q;Sq=1;var t=rq;function e(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}return _q=e,(0,RG.exports)(e.prototype),e.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},e.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},e.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},e.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},e.prototype.onData=function(e){var n=t.decodePacket(e,this.socket.binaryType);this.onPacket(n)},e.prototype.onPacket=function(t){this.emit("packet",t)},e.prototype.onClose=function(){this.readyState="closed",this.emit("close")},_q}!function(t){var e,n,r=iq,i=sq(),s=oq,o=aq,a=kq;"undefined"!=typeof ArrayBuffer&&(vq||(vq=1,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tq.encode=function(t){var e,r=new Uint8Array(t),i=r.length,s="";for(e=0;e<i;e+=3)s+=n[r[e]>>2],s+=n[(3&r[e])<<4|r[e+1]>>4],s+=n[(15&r[e+1])<<2|r[e+2]>>6],s+=n[63&r[e+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},Tq.decode=function(t){var e,r,i,s,o,a=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(e=0;e<l;e+=4)r=n.indexOf(t[e]),i=n.indexOf(t[e+1]),s=n.indexOf(t[e+2]),o=n.indexOf(t[e+3]),h[c++]=r<<2|i>>4,h[c++]=(15&i)<<4|s>>2,h[c++]=(3&s)<<6|63&o;return u}),e=Tq);var l="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),c="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=l||c;t.protocol=3;var h=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=r(h),p={type:"error",data:"parser error"},f=Eq();function m(t,e,n){for(var r=new Array(t.length),i=o(t.length,n),s=function(t,n,i){e(n,(function(e,n){r[t]=n,i(e,r)}))},a=0;a<t.length;a++)s(a,t[a],i)}t.encodePacket=function(e,n,r,i){"function"==typeof n&&(i=n,n=!1),"function"==typeof r&&(i=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=h[e.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return r(o.buffer)}(e,n,i);if(void 0!==f&&s instanceof f)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(u)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);i[0]=h[e.type];var s=new f([i.buffer,e.data]);return r(s)}(e,n,i);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,i);var o=h[e.type];return void 0!==e.data&&(o+=r?a.encode(String(e.data),{strict:!1}):String(e.data)),i(""+o)},t.encodeBase64Packet=function(e,n){var r,i="b"+t.packets[e.type];if(void 0!==f&&e.data instanceof f){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];n(i+t)},s.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var o=new Uint8Array(e.data),a=new Array(o.length),l=0;l<o.length;l++)a[l]=o[l];r=String.fromCharCode.apply(null,a)}return i+=btoa(r),n(i)},t.decodePacket=function(e,n,r){if(void 0===e)return p;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(t){try{t=a.decode(t,{strict:!1})}catch(t){return!1}return t}(e)))return p;var i=e.charAt(0);return Number(i)==i&&d[i]?e.length>1?{type:d[i],data:e.substring(1)}:{type:d[i]}:p}i=new Uint8Array(e)[0];var o=s(e,1);return f&&"blob"===n&&(o=new f([o])),{type:d[i],data:o}},t.decodeBase64Packet=function(t,n){var r=d[t.charAt(0)];if(!e)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=e.decode(t.substr(1));return"blob"===n&&f&&(i=new f([i])),{type:r,data:i}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var s=i(e);if(n&&s)return f&&!u?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");m(e,(function(e,r){t.encodePacket(e,!!s&&n,!1,(function(t){r(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return r(e.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===e)return r(p,0,1);for(var s,o,a="",l=0,c=e.length;l<c;l++){var u=e.charAt(l);if(":"===u){if(""===a||a!=(s=Number(a)))return r(p,0,1);if(a!=(o=e.substr(l+1,s)).length)return r(p,0,1);if(o.length){if(i=t.decodePacket(o,n,!1),p.type===i.type&&p.data===i.data)return r(p,0,1);if(!1===r(i,l+s,c))return}l+=s,a=""}else a+=u}return""!==a?r(p,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(t){return n(null,t)}))}),(function(t,e){var r=e.reduce((function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2}),0),i=new Uint8Array(r),s=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);n=r.buffer}i[s++]=e?0:1;var a=n.byteLength.toString();for(o=0;o<a.length;o++)i[s++]=parseInt(a[o]);i[s++]=255;for(r=new Uint8Array(n),o=0;o<r.length;o++)i[s++]=r[o]})),n(i.buffer)}))},t.encodePayloadAsBlob=function(e,n){m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)o[i]=parseInt(s[i]);if(o[s.length]=255,f){var a=new f([e.buffer,o.buffer,t]);n(null,a)}}))}),(function(t,e){return n(new f(e))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),l=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return r(p,0,1);c+=a[u]}i=s(i,2+c.length),c=parseInt(c);var h=s(i,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var d=new Uint8Array(h);h="";for(u=0;u<d.length;u++)h+=String.fromCharCode(d[u])}o.push(h),i=s(i,c)}var f=o.length;o.forEach((function(e,i){r(t.decodePacket(e,n,!0),i,f)}))}}(rq);var Cq,Aq={};function Nq(){return Cq||(Cq=1,Aq.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},Aq.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}),Aq}var Iq,$q=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},Rq="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Oq={},Pq=0,Lq=0;function Dq(t){var e="";do{e=Rq[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function Fq(){var t=Dq(+new Date);return t!==Iq?(Pq=0,Iq=t):t+"."+Dq(Pq++)}for(;Lq<64;Lq++)Oq[Rq[Lq]]=Lq;Fq.encode=Dq,Fq.decode=function(t){var e=0;for(Lq=0;Lq<t.length;Lq++)e=64*e+Oq[t.charAt(Lq)];return e};var zq=Fq,Bq=Mq(),Uq=Nq(),Vq=rq,jq=$q,Wq=zq,Hq=xG.exports("engine.io-client:polling"),Gq=Xq,qq=null!=new eq({xdomain:!1}).responseType;function Xq(t){var e=t&&t.forceBase64;qq&&!e||(this.supportsBinary=!1),Bq.call(this,t)}jq(Xq,Bq),Xq.prototype.name="polling",Xq.prototype.doOpen=function(){this.poll()},Xq.prototype.pause=function(t){var e=this;function n(){Hq("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(Hq("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){Hq("pre-pause polling complete"),--r||n()}))),this.writable||(Hq("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){Hq("pre-pause writing complete"),--r||n()})))}else n()},Xq.prototype.poll=function(){Hq("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Xq.prototype.onData=function(t){var e=this;Hq("polling got data %s",t);Vq.decodePayload(t,this.socket.binaryType,(function(t,n,r){if("opening"===e.readyState&&"open"===t.type&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():Hq('ignoring poll - transport state "%s"',this.readyState))},Xq.prototype.doClose=function(){var t=this;function e(){Hq("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(Hq("transport open - closing"),e()):(Hq("transport not open - deferring close"),this.once("open",e))},Xq.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};Vq.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},Xq.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=Wq()),this.supportsBinary||t.sid||(t.b64=1),t=Uq.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t};var Yq=eq,Kq=Gq,Zq=RG.exports,Jq=$q,Qq=xG.exports("engine.io-client:polling-xhr"),tX=JG;function eX(){}function nX(t){if(Kq.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function rX(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(nq.exports=nX,nq.exports.Request=rX,Jq(nX,Kq),nX.prototype.supportsBinary=!0,nX.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new rX(t)},nX.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=r},nX.prototype.doPoll=function(){Qq("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},Zq(rX.prototype),rX.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new Yq(t),n=this;try{Qq("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof e.status?e.status:0)}),0))},Qq("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){n.onError(t)}),0)}"undefined"!=typeof document&&(this.index=rX.requestsCount++,rX.requests[this.index]=this)},rX.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},rX.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},rX.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},rX.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=eX:this.xhr.onreadystatechange=eX,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete rX.requests[this.index],this.xhr=null}},rX.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},rX.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},rX.prototype.abort=function(){this.cleanup()},rX.requestsCount=0,rX.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",iX);else if("function"==typeof addEventListener){addEventListener("onpagehide"in tX?"pagehide":"unload",iX,!1)}function iX(){for(var t in rX.requests)rX.requests.hasOwnProperty(t)&&rX.requests[t].abort()}var sX,oX=Gq,aX=JG,lX=dX,cX=/\n/g,uX=/\\n/g;function hX(){}function dX(t){oX.call(this,t),this.query=this.query||{},sX||(sX=aX.___eio=aX.___eio||[]),this.index=sX.length;var e=this;sX.push((function(t){e.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){e.script&&(e.script.onerror=hX)}),!1)}$q(dX,oX),dX.prototype.supportsBinary=!1,dX.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),oX.prototype.doClose.call(this)},dX.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},dX.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function a(){l(),e()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(t)}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),t=t.replace(uX,"\\\n"),this.area.value=t.replace(cX,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var pX,fX,mX=Mq(),gX=rq,yX=Nq(),bX=$q,vX=zq,xX=xG.exports("engine.io-client:websocket");if("undefined"!=typeof WebSocket?pX=WebSocket:"undefined"!=typeof self&&(pX=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{fX=Iu}catch(t){}var wX=pX||fX,_X=SX;function SX(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=pX&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(wX=fX),mX.call(this,t)}bX(SX,mX),SX.prototype.name="websocket",SX.prototype.supportsBinary=!0,SX.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new wX(t,e):new wX(t):new wX(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},SX.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},SX.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,i=n;r<i;r++)!function(t){gX.encodePacket(t,e.supportsBinary,(function(r){if(!e.usingBrowserWebSocket){var i={};if(t.options&&(i.compress=t.options.compress),e.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<e.perMessageDeflate.threshold&&(i.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(r):e.ws.send(r,i)}catch(t){xX("websocket closed before onclose event")}--n||s()}))}(t[r]);function s(){e.emit("flush"),setTimeout((function(){e.writable=!0,e.emit("drain")}),0)}},SX.prototype.onClose=function(){mX.prototype.onClose.call(this)},SX.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},SX.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=vX()),this.supportsBinary||(t.b64=1),(t=yX.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},SX.prototype.check=function(){return!(!wX||"__initialize"in wX&&this.name===SX.prototype.name)};var kX=eq,TX=nq.exports,EX=lX,MX=_X;XG.polling=function(t){var e=!1,n=!1,r=!1!==t.jsonp;if("undefined"!=typeof location){var i="https:"===location.protocol,s=location.port;s||(s=i?443:80),e=t.hostname!==location.hostname||s!==t.port,n=t.secure!==i}if(t.xdomain=e,t.xscheme=n,"open"in new kX(t)&&!t.forceJSONP)return new TX(t);if(!r)throw new Error("JSONP disabled");return new EX(t)},XG.websocket=MX;var CX=[].indexOf,AX=function(t,e){if(CX)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},NX=XG,IX=RG.exports,$X=xG.exports("engine.io-client:socket"),RX=AX,OX=rq,PX=vG,LX=Nq(),DX=FX;function FX(t,e){if(!(this instanceof FX))return new FX(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=PX(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=PX(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=LX.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||void 0,this.key=e.key||void 0,this.passphrase=e.passphrase||void 0,this.cert=e.cert||void 0,this.ca=e.ca||void 0,this.ciphers=e.ciphers||void 0,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}FX.priorWebsocketSuccess=!1,IX(FX.prototype),FX.protocol=OX.protocol,FX.Socket=FX,FX.Transport=Mq(),FX.transports=XG,FX.parser=rq,FX.prototype.createTransport=function(t){$X('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=OX.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new NX[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},FX.prototype.open=function(){var t;if(this.rememberUpgrade&&FX.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},FX.prototype.setTransport=function(t){$X("setting transport %s",t.name);var e=this;this.transport&&($X("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},FX.prototype.probe=function(t){$X('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||($X('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if($X('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;FX.priorWebsocketSuccess="websocket"===e.name,$X('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&($X("changing transport and sending upgrade packet"),u(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())}))}else{$X('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=e.name,r.emit("upgradeError",s)}})))}function s(){n||(n=!0,u(),e.close(),e=null)}function o(n){var i=new Error("probe error: "+n);i.transport=e.name,s(),$X('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",i)}function a(){o("transport closed")}function l(){o("socket closed")}function c(t){e&&t.name!==e.name&&($X('"%s" works - aborting "%s"',t.name,e.name),s())}function u(){e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",a),r.removeListener("close",l),r.removeListener("upgrading",c)}FX.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",o),e.once("close",a),this.once("close",l),this.once("upgrading",c),e.open()},FX.prototype.onOpen=function(){if($X("socket open"),this.readyState="open",FX.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){$X("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},FX.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch($X('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else $X('packet received with socket readyState "%s"',this.readyState)},FX.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},FX.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},FX.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){$X("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},FX.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},FX.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},FX.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&($X("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},FX.prototype.write=FX.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},FX.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},FX.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():e()})):this.upgrading?r():e()}function e(){t.onClose("forced close"),$X("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},FX.prototype.onError=function(t){$X("socket error %j",t),FX.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},FX.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){$X('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},FX.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~RX(this.transports,t[n])&&e.push(t[n]);return e},function(t){t.exports=DX,t.exports.parser=rq}(qG);var zX,BX,UX={exports:{}};var VX=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}};var jX,WX=[].slice,HX=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=WX.call(arguments,2);return function(){return e.apply(t,n.concat(WX.call(arguments)))}};function GX(){return jX||(jX=1,function(t,e){var n=$G,r=RG.exports,i=(BX||(BX=1,zX=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}),zX),s=VX,o=HX,a=xG.exports("socket.io-client:socket"),l=Nq(),c=sq();t.exports=d;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=r.prototype.emit;function d(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[s(t,"open",o(this,"onopen")),s(t,"packet",o(this,"onpacket")),s(t,"close",o(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.reconnecting||this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var t=i(arguments);return t.unshift("message"),this.emit.apply(this,t),this},d.prototype.emit=function(t){if(u.hasOwnProperty(t))return h.apply(this,arguments),this;var e=i(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:c(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},d.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},d.prototype.onopen=function(){if(a("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?l.encode(this.query):this.query;a("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},d.prototype.onclose=function(t){a("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},d.prototype.onpacket=function(t){var e=t.nsp===this.nsp,r=t.type===n.ERROR&&"/"===t.nsp;if(e||r)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},d.prototype.onevent=function(t){var e=t.data||[];a("emitting event %j",e),null!=t.id&&(a("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?h.apply(this,e):this.receiveBuffer.push(e)},d.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var s=i(arguments);a("sending ack %j",s),e.packet({type:c(s)?n.BINARY_ACK:n.ACK,id:t,data:s})}}},d.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(a("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):a("bad ack %s",t.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emit("connect")},d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)h.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(t){return this.flags.compress=t,this},d.prototype.binary=function(t){return this.flags.binary=t,this}}(UX)),UX.exports}var qX=XX;function XX(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}XX.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},XX.prototype.reset=function(){this.attempts=0},XX.prototype.setMin=function(t){this.ms=t},XX.prototype.setMax=function(t){this.max=t},XX.prototype.setJitter=function(t){this.jitter=t};var YX=qG.exports,KX=GX(),ZX=RG.exports,JX=$G,QX=VX,tY=HX,eY=xG.exports("socket.io-client:manager"),nY=AX,rY=qX,iY=Object.prototype.hasOwnProperty,sY=oY;function oY(t,e){if(!(this instanceof oY))return new oY(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new rY({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||JX;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}oY.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)iY.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},oY.prototype.updateSocketIds=function(){for(var t in this.nsps)iY.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},oY.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},ZX(oY.prototype),oY.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},oY.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},oY.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},oY.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},oY.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},oY.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},oY.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},oY.prototype.open=oY.prototype.connect=function(t,e){if(eY("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;eY("opening %s",this.uri),this.engine=YX(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=QX(n,"open",(function(){r.onopen(),t&&t()})),s=QX(n,"error",(function(e){if(eY("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var o=this._timeout;eY("connect attempt will timeout after %d",o),0===o&&i.destroy();var a=setTimeout((function(){eY("connect attempt timed out after %d",o),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",o)}),o);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(i),this.subs.push(s),this},oY.prototype.onopen=function(){eY("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(QX(t,"data",tY(this,"ondata"))),this.subs.push(QX(t,"ping",tY(this,"onping"))),this.subs.push(QX(t,"pong",tY(this,"onpong"))),this.subs.push(QX(t,"error",tY(this,"onerror"))),this.subs.push(QX(t,"close",tY(this,"onclose"))),this.subs.push(QX(this.decoder,"decoded",tY(this,"ondecoded")))},oY.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},oY.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},oY.prototype.ondata=function(t){this.decoder.add(t)},oY.prototype.ondecoded=function(t){this.emit("packet",t)},oY.prototype.onerror=function(t){eY("error",t),this.emitAll("error",t)},oY.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new KX(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",i),n.on("connect",(function(){n.id=r.generateId(t)})),this.autoConnect&&i()}function i(){~nY(r.connecting,n)||r.connecting.push(n)}return n},oY.prototype.destroy=function(t){var e=nY(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},oY.prototype.packet=function(t){eY("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()})))},oY.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},oY.prototype.cleanup=function(){eY("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},oY.prototype.close=oY.prototype.disconnect=function(){eY("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},oY.prototype.onclose=function(t){eY("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},oY.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)eY("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();eY("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(eY("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(eY("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(eY("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},oY.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)},function(t,e){var n=IG,r=$G,i=sY,s=xG.exports("socket.io-client");t.exports=e=a;var o=e.managers={};function a(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,a=n(t),l=a.source,c=a.id,u=a.path,h=o[c]&&u in o[c].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||h?(s("ignoring socket cache for %s",l),r=i(l,e)):(o[c]||(s("new io instance for %s",l),o[c]=i(l,e)),r=o[c]),a.query&&!e.query&&(e.query=a.query),r.socket(a.path,e)}e.protocol=r.protocol,e.connect=a,e.Manager=sY,e.Socket=GX()}(gG,gG.exports);var aY,lY,cY=gG.exports,uY={exports:{}},hY={},dY={exports:{}};function pY(){if(lY)return aY;lY=1;var t=1e3,e=60*t,n=60*e,r=24*n,i=7*r,s=365.25*r;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}return aY=function(a,l){l=l||{};var c=typeof a;if("string"===c&&a.length>0)return function(o){if((o=String(o)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!a)return;var l=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*r;case"hours":case"hour":case"hrs":case"hr":case"h":return l*n;case"minutes":case"minute":case"mins":case"min":case"m":return l*e;case"seconds":case"second":case"secs":case"sec":case"s":return l*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(a);if("number"===c&&isFinite(a))return l.long?function(i){var s=Math.abs(i);if(s>=r)return o(i,s,r,"day");if(s>=n)return o(i,s,n,"hour");if(s>=e)return o(i,s,e,"minute");if(s>=t)return o(i,s,t,"second");return i+" ms"}(a):function(i){var s=Math.abs(i);if(s>=r)return Math.round(i/r)+"d";if(s>=n)return Math.round(i/n)+"h";if(s>=e)return Math.round(i/e)+"m";if(s>=t)return Math.round(i/t)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},aY}var fY=function(t){function e(t){let r,i,s,o=null;function a(...t){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=e.formatters[i];if("function"==typeof s){const e=t[o];r=s.call(n,e),t.splice(o,1),o--}return r})),e.formatArgs.call(n,t);(n.log||e.log).apply(n,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){const r=e(this.namespace+(void 0===n?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=pY(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e};!function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=fY(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(dY,dY.exports);const mY=dY.exports("@feathersjs/errors");function gY(t,e,n,r,i){let s,o,a;(t=t||"Error")instanceof Error?(o=t.message||"Error",t.errors&&(s=t.errors)):"object"==typeof t?(o=t.message||"Error",i=t):o=t,i&&(a=JSON.parse(JSON.stringify(i)),a.errors?(s=a.errors,delete a.errors):i.errors&&(s=JSON.parse(JSON.stringify(i.errors)))),this.type="FeathersError",this.name=e,this.message=o,this.code=n,this.className=r,this.data=a,this.errors=s||{},mY(`${this.name}(${this.code}): ${this.message}`),mY(this.errors),Error.captureStackTrace?Error.captureStackTrace(this,gY):this.stack=(new Error).stack}function yY(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function bY(t,e){gY.call(this,t,"BadRequest",400,"bad-request",e)}function vY(t,e){gY.call(this,t,"NotAuthenticated",401,"not-authenticated",e)}function xY(t,e){gY.call(this,t,"PaymentError",402,"payment-error",e)}function wY(t,e){gY.call(this,t,"Forbidden",403,"forbidden",e)}function _Y(t,e){gY.call(this,t,"NotFound",404,"not-found",e)}function SY(t,e){gY.call(this,t,"MethodNotAllowed",405,"method-not-allowed",e)}function kY(t,e){gY.call(this,t,"NotAcceptable",406,"not-acceptable",e)}function TY(t,e){gY.call(this,t,"Timeout",408,"timeout",e)}function EY(t,e){gY.call(this,t,"Conflict",409,"conflict",e)}function MY(t,e){gY(this,t,"Gone",410,"gone")}function CY(t,e){gY.call(this,t,"LengthRequired",411,"length-required",e)}function AY(t,e){gY.call(this,t,"Unprocessable",422,"unprocessable",e)}function NY(t,e){gY.call(this,t,"TooManyRequests",429,"too-many-requests",e)}function IY(t,e){gY.call(this,t,"GeneralError",500,"general-error",e)}function $Y(t,e){gY.call(this,t,"NotImplemented",501,"not-implemented",e)}function RY(t,e){gY.call(this,t,"BadGateway",502,"bad-gateway",e)}function OY(t,e){gY.call(this,t,"Unavailable",503,"unavailable",e)}yY(gY,Error),Object.defineProperty(gY.prototype,"toJSON",{value:function(){return{name:this.name,message:this.message,code:this.code,className:this.className,data:this.data,errors:this.errors}}}),yY(bY,gY),yY(vY,gY),yY(xY,gY),yY(wY,gY),yY(_Y,gY),yY(SY,gY),yY(kY,gY),yY(TY,gY),yY(EY,gY),yY(MY,gY),yY(CY,gY),yY(AY,gY),yY(NY,gY),yY(IY,gY),yY($Y,gY),yY(RY,gY),yY(OY,gY);const PY={FeathersError:gY,BadRequest:bY,NotAuthenticated:vY,PaymentError:xY,Forbidden:wY,NotFound:_Y,MethodNotAllowed:SY,NotAcceptable:kY,Timeout:TY,Conflict:EY,Gone:MY,LengthRequired:CY,Unprocessable:AY,TooManyRequests:NY,GeneralError:IY,NotImplemented:$Y,BadGateway:RY,Unavailable:OY,400:bY,401:vY,402:xY,403:wY,404:_Y,405:SY,406:kY,408:TY,409:EY,410:MY,411:CY,422:AY,429:NY,500:IY,501:$Y,502:RY,503:OY};var LY=Object.assign({convert:function(t){if(!t)return t;const e=PY[t.name],n=e?new e(t.message,t.data):new Error(t.message||t);return"object"==typeof t&&Object.assign(n,t),n}},PY),DY={};Object.defineProperty(DY,"__esModule",{value:!0}),DY.StorageWrapper=DY.MemoryStorage=void 0;DY.MemoryStorage=class{constructor(){this.store={}}getItem(t){return Promise.resolve(this.store[t])}setItem(t,e){return Promise.resolve(this.store[t]=e)}removeItem(t){const e=this.store[t];return delete this.store[t],Promise.resolve(e)}};DY.StorageWrapper=class{constructor(t){this.storage=t}getItem(t){return Promise.resolve(this.storage.getItem(t))}setItem(t,e){return Promise.resolve(this.storage.setItem(t,e))}removeItem(t){return Promise.resolve(this.storage.removeItem(t))}},Object.defineProperty(hY,"__esModule",{value:!0}),hY.AuthenticationClient=void 0;const FY=LY,zY=DY,BY=(t,e)=>{const n=new RegExp(`(?:&?)${e}=([^&]*)`),r=t.hash?t.hash.match(n):null;if(null!==r){const[,t]=r;return[t,n]}return[null,n]};hY.AuthenticationClient=class{constructor(t,e){const n=t.io||t.primus,r=new zY.StorageWrapper(t.get("storage")||e.storage);this.app=t,this.options=e,this.authenticated=!1,this.app.set("storage",r),n&&this.handleSocket(n)}get service(){return this.app.service(this.options.path)}get storage(){return this.app.get("storage")}handleSocket(t){const e=this.app.io?"connect":"open",n=this.app.io?"disconnect":"disconnection";t.on(n,(()=>{const n=new Promise((n=>t.once(e,(t=>n(t))))).then((()=>this.authenticated?this.reAuthenticate(!0):null));this.app.set("authentication",n)}))}getFromLocation(t){const[e,n]=BY(t,this.options.locationKey);if(null!==e)return t.hash=t.hash.replace(n,""),Promise.resolve(e);const[r,i]=BY(t,this.options.locationErrorKey);return null!==r?(t.hash=t.hash.replace(i,""),Promise.reject(new FY.NotAuthenticated(decodeURIComponent(r)))):Promise.resolve(null)}setAccessToken(t){return this.storage.setItem(this.options.storageKey,t)}getAccessToken(){return this.storage.getItem(this.options.storageKey).then((t=>!t&&"undefined"!=typeof window&&window.location?this.getFromLocation(window.location):t||null))}removeAccessToken(){return this.storage.removeItem(this.options.storageKey)}reset(){return this.app.set("authentication",null),this.authenticated=!1,Promise.resolve(null)}handleError(t,e){if(401===t.code||403===t.code){const n=this.removeAccessToken().then((()=>this.reset()));return"logout"===e?n:n.then((()=>Promise.reject(t)))}return Promise.reject(t)}reAuthenticate(t=!1,e){const n=this.app.get("authentication");return n&&!0!==t?n:this.getAccessToken().then((t=>{if(!t)throw new FY.NotAuthenticated("No accessToken found in storage");return this.authenticate({strategy:e||this.options.jwtStrategy,accessToken:t})}))}authenticate(t,e){if(!t)return this.reAuthenticate();const n=this.service.create(t,e).then((t=>{const{accessToken:e}=t;return this.authenticated=!0,this.app.emit("login",t),this.app.emit("authenticated",t),this.setAccessToken(e).then((()=>t))})).catch((t=>this.handleError(t,"authenticate")));return this.app.set("authentication",n),n}logout(){return Promise.resolve(this.app.get("authentication")).then((()=>this.service.remove(null).then((t=>this.removeAccessToken().then((()=>this.reset())).then((()=>(this.app.emit("logout",t),t))))))).catch((t=>this.handleError(t,"logout")))}};var UY={},VY={},jY={},WY={},HY={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createSymbol=t.makeUrl=t.isPromise=t._=t.stripSlashes=void 0,t.stripSlashes=function(t){return t.replace(/^(\/+)|(\/+)$/g,"")},t._={each(e,n){e&&"function"==typeof e.forEach?e.forEach(n):t._.isObject(e)&&Object.keys(e).forEach((t=>n(e[t],t)))},some:(t,e)=>Object.keys(t).map((e=>[t[e],e])).some((([t,n])=>e(t,n))),every:(t,e)=>Object.keys(t).map((e=>[t[e],e])).every((([t,n])=>e(t,n))),keys:t=>Object.keys(t),values:e=>t._.keys(e).map((t=>e[t])),isMatch:(e,n)=>t._.keys(n).every((t=>e[t]===n[t])),isEmpty:e=>0===t._.keys(e).length,isObject:t=>"object"==typeof t&&!Array.isArray(t)&&null!==t,isObjectOrArray:t=>"object"==typeof t&&null!==t,extend:(t,...e)=>Object.assign(t,...e),omit(e,...n){const r=t._.extend({},e);return n.forEach((t=>delete r[t])),r},pick:(t,...e)=>e.reduce(((e,n)=>(void 0!==t[n]&&(e[n]=t[n]),e)),{}),merge:(e,n)=>(t._.isObject(e)&&t._.isObject(n)&&Object.keys(n).forEach((r=>{t._.isObject(n[r])?(e[r]||Object.assign(e,{[r]:{}}),t._.merge(e[r],n[r])):Object.assign(e,{[r]:n[r]})})),e)},t.isPromise=function(e){return t._.isObject(e)&&"function"==typeof e.then},t.makeUrl=function(e,n={}){const r="function"==typeof n.get?n.get.bind(n):()=>{},i=r("env")||"production",s=r("host")||process.env.HOST_NAME||"localhost",o="development"===i||"test"===i||void 0===i?"http":"https",a=r("port")||process.env.PORT||3030;return e=e||"",`${o}://${s}${"development"===i||"test"===i||void 0===i?`:${a}`:""}/${t.stripSlashes(e)}`},t.createSymbol=function(t){return"undefined"!=typeof Symbol?Symbol(t):t}}(HY),Object.defineProperty(WY,"__esModule",{value:!0}),WY.enableHooks=WY.processHooks=WY.getHooks=WY.isHookObject=WY.convertHookData=WY.makeArguments=WY.defaultMakeArguments=WY.createHookObject=WY.ACTIVATE_HOOKS=void 0;const GY=HY,{each:qY,pick:XY}=GY._;function YY(t){const e=[];return void 0!==t.id&&e.push(t.id),t.data&&e.push(t.data),e.push(t.params||{}),e}function KY(t){let e={};return Array.isArray(t)?e={all:t}:"object"!=typeof t?e={all:[t]}:qY(t,(function(t,n){e[n]=Array.isArray(t)?t:[t]})),e}function ZY(t){return"object"==typeof t&&"string"==typeof t.method&&"string"==typeof t.type}WY.ACTIVATE_HOOKS=(0,GY.createSymbol)("__feathersActivateHooks"),WY.createHookObject=function(t,e={}){const n={};return Object.defineProperty(n,"toJSON",{value(){return XY(this,"type","method","path","params","id","data","result","error")}}),Object.assign(n,e,{method:t,get path(){const{app:t,service:n}=e;return n&&t&&t.services?Object.keys(t.services).find((e=>t.services[e]===n)):null}})},WY.defaultMakeArguments=YY,WY.makeArguments=function(t){switch(t.method){case"find":return[t.params];case"get":case"remove":return[t.id,t.params];case"update":case"patch":return[t.id,t.data,t.params];case"create":return[t.data,t.params]}return YY(t)},WY.convertHookData=KY,WY.isHookObject=ZY,WY.getHooks=function(t,e,n,r,i=!1){const s=t.__hooks[n][r]||[],o=e.__hooks[n][r]||[];return i?o.concat(s):s.concat(o)},WY.processHooks=function(t,e){let n=e;const r=t=>{if(t){if(!ZY(t))throw new Error(`${n.type} hook for '${n.method}' method returned invalid hook object`);n=t}return n};return t.reduce(((t,e)=>{const n=e.bind(this);return t.then((t=>n(t))).then(r)}),Promise.resolve(n)).then((()=>n)).catch((t=>{throw t.hook=n,t}))},WY.enableHooks=function(t,e,n){if("function"==typeof t.hooks)return t;const r={};return n.forEach((t=>{r[t]={}})),Object.defineProperty(t,"__hooks",{configurable:!0,value:r,writable:!0}),Object.assign(t,{hooks(t){return qY(t,((t,n)=>{if(!this.__hooks[n])throw new Error(`'${n}' is not a valid hook type`);const r=KY(t);qY(r,((t,n)=>{if("all"!==n&&-1===e.indexOf(n))throw new Error(`'${n}' is not a valid hook method`)})),e.forEach((t=>{const e=this.__hooks[n][t]||(this.__hooks[n][t]=[]);r.all&&e.push.apply(e,r.all),r[t]&&e.push.apply(e,r[t])}))})),this}})},function(t){var e=vr&&vr.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),n=vr&&vr.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&e(r,t,i);return n(r,t),r},i=vr&&vr.__exportStar||function(t,n){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||e(n,t,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.hooks=void 0;const s=r(WY);i(HY,t),t.hooks=s}(jY),Object.defineProperty(VY,"__esModule",{value:!0}),VY.authentication=void 0;const JY=jY;VY.authentication=()=>t=>{const{app:e,params:n,path:r,method:i,app:{authentication:s}}=t;return(0,JY.stripSlashes)(s.options.path)===r&&"create"===i?t:Promise.resolve(e.get("authentication")).then((e=>(e&&(t.params=Object.assign({},e,n)),t)))};var QY={};Object.defineProperty(QY,"__esModule",{value:!0}),QY.populateHeader=void 0;QY.populateHeader=()=>t=>{const{app:e,params:{accessToken:n}}=t,r=e.authentication;if(e.rest&&n){const{scheme:e,header:i}=r.options,s=`${e} ${n}`;t.params.headers=Object.assign({},{[i]:s},t.params.headers)}return t},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.populateHeader=t.authentication=void 0;var e=VY;Object.defineProperty(t,"authentication",{enumerable:!0,get:function(){return e.authentication}});var n=QY;Object.defineProperty(t,"populateHeader",{enumerable:!0,get:function(){return n.populateHeader}})}(UY),function(t,e){var n=vr&&vr.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),r=vr&&vr.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=e.defaultStorage=e.hooks=e.MemoryStorage=e.AuthenticationClient=e.getDefaultStorage=void 0;const s=hY;Object.defineProperty(e,"AuthenticationClient",{enumerable:!0,get:function(){return s.AuthenticationClient}});const o=i(UY);e.hooks=o;const a=DY;Object.defineProperty(e,"MemoryStorage",{enumerable:!0,get:function(){return a.MemoryStorage}});e.getDefaultStorage=()=>{try{return new a.StorageWrapper(window.localStorage)}catch(t){}return new a.MemoryStorage},e.defaultStorage=(0,e.getDefaultStorage)(),e.defaults={header:"Authorization",scheme:"Bearer",storageKey:"feathers-jwt",locationKey:"access_token",locationErrorKey:"error",jwtStrategy:"jwt",path:"/authentication",Authentication:s.AuthenticationClient,storage:e.defaultStorage};const l=(t={})=>{const n=Object.assign({},e.defaults,t),{Authentication:r}=n;return t=>{const e=new r(t,n);t.authentication=e,t.authenticate=e.authenticate.bind(e),t.reAuthenticate=e.reAuthenticate.bind(e),t.logout=e.logout.bind(e),t.hooks({before:{all:[o.authentication(),o.populateHeader()]}})}};e.default=l,t.exports=Object.assign(l,t.exports)}(uY,uY.exports);var tK=xr(uY.exports),eK={exports:{}},nK={exports:{}};!function(t,e){t.exports=function(){var t="function"==typeof Object.getOwnPropertySymbols;function e(e,n,r,i){var s="function"==typeof n,o=function(){var t=this._super;this._super=s?n:e[r];var o=i.apply(this,arguments);return this._super=t,o};return s&&(Object.keys(n).forEach((function(t){o[t]=n[t]})),t&&Object.getOwnPropertySymbols(n).forEach((function(t){o[t]=n[t]}))),o}return{create:function(){var t=Object.create(this),e="string"==typeof t.__init?t.__init:"init";return"function"==typeof t[e]&&t[e].apply(t,arguments),t},mixin:function(n,r){var i=r||this,s=/\b_super\b/,o=Object.getPrototypeOf(i)||i.prototype,a={},l=n,c=function(t){var e=Object.getOwnPropertyDescriptor(l,t);!a[t]&&e&&(a[t]=e)};do{Object.getOwnPropertyNames(l).forEach(c),t&&Object.getOwnPropertySymbols(l).forEach(c)}while((l=Object.getPrototypeOf(l))&&Object.getPrototypeOf(l));var u=function(t){var n=a[t];"function"==typeof n.value&&s.test(n.value)&&(n.value=e(o,i[t],t,n.value)),Object.defineProperty(i,t,n)};return Object.keys(a).forEach(u),t&&Object.getOwnPropertySymbols(a).forEach(u),i},extend:function(t,e){return this.mixin(t,Object.create(e||this))},proxy:function(t){var e=this[t],n=Array.prototype.slice.call(arguments,1);return n.unshift(this),e.bind.apply(e,n)}}}()}(nK);var rK,iK={exports:{}},sK={exports:{}},oK="object"==typeof Reflect?Reflect:null,aK=oK&&"function"==typeof oK.apply?oK.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};rK=oK&&"function"==typeof oK.ownKeys?oK.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var lK=Number.isNaN||function(t){return t!=t};function cK(){cK.init.call(this)}sK.exports=cK,sK.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}vK(t,e,s,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&vK(t,"error",e,n)}(t,i,{once:!0})}))},cK.EventEmitter=cK,cK.prototype._events=void 0,cK.prototype._eventsCount=0,cK.prototype._maxListeners=void 0;var uK=10;function hK(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function dK(t){return void 0===t._maxListeners?cK.defaultMaxListeners:t._maxListeners}function pK(t,e,n,r){var i,s,o,a;if(hK(n),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),void 0===o)o=s[e]=n,++t._eventsCount;else if("function"==typeof o?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=dK(t))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return t}function fK(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mK(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=fK.bind(r);return i.listener=n,r.wrapFn=i,i}function gK(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):bK(i,i.length)}function yK(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function bK(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function vK(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}Object.defineProperty(cK,"defaultMaxListeners",{enumerable:!0,get:function(){return uK},set:function(t){if("number"!=typeof t||t<0||lK(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");uK=t}}),cK.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},cK.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||lK(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},cK.prototype.getMaxListeners=function(){return dK(this)},cK.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[t];if(void 0===a)return!1;if("function"==typeof a)aK(a,this,e);else{var l=a.length,c=bK(a,l);for(n=0;n<l;++n)aK(c[n],this,e)}return!0},cK.prototype.addListener=function(t,e){return pK(this,t,e,!1)},cK.prototype.on=cK.prototype.addListener,cK.prototype.prependListener=function(t,e){return pK(this,t,e,!0)},cK.prototype.once=function(t,e){return hK(e),this.on(t,mK(this,t,e)),this},cK.prototype.prependOnceListener=function(t,e){return hK(e),this.prependListener(t,mK(this,t,e)),this},cK.prototype.removeListener=function(t,e){var n,r,i,s,o;if(hK(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},cK.prototype.off=cK.prototype.removeListener,cK.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},cK.prototype.listeners=function(t){return gK(this,t,!0)},cK.prototype.rawListeners=function(t){return gK(this,t,!1)},cK.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):yK.call(t,e)},cK.prototype.listenerCount=yK,cK.prototype.eventNames=function(){return this._eventsCount>0?rK(this._events):[]},function(t,e){const{EventEmitter:n}=sK.exports,r=nK.exports,i=e.eventHook=function(){return function(t){const{app:e,service:n}=t,r=null===t.event?t.event:e.eventMappings[t.method],i=n._hookEvents&&-1!==n._hookEvents.indexOf(r);if(r&&i&&"error"!==t.type){(Array.isArray(t.result)?t.result:[t.result]).forEach((e=>n.emit(r,e,t)))}}},s=e.eventMixin=function(t){if(t._serviceEvents)return;const e=this,r="function"==typeof t.on&&"function"==typeof t.emit;"function"!=typeof t.mixin||r||t.mixin(n.prototype),Object.defineProperties(t,{_serviceEvents:{value:Array.isArray(t.events)?t.events.slice():[]},_hookEvents:{value:[]}}),Object.keys(e.eventMappings).forEach((n=>{const r=e.eventMappings[n],i=-1!==t._serviceEvents.indexOf(r);"function"!=typeof t[n]||i||(t._serviceEvents.push(r),t._hookEvents.push(r))}))};t.exports=function(){return function(t){Object.assign(t,{eventMappings:{create:"created",update:"updated",remove:"removed",patch:"patched"}}),t.hooks({finally:i()}),r.mixin(n.prototype,t),t.mixins.push(s)}}}(iK,iK.exports);var xK={exports:{}};const{_:wK}=jY;var _K=[t=>{const{service:e,method:n}=t,r=e.methods[n];return t.arguments.forEach(((e,n)=>{t[r[n]]=e})),t.params||(t.params={}),t},t=>{const{service:e,method:n,path:r}=t,i=e.methods[n];if(i.includes("id")&&void 0===t.id)throw new Error(`An id must be provided to the '${r}.${n}' method`);if(i.includes("data")&&!wK.isObjectOrArray(t.data))throw new Error(`A data object must be provided to the '${r}.${n}' method`);return t}];!function(t,e){const{hooks:n,isPromise:r}=jY,i=_K,{createHookObject:s,getHooks:o,processHooks:a,enableHooks:l,ACTIVATE_HOOKS:c}=n,u=function({app:t,service:e,method:n,original:o}){return(l={})=>{const c=t.hookTypes.reduce(((t,e)=>{const n=l[e]||[];return t[e]=Array.isArray(n)?n:[n],t}),{});return function(...l){const u=!0===l[l.length-1]&&l.pop(),h=s(n,{type:"before",arguments:l,service:e,app:t});return Promise.resolve(h).then((t=>a.call(e,i.concat(c.before),t))).then((t=>{if(void 0!==t.result)return t;const i=new Promise((i=>{const s=o||e[n],a=e.methods[n].map((e=>t[e])),l=s.apply(e,a);if(!r(l))throw new Error(`Service method '${t.method}' for '${t.path}' service must return a promise`);i(l)}));return i.then((e=>(t.result=e,t))).catch((e=>{throw e.hook=t,e}))})).then((t=>{const n=Object.assign({},t,{type:"after"});return a.call(e,c.after,n)})).catch((t=>{const n=Object.assign({},t.hook,{type:"error",original:t.hook,error:t,result:void 0});return a.call(e,c.error,n).catch((t=>Object.assign({},t.hook,{error:t,result:void 0})))})).then((t=>a.call(e,c.finally,t).catch((t=>Object.assign({},t.hook,{error:t,result:void 0}))))).then((t=>void 0!==t.error&&void 0===t.result?Promise.reject(u?t:t.error):u?t:t.result))}}},h=e.hookMixin=function(t){if("function"==typeof t.hooks)return;t.methods=Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&t[e][c])).reduce(((e,n)=>(e[n]=t[n][c],e)),t.methods||{}),Object.assign(t.methods,{find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]});const e=this,n=Object.keys(t.methods),r=n.reduce(((n,r)=>("function"!=typeof t[r]||(n[r]=function(){const t=this,n=Array.from(arguments),i=t._super.bind(t);return u({app:e,service:t,method:r,original:i})({before:o(e,t,"before",r),after:o(e,t,"after",r,!0),error:o(e,t,"error",r,!0),finally:o(e,t,"finally",r,!0)})(...n)}),n)),{});l(t,n,e.hookTypes),t.mixin(r)};t.exports=function(){return function(t){Object.assign(t,{hookTypes:["before","after","error","finally"]}),l(t,t.methods,t.hookTypes),t.mixins.push(h)}},t.exports.withHooks=u,t.exports.ACTIVATE_HOOKS=c,t.exports.activateHooks=function(t){return e=>(Object.defineProperty(e,c,{value:t}),e)}}(xK,xK.exports);const SK=dY.exports("feathers:application"),{stripSlashes:kK}=jY,TK=iK.exports,EK=xK.exports,MK=nK.exports.extend({create:null}),CK={init(){Object.assign(this,{version:"4.5.15",methods:["find","get","create","update","patch","remove"],mixins:[],services:{},providers:[],_setup:!1,settings:{}}),this.configure(EK()),this.configure(TK())},get(t){return this.settings[t]},set(t,e){return this.settings[t]=e,this},disable(t){return this.settings[t]=!1,this},disabled(t){return!this.settings[t]},enable(t){return this.settings[t]=!0,this},enabled(t){return!!this.settings[t]},configure(t){return t.call(this,this),this},service(t,e){if(void 0!==e)throw new Error("Registering a new service with `app.service(path, service)` is no longer supported. Use `app.use(path, service)` instead.");const n=kK(t)||"/",r=this.services[n];return void 0===r&&"function"==typeof this.defaultService?this.use(n,this.defaultService(n)).service(n):r},use(t,e,n={}){if("string"!=typeof t)throw new Error(`'${t}' is not a valid service path.`);const r=kK(t)||"/",i="function"==typeof e.service&&e.services,s=this.methods.concat("setup").some((t=>"function"==typeof e[t]));if(i){const t=e;return Object.keys(t.services).forEach((e=>this.use(`${r}/${e}`,t.service(e)))),this}if(!s)throw new Error(`Invalid service object passed for path \`${r}\``);const o=MK.isPrototypeOf(e)?e:MK.extend(e);return SK(`Registering new service at \`${r}\``),this.mixins.forEach((t=>t.call(this,o,r,n))),"function"==typeof o._setup&&o._setup(this,r),this.providers.forEach((t=>t.call(this,o,r,n))),this._isSetup&&"function"==typeof o.setup&&(SK(`Setting up service for \`${r}\``),o.setup(this,r)),this.services[r]=o,this},setup(){return Object.keys(this.services).forEach((t=>{const e=this.services[t];SK(`Setting up service for \`${t}\``),"function"==typeof e.setup&&e.setup(this,t)})),this._isSetup=!0,this}};const AK=nK.exports,NK=CK,{ACTIVATE_HOOKS:IK,activateHooks:$K}=xK.exports,RK=Object.create(null);function OK(){const t=Object.create(RK);return AK.mixin(NK,t),t.init(),t}OK.version="4.5.15",OK.ACTIVATE_HOOKS=IK,OK.activateHooks=$K,eK.exports=OK,eK.exports.default=OK;var PK={exports:{}},LK={},DK=vr&&vr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(LK,"__esModule",{value:!0}),LK.Service=void 0;const FK=DK(dY.exports),zK=LY,BK=(0,FK.default)("@feathersjs/transport-commons/client"),UK=["addListener","emit","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeListener"],VK=["eventNames","getMaxListeners","setMaxListeners"],jK=t=>{VK.forEach((e=>{t[e]=function(...t){if("function"!=typeof this.connection[e])throw new Error(`Can not call '${e}' on the client service connection`);return this.connection[e](...t)}})),UK.forEach((e=>{t[e]=function(t,...n){if("function"!=typeof this.connection[e])throw new Error(`Can not call '${e}' on the client service connection`);const r=`${this.path} ${t}`;BK(`Calling emitter method ${e} with namespaced event '${r}'`);const i=this.connection[e](r,...n);return i===this.connection?this:i}}))};LK.Service=class{constructor(t){this.events=t.events,this.path=t.name,this.connection=t.connection,this.method=t.method,this.timeout=t.timeout||5e3,jK(this)}send(t,...e){return new Promise(((n,r)=>{const i=setTimeout((()=>r(new zK.Timeout(`Timeout of ${this.timeout}ms exceeded calling ${t} on ${this.path}`,{timeout:this.timeout,method:t,path:this.path}))),this.timeout);e.unshift(t,this.path),e.push((function(t,e){return t=(0,zK.convert)(t),clearTimeout(i),t?r(t):n(e)})),BK(`Sending socket.${this.method}`,e),this.connection[this.method](...e)}))}find(t={}){return this.send("find",t.query||{})}get(t,e={}){return this.send("get",t,e.query||{})}create(t,e={}){return this.send("create",t,e.query||{})}update(t,e,n={}){return this.send("update",t,e,n.query||{})}patch(t,e,n={}){return this.send("patch",t,e,n.query||{})}remove(t,e={}){return this.send("remove",t,e.query||{})}off(t,...e){if("function"==typeof this.connection.off){const n=this.connection.off(`${this.path} ${t}`,...e);return n===this.connection?this:n}return 0===e.length?this.removeAllListeners(t):this.removeListener(t,...e)}};const WK=LK.Service;function HK(t,e){if(!t)throw new Error("Socket.io connection needs to be provided");if(t&&t.io&&t.io.engine&&t.io.engine.transport&&t.io.engine.transport.query&&t.io.engine.transport.query.EIO>3)throw console.error("You are trying to use the Socket.io client version 3 or later with Feathers v4 which only supports Socket.io version 2. Please use socket.io-client version 2 instead."),new Error("socket.io-client must be version 2.x");const n=function(n){const r=Object.keys(this.eventMappings||{}).map((t=>this.eventMappings[t])),i=Object.assign({},e,{events:r,name:n,connection:t,method:"emit"});return new WK(i)},r=function(e){if("function"==typeof e.defaultService)throw new Error("Only one default client provider can be configured");e.io=t,e.defaultService=n};return r.Service=WK,r.service=n,r}PK.exports=HK,PK.exports.default=HK;var GK={exports:{}},qK={},XK={},YK={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.OPERATORS=e.FILTERS=void 0;const n=jY,r=LY;function i(t){if(void 0!==t)return Math.abs(parseInt(t,10))}function s(t,e,i){if(Array.isArray(t))return t.map((t=>s(t,e,i)));if(n._.isObject(t)&&t.constructor==={}.constructor){const o={};return n._.each(t,((n,a)=>{if("$"===a[0]){if(void 0!==i[a])return;if(!e.includes(a))throw new r.BadRequest(`Invalid query parameter ${a}`,t)}o[a]=s(n,e,i)})),Object.getOwnPropertySymbols(t).forEach((e=>{o[e]=t[e]})),o}return t}function o(t,e,r,i){return Array.isArray(r)?n._.each(r,(n=>{void 0!==e[n]&&(t[n]=e[n])})):n._.each(r,((n,r)=>{const s=n(e[r],i);void 0!==s&&(t[r]=s)})),t}function a(t,n={}){const{filters:r={},operators:i=[]}=n,a={};return a.filters=o({},t,e.FILTERS,n),a.filters=o(a.filters,t,r,n),a.query=s(t,e.OPERATORS.concat(i),a.filters),a}e.FILTERS={$sort:t=>function(t){return"object"!=typeof t||Array.isArray(t)?t:Object.keys(t).reduce(((e,n)=>(e[n]="object"==typeof t[n]?t[n]:parseInt(t[n],10),e)),{})}(t),$limit:(t,e)=>function(t,e){if(e&&e.default){const n="number"!=typeof t||isNaN(t)?e.default:t,r="number"==typeof e.max?e.max:Number.MAX_VALUE;return Math.min(n,r)}return t}(i(t),e.paginate),$skip:t=>i(t),$select:t=>t},e.OPERATORS=["$in","$nin","$lt","$lte","$gt","$gte","$ne","$or"],e.default=a,t.exports=Object.assign(a,t.exports)}(YK,YK.exports);var KK=vr&&vr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(XK,"__esModule",{value:!0}),XK.AdapterService=void 0;const ZK=LY,JK=KK(YK.exports),QK=(t,e,...n)=>"function"!=typeof t[e]?Promise.reject(new ZK.NotImplemented(`Method ${e} not available`)):t[e](...n),tZ={find:!0,get:!1,update:!1};XK.AdapterService=class{constructor(t){this.options=Object.assign({id:"id",events:[],paginate:{},multi:!1,filters:[],whitelist:[]},t)}get id(){return this.options.id}get events(){return this.options.events}filterQuery(t={},e={}){const n=void 0!==t.paginate?t.paginate:this.options.paginate,{query:r={}}=t,i=Object.assign({operators:this.options.whitelist||[],filters:this.options.filters,paginate:n},e),s=(0,JK.default)(r,i);return Object.assign(s,{paginate:n})}allowsMulti(t){const e=tZ[t];if(void 0!==e)return e;const n=this.options.multi;return!0===n||!1===n?n:n.includes(t)}find(t){return QK(this,"_find",t)}get(t,e){return QK(this,"_get",t,e)}create(t,e){return Array.isArray(t)&&!this.allowsMulti("create")?Promise.reject(new ZK.MethodNotAllowed("Can not create multiple entries")):QK(this,"_create",t,e)}update(t,e,n){return null===t||Array.isArray(e)?Promise.reject(new ZK.BadRequest("You can not replace multiple instances. Did you mean 'patch'?")):QK(this,"_update",t,e,n)}patch(t,e,n){return null!==t||this.allowsMulti("patch")?QK(this,"_patch",t,e,n):Promise.reject(new ZK.MethodNotAllowed("Can not patch multiple entries"))}remove(t,e){return null!==t||this.allowsMulti("remove")?QK(this,"_remove",t,e):Promise.reject(new ZK.MethodNotAllowed("Can not remove multiple entries"))}};var eZ={};function nZ(t){var e="[object "+t+"]";return function(t){return Object.prototype.toString.call(t)===e}}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sorter=t.compare=t.compareArrays=t.compareNSB=void 0,t.compareNSB=function(t,e){return t<e?-1:t>e?1:0},t.compareArrays=function(e,n){let r,i;for(r=0;r<Math.min(e.length,n.length);r+=1)if(i=t.compare(e[r],n[r]),0!==i)return i;return t.compareNSB(e.length,n.length)},t.compare=function(e,n,r=t.compareNSB){const{compareNSB:i,compare:s,compareArrays:o}=t;if(void 0===e)return void 0===n?0:-1;if(void 0===n)return void 0===e?0:1;if(null===e)return null===n?0:-1;if(null===n)return null===e?0:1;if("number"==typeof e)return"number"==typeof n?i(e,n):-1;if("number"==typeof n)return"number"==typeof e?i(e,n):1;if("string"==typeof e)return"string"==typeof n?r(e,n):-1;if("string"==typeof n)return"string"==typeof e?r(e,n):1;if("boolean"==typeof e)return"boolean"==typeof n?i(e,n):-1;if("boolean"==typeof n)return"boolean"==typeof e?i(e,n):1;if(e instanceof Date)return n instanceof Date?i(e.getTime(),n.getTime()):-1;if(n instanceof Date)return e instanceof Date?i(e.getTime(),n.getTime()):1;if(Array.isArray(e))return Array.isArray(n)?o(e,n):-1;if(Array.isArray(n))return Array.isArray(e)?o(e,n):1;const a=Object.keys(e).sort(),l=Object.keys(n).sort();let c=0;for(let t=0;t<Math.min(a.length,l.length);t+=1)if(c=s(e[a[t]],n[l[t]]),0!==c)return c;return i(a.length,l.length)},t.sorter=function(e){const n=Object.keys(e).map((t=>({key:t,direction:e[t]})));return function(e,r){let i;for(const s of n)if(i=s.direction*t.compare(e[s.key],r[s.key]),0!==i)return i;return 0}}}(eZ),function(t){var e=vr&&vr.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),n=vr&&vr.__exportStar||function(t,n){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||e(n,t,r)},r=vr&&vr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.select=t.OPERATORS=t.FILTERS=t.filterQuery=t.AdapterService=void 0;const i=jY;var s=XK;Object.defineProperty(t,"AdapterService",{enumerable:!0,get:function(){return s.AdapterService}});var o=YK.exports;Object.defineProperty(t,"filterQuery",{enumerable:!0,get:function(){return r(o).default}}),Object.defineProperty(t,"FILTERS",{enumerable:!0,get:function(){return o.FILTERS}}),Object.defineProperty(t,"OPERATORS",{enumerable:!0,get:function(){return o.OPERATORS}}),n(eZ,t),t.select=function(t,...e){const n=t&&t.query&&t.query.$select;Array.isArray(n)&&e.length&&n.push(...e);const r=t=>Array.isArray(n)?i._.pick(t,...n):t;return t=>Array.isArray(t)?t.map(r):r(t)}}(qK);var rZ=nZ("Array"),iZ=nZ("Object"),sZ=nZ("Function");function oZ(t,e){return sZ(t.get)?t.get(e):t[e]}const aZ=(lZ=t=>function(e,n,r,i,s){if(!rZ(n)||!n.length)return t(e,n);for(var o=0,a=n.length;o<a;o++)if(t(e,oZ(n,o)))return!0;return!1},(t,e,n,r,i)=>i?Boolean(i.find((([e,n,r])=>lZ(t,n,r)))):lZ(t,e,n,r));var lZ;function cZ(t){return function(e,n,r,i){if(!rZ(n)||!n.length)return t(e,n,r,i);for(var s=0,o=n.length;s<o;s++)if(!t(e,oZ(n,s),n,i))return!1;return!0}}function uZ(t,e,n,r,i){return t.validate(t.options,e,n,r,i)}var hZ={$eq:aZ((function(t,e){return t(e)})),$ne:cZ((function(t,e){return t(e)})),$gt:aZ((function(t,e){return t(e)})),$gte:aZ((function(t,e){return t(e)})),$lt:aZ((function(t,e){return t(e)})),$lte:aZ((function(t,e){return t(e)})),$mod:aZ((function(t,e){return t(e)})),$in:(t,e)=>t(e),$nin:function(t,e){return t(e)},$not:function(t,e,n,r){return t(e,n,r)},$type:function(t,e){return t(e)},$all:function(t,e,n,r,i){return hZ.$and(t,e,n,r,i)},$size:function(t,e){return!!e&&t===e.length},$or:function(t,e,n,r){for(var i=0,s=t.length;i<s;i++)if(uZ(oZ(t,i),e,n,r))return!0;return!1},$nor:function(t,e,n,r){return!hZ.$or(t,e,n,r)},$and:function(t,e,n,r,i){if(i){for(var s=0,o=t.length;s<o;s++)if(!uZ(oZ(t,s),e,n,r,i))return!1}else for(s=0,o=t.length;s<o;s++)if(!uZ(oZ(t,s),e,n,r,i))return!1;return!0},$regex:aZ((function(t,e){return"string"==typeof e&&t.test(e)})),$where:function(t,e,n,r){return t.call(e,e,n,r)},$elemMatch:function(t,e,n,r){return rZ(e)?!!~function(t,e){for(var n=0;n<t.length;n++)if(oZ(t,n),uZ(e,oZ(t,n)))return n;return-1}(e,t):uZ(t,e,n,r)},$exists:function(t,e,n,r){return r.hasOwnProperty(n)===t}},dZ={$eq:function(t,e,{comparable:n,compare:r}){return t instanceof RegExp?aZ((function(e){return"string"==typeof e&&t.test(e)})):t instanceof Function?aZ(t):rZ(t)&&!t.length?aZ((function(t){return rZ(t)&&!t.length})):aZ(null===t?function(t){return null==t}:function(e){return 0===r(n(e),n(t))})},$gt:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))>0}},$gte:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))>=0}},$lt:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))<0}},$lte:function(t,e,{comparable:n,compare:r}){return function(e){return r(n(e),n(t))<=0}},$in:function(t,e,n){const{comparable:r}=n;return function(e){if(!(e instanceof Array)){var i=r(e);if(i===e&&"object"==typeof e)for(o=t.length;o--;)if(String(t[o])===String(e)&&"[object Object]"!==String(e))return!0;if(void 0===i)for(o=t.length;o--;)if(null==t[o])return!0;for(o=t.length;o--;){var s=uZ(xZ(oZ(t,o),n),i,o,t);if(s&&"[object Object]"!==String(s)&&"[object Object]"!==String(i))return!0}return!!~t.indexOf(i)}for(var o=e.length;o--;)if(~t.indexOf(r(oZ(e,o))))return!0;return!1}},$nin:function(t,e,n){const r=dZ.$in(t,e,n);return function(t,e,n,i){return!r(t,e,n,i)}},$mod:function(t){return function(e){return e%t[0]==t[1]}},$ne:function(t,e,n){const r=dZ.$eq(t,e,n);return cZ((function(t,e,n,i){return!r(t,e,n,i)}))},$and:function(t,e,n){return t.map(yZ(n))},$all:function(t,e,n){return dZ.$and(t,e,n)},$or:function(t,e,n){return t.map(yZ(n))},$nor:function(t,e,n){return t.map(yZ(n))},$not:function(t,e,n){const r=yZ(n)(t);return function(t,e,n){return!uZ(r,t,e,n)}},$type:function(t){return function(e,n,r){return null!=e&&(e instanceof t||e.constructor==t)}},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return"string"==typeof t?new Function("obj","return "+t):t},$elemMatch:function(t,e,n){return yZ(n)(t)},$exists:function(t){return!!t}};function pZ(t,e){return{options:t,validate:e}}function fZ({keyPath:t,child:e,query:n},r){const i=[];if(mZ(r,t,0,r,i),1===i.length){const[t,n,r]=i[0];return uZ(e,t,n,r)}return n&&n.$ne,i.map((([t])=>t)),uZ(e,void 0,void 0,void 0,i)}function mZ(t,e,n,r,i){if(n!==e.length&&null!=t){var s=oZ(e,n);if(rZ(t)&&isNaN(Number(s)))for(var o=0,a=t.length;o<a;o++)mZ(oZ(t,o),e,n,t,i);else mZ(oZ(t,s),e,n+1,t,i)}else i.push([t,e[n-1],r])}function gZ(t,e,n){return pZ({keyPath:t,child:e,query:n},fZ)}function yZ(t){const{comparable:e,expressions:n}=t;var r=function(t){var e;return t&&((e=t)&&(e.constructor===Object||e.constructor===Array||"function Object() { [native code] }"===e.constructor.toString()||"function Array() { [native code] }"===e.constructor.toString()))||(t={$eq:t}),t},i=function(r){r=e(r);var i=[];for(var o in r){var a=r[o];if("$options"!==o){var l=hZ[o]||t&&n&&n[o];if(l)dZ[o]&&(a=dZ[o](a,r,t)),i.push(pZ(e(a),l));else{if(36===o.charCodeAt(0))throw new Error("Unknown operation "+o);var c=o.split(".");i.push(gZ(c,s(a),a))}}}return 1===i.length?i[0]:pZ(i,hZ.$and)},s=function(t){return t=r(t),-1===vZ(t,[]).join(",").search(/[$.]/)?pZ(t,bZ):i(t)};return function(t){return i(r(t))}}function bZ(t,e){if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(iZ(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!bZ(t[n],e[n]))return!1;return!0}if(rZ(t)){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(!bZ(t[r],e[r]))return!1;return!0}return t===e}function vZ(t,e){if(!iZ(t))return e;for(var n in t)e.push(n),vZ(t[n],e);return e}function xZ(t,e){var n=yZ(e)(t);return e&&e.select&&(n={options:n,validate:function(t,n,r,i){return uZ(t,n&&e.select(n),r,i)}}),n}function wZ(t,e){if(bZ(t,e))return 0;if(typeof t==typeof e){if(t>e)return 1;if(t<e)return-1}}function _Z(t){return t instanceof Date?t.getTime():rZ(t)?t.map(_Z):t&&"function"==typeof t.toJSON?t.toJSON():t}var SZ=Object.freeze({__proto__:null,default:function(t,e){var n=xZ(t,e=Object.assign({compare:wZ,comparable:_Z},e));return function(t,e,r){return uZ(n,t,e,r)}},compare:wZ,comparable:_Z}),kZ=wr(SZ);const TZ=LY,{_:EZ}=jY,{sorter:MZ,select:CZ,AdapterService:AZ}=qK,NZ=kZ.default,IZ=(t,...e)=>CZ(...e)(JSON.parse(JSON.stringify(t)));class $Z extends AZ{constructor(t={}){super(EZ.extend({id:"id",matcher:NZ,sorter:MZ},t)),this._uId=t.startId||0,this.store=t.store||{}}async getEntries(t={}){const{query:e}=this.filterQuery(t);return this._find(Object.assign({},t,{paginate:!1,query:e}))}async _find(t={}){const{query:e,filters:n,paginate:r}=this.filterQuery(t);let i=EZ.values(this.store).filter(this.options.matcher(e));const s=i.length;void 0!==n.$sort&&i.sort(this.options.sorter(n.$sort)),void 0!==n.$skip&&(i=i.slice(n.$skip)),void 0!==n.$limit&&(i=i.slice(0,n.$limit));const o={total:s,limit:n.$limit,skip:n.$skip||0,data:i.map((e=>IZ(e,t)))};return r&&r.default?o:o.data}async _get(t,e={}){if(t in this.store){const{query:n}=this.filterQuery(e),r=this.store[t];if(this.options.matcher(n)(r))return IZ(r,e,this.id)}throw new TZ.NotFound(`No record found for id '${t}'`)}async _create(t,e={}){if(Array.isArray(t))return Promise.all(t.map((t=>this._create(t,e))));const n=t[this.id]||this._uId++,r=EZ.extend({},t,{[this.id]:n}),i=this.store[n]=r;return IZ(i,e,this.id)}async _update(t,e,n={}){const r=(await this._get(t))[this.id];return t=r==t?r:t,this.store[t]=EZ.extend({},e,{[this.id]:t}),this._get(t,n)}async _patch(t,e,n={}){const r=t=>{const r=t[this.id];return this.store[r]=EZ.extend(this.store[r],EZ.omit(e,this.id)),IZ(this.store[r],n,this.id)};if(null===t){return(await this.getEntries(n)).map(r)}return r(await this._get(t,n))}async _remove(t,e={}){if(null===t){const t=await this.getEntries(e);return Promise.all(t.map((t=>this._remove(t[this.id],e))))}const n=await this._get(t,e);return delete this.store[t],n}}GK.exports=t=>new $Z(t),GK.exports.Service=$Z;var RZ={exports:{}};const{Service:OZ}=GK.exports,PZ=[];class LZ extends OZ{constructor(t={}){if(super(t),this._storageKey=t.name||"feathers",this._storage=t.storage||"undefined"!=typeof window&&window.localStorage,this._throttle=t.throttle||200,this._reuseKeys=t.reuseKeys||!1,this.store=null,!this._storage)throw new Error("The `storage` option needs to be provided");if(-1===PZ.indexOf(this._storageKey))PZ.push(this._storageKey);else if(!this._reuseKeys)throw new Error(`The storage name '${this._storageKey}' is already in use by another instance.`);this.ready()}ready(){return this.store?Promise.resolve(this.store):Promise.resolve(this._storage.getItem(this._storageKey)).then((t=>JSON.parse(t||"{}"))).then((t=>{const e=Object.keys(t),n=t[e[e.length-1]];return this._uId=e.length&&void 0!==n[this.id]?n[this.id]+1:this._uId,this.store=t}))}flush(t){return this._timeout||(this._timeout=setTimeout((()=>{this._storage.setItem(this._storageKey,JSON.stringify(this.store)),delete this._timeout}),this._throttle)),t}execute(t,...e){return this.ready().then((()=>super[t](...e)))}find(...t){return this.execute("find",...t)}get(...t){return this.execute("get",...t)}create(...t){return this.execute("create",...t).then((t=>this.flush(t)))}patch(...t){return this.execute("patch",...t).then((t=>this.flush(t)))}update(...t){return this.execute("update",...t).then((t=>this.flush(t)))}remove(...t){return this.execute("remove",...t).then((t=>this.flush(t)))}}RZ.exports=function(t){return new LZ(t)},RZ.exports.Service=LZ;let DZ=~~(16777215*Math.random());const FZ=parseInt((16777215*Math.random()).toString(),10);function zZ(){const t=~~(Date.now()/1e3),e=Math.floor(1e5*Math.random());DZ=(DZ+1)%16777215;const n=DZ,r=new Uint8Array(12);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[6]=255&FZ,r[5]=FZ>>8&255,r[4]=FZ>>16&255,r[8]=255&e,r[7]=e>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r.reduce(((t,e)=>t+`0${e.toString(16)}`.slice(-2)),"")}const BZ=document.createElement("canvas"),UZ=BZ.getContext("2d"),VZ=new Image;function jZ(t){return new Promise(((e,n)=>{t?(VZ.addEventListener("load",(()=>{BZ.width=VZ.width,BZ.height=VZ.height,null==UZ||UZ.drawImage(VZ,0,0,BZ.width,BZ.height),e(null==UZ?void 0:UZ.getImageData(0,0,BZ.width,BZ.height))}),!1),VZ.src=t):n()}))}function WZ(t){const{data:e,service:n}=t;return t.data={[n.id]:zZ(),...e},t}function HZ(t){const{result:e,params:n}=t;if(e){if(e._id)e.id=e._id,delete e._id;else if(e.total&&Array.isArray(e.data))for(const[t,n]of e.data.entries())n._id&&(e.data[t].id=e.data[t]._id,delete e.data[t]._id)}else n&&n.query&&(n.query.id&&(t.params.query._id=t.params.query.id,delete t.params.query.id),n.query.$select&&n.query.$select.includes("id")&&!n.query.$select.includes("_id")&&t.params.query.$select.push("_id"));return t}function GZ(t){return t.data||(t.data={}),t.data.createdAt=new Date,t.data.updatedAt=t.data.createdAt,t}function qZ(t){return t.data&&t.data.createdAt?(t.data.updatedAt=new Date,t):t}function XZ(t,e){return n=>(n.params=n.params||{},n.params.query=n.params.query||{},n.params.query[t]=e,n)}const YZ=document.createElement("canvas"),KZ=YZ.getContext("2d");async function ZZ(t){const{data:e}=t;for(const[n,r]of Object.entries(e))if(r instanceof ImageData){const e=r.width,i=r.height;YZ.width=e,YZ.height=i,KZ.putImageData(r,0,0),t.data[n]=YZ.toDataURL("image/jpeg")}return t}async function JZ(t){if(!t.result)return t;const{result:e}=t,n=t=>t&&"string"==typeof t&&"data:image/jpeg;base64"===t.slice(0,22);if(e._id)for(const[t,r]of Object.entries(e).filter((([t])=>"thumbnail"!==t)))n(r)&&(e[t]=await jZ(r));else if(e.total&&Array.isArray(e.data))for(const[t,r]of e.data.entries())for(const[i,s]of Object.entries(r).filter((([t])=>"thumbnail"!==t)))n(s)&&(e.data[t][i]=await jZ(s));return t}async function QZ(t){var e,n;if(!(null===(n=null===(e=t.params)||void 0===e?void 0:e.query)||void 0===n?void 0:n.$distinct)||"before"!==t.type||"find"!==t.method)return t;const{$distinct:r,...i}=t.params.query;i.$select=[r],i.$skip=0;let s=1;const o=new Set;for(;i.$skip<s;){const e=await t.service.find({query:i});for(const t of e.data)o.add(t[r]);i.$skip+=e.limit,s=e.total}return t.result=Array.from(o),t}function tJ(t){let e;return{c(){e=RN("Register")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function eJ(t){let e;return{c(){e=RN("Log In")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function nJ(t){let e,n,r,i,s,o,a,l,c;return{c(){e=IN("div"),n=IN("span"),n.innerHTML='<i class="fas fa-bell"></i>',r=ON(),i=IN("span"),s=IN("b"),s.textContent="Login Error",o=ON(),a=RN(t[1]),l=ON(),c=IN("button"),c.innerHTML="<span>×</span>",FN(n,"class","text-xl inline-block mr-5 align-middle"),FN(s,"class","capitalize"),FN(i,"class","inline-block align-middle mr-8"),FN(c,"class","absolute bg-transparent text-2xl font-semibold leading-none right-0 top-0 mt-4 mr-6 outline-none focus:outline-none"),FN(e,"class","text-white px-6 py-4 border-0 rounded relative mb-4 bg-red-500")},m(t,u){CN(t,e,u),TN(e,n),TN(e,r),TN(e,i),TN(i,s),TN(i,o),TN(i,a),TN(e,l),TN(e,c)},p(t,e){2&e&&BN(a,t[1])},d(t){t&&AN(e)}}}function rJ(t){let e;return{c(){e=RN("Register")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function iJ(t){let e;return{c(){e=RN("Log In")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function sJ(t){let e,n,r,i;return{c(){e=RN("Already have an account?\n        "),n=IN("button"),n.textContent="Log In",FN(n,"class","text-blue-500")},m(s,o){CN(s,e,o),CN(s,n,o),r||(i=LN(n,"click",t[2]),r=!0)},p:nN,d(t){t&&AN(e),t&&AN(n),r=!1,i()}}}function oJ(t){let e,n,r,i;return{c(){e=RN("Don't have an account?\n        "),n=IN("button"),n.textContent="Register Here",FN(n,"class","text-blue-500")},m(s,o){CN(s,e,o),CN(s,n,o),r||(i=LN(n,"click",t[2]),r=!0)},p:nN,d(t){t&&AN(e),t&&AN(n),r=!1,i()}}}function aJ(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b;function v(t,e){return"login"===t[0]?eJ:tJ}let x=v(t),w=x(t),_=t[1]&&nJ(t);function S(t,e){return"login"===t[0]?iJ:rJ}let k=S(t),T=k(t);function E(t,e){return"login"===t[0]?oJ:sJ}let M=E(t),C=M(t);return{c(){e=IN("div"),n=IN("div"),r=IN("h2"),w.c(),i=ON(),s=IN("p"),s.textContent="This Marcelle application requires authentication.",o=ON(),_&&_.c(),a=ON(),l=IN("form"),c=IN("div"),c.innerHTML='<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Email</label> \n        <input type="email" name="email" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Email" style="transition: all 0.15s ease 0s;"/>',u=ON(),h=IN("div"),h.innerHTML='<label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="grid-password">Password</label> \n        <input type="password" name="password" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-purple-500" placeholder="Password" style="transition: all 0.15s ease 0s;"/>',d=ON(),p=IN("div"),f=IN("button"),T.c(),m=ON(),g=IN("p"),C.c(),FN(r,"class","text-xl"),FN(s,"class","text-gray-600"),FN(n,"class","p-4 text-center"),FN(c,"class","relative w-full mb-3"),FN(h,"class","relative w-full mb-3"),FN(f,"class","bg-gray-900 text-white active:bg-gray-700 text-sm font-bold uppercase px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 w-full"),FN(f,"type","submit"),VN(f,"transition","all 0.15s ease 0s"),FN(p,"class","text-center mt-6"),FN(g,"class","my-4"),FN(e,"class","marcelle p-12")},m(v,x){CN(v,e,x),TN(e,n),TN(n,r),w.m(r,null),TN(n,i),TN(n,s),TN(e,o),_&&_.m(e,null),TN(e,a),TN(e,l),TN(l,c),TN(l,u),TN(l,h),TN(l,d),TN(l,p),TN(p,f),T.m(f,null),TN(e,m),TN(e,g),C.m(g,null),y||(b=LN(l,"submit",DN(t[7])),y=!0)},p(t,n){x!==(x=v(t))&&(w.d(1),w=x(t),w&&(w.c(),w.m(r,null))),t[1]?_?_.p(t,n):(_=nJ(t),_.c(),_.m(e,a)):_&&(_.d(1),_=null),k!==(k=S(t))&&(T.d(1),T=k(t),T&&(T.c(),T.m(f,null))),M===(M=E(t))&&C?C.p(t,n):(C.d(1),C=M(t),C&&(C.c(),C.m(g,null)))},d(t){t&&AN(e),w.d(),_&&_.d(),T.d(),C.d(),y=!1,b()}}}function lJ(t){let e,n;return e=new t$({props:{$$slots:{default:[aJ]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};515&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function cJ(t,e,n){const r=oI();let i,{dataStore:s}=e,{mode:o="login"}=e;function a(t){r("terminate",t)}async function l(t){const e=new FormData(t.target);try{a(await s.login(e.get("email"),e.get("password")))}catch(t){n(1,i=t)}}async function c(t){const e=new FormData(t.target);try{a(await s.signup(e.get("email"),e.get("password")))}catch(t){a(null)}}return t.$$set=t=>{"dataStore"in t&&n(5,s=t.dataStore),"mode"in t&&n(0,o=t.mode)},[o,i,function(){n(0,o="login"===o?"register":"login")},l,c,s,a,t=>"login"===o?l(t):c(t)]}class uJ extends HI{constructor(t){super(),WI(this,t,cJ,lJ,lN,{dataStore:5,mode:0,terminate:6})}get terminate(){return this.$$.ctx[6]}}var hJ,dJ,pJ,fJ,mJ,gJ,yJ={exports:{}};
/**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],g="[object Arguments]",y="[object Array]",b="[object Boolean]",v="[object Date]",x="[object Error]",w="[object Function]",_="[object GeneratorFunction]",S="[object Map]",k="[object Number]",T="[object Object]",E="[object Promise]",M="[object RegExp]",C="[object Set]",A="[object String]",N="[object Symbol]",I="[object WeakMap]",$="[object ArrayBuffer]",R="[object DataView]",O="[object Float32Array]",P="[object Float64Array]",L="[object Int8Array]",D="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",V="[object Uint32Array]",j=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,X=RegExp(G.source),Y=RegExp(q.source),K=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/[\\^$.*+?()[\]{}|]/g,rt=RegExp(nt.source),it=/^\s+/,st=/\s/,ot=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,at=/\{\n\/\* \[wrapped with (.+)\] \*/,lt=/,? & /,ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ut=/[()=,{}\[\]\/\s]/,ht=/\\(\\)?/g,dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,gt=/^\[object .+?Constructor\]$/,yt=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,vt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,_t="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",kt="a-z\\xdf-\\xf6\\xf8-\\xff",Tt="A-Z\\xc0-\\xd6\\xd8-\\xde",Et="\\ufe0e\\ufe0f",Mt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ct="['’]",At="[\\ud800-\\udfff]",Nt="["+Mt+"]",It="["+_t+"]",$t="\\d+",Rt="[\\u2700-\\u27bf]",Ot="["+kt+"]",Pt="[^\\ud800-\\udfff"+Mt+$t+St+kt+Tt+"]",Lt="\\ud83c[\\udffb-\\udfff]",Dt="[^\\ud800-\\udfff]",Ft="(?:\\ud83c[\\udde6-\\uddff]){2}",zt="[\\ud800-\\udbff][\\udc00-\\udfff]",Bt="["+Tt+"]",Ut="(?:"+Ot+"|"+Pt+")",Vt="(?:"+Bt+"|"+Pt+")",jt="(?:['’](?:d|ll|m|re|s|t|ve))?",Wt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+It+"|"+Lt+")"+"?",Gt="[\\ufe0e\\ufe0f]?",qt=Gt+Ht+("(?:\\u200d(?:"+[Dt,Ft,zt].join("|")+")"+Gt+Ht+")*"),Xt="(?:"+[Rt,Ft,zt].join("|")+")"+qt,Yt="(?:"+[Dt+It+"?",It,Ft,zt,At].join("|")+")",Kt=RegExp(Ct,"g"),Zt=RegExp(It,"g"),Jt=RegExp(Lt+"(?="+Lt+")|"+Yt+qt,"g"),Qt=RegExp([Bt+"?"+Ot+"+"+jt+"(?="+[Nt,Bt,"$"].join("|")+")",Vt+"+"+Wt+"(?="+[Nt,Bt+Ut,"$"].join("|")+")",Bt+"?"+Ut+"+"+jt,Bt+"+"+Wt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",$t,Xt].join("|"),"g"),te=RegExp("[\\u200d\\ud800-\\udfff"+_t+Et+"]"),ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ne=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],re=-1,ie={};ie[O]=ie[P]=ie[L]=ie[D]=ie[F]=ie[z]=ie[B]=ie[U]=ie[V]=!0,ie[g]=ie[y]=ie[$]=ie[b]=ie[R]=ie[v]=ie[x]=ie[w]=ie[S]=ie[k]=ie[T]=ie[M]=ie[C]=ie[A]=ie[I]=!1;var se={};se[g]=se[y]=se[$]=se[R]=se[b]=se[v]=se[O]=se[P]=se[L]=se[D]=se[F]=se[S]=se[k]=se[T]=se[M]=se[C]=se[A]=se[N]=se[z]=se[B]=se[U]=se[V]=!0,se[x]=se[w]=se[I]=!1;var oe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ae=parseFloat,le=parseInt,ce="object"==typeof vr&&vr&&vr.Object===Object&&vr,ue="object"==typeof self&&self&&self.Object===Object&&self,he=ce||ue||Function("return this")(),de=e&&!e.nodeType&&e,pe=de&&t&&!t.nodeType&&t,fe=pe&&pe.exports===de,me=fe&&ce.process,ge=function(){try{var t=pe&&pe.require&&pe.require("util").types;return t||me&&me.binding&&me.binding("util")}catch(t){}}(),ye=ge&&ge.isArrayBuffer,be=ge&&ge.isDate,ve=ge&&ge.isMap,xe=ge&&ge.isRegExp,we=ge&&ge.isSet,_e=ge&&ge.isTypedArray;function Se(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function ke(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Te(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ee(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Me(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ce(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ae(t,e){return!!(null==t?0:t.length)&&ze(t,e,0)>-1}function Ne(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Ie(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function $e(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Re(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Oe(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Le=je("length");function De(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function Fe(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function ze(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):Fe(t,Ue,n)}function Be(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ue(t){return t!=t}function Ve(t,e){var n=null==t?0:t.length;return n?Ge(t,e)/n:p}function je(t){return function(e){return null==e?n:e[t]}}function We(t){return function(e){return null==t?n:t[e]}}function He(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ge(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function qe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Xe(t){return t?t.slice(0,pn(t)+1).replace(it,""):t}function Ye(t){return function(e){return t(e)}}function Ke(t,e){return Ie(e,(function(e){return t[e]}))}function Ze(t,e){return t.has(e)}function Je(t,e){for(var n=-1,r=t.length;++n<r&&ze(e,t[n],0)>-1;);return n}function Qe(t,e){for(var n=t.length;n--&&ze(e,t[n],0)>-1;);return n}function tn(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}var en=We({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),nn=We({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function rn(t){return"\\"+oe[t]}function sn(t){return te.test(t)}function on(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function an(t,e){return function(n){return t(e(n))}}function ln(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==s||(t[n]=s,o[i++]=n)}return o}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function un(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function hn(t){return sn(t)?function(t){var e=Jt.lastIndex=0;for(;Jt.test(t);)++e;return e}(t):Le(t)}function dn(t){return sn(t)?function(t){return t.match(Jt)||[]}(t):function(t){return t.split("")}(t)}function pn(t){for(var e=t.length;e--&&st.test(t.charAt(e)););return e}var fn=We({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var mn=function t(e){var st=(e=null==e?he:mn.defaults(he.Object(),e,mn.pick(he,ne))).Array,_t=e.Date,St=e.Error,kt=e.Function,Tt=e.Math,Et=e.Object,Mt=e.RegExp,Ct=e.String,At=e.TypeError,Nt=st.prototype,It=kt.prototype,$t=Et.prototype,Rt=e["__core-js_shared__"],Ot=It.toString,Pt=$t.hasOwnProperty,Lt=0,Dt=function(){var t=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ft=$t.toString,zt=Ot.call(Et),Bt=he._,Ut=Mt("^"+Ot.call(Pt).replace(nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=fe?e.Buffer:n,jt=e.Symbol,Wt=e.Uint8Array,Ht=Vt?Vt.allocUnsafe:n,Gt=an(Et.getPrototypeOf,Et),qt=Et.create,Xt=$t.propertyIsEnumerable,Yt=Nt.splice,Jt=jt?jt.isConcatSpreadable:n,te=jt?jt.iterator:n,oe=jt?jt.toStringTag:n,ce=function(){try{var t=ds(Et,"defineProperty");return t({},"",{}),t}catch(t){}}(),ue=e.clearTimeout!==he.clearTimeout&&e.clearTimeout,de=_t&&_t.now!==he.Date.now&&_t.now,pe=e.setTimeout!==he.setTimeout&&e.setTimeout,me=Tt.ceil,ge=Tt.floor,Le=Et.getOwnPropertySymbols,We=Vt?Vt.isBuffer:n,gn=e.isFinite,yn=Nt.join,bn=an(Et.keys,Et),vn=Tt.max,xn=Tt.min,wn=_t.now,_n=e.parseInt,Sn=Tt.random,kn=Nt.reverse,Tn=ds(e,"DataView"),En=ds(e,"Map"),Mn=ds(e,"Promise"),Cn=ds(e,"Set"),An=ds(e,"WeakMap"),Nn=ds(Et,"create"),In=An&&new An,$n={},Rn=zs(Tn),On=zs(En),Pn=zs(Mn),Ln=zs(Cn),Dn=zs(An),Fn=jt?jt.prototype:n,zn=Fn?Fn.valueOf:n,Bn=Fn?Fn.toString:n;function Un(t){if(ra(t)&&!Go(t)&&!(t instanceof Hn)){if(t instanceof Wn)return t;if(Pt.call(t,"__wrapped__"))return Bs(t)}return new Wn(t)}var Vn=function(){function t(){}return function(e){if(!na(e))return{};if(qt)return qt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Yn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Kn(t){var e=this.__data__=new qn(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Ho(t),i=!n&&!r&&Ko(t),s=!n&&!r&&!i&&ha(t),o=n||r||i||s,a=o?qe(t.length,Ct):[],l=a.length;for(var c in t)!e&&!Pt.call(t,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||vs(c,l))||a.push(c);return a}function Jn(t){var e=t.length;return e?t[Yr(0,e-1)]:n}function Qn(t,e){return Ls(Ni(t),lr(e,0,t.length))}function tr(t){return Ls(Ni(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];Pt.call(t,e)&&Vo(i,r)&&(r!==n||e in t)||or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ii(e,Ra(e),t)}function or(t,e,n){"__proto__"==e&&ce?ce(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=st(i),o=null==t;++r<i;)s[r]=o?n:Ca(t,e[r]);return s}function lr(t,e,r){return t==t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!na(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&Pt.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!l)return Ni(t,a)}else{var d=ms(t),p=d==w||d==_;if(Ko(t))return ki(t,l);if(d==T||d==g||p&&!s){if(a=c||p?{}:ys(t),!l)return c?function(t,e){return Ii(t,fs(t),e)}(t,function(t,e){return t&&Ii(e,Oa(e),t)}(a,t)):function(t,e){return Ii(t,ps(t),e)}(t,sr(a,t))}else{if(!se[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case $:return Ti(t);case b:case v:return new r(+t);case R:return function(t,e){var n=e?Ti(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case O:case P:case L:case D:case F:case z:case B:case U:case V:return Ei(t,n);case S:return new r;case k:case A:return new r(t);case M:return function(t){var e=new t.constructor(t.source,pt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case C:return new r;case N:return i=t,zn?Et(zn.call(i)):{}}var i}(t,d,l)}}o||(o=new Kn);var f=o.get(t);if(f)return f;o.set(t,a),la(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ia(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Oa:Ra)(t);return Te(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Et(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new At(r);return $s((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ae,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=Ie(e,Ye(n))),r?(s=Ne,o=!1):e.length>=200&&(s=Ze,o=!1,e=new Yn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h==h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Un.templateSettings={escape:K,evaluate:Z,interpolate:J,variable:"",imports:{_:Un}},Un.prototype=jn.prototype,Un.prototype.constructor=Un,Wn.prototype=Vn(jn.prototype),Wn.prototype.constructor=Wn,Hn.prototype=Vn(jn.prototype),Hn.prototype.constructor=Hn,Gn.prototype.clear=function(){this.__data__=Nn?Nn(null):{},this.size=0},Gn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Gn.prototype.get=function(t){var e=this.__data__;if(Nn){var r=e[t];return r===i?n:r}return Pt.call(e,t)?e[t]:n},Gn.prototype.has=function(t){var e=this.__data__;return Nn?e[t]!==n:Pt.call(e,t)},Gn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Nn&&e===n?i:e,this},qn.prototype.clear=function(){this.__data__=[],this.size=0},qn.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Yt.call(e,n,1),--this.size,!0)},qn.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},qn.prototype.has=function(t){return rr(this.__data__,t)>-1},qn.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new Gn,map:new(En||qn),string:new Gn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Yn.prototype.add=Yn.prototype.push=function(t){return this.__data__.set(t,i),this},Yn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.clear=function(){this.__data__=new qn,this.size=0},Kn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Kn.prototype.get=function(t){return this.__data__.get(t)},Kn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof qn){var r=n.__data__;if(!En||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(wr),fr=Oi(_r,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a==a&&!ua(a):r(a,l)))var l=a,c=o}return c}function yr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function br(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=bs),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?br(a,e-1,n,r,i):$e(i,a):r||(i[i.length]=a)}return i}var vr=Pi(),xr=Pi(!0);function wr(t,e){return t&&vr(t,e,Ra)}function _r(t,e){return t&&xr(t,e,Ra)}function Sr(t,e){return Ce(e,(function(e){return Qo(t[e])}))}function kr(t,e){for(var r=0,i=(e=xi(e,t)).length;null!=t&&r<i;)t=t[Fs(e[r++])];return r&&r==i?t:n}function Tr(t,e,n){var r=e(t);return Go(t)?r:$e(r,n(t))}function Er(t){return null==t?t===n?"[object Undefined]":"[object Null]":oe&&oe in Et(t)?function(t){var e=Pt.call(t,oe),r=t[oe];try{t[oe]=n;var i=!0}catch(t){}var s=Ft.call(t);i&&(e?t[oe]=r:delete t[oe]);return s}(t):function(t){return Ft.call(t)}(t)}function Mr(t,e){return t>e}function Cr(t,e){return null!=t&&Pt.call(t,e)}function Ar(t,e){return null!=t&&e in Et(t)}function Nr(t,e,r){for(var i=r?Ne:Ae,s=t[0].length,o=t.length,a=o,l=st(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=Ie(h,Ye(e))),c=xn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Yn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?Ze(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?Ze(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Ir(t,e,r){var i=null==(t=Cs(t,e=xi(e,t)))?t:t[Fs(Zs(e))];return null==i?n:Se(i,t,r)}function $r(t){return ra(t)&&Er(t)==g}function Rr(t,e,r,i,s){return t===e||(null==t||null==e||!ra(t)&&!ra(e)?t!=t&&e!=e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?y:ms(t),u=l?y:ms(e),h=(c=c==g?T:c)==T,d=(u=u==g?T:u)==T,p=c==u;if(p&&Ko(t)){if(!Ko(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Kn),a||ha(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case R:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $:return!(t.byteLength!=e.byteLength||!s(new Wt(t),new Wt(e)));case b:case v:case k:return Vo(+t,+e);case x:return t.name==e.name&&t.message==e.message;case M:case A:return t==e+"";case S:var a=on;case C:var l=1&r;if(a||(a=cn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case N:if(zn)return zn.call(t)==zn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&Pt.call(t,"__wrapped__"),m=d&&Pt.call(e,"__wrapped__");if(f||m){var w=f?t.value():t,_=m?e.value():e;return o||(o=new Kn),s(w,_,r,i,o)}}if(!p)return!1;return o||(o=new Kn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e).length;if(c!=u&&!a)return!1;var h=c;for(;h--;){var d=l[h];if(!(a?d in e:Pt.call(e,d)))return!1}var p=o.get(t),f=o.get(e);if(p&&f)return p==e&&f==t;var m=!0;o.set(t,e),o.set(e,t);var g=a;for(;++h<c;){var y=t[d=l[h]],b=e[d];if(i)var v=a?i(b,y,d,e,t,o):i(y,b,d,t,e,o);if(!(v===n?y===b||s(y,b,r,i,o):v)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,w=e.constructor;x==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w||(m=!1)}return o.delete(t),o.delete(e),m}(t,e,r,i,s,o)}(t,e,r,i,Rr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Et(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Kn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Rr(h,u,3,i,d):p))return!1}}return!0}function Pr(t){return!(!na(t)||function(t){return!!Dt&&Dt in t}(t))&&(Qo(t)?Ut:gt).test(zs(t))}function Lr(t){return"function"==typeof t?t:null==t?sl:"object"==typeof t?Go(t)?Vr(t[0],t[1]):Ur(t):fl(t)}function Dr(t){if(!ks(t))return bn(t);var e=[];for(var n in Et(t))Pt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Fr(t){if(!na(t))return function(t){var e=[];if(null!=t)for(var n in Et(t))e.push(n);return e}(t);var e=ks(t),n=[];for(var r in t)("constructor"!=r||!e&&Pt.call(t,r))&&n.push(r);return n}function zr(t,e){return t<e}function Br(t,e){var n=-1,r=Xo(t)?st(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Ur(t){var e=hs(t);return 1==e.length&&e[0][2]?Es(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Vr(t,e){return ws(t)&&Ts(e)?Es(Fs(t),e):function(r){var i=Ca(r,t);return i===n&&i===e?Aa(r,t):Rr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&vr(e,(function(o,a){if(s||(s=new Kn),na(o))!function(t,e,r,i,s,o,a){var l=Ns(t,r),c=Ns(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Ko(c),m=!p&&!f&&ha(c);h=c,p||f||m?Go(l)?h=l:Yo(l)?h=Ni(l):f?(d=!1,h=ki(c,!0)):m?(d=!1,h=Ei(c,!0)):h=[]:oa(c)||Ho(c)?(h=l,Ho(l)?h=va(l):na(l)&&!Qo(l)||(h=ys(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c));er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ns(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Oa)}function Wr(t,e){var r=t.length;if(r)return vs(e+=e<0?r:0,r)?t[e]:n}function Hr(t,e,n){e=e.length?Ie(e,(function(t){return Go(t)?function(e){return kr(e,1===t.length?t[0]:t)}:t})):[sl];var r=-1;e=Ie(e,Ye(cs()));var i=Br(t,(function(t,n,i){var s=Ie(e,(function(e){return e(t)}));return{criteria:s,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;for(;++r<o;){var l=Mi(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Gr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=kr(t,o);n(a,o)&&ti(s,xi(o,t),a)}return s}function qr(t,e,n,r){var i=r?Be:ze,s=-1,o=e.length,a=t;for(t===e&&(e=Ni(e)),n&&(a=Ie(t,Ye(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Yt.call(a,l,1),Yt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;vs(i)?Yt.call(t,i,1):di(t,i)}}return t}function Yr(t,e){return t+ge(Sn()*(e-t+1))}function Kr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Rs(Ms(t,e,sl),t+"")}function Jr(t){return Jn(Va(t))}function Qr(t,e){var n=Va(t);return Ls(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!na(t))return t;for(var s=-1,o=(e=xi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=Fs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=na(h)?h:vs(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=In?function(t,e){return In.set(t,e),t}:sl,ni=ce?function(t,e){return ce(t,"toString",{configurable:!0,enumerable:!1,value:nl(e),writable:!0})}:sl;function ri(t){return Ls(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=st(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ua(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,sl,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!=e,l=null===e,c=ua(e),u=e===n;s<o;){var h=ge((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,m=d==d,g=ua(d);if(a)var y=i||m;else y=u?m&&(i||p):l?m&&p&&(i||!f):c?m&&p&&!f&&(i||!g):!f&&!g&&(i?d<=e:d<e);y?s=h+1:o=h}return xn(o,4294967294)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ua(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return Ie(t,ui)+"";if(ua(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function hi(t,e,n){var r=-1,i=Ae,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Ne;else if(s>=200){var c=e?null:Ki(t);if(c)return cn(c);o=!1,i=Ze,l=new Yn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=xi(e,t)))||delete t[Fs(Zs(e))]}function pi(t,e,n,r){return ti(t,e,n(kr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Hn&&(n=n.value()),Re(e,(function(t,e){return e.func.apply(e.thisArg,$e([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=st(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(br(s,1),e,n)}function yi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function bi(t){return Yo(t)?t:[]}function vi(t){return"function"==typeof t?t:sl}function xi(t,e){return Go(t)?t:ws(t,e)?[t]:Ds(xa(t))}var wi=Zr;function _i(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return he.clearTimeout(t)};function ki(t,e){if(e)return t.slice();var n=t.length,r=Ht?Ht(n):new t.constructor(n);return t.copy(r),r}function Ti(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function Ei(t,e){var n=e?Ti(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Mi(t,e){if(t!==e){var r=t!==n,i=null===t,s=t==t,o=ua(t),a=e!==n,l=null===e,c=e==e,u=ua(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=vn(s-o,0),u=st(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Ai(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=vn(s-a,0),h=st(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ni(t,e){var n=-1,r=t.length;for(e||(e=st(r));++n<r;)e[n]=t[n];return e}function Ii(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function $i(t,e){return function(n,r){var i=Go(n)?ke:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ri(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&xs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Et(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!Xo(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Et(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Pi(t){return function(e,n,r){for(var i=-1,s=Et(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Li(t){return function(e){var r=sn(e=xa(e))?dn(e):n,i=r?r[0]:e.charAt(0),s=r?_i(r,1).join(""):e.slice(1);return i[t]()+s}}function Di(t){return function(e){return Re(Qa(Ha(e).replace(Kt,"")),t,"")}}function Fi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Vn(t.prototype),r=t.apply(n,e);return na(r)?r:n}}function zi(t){return function(e,r,i){var s=Et(e);if(!Xo(e)){var o=cs(r,3);e=Ra(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new At(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&_s(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&_s(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Ui(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,y=f?n:Fi(t);return function n(){for(var c=arguments.length,b=st(c),v=c;v--;)b[v]=arguments[v];if(m)var x=ls(n),w=tn(b,x);if(i&&(b=Ci(b,i,s,m)),o&&(b=Ai(b,o,a,m)),c-=w,m&&c<h){var _=ln(b,x);return Xi(t,e,Ui,n.placeholder,r,b,_,l,u,h-c)}var S=p?r:this,k=f?S[t]:t;return c=b.length,l?b=As(b,l):g&&c>1&&b.reverse(),d&&u<c&&(b.length=u),this&&this!==he&&this instanceof n&&(k=y||Fi(k)),k.apply(S,b)}}function Vi(t,e){return function(n,r){return function(t,e,n,r){return wr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=Ie(e,Ye(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Se(t,r,n)}))}))}))}function Hi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Kr(e,t):e;var i=Kr(e,me(t/hn(e)));return sn(e)?_i(dn(i),0,t).join(""):i.slice(0,t)}function Gi(t){return function(e,r,i){return i&&"number"!=typeof i&&xs(e,r,i)&&(r=i=n),e=ma(e),r===n?(r=e,e=0):r=ma(r),function(t,e,n,r){for(var i=-1,s=vn(me((e-t)/(n||1)),0),o=st(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:ma(i),t)}}function qi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=ba(e),n=ba(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return _s(t)&&Is(m,f),m.placeholder=i,Os(m,t,e)}function Yi(t){var e=Tt[t];return function(t,n){if(t=ba(t),(n=null==n?0:xn(ga(n),292))&&gn(t)){var r=(xa(t)+"e").split("e");return+((r=(xa(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Ki=Cn&&1/cn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:ul;function Zi(t){return function(e){var n=ms(e);return n==S?on(e):n==C?un(e):function(t,e){return Ie(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ji(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new At(r);var y=h?h.length:0;if(y||(e&=-97,h=d=n),f=f===n?f:vn(ga(f),0),m=m===n?m:ga(m),y-=d?d.length:0,e&l){var b=h,v=d;h=d=n}var x=g?n:os(t),w=[t,e,i,h,d,b,v,p,f,m];if(x&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?ln(t[3],s):e[4]}(l=e[5])&&(h=t[5],t[5]=h?Ai(h,l,e[6]):l,t[6]=h?ln(t[5],s):e[6]);(l=e[7])&&(t[7]=l);r&c&&(t[8]=null==t[8]?e[8]:xn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(w,x),t=w[0],e=w[1],i=w[2],h=w[3],d=w[4],!(m=w[9]=w[9]===n?g?0:t.length:vn(w[9]-y,0))&&24&e&&(e&=-25),e&&1!=e)_=8==e||e==o?function(t,e,r){var i=Fi(t);return function s(){for(var o=arguments.length,a=st(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:ln(a,c);return(o-=u.length)<r?Xi(t,e,Ui,s.placeholder,n,a,u,n,n,r-o):Se(this&&this!==he&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Ui.apply(n,w):function(t,e,n,r){var i=1&e,s=Fi(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=st(c+a),h=this&&this!==he&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Se(h,i?n:this,u)}}(t,e,i,h);else var _=function(t,e,n){var r=1&e,i=Fi(t);return function e(){return(this&&this!==he&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Os((x?ei:Is)(_,w),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,$t[r])&&!Pt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return na(t)&&na(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return oa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Yn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var y=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(y!==n){if(y)continue;p=!1;break}if(f){if(!Pe(e,(function(t,e){if(!Ze(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Rs(Ms(t,n,Gs),t+"")}function is(t){return Tr(t,Ra,ps)}function ss(t){return Tr(t,Oa,fs)}var os=In?function(t){return In.get(t)}:ul;function as(t){for(var e=t.name+"",n=$n[e],r=Pt.call($n,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(Pt.call(Un,"placeholder")?Un:t).placeholder}function cs(){var t=Un.iteratee||ol;return t=t===ol?Lr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function hs(t){for(var e=Ra(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ts(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return Pr(r)?r:n}var ps=Le?function(t){return null==t?[]:(t=Et(t),Ce(Le(t),(function(e){return Xt.call(t,e)})))}:yl,fs=Le?function(t){for(var e=[];t;)$e(e,ps(t)),t=Gt(t);return e}:yl,ms=Er;function gs(t,e,n){for(var r=-1,i=(e=xi(e,t)).length,s=!1;++r<i;){var o=Fs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ea(i)&&vs(o,i)&&(Go(t)||Ho(t))}function ys(t){return"function"!=typeof t.constructor||ks(t)?{}:Vn(Gt(t))}function bs(t){return Go(t)||Ho(t)||!!(Jt&&t&&t[Jt])}function vs(t,e){var n=typeof t;return!!(e=null==e?d:e)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function xs(t,e,n){if(!na(n))return!1;var r=typeof e;return!!("number"==r?Xo(n)&&vs(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function ws(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ua(t))||(tt.test(t)||!Q.test(t)||null!=e&&t in Et(e))}function _s(t){var e=as(t),n=Un[e];if("function"!=typeof n||!(e in Hn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(Tn&&ms(new Tn(new ArrayBuffer(1)))!=R||En&&ms(new En)!=S||Mn&&ms(Mn.resolve())!=E||Cn&&ms(new Cn)!=C||An&&ms(new An)!=I)&&(ms=function(t){var e=Er(t),r=e==T?t.constructor:n,i=r?zs(r):"";if(i)switch(i){case Rn:return R;case On:return S;case Pn:return E;case Ln:return C;case Dn:return I}return e});var Ss=Rt?Qo:bl;function ks(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$t)}function Ts(t){return t==t&&!na(t)}function Es(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Et(r)))}}function Ms(t,e,r){return e=vn(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=vn(n.length-e,0),o=st(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=st(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Se(t,this,a)}}function Cs(t,e){return e.length<2?t:kr(t,ii(e,0,-1))}function As(t,e){for(var r=t.length,i=xn(e.length,r),s=Ni(t);i--;){var o=e[i];t[i]=vs(o,r)?s[o]:n}return t}function Ns(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Ps(ei),$s=pe||function(t,e){return he.setTimeout(t,e)},Rs=Ps(ni);function Os(t,e,n){var r=e+"";return Rs(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(ot,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Te(m,(function(n){var r="_."+n[0];e&n[1]&&!Ae(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(at);return e?e[1].split(lt):[]}(r),n)))}function Ps(t){var e=0,r=0;return function(){var i=wn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function Ls(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Yr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=Lo(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,(function(t,n,r,i){e.push(r?i.replace(ht,"$1"):n||t)})),e}));function Fs(t){if("string"==typeof t||ua(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function zs(t){if(null!=t){try{return Ot.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Bs(t){if(t instanceof Hn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ni(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Us=Zr((function(t,e){return Yo(t)?dr(t,br(e,1,Yo,!0)):[]})),Vs=Zr((function(t,e){var r=Zs(e);return Yo(r)&&(r=n),Yo(t)?dr(t,br(e,1,Yo,!0),cs(r,2)):[]})),js=Zr((function(t,e){var r=Zs(e);return Yo(r)&&(r=n),Yo(t)?dr(t,br(e,1,Yo,!0),n,r):[]}));function Ws(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ga(n);return i<0&&(i=vn(r+i,0)),Fe(t,cs(e,3),i)}function Hs(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ga(r),s=r<0?vn(i+s,0):xn(s,i-1)),Fe(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?br(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var Xs=Zr((function(t){var e=Ie(t,bi);return e.length&&e[0]===t[0]?Nr(e):[]})),Ys=Zr((function(t){var e=Zs(t),r=Ie(t,bi);return e===Zs(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Nr(r,cs(e,2)):[]})),Ks=Zr((function(t){var e=Zs(t),r=Ie(t,bi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Nr(r,n,e):[]}));function Zs(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Js=Zr(Qs);function Qs(t,e){return t&&t.length&&e&&e.length?qr(t,e):t}var to=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,Ie(e,(function(t){return vs(t,n)?+t:t})).sort(Mi)),r}));function eo(t){return null==t?t:kn.call(t)}var no=Zr((function(t){return hi(br(t,1,Yo,!0))})),ro=Zr((function(t){var e=Zs(t);return Yo(e)&&(e=n),hi(br(t,1,Yo,!0),cs(e,2))})),io=Zr((function(t){var e=Zs(t);return e="function"==typeof e?e:n,hi(br(t,1,Yo,!0),n,e)}));function so(t){if(!t||!t.length)return[];var e=0;return t=Ce(t,(function(t){if(Yo(t))return e=vn(t.length,e),!0})),qe(e,(function(e){return Ie(t,je(e))}))}function oo(t,e){if(!t||!t.length)return[];var r=so(t);return null==e?r:Ie(r,(function(t){return Se(e,n,t)}))}var ao=Zr((function(t,e){return Yo(t)?dr(t,e):[]})),lo=Zr((function(t){return gi(Ce(t,Yo))})),co=Zr((function(t){var e=Zs(t);return Yo(e)&&(e=n),gi(Ce(t,Yo),cs(e,2))})),uo=Zr((function(t){var e=Zs(t);return e="function"==typeof e?e:n,gi(Ce(t,Yo),n,e)})),ho=Zr(so);var po=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,oo(t,r)}));function fo(t){var e=Un(t);return e.__chain__=!0,e}function mo(t,e){return e(t)}var go=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Hn&&vs(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:mo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var yo=$i((function(t,e,n){Pt.call(t,n)?++t[n]:or(t,n,1)}));var bo=zi(Ws),vo=zi(Hs);function xo(t,e){return(Go(t)?Te:pr)(t,cs(e,3))}function wo(t,e){return(Go(t)?Ee:fr)(t,cs(e,3))}var _o=$i((function(t,e,n){Pt.call(t,n)?t[n].push(e):or(t,n,[e])}));var So=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=Xo(t)?st(t.length):[];return pr(t,(function(t){s[++r]=i?Se(e,t,n):Ir(t,e,n)})),s})),ko=$i((function(t,e,n){or(t,n,e)}));function To(t,e){return(Go(t)?Ie:Br)(t,cs(e,3))}var Eo=$i((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Mo=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&xs(t,e[0],e[1])?e=[]:n>2&&xs(e[0],e[1],e[2])&&(e=[e[0]]),Hr(t,br(e,1),[])})),Co=de||function(){return he.Date.now()};function Ao(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ji(t,c,n,n,n,n,e)}function No(t,e){var i;if("function"!=typeof e)throw new At(r);return t=ga(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=ln(n,ls(Io));r|=a}return Ji(t,r,e,n,i)})),$o=Zr((function(t,e,n){var r=3;if(n.length){var i=ln(n,ls($o));r|=a}return Ji(e,r,t,n,i)}));function Ro(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new At(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){return h=t,c=$s(b,e),d?m(t):l}function y(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function b(){var t=Co();if(y(t))return v(t);c=$s(b,function(t){var n=e-(t-u);return p?xn(n,a-(t-h)):n}(t))}function v(t){return c=n,f&&s?m(t):(s=o=n,l)}function x(){var t=Co(),r=y(t);if(s=arguments,o=this,u=t,r){if(c===n)return g(u);if(p)return Si(c),c=$s(b,e),m(u)}return c===n&&(c=$s(b,e)),l}return e=ba(e)||0,na(i)&&(d=!!i.leading,a=(p="maxWait"in i)?vn(ba(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),x.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},x.flush=function(){return c===n?l:v(Co())},x}var Oo=Zr((function(t,e){return hr(t,1,e)})),Po=Zr((function(t,e,n){return hr(t,ba(e)||0,n)}));function Lo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new At(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Lo.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new At(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Lo.Cache=Xn;var Fo=wi((function(t,e){var n=(e=1==e.length&&Go(e[0])?Ie(e[0],Ye(cs())):Ie(br(e,1),Ye(cs()))).length;return Zr((function(r){for(var i=-1,s=xn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Se(t,this,r)}))})),zo=Zr((function(t,e){var r=ln(e,ls(zo));return Ji(t,a,n,e,r)})),Bo=Zr((function(t,e){var r=ln(e,ls(Bo));return Ji(t,l,n,e,r)})),Uo=rs((function(t,e){return Ji(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!=t&&e!=e}var jo=qi(Mr),Wo=qi((function(t,e){return t>=e})),Ho=$r(function(){return arguments}())?$r:function(t){return ra(t)&&Pt.call(t,"callee")&&!Xt.call(t,"callee")},Go=st.isArray,qo=ye?Ye(ye):function(t){return ra(t)&&Er(t)==$};function Xo(t){return null!=t&&ea(t.length)&&!Qo(t)}function Yo(t){return ra(t)&&Xo(t)}var Ko=We||bl,Zo=be?Ye(be):function(t){return ra(t)&&Er(t)==v};function Jo(t){if(!ra(t))return!1;var e=Er(t);return e==x||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!oa(t)}function Qo(t){if(!na(t))return!1;var e=Er(t);return e==w||e==_||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ta(t){return"number"==typeof t&&t==ga(t)}function ea(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function na(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ra(t){return null!=t&&"object"==typeof t}var ia=ve?Ye(ve):function(t){return ra(t)&&ms(t)==S};function sa(t){return"number"==typeof t||ra(t)&&Er(t)==k}function oa(t){if(!ra(t)||Er(t)!=T)return!1;var e=Gt(t);if(null===e)return!0;var n=Pt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Ot.call(n)==zt}var aa=xe?Ye(xe):function(t){return ra(t)&&Er(t)==M};var la=we?Ye(we):function(t){return ra(t)&&ms(t)==C};function ca(t){return"string"==typeof t||!Go(t)&&ra(t)&&Er(t)==A}function ua(t){return"symbol"==typeof t||ra(t)&&Er(t)==N}var ha=_e?Ye(_e):function(t){return ra(t)&&ea(t.length)&&!!ie[Er(t)]};var da=qi(zr),pa=qi((function(t,e){return t<=e}));function fa(t){if(!t)return[];if(Xo(t))return ca(t)?dn(t):Ni(t);if(te&&t[te])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[te]());var e=ms(t);return(e==S?on:e==C?cn:Va)(t)}function ma(t){return t?(t=ba(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ga(t){var e=ma(t),n=e%1;return e==e?n?e-n:e:0}function ya(t){return t?lr(ga(t),0,f):0}function ba(t){if("number"==typeof t)return t;if(ua(t))return p;if(na(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=na(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Xe(t);var n=mt.test(t);return n||yt.test(t)?le(t.slice(2),n?2:8):ft.test(t)?p:+t}function va(t){return Ii(t,Oa(t))}function xa(t){return null==t?"":ui(t)}var wa=Ri((function(t,e){if(ks(e)||Xo(e))Ii(e,Ra(e),t);else for(var n in e)Pt.call(e,n)&&nr(t,n,e[n])})),_a=Ri((function(t,e){Ii(e,Oa(e),t)})),Sa=Ri((function(t,e,n,r){Ii(e,Oa(e),t,r)})),ka=Ri((function(t,e,n,r){Ii(e,Ra(e),t,r)})),Ta=rs(ar);var Ea=Zr((function(t,e){t=Et(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&xs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Oa(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,$t[u])&&!Pt.call(t,u))&&(t[u]=o[u])}return t})),Ma=Zr((function(t){return t.push(n,ts),Se(La,n,t)}));function Ca(t,e,r){var i=null==t?n:kr(t,e);return i===n?r:i}function Aa(t,e){return null!=t&&gs(t,e,Ar)}var Na=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ft.call(e)),t[e]=n}),nl(sl)),Ia=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ft.call(e)),Pt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),$a=Zr(Ir);function Ra(t){return Xo(t)?Zn(t):Dr(t)}function Oa(t){return Xo(t)?Zn(t,!0):Fr(t)}var Pa=Ri((function(t,e,n){jr(t,e,n)})),La=Ri((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=Ie(e,(function(e){return e=xi(e,t),r||(r=e.length>1),e})),Ii(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var Fa=rs((function(t,e){return null==t?{}:function(t,e){return Gr(t,e,(function(e,n){return Aa(t,n)}))}(t,e)}));function za(t,e){if(null==t)return{};var n=Ie(ss(t),(function(t){return[t]}));return e=cs(e),Gr(t,n,(function(t,n){return e(t,n[0])}))}var Ba=Zi(Ra),Ua=Zi(Oa);function Va(t){return null==t?[]:Ke(t,Ra(t))}var ja=Di((function(t,e,n){return e=e.toLowerCase(),t+(n?Wa(e):e)}));function Wa(t){return Ja(xa(t).toLowerCase())}function Ha(t){return(t=xa(t))&&t.replace(vt,en).replace(Zt,"")}var Ga=Di((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=Di((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Xa=Li("toLowerCase");var Ya=Di((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ka=Di((function(t,e,n){return t+(n?" ":"")+Ja(e)}));var Za=Di((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Ja=Li("toUpperCase");function Qa(t,e,r){return t=xa(t),(e=r?n:e)===n?function(t){return ee.test(t)}(t)?function(t){return t.match(Qt)||[]}(t):function(t){return t.match(ct)||[]}(t):t.match(e)||[]}var tl=Zr((function(t,e){try{return Se(t,n,e)}catch(t){return Jo(t)?t:new St(t)}})),el=rs((function(t,e){return Te(e,(function(e){e=Fs(e),or(t,e,Io(t[e],t))})),t}));function nl(t){return function(){return t}}var rl=Bi(),il=Bi(!0);function sl(t){return t}function ol(t){return Lr("function"==typeof t?t:cr(t,1))}var al=Zr((function(t,e){return function(n){return Ir(n,t,e)}})),ll=Zr((function(t,e){return function(n){return Ir(t,n,e)}}));function cl(t,e,n){var r=Ra(e),i=Sr(e,r);null!=n||na(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Sr(e,Ra(e)));var s=!(na(n)&&"chain"in n&&!n.chain),o=Qo(t);return Te(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__),i=n.__actions__=Ni(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,$e([this.value()],arguments))})})),t}function ul(){}var hl=Wi(Ie),dl=Wi(Me),pl=Wi(Pe);function fl(t){return ws(t)?je(Fs(t)):function(t){return function(e){return kr(e,t)}}(t)}var ml=Gi(),gl=Gi(!0);function yl(){return[]}function bl(){return!1}var vl=ji((function(t,e){return t+e}),0),xl=Yi("ceil"),wl=ji((function(t,e){return t/e}),1),_l=Yi("floor");var Sl,kl=ji((function(t,e){return t*e}),1),Tl=Yi("round"),El=ji((function(t,e){return t-e}),0);return Un.after=function(t,e){if("function"!=typeof e)throw new At(r);return t=ga(t),function(){if(--t<1)return e.apply(this,arguments)}},Un.ary=Ao,Un.assign=wa,Un.assignIn=_a,Un.assignInWith=Sa,Un.assignWith=ka,Un.at=Ta,Un.before=No,Un.bind=Io,Un.bindAll=el,Un.bindKey=$o,Un.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Un.chain=fo,Un.chunk=function(t,e,r){e=(r?xs(t,e,r):e===n)?1:vn(ga(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=st(me(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Un.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Un.concat=function(){var t=arguments.length;if(!t)return[];for(var e=st(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return $e(Go(n)?Ni(n):[n],br(e,1))},Un.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?Ie(t,(function(t){if("function"!=typeof t[1])throw new At(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Se(i[0],this,n))return Se(i[1],this,n)}}))},Un.conforms=function(t){return function(t){var e=Ra(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Un.constant=nl,Un.countBy=yo,Un.create=function(t,e){var n=Vn(t);return null==e?n:sr(n,e)},Un.curry=function t(e,r,i){var s=Ji(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Un.curryRight=function t(e,r,i){var s=Ji(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Un.debounce=Ro,Un.defaults=Ea,Un.defaultsDeep=Ma,Un.defer=Oo,Un.delay=Po,Un.difference=Us,Un.differenceBy=Vs,Un.differenceWith=js,Un.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ga(e))<0?0:e,i):[]},Un.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ga(e)))<0?0:e):[]},Un.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Un.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Un.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&xs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ga(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ga(i))<0&&(i+=s),i=r>i?0:ya(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Un.filter=function(t,e){return(Go(t)?Ce:yr)(t,cs(e,3))},Un.flatMap=function(t,e){return br(To(t,e),1)},Un.flatMapDeep=function(t,e){return br(To(t,e),h)},Un.flatMapDepth=function(t,e,r){return r=r===n?1:ga(r),br(To(t,e),r)},Un.flatten=Gs,Un.flattenDeep=function(t){return(null==t?0:t.length)?br(t,h):[]},Un.flattenDepth=function(t,e){return(null==t?0:t.length)?br(t,e=e===n?1:ga(e)):[]},Un.flip=function(t){return Ji(t,512)},Un.flow=rl,Un.flowRight=il,Un.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Un.functions=function(t){return null==t?[]:Sr(t,Ra(t))},Un.functionsIn=function(t){return null==t?[]:Sr(t,Oa(t))},Un.groupBy=_o,Un.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Un.intersection=Xs,Un.intersectionBy=Ys,Un.intersectionWith=Ks,Un.invert=Na,Un.invertBy=Ia,Un.invokeMap=So,Un.iteratee=ol,Un.keyBy=ko,Un.keys=Ra,Un.keysIn=Oa,Un.map=To,Un.mapKeys=function(t,e){var n={};return e=cs(e,3),wr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Un.mapValues=function(t,e){var n={};return e=cs(e,3),wr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Un.matches=function(t){return Ur(cr(t,1))},Un.matchesProperty=function(t,e){return Vr(t,cr(e,1))},Un.memoize=Lo,Un.merge=Pa,Un.mergeWith=La,Un.method=al,Un.methodOf=ll,Un.mixin=cl,Un.negate=Do,Un.nthArg=function(t){return t=ga(t),Zr((function(e){return Wr(e,t)}))},Un.omit=Da,Un.omitBy=function(t,e){return za(t,Do(cs(e)))},Un.once=function(t){return No(2,t)},Un.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Hr(t,e,r))},Un.over=hl,Un.overArgs=Fo,Un.overEvery=dl,Un.overSome=pl,Un.partial=zo,Un.partialRight=Bo,Un.partition=Eo,Un.pick=Fa,Un.pickBy=za,Un.property=fl,Un.propertyOf=function(t){return function(e){return null==t?n:kr(t,e)}},Un.pull=Js,Un.pullAll=Qs,Un.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?qr(t,e,cs(n,2)):t},Un.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?qr(t,e,n,r):t},Un.pullAt=to,Un.range=ml,Un.rangeRight=gl,Un.rearg=Uo,Un.reject=function(t,e){return(Go(t)?Ce:yr)(t,Do(cs(e,3)))},Un.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Un.rest=function(t,e){if("function"!=typeof t)throw new At(r);return Zr(t,e=e===n?e:ga(e))},Un.reverse=eo,Un.sampleSize=function(t,e,r){return e=(r?xs(t,e,r):e===n)?1:ga(e),(Go(t)?Qn:Qr)(t,e)},Un.set=function(t,e,n){return null==t?t:ti(t,e,n)},Un.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Un.shuffle=function(t){return(Go(t)?tr:ri)(t)},Un.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&xs(t,e,r)?(e=0,r=i):(e=null==e?0:ga(e),r=r===n?i:ga(r)),ii(t,e,r)):[]},Un.sortBy=Mo,Un.sortedUniq=function(t){return t&&t.length?li(t):[]},Un.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Un.split=function(t,e,r){return r&&"number"!=typeof r&&xs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=xa(t))&&("string"==typeof e||null!=e&&!aa(e))&&!(e=ui(e))&&sn(t)?_i(dn(t),0,r):t.split(e,r):[]},Un.spread=function(t,e){if("function"!=typeof t)throw new At(r);return e=null==e?0:vn(ga(e),0),Zr((function(n){var r=n[e],i=_i(n,0,e);return r&&$e(i,r),Se(t,this,i)}))},Un.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Un.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ga(e))<0?0:e):[]},Un.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ga(e)))<0?0:e,i):[]},Un.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Un.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Un.tap=function(t,e){return e(t),t},Un.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new At(r);return na(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Ro(t,e,{leading:i,maxWait:e,trailing:s})},Un.thru=mo,Un.toArray=fa,Un.toPairs=Ba,Un.toPairsIn=Ua,Un.toPath=function(t){return Go(t)?Ie(t,Fs):ua(t)?[t]:Ni(Ds(xa(t)))},Un.toPlainObject=va,Un.transform=function(t,e,n){var r=Go(t),i=r||Ko(t)||ha(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:na(t)&&Qo(s)?Vn(Gt(t)):{}}return(i?Te:wr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Un.unary=function(t){return Ao(t,1)},Un.union=no,Un.unionBy=ro,Un.unionWith=io,Un.uniq=function(t){return t&&t.length?hi(t):[]},Un.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Un.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Un.unset=function(t,e){return null==t||di(t,e)},Un.unzip=so,Un.unzipWith=oo,Un.update=function(t,e,n){return null==t?t:pi(t,e,vi(n))},Un.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,vi(r),i)},Un.values=Va,Un.valuesIn=function(t){return null==t?[]:Ke(t,Oa(t))},Un.without=ao,Un.words=Qa,Un.wrap=function(t,e){return zo(vi(e),t)},Un.xor=lo,Un.xorBy=co,Un.xorWith=uo,Un.zip=ho,Un.zipObject=function(t,e){return yi(t||[],e||[],nr)},Un.zipObjectDeep=function(t,e){return yi(t||[],e||[],ti)},Un.zipWith=po,Un.entries=Ba,Un.entriesIn=Ua,Un.extend=_a,Un.extendWith=Sa,cl(Un,Un),Un.add=vl,Un.attempt=tl,Un.camelCase=ja,Un.capitalize=Wa,Un.ceil=xl,Un.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=ba(r))==r?r:0),e!==n&&(e=(e=ba(e))==e?e:0),lr(ba(t),e,r)},Un.clone=function(t){return cr(t,4)},Un.cloneDeep=function(t){return cr(t,5)},Un.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Un.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Un.conformsTo=function(t,e){return null==e||ur(t,e,Ra(e))},Un.deburr=Ha,Un.defaultTo=function(t,e){return null==t||t!=t?e:t},Un.divide=wl,Un.endsWith=function(t,e,r){t=xa(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ga(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Un.eq=Vo,Un.escape=function(t){return(t=xa(t))&&Y.test(t)?t.replace(q,nn):t},Un.escapeRegExp=function(t){return(t=xa(t))&&rt.test(t)?t.replace(nt,"\\$&"):t},Un.every=function(t,e,r){var i=Go(t)?Me:mr;return r&&xs(t,e,r)&&(e=n),i(t,cs(e,3))},Un.find=bo,Un.findIndex=Ws,Un.findKey=function(t,e){return De(t,cs(e,3),wr)},Un.findLast=vo,Un.findLastIndex=Hs,Un.findLastKey=function(t,e){return De(t,cs(e,3),_r)},Un.floor=_l,Un.forEach=xo,Un.forEachRight=wo,Un.forIn=function(t,e){return null==t?t:vr(t,cs(e,3),Oa)},Un.forInRight=function(t,e){return null==t?t:xr(t,cs(e,3),Oa)},Un.forOwn=function(t,e){return t&&wr(t,cs(e,3))},Un.forOwnRight=function(t,e){return t&&_r(t,cs(e,3))},Un.get=Ca,Un.gt=jo,Un.gte=Wo,Un.has=function(t,e){return null!=t&&gs(t,e,Cr)},Un.hasIn=Aa,Un.head=qs,Un.identity=sl,Un.includes=function(t,e,n,r){t=Xo(t)?t:Va(t),n=n&&!r?ga(n):0;var i=t.length;return n<0&&(n=vn(i+n,0)),ca(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&ze(t,e,n)>-1},Un.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ga(n);return i<0&&(i=vn(r+i,0)),ze(t,e,i)},Un.inRange=function(t,e,r){return e=ma(e),r===n?(r=e,e=0):r=ma(r),function(t,e,n){return t>=xn(e,n)&&t<vn(e,n)}(t=ba(t),e,r)},Un.invoke=$a,Un.isArguments=Ho,Un.isArray=Go,Un.isArrayBuffer=qo,Un.isArrayLike=Xo,Un.isArrayLikeObject=Yo,Un.isBoolean=function(t){return!0===t||!1===t||ra(t)&&Er(t)==b},Un.isBuffer=Ko,Un.isDate=Zo,Un.isElement=function(t){return ra(t)&&1===t.nodeType&&!oa(t)},Un.isEmpty=function(t){if(null==t)return!0;if(Xo(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Ko(t)||ha(t)||Ho(t)))return!t.length;var e=ms(t);if(e==S||e==C)return!t.size;if(ks(t))return!Dr(t).length;for(var n in t)if(Pt.call(t,n))return!1;return!0},Un.isEqual=function(t,e){return Rr(t,e)},Un.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Rr(t,e,n,r):!!i},Un.isError=Jo,Un.isFinite=function(t){return"number"==typeof t&&gn(t)},Un.isFunction=Qo,Un.isInteger=ta,Un.isLength=ea,Un.isMap=ia,Un.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Un.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Un.isNaN=function(t){return sa(t)&&t!=+t},Un.isNative=function(t){if(Ss(t))throw new St("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Pr(t)},Un.isNil=function(t){return null==t},Un.isNull=function(t){return null===t},Un.isNumber=sa,Un.isObject=na,Un.isObjectLike=ra,Un.isPlainObject=oa,Un.isRegExp=aa,Un.isSafeInteger=function(t){return ta(t)&&t>=-9007199254740991&&t<=d},Un.isSet=la,Un.isString=ca,Un.isSymbol=ua,Un.isTypedArray=ha,Un.isUndefined=function(t){return t===n},Un.isWeakMap=function(t){return ra(t)&&ms(t)==I},Un.isWeakSet=function(t){return ra(t)&&"[object WeakSet]"==Er(t)},Un.join=function(t,e){return null==t?"":yn.call(t,e)},Un.kebabCase=Ga,Un.last=Zs,Un.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ga(r))<0?vn(i+s,0):xn(s,i-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):Fe(t,Ue,s,!0)},Un.lowerCase=qa,Un.lowerFirst=Xa,Un.lt=da,Un.lte=pa,Un.max=function(t){return t&&t.length?gr(t,sl,Mr):n},Un.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Mr):n},Un.mean=function(t){return Ve(t,sl)},Un.meanBy=function(t,e){return Ve(t,cs(e,2))},Un.min=function(t){return t&&t.length?gr(t,sl,zr):n},Un.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),zr):n},Un.stubArray=yl,Un.stubFalse=bl,Un.stubObject=function(){return{}},Un.stubString=function(){return""},Un.stubTrue=function(){return!0},Un.multiply=kl,Un.nth=function(t,e){return t&&t.length?Wr(t,ga(e)):n},Un.noConflict=function(){return he._===this&&(he._=Bt),this},Un.noop=ul,Un.now=Co,Un.pad=function(t,e,n){t=xa(t);var r=(e=ga(e))?hn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Hi(ge(i),n)+t+Hi(me(i),n)},Un.padEnd=function(t,e,n){t=xa(t);var r=(e=ga(e))?hn(t):0;return e&&r<e?t+Hi(e-r,n):t},Un.padStart=function(t,e,n){t=xa(t);var r=(e=ga(e))?hn(t):0;return e&&r<e?Hi(e-r,n)+t:t},Un.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),_n(xa(t).replace(it,""),e||0)},Un.random=function(t,e,r){if(r&&"boolean"!=typeof r&&xs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=ma(t),e===n?(e=t,t=0):e=ma(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return xn(t+s*(e-t+ae("1e-"+((s+"").length-1))),e)}return Yr(t,e)},Un.reduce=function(t,e,n){var r=Go(t)?Re:He,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Un.reduceRight=function(t,e,n){var r=Go(t)?Oe:He,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Un.repeat=function(t,e,r){return e=(r?xs(t,e,r):e===n)?1:ga(e),Kr(xa(t),e)},Un.replace=function(){var t=arguments,e=xa(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Un.result=function(t,e,r){var i=-1,s=(e=xi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[Fs(e[i])];o===n&&(i=s,o=r),t=Qo(o)?o.call(t):o}return t},Un.round=Tl,Un.runInContext=t,Un.sample=function(t){return(Go(t)?Jn:Jr)(t)},Un.size=function(t){if(null==t)return 0;if(Xo(t))return ca(t)?hn(t):t.length;var e=ms(t);return e==S||e==C?t.size:Dr(t).length},Un.snakeCase=Ya,Un.some=function(t,e,r){var i=Go(t)?Pe:si;return r&&xs(t,e,r)&&(e=n),i(t,cs(e,3))},Un.sortedIndex=function(t,e){return oi(t,e)},Un.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Un.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Un.sortedLastIndex=function(t,e){return oi(t,e,!0)},Un.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Un.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Un.startCase=Ka,Un.startsWith=function(t,e,n){return t=xa(t),n=null==n?0:lr(ga(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Un.subtract=El,Un.sum=function(t){return t&&t.length?Ge(t,sl):0},Un.sumBy=function(t,e){return t&&t.length?Ge(t,cs(e,2)):0},Un.template=function(t,e,r){var i=Un.templateSettings;r&&xs(t,e,r)&&(e=n),t=xa(t),e=Sa({},e,i,Qi);var s,o,a=Sa({},e.imports,i.imports,Qi),l=Ra(a),c=Ke(a,l),u=0,h=e.interpolate||xt,d="__p += '",p=Mt((e.escape||xt).source+"|"+h.source+"|"+(h===J?dt:xt).source+"|"+(e.evaluate||xt).source+"|$","g"),f="//# sourceURL="+(Pt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++re+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(wt,rn),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=Pt.call(e,"variable")&&e.variable;if(m){if(ut.test(m))throw new St("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(j,""):d).replace(W,"$1").replace(H,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=tl((function(){return kt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Jo(g))throw g;return g},Un.times=function(t,e){if((t=ga(t))<1||t>d)return[];var n=f,r=xn(t,f);e=cs(e),t-=f;for(var i=qe(r,e);++n<t;)e(n);return i},Un.toFinite=ma,Un.toInteger=ga,Un.toLength=ya,Un.toLower=function(t){return xa(t).toLowerCase()},Un.toNumber=ba,Un.toSafeInteger=function(t){return t?lr(ga(t),-9007199254740991,d):0===t?t:0},Un.toString=xa,Un.toUpper=function(t){return xa(t).toUpperCase()},Un.trim=function(t,e,r){if((t=xa(t))&&(r||e===n))return Xe(t);if(!t||!(e=ui(e)))return t;var i=dn(t),s=dn(e);return _i(i,Je(i,s),Qe(i,s)+1).join("")},Un.trimEnd=function(t,e,r){if((t=xa(t))&&(r||e===n))return t.slice(0,pn(t)+1);if(!t||!(e=ui(e)))return t;var i=dn(t);return _i(i,0,Qe(i,dn(e))+1).join("")},Un.trimStart=function(t,e,r){if((t=xa(t))&&(r||e===n))return t.replace(it,"");if(!t||!(e=ui(e)))return t;var i=dn(t);return _i(i,Je(i,dn(e))).join("")},Un.truncate=function(t,e){var r=30,i="...";if(na(e)){var s="separator"in e?e.separator:s;r="length"in e?ga(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=xa(t)).length;if(sn(t)){var a=dn(t);o=a.length}if(r>=o)return t;var l=r-hn(i);if(l<1)return i;var c=a?_i(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),aa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Mt(s.source,xa(pt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Un.unescape=function(t){return(t=xa(t))&&X.test(t)?t.replace(G,fn):t},Un.uniqueId=function(t){var e=++Lt;return xa(t)+e},Un.upperCase=Za,Un.upperFirst=Ja,Un.each=xo,Un.eachRight=wo,Un.first=qs,cl(Un,(Sl={},wr(Un,(function(t,e){Pt.call(Un.prototype,e)||(Sl[e]=t)})),Sl),{chain:!1}),Un.VERSION="4.17.21",Te(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Un[t].placeholder=Un})),Te(["drop","take"],(function(t,e){Hn.prototype[t]=function(r){r=r===n?1:vn(ga(r),0);var i=this.__filtered__&&!e?new Hn(this):this.clone();return i.__filtered__?i.__takeCount__=xn(r,i.__takeCount__):i.__views__.push({size:xn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Hn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Te(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Hn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Te(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Hn.prototype[t]=function(){return this[n](1).value()[0]}})),Te(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Hn.prototype[t]=function(){return this.__filtered__?new Hn(this):this[n](1)}})),Hn.prototype.compact=function(){return this.filter(sl)},Hn.prototype.find=function(t){return this.filter(t).head()},Hn.prototype.findLast=function(t){return this.reverse().find(t)},Hn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Hn(this):this.map((function(n){return Ir(n,t,e)}))})),Hn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Hn.prototype.slice=function(t,e){t=ga(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Hn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ga(e))<0?r.dropRight(-e):r.take(e-t)),r)},Hn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Hn.prototype.toArray=function(){return this.take(f)},wr(Hn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Un[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Un.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Hn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Un,$e([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Hn(this);var g=t.apply(e,a);return g.__actions__.push({func:mo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Te(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Nt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Un.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),wr(Hn.prototype,(function(t,e){var n=Un[e];if(n){var r=n.name+"";Pt.call($n,r)||($n[r]=[]),$n[r].push({name:e,func:n})}})),$n[Ui(n,2).name]=[{name:"wrapper",func:n}],Hn.prototype.clone=function(){var t=new Hn(this.__wrapped__);return t.__actions__=Ni(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ni(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ni(this.__views__),t},Hn.prototype.reverse=function(){if(this.__filtered__){var t=new Hn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Hn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=xn(e,t+o);break;case"takeRight":t=vn(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=xn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var y=u[m],b=y.iteratee,v=y.type,x=b(g);if(2==v)g=x;else if(!x){if(1==v)continue t;break t}}f[d++]=g}return f},Un.prototype.at=go,Un.prototype.chain=function(){return fo(this)},Un.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Un.prototype.next=function(){this.__values__===n&&(this.__values__=fa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Un.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Bs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Un.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Hn){var e=t;return this.__actions__.length&&(e=new Hn(this)),(e=e.reverse()).__actions__.push({func:mo,args:[eo],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(eo)},Un.prototype.toJSON=Un.prototype.valueOf=Un.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Un.prototype.first=Un.prototype.head,te&&(Un.prototype[te]=function(){return this}),Un}();pe?((pe.exports=mn)._=mn,de._=mn):he._=mn}).call(vr)}(yJ,yJ.exports);class bJ extends cG{constructor(t,e={}){super((async function*(){const n={query:{},skip:0,take:-1,...e},r=n.take;let i=0,s=[];const o={...n.query,$skip:n.skip,$limit:10};for(;;)try{if(r>0&&i>=r)return;if(i++,s.length>0){const t=s.shift();yield t}else{const e=await t.find({query:o});if(o.$skip=e.skip+e.limit,s=e.data,!(s.length>0))return;{const t=s.shift();yield t}}}catch(t){throw t.message=`Error thrown while iterating through a service: ${t.message}`,t}})),this.service=t,this.params={query:{},skip:0,take:-1,...e}}skip(t){return new bJ(this.service,{...this.params,skip:t})}take(t){return new bJ(this.service,{...this.params,take:t})}select(t){const e=yJ.exports.cloneDeep(this.params);return e.query.$select=t,new bJ(this.service,e)}query(t){return new bJ(this.service,dG(this.params,{query:t}))}}function vJ(t){return new bJ(t)}!function(t){t[t.Memory=0]="Memory",t[t.LocalStorage=1]="LocalStorage",t[t.Remote=2]="Remote"}(gJ||(gJ={}));class xJ{constructor(t="memory"){if(this.requiresAuth=!1,this.apiPrefix="",this.$services=new JH([],!0),hJ.set(this,void 0),dJ.set(this,void 0),pJ.set(this,Promise.resolve()),fJ.set(this,!1),mJ.set(this,XH),this.feathers=eK.exports(),this.location=t,function(t){try{new URL(t)}catch(t){return!1}return!0}(t)){this.backend=gJ.Remote;const e=new URL(t),n=e.host;this.apiPrefix=e.pathname.replace(/\/$/,"");const r=cY(n,{transports:["websocket"],reconnectionAttempts:5,path:this.apiPrefix+"/socket.io"});this.feathers.configure(PK.exports(r,{timeout:15e3})),BH(this,hJ,new Promise((t=>{this.feathers.io.on("init",(({auth:e})=>{this.requiresAuth=e,e&&this.feathers.configure(tK({path:`${this.apiPrefix}/authentication`})),t()}))})),"f")}else if("localStorage"===t){this.backend=gJ.LocalStorage;const t=t=>RZ.exports({storage:window.localStorage,name:t,id:"_id",multi:!0,paginate:{default:100,max:200}});BH(this,mJ,(e=>{this.feathers.use(`/${e}`,t(e))}),"f")}else{if("memory"!==t)throw new Error(`Cannot process backend location '${t}'`);this.backend=gJ.Memory,BH(this,mJ,(t=>{this.feathers.use(`/${t}`,GK.exports({id:"_id",paginate:{default:100,max:200}}))}),"f")}this.setupAppHooks()}async connect(){return this.backend!==gJ.Remote?{email:null}:(zH(this,dJ,"f")||(eG.log(`Connecting to backend ${this.location}...`),BH(this,dJ,new Promise(((t,e)=>{this.feathers.io.on("connect",(()=>{eG.log(`Connected to backend ${this.location}!`),t()})),this.feathers.io.on("reconnect_failed",(()=>{const t=new Error(`Cannot reach backend at location ${this.location}. Is the server running?\n          If using locally, run 'npm run backend'`);t.name="DataStore connection error",e(),sG(t,{duration:0})}))})),"f")),await zH(this,hJ,"f"),await zH(this,dJ,"f"),this.authenticate())}async authenticate(){if(!this.requiresAuth)return this.user={email:null},this.user;if(this.user)return this.user;const t=()=>(BH(this,fJ,!0,"f"),new Promise(((t,e)=>{this.feathers.reAuthenticate().then((({user:e})=>{BH(this,fJ,!1,"f"),this.user=e,eG.log(`Authenticated as ${e.email}`),t()})).catch((t=>{BH(this,fJ,!1,"f"),e(t)}))})));return BH(this,pJ,zH(this,pJ,"f").then((()=>zH(this,fJ,"f")?null:t())),"f"),zH(this,pJ,"f").then((()=>this.user))}async login(t,e){const n=await this.feathers.authenticate({strategy:"local",email:t,password:e});return this.user=n.user,this.user}async loginWithUI(){const t=new uJ({target:document.body,props:{dataStore:this}});return new Promise(((e,n)=>{t.$on("terminate",(r=>{t.$destroy(),r?e(r):n()}))}))}async signup(t,e){try{return await this.service("users").create({email:t,password:e}),await this.login(t,e),this.user}catch(t){return eG.error("An error occurred during signup",t),{email:null}}}async logout(){await this.feathers.logout(),document.location.reload()}service(t){const e=Object.keys(this.feathers.services).includes(t);e||(zH(this,mJ,"f").call(this,t),this.$services.set(Object.keys(this.feathers.services)));const n=this.backend===gJ.Remote?this.feathers.service(`${this.apiPrefix}/${t}`):this.feathers.service(t);return e||(n.items=()=>vJ(n)),n}setupAppHooks(){const t=this.backend!==gJ.Remote?[WZ]:[],e=this.backend!==gJ.Remote?[QZ]:[];this.feathers.hooks({before:{find:[...e,HZ],create:[...t,GZ],update:[qZ],patch:[qZ]},after:{find:[HZ],get:[HZ],create:[HZ],update:[HZ],patch:[HZ],remove:[HZ]}})}}function wJ(t){return new xJ(t)}async function _J(t,e,n){const r=document.createElement("a");r.style.display="none",document.body.appendChild(r);const i=new Blob([t],{type:n});r.href=URL.createObjectURL(i),r.download=e,r.click()}async function SJ(t){return new Promise(((e,n)=>{const r=new FileReader;r.onload=()=>{const t=JSON.parse(r.result);e(t)},r.onerror=t=>{n(t)},r.readAsText(t)}))}function kJ(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase()}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */hJ=new WeakMap,dJ=new WeakMap,pJ=new WeakMap,fJ=new WeakMap,mJ=new WeakMap;var TJ=function(t,e){return TJ=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},TJ(t,e)};function EJ(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}TJ(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var MJ,CJ,AJ=function(t){var e="[object "+t+"]";return function(t){return NJ(t)===e}},NJ=function(t){return Object.prototype.toString.call(t)},IJ=function(t){return t instanceof Date?t.getTime():$J(t)?t.map(IJ):t&&"function"==typeof t.toJSON?t.toJSON():t},$J=AJ("Array"),RJ=AJ("Object"),OJ=AJ("Function"),PJ=function(t,e){if(null==t&&t==e)return!0;if(t===e)return!0;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if($J(t)){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(!PJ(t[n],e[n]))return!1;return!0}if(RJ(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!PJ(t[i],e[i]))return!1;return!0}return!1},LJ=function(t,e,n,r,i,s){var o=e[r];if($J(t)&&isNaN(Number(o)))for(var a=0,l=t.length;a<l;a++)if(!LJ(t[a],e,n,r,a,t))return!1;return r===e.length||null==t?n(t,i,s,0===r):LJ(t[o],e,n,r+1,o,t)},DJ=function(){function t(t,e,n,r){this.params=t,this.owneryQuery=e,this.options=n,this.name=r,this.init()}return t.prototype.init=function(){},t.prototype.reset=function(){this.done=!1,this.keep=!1},t}(),FJ=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r)||this;return s.children=i,s}return EJ(e,t),e.prototype.reset=function(){this.keep=!1,this.done=!1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].reset()},e.prototype.childrenNext=function(t,e,n,r){for(var i=!0,s=!0,o=0,a=this.children.length;o<a;o++){var l=this.children[o];if(l.done||l.next(t,e,n,r),l.keep||(s=!1),l.done){if(!l.keep)break}else i=!1}this.done=i,this.keep=s},e}(DJ),zJ=function(t){function e(e,n,r,i,s){var o=t.call(this,e,n,r,i)||this;return o.name=s,o}return EJ(e,t),e}(FJ),BJ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(FJ),UJ=function(t){function e(e,n,r,i,s){var o=t.call(this,n,r,i,s)||this;return o.keyPath=e,o.propop=!0,o._nextNestedValue=function(t,e,n,r){return o.childrenNext(t,e,n,r),!o.done},o}return EJ(e,t),e.prototype.next=function(t,e,n){LJ(t,this.keyPath,this._nextNestedValue,0,e,n)},e}(FJ),VJ=function(t,e){if(t instanceof Function)return t;if(t instanceof RegExp)return function(e){var n="string"==typeof e&&t.test(e);return t.lastIndex=0,n};var n=IJ(t);return function(t){return e(n,IJ(t))}},jJ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){this._test=VJ(this.params,this.options.compare)},e.prototype.next=function(t,e,n){Array.isArray(n)&&!n.hasOwnProperty(e)||this._test(t,e,n)&&(this.done=!0,this.keep=!0)},e}(DJ),WJ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.next=function(){this.done=!0,this.keep=!1},e}(DJ),HJ=function(t){return e=function(e,n,r,i){var s=typeof IJ(e),o=t(e);return new jJ((function(t){return typeof IJ(t)===s&&o(t)}),n,r,i)},function(t,n,r,i){return null==t?new WJ(t,n,r,i):e(t,n,r,i)};var e},GJ=function(t,e,n,r){var i=r.operations[t];return i||qJ(t),i(e,n,r,t)},qJ=function(t){throw new Error("Unsupported operation: "+t)},XJ=function(t,e){for(var n in t)if(e.operations.hasOwnProperty(n)||"$"===n.charAt(0))return!0;return!1},YJ=function(t,e,n,r,i){if(XJ(e,i)){var s=ZJ(e,n,i),o=s[0];if(s[1].length)throw new Error("Property queries must contain only operations, or exact objects.");return new UJ(t,e,r,i,o)}return new UJ(t,e,r,i,[new jJ(e,r,i)])},KJ=function(t,e,n){void 0===e&&(e=null);var r=void 0===n?{}:n,i=r.compare,s=r.operations,o={compare:i||PJ,operations:Object.assign({},s||{})},a=ZJ(t,null,o),l=a[0],c=a[1],u=[];return l.length&&u.push(new UJ([],t,e,o,l)),u.push.apply(u,c),1===u.length?u[0]:new BJ(t,e,o,u)},ZJ=function(t,e,n){var r,i=[],s=[];if(!(r=t)||r.constructor!==Object&&r.constructor!==Array&&"function Object() { [native code] }"!==r.constructor.toString()&&"function Array() { [native code] }"!==r.constructor.toString()||r.toJSON)return i.push(new jJ(t,t,n)),[i,s];for(var o in t)if(n.operations.hasOwnProperty(o)){var a=GJ(o,t[o],t,n);if(a&&!a.propop&&e&&!n.operations[e])throw new Error("Malformed query. "+o+" cannot be matched against property.");null!=a&&i.push(a)}else"$"===o.charAt(0)?qJ(o):s.push(YJ(o.split("."),t[o],o,t,n));return[i,s]},JJ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){this._test=VJ(this.params,this.options.compare)},e.prototype.reset=function(){t.prototype.reset.call(this),this.keep=!0},e.prototype.next=function(t){this._test(t)&&(this.done=!0,this.keep=!1)},e}(DJ),QJ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){if(!this.params||"object"!=typeof this.params)throw new Error("Malformed query. $elemMatch must by an object.");this._queryOperation=KJ(this.params,this.owneryQuery,this.options)},e.prototype.reset=function(){t.prototype.reset.call(this),this._queryOperation.reset()},e.prototype.next=function(t){if($J(t)){for(var e=0,n=t.length;e<n;e++){this._queryOperation.reset();var r=t[e];this._queryOperation.next(r,e,t,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},e}(DJ),tQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){this._queryOperation=KJ(this.params,this.owneryQuery,this.options)},e.prototype.reset=function(){t.prototype.reset.call(this),this._queryOperation.reset()},e.prototype.next=function(t,e,n,r){this._queryOperation.next(t,e,n,r),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},e}(DJ),eQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){},e.prototype.next=function(t){$J(t)&&t.length===this.params&&(this.done=!0,this.keep=!0)},e}(DJ),nQ=function(t){if(0===t.length)throw new Error("$and/$or/$nor must be a nonempty array")},rQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!1,e}return EJ(e,t),e.prototype.init=function(){var t=this;nQ(this.params),this._ops=this.params.map((function(e){return KJ(e,null,t.options)}))},e.prototype.reset=function(){this.done=!1,this.keep=!1;for(var t=0,e=this._ops.length;t<e;t++)this._ops[t].reset()},e.prototype.next=function(t,e,n){for(var r=!1,i=!1,s=0,o=this._ops.length;s<o;s++){var a=this._ops[s];if(a.next(t,e,n),a.keep){r=!0,i=a.keep;break}}this.keep=i,this.done=r},e}(DJ),iQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!1,e}return EJ(e,t),e.prototype.next=function(e,n,r){t.prototype.next.call(this,e,n,r),this.keep=!this.keep},e}(rQ),sQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.init=function(){var t=this;this._testers=this.params.map((function(e){if(XJ(e,t.options))throw new Error("cannot nest $ under "+t.name.toLowerCase());return VJ(e,t.options.compare)}))},e.prototype.next=function(t,e,n){for(var r=!1,i=!1,s=0,o=this._testers.length;s<o;s++){if((0,this._testers[s])(t)){r=!0,i=!0;break}}this.keep=i,this.done=r},e}(DJ),oQ=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,i)||this;return s.propop=!0,s._in=new sQ(e,n,r,i),s}return EJ(e,t),e.prototype.next=function(t,e,n,r){this._in.next(t,e,n),$J(n)&&!r?this._in.keep?(this.keep=!1,this.done=!0):e==n.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},e.prototype.reset=function(){t.prototype.reset.call(this),this._in.reset()},e}(DJ),aQ=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propop=!0,e}return EJ(e,t),e.prototype.next=function(t,e,n){n.hasOwnProperty(e)===this.params&&(this.done=!0,this.keep=!0)},e}(DJ),lQ=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,e.map((function(t){return KJ(t,n,r)})),i)||this;return s.propop=!1,nQ(e),s}return EJ(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(zJ),cQ=function(t){function e(e,n,r,i){var s=t.call(this,e,n,r,e.map((function(t){return KJ(t,n,r)})),i)||this;return s.propop=!0,s}return EJ(e,t),e.prototype.next=function(t,e,n,r){this.childrenNext(t,e,n,r)},e}(zJ),uQ=HJ((function(t){return function(e){return e<t}})),hQ=HJ((function(t){return function(e){return e<=t}})),dQ=HJ((function(t){return function(e){return e>t}})),pQ=HJ((function(t){return function(e){return e>=t}})),fQ={number:function(t){return"number"==typeof t},string:function(t){return"string"==typeof t},bool:function(t){return"boolean"==typeof t},array:function(t){return Array.isArray(t)},null:function(t){return null===t},timestamp:function(t){return t instanceof Date}},mQ=Object.freeze({__proto__:null,$Size:eQ,$eq:function(t,e,n){return new jJ(t,e,n)},$ne:function(t,e,n,r){return new JJ(t,e,n,r)},$or:function(t,e,n,r){return new rQ(t,e,n,r)},$nor:function(t,e,n,r){return new iQ(t,e,n,r)},$elemMatch:function(t,e,n,r){return new QJ(t,e,n,r)},$nin:function(t,e,n,r){return new oQ(t,e,n,r)},$in:function(t,e,n,r){return new sQ(t,e,n,r)},$lt:uQ,$lte:hQ,$gt:dQ,$gte:pQ,$mod:function(t,e,n){var r=t[0],i=t[1];return new jJ((function(t){return IJ(t)%r===i}),e,n)},$exists:function(t,e,n,r){return new aQ(t,e,n,r)},$regex:function(t,e,n){return new jJ(new RegExp(t,e.$options),e,n)},$not:function(t,e,n,r){return new tQ(t,e,n,r)},$type:function(t,e,n){return new jJ((function(e){if("string"==typeof t){if(!fQ[t])throw new Error("Type alias does not exist");return fQ[t](e)}return null!=e&&(e instanceof t||e.constructor===t)}),e,n)},$and:function(t,e,n,r){return new lQ(t,e,n,r)},$all:function(t,e,n,r){return new cQ(t,e,n,r)},$size:function(t,e,n){return new eQ(t,e,n,"$size")},$options:function(){return null},$where:function(t,e,n){var r;if(OJ(t))r=t;else{if(process.env.CSP_ENABLED)throw new Error('In CSP mode, sift does not support strings in "$where" condition');r=new Function("obj","return "+t)}return new jJ((function(t){return r.bind(t)(t)}),e,n)}}),gQ=function(t,e){void 0===e&&(e={});var n,r=function(t,e,n){var r=void 0===n?{}:n,i=r.compare,s=r.operations;return KJ(t,e,{compare:i,operations:Object.assign({},mQ,s||{})})}(t,null,e);return n=r,function(t,e,r){return n.reset(),n.next(t,e,r),n.keep}};class yQ extends mG{constructor(t,e=wJ()){super(),this.title="dataset",this.isDataset=!0,MJ.set(this,void 0),this.query={},CJ.set(this,new Set),this.$count=new JH(0,!0),this.$changes=new JH([]),this.name=t,this.title=`dataset (${t})`,BH(this,MJ,e,"f"),this.start(),this.ready=new Promise(((e,n)=>{zH(this,MJ,"f").connect().then((()=>this.setup())).then(e).catch((e=>{const r=new Error(null==e?void 0:e.message);r.name=`Dataset Error (${t}): datastore connection failed`,sG(r,{duration:0}),n(r)}))}))}async setup(){const t=kJ(`instances-${this.name}`);var e,n;this.instanceService=zH(this,MJ,"f").service(t),void 0===this.instanceService.__hooks.before.find&&this.instanceService.hooks({before:{all:[],create:[(e="datasetName",n=this.name,t=>{const{data:r}=t;return t.data={[e]:n,...r},t}),ZZ],find:[XZ("datasetName",this.name)],get:[XZ("datasetName",this.name)],update:[XZ("datasetName",this.name)],patch:[XZ("datasetName",this.name)],remove:[XZ("datasetName",this.name)]},after:{find:[JZ],get:[JZ]}}),this.instanceService.hooks({before:{update:[this.checkUpdates],patch:[this.checkUpdates]}}),await this.reset(),this.watchChanges()}async reset(){const{total:t}=await this.find({query:{$limit:0}});this.$count.set(t),this.$changes.set([{level:"dataset",type:"created"}])}async checkUpdates(t){if(0===Object.keys(this.query).length)return;const e=gQ(this.query),n=e(t.data);try{const r=await this.get(t.id);e(r)&&!n&&(this.$count.set(this.$count.get()-1),this.$changes.set([{level:"instance",type:"removed",data:r}]))}catch(e){zH(this,CJ,"f").add(t.id)}}watchChanges(){const t=gQ(this.query);this.instanceService.on("created",(e=>{if(!t(e))return;const n={...e,id:e.id||e._id};this.$count.set(this.$count.get()+1),this.$changes.set([{level:"instance",type:"created",data:n}])}));const e=e=>{if(!t(e))return;const n={...e,id:e.id||e._id};zH(this,CJ,"f").has(n.id)?(this.$count.set(this.$count.get()+1),this.$changes.set([{level:"instance",type:"created",data:n}]),zH(this,CJ,"f").delete(n.id)):this.$changes.set([{level:"instance",type:"updated",data:n}])};this.instanceService.on("updated",e),this.instanceService.on("patched",e),this.instanceService.on("removed",(e=>{if(!t(e))return;this.$count.set(this.$count.get()-1);const n={...e,id:e.id||e._id};this.$changes.set([{level:"instance",type:"removed",data:n}])}))}async sift(t={}){return this.query=t,this.ready.then((()=>this.reset()))}items(){return this.instanceService.items().query(this.query)}async find(t){const e=dG(t||{},{query:this.query});return this.instanceService.find(e)}async get(t,e){const n=dG(e||{},{query:this.query});return this.instanceService.get(t,n)}async create(t,e){const n=dG(e||{},{query:this.query});return this.instanceService.create(t,n)}async update(t,e,n){const r=dG(n||{},{query:this.query});return this.instanceService.update(t,e,r)}async patch(t,e,n){const r=dG(n||{},{query:this.query});return this.instanceService.patch(t,e,r)}async remove(t,e){const n=dG(e||{},{query:this.query});return this.instanceService.remove(t,n)}async clear(){await this.remove(null,{query:{}})}async distinct(t){const e={$distinct:t,...this.query};return this.instanceService.find({query:e})}async download(){const t={marcelleMeta:{type:"dataset"},instances:(await this.find()).data},e=new Date(Date.now()),n=`${this.title}-${e.toISOString()}.json`;await _J(JSON.stringify(t),n,"text/plain")}async upload(t){const e=t.filter((t=>"application/json"===t.type)).map((t=>SJ(t))),n=(await Promise.all(e)).map((t=>t.instances.map((t=>{const{id:e,...n}=t;return this.create(n).catch((t=>{sG(t)}))}))));await Promise.all(n)}mount(){}}function bQ(t){return"object"==typeof t&&null!==t&&t.isDataset}MJ=new WeakMap,CJ=new WeakMap;class vQ extends mG{constructor(){super(),this.ready=!1,this.$training=new JH({status:"idle"},!0),this.$training.start(),this.$training.subscribe((({status:t})=>{"success"!==t&&"loaded"!==t||(this.ready=!0)}))}sync(t,e){return this.syncData={name:e,store:t},this.syncData.store.connect().then((()=>{this.syncData.service=this.syncData.store.service(this.serviceName),this.setupSync()})).catch((t=>{const n=new Error(null==t?void 0:t.message);n.name=`Model Sync Error (${e}): datastore connection failed`,sG(n,{duration:0})})),this}async setupSync(){if(!this.syncData.service)return;const{data:t}=await this.syncData.service.find({query:{name:this.syncData.name,$select:["id"],$limit:1,$sort:{updatedAt:-1}}});let e=null;1===t.length&&(e=t[0].id,this.load(this.syncData.store,e));let n=!1;this.$training.subscribe((({status:t,data:r})=>{("success"===t||"loaded"===t&&"datastore"!==(null==r?void 0:r.source))&&(n=!0,this.save(this.syncData.store,this.syncData.name,{},e).then((t=>{e=t})))}));const r=t=>{(t._id===e||!e&&t.name===this.syncData.name)&&(e=t._id,n||this.load(this.syncData.store,e),n=!1)};this.syncData.service.on("created",r),this.syncData.service.on("updated",r),this.syncData.service.on("patched",r)}async saveToDatastore(t,e,n=null){await t.connect();const r=t.service(this.serviceName);if(!r)return null;if(!e)return null;let i=n;if(n)await r.update(n,e);else{i=(await r.create(e)).id}return eG.info(`Model was saved to data store at location ${t.location}`),i}async loadFromDatastore(t,e){await t.connect();const n=t.service(this.serviceName);if(!n||!e)return null;let r;try{r=await n.get(e)}catch(t){const{data:i}=await n.find({query:{name:e,$limit:1,$sort:{updatedAt:-1}}});1===i.length&&(r=i[0])}if(r){const e=r.name;eG.info(`Model ${e} was loaded from data store at location ${t.location}`)}return r}mount(){}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */
var xQ,wQ;K().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(xQ||(xQ={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(wQ||(wQ={}));
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const _Q={};function SQ(t){return _Q[t]}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function kQ(t,e,n,r,i){const s=e.inputParams[t];if(s&&void 0!==s.inputIndexStart){const t=s.inputIndexStart,o=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?t+1:s.inputIndexEnd;if("tensor"===s.type)return TQ(e.inputNames[s.inputIndexStart],n,r,i);if("tensors"===s.type){return e.inputNames.slice(t,o).map((t=>TQ(t,n,r,i)))}const a=TQ(e.inputNames.slice(t)[0],n,r,i),l=a.dataSync();return"number"===s.type?l[0]:z(a.shape,l)}const o=e.attrParams[t];return o&&o.value}function TQ(t,e,n,r){const[i,s]=CQ(t);if(null!=r){const t=r.getHashTableHandleByName(i);if(null!=t)return t}const o=n.currentContextIds.find((t=>!!e[MQ(i,t)]));return void 0!==o?e[MQ(i,o)][s]:void 0}function EQ(t,e){const[n,r,i]=CQ(t);return[MQ(n,e&&e.currentContextId),r,i]}function MQ(t,e){return e?`${t}-${e}`:t}function CQ(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function AQ(t,e,n){let r=kQ("pad",t,e,n);if("explicit"===r){r=kQ("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)i[t][0]=r[2*t],i[t][1]=r[2*t+1];return i}return r}function NQ(t){return t.kept?t:ro(t)}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var IQ=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var $Q=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var RQ=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var OQ=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var PQ=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var LQ=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var DQ=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var FQ=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var zQ=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var BQ=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var UQ=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var VQ=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var jQ=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var WQ=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var HQ=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var GQ=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var qQ=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var XQ=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var YQ=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class KQ{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[IQ,$Q,RQ,OQ,PQ,LQ,DQ,FQ,zQ,BQ,UQ,VQ,jQ,WQ,HQ,GQ,qQ,XQ,YQ].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],i=[],s=[],o=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?i.push(t[e.name]):null!=e.input&&0!==e.input.length||s.push(t[e.name]),t)),{});let a=[];const l=[];let c={},u={};null!=e&&(c=this.mapSignatureEntries(e.inputs),u=this.mapSignatureEntries(e.outputs));const h=Object.keys(o);h.forEach((t=>{const e=o[t];e.inputNames.forEach(((t,n)=>{const[r,,i]=EQ(t),s=o[r];if(null!=s.outputs){const t=s.outputs.indexOf(i);if(-1!==t){const i=`${r}:${t}`;e.inputNames[n]=i}}e.inputs.push(s),s.children.push(e)}))})),0===Object.keys(u).length?h.forEach((t=>{const e=o[t];0===e.children.length&&l.push(e)})):Object.keys(u).forEach((t=>{const[e]=EQ(t),n=o[e];null!=n&&(n.signatureKey=u[t],l.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=EQ(t),n=o[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let d={};null!=t.library&&null!=t.library.function&&(d=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:o,inputs:a,outputs:l,weights:i,placeholders:r,signature:e,functions:d};return s.length>0&&(p.initNodes=s),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=SQ(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let i;switch(n.type){case"string":i=JQ(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=JQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=l0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=l0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=t0(t.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=t0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=a0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=a0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=QQ(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=QQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=u0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=u0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=o0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=o0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=c0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=c0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=r0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=r0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=i0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=i0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=n0(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=n0(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:i,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const i=[],s=[];t.signature.inputArg.forEach((t=>{const[e]=EQ(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:e0(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,i.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[i,,s]=EQ(t),o=r[i];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const r=`${i}:${t}`;e.inputNames[n]=r}}e.inputs.push(o),o.children.push(e)}))}));const o=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=EQ(o[t.name]),i=r[e];null!=i&&(i.defaultOutput=n,s.push(i))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:i,outputs:s,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function ZQ(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=K().global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return e?n:n.toLowerCase()}function JQ(t,e,n,r=!1){const i=t[e];return null!=i?ZQ(i.s,r):n}function QQ(t,e,n){const r=t[e];return r?r.b:n}function t0(t,e,n){const r=t[e]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function e0(t){switch("string"==typeof t&&(t=xQ[t]),t){case xQ.DT_FLOAT:case xQ.DT_HALF:return"float32";case xQ.DT_INT32:case xQ.DT_INT64:case xQ.DT_INT8:case xQ.DT_UINT8:return"int32";case xQ.DT_BOOL:return"bool";case xQ.DT_DOUBLE:return"float32";case xQ.DT_STRING:return"string";default:return null}}function n0(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function r0(t,e,n){const r=t[e];return r&&r.type?e0(r.type):n}function i0(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>e0(t))):n}function s0(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function o0(t,e,n){const r=t[e];return r&&r.shape?s0(r.shape):n}function a0(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function l0(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map((t=>ZQ(t,r))):n}function c0(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>s0(t))):n}function u0(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class h0{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return TQ(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return TQ(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return t0(this.node.rawAttrs,t,e);if(null!=n.s)return JQ(this.node.rawAttrs,t,e);if(null!=n.b)return QQ(this.node.rawAttrs,t,e);if(null!=n.shape)return o0(this.node.rawAttrs,t,e);if(null!=n.type)return r0(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return a0(this.node.rawAttrs,t,e);if(null!=n.list.s)return l0(this.node.rawAttrs,t,e);if(null!=n.list.shape)return c0(this.node.rawAttrs,t,e);if(null!=n.list.b)return u0(this.node.rawAttrs,t,e);if(null!=n.list.type)return i0(this.node.rawAttrs,t,e)}return e}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var d0=Object.freeze({__proto__:null,abs:Ia,acos:$a,acosh:Ra,add:Ma,addN:Oa,all:Pa,any:La,argMax:Da,argMin:Fa,asin:za,asinh:Ba,atan:Ua,atan2:Va,atanh:ja,avgPool:sl,avgPool3d:ol,basicLSTMCell:hl,batchToSpaceND:dl,batchNorm:pl,batchNorm2d:fl,batchNorm3d:ml,batchNorm4d:gl,bincount:yl,broadcastArgs:bl,broadcastTo:vl,buffer:eo,cast:no,ceil:xl,clipByValue:_l,clone:ro,complex:is,concat:al,concat1d:Sl,concat2d:kl,concat3d:Tl,concat4d:El,conv1d:Cl,conv2d:Ml,conv2dTranspose:Nl,conv3d:Il,conv3dTranspose:Rl,cos:Ol,cosh:Pl,cumprod:Ll,cumsum:Dl,denseBincount:Fl,depthToSpace:zl,depthwiseConv2d:Bl,diag:Ul,dilation2d:Vl,div:Aa,divNoNan:Gl,dot:ql,einsum:Xl,elu:Yl,equal:jl,erf:Kl,euclideanNorm:fc,exp:mc,expandDims:gc,expm1:yc,eye:vc,fill:wl,floor:xc,floorDiv:Ca,gather:wc,greater:_c,greaterEqual:Sc,imag:Oo,isFinite:kc,isInf:Tc,isNaN:Ec,leakyRelu:Mc,less:Cc,lessEqual:Ac,linspace:Nc,localResponseNormalization:Ic,log:$c,log1p:Rc,logSigmoid:Fc,logSoftmax:Bc,logSumExp:Uc,logicalAnd:Vc,logicalNot:jc,logicalOr:Wc,logicalXor:Hc,lowerBound:Xc,matMul:ko,max:sc,maxPool:Yc,maxPool3d:Kc,maxPoolWithArgmax:Zc,maximum:Jc,mean:Qc,meshgrid:nu,min:oc,minimum:ru,mirrorPad:iu,mod:su,moments:ou,mul:Na,multiRNNCell:au,multinomial:lu,neg:Po,notEqual:cu,oneHot:To,ones:eu,onesLike:uu,outerProduct:hu,pad:du,pad1d:pu,pad2d:fu,pad3d:mu,pad4d:gu,pool:bu,pow:ac,prelu:vu,print:io,prod:xu,raggedGather:wu,raggedTensorToTensor:_u,rand:Su,randomGamma:ju,randomNormal:Wu,randomStandardNormal:Hu,randomUniform:Gu,range:qu,real:Lo,reciprocal:Xu,relu:Yu,relu6:Ku,reshape:il,reverse:Zu,reverse1d:Ju,reverse2d:Qu,reverse3d:th,reverse4d:eh,round:nh,rsqrt:rh,scalar:lc,selu:ih,separableConv2d:sh,setdiff1dAsync:oh,sigmoid:ll,sign:ah,sin:lh,sinh:ch,slice:cl,slice1d:uh,slice2d:hh,slice3d:dh,slice4d:ph,softmax:fh,softplus:Dc,spaceToBatchND:yu,fft:mh,ifft:gh,irfft:yh,rfft:vh,split:bh,sqrt:cc,square:uc,squaredDifference:xh,squeeze:wh,stack:_h,step:Sh,stridedSlice:kh,sub:zc,sum:hc,tan:Th,tanh:ul,tensor:os,tensor1d:Eh,tensor2d:Mh,tensor3d:Wo,tensor4d:Ch,tensor5d:Ah,tensor6d:Nh,tile:bc,topk:Ih,truncatedNormal:$h,unique:Rh,unsortedSegmentSum:Oh,unstack:Ph,upperBound:Lh,variable:Dh,where:Wl,whereAsync:zh,zeros:tu,zerosLike:Hl,op:rs,OP_SCOPE_SUFFIX:ns,booleanMaskAsync:Bh,transpose:Do,norm:pc,movingAverage:Uh,scatterND:Vh,searchSorted:qc,sparseToDense:jh,gatherND:Wh,dropout:Hh,enclosingPowerOfTwo:Gh,cosineWindow:qh,inTopKAsync:Xh,image:rp,linalg:ip,losses:sp,spectral:ep,fused:sd,signal:np,sparse:op,string:ap});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function p0(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){u(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const i=t[r],s=e[r];u(i<0||s<0||i===s,(()=>n+` Shapes ${t} and ${e} must match`))}}}function f0(t){return"number"!=typeof t&&!t.some((t=>t<0))}function m0(t,e,n){let r=g0(t,n);const i=!f0(r);if(i&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(i&&e.forEach((t=>{r=g0(t.shape,r)})),!f0(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function g0(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const i=t[r],s=e[r];if(i>=0&&s>=0&&i!==s)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=i>=0?i:s}return n}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class y0{constructor(t,e,n,r,i,s,o){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=lc(0),No(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),p0(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,No(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return os([],[0].concat(this.elementShape));const n=this.readMany(t);return p0(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),_h(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return os([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return p0(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),al(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,Ph(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:e.size/n,s=[];Co((()=>{e=il(e,[1,n,i]);for(let n=0;n<t.length;++n){const o=[0,0===n?0:r[n-1],0],a=[1,t[n],i];s[n]=il(cl(e,o,a),this.elementShape)}return s}));const o=[];for(let e=0;e<t.length;e++)o[e]=e;this.writeMany(o,s)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class b0{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);p0(e,t.shape,"TensorList shape mismatch: "),No(t)})),this.idTensor=lc(0),this.maxNumElements=r,No(this.idTensor)}get id(){return this.idTensor.id}copy(){return new b0([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);p0(t,this.elementShape,"TensorList shape mismatch: ");const r=m0(this.elementShape,this.tensors,t);return Co((()=>{const t=this.tensors.map((t=>il(t,r)));return _h(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=m0(this.elementShape,this.tensors,t),r=this.tensors.pop();return r.kept=!1,p0(r.shape,t,"TensorList shape mismatch: "),il(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(p0(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");No(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new b0([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);p0(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=m0(this.elementShape,this.tensors,e);return il(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);p0(this.elementShape,e.shape,"TensorList shape mismatch: "),No(e),null!=this.tensors[t]&&(this.tensors[t].kept=!1),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);p0(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=m0(this.elementShape,this.tensors,n);return 0===t.length?os([],[0].concat(r)):Co((()=>{const e=t.map((t=>il(this.tensors[t],r)));return _h(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);p0(this.elementShape,e,"TensorList shape mismatch: ");const n=m0(this.elementShape,this.tensors,e);return 0===this.size()?os([],[0].concat(n)):Co((()=>{const t=this.tensors.map((t=>il(t,n)));return al(t,0)}))}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const v0=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=kQ("thenBranch",t,e,n),i=kQ("elseBranch",t,e,n),s=kQ("cond",t,e,n),o=kQ("args",t,e,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=kQ("body",t,e,n),i=kQ("cond",t,e,n),s=kQ("args",t,e,n),o=await n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),a=s.map((t=>t.id));let l=await o[0].data();o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=s;for(;l[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const s=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await s[0].data(),s.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[NQ(kQ("pred",t,e,n))];case"Switch":{const r=kQ("pred",t,e,n);let i=kQ("data",t,e,n);return i.kept||(i=NQ(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==TQ(t,e,n)));if(r){return[NQ(TQ(r,e,n))]}return}case"Enter":{const r=kQ("frameName",t,e,n),i=kQ("tensor",t,e,n);return n.enterFrame(r),[NQ(i)]}case"Exit":{const r=kQ("tensor",t,e,n);return n.exitFrame(),[NQ(r)]}case"NextIteration":{const r=kQ("tensor",t,e,n);return n.nextIteration(),[NQ(r)]}case"TensorArrayV3":{const r=kQ("size",t,e,n),i=kQ("dtype",t,e,n),s=kQ("elementShape",t,e,n),o=kQ("dynamicSize",t,e,n),a=kQ("clearAfterRead",t,e,n),l=kQ("identicalElementShapes",t,e,n),c=kQ("name",t,e,n),u=new y0(c,i,r,s,l,o,a);return n.addTensorArray(u),[u.idTensor,lc(1)]}case"TensorArrayWriteV3":{const r=kQ("tensorArrayId",t,e,n),i=kQ("index",t,e,n),s=kQ("tensor",t,e,n),o=n.getTensorArray(r.id);return o.write(i,s),[o.idTensor]}case"TensorArrayReadV3":{const r=kQ("tensorArrayId",t,e,n),i=kQ("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=kQ("tensorArrayId",t,e,n),i=kQ("indices",t,e,n),s=kQ("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,s)]}case"TensorArrayScatterV3":{const r=kQ("tensorArrayId",t,e,n),i=kQ("indices",t,e,n),s=kQ("tensor",t,e,n),o=n.getTensorArray(r.id);return o.scatter(i,s),[o.idTensor]}case"TensorArrayConcatV3":{const r=kQ("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),s=kQ("dtype",t,e,n);return[i.concat(s)]}case"TensorArraySplitV3":{const r=kQ("tensorArrayId",t,e,n),i=kQ("tensor",t,e,n),s=kQ("lengths",t,e,n),o=n.getTensorArray(r.id);return o.split(s,i),[o.idTensor]}case"TensorArraySizeV3":{const r=kQ("tensorArrayId",t,e,n);return[lc(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=kQ("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=kQ("tensorListId",t,e,n),i=kQ("index",t,e,n),s=kQ("tensor",t,e,n),o=n.getTensorList(r.id);return o.setItem(i,s),[o.idTensor]}case"TensorListGetItem":{const r=kQ("tensorListId",t,e,n),i=kQ("index",t,e,n),s=kQ("elementShape",t,e,n),o=kQ("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=kQ("indices",t,e,n),i=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const s=new b0([],n,t.dtype,r),o=Ph(t,0);return e.forEach(((t,e)=>{s.setItem(t,o[e])})),s}(kQ("tensor",t,e,n),r,kQ("elementShape",t,e,n),kQ("numElements",t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=kQ("elementShape",t,e,n),i=kQ("elementDType",t,e,n);let s;s="TensorListReserve"===t.op?"numElements":"maxNumElements";const o=kQ(s,t,e,n),a=function(t,e,n,r){return new b0([],t,e,r)}(r,i,0,"TensorListReserve"===t.op?-1:o);return n.addTensorList(a),[a.idTensor]}case"TensorListGather":{const r=kQ("tensorListId",t,e,n),i=kQ("indices",t,e,n),s=kQ("elementShape",t,e,n),o=kQ("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,o,s)]}case"TensorListStack":{const r=kQ("tensorListId",t,e,n),i=kQ("elementShape",t,e,n),s=kQ("elementDType",t,e,n),o=kQ("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,s,o)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);p0(t.shape.slice(1),e,"TensorList shape mismatch: ");const i=Ph(t);return new b0(i,e,r)}(kQ("tensor",t,e,n),kQ("elementShape",t,e,n),kQ("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=kQ("tensorListId",t,e,n),i=n.getTensorList(r.id),s=kQ("dtype",t,e,n),o=kQ("elementShape",t,e,n);return[i.concat(s,o)]}case"TensorListPushBack":{const r=kQ("tensorListId",t,e,n),i=kQ("tensor",t,e,n),s=n.getTensorList(r.id);return s.pushBack(i),[s.idTensor]}case"TensorListPopBack":{const r=kQ("tensorListId",t,e,n),i=kQ("elementShape",t,e,n),s=kQ("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,s)]}case"TensorListSplit":{const r=kQ("tensor",t,e,n),i=kQ("elementShape",t,e,n),s=function(t,e,n){let r=0;const i=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const s=g0(t.shape.slice(1),n),o=0===r?0:t.size/r,a=Co((()=>{const n=[];t=il(t,[1,r,o]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:i[r-1],0],l=[1,e[r],o];n[r]=il(cl(t,a,l),s)}return t.dispose(),n})),l=new b0([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)l.setItem(t,a[t]);return l}(r,kQ("lengths",t,e,n),i);return n.addTensorList(s),[s.idTensor]}case"TensorListLength":{const r=kQ("tensorListId",t,e,n);return[lc(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=kQ("tensorListId",t,e,n),i=kQ("size",t,e,n),s=n.getTensorList(r.id).resize(i);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function x0(t,e,n){const[r,i]=kQ("fusedOps",t,e,n),s="biasadd"===r,o=!s,a="prelu"===i,l="fusedbatchnorm"===r,c=kQ("numArgs",t,e,n);if(s){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&s&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=kQ("strides",t,e,n),h=AQ(t,e,n),d=kQ("dataFormat",t,e,n).toUpperCase(),p=kQ("dilations",t,e,n);let[f,m]=kQ("args",t,e,n);o&&(m=f,f=void 0);return{stride:u,pad:h,dataFormat:d,dilations:p,biasArg:f,preluArg:m,activationFunc:i,leakyreluAlpha:kQ("leakyreluAlpha",t,e,n)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function w0(t,e,n){return{boxes:kQ("boxes",t,e,n),scores:kQ("scores",t,e,n),maxOutputSize:kQ("maxOutputSize",t,e,n),iouThreshold:kQ("iouThreshold",t,e,n),scoreThreshold:kQ("scoreThreshold",t,e,n),softNmsSigma:kQ("softNmsSigma",t,e,n)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class _0{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=lc(0),this.tensorMap=new Map,No(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return lc(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),Co((()=>{const t=Ph(e),r=n.length,i=t.length;u(r===i,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${i} elements.`));for(let e=0;e<r;e++){const r=n[e],i=t[e];No(i),this.tensorMap.set(r,i)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return Co((()=>{const t=[];for(let r=0;r<n.length;r++){const i=n[r],s=this.findWithDefault(i,e);t.push(s)}return _h(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function S0(t,e,n,r,i=Co){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(kQ("a",t,e,n),kQ("b",t,e,n))];case"AddN":return[r.addN(kQ("tensors",t,e,n))];case"FloorMod":case"Mod":return[r.mod(kQ("a",t,e,n),kQ("b",t,e,n))];case"Mul":return[r.mul(kQ("a",t,e,n),kQ("b",t,e,n))];case"RealDiv":case"Div":return[r.div(kQ("a",t,e,n),kQ("b",t,e,n))];case"DivNoNan":return[r.divNoNan(kQ("a",t,e,n),kQ("b",t,e,n))];case"FloorDiv":return[r.floorDiv(kQ("a",t,e,n),kQ("b",t,e,n))];case"Sub":return[r.sub(kQ("a",t,e,n),kQ("b",t,e,n))];case"Minimum":return[r.minimum(kQ("a",t,e,n),kQ("b",t,e,n))];case"Maximum":return[r.maximum(kQ("a",t,e,n),kQ("b",t,e,n))];case"Pow":return[r.pow(kQ("a",t,e,n),kQ("b",t,e,n))];case"SquaredDifference":return[r.squaredDifference(kQ("a",t,e,n),kQ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Abs":case"ComplexAbs":return[r.abs(kQ("x",t,e,n))];case"Acos":return[r.acos(kQ("x",t,e,n))];case"Acosh":return[r.acosh(kQ("x",t,e,n))];case"Asin":return[r.asin(kQ("x",t,e,n))];case"Asinh":return[r.asinh(kQ("x",t,e,n))];case"Atan":return[r.atan(kQ("x",t,e,n))];case"Atan2":return[r.atan2(kQ("x",t,e,n),kQ("y",t,e,n))];case"Atanh":return[r.atanh(kQ("x",t,e,n))];case"Ceil":return[r.ceil(kQ("x",t,e,n))];case"Complex":return[r.complex(kQ("real",t,e,n),kQ("imag",t,e,n))];case"Cos":return[r.cos(kQ("x",t,e,n))];case"Cosh":return[r.cosh(kQ("x",t,e,n))];case"Elu":return[r.elu(kQ("x",t,e,n))];case"Erf":return[r.erf(kQ("x",t,e,n))];case"Exp":return[r.exp(kQ("x",t,e,n))];case"Expm1":return[r.expm1(kQ("x",t,e,n))];case"Floor":return[r.floor(kQ("x",t,e,n))];case"Log":return[r.log(kQ("x",t,e,n))];case"Log1p":return[r.log1p(kQ("x",t,e,n))];case"Imag":return[r.imag(kQ("x",t,e,n))];case"Neg":return[r.neg(kQ("x",t,e,n))];case"Reciprocal":return[r.reciprocal(kQ("x",t,e,n))];case"Real":return[r.real(kQ("x",t,e,n))];case"Relu":return[r.relu(kQ("x",t,e,n))];case"Round":return[r.round(kQ("x",t,e,n))];case"Selu":return[r.selu(kQ("x",t,e,n))];case"Sigmoid":return[r.sigmoid(kQ("x",t,e,n))];case"Sin":return[r.sin(kQ("x",t,e,n))];case"Sign":return[r.sign(kQ("x",t,e,n))];case"Sinh":return[r.sinh(kQ("x",t,e,n))];case"Softplus":return[r.softplus(kQ("x",t,e,n))];case"Sqrt":return[r.sqrt(kQ("x",t,e,n))];case"Square":return[r.square(kQ("x",t,e,n))];case"Tanh":return[r.tanh(kQ("x",t,e,n))];case"Tan":return[r.tan(kQ("x",t,e,n))];case"ClipByValue":return[r.clipByValue(kQ("x",t,e,n),kQ("clipValueMin",t,e,n),kQ("clipValueMax",t,e,n))];case"Relu6":return[r.relu6(kQ("x",t,e,n))];case"Rsqrt":return[r.rsqrt(TQ(t.inputNames[0],e,n))];case"Prod":return[r.prod(kQ("x",t,e,n),kQ("axes",t,e,n))];case"LeakyRelu":return[r.leakyRelu(kQ("x",t,e,n),kQ("alpha",t,e,n))];case"Prelu":return[r.prelu(kQ("x",t,e,n),kQ("alpha",t,e,n))];case"IsNan":return[r.isNaN(TQ(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return v0(t,e,n);case"convolution":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Conv1D":{const i=kQ("stride",t,e,n),s=kQ("pad",t,e,n),o=kQ("dataFormat",t,e,n).toUpperCase(),a=kQ("dilation",t,e,n);return[r.conv1d(kQ("x",t,e,n),kQ("filter",t,e,n),i,s,o,a)]}case"Conv2D":{const i=kQ("strides",t,e,n),s=AQ(t,e,n),o=kQ("dataFormat",t,e,n).toUpperCase(),a=kQ("dilations",t,e,n);return[r.conv2d(kQ("x",t,e,n),kQ("filter",t,e,n),[i[1],i[2]],s,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:i,pad:s,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=x0(t,e,n);return[r.fused.conv2d({x:kQ("x",t,e,n),filter:kQ("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:s,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=x0(t,e,n);return[r.fused.depthwiseConv2d({x:kQ("x",t,e,n),filter:kQ("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=kQ("outputShape",t,e,n),s=kQ("strides",t,e,n),o=AQ(t,e,n);return[r.conv2dTranspose(kQ("x",t,e,n),kQ("filter",t,e,n),i,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=kQ("strides",t,e,n),s=AQ(t,e,n),o=kQ("dilations",t,e,n),a=kQ("dataFormat",t,e,n).toUpperCase();return[r.depthwiseConv2d(kQ("input",t,e,n),kQ("filter",t,e,n),[i[1],i[2]],s,a,[o[1],o[2]])]}case"Conv3D":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("dataFormat",t,e,n).toUpperCase(),a=kQ("dilations",t,e,n);return[r.conv3d(kQ("x",t,e,n),kQ("filter",t,e,n),[i[1],i[2],i[3]],s,o,[a[1],a[2],a[3]])]}case"AvgPool":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("kernelSize",t,e,n);return[r.avgPool(kQ("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s)]}case"MaxPool":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("kernelSize",t,e,n);return[r.maxPool(kQ("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s)]}case"MaxPoolWithArgmax":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("kernelSize",t,e,n),a=kQ("includeBatchInIndex",t,e,n),{result:l,indexes:c}=r.maxPoolWithArgmax(kQ("x",t,e,n),[o[1],o[2]],[i[1],i[2]],s,a);return[l,c]}case"AvgPool3D":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("kernelSize",t,e,n);return[r.avgPool3d(kQ("x",t,e,n),[o[1],o[2],o[3]],[i[1],i[2],i[3]],s)]}case"MaxPool3D":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("kernelSize",t,e,n);return[r.maxPool3d(kQ("x",t,e,n),[o[1],o[2],o[3]],[i[1],i[2],i[3]],s)]}case"Dilation2D":{const i=kQ("strides",t,e,n),s=kQ("pad",t,e,n),o=kQ("dilations",t,e,n),a=i[1],l=i[2],c=o[1],u=o[2];return[r.dilation2d(kQ("x",t,e,n),kQ("filter",t,e,n),[a,l],s,[c,u],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Fill":{const i=kQ("shape",t,e,n),s=kQ("dtype",t,e,n),o=kQ("value",t,e,n);return[r.fill(i,o,s)]}case"LinSpace":{const i=kQ("start",t,e,n),s=kQ("stop",t,e,n),o=kQ("num",t,e,n);return[r.linspace(i,s,o)]}case"Multinomial":{const i=kQ("logits",t,e,n),s=kQ("numSamples",t,e,n),o=kQ("seed",t,e,n);return[r.multinomial(i,s,o)]}case"OneHot":{const i=kQ("indices",t,e,n),s=kQ("depth",t,e,n),o=kQ("onValue",t,e,n),a=kQ("offValue",t,e,n),l=kQ("dtype",t,e,n);return[r.oneHot(i,s,o,a,l)]}case"Ones":return[r.ones(kQ("shape",t,e,n),kQ("dtype",t,e,n))];case"OnesLike":return[r.onesLike(kQ("x",t,e,n))];case"RandomStandardNormal":return[r.randomStandardNormal(kQ("shape",t,e,n),kQ("dtype",t,e,n),kQ("seed",t,e,n))];case"RandomUniform":return[r.randomUniform(kQ("shape",t,e,n),kQ("minval",t,e,n),kQ("maxval",t,e,n),kQ("dtype",t,e,n))];case"Range":{const i=kQ("start",t,e,n),s=kQ("stop",t,e,n),o=kQ("step",t,e,n);return[r.range(i,s,o,kQ("dtype",t,e,n))]}case"TruncatedNormal":{const i=kQ("shape",t,e,n),s=kQ("mean",t,e,n),o=kQ("stdDev",t,e,n),a=kQ("seed",t,e,n);return[r.truncatedNormal(i,s,o,kQ("dtype",t,e,n),a)]}case"Zeros":return[r.zeros(kQ("shape",t,e,n),kQ("dtype",t,e,n))];case"ZerosLike":return[r.zerosLike(kQ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n,r,i=d0)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=w0(t,e,n),u=await i.image.nonMaxSuppressionWithScoreAsync(r,s,o,a,l,c);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=w0(t,e,n),c=kQ("padToMaxOutputSize",t,e,n),u=await i.image.nonMaxSuppressionPaddedAsync(r,s,o,a,l,c);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=w0(t,e,n);return[await i.image.nonMaxSuppressionAsync(r,s,o,a,l)]}case"Where":{const r=i.cast(kQ("condition",t,e,n),"bool"),s=[await i.whereAsync(r)];return r.dispose(),s}case"ListDiff":return i.setdiff1dAsync(kQ("x",t,e,n),kQ("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"LowerBound":{const i=kQ("sortedSequence",t,e,n),s=kQ("values",t,e,n);return[r.lowerBound(i,s)]}case"TopKV2":{const i=kQ("x",t,e,n),s=kQ("k",t,e,n),o=kQ("sorted",t,e,n),a=r.topk(i,s,o);return[a.values,a.indices]}case"UpperBound":{const i=kQ("sortedSequence",t,e,n),s=kQ("values",t,e,n);return[r.upperBound(i,s)]}case"Unique":{const i=kQ("x",t,e,n),s=r.unique(i);return[s.values,s.indices]}case"UniqueV2":{const i=kQ("x",t,e,n),s=kQ("axis",t,e,n),o=r.unique(i,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"ResizeBilinear":{const i=kQ("images",t,e,n),s=kQ("size",t,e,n),o=kQ("alignCorners",t,e,n),a=kQ("halfPixelCenters",t,e,n);return[r.image.resizeBilinear(i,[s[0],s[1]],o,a)]}case"ResizeNearestNeighbor":{const i=kQ("images",t,e,n),s=kQ("size",t,e,n),o=kQ("alignCorners",t,e,n),a=kQ("halfPixelCenters",t,e,n);return[r.image.resizeNearestNeighbor(i,[s[0],s[1]],o,a)]}case"CropAndResize":{const i=kQ("image",t,e,n),s=kQ("boxes",t,e,n),o=kQ("boxInd",t,e,n),a=kQ("cropSize",t,e,n),l=kQ("method",t,e,n),c=kQ("extrapolationValue",t,e,n);return[r.image.cropAndResize(i,s,o,a,l,c)]}case"ImageProjectiveTransformV3":{const i=kQ("images",t,e,n),s=kQ("transforms",t,e,n),o=kQ("outputShape",t,e,n),a=kQ("fillValue",t,e,n),l=kQ("interpolation",t,e,n),c=kQ("fillMode",t,e,n);return[r.image.transform(i,s,l.toLowerCase(),c.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const i=kQ("default",t,e,n);return[TQ(t.name,e,n)||i];case"Placeholder":return[TQ(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[NQ(kQ("x",t,e,n))];case"IdentityN":return kQ("x",t,e,n).map((t=>NQ(t)));case"Shape":return[r.tensor1d(kQ("x",t,e,n).shape,"int32")];case"ShapeN":return kQ("x",t,e,n).map((t=>r.tensor1d(t.shape)));case"Size":return[r.scalar(kQ("x",t,e,n).size,"int32")];case"Rank":return[r.scalar(kQ("x",t,e,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const s=kQ("x",t,e,n),o=kQ("data",t,e,n),a=kQ("message",t,e,n),l=kQ("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,l));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Equal":return[r.equal(kQ("a",t,e,n),kQ("b",t,e,n))];case"NotEqual":return[r.notEqual(kQ("a",t,e,n),kQ("b",t,e,n))];case"Greater":return[r.greater(kQ("a",t,e,n),kQ("b",t,e,n))];case"GreaterEqual":return[r.greaterEqual(kQ("a",t,e,n),kQ("b",t,e,n))];case"Less":return[r.less(kQ("a",t,e,n),kQ("b",t,e,n))];case"LessEqual":return[r.lessEqual(kQ("a",t,e,n),kQ("b",t,e,n))];case"LogicalAnd":return[r.logicalAnd(kQ("a",t,e,n),kQ("b",t,e,n))];case"LogicalNot":return[r.logicalNot(kQ("a",t,e,n))];case"LogicalOr":return[r.logicalOr(kQ("a",t,e,n),kQ("b",t,e,n))];case"Select":case"SelectV2":return[r.where(kQ("condition",t,e,n),kQ("a",t,e,n),kQ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(kQ("a",t,e,n),kQ("b",t,e,n),kQ("transposeA",t,e,n),kQ("transposeB",t,e,n))];case"Einsum":return[r.einsum(kQ("equation",t,e,n),...kQ("tensors",t,e,n))];case"Transpose":return[r.transpose(kQ("x",t,e,n),kQ("perm",t,e,n))];case"_FusedMatMul":const[i,s]=kQ("fusedOps",t,e,n),o="biasadd"===i,a="prelu"===s,l=kQ("numArgs",t,e,n),c=kQ("leakyreluAlpha",t,e,n);if(o){if(a&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,h]=kQ("args",t,e,n);return[r.fused.matMul({a:kQ("a",t,e,n),b:kQ("b",t,e,n),transposeA:kQ("transposeA",t,e,n),transposeB:kQ("transposeB",t,e,n),bias:u,activation:s,preluActivationWeights:h,leakyreluAlpha:c})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"EuclideanNorm":return[r.euclideanNorm(kQ("x",t,e,n),kQ("axis",t,e,n),kQ("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(kQ("x",t,e,n),kQ("mean",t,e,n),kQ("variance",t,e,n),kQ("offset",t,e,n),kQ("scale",t,e,n),kQ("epsilon",t,e,n))];case"LRN":return[r.localResponseNormalization(kQ("x",t,e,n),kQ("radius",t,e,n),kQ("bias",t,e,n),kQ("alpha",t,e,n),kQ("beta",t,e,n))];case"Softmax":return[r.softmax(kQ("x",t,e,n))];case"LogSoftmax":return[r.logSoftmax(kQ("x",t,e,n))];case"SparseToDense":return[r.sparseToDense(kQ("sparseIndices",t,e,n),kQ("outputShape",t,e,n),kQ("sparseValues",t,e,n),kQ("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Max":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.max(kQ("x",t,e,n),i,s)]}case"Mean":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.mean(kQ("x",t,e,n),i,s)]}case"Min":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.min(kQ("x",t,e,n),i,s)]}case"Sum":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.sum(kQ("x",t,e,n),i,s)]}case"All":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.all(kQ("x",t,e,n),i,s)]}case"Any":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.any(kQ("x",t,e,n),i,s)]}case"ArgMax":{const i=kQ("axis",t,e,n);return[r.argMax(kQ("x",t,e,n),i)]}case"ArgMin":{const i=kQ("axis",t,e,n);return[r.argMin(kQ("x",t,e,n),i)]}case"Prod":{const i=kQ("axis",t,e,n),s=kQ("keepDims",t,e,n);return[r.prod(kQ("x",t,e,n),i,s)]}case"Cumprod":{const i=kQ("axis",t,e,n),s=kQ("exclusive",t,e,n),o=kQ("reverse",t,e,n);return[r.cumprod(kQ("x",t,e,n),i,s,o)]}case"Cumsum":{const i=kQ("axis",t,e,n),s=kQ("exclusive",t,e,n),o=kQ("reverse",t,e,n);return[r.cumsum(kQ("x",t,e,n),i,s,o)]}case"Bincount":const i=kQ("x",t,e,n),s=kQ("weights",t,e,n),o=kQ("size",t,e,n);return[r.bincount(i,s,o)];case"DenseBincount":{const i=kQ("x",t,e,n),s=kQ("weights",t,e,n),o=kQ("size",t,e,n),a=kQ("binaryOutput",t,e,n);return[r.denseBincount(i,s,o,a)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"ConcatV2":case"Concat":{const i=kQ("n",t,e,n),s=kQ("axis",t,e,n);let o=kQ("tensors",t,e,n);return o=o.slice(0,i),[r.concat(o,s)]}case"Gather":{const i=kQ("x",t,e,n),s=kQ("indices",t,e,n);return[r.gather(i,r.cast(s,"int32"),0)]}case"GatherV2":{const i=kQ("axis",t,e,n),s=kQ("batchDims",t,e,n),o=kQ("x",t,e,n),a=kQ("indices",t,e,n);return[r.gather(o,r.cast(a,"int32"),i,s)]}case"Reverse":{const i=kQ("dims",t,e,n),s=[];for(let t=0;t<i.length;t++)i[t]&&s.push(t);const o=kQ("x",t,e,n);return[r.reverse(o,s)]}case"ReverseV2":{const i=kQ("axis",t,e,n),s=kQ("x",t,e,n);return[r.reverse(s,i)]}case"Slice":{const i=kQ("begin",t,e,n),s=kQ("size",t,e,n);return[r.slice(kQ("x",t,e,n),i,s)]}case"StridedSlice":{const i=kQ("begin",t,e,n),s=kQ("end",t,e,n),o=kQ("strides",t,e,n),a=kQ("beginMask",t,e,n),l=kQ("endMask",t,e,n),c=kQ("ellipsisMask",t,e,n),u=kQ("newAxisMask",t,e,n),h=kQ("shrinkAxisMask",t,e,n),d=kQ("x",t,e,n);return[r.stridedSlice(d,i,s,o,a,l,c,u,h)]}case"Pack":return Co((()=>{const i=kQ("axis",t,e,n),s=kQ("tensors",t,e,n),o=s[0].shape,a=r.squeeze(s[0]).shape,l=s.map((t=>{const e=m(t.shape,o);if(!e&&!m(r.squeeze(t).shape,a))throw new Error("the input tensors shape does not match");return e?t:r.reshape(t,o)}));return[r.stack(l,i)]}));case"Unpack":{const i=kQ("axis",t,e,n),s=kQ("tensor",t,e,n);return r.unstack(s,i)}case"Tile":{const i=kQ("reps",t,e,n);return[r.tile(kQ("x",t,e,n),i)]}case"Split":case"SplitV":{const i=kQ("axis",t,e,n),s=kQ("numOrSizeSplits",t,e,n),o=kQ("x",t,e,n);return r.split(o,s,i)}case"ScatterNd":{const i=kQ("indices",t,e,n),s=kQ("values",t,e,n),o=kQ("shape",t,e,n);return[r.scatterND(i,s,o)]}case"GatherNd":{const i=kQ("x",t,e,n),s=kQ("indices",t,e,n);return[r.gatherND(i,s)]}case"SparseToDense":{const i=kQ("sparseIndices",t,e,n),s=kQ("outputShape",t,e,n),o=kQ("sparseValues",t,e,n),a=kQ("defaultValue",t,e,n);return[r.sparseToDense(i,o,s,o.dtype===a.dtype?a:r.cast(a,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:s,emptyRowIndicator:o,reverseIndexMap:a}=r.sparse.sparseFillEmptyRows(kQ("indices",t,e,n),kQ("values",t,e,n),kQ("denseShape",t,e,n),kQ("defaultValue",t,e,n));return[i,s,o,a]}case"SparseReshape":{const{outputIndices:i,outputShape:s}=r.sparse.sparseReshape(kQ("inputIndices",t,e,n),kQ("inputShape",t,e,n),kQ("newShape",t,e,n));return[i,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(kQ("data",t,e,n),kQ("indices",t,e,n),kQ("segmentIds",t,e,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(kQ("data",t,e,n),kQ("indices",t,e,n),kQ("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"FFT":return[r.fft(kQ("x",t,e,n))];case"IFFT":return[r.ifft(kQ("x",t,e,n))];case"RFFT":return[r.rfft(kQ("x",t,e,n))];case"IRFFT":return[r.irfft(kQ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"StringNGrams":{const{nGrams:i,nGramsSplits:s}=r.string.stringNGrams(kQ("data",t,e,n),kQ("dataSplits",t,e,n),kQ("separator",t,e,n),kQ("nGramWidths",t,e,n),kQ("leftPad",t,e,n),kQ("rightPad",t,e,n),kQ("padWidth",t,e,n),kQ("preserveShortSequences",t,e,n));return[i,s]}case"StringSplit":{const{indices:i,values:s,shape:o}=r.string.stringSplit(kQ("input",t,e,n),kQ("delimiter",t,e,n),kQ("skipEmpty",t,e,n));return[i,s,o]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(kQ("input",t,e,n),kQ("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return i((()=>((t,e,n,r=d0)=>{switch(t.op){case"Cast":return[r.cast(kQ("x",t,e,n),kQ("dtype",t,e,n))];case"ExpandDims":{const i=kQ("axis",t,e,n);return[r.expandDims(kQ("x",t,e,n),i)]}case"Squeeze":{const i=kQ("axis",t,e,n);return[r.squeeze(kQ("x",t,e,n),i)]}case"Reshape":return[r.reshape(kQ("x",t,e,n),kQ("shape",t,e,n))];case"MirrorPad":return[r.mirrorPad(kQ("x",t,e,n),kQ("padding",t,e,n),kQ("mode",t,e,n))];case"PadV2":case"Pad":return[r.pad(kQ("x",t,e,n),kQ("padding",t,e,n),kQ("constantValue",t,e,n))];case"SpaceToBatchND":{const i=kQ("blockShape",t,e,n),s=kQ("paddings",t,e,n);return[r.spaceToBatchND(kQ("x",t,e,n),i,s)]}case"BatchToSpaceND":{const i=kQ("blockShape",t,e,n),s=kQ("crops",t,e,n);return[r.batchToSpaceND(kQ("x",t,e,n),i,s)]}case"DepthToSpace":{const i=kQ("blockSize",t,e,n),s=kQ("dataFormat",t,e,n).toUpperCase();return[r.depthToSpace(kQ("x",t,e,n),i,s)]}case"BroadcastTo":return[r.broadcastTo(kQ("x",t,e,n),kQ("shape",t,e,n))];case"BroadcastArgs":return[r.broadcastArgs(kQ("s0",t,e,n),kQ("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=kQ("keyDType",t,e,n),s=kQ("valueDType",t,e,n),o=new _0(i,s);return r.addHashTable(t.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=kQ("tableHandle",t,e,n,r),s=kQ("keys",t,e,n),o=kQ("values",t,e,n),a=r.getHashTableById(i.id);return[await a.import(s,o)]}case"LookupTableFind":case"LookupTableFindV2":{const i=kQ("tableHandle",t,e,n,r),s=kQ("keys",t,e,n),o=kQ("defaultValue",t,e,n),a=r.getHashTableById(i.id);return[await a.find(s,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=kQ("tableHandle",t,e,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=SQ(t.op);if(s&&s.customExecutor)return s.customExecutor(new h0(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return G(s)?s.then((t=>[].concat(t))):[].concat(s)}class k0{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function T0(t,e,n,r){const i=new Set,s=[];let o=null,a=null;const l=new Set,c=Object.keys(t).map((t=>CQ(t)[0]));let u=[];null!=r&&(u=r.map((t=>CQ(t.name)[0])));const h=[...e];for(;h.length>0;){const t=h.pop();(A0(t)||N0(t)||I0(t))&&null==o&&(o=t,a=o.children.map((t=>t.name)).filter((t=>i.has(t)))),i.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===u.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{l.has(t.name)||(l.add(t.name),h.push(t))})):s.push(t.name)))}return{inputs:t,outputs:e,usedNodes:i,missingInputs:s,dynamicNode:o,syncInputs:a}}const E0=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],M0=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],C0=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function A0(t){return E0.indexOf(t.op)>=0}function N0(t){return M0.indexOf(t.op)>=0}function I0(t){return C0.indexOf(t.op)>=0}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class $0{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new $0(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=T0(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:s}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(r.length>0){const n=e.map((t=>t.name)),i=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:i}=n,s=[],o=Object.keys(i).map((t=>CQ(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;o.forEach((t=>{r.has(t.name)&&s.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&s.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&s.push(t)}));const l=new Set,c=[];for(;s.length>0;){const t=s.pop();l.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!l.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>l.has(t.name)))&&s.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[CQ(t)[0]])),i=e.map((t=>CQ(t)[0]));let s=i.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let a=this.compiledMap.get(o);null==a&&(a=this.compile(t,s),this.compiledMap.set(o,a));const l={},c={};return Co((()=>{const n=new k0(this.weightMap,l,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,i]=CQ(e),s=[];s[i]=t[e],r[n]=s}));const s=this.getFrozenTensorIds(r),o={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=S0(e,r,n,this._resourceManager);if(G(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,s,i,o)}}return null==this.parent&&n.dispose(s),e.map((t=>TQ(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,i,s,o){"control"!==e.category&&-1===s.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(o[t.id]=(o[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const s=function(t,e,n){return e[MQ(t,n.currentContextId)]}(t.name,n,r);null!=s&&s.forEach((t=>{if(t&&!t.kept&&!i.has(t.id)){const n=o[t.id];if(1===n){if(this.keepTensorForDebug){const[n,i]=EQ(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][i]=t}else t.dispose();delete o[t.id]}else null!=n&&o[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},i={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=K().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const s=new k0(this.weightMap,r,i,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,s,e,n);const o=e.map((t=>TQ(t,this.tensorsMap,s))),a=o.map((t=>t.id)),l=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...l,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&s.dispose(this.keepIds),o}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const i=Object.keys(t),s=i.map((t=>this.graph.nodes[CQ(t)[0]])),o=n.map((t=>CQ(t)[0]));let a=o.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:l,missingInputs:c,dynamicNode:u,syncInputs:h}=T0(t,a,this.weightMap,this._initNodes),d=[...s,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=CQ(e),i=[];i[r]=t[e],p[n]=i}));const f={},m=this.getFrozenTensorIds(p),g={};for(;d.length>0;){const t=this.processStack(s,d,e,p,g,m,o,f,l);await Promise.all(t)}null!=u||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=a.filter((t=>!A0(t)&&!TQ(t.name,p,e))).map((t=>t.name));if(y.length>0){let t="";throw null!=u&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${y}] from the provided inputs [${i}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,i,s,o,a,l){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let u="";if("Enter"===t.node.op&&kQ("isConstant",t.node,r,n)&&([u]=EQ(t.node.name,n)),null==r[t.node.name]){const h=S0(t.node,r,n,this._resourceManager);u||([u]=EQ(t.node.name,n));const d=n.currentContext;G(h)?c.push(h.then((c=>(r[u]=c,n.currentContext=d,this.checkTensorForDisposal(u,t.node,r,n,s,o,a),this.processChildNodes(t.node,e,n,r,i,l),c)))):(r[u]=h,this.checkTensorForDisposal(u,t.node,r,n,s,o,a),this.processChildNodes(t.node,e,n,r,i,l))}else this.processChildNodes(t.node,e,n,r,i,l)}return c}processChildNodes(t,e,n,r,i,s){t.children.forEach((t=>{const[o]=EQ(t.name,n);!i[o]&&s.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!TQ(t,r,n)))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!TQ(t,r,n)))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=CQ(e),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const t=i.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));u(e,(()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}i.attrParams.dtype&&i.attrParams.dtype.value&&u(n.dtype===i.attrParams.dtype.value,(()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=CQ(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=CQ(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class R0{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class O0{constructor(t,e={},n=So){this.modelUrl=t,this.loadOptions=e,this.version="n/a",this.io=n,null==e&&(this.loadOptions={}),this.resourceManager=new R0}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{const e=this.io.getLoadHandlers(t,this.loadOptions);if(0===e.length)e.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return G(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const t=this.artifacts.userDefinedMetadata;null!=t.signature&&(n=t.signature),null!=t.structuredOutputKeys&&(this.structuredOutputKeys=t.structuredOutputKeys)}this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new $0(KQ.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=KQ.Instance.transformGraph(t.modelInitializer);this.initializer=new $0(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=this.io.getSaveHandlers(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){const n=this.execute(t,this.outputNodes);if(this.structuredOutputKeys){const t={};return(n instanceof Si?[n]:n).forEach(((e,n)=>t[this.structuredOutputKeys[n]]=e)),t}return n}normalizeInputs(t){if(!(t instanceof Si||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function P0(t,e={},n=So){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const r=new O0(t,e,n);return await r.load(),r}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
var L0=Object.freeze({__proto__:null,GraphModel:O0,loadGraphModel:P0,loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[n,r]=t;if(!n)throw new Error("modelJSON must be the first element of the array");if(!(r&&r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");e=wo(gs(n,vs(n.weightsManifest),r))}else if("load"in t)e=t;else{if(!("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t))throw new Error("Unknown model format");e=wo(t)}const n=new O0(e);return n.load(),n},deregisterOp:function(t){delete _Q[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};_Q[t]=n},version_converter:"3.21.0"});
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class D0 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,D0.prototype)}}class F0 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,F0.prototype)}}class z0 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,z0.prototype)}}class B0 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,B0.prototype)}}class U0 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,U0.prototype)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class V0{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const t=this.cache.keys().next().value;this.cache.delete(t)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const t=this.cache.keys().next().value;this.cache.delete(t)}this.maxEntries=t}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function j0(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function W0(t,e){if(!t)throw new U0(e)}function H0(t,e){let n=0;for(const r of t)r===e&&n++;return n}function G0(t){return 1===t.length?t[0]:t}function q0(t){return Array.isArray(t)?t:[t]}function X0(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function Y0(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let K0={};function Z0(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function J0(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>J0(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?J0(e):t[n]=e.value)}}}function Q0(t,e={},n={},r="object",i=!1){if("string"==typeof t){const i=t;let s;if(i in n)s=n[i];else if(i in K0)s=K0[i];else if(s=e[i],null==s)throw new z0(`Unknown ${r}: ${t}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new z0(`${r}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const o=s.className;let a,l;if(o in n?[a,l]=n[o]:o in K0?[a,l]=K0.className:o in e&&([a,l]=e[o]),null==a)throw new z0(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const t={};for(const e of Object.keys(K0))t[e]=K0[e];for(const e of Object.keys(n))t[e]=n[e];s.config.customObjects=t;const e=Object.assign({},K0);for(const t of Object.keys(n))K0[t]=n[t];J0(s.config);const r=l(a,s.config,n,i);return K0=Object.assign({},e),r}{const t=Object.assign({},K0);for(const t of Object.keys(n))K0[t]=n[t];const e=new a(s.config);return K0=Object.assign({},t),e}}}function t1(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function e1(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function n1(t){if(null==t)throw new z0(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function r1(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new z0(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function i1(t,e,n=0,r=1/0){return W0(n>=0),W0(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((t=>typeof t===e))}function s1(t,e){Array.isArray(t)?(u(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>s1(t,`element ${n+1} of ${e}`)))):u(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${o1(t)}.`))}function o1(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>o1(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function a1(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */let l1=0;function c1(){return l1++}const u1={};function h1(t=""){return t in u1||(u1[t]=0),u1[t]+=1,t+u1[t].toString()}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const d1=["channelsFirst","channelsLast"],p1=["nearest","bilinear"],f1=["valid","same","causal"],m1=["max","avg"],g1=["sum","mul","concat","ave"],y1=new Map;function b1(t){r1(d1,"DataFormat",t)}function v1(t){r1(f1,"PaddingMode",t)}function x1(t){r1(m1,"PoolMode",t)}const w1=[];function _1(t,e){w1.push(t);try{const t=e();return w1.pop(),t}catch(t){throw w1.pop(),t}}function S1(t){if(!E1(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===w1.length?"":w1.join("/")+"/")+t}function k1(t){if(!E1(t))throw new Error("Not a valid tensor name: '"+t+"'");y1.has(t)||y1.set(t,0);const e=y1.get(t);if(y1.set(t,y1.get(t)+1),e>0){const n=`${t}_${e}`;return y1.set(n,1),n}return t}const T1=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function E1(t){return!!t.match(T1)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function M1(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function C1(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function A1(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function N1(t,e){if(e<t)throw new z0(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */let I1;function $1(){return null==I1&&(I1=Ro().epsilon()),I1}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function R1(t,e){return no(t,e)}function O1(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),il(t,n)}function P1(t,e,n){return Co((()=>{switch(t.rank){case 1:return uh(t,e,n);case 2:return hh(t,[e,0],[n,t.shape[1]]);case 3:return dh(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return ph(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return cl(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return cl(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new z0(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function L1(t,e,n){return Co((()=>{switch(t.rank){case 1:return uh(t,e,n);case 2:return hh(t,[0,e],[t.shape[0],n]);case 3:return dh(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return ph(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new z0(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function D1(t,e,n,r){return Co((()=>{switch(t.rank){case 1:return uh(t,e,n);case 2:switch(r){case 1:return P1(t,e,n);case 2:return L1(t,e,n);default:throw new z0(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return P1(t,e,n);case 2:return dh(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return L1(t,e,n);default:throw new z0(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return P1(t,e,n);case 2:return ph(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return ph(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return L1(t,e,n);default:throw new z0(`The axis is not within the rank of the tensor ${r}`)}default:throw new z0(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function F1(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),al(t,e)}function z1(t,e){switch(t.rank){case 1:return Sl([t,e]);case 2:return kl([t,e],0);case 3:return Tl([t,e],0);case 4:return El([t,e],0);default:throw new z0(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function B1(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new z0(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return bc(t,e)}function U1(t,e=0,n=1,r,i){return Wu(t,e,n,r,i)}function V1(t,e,n,r){if(t.rank<2||e.rank<2)throw new B0(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){if(t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new B0(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){return id({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?H1(t.rank,r,"channelsLast"):null,activation:n})}{const i=t.shape.slice(),s=i.pop();t=il(t,[-1,s]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=il(Do(e,u),[l,-1]);const h=[...i,...c];return il(id({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?H1(t.rank,r,"channelsLast"):null,activation:n}),h)}}function j1(t,e,n){return Co((()=>(e=Array.isArray(e)?Eh(e,"int32"):no(e,"int32"),wc(t,e,n))))}function W1(t){return Na(t,t)}function H1(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new z0(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===r.length?il(e,[1,r[0],1,1,1]):il(e,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?il(e,[1,1,1,1,r[0]]):il(e,[1].concat(r))}else if(4===t){if("channelsFirst"===n)return 1===r.length?il(e,[1,r[0],1,1]):il(e,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?il(e,[1,1,1,r[0]]):il(e,[1].concat(r))}else if(3===t){if("channelsFirst"===n)return 1===r.length?il(e,[1,r[0],1]):il(e,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?il(e,[1,1,r[0]]):il(e,[1].concat(r))}else if(t<3)return e;throw new z0(`Unsupported input rank by biasAdd: ${e.rank}`)}function G1(t,e,n){return Co((()=>(null==n&&(n="channelsLast"),b1(n),Ma(t,H1(t.rank,e,n)))))}function q1(t,e,n,r){return Co((()=>Hh(t,e,n,r)))}function X1(t,e,n=!1){return n?t():e()}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const Y1=["fanIn","fanOut","fanAvg"],K1=["normal","uniform","truncatedNormal"];class Z1 extends va{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class J1 extends Z1{apply(t,e){return tu(t,e)}}J1.className="Zeros",wa(J1);class Q1 extends Z1{apply(t,e){return eu(t,e)}}Q1.className="Ones",wa(Q1);class t2 extends Z1{constructor(t){if(super(),"object"!=typeof t)throw new z0(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new z0(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return Co((()=>Na(lc(this.value),eu(t,e))))}getConfig(){return{value:this.value}}}t2.className="Constant",wa(t2);class e2 extends Z1{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Gu(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}e2.className="RandomUniform",wa(e2);class n2 extends Z1{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new B0(`randomNormal does not support dType ${e}.`);return U1(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}n2.className="RandomNormal",wa(n2);class r2 extends Z1{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new B0(`truncatedNormal does not support dType ${e}.`);return $h(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}r2.className="TruncatedNormal",wa(r2);class i2 extends Z1{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return Co((()=>{if(2!==t.length||t[0]!==t[1])throw new z0("Identity matrix initializer can only be used for 2D square matrices.");return Na(this.gain,vc(t[0]))}))}getConfig(){return{gain:this.gain}}}i2.className="Identity",wa(i2);class s2 extends Z1{constructor(t){if(super(),t.scale<0)throw new z0(`scale must be a positive float. Got: ${t.scale}`);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,r1(Y1,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){r1(K1,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,r;if(b1(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=M1(t,2);n=t[1]*e,r=t[0]*e}else if("channelsLast"===e){const e=M1(t,0,t.length-2);n=t[t.length-2]*e,r=t[t.length-1]*e}}else{const e=M1(t);n=Math.sqrt(e),r=Math.sqrt(e)}return[n,r]}(t),r=n[0],i=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,r):"fanOut"===this.mode?s/=Math.max(1,i):s/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new B0(`${this.getClassName()} does not support dType ${e}.`);return $h(t,0,n,e,this.seed)}{const n=Math.sqrt(3*s);return Gu(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}s2.className="VarianceScaling",wa(s2);class o2 extends s2{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return s2.className}}o2.className="GlorotUniform",wa(o2);class a2 extends s2{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return s2.className}}a2.className="GlorotNormal",wa(a2);class l2 extends s2{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return s2.className}}l2.className="HeNormal",wa(l2);class c2 extends s2{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return s2.className}}c2.className="HeUniform",wa(c2);class u2 extends s2{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return s2.className}}u2.className="LeCunNormal",wa(u2);class h2 extends s2{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return s2.className}}h2.className="LeCunNormal",wa(h2);class d2 extends Z1{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new B0("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return Co((()=>{if(t.length<2)throw new B0("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=U1(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32");let n=ip.gramSchmidt(e);return t[0]>t[1]&&(n=Do(n)),Na(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}d2.className="Orthogonal",wa(d2);const p2={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function f2(t,e={}){return Q0(t,xa.getMap().classNameMap,e,"initializer")}function m2(t){return Z0(t)}function g2(t){if("string"==typeof t){const e=t in p2?p2[t]:t;if("GlorotNormal"===e)return new a2;if("GlorotUniform"===e)return new o2;if("HeNormal"===e)return new l2;if("HeUniform"===e)return new c2;if("LeCunNormal"===e)return new u2;if("LeCunUniform"===e)return new h2;{const t={};return t.className=e,t.config={},f2(t)}}return t instanceof Z1?t:f2(t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function y2(t){return Array.isArray(t)&&Array.isArray(t[0])}function b2(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function v2(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new z0(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function x2(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return t[0];throw new z0(`Expected exactly 1 Shape; got ${t.length}`)}return t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function w2(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const _2="Variable";class S2{constructor(t,e="float32",n="Variable",r=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=c1(),n=null==n?_2:n,this.originalName=S1(n),this.name=k1(this.originalName),this.trainable_=r,this.constraint=i,this.val=Dh(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function k2(t){return t.map((t=>t.read()))}function T2(t){t.forEach((t=>{t[0].write(t[1])}))}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class E2{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class M2{constructor(t,e,n,r,i,s,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=c1(),null!=s&&(this.originalName=S1(s),this.name=k1(this.originalName)),this.rank=e.length}}let C2=0;class A2{constructor(t,e){this.callArgs=e,this.id=C2++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const e of t.inboundLayers)null!=e&&e.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let N2=0;class I2 extends va{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=N2++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=X0(t)+"_"+h1(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new F0(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new z0(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return G0(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return G0(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new D0(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new D0(`Layer ${this.name} is not connected, no input to return.`);return G0(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new D0(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new D0(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return G0(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=q0(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=q0(this.inputSpec);if(t.length!==e.length)throw new z0(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(null==i)continue;const s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new z0(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new z0(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new z0(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new z0(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const t=r.shape;for(const e in i.axes){const r=Number(e),s=i.axes[e],o=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(o))throw new z0(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],s=r.shape[t];if(null!=e&&null!=s&&e!==s)throw new z0(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=q0(t);let r=!0;for(const t of n)if(!(t instanceof M2)){r=!1;break}let i=!0;for(const t of n)if(t instanceof M2){i=!1;break}if(r===i)throw new z0("Arguments to apply() must be all SymbolicTensors or all Tensors");return _1(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of q0(t))e.push(n.shape);this.build(G0(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let r=this.call(t,e);const i=q0(r),s=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(r=G0(s),null!=this.activityRegularizer)throw new B0("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(t){t=q0(t);const e=[];for(const n of t)e.push(n.shape);return G0(e)}(t),r=this.computeOutputShape(n);let i;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new M2(s,n,this,q0(t),e,this.name,r))):new M2(s,r,this,q0(t),e,this.name),this.addInboundNode(t,i,null,null,n,r,e),this._refCount++,null!=this.activityRegularizer)throw new B0("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new D0(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new D0(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new F0(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return w2(this.weights)}build(t){this.built=!0}getWeights(t=!1){return k2(t?this.trainableWeights:this.weights)}setWeights(t){Co((()=>{const e=this.weights;if(e.length!==t.length)throw new z0(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],r=k2(e);for(let i=0;i<r.length;++i){const s=r[i],o=e[i],a=t[i];if(!m(s.shape,a.shape))throw new z0(`Layer weight shape ${s.shape} not compatible with provided weight shape ${a.shape}`);n.push([o,a])}T2(n)}))}addWeight(t,e,n,r,i,s,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new z0(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=a?a():g2("zeros"));const l=r.apply(e,n),c=new S2(l,n,t,s,o);return l.dispose(),null!=i&&this.addLoss((()=>i.apply(c.read()))),null==s&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=q0(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,r,i,s,o=null){const a=q0(t);e=q0(e),n=q0(n),r=q0(r),i=b2(i),s=b2(s);const l=[],c=[],u=[];for(const t of a)l.push(t.sourceLayer),c.push(t.nodeIndex),u.push(t.tensorIndex);new A2({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},o);for(let t=0;t<e.length;t++)e[t].sourceLayer=this,e[t].nodeIndex=this.inboundNodes.length-1,e[t].tensorIndex=t}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function $2(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const r=$2(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of r)-1===e.indexOf(t)&&e.push(t)}return e}}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class R2 extends I2{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:h1("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new z0("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new z0("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new z0("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const r=new M2(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new A2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new z0(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}R2.className="InputLayer",wa(R2);class O2{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof O2)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new z0(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return no(e,t.dtype)}catch(n){throw new z0(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof M2){if(null==this.id2Value[t.id])throw new z0(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new z0(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof M2){if(null==this.id2Value[t.id])throw new z0(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new z0(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&Ao(this.id2Mask)}}const P2=new V0,L2=new V0;function D2(t,e,n,r){const i=null!=n&&n.training,s=Array.isArray(t),o=s?t:[t],a=o.map((t=>t.name)),l=[],c=e.names();for(const t of a)-1!==c.indexOf(t)?l.push(e.getValue(t)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const h=a.join(",")+"|"+e.names().sort().join(",");let d,p=P2.get(h);if(null==p){const t=function(t,e){u(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===t.length){const i=z2(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:t,recipientMap:o}=z2(s,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:F2(r)}}(o,e);p=t.sorted,d=t.recipientCounts,P2.put(h,p),L2.put(h,d)}d={},i||Object.assign(d,L2.get(h));const f=new O2(e);for(let t=0;t<p.length;++t){if(null!=r){const t=Mo().numTensors;t>r.maxNumTensors&&(r.maxNumTensors=t),t<r.minNumTensors&&(r.minNumTensors=t)}const s=p[t],o=s.sourceLayer;if(o instanceof R2)continue;const c=[],u=[],h=[];let m=!1;for(const t of s.inputs){const n=f.getValue(t),r=f.getMask(t);c.push(n),u.push(r),null!=r&&(m=!0),i||(d[t.name]--,0!==d[t.name]||e.hasKey(t)||-1!==a.indexOf(t.name)||n.isDisposed||!0===t.sourceLayer.stateful||h.push(n))}m&&((n=n||{}).mask=u[0]);const g=q0(o.apply(c,n));let y=null;o.supportsMasking&&(y=o.computeMask(c,u));const b=B2(s),v=Array.isArray(b)?b:[b];for(let t=0;t<v.length;++t){f.hasKey(v[t])||f.add(v[t],g[t],Array.isArray(y)?y[0]:y);const e=a.indexOf(v[t].name);-1!==e&&(l[e]=g[t])}i||Ao(h)}return f.disposeMasks(),s?l:l[0]}function F2(t){const e={};for(const n in t)e[n]=t[n].size;return e}function z2(t,e){const n=new Set,r=[],i={};for(const t of e.names())n.add(t);const s=[],o=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=o[o.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),r.push(t),n.add(t.name),e&&o.pop();else{o.push(s.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:r,recipientMap:i}}function B2(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const r of t.sourceLayer.inboundNodes[e].outputTensors)if(r.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */K().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(t){null!=P2&&P2.setMaxEntries(t),null!=L2&&L2.setMaxEntries(t)}));
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const U2={kernelName:et,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,Sh(no(n,"float32"),-1))}}},V2={kernelName:nt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=uc(no(n,"float32")),r=cc(zc(lc(1),e));return Po(Aa(t,r))}}}},j2={kernelName:rt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=cc(zc(uc(no(n,"float32")),1));return Aa(t,e)}}}},W2={kernelName:it,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{let e=t;const r=Uo(n.shape,i);return r.length>0&&(e=hc(e,r)),il(e,n.shape)},b:()=>{let e=t;const n=Uo(r.shape,i);return n.length>0&&(e=hc(e,n)),il(e,r.shape)}}}},H2={kernelName:st,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,r)=>{n[r]=()=>t.clone()})),n}},G2={kernelName:lt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hl(n)}}},q2={kernelName:ct,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hl(n)}}},X2={kernelName:ut,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,cc(zc(lc(1),uc(no(n,"float32")))))}}},Y2={kernelName:ht,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=cc(Ma(lc(1),uc(no(n,"float32"))));return Aa(t,e)}}}},K2={kernelName:ft,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{const e=Ma(uc(n),uc(r));let s=Na(t,Aa(r,e));const o=Uo(n.shape,i);return o.length>0&&(s=hc(s,o)),il(s,n.shape)},b:()=>{const e=Ma(uc(n),uc(r));let s=Po(Na(t,Aa(n,e)));const o=Uo(r.shape,i);return o.length>0&&(s=hc(s,o)),il(s,r.shape)}}}},Z2={kernelName:dt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,Ma(uc(no(n,"float32")),1))}}},J2={kernelName:pt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,zc(lc(1),uc(no(n,"float32"))))}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Q2=rs({avgPool3dGrad_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i,s){const o=ts(t,"dy","avgPool3dGrad"),a=ts(e,"input","avgPool3dGrad");let l=o,c=a,h=!1;4===a.rank&&(h=!0,l=il(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=il(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),u(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),u(5===c.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`)),rl("avgPool3dGrad",i,s);const d={dy:l,input:c},p={filterSize:n,strides:r,pad:i,dimRoundingMode:s},f=Wi.runKernel(bt,d,p);return h?il(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),t3={kernelName:yt,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>Q2(t,r,i,s,o,a)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const e3=rs({avgPoolGrad_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i){const s=ts(t,"dy","avgPoolGrad"),o=ts(e,"input","avgPoolGrad");u(o.rank===s.rank,(()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`));let a=o,l=s,c=!1;3===o.rank&&(c=!0,a=il(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=il(s,[1,s.shape[0],s.shape[1],s.shape[2]])),u(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),u(4===a.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`));const h={dy:l,input:a},d={filterSize:n,strides:r,pad:i},p=Wi.runKernel(gt,h,d);return c?il(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),n3={kernelName:mt,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o}=n;return{x:()=>e3(t,r,i,s,o)}}},r3={kernelName:vt,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:o}=n;return s||o?!s&&o?{a:()=>ko(t,i,!1,!1),b:()=>ko(t,r,!0,!1)}:s&&!o?{a:()=>ko(i,t,!1,!0),b:()=>ko(r,t,!1,!1)}:{a:()=>ko(i,t,!0,!0),b:()=>ko(t,r,!0,!0)}:{a:()=>ko(t,i,!1,!0),b:()=>ko(r,t,!0,!1)}}},i3={kernelName:xt,gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>yu(t,r,i)}}},s3={kernelName:_t,gradFunc:(t,e,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let t=i.length-1;t>=0;t--)if(i[t]===s[t])o[t]=1;else if(1!==i[t])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let t=0;t<o.length;t++)o[t]>1&&a.push(t);return{x:()=>hc(t,a,!0)}}},o3={kernelName:kt,gradFunc:t=>({x:()=>t.clone()})},a3={kernelName:Tt,gradFunc:t=>({x:()=>Hl(t)})},l3={kernelName:Et,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Wl(Vc(Sc(r,i),Ac(r,s)),t,Hl(t))}}},c3={kernelName:Ct,inputsToSave:["x"],gradFunc:U2.gradFunc},u3={kernelName:At,saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map((t=>t.shape)),{axis:i}=n,s=w(i,e[0].shape)[0],o=r.map((t=>t[s]));return bh(t,o,s).map((t=>()=>t))}},h3={kernelName:Nt,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:o,pad:a,dataFormat:l}=n;return u(tl(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>Al(r.shape,t,i,o,a,l),filter:()=>Yh(r,t,i.shape,o,a,l)}}},d3={kernelName:$t,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Ml(t,i,s,o,a,1,l),filter:()=>Yh(t,r,i.shape,s,o,a,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const p3=rs({conv3DBackpropFilter_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i){let s=t;4===t.rank&&(s=il(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;4===o.rank&&(o=il(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),u(5===s.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`)),u(5===o.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`)),u(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),u(s.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`)),u(o.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`));const a={x:s,dy:o},l={strides:r,pad:i,filterShape:n};return Wi.runKernel(Ot,a,l)}}),f3={kernelName:Rt,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;u(tl(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[o,a]=e;return{x:()=>$l(o.shape,t,a,i,s),filter:()=>p3(o,t,a.shape,i,s)}}},m3={kernelName:Lt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(Po(lh(no(n,"float32"))),t)}}},g3={kernelName:Dt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(ch(no(n,"float32")),t)}}},y3={kernelName:zt,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const e=nc([i],r.rank);let n=Dl(t,i,s,!o);return null!=e&&(n=Do(n,e)),n}}}},b3={kernelName:jt,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=null==r?[1,1]:r;u(tl(a),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[l,c]=e;return u(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`)),u(4===c.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`)),u(l.shape[3]===c.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`)),u(el(i,a),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`)),rl("depthwiseConv2d",s,o),{x:()=>nd(l.shape,t,c,i,s,a,o),filter:()=>ed(l,t,c.shape,i,s,a,o)}}},v3={kernelName:qt,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},o={x:r,filter:i,dy:t};return{x:()=>Wi.runKernel(Xt,s,n),filter:()=>Wi.runKernel(Yt,o,n)}}},x3={kernelName:Jt,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>Wi.runKernel(Qt,r)}}},w3={kernelName:te,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Na(mc(Po(uc(n))),2/Math.sqrt(Math.PI));return{x:()=>Na(t,r)}}},_3={kernelName:ne,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,n)}}},S3={kernelName:re,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>il(t,n.shape)}}},k3={kernelName:ie,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,mc(n))}}},T3={kernelName:le,gradFunc:t=>({x:()=>Hl(t)})},E3={kernelName:ce,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{const e=Aa(t,no(r,"float32")),s=Uo(n.shape,i);return s.length>0?il(hc(e,s),n.shape):e},b:()=>{let e=Na(t,no(n,"float32"));const s=Uo(r.shape,i);s.length>0&&(e=il(hc(e,s),r.shape));const o=uc(r);return Po(Aa(e,no(o,"float32")))}}}},M3={kernelName:ue,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=e,l=null==a?lc(1):a,c=Uo(s.shape,i.shape),u=[];if(1===s.rank){for(let t=0;t<i.shape.length-1;++t)u.push(i.shape[t]);u.push(1)}const h=zc(i,s),d=Na(t,l),p=rh(Ma(o,lc(r))),f=Na(Na(Na(p,p),p),lc(-.5));return{x:()=>1===s.rank?il(Na(Na(t,bc(il(p,[1,1,1,s.shape[0]]),u)),l),i.shape):il(Na(Na(t,p),l),i.shape),mean:()=>{let t=Na(Na(p,lc(-1)),d);return 1===s.rank&&(t=hc(t,c)),il(t,s.shape)},variance:()=>{let t=Na(Na(f,h),d);return 1===s.rank&&(t=hc(t,c)),il(t,s.shape)},scale:()=>{const e=Na(h,p);let n=Na(t,e);return 1===s.rank&&(n=hc(n,c)),il(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=hc(e,c)),il(e,s.shape)}}}},C3={kernelName:he,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,o=w(s,r.shape)[0];return{x:()=>{const e=r.shape,n=i.size,a=e.slice(0,o),l=a.length,c=e.slice(s,e.length).slice(1),u=c.length,h=A3(0,l),d=A3(l+1,l+1+u),p=N3([a,[n],c]),f=il(t,p),m=il(i,[n]),g=N3([[l],h,d]),y=Do(f,g);let b=Oh(y,m,r.shape[o]);const v=rc(g);return b=Do(b,v),b},indices:()=>i}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function A3(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function N3(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const I3={kernelName:fe,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Hl(n),b:()=>Hl(r)}}},$3={kernelName:me,gradFunc:t=>({x:()=>no(t,"float32")})},R3={kernelName:be,gradFunc:t=>({x:()=>Hl(t)})},O3={kernelName:ve,gradFunc:t=>({x:()=>Hl(t)})},P3={kernelName:xe,gradFunc:t=>({x:()=>Hl(t)})},L3={kernelName:we,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:i}=n,s=_c(r,0);return{x:()=>Wl(s,t,Na(t,i))}}},D3={kernelName:Ee,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,Ma(n,1))}}},F3={kernelName:Te,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,no(n,"float32"))}}},z3={kernelName:Ne,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const e=mc(r);return zc(t,Na(hc(t,i,!0),e))}}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const B3=rs({localResponseNormalizationBackprop_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r=5,i=1,s=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:r,bias:i,alpha:s,beta:o};return Wi.runKernel($e,a,l)}}),U3={kernelName:Ie,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:o,alpha:a,beta:l}=n;return{x:()=>B3(r,i,t,s,o,a,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function V3(t,e,n,r){return e.rank<n.rank&&(e=il(e,tc(e.shape,r))),t.rank<n.rank&&(t=il(t,tc(t.shape,r))),{x:()=>Na(t,no(jl(n,e),t.dtype))}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const j3={kernelName:Re,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,s=e[0],o=V3(t,e[1],s,w(i,s.shape));return{x:()=>o.x()}}},W3={kernelName:Oe,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Na(t,no(Sc(n,r),"float32")),b:()=>Na(t,no(Cc(n,r),"float32"))}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const H3=rs({maxPool3dGrad_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i,s,o){const a=ts(t,"dy","maxPool3dGrad"),l=ts(e,"input","maxPool3dGrad"),c=ts(n,"output","maxPool3dGrad");let h=a,d=l,p=c,f=!1;4===l.rank&&(f=!0,h=il(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=il(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=il(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),u(5===h.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`)),u(5===d.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`)),u(5===p.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`)),rl("maxPool3dGrad",s,o);const m={dy:h,input:d,output:p},g={filterSize:r,strides:i,pad:s,dimRoundingMode:o},y=Wi.runKernel(Fe,m,g);return f?il(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),G3={kernelName:De,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>H3(t,r,i,s,o,a,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const q3=rs({maxPoolGrad_:
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n,r,i,s,o){const a=ts(t,"dy","maxPoolGrad"),l=ts(e,"input","maxPoolGrad"),c=ts(n,"output","maxPoolGrad");u(l.rank===a.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`)),u(4===a.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`)),u(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),rl("maxPoolGrad",s,o);const h={dy:a,input:l,output:c},d={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return Wi.runKernel(Le,h,d)}}),X3={kernelName:Pe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>q3(t,r,i,s,o,a)}}},Y3={kernelName:Ue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,o]=e,a=V3(t,o,s,w(i,s.shape));return{x:()=>a.x()}}},K3={kernelName:je,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>cl(t,s,r.shape)}}},Z3={kernelName:tn,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return Ph(t,r).map((t=>()=>t))}},J3={kernelName:en,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>cl(t,s,r.shape)}}},Q3={kernelName:nn,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,o=r,a=Vo(s.shape,o.shape);return{a:()=>{const e=no(o,"float32");let n=Na(t,Na(e,ac(s,zc(e,lc(1)))));const r=Uo(s.shape,a);return r.length>0&&(n=hc(n,r)),il(n,s.shape)},b:()=>{const e=_c(s,0),n=Wl(e,$c(s),Hl(s));let r=Na(t,Na(i,n));const l=Uo(o.shape,a);return l.length>0&&(r=hc(r,l)),il(r,o.shape)}}}},t4={kernelName:rn,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=_c(n,0);return{x:()=>Wl(i,t,Na(t,r)),alpha:()=>{let e=Wl(i,Hl(t),Na(t,n));const s=Uo(r.shape,t.shape);return s.length>0&&(e=hc(e,s)),il(e,r.shape)}}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function e4(t,e,n){const r=t.shape.length,i=r-n.length,s=nc(n,r);let o=t;null!=s&&(o=Do(t,s));const a=o.shape.slice(),l=a.splice(r-n.length,n.length).reduce(((t,e)=>t*e),1);a.push(l);let c=
/**
     * @license
     * Copyright 2022 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function(t,e,n){const r=t.shape.slice();r[n]=1;const i=il(e,r),s=Ll(t,n,!0,!1),o=Ll(t,n,!0,!0),a=Na(s,o);return Na(i,a)}(o.reshape(a),e,i);if(c=c.reshape(o.shape),null!=s){const t=rc(s);c=Do(c,t)}return c}const n4={kernelName:sn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;let s=[];return s=null==i?r.shape.map(((t,e)=>e)):"number"==typeof i?[i]:i,{x:()=>e4(r,t,s)}}},r4={kernelName:Kt,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{const e=Aa(t,no(r,"float32")),s=Uo(n.shape,i);return s.length>0?il(hc(e,s),n.shape):e},b:()=>{let e=Na(t,no(n,"float32"));const s=Uo(r.shape,i);s.length>0&&(e=il(hc(e,s),r.shape));const o=uc(r);return Po(Aa(e,no(o,"float32")))}}}},i4={kernelName:kn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=_c(n,lc(0)),r=lc(Op),i=lc(Pp),s=Na(t,i),o=Na(Na(t,r),mc(no(n,"float32")));return Wl(e,s,o)}}}},s4={kernelName:An,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,Na(n,zc(lc(1),n)))}}},o4={kernelName:Tn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,o=r.shape,[a,l]=ma(r,i,s),c=[];for(let e=0;e<t.rank;e++)c.push([a[e],o[e]-a[e]-l[e]]);return{x:()=>du(t,c)}}},a4={kernelName:Pn,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=Na(t,r);return{logits:()=>zc(s,Na(hc(s,[i],true),r))}}},l4={kernelName:Rn,gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>dl(t,r,i)}}},c4={kernelName:On,gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>al(t,r)}}},u4={kernelName:Yn,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(zc(lc(1),uc(n)),t)}}},h4={kernelName:Kn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let e=Hl(r);if(1===r.rank)for(let n=0;n<i[0];++n)e=Ma(e,cl(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)e=Ma(e,cl(t,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)e=Ma(e,cl(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)for(let a=0;a<i[3];++a)e=Ma(e,cl(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2],a*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},d4={kernelName:nr,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=Jc(e,Hl(e)),r=wc(t,n);let i=Sc(e,lc(0,"int32"));const s=r.rank-i.rank;for(let t=0;t<s;++t)i=gc(i,t+1);i=Vc(i,eu(r.shape,"bool"));const o=Hl(r);return Wl(i,r,o)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */(t,n)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const p4=[U2,V2,j2,W2,H2,G2,q2,X2,Y2,K2,Z2,J2,t3,n3,r3,i3,s3,o3,a3,l3,c3,u3,d3,h3,f3,m3,g3,y3,b3,v3,r4,x3,w3,_3,S3,k3,E3,T3,M3,C3,I3,$3,R3,O3,P3,L3,D3,F3,z3,U3,j3,j3,W3,G3,X3,{kernelName:Be,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n,s=w(i,r.shape),o=f(Ql(r.shape,s)[1]);return{x:()=>{const e=r.shape.slice();s.forEach((t=>{e[t]=1}));const n=il(t,e);return Aa(Na(n,eu(r.shape,"float32")),o)}}}},Y3,{kernelName:Ve,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Na(t,no(Ac(n,r),"float32")),b:()=>Na(t,no(_c(n,r),"float32"))}}},K3,{kernelName:We,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{const e=Uo(n.shape,i);return e.length>0?il(hc(t,e),n.shape):t},b:()=>{const e=Na(t,Po(xc(Aa(n,r)))),s=Uo(r.shape,i);return s.length>0?il(hc(e,s),r.shape):e}}}},{kernelName:Ge,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{const e=Na(t,no(r,"float32")),s=Uo(n.shape,i);return s.length>0?il(hc(e,s),n.shape):e},b:()=>{const e=Na(t,no(n,"float32")),s=Uo(r.shape,i);return s.length>0?il(hc(e,s),r.shape):e}}}},{kernelName:qe,gradFunc:t=>({x:()=>Po(t)})},{kernelName:Qe,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>tu(n.shape,"float32")}}},{kernelName:Je,gradFunc:t=>({x:()=>Hl(t)})},Z3,J3,J3,Q3,t4,n4,{kernelName:un,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,Po(uc(n)))}}},{kernelName:yn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Na(Ac(n,6),Sh(n));return{x:()=>Na(t,no(r,"float32"))}}},{kernelName:hn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,no(Sh(n),"float32"))}}},{kernelName:dn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>il(t,n.shape)}}},{kernelName:mn,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Wi.runKernel(gn,i,n)}}},{kernelName:pn,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Wi.runKernel(fn,i,n)}}},{kernelName:bn,gradFunc:(t,e,n)=>{const{dims:r}=n,i=w(r,t.shape);return{x:()=>Zu(t,i)}}},{kernelName:vn,gradFunc:t=>({x:()=>Hl(t)})},{kernelName:xn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Po(Aa(t,Na(ac(n,1.5),2)))}}},{kernelName:Sn,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>no(Hl(n),"float32"),t:()=>Na(t,no(n,t.dtype)),e:()=>Na(t,no(jc(n),t.dtype))}}},i4,s4,{kernelName:Cn,gradFunc:t=>({x:()=>Hl(t)})},{kernelName:En,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(Ol(no(n,"float32")),t)}}},{kernelName:Mn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(Pl(no(n,"float32")),t)}}},o4,a4,{kernelName:Nn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,ll(n))}}},l4,l4,c4,c4,{kernelName:In,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,Na(cc(no(n,"float32")),2))}}},{kernelName:Un,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=lc(2);return{a:()=>Na(t,Na(i,zc(n,r))),b:()=>Na(t,Na(i,zc(r,n)))}}},{kernelName:Vn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Na(t,Na(no(n,"float32"),2))}}},{kernelName:ir,gradFunc:t=>({x:()=>Hl(t)})},{kernelName:qn,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Vo(n.shape,r.shape);return{a:()=>{let e=t;const r=Uo(n.shape,i);return r.length>0&&(e=hc(e,r)),il(e,n.shape)},b:()=>{let e=t;const n=Uo(r.shape,i);return n.length>0&&(e=hc(e,n)),il(Po(e),r.shape)}}}},{kernelName:$n,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;w(s,r.shape).forEach((t=>{i[t]=1}));const o=il(t,i),a=Na(o,eu(r.shape,"float32"));return{x:()=>a}}},{kernelName:Xn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Aa(t,uc(Ol(n)))}}},u4,h4,{kernelName:Qn,gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=rc(i);return{x:()=>Do(t,s)}}},{kernelName:er,gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>_h(t,i)}}},d4,{kernelName:rr,gradFunc:t=>({x:()=>Hl(t)})}];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const t of p4)yr(t);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function f4(t,e){return Co((()=>cc(hc(Na(t,t),e,!0))))}class m4 extends va{getConfig(){return{}}}class g4 extends m4{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Co((()=>{const e=f4(t,this.axis),n=_l(e,0,this.maxValue);return Na(t,Aa(n,Ma($1(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}g4.className="MaxNorm",wa(g4);class y4 extends m4{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Co((()=>Aa(t,Ma($1(),f4(t,this.axis)))))}getConfig(){return{axis:this.axis}}}y4.className="UnitNorm",wa(y4);class b4 extends m4{apply(t){return Yu(t)}}b4.className="NonNeg",wa(b4);class v4 extends m4{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Co((()=>{const e=f4(t,this.axis),n=Ma(Na(this.rate,_l(e,this.minValue,this.maxValue)),Na(1-this.rate,e));return Na(t,Aa(n,Ma($1(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}v4.className="MinMaxNorm",wa(v4);const x4={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function w4(t){return Z0(t)}function _4(t,e={}){return Q0(t,xa.getMap().classNameMap,e,"constraint")}function S4(t){if(null==t)return null;if("string"==typeof t){return _4({className:t in x4?x4[t]:t,config:{}})}return t instanceof m4?t:_4(t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */async function k4(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];Ao(r)}}function T4(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */var E4;!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(E4||(E4={}));class M4{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class C4{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class A4 extends M4{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const t in e){const r=e[t];if("number"==typeof r)this.totals.hasOwnProperty(t)||(this.totals[t]=0),this.totals[t]=this.totals[t]+r*n;else{let e;t in this.totals?e=this.totals[t]:this.totals[t]=0;const i=Co((()=>Ma(this.totals[t],Na(r,n))));this.totals[t]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const t of this.params.metrics)null!=this.totals[t]&&("number"==typeof this.totals[t]?e[t]=this.totals[t]/this.seen:Co((()=>{const n=Na(Aa(1,this.seen),this.totals[t]);e[t]=n,this.totals[t].dispose(),No(e[t])})))}}class N4 extends M4{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const t in e)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(e[t])}async syncData(){const t=[],e=[],n=[];for(const r in this.history){const i=this.history[r];for(let s=0;s<i.length;++s)if("number"!=typeof i[s]){const o=i[s];t.push(o.data()),e.push(r),n.push(s)}}const r=await Promise.all(t);for(let t=0;t<r.length;++t){this.history[e[t]][n[t]].dispose(),this.history[e[t]][n[t]]=r[t][0]}}}class I4 extends M4{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||vp,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");R(this.yieldEvery)&&(this.maybeWait=function(t,e,n){let r,i=null!=n?n():li();return(...s)=>{const o=null!=n?n():li();return o-i<e||(i=o,r=t(...s)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const r=[];null!=this.yield&&(await k4(n),r.push(this.yield(t,e,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await k4(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await k4(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await k4(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await k4(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):R(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await k4(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await k4(t),await this.trainEnd(t))}}function $4(t,e){if(null==t&&(t={}),t instanceof M4)return[t];if(Array.isArray(t)&&t[0]instanceof M4)return t;return q0(t).map((t=>new I4(t,e)))}class R4{constructor(){}static registerCallbackConstructor(t,e){u(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),R4.checkForDuplicate(e),null==R4.constructors[t]&&(R4.constructors[t]=[]),R4.constructors[t].push(e)}static checkForDuplicate(t){for(const e in R4.constructors){R4.constructors[+e].forEach((e=>{if(e===t)throw new z0("Duplicate callback constructor.")}))}}static clear(){R4.constructors={}}static createCallbacks(t){const e=[];for(const n in R4.constructors){const r=+n;t>=r&&e.push(...R4.constructors[r])}return e.map((t=>new t))}}function O4(t,e,n,r,i,s,o,a,l){const c=new N4,u=[new A4,...R4.createCallbacks(e)];null!=t&&u.push(...t),u.push(c);const h=new C4(u);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:c}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function P4(t,e={},n=!1){return Q0(t,xa.getMap().classNameMap,e,"layer",n)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function L4(t,e){return Co((()=>{"float32"!==t.dtype&&(t=no(t,"float32"));const n=hc(W1(t),e,!0),r=wl(n.shape,$1()),i=cc(Jc(n,r));return Aa(t,i)}))}function D4(t,e){return Co((()=>Qc(W1(zc(e,t)),-1)))}function F4(t,e){return Co((()=>Qc(Ia(zc(e,t)),-1)))}function z4(t,e){return Co((()=>{const n=zc(t,e),r=_l(Ia(t),$1(),Number.MAX_VALUE),i=Ia(Aa(n,r));return Na(100,Qc(i,-1))}))}function B4(t,e,n=!1){return Co((()=>{if(n)e=fh(e);else{const t=hc(e,e.shape.length-1,!0);e=Aa(e,t)}return e=_l(e,$1(),1-$1()),Po(hc(Na(no(t,"float32"),$c(e)),e.shape.length-1))}))}function U4(t,e,n=!1){return Co((()=>{const r=no(xc(function(t){const e=[M1(t.shape)];return il(t,e)}(t)),"int32"),i=(e=_l(e,$1(),1-$1())).shape;return B4(il(To(r,i[i.length-1]),i),e,n)}))}function V4(t,e){return Co((()=>{let n;return n=_l(e,$1(),1-$1()),n=$c(Aa(n,zc(1,n))),Qc(function(t,e){if(!m(t.shape,e.shape))throw new z0(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Co((()=>{const n=Yu(e),r=Po(Ia(e));return Ma(zc(n,Na(e,t)),Rc(mc(r)))}))}(t,n),-1)}))}function j4(t,e){return Co((()=>{const n=L4(t,-1),r=L4(e,-1),i=Na(n,r);return Po(hc(i,-1))}))}R4.constructors={};const W4={meanSquaredError:D4,meanAbsoluteError:F4,meanAbsolutePercentageError:z4,meanSquaredLogarithmicError:function(t,e){return Co((()=>{const n=_l(e,$1(),Number.MAX_VALUE),r=$c(Ma(1,n)),i=_l(t,$1(),Number.MAX_VALUE),s=$c(Ma(1,i));return Qc(W1(zc(r,s)),-1)}))},squaredHinge:function(t,e){return Co((()=>{const n=Jc(0,zc(1,Na(t,e)));return Qc(W1(n),-1)}))},hinge:function(t,e){return Co((()=>{const n=Jc(0,zc(1,Na(t,e)));return Qc(n,-1)}))},categoricalHinge:function(t,e){return Co((()=>{const n=hc(Na(t,e),-1),r=sc(Na(zc(1,t),e),-1);return Jc(0,Ma(1,zc(r,n)))}))},logcosh:function(t,e){return Co((()=>{const n=Math.log(2),r=zc(e,t),i=zc(Ma(r,Dc(Na(-2,r))),n);return Qc(i,-1)}))},categoricalCrossentropy:B4,sparseCategoricalCrossentropy:U4,binaryCrossentropy:V4,kullbackLeiblerDivergence:function(t,e){return Co((()=>{const n=_l(t,$1(),1),r=_l(e,$1(),1);return hc(Na(t,$c(Aa(n,r))),-1)}))},poisson:function(t,e){return Co((()=>{const n=$c(Ma($1(),e));return Qc(zc(e,Na(t,n)),-1)}))},cosineProximity:j4};function H4(t){if("string"==typeof t){if(t in W4)return W4[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new z0(e)}return t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function G4(t,e){return Co((()=>{const n=Na(.5,uu(e)),r=R1(_c(e,n),t.dtype);return Qc(jl(t,r),-1)}))}function q4(t,e){return Co((()=>R1(jl(Da(t,-1),Da(e,-1)),"float32")))}function X4(t,e){return V4(t,e)}function Y4(t,e){return t.rank===e.rank&&(t=wh(t,[t.rank-1])),(e=Da(e,-1)).dtype!==t.dtype&&(e=no(e,t.dtype)),no(jl(t,e),"float32")}const K4=B4,Z4=U4,J4={binaryAccuracy:G4,categoricalAccuracy:q4,precision:function(t,e){return Co((()=>{const n=function(t,e){return Co((()=>no(hc(Vc(jl(t,1),jl(e,1))),"float32")))}(t,e),r=function(t,e){return Co((()=>no(hc(Vc(jl(t,0),jl(e,1))),"float32")))}(t,e),i=Ma(n,r);return no(Wl(_c(i,0),Aa(n,i),0),"float32")}))},categoricalCrossentropy:K4,sparseCategoricalCrossentropy:Z4,mse:D4,MSE:D4,mae:F4,MAE:F4,mape:z4,MAPE:z4,cosine:j4};function Q4(t){if("string"==typeof t&&t in J4)return J4[t];if("string"!=typeof t&&null!=t)return t;throw new z0(`Unknown metric ${t}`)}function t5(t){if(W0(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(W4))if(W4[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(J4))if(J4[n]===t){e=n;break}return void 0!==e?e:t.name}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
const e5=1048576;function n5(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!r5(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>e5&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function r5(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!r5(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!r5(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function i5(t,e,n,r=console.log){const i=function(t){let e=!0;const n=[],r=[];for(const e in t.nodesByDepth)n.push(t.nodesByDepth[e]);for(const t of n){if(t.length>1||1===t.length&&t[0].inboundLayers.length>1){e=!1;break}r.push(...t)}if(e)for(const n of t.layers){let t=!1;for(const i of n.inboundNodes)if(-1!==r.indexOf(i)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Input Shape","Output shape","Param #"];let o;if(i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!i){s.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}r("_".repeat(e)),s5(s,n,r),r("=".repeat(e));const a=t.layers;for(let t=0;t<a.length;++t)i?o5(a[t],n,r):a5(a[t],n,o,r),r((t===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=function(t){let e;e=null!=t.collectedTrainableWeights?w2(t.collectedTrainableWeights):w2(t.trainableWeights);return e}(t),c=w2(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function s5(t,e,n=console.log){let r="";for(let n=0;n<t.length;++n)n>0&&(r=r.slice(0,r.length-1)+" "),r+=t[n],r=r.slice(0,e[n]),r+=" ".repeat(e[n]-r.length);n(r)}function o5(t,e,n){let r,i;try{i=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){i="multiple"}try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}s5([`${t.name} (${t.getClassName()})`,i,r,t.countParams().toString()],e,n)}function a5(t,e,n,r){let i,s;try{s=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){s="multiple"}try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}const o=[];for(const e of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(e)))for(let t=0;t<e.inboundLayers.length;++t){const n=e.inboundLayers[t].name,r=e.nodeIndices[t],i=e.tensorIndices[t];o.push(`${n}[${r}][${i}]`)}const a=t.name,l=t.getClassName(),c=0===o.length?"":o[0];s5([`${a} (${l})`,s,i,t.countParams().toString(),c],e,r);for(let t=1;t<o.length;++t)s5(["","","","",o[t]],e,r)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function l5(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function c5(t,e){if(null===t)return null;if("string"==typeof t)return Y0(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];l5(e,i,r)?n.push(r):n.push(c5(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n];if("name"===n&&"string"==typeof r)e[n]=r;else{const t=Y0(n);e[t]=c5(r,t)}}return e}}function u5(t,e){if(null==t)return null;if("string"==typeof t)return X0(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];l5(e,i,r)?n.push(r):n.push(u5(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n],i=X0(n);e[i]="name"!==n&&"className"!==n||"string"!=typeof r?u5(r,n):r}return e}}
/** @license See the LICENSE file. */
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class h5 extends I2{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=h1(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],e1(this.inputs).length!==this.inputs.length)throw new z0(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);e1(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const t of this.outputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(r)}for(const t of this.inputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;W0(0===n,"input layer has >1 nodes"),W0(0===r,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(r)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e];if(!(n instanceof R2))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${e} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const t of this.outputLayers)this.outputNames.push(t.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},r={},i={},s={},o=[],a=(t,e,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=t.sourceLayer,i=t.nodeIndex,l=t.tensorIndex);const c=r.inboundNodes[i];if(-1!==n.indexOf(c))throw new F0(`The tensor ${t.name} at layer "${r.name}" is part of a cycle.`);if(-1!==e.indexOf(c))return;this.containerNodes.add(h5.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let t=0;t<u;t++){const r=c.inputTensors[t],i=c.inboundLayers[t],s=c.nodeIndices[t],o=c.tensorIndices[t];a(r,e,n,i,s,o)}for(e.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);o.push(c)},l=[],c=[];for(const t of this.outputs)a(t,l,c);const u=o.slice().reverse();for(const t of u){n[t.id]=t,t.id in e||(e[t.id]=0);let s=e[t.id];const o=null==r[t.outboundLayer.id]?0:r[t.outboundLayer.id];s=Math.max(s,o),r[t.outboundLayer.id]=s,i[t.outboundLayer.id]=t.outboundLayer,e[t.id]=s;for(let r=0;r<t.inboundLayers.length;r++){const i=t.inboundLayers[r],o=t.nodeIndices[r],a=i.inboundNodes[o],l=null==e[a.id]?0:e[a.id];e[a.id]=Math.max(s+1,l),n[a.id]=a}}const h={};for(const t in e){const r=e[t];r in h||(h[r]=[]),h[r].push(n[t])}const d={};for(const t in r){const e=r[t];e in d||(d[e]=[]),d[e].push(i[t])}let p=Object.keys(d).map((t=>parseInt(t,10))).sort(t1);this.layers=[];for(const t of p){const e=d[t];e.sort(((t,e)=>{const n=s[t.id],r=s[e.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof h5&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map((t=>parseInt(t,10))).sort(t1);const f=this.inputs.slice(),m=[];for(const t of p)for(const e of h[t]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new F0(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${m}`);for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map((t=>t.name));for(const t of g){const e=g.filter((e=>e===t)).length;if(1!==e)throw new F0(`The name "${t}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new A2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new z0("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let r=0;for(const t of this.layers)for(const e of t.weights){if(null!=n[e.originalName])throw new z0(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,r++}const i=[];for(const r in t){let s=r;if(null==n[r]){const t=r.split("/");s=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[s])i.push([n[s],t[r]]);else if(e)throw new z0(`Provided weight data has no target variable: ${r}`);delete n[s]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new z0(`${t.length} of ${r} weights are not set: ${t}`)}T2(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 3.21.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=u5(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return Co((()=>{t=q0(t);const n=new O2;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return D2(this.outputs,n,e)}))}computeMask(t,e){return Co((()=>{let n;return t=q0(t),n=null==e?j0(null,t.length):q0(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=b2(t);if(e.length!==this.inputLayers.length)throw new z0(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let t=0;t<e.length;t++){const r=this.inputLayers[t],i=e[t];n[r.name+"_0_0"]=i}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(t1);if(r.length>1)for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(e.id))continue;const r=[];for(let e=0;e<t.inboundLayers.length;e++){const i=t.inboundLayers[e],s=t.nodeIndices[e],o=t.tensorIndices[e],a=n[`${i.name}_${s}_${o}`];r.push(a)}const i=b2(e.computeOutputShape(G0(r))),s=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++){n[`${e.name}_${s}_${t}`]=i[t]}}}const i=[],s=[];for(let t=0;t<this.outputLayers.length;t++){const e=this.outputLayers[t],n=this.outputLayersNodeIndices[t],r=this.outputLayersTensorIndices[t],i=`${e.name}_${n}_${r}`;s.push(i)}for(let t=0;t<s.length;t++){const e=s[t];W0(e in n),i.push(n[e])}return G0(i)}runInternalGraph(t,e){null==e&&(e=j0(null,t.length));const n={};for(let r=0;r<this.inputs.length;++r){const i=this.inputs[r],s=t[r],o=e[r];n[i.id]=[s,o]}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(t1);for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,s=new Array;for(const t of r)t.id in n&&s.push(n[t.id]);if(s.length===r.length){let r,o,a,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===s.length){const[t,n]=s[0];null==c.mask&&(c.mask=n),a=q0(e.call(t,c)),l=q0(e.computeMask(t,n)),r=[t],o=[n]}else r=s.map((t=>t[0])),o=s.map((t=>t[1])),null==c.mask&&(c.mask=o),a=q0(e.call(r,c)),l=q0(e.computeMask(r,o));if(e.activityRegularizer)throw new B0("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t){const e=i[t],r=a[t],s=l[t];n[e.id]=[r,s]}}}}const i=[],s=[],o=[];for(const t of this.outputs){W0(t.id in n,`Could not compute output ${t.name} : ${t.id}`);const[e,r]=n[t.id];o.push(e.shape),i.push(e),s.push(r)}return[i,s,o]}buildNodeConversionMap(t){const e={};let n;for(const t of this.layers){n=t instanceof h5?1:0;for(let r=0;r<t.inboundNodes.length;r++){const i=h5.nodeKey(t,r);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new z0(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new z0("Provide either a layer name or layer index");for(const e of this.layers)if(e.name===t)return e;throw new z0(`No such layer: ${t}`)}calculateLosses(){return Co((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const r=h5.nodeKey(e,n);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const t of this.layers){const r=t.getClassName(),i=t.getConfig(),s=[];for(let n=0;n<t.inboundNodes.length;n++){const r=t.inboundNodes[n],i=h5.nodeKey(t,n);let o={};if(this.containerNodes.has(i)){if(r.callArgs)try{JSON.stringify(r.callArgs),o=r.callArgs}catch(e){console.warn(`Layer ${t.name} was passed non-serializable keyword arguments: ${r.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),o={}}if(r.inboundLayers.length>0){const t=[];for(let n=0;n<r.inboundLayers.length;n++){const i=r.inboundLayers[n],s=r.nodeIndices[n],a=r.tensorIndices[n];let l=e[h5.nodeKey(i,s)];null==l&&(l=0),t.push([i.name,l,a,o])}s.push(t)}}}const o={};o.name=t.name,o.className=r,o.config=i,o.inboundNodes=s,n.push(o)}t.layers=n;const r=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t],i=this.inputLayersNodeIndices[t],s=h5.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.inputLayersTensorIndices[t];r.push([n.name,o,a])}t.inputLayers=r;const i=[];for(let t=0;t<this.outputLayers.length;t++){const n=this.outputLayers[t],r=this.outputLayersNodeIndices[t],s=h5.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.outputLayersTensorIndices[t];i.push([n.name,o,a])}return t.outputLayers=i,t}static fromConfig(t,e,n={},r=!1){const i={},s={};function o(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function a(t,e){const n=[];let r;for(const s of e){const a=s[0],l=s[1],c=s[2];if(r=null==s[3]?{}:s[3],!(a in i))return void o(t,e);const u=i[a];if(u.inboundNodes.length<=l)return void o(t,e);const h=u.inboundNodes[l];n.push(h.outputTensors[c])}n.length>0&&t.apply(G0(n),r)}function l(t){const n=t.name,s=P4(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s;t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new z0(`Corrupted configuration, expected array for nodeData: ${t}`);o(s,t)}))}const c=e.name,u=e.layers;for(const t of u)l(t);for(;!n1(s);)for(const t of u){const e=i[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)a(e,n)}}const h=[],d=[],p=e.inputLayers;for(const t of p){const e=t[0],n=t[1],r=t[2];W0(e in i);const s=i[e].inboundNodes[n].outputTensors;h.push(s[r])}const f=e.outputLayers;for(const t of f){const e=t[0],n=t[1],r=t[2];W0(e in i);const s=i[e].inboundNodes[n].outputTensors;d.push(s[r])}return new t({inputs:h,outputs:d,name:c})}get stateful(){if(this._stateful)throw new z0("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){Co((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function d5(t,e){return function(t,e,n){const r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}(t,e,"classWeight")}async function p5(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=Co((()=>{if(1===t.shape.length)return ro(t);if(2===t.shape.length){if(t.shape[1]>1){return Da(t,1)}if(1===t.shape[1])return il(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await e.data());Ao(e);const i=[];return r.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])})),Eh(i,"float32")}return null}function f5(t,e){return Na(t,e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function m5(t,e){let n,r;const i=e;n=i.xs,r=i.ys,u(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const s=g5("input",t.inputNames,n),o=g5("output",t.outputNames,r),a=s[0].shape[0];u(s.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),u(o.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let e=0;e<s.length;e++)u(s[e].shape[0]===a,(()=>`Batch size mismatch: input ${t.inputNames[e]} has ${s[e].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));for(let e=0;e<o.length;e++)u(o[e].shape[0]===a,(()=>`Batch size mismatch: output ${t.outputNames[e]} has ${o[e].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));return{xs:s,ys:o}}function g5(t,e,n){if(n instanceof Si)return[n];if(Array.isArray(n))return u(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const r=[];for(const i of e){if(null==n[i])throw new z0(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}async function y5(t,e,n){const r=null!=n.batchesPerEpoch;if(u(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),u(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),u(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),u(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),u(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=null!=n.validationData;let s,o;if(i)if(b5(n.validationData))u(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new B0("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);s=t.xs,o=t.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;c=i?l.slice().concat(l.map((t=>"val_"+t))):l.slice();const h=$4(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:p,history:f}=O4(h,d,n.epochs,null,null,function(t,e){let n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,i,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=null==n.initialEpoch?0:n.initialEpoch,g=await e.iterator();for(;m<n.epochs;){const c={};await p.onEpochBegin(m);let u=0,h=0;for(r||(g=await e.iterator());!r||u<n.batchesPerEpoch;){const e=await g.next();if(r&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${u} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=e.value){const{xs:r,ys:i}=m5(t,e.value),s={};s.batch=h,s.size=r[0].shape[0],await p.onBatchBegin(h,s);const o=[];if(null!=n.classWeight){const e=d5(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)o.push(await p5(i[t],null,e[t]))}const c=r.concat(i).concat(o),d=a(c);Ao(c);for(let t=0;t<l.length;++t){const e=l[t],n=d[t];s[e]=n,No(n)}await p.onBatchEnd(h,s),T4(s),h++,u++}if(r?u>=n.batchesPerEpoch:e.done){if(i){let e;e=b5(n.validationData)?q0(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):q0(t.evaluate(s,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)c[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,c),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function b5(t){return"function"==typeof t.iterator}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function v5(t){u(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function x5(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>P1(t,e,n-e))):P1(t,e,n-e)}function w5(t,e){return Co((()=>null==t?null:Array.isArray(t)?t.map((t=>w5(t,e))):j1(t,"int32"===e.dtype?e:no(e,"int32"))))}function _5(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}async function S5(t,e,n,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let i,o,a,l,c,u,h,d,p;t.isTraining=!0;try{const f=null==r.batchSize?32:r.batchSize;v5(f);const m=!1,g=await t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,m,f);i=g[0],o=g[1],p=g[2];let y,b=!1;if(null!=r.validationData&&r.validationData.length>0){if(b=!0,2!==r.validationData.length)throw 3===r.validationData.length?new B0("validationData including sample weights is not supported yet."):new z0(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);c=r.validationData[0],u=r.validationData[1];const e=!0,n=await t.standardizeUserData(c,u,null,null,e,f);h=n[0],d=n[1],y=h.concat(d)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){b=!0;const t=Math.floor(i[0].shape[0]*(1-r.validationSplit)),e=i[0].shape[0];h=x5(i,t,e),a=i,i=x5(i,0,t),d=x5(o,t,e),l=o,o=x5(o,0,t),y=h.concat(d)}else null!=r.validationSteps&&(b=!0);const v=i.concat(o).concat(p);t.checkTrainableWeightsConsistency();const x=t.makeTrainFunction(),w=t.getDedupedMetricsNames();let _,S;b?(t.makeTestFunction(),_=t.testFunction,S=w.slice().concat(w.map((t=>"val_"+t)))):(_=null,y=[],S=w.slice());const k=$4(r.callbacks,r.yieldEvery),T=await async function(t,e,n,r,i,o,a,l,c,u,h,d,p,f,m){null==i&&(i=32),null==o&&(o=1),null==h&&(h=!0),null==p&&(p=0);let g=!1;if(null!=c&&null!=u&&(g=!0),null!=m&&(g=!0,null==f))throw new z0("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=t.checkNumSamples(n,i,f,"steps_per_epoch");let b;null!=y&&(b=N1(0,y)),null==a&&(a=1);const{callbackList:v,history:x}=O4(l,a,o,p,y,f,i,g,d);v.setModel(t),t.history=x,await v.onTrainBegin(),t.stopTraining_=!1;for(let a=p;a<o;++a){await v.onEpochBegin(a);const o={};if(null!=f)throw new B0("stepsPerEpoch mode is not implemented yet.");{if("batch"===h)throw new B0("batch shuffling is not implemneted yet");h&&s(b);const a=Eh(b),l=_5(y,i);for(let s=0;s<l.length;++s){const h={};if(await v.onBatchBegin(s,h),Co((()=>{const d=l[s][0],p=l[s][1],f=P1(a,d,p-d);h.batch=s,h.size=p-d;const m=w5(n,f),y=e(m);for(let t=0;t<r.length;++t){const e=r[t],n=y[t];h[e]=n,No(n)}if(s===l.length-1&&g){const e=t.testLoop(c,u,i);for(let t=0;t<r.length;++t){const n=r[t],i=e[t];No(i),o["val_"+n]=i}}})),await v.onBatchEnd(s,h),T4(h),t.stopTraining_)break}a.dispose()}if(await v.onEpochEnd(a,o),t.stopTraining_)break}return await v.onTrainEnd(),await t.history.syncData(),t.history}(t,x,v,w,f,r.epochs,r.verbose,k,_,y,r.shuffle,S,r.initialEpoch,null,null);return T}finally{t.isTraining=!1,T5(i,e),T5(o,n),T5(a,e),T5(l,n),T5(h,c),T5(d,u),null!=p&&Ao(p)}}function k5(t){const e=[];t instanceof Si&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(1===r.rank)e.push(O1(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function T5(t,e){if(null==t)return;const n=[];if(e instanceof Si)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const t in e){const r=e[t];n.push(r.id)}const r=[];if(t instanceof Si)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&r.push(t)}));else if(null!=t)for(const e in t){const i=t[e];-1===n.indexOf(i.id)&&r.push(i)}r.forEach((t=>{t.isDisposed||t.dispose()}))}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function E5(t){return Array.isArray(t)}function M5(t){return!function(t){return t instanceof Si}(t)&&!E5(t)}function C5(t,e,n,r=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(E5(t)&&t.length>0)e=!0;else if(M5(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new z0(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let s;if(M5(t)){s=[];for(const n of e){if(null==t[n])throw new z0(`No data provided for "${n}". Need data for each key in: ${e}`);s.push(t[n])}}else if(E5(t)){if(t.length!==e.length)throw new z0(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(e.length>1)throw new z0(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=k5(s),null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new z0(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s). but got array with shape ${o.shape}`);for(let e=0;e<n[t].length;++e){if(0===e&&!r)continue;const s=o.shape[e],a=n[t][e];if(null!=a&&a>=0&&s!==a)throw new z0(`${i} expected a batch of elements where each example has shape [${n[t].slice(1,n[t].length)}] (i.e.,tensor shape [*,${n[t].slice(1,n[t].length)}]) but the ${i} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return s}function A5(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new z0(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new z0(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new z0(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let s=0;s<n[t].length;++s){if(0===s&&!r)continue;const a=o.shape[s],l=n[t][s];if(null!=l&&l!==a)throw new z0(`Error when checking ${i}: expected ${e[t]} to have shape ${JSON.stringify(n[t])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}class N5 extends h5{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new z0("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");i5(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>yp.adagrad(.01),Adadelta:()=>yp.adadelta(1,.95,$1()),Adam:()=>yp.adam(.001,.9,.999,$1()),Adamax:()=>yp.adamax(.002,.9,.999,$1(),0),RMSProp:()=>yp.rmsprop(.001,.9,0,$1()),SGD:()=>yp.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new z0(`Unknown Optimizer ${t}`)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof lp))throw new z0("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new z0(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>H4(t)))}else{const n=H4(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new z0(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(H4(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let t=0;t<this.outputs.length;++t){const e=this.internalOutputShapes[t],n=this.outputNames[t];this.feedOutputNames.push(n),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[t])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],_1("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const r of e){let e=n.hasOwnProperty(r)?n[r]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};_1("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;(e=>{let n,r,s;for(const o of e){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===V4?-1!==["accuracy","acc"].indexOf(o)?r=G4:-1!==["crossentropy","ce"].indexOf(o)&&(r=X4):this.lossFunctions[t]===U4?-1!==["accuracy","acc"].indexOf(o)?r=Y4:-1!==["crossentropy","ce"].indexOf(o)&&(r=Z4):-1!==["accuracy","acc"].indexOf(o)?r=q4:-1!==["crossentropy","ce"].indexOf(o)&&(r=K4),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),s=r,n=""+i}else{const t=Q4(o);s=t,n=""+t5(o)}let e;_1(n,(()=>{e=s})),i(t,n,e)}})(r[t])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const r=null==n.batchSize?32:n.batchSize;v5(r);const i=this.standardizeUserDataXY(t,e,!0,r);try{const s=i[0].concat(i[1]);this.makeTestFunction();const o=this.testFunction;return G0(this.testLoop(o,s,r,n.verbose,n.steps))}finally{T5(i[0],t),T5(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const r=null!=(n=n||{}).batches,i=t.testFunction;let s=[];if(n.verbose>0)throw new B0("Verbose mode is not implemented yet.");u(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const o="function"==typeof e.next?e:await e.iterator();let a=0,l=0;for(;!r||l<n.batches;){const e=await o.next();if(s=Co((()=>{if(e.value){const{xs:n,ys:r}=m5(t,e.value),o=n.concat(r),c=Co((()=>i(o)));if(Ao(o),0===l)for(let t=0;t<c.length;++t)s.push(lc(0));const u=o[0].shape[0];for(let t=0;t<c.length;++t){const e=c[t],n=s[t];s[t]=Co((()=>Ma(s[t],Na(u,e)))),l>0&&Ao(n)}Ao(c),a+=u,++l}return s})),e.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let t=0;t<s.length;++t){const e=s[t];s[t]=Aa(s[t],a),Ao(e)}return G0(s)}(this,t,e)}checkNumSamples(t,e,n,r="steps"){let i;if(null!=n){if(i=null,null!=e)throw new z0(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new z0(`Either the input data should have a defined shape, or ${r} shoud be specified.`);i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new z0("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),s=new O2;if(t instanceof Si&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new z0(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)s.add(this.inputs[e],t[e])}else for(const e of this.inputs){const n=t[e.name];if(null==n)throw new z0(`No value is provided for the model's input ${e.name}`);s.add(e,n)}const o=D2(i,s);return n?o:o[0]}retrieveSymbolicTensors(t){const e=j0(null,t.length);let n=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],s=i.map((t=>t.name));for(let r=0;r<t.length;++r){const o=s.indexOf(t[r]);if(-1!==o&&(e[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,r)=>{null==e&&n.push(t[r])})),new z0(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return Co((()=>{const r=this.checkNumSamples(t);if(n)throw new B0("Verbose predictLoop() is not implemented yet.");const i=_5(r,e),s=this.outputs.map((t=>[]));for(let e=0;e<i.length;++e){const n=Co((()=>{const n=i[e][0],r=i[e][1],s=x5(t,n,r),o=[];if(Array.isArray(s))for(let t=0;t<s.length;++t)o.push({key:this.inputs[t],value:s[t]});else o.push({key:this.inputs[0],value:s});const a=new O2(o);return D2(this.outputs,a)}));n.forEach(((t,e)=>s[e].push(t)))}return G0(s.map((t=>al(t,0))))}))}predict(t,e={}){const n=k5(t);A5(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==e.batchSize?32:e.batchSize;return v5(r),this.predictLoop(n,r)}finally{T5(n,t)}}predictOnBatch(t){A5(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,r){if(null==this.optimizer_)throw new F0("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let t=0;t<this.feedOutputShapes.length;++t){const e=this.feedOutputShapes[t];this.feedLossFns[t]===U4?i.push(e.slice(0,e.length-1).concat([1])):i.push(e)}if(function(t,e,n){const r=e1(t.map((t=>t.shape[0])));r.sort();const i=e1(e.map((t=>t.shape[0])));if(i.sort(),r.length>1)throw new z0(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(i.length>1)throw new z0(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(r.length>0&&i.length>0&&!m(r,i))throw new z0(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(t=C5(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=C5(e,this.feedOutputNames,i,!1,"target")),function(t,e,n){const r=[D4,V4,B4];for(let i=0;i<t.length;++i){const s=t[i],o=e[i],a=n[i];if(null!=o){if(o===B4&&1===s.shape[s.shape.length-1])throw new z0(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const t=s.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const r=t[n],i=e[n];if(null!=i&&r!==i)throw new z0(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new z0(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,r,i=!0,s){const[o,a]=this.standardizeUserDataXY(t,e,i,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const t=d5(r,this.outputNames);l=[];for(let e=0;e<t.length;++e)l.push(await p5(a[e],null,t[e]))}return[o,a,l]}testLoop(t,e,n,r=0,i){return Co((()=>{const s=this.checkNumSamples(e,n,i,"steps"),o=[];if(r>0)throw new B0("Verbose mode is not implemented yet.");if(null!=i)throw new B0("steps mode in testLoop() is not implemented yet");{const r=_5(s,n),i=Eh(N1(0,s));for(let n=0;n<r.length;++n){const s=r[n][0],a=r[n][1],l=P1(i,s,a-s),c=w5(e,l),u=t(c);if(0===n)for(let t=0;t<u.length;++t)o.push(lc(0));for(let t=0;t<u.length;++t){const e=u[t];o[t]=Ma(o[t],Na(a-s,e))}}for(let t=0;t<o.length;++t)o[t]=Aa(o[t],s)}return o}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const r=t[n];let i=r;if(H0(t,r)>1){i+=`_${H0(t.slice(0,n),r)}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],o=this.collectedTrainableWeights.map((t=>t.read())),a=this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const o=new O2(t),a=D2(this.outputs,o,{training:!0});let l;for(let t=0;t<this.lossFunctions.length;++t){let n=(0,this.lossFunctions[t])(r[t],a[t]);null!=i[t]&&(n=f5(n,i[t]));const s=Qc(n);e.push(s),l=0===t?n:Ma(l,n)}for(let t=0;t<this.metricsTensors.length;++t){let n;if(this.outputs.length>1&&t<this.outputs.length)n=e[t];else{const e=this.metricsTensors[t][0],i=this.metricsTensors[t][1];n=Qc(e(r[i],a[i]))}No(n),s.push(n)}return l=Qc(l),this.calculateLosses().forEach((t=>{l=Ma(l,t)})),l}),!0,o);return[a].concat(s)}}makeTestFunction(){this.testFunction=t=>Co((()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let t=0;t<this.inputs.length;++t)s.push({key:this.inputs[t],value:r[t]});const o=new O2(s),a=D2(this.outputs,o);for(let t=0;t<this.lossFunctions.length;++t){const r=this.lossFunctions[t],s=Qc(r(i[t],a[t]));n=0===t?s:Ma(n,s),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],r=this.metricsTensors[t][1],s=Qc(n(i[r],a[r]));e.push(s)}return e}))}async fit(t,e,n={}){return S5(this,t,e,n)}async fitDataset(t,e){return y5(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),o=[];for(const t of s){const e=await t.data();o.push(e[0])}return Ao(s),T5(n[0],t),T5(n[1],e),G0(o)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let t=0;t<r.length;++t)n&&!r[t].trainable||e.push({name:r[t].originalName,tensor:i[t]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=Mo().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Mo().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=X0(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>X0(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const r of e){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");t[r]=X0(n[r])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[X0(t5(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>X0(t5(t))));{const t={};for(const e in this.metrics)t[e]=X0(t5(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=P4(c5(t.optimizer_config));let n,r;if("string"==typeof t.loss)n=Y0(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>Y0(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=Y0(t.loss[e])}if(Array.isArray(t.metrics))r=t.metrics.map((t=>Y0(t)));else if(null!=t.metrics){r={};for(const e in t.metrics)r[e]=Y0(t.metrics[e])}this.compile({loss:n,metrics:r,optimizer:e})}async save(t,e){if("string"==typeof t){const e=_s(t);if(0===e.length)throw new z0(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new z0(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new z0("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await ls(this.getNamedWeights(e)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.21.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:i}=await ls(await this.optimizer.getWeights(),t);n.specs.push(...i),n.data=ps([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;n5(this.userDefinedMetadata,this.name,t),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,t.save(r)}setUserDefinedMetadata(t){n5(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}N5.className="Model",wa(N5);class I5 extends N5{}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
async function $5(t,e){if(null==e&&(e={}),"string"==typeof t){const n=Ss(t,e);if(0===n.length)n.push(yo(t,e));else if(n.length>1)throw new z0(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return async function(t,e,n){null==n&&(n={});if(null==t.load)throw new z0("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const s=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&s,a=P4(c5(i),e,o),l=r.trainingConfig;null!=l&&a.loadTrainingConfig(l);null!=r.userDefinedMetadata&&a.setUserDefinedMetadata(r.userDefinedMetadata);if(null!=r.weightData){if(null==r.weightSpecs)throw new z0("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:t,optimizerWeights:e}=function(t,e){const n=cs(t,e),r={},i=[];return e.forEach((t=>{"optimizer"===t.group?i.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]})),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);a.loadWeights(t,s),null!=a.optimizer&&e.length>0&&await a.optimizer.setWeights(e),Ao(t),Ao(e.map((t=>t.tensor)))}return a}(t,void 0,e)}I5.className="Functional",wa(I5);class R5 extends N5{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:h1("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new z0(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof R5||t instanceof N5;let n;if(e){if(n=t,1!==n.outputs.length)throw new z0("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new z0("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new z0("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=function(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new z0("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new R2({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new z0(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new z0("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=$2(this.outputs[0])}this.inboundNodes=[],new A2({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:j0(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(x2(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new N5({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new F0("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new F0("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new F0("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new F0("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},r=!1){let i,s={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new z0("Legacy serialization format not supported yet.");i=e}else u(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=e.layers,delete e.layers,s=e;const o=new t(s);if(!(o instanceof R5))throw new B0(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const t of i){const e=P4(t,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),o.add(e)}return o}set stopTraining(t){if(null==this.model)throw new z0("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new z0("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function O5(t){return new R5(t)}function P5(t,e){return null==e&&(e={}),$5(t,e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */R5.className="Sequential",wa(R5);class L5 extends va{getConfig(){return{}}}class D5 extends L5{apply(t,e=1){return function(t,e=1){if(1!==e)throw new B0(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Yl(t)}(t,e)}}D5.className="elu",wa(D5);class F5 extends L5{apply(t){return ih(t)}}F5.className="selu",wa(F5);class z5 extends L5{apply(t){return Yu(t)}}z5.className="relu",wa(z5);class B5 extends L5{apply(t){return Co((()=>ru(6,Yu(t))))}}B5.className="relu6",wa(B5);class U5 extends L5{apply(t){return t}}U5.className="linear",wa(U5);class V5 extends L5{apply(t){return ll(t)}}V5.className="sigmoid",wa(V5);class j5 extends L5{apply(t){return function(t){return Co((()=>{const e=Ma(.5,Na(.2,t));return _l(e,0,1)}))}(t)}}j5.className="hardSigmoid",wa(j5);class W5 extends L5{apply(t){return Dc(t)}}W5.className="softplus",wa(W5);class H5 extends L5{apply(t){return function(t){return Co((()=>Aa(t,Ma(Ia(t),1))))}(t)}}H5.className="softsign",wa(H5);class G5 extends L5{apply(t){return ul(t)}}G5.className="tanh",wa(G5);class q5 extends L5{apply(t,e=-1){return fh(t,e)}}q5.className="softmax",wa(q5);class X5 extends L5{apply(t,e=-1){return Bc(t,e)}}X5.className="logSoftmax",wa(X5);class Y5 extends L5{apply(t,e=1){return Co((()=>Na(ll(Na(t,e)),t)))}}Y5.className="swish",wa(Y5);class K5 extends L5{apply(t){return Co((()=>Na(t,ul(Dc(t)))))}}function Z5(t){return t.getClassName()}function J5(t,e={}){return Q0(t,xa.getMap().classNameMap,e,"activation")}function Q5(t){if(null==t){const t={className:"linear",config:{}};return J5(t)}if("string"==typeof t){const e={};return e.className=t,e.config={},J5(e)}return t instanceof L5?t:J5(t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */K5.className="mish",wa(K5);class t6 extends va{}class e6 extends t6{constructor(t){super(),function(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return Co((()=>{let e=tu([1]);return this.hasL1&&(e=Ma(e,hc(Na(this.l1,Ia(t))))),this.hasL2&&(e=Ma(e,hc(Na(this.l2,W1(t))))),il(e,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}e6.className="L1L2",wa(e6);const n6={l1l2:"L1L2"};function r6(t){return Z0(t)}function i6(t,e={}){return Q0(t,xa.getMap().classNameMap,e,"regularizer")}function s6(t){if(null==t)return null;if("string"==typeof t){return i6({className:t in n6?n6[t]:t,config:{}})}return t instanceof t6?t:i6(t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class o6 extends I2{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=v2(t);let n=Yu(t);return null!=this.maxValue&&(n=_l(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}o6.className="ReLU",wa(o6);class a6 extends I2{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=v2(t);return Mc(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}a6.className="LeakyReLU",wa(a6);class l6 extends I2{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=g2(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=s6(t.alphaRegularizer),this.alphaConstraint=S4(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new z0(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=x2(t)).slice(1);if(null!=this.sharedAxes)for(const t of this.sharedAxes)e[t-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let e=1;e<t.length;++e)n[e]=t[e];this.inputSpec=[new E2({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=v2(t),vu(t,this.alpha.read())}getConfig(){const t={alphaInitializer:m2(this.alphaInitializer),alphaRegularizer:r6(this.alphaRegularizer),alphaConstraint:w4(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}l6.className="PReLU",wa(l6);class c6 extends I2{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new B0(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=v2(t);return Yl(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}c6.className="ELU",wa(c6);class u6 extends I2{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=v2(t);return Na(n,no(_c(n,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}u6.className="ThresholdedReLU",wa(u6);class h6 extends I2{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new q5).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=v2(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function d6(t,e,n){if("number"==typeof t)return j0(t,e);if(t.length!==e)throw new z0(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let i=0;i<e;++i){const s=t[i];if((r=s)!==parseInt(r.toString(),10))throw new z0(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t;var r}function p6(t,e,n,r,i=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((s+r-1)/r)}function f6(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+A1([n-e,0]);else{if("same"!==r)throw new z0(`Unsupport padding mode: ${r}.`);t*=e}return t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function m6(t,e){return Co((()=>(b1(e),"channelsFirst"===e?Do(t,[0,2,3,1]):t)))}function g6(t,e){return Co((()=>(b1(e),"channelsFirst"===e?Do(t,[0,2,3,4,1]):t)))}function y6(t,e,n,r=[1,1],i="valid",s,o,a=null){return Co((()=>{if(null==s&&(s="channelsLast"),b1(s),3!==t.rank&&4!==t.rank)throw new z0(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new z0(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=m6(t,s);if("causal"===i)throw new B0("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=td({x:l,filter:e,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),"channelsFirst"===s&&(l=Do(l,[0,3,1,2])),l}))}h6.className="Softmax",wa(h6);class b6 extends I2{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",b6.verifyArgs(e),this.rank=t,s1(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new B0(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=d6(e.kernelSize,t,"kernelSize"),this.strides=d6(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,v1(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,b1(this.dataFormat),this.activation=Q5(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=g2(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=S4(e.biasConstraint),this.biasRegularizer=s6(e.biasRegularizer),this.activityRegularizer=s6(e.activityRegularizer),this.dilationRate=d6(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new z0(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new z0(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new z0(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(W0("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!i1(t.kernelSize,"number",1,3))throw new z0(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Z5(this.activation),useBias:this.useBias,biasInitializer:m2(this.biasInitializer),biasRegularizer:r6(this.biasRegularizer),activityRegularizer:r6(this.activityRegularizer),biasConstraint:w4(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class v6 extends b6{constructor(t,e){super(t,e),this.kernel=null,v6.verifyArgs(e),this.filters=e.filters,s1(this.filters,"filters"),this.kernelInitializer=g2(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=S4(e.kernelConstraint),this.kernelRegularizer=s6(e.kernelRegularizer)}build(t){t=x2(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new z0(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return Co((()=>{let e;t=v2(t);const n=null==this.bias?null:this.bias.read(),r=a1(this.activation.getClassName());if(null!=r&&2===this.rank)e=y6(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=function(t,e,n,r=1,i="valid",s,o=1){return Co((()=>{if(null==s&&(s="channelsLast"),b1(s),3!==t.shape.length)throw new z0(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new z0(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new z0(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===s&&(t=Do(t,[0,2,1])),"causal"===i)throw new B0("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Cl(t,e,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(a=G1(a,n)),a}))}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=y6(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new B0("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r=[1,1,1],i="valid",s,o){return Co((()=>{if(null==s&&(s="channelsLast"),b1(s),4!==t.rank&&5!==t.rank)throw new z0(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new z0(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=g6(t,s);if("causal"===i)throw new B0("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Il(a,e,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(a=G1(a,n)),"channelsFirst"===s&&(a=Do(a,[0,4,1,2,3])),a}))}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=x2(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let t=0;t<n.length;++t){const r=p6(n[t],this.kernelSize[t],this.padding,this.strides[t],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[t]);e.push(r)}let r=[t[0]];return"channelsLast"===this.dataFormat?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:m2(this.kernelInitializer),kernelRegularizer:r6(this.kernelRegularizer),kernelConstraint:w4(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new z0(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class x6 extends v6{constructor(t){super(2,t),x6.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!i1(t.kernelSize,"number",1,2))throw new z0(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}x6.className="Conv2D",wa(x6);class w6 extends v6{constructor(t){super(3,t),w6.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new z0(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}w6.className="Conv3D",wa(w6);class _6 extends x6{constructor(t){if(super(t),this.inputSpec=[new E2({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new z0(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=x2(t)).length)throw new z0("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new z0("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new E2({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return Co((()=>{let e=v2(t);if(4!==e.shape.length)throw new z0(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s;"channelsFirst"===this.dataFormat?(i=2,s=3):(i=1,s=2);const o=n[i],a=n[s],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,f6(o,u,l,this.padding),f6(a,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Do(e,[0,2,3,1]));let p=Nl(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=Do(p,[0,3,1,2])),null!=this.bias&&(p=G1(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=x2(t)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const s=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],l=this.strides[1];return e[n]=this.filters,e[r]=f6(e[r],a,s,this.padding),e[i]=f6(e[i],l,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}_6.className="Conv2DTranspose",wa(_6);class S6 extends w6{constructor(t){if(super(t),this.inputSpec=[new E2({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new z0(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=x2(t)).length)throw new z0("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new z0("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new E2({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return Co((()=>{let e=v2(t);if(5!==e.shape.length)throw new z0(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s,o;"channelsFirst"===this.dataFormat?(o=2,i=3,s=4):(o=1,i=2,s=3);const a=n[o],l=n[i],c=n[s],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],m=this.strides[2],g=[r,f6(a,p,u,this.padding),f6(l,f,h,this.padding),f6(c,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Do(e,[0,2,3,4,1]));let y=Rl(e,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=Do(y,[0,4,1,2,3])),null!==this.bias&&(y=G1(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(t){const e=(t=x2(t)).slice();let n,r,i,s;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,s=4):(n=4,r=1,i=2,s=3);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],h=this.strides[2];return e[n]=this.filters,e[r]=f6(e[r],c,o,this.padding),e[i]=f6(e[i],u,a,this.padding),e[s]=f6(e[s],h,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}S6.className="Conv3DTranspose",wa(S6);class k6 extends v6{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new z0("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new z0("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new z0(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=g2(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=s6(e.depthwiseRegularizer),this.depthwiseConstraint=S4(e.depthwiseConstraint),this.pointwiseInitializer=g2(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=s6(e.pointwiseRegularizer),this.pointwiseConstraint=S4(e.pointwiseConstraint)}build(t){if((t=x2(t)).length<this.rank+2)throw new z0(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new z0(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let t=0;t<this.rank;++t)i.push(1);i.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new E2({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return Co((()=>{let e;if(t=v2(t),1===this.rank)throw new B0("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=Do(t,[0,2,3,1])),e=sh(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=G1(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=Do(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=m2(this.depthwiseInitializer),t.pointwiseInitializer=m2(this.pointwiseInitializer),t.depthwiseRegularizer=r6(this.depthwiseRegularizer),t.pointwiseRegularizer=r6(this.pointwiseRegularizer),t.depthwiseConstraint=w4(this.depthwiseConstraint),t.pointwiseConstraint=w4(this.pointwiseConstraint),t}}k6.className="SeparableConv";class T6 extends k6{constructor(t){super(2,t)}}T6.className="SeparableConv2D",wa(T6);class E6 extends v6{constructor(t){super(1,t),E6.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!i1(t.kernelSize,"number",1,1))throw new z0(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}E6.className="Conv1D",wa(E6);class M6 extends I2{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return Co((()=>{if(t=v2(t),"channelsLast"===this.dataFormat){const e=D1(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return D1(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=D1(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return D1(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}M6.className="Cropping2D",wa(M6);class C6 extends I2{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,b1(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,r1(p1,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return Co((()=>{let e=v2(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=Do(e,[0,2,3,1]);const t=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?rp.resizeNearestNeighbor(e,[t,r]):rp.resizeBilinear(e,[t,r]);return Do(i,[0,3,1,2])}{const t=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?rp.resizeNearestNeighbor(e,[t,r]):rp.resizeBilinear(e,[t,r])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}C6.className="UpSampling2D",wa(C6);class A6 extends b6{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=g2(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=S4(t.depthwiseConstraint),this.depthwiseRegularizer=s6(t.depthwiseRegularizer)}build(t){if((t=x2(t)).length<4)throw new z0(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new z0(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Co((()=>{let e=
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function(t,e,n=[1,1],r="valid",i,s){return Co((()=>{null==i&&(i="channelsLast"),b1(i);let o=m6(t,i);if(4!==t.rank)throw new z0(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new z0(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Bl(o,e,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(o=Do(o,[0,3,1,2])),o}))}(t=v2(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=G1(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=x2(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=p6(e,this.kernelSize[0],this.padding,this.strides[0]),s=p6(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,s]:[t[0],i,s,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=m2(this.depthwiseInitializer),t.depthwiseRegularizer=r6(this.depthwiseRegularizer),t.depthwiseConstraint=w4(this.depthwiseRegularizer),t}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function N6(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new z0("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function I6(t,e,n,r=!1,i,s,o=!1,a=!1){return Co((()=>{const l=e.shape.length;if(l<3)throw new z0(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(N1(2,l));if(e=Do(e,c),null!=s)throw new B0("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=no(no(i,"bool"),"float32")).rank===l-1&&(i=gc(i,-1)),i=Do(i,c)),r&&(e=Zu(e,0),null!=i&&(i=Zu(i,0)));const u=[];let h,d=n;const p=e.shape[0],f=Ph(e);let m,g;null!=i&&(m=Ph(i));for(let e=0;e<p;++e){const n=f[e],r=Co((()=>t(n,d)));if(null==i)h=r[0],d=r[1];else{const t=Co((()=>{const t=m[e],n=zc(uu(t),t),i=Ma(Na(r[0],t),Na(d[0],n)),s=d.map(((e,i)=>Ma(Na(r[1][i],t),Na(e,n))));return{output:i,newStates:s}}));h=t.output,d=t.newStates}a&&u.push(h)}if(a){g=_h(u,1)}return[h,g,d]}))}A6.className="DepthwiseConv2D",wa(A6);class $6 extends I2{constructor(t){let e;if(super(t),null==t.cell)throw new z0("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new B6({cells:t.cell}):t.cell,null==e.stateSize)throw new z0("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new E2({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return N1(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){y2(t)&&(t=t[0]);let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let r;if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const r of e)n.push([t[0],r]);return[r].concat(n)}return r}computeMask(t,e){return Co((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new B0("Constants support is not implemented in RNN yet.");y2(t)&&(t=t[0]);const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new E2({shape:[e,null,...n]});const r=[t[0]].concat(t.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!m(this.stateSpec.map((t=>t.shape[t.shape.length-1])),i))throw new z0(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map((t=>new E2({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){Co((()=>{if(!this.stateful)throw new D0("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new z0("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>tu([n,t]))):this.states_=[tu([n,this.cell.stateSize])];else if(null==t)Ao(this.states_),null!=this.keptStates&&(Ao(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>tu([n,t]))):this.states_[0]=tu([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new z0(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):Ao(this.states_);for(let e=0;e<this.states_.length;++e){const r=t[e],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,s=[n,i];if(!m(r.shape,s))throw new z0(`State ${e} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${r.shape}`);this.states_[e]=r}}this.states_=this.states_.map((t=>No(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=N6(t,n,r,this.numConstants);t=i.inputs,n=i.initialState,r=i.constants;let s=[],o=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new E2({shape:t.shape}));o=o.concat(this.stateSpec)}null!=r&&(e.constants=r,s=s.concat(r),this.numConstants=r.length);if(s[0]instanceof M2){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Co((()=>{const n=null==e?null:e.mask,r=null==e?null:e.training;let i=null==e?null:e.initialState;t=v2(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new z0(`RNN Layer has ${s} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},a=I6(((t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]}),t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=a[0],c=a[1],u=a[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?c:l;return this.returnState?[h].concat(u):h}))}getInitialState(t){return Co((()=>{let e=tu(t.shape);return e=hc(e,[1,2]),e=O1(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?B1(e,[1,t]):e)):this.cell.stateSize>1?[B1(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===$6.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,t,e)}static fromConfig(t,e,n={}){const r=P4(e.cell,n);return new t(Object.assign(e,{cell:r}))}}$6.className="RNN",wa($6);class R6 extends I2{}class O6 extends R6{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,s1(this.units,"units"),this.activation=Q5(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=g2(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=g2(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=g2(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=s6(t.kernelRegularizer),this.recurrentRegularizer=s6(t.recurrentRegularizer),this.biasRegularizer=s6(t.biasRegularizer),this.kernelConstraint=S4(t.kernelConstraint),this.recurrentConstraint=S4(t.recurrentConstraint),this.biasConstraint=S4(t.biasConstraint),this.dropout=C1([1,A1([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=C1([1,A1([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=x2(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Co((()=>{if(2!==t.length)throw new z0(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=U6({ones:()=>uu(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=U6({ones:()=>uu(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;i=V1(null!=s?Na(t,s):t,this.kernel.read()),null!=this.bias&&(i=G1(i,this.bias.read())),null!=o&&(n=Na(n,o));let a=Ma(i,V1(n,this.recurrentKernel.read()));return null!=this.activation&&(a=this.activation.apply(a)),[a,a]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Z5(this.activation),useBias:this.useBias,kernelInitializer:m2(this.kernelInitializer),recurrentInitializer:m2(this.recurrentInitializer),biasInitializer:m2(this.biasInitializer),kernelRegularizer:r6(this.kernelRegularizer),recurrentRegularizer:r6(this.recurrentRegularizer),biasRegularizer:r6(this.biasRegularizer),activityRegularizer:r6(this.activityRegularizer),kernelConstraint:w4(this.kernelConstraint),recurrentConstraint:w4(this.recurrentConstraint),biasConstraint:w4(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,e)}}O6.className="SimpleRNNCell",wa(O6);class P6 extends $6{constructor(t){t.cell=new O6(t),super(t)}call(t,e){return Co((()=>{null!=this.cell.dropoutMask&&(Ao(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ao(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return new t(e)}}P6.className="SimpleRNN",wa(P6);class L6 extends R6{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new z0("GRUCell does not support reset_after parameter set to true.");this.units=t.units,s1(this.units,"units"),this.activation=Q5(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Q5(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=g2(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=g2(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=g2(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=s6(t.kernelRegularizer),this.recurrentRegularizer=s6(t.recurrentRegularizer),this.biasRegularizer=s6(t.biasRegularizer),this.kernelConstraint=S4(t.kernelConstraint),this.recurrentConstraint=S4(t.recurrentConstraint),this.biasConstraint=S4(t.biasConstraint),this.dropout=C1([1,A1([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=C1([1,A1([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=x2(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return Co((()=>{if(2!==t.length)throw new z0(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=U6({ones:()=>uu(t),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=U6({ones:()=>uu(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let o,a,l;0<this.dropout&&this.dropout<1&&(t=Na(t,i[0]));let c=V1(t,this.kernel.read());this.useBias&&(c=G1(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Na(r,s[0]));const u=this.recurrentKernel.read(),[h,d]=bh(u,[2*this.units,this.units],u.rank-1),p=V1(r,h),[f,m,g]=bh(c,3,c.rank-1),[y,b]=bh(p,2,p.rank-1);o=this.recurrentActivation.apply(Ma(f,y)),a=this.recurrentActivation.apply(Ma(m,b));const v=V1(Na(a,r),d);l=this.activation.apply(Ma(g,v));const x=Ma(Na(o,r),Na(Ma(1,Po(o)),l));return[x,x]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Z5(this.activation),recurrentActivation:Z5(this.recurrentActivation),useBias:this.useBias,kernelInitializer:m2(this.kernelInitializer),recurrentInitializer:m2(this.recurrentInitializer),biasInitializer:m2(this.biasInitializer),kernelRegularizer:r6(this.kernelRegularizer),recurrentRegularizer:r6(this.recurrentRegularizer),biasRegularizer:r6(this.biasRegularizer),activityRegularizer:r6(this.activityRegularizer),kernelConstraint:w4(this.kernelConstraint),recurrentConstraint:w4(this.recurrentConstraint),biasConstraint:w4(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,e)}}L6.className="GRUCell",wa(L6);class D6 extends $6{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new L6(t),super(t)}call(t,e){return Co((()=>{null!=this.cell.dropoutMask&&(Ao(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ao(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}D6.className="GRU",wa(D6);class F6 extends R6{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,s1(this.units,"units"),this.activation=Q5(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Q5(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=g2(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=g2(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=g2(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=s6(t.kernelRegularizer),this.recurrentRegularizer=s6(t.recurrentRegularizer),this.biasRegularizer=s6(t.biasRegularizer),this.kernelConstraint=S4(t.kernelConstraint),this.recurrentConstraint=S4(t.recurrentConstraint),this.biasConstraint=S4(t.biasConstraint),this.dropout=C1([1,A1([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=C1([1,A1([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=x2(t))[t.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;r=new((e=class extends Z1{apply(e,r){const i=t.apply([n]),s=(new Q1).apply([n]),o=t.apply([2*n]);return z1(z1(i,s),o)}}).className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return Co((()=>{const n=null!=e.training&&e.training;if(3!==t.length)throw new z0(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=U6({ones:()=>uu(t),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=U6({ones:()=>uu(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c,u;0<this.dropout&&this.dropout<1&&(t=Na(t,s[0]));let h=V1(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Na(r,o[0])),h=Ma(h,V1(r,this.recurrentKernel.read())),this.useBias&&(h=G1(h,this.bias.read()));const[d,p,f,m]=bh(h,4,h.rank-1);a=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=Ma(Na(l,i),Na(a,this.activation.apply(f))),u=this.recurrentActivation.apply(m);const g=Na(u,this.activation.apply(c));return[g,g,c]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Z5(this.activation),recurrentActivation:Z5(this.recurrentActivation),useBias:this.useBias,kernelInitializer:m2(this.kernelInitializer),recurrentInitializer:m2(this.recurrentInitializer),biasInitializer:m2(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:r6(this.kernelRegularizer),recurrentRegularizer:r6(this.recurrentRegularizer),biasRegularizer:r6(this.biasRegularizer),activityRegularizer:r6(this.activityRegularizer),kernelConstraint:w4(this.kernelConstraint),recurrentConstraint:w4(this.recurrentConstraint),biasConstraint:w4(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,e)}}F6.className="LSTMCell",wa(F6);class z6 extends $6{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new F6(t),super(t)}call(t,e){return Co((()=>{null!=this.cell.dropoutMask&&(Ao(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ao(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}z6.className="LSTM",wa(z6);class B6 extends R6{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return Co((()=>{let n=t.slice(1);const r=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?r.push(n.splice(0,t.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let s;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=r[o],s=0===o?[t[0]].concat(n):[s[0]].concat(n),s=a.call(s,e),i.push(s.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[s[0]].concat(n)}))}build(t){let e;y2(t)&&(t=t[0]),this.cells.forEach(((n,r)=>{_1(`RNNCell_${r}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign({},t,e)}static fromConfig(t,e,n={}){const r=[];for(const t of e.cells)r.push(P4(t,n));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return k2(t)}setWeights(t){const e=[];for(const n of this.cells){const r=n.weights.length,i=t.splice(r);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],i[t]])}T2(e)}}function U6(t){const{ones:e,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=t,o=()=>null!=s?s(e(),n):q1(e(),n),a=()=>X1(o,e,r);if(!i||i<=1)return No(a().clone());return Array(i).fill(void 0).map(a).map((t=>No(t.clone())))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */B6.className="StackedRNNCells",wa(B6);var V6=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};class j6 extends $6{constructor(t){if(t.unroll)throw new B0("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new B0("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new E2({ndim:5})]}call(t,e){return Co((()=>{if(null!=this.cell.dropoutMask&&(Ao(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Ao(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new z0("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return Co((()=>{const{stateSize:e}=this.cell,n=t.shape,r=this.computeSingleOutputShape(n),i=tu([r[0],...r.slice(2)]);return Array.isArray(e)?Array(e.length).fill(i):[i]}))}resetStates(t,e=!1){Co((()=>{if(!this.stateful)throw new D0("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new z0("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>tu(i))):this.states_=[tu(i)];else if(null==t)Ao(this.states_),null!=this.keptStates&&(Ao(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>tu(i))):this.states_[0]=tu(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new z0(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):Ao(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],r=i;if(!m(n.shape,r))throw new z0(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>No(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:r,padding:i,strides:s,dilationRate:o}=this.cell,a="channelsFirst"===e,l=t[a?3:2],c=t[a?4:3],u=p6(l,r[0],i,s[0],o[0]),h=p6(c,r[1],i,s[1],o[1]);return[...t.slice(0,2),...a?[n,u,h]:[u,h,n]]}}j6.className="ConvRNN2D";class W6 extends F6{constructor(t){const{filters:e,kernelSize:n,strides:r,padding:i,dataFormat:s,dilationRate:o}=t;super(Object.assign({},t,{units:e})),this.filters=e,s1(this.filters,"filters"),this.kernelSize=d6(n,2,"kernelSize"),this.kernelSize.forEach((t=>s1(t,"kernelSize"))),this.strides=d6(r||1,2,"strides"),this.strides.forEach((t=>s1(t,"strides"))),this.padding=i||"valid",v1(this.padding),this.dataFormat=s||"channelsLast",b1(this.dataFormat),this.dilationRate=d6(o||1,2,"dilationRate"),this.dilationRate.forEach((t=>s1(t,"dilationRate")))}build(t){var e;t=x2(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new z0(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;t=new(e=class extends Z1{apply(t,e){return F1([n.apply([r]),eu([r]),n.apply([2*r])])}},e.className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return Co((()=>{if(3!==t.length)throw new z0(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,r=t[0],i=t[1],s=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=U6({ones:()=>uu(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=(t,e,n)=>e&&e[n]?Na(e[n],t):t;let l=a(r,o,0),c=a(r,o,1),u=a(r,o,2),h=a(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=U6({ones:()=>uu(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=a(i,d,0),f=a(i,d,1),m=a(i,d,2),g=a(i,d,3);const[y,b,v,x]=bh(this.kernel.read(),4,3),[w,_,S,k]=this.useBias?bh(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,w,this.padding),c=this.inputConv(c,b,_,this.padding),u=this.inputConv(u,v,S,this.padding),h=this.inputConv(h,x,k,this.padding);const[T,E,M,C]=bh(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,T),f=this.recurrentConv(f,E),m=this.recurrentConv(m,M),g=this.recurrentConv(g,C);const A=this.recurrentActivation.apply(Ma(l,p)),N=this.recurrentActivation.apply(Ma(c,f)),I=Ma(Na(N,s),Na(A,this.activation.apply(Ma(u,m)))),$=Na(this.recurrentActivation.apply(Ma(h,g)),this.activation.apply(I));return[$,$,I]}))}getConfig(){const t=super.getConfig(),e=V6(t,["units"]),n={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},e,n)}inputConv(t,e,n,r){const i=Ml(t,e,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?G1(i,n,this.dataFormat):i}recurrentConv(t,e){return Ml(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}W6.className="ConvLSTM2DCell",wa(W6);class H6 extends j6{constructor(t){const e=new W6(t);super(Object.assign({},t,{cell:e}))}static fromConfig(t,e){return new t(e)}}H6.className="ConvLSTM2D",wa(H6);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class G6 extends I2{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let t=0;t<this.noiseShape.length;++t)n.push(null==this.noiseShape[t]?e[t]:this.noiseShape[t]);return n}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,r=this.getNoiseShape(n);return X1((()=>q1(n,this.rate,r,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}G6.className="Dropout",wa(G6);class q6 extends G6{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}q6.className="SpatialDropout1D",wa(q6);class X6 extends I2{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,s1(this.units,"units"),this.activation=Q5(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=g2(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=g2(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=S4(t.kernelConstraint),this.biasConstraint=S4(t.biasConstraint),this.kernelRegularizer=s6(t.kernelRegularizer),this.biasRegularizer=s6(t.biasRegularizer),this.activityRegularizer=s6(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=x2(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=x2(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t),r=a1(this.activation.getClassName());let i;return null!=r?i=V1(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=V1(n,this.kernel.read()),null!=this.bias&&(i=G1(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const t={units:this.units,activation:Z5(this.activation),useBias:this.useBias,kernelInitializer:m2(this.kernelInitializer),biasInitializer:m2(this.biasInitializer),kernelRegularizer:r6(this.kernelRegularizer),biasRegularizer:r6(this.biasRegularizer),activityRegularizer:r6(this.activityRegularizer),kernelConstraint:w4(this.kernelConstraint),biasConstraint:w4(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}X6.className="Dense",wa(X6);class Y6 extends I2{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=x2(t);for(const e of t.slice(1))if(null==e)throw new z0(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],M1(t,1)]}call(t,e){return Co((()=>{this.invokeCallHook(t,e);let n=v2(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=Do(n,t)}return function(t){if(t.rank<=1)throw new z0(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],M1(t.shape,1)];return il(t,e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}Y6.className="Flatten",wa(Y6);class K6 extends I2{constructor(t){super(t),this.supportsMasking=!0,this.activation=Q5(t.activation)}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t);return this.activation.apply(n)}))}getConfig(){const t={activation:Z5(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}K6.className="Activation",wa(K6);class Z6 extends I2{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return Co((()=>function(t,e){return Co((()=>{if(2!==t.shape.length)throw new z0(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return B1(O1(t,1),[1,e,1])}))}(t=v2(t),this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}Z6.className="RepeatVector",wa(Z6);class J6 extends I2{constructor(t){super(t),this.targetShape=t.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",r=e.slice();let i=1,s=null;for(let t=0;t<r.length;++t){const e=r[t];if(this.isUnknown(e)){if(null!==s)throw new z0("Can only specifiy one unknown dimension.");s=t}else i*=e}const o=M1(t);if(null!==s){if(0===i||o%i!=0)throw new z0(n);r[s]=o/i}else if(o!==i)throw new z0(n);return r}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return il(n,i)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}J6.className="Reshape",wa(J6);class Q6 extends I2{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=N1(1,t.dims.length+1);if(!m(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new E2({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=x2(t)).slice();return this.dims.forEach(((n,r)=>{e[r+1]=t[n]})),e}call(t,e){return Do(v2(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}Q6.className="Permute",wa(Q6);class t8 extends I2{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=v2(t);return La(cu(n,this.maskValue),-1)}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t),r=La(cu(n,this.maskValue),-1,!0);return Na(n,no(r,n.dtype))}))}}t8.className="Masking",wa(t8);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class e8 extends I2{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(q0(t.inputLength))}this.inputDim=t.inputDim,s1(this.inputDim,"inputDim"),this.outputDim=t.outputDim,s1(this.outputDim,"outputDim"),this.embeddingsInitializer=g2(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=s6(t.embeddingsRegularizer),this.activityRegularizer=s6(t.activityRegularizer),this.embeddingsConstraint=S4(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return Co((()=>this.maskZero?(t=v2(t),cu(t,Hl(t))):null))}computeOutputShape(t){if(t=x2(t),null==this.inputLength)return[...t,this.outputDim];const e=q0(this.inputLength);if(e.length!==t.length-1)throw new z0(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=t[r+1];if(null!=i&&null!=s&&i!==s)throw new z0(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==i&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return Co((()=>{this.invokeCallHook(t,e);let n=v2(t);"int32"!==n.dtype&&(n=R1(n,"int32"));const r=j1(this.embeddings.read(),il(n,[n.size]));return il(r,x2(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:m2(this.embeddingsInitializer),embeddingsRegularizer:r6(this.embeddingsRegularizer),activityRegularizer:r6(this.activityRegularizer),embeddingsConstraint:w4(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}e8.className="Embedding",wa(e8);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class n8 extends I2{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new B0}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],s=e[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new z0("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[x2(t)]),t.length<2)throw new z0(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const n of t)null!=n&&null!==n[0]&&e.push(n[0]);if(e=e1(e),e.length>1)throw new z0(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let e=1;e<t.length;++e){const r=null==t[e]?null:t[e].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}const r=t.map((t=>t.length));-1===t.indexOf(null)&&1===e1(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return Co((()=>{if(this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const r=A1(n);for(let n of t){const t=n.rank;for(let e=0;e<r-t;++e)n=O1(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const r of t){const t=r.rank;if(null==t){const t=r.shape,i=t[0],s=t.slice(1).concat([i]);let o=il(r,[i].concat(M1(t.slice(1))));o=Do(o,[1,0]),o=il(o,s),e.push(o),n=!0}else if(t>1){const i=N1(1,t).concat([0]);e.push(Do(r,i)),n=!0}else e.push(r)}let r=this.mergeFunction(e);const i=r.rank;if(n)if(null==i){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=il(Do(il(r,[-1,e]),[1,0]),n)}else if(i>1){const t=[i-1].concat(N1(0,i-1));r=Do(r,t)}return r}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==t[0]?null:t[0].slice(1);for(let n=1;n<t.length;++n){const r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}let n=[];for(const e of t)null!=e&&null!==e[0]&&n.push(e[0]);return n=e1(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return Co((()=>{if(null==e)return null;if(!Array.isArray(e))throw new z0("`mask` should be an Array");if(!Array.isArray(t))throw new z0("`inputs` should be an Array");if(e.length!==t.length)throw new z0(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;e=e.map((t=>null==t?t:gc(t,0)));let n=e[0];for(let t=1;t<e.length-1;++t)n=Vc(n,e[t]);return n}))}}class r8 extends n8{constructor(t){super(t)}mergeFunction(t){return Co((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Ma(e,t[n]);return e}))}}r8.className="Add",wa(r8);class i8 extends n8{constructor(t){super(t)}mergeFunction(t){return Co((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Na(e,t[n]);return e}))}}i8.className="Multiply",wa(i8);class s8 extends n8{constructor(t){super(t)}mergeFunction(t){return Co((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Ma(e,t[n]);return Na(1/t.length,e)}))}}s8.className="Average",wa(s8);class o8 extends n8{constructor(t){super(t)}mergeFunction(t){return Co((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Jc(e,t[n]);return e}))}}o8.className="Maximum",wa(o8);class a8 extends n8{constructor(t){super(t)}mergeFunction(t){return Co((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=ru(e,t[n]);return e}))}}a8.className="Minimum",wa(a8);class l8 extends n8{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new z0("A `Concatenate` layer should be called on a list of at least 2 inputs");let e=!0;for(const n of t)if(null!=n){e=!1;break}if(e)return;const n=[];for(let e=0;e<t.length;++e){const r=t[e].slice();r.splice(this.axis,1);let i=!1;for(const t of n)if(m(t,r)){i=!0;break}i||n.push(r)}if(n.length>1)throw new z0("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return Co((()=>F1(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new z0("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const t of e.slice(1)){if(null==n[r]||null==t[r]){n[r]=null;break}n[r]+=t[r]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new z0("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new z0("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new z0(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return Co((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const r=[];for(let n=0;n<t.length;++n)null==e[n]?r.push(no(uu(t[n]),"bool")):e[n].rank<t[n].rank?r.push(gc(e[n],-1)):r.push(e[n]);const i=al(r,this.axis);return Pa(i,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function c8(t,e){for(;t<0;)t+=e;return t}l8.className="Concatenate",wa(l8);class u8 extends n8{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){u(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new B0("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new z0(`Dimension incompatibility: ${e[r[0]]} !== ${n[r[1]]}`)}mergeFunction(t){if(2!==t.length)throw new z0(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>c8(e,t[n].shape.length))):[c8(this.axes,n.shape.length),c8(this.axes,r.shape.length)],this.normalize&&(n=L4(n,e[0]),r=L4(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new B0("batchDot is not implemented for tensors of 4D or higher rank yet");if(u(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),u(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new B0("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,i=e.shape.length;null==n&&(n=[r-1,i-2]);const s=n;return Co((()=>{let n,o;if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=il(e,e.shape.concat(t))}else if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=il(t,t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)o=s[0]===s[1]?hc(Na(t,e),s[0]):hc(Na(Do(t,[1,0]),e),s[1]);else{const n=s[0]!==t.shape.length-1,r=s[1]===e.shape.length-1;o=ko(t,e,n,r)}if(n>0){let t;t=r>i?r+i-3:r-1;const e=[];for(let r=t;r<t+n;++r)e.push(r);o=wh(o,e)}return 1===o.shape.length&&(o=gc(o,1)),o}))}(n,r,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[c8(this.axes,t.length),c8(this.axes,e.length)],n}computeOutputShape(t){u(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new B0("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=e.concat(n);return 1===i.length&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}u8.className="Dot",wa(u8);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class h8 extends I2{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t);return X1((()=>Ma(U1(n.shape,0,this.stddev),n)),(()=>n),e.training||!1)}))}}h8.className="GaussianNoise",wa(h8);class d8 extends I2{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Co((()=>{this.invokeCallHook(t,e);const n=v2(t);if(this.rate>0&&this.rate<1){return X1((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return Na(n,U1(n.shape,1,t))}),(()=>n),e.training||!1)}return n}))}}d8.className="GaussianDropout",wa(d8);class p8 extends I2{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||v2(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Co((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return X1((()=>{const e=v2(t),r=-1.7580993408473766;let i=Sc(Gu(n),this.rate);i=R1(i,"float32");const s=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-s*r*this.rate,a=Ma(Na(e,i),Na(Ma(i,-1),r));return Ma(Na(a,s),o)}),(()=>v2(t)),e.training||!1)}return t}))}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function f8(t,e,n,r,i,s=.001){let o;if(2===t.rank)o=fl(t,e,n,r,i,s);else if(3===t.rank)o=ml(t,e,n,r,i,s);else{if(4!==t.rank)throw new B0(`batchNormalization is not implemented for array of rank ${t.rank} yet`);o=gl(t,e,n,r,i,s)}return o}function m8(t,e,n,r,i=.001){return m(r.slice().sort(),N1(0,t.rank-1))?function(t,e,n,r,i=.001){return Co((()=>{const s=ou(t,r),o=s.mean,a=s.variance;return[f8(t,o,a,n,e,i),o,a]}))}(t,e,n,r,i):function(t,e,n,r,i=.001){return Co((()=>{const s=ou(t,r),o=s.mean,a=s.variance,l=[];for(const e of N1(0,t.rank))-1!==r.indexOf(e)?l.push(1):l.push(t.shape[e]);const c=il(o,l),u=il(a,l),h=null==e?null:il(e,l),d=null==n?null:il(n,l);return[f8(t,c,u,d,h,i),o,a]}))}(t,e,n,r,i)}p8.className="AlphaDropout",wa(p8);class g8 extends I2{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=g2(t.betaInitializer||"zeros"),this.gammaInitializer=g2(t.gammaInitializer||"ones"),this.movingMeanInitializer=g2(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=g2(t.movingVarianceInitializer||"ones"),this.betaConstraint=S4(t.betaConstraint),this.gammaConstraint=S4(t.gammaConstraint),this.betaRegularizer=s6(t.betaRegularizer),this.gammaRegularizer=s6(t.gammaRegularizer)}build(t){t=x2(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new z0(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new E2({ndim:t.length,axes:{[e]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return Co((()=>{const n=null!=e.training&&e.training,r=v2(t),i=r.shape,s=i.length,o=N1(0,s),a=this.axis>=0?this.axis:this.axis+s;o.splice(a,1);const l=j0(1,s);l[a]=i[a];const c=o.slice();c.sort();const u=!m(c,N1(0,s).slice(0,s-1));if(!n)return(()=>{if(u){const t=il(this.movingMean.read(),l),e=il(this.movingVariance.read(),l),n=this.center?il(this.beta.read(),l):null,i=this.scale?il(this.gamma.read(),l):null;return f8(r,t,e,n,i,this.epsilon)}return f8(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=m8(r,this.gamma.read(),this.beta.read(),o,this.epsilon),f=(t,e,n)=>{Co((()=>{const r=1-n,i=t.read(),s=Na(zc(i,e),r);t.write(zc(i,s))}))};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:m2(this.betaInitializer),gammaInitializer:m2(this.gammaInitializer),movingMeanInitializer:m2(this.movingMeanInitializer),movingVarianceInitializer:m2(this.movingVarianceInitializer),betaRegularizer:r6(this.betaRegularizer),gammaRegularizer:r6(this.gammaRegularizer),betaConstraint:w4(this.betaConstraint),gammaConstraint:w4(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}g8.className="BatchNormalization",wa(g8);class y8 extends I2{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=g2(t.betaInitializer||"zeros"),this.gammaInitializer=g2(t.gammaInitializer||"ones"),this.betaRegularizer=s6(t.betaRegularizer),this.gammaRegularizer=s6(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=x2(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let t=0;t<this.axis.length;++t)this.axis[t]<0&&(this.axis[t]+=e);for(const t of this.axis)if(t<0||t>=e)throw new Error(`Invalid axis: ${t}`);if(this.axis.length!==e1(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(t,e){const n=v2(t),r=n.shape,i=r.length;return Co((()=>{let{mean:t,variance:e}=ou(n,this.axis,!0);const s=j0(1,i);for(const t of this.axis)s[t]=r[t];const o=t=>null!=t&&t.shape.length!==i?il(t,s):t;let a=this.scale?o(this.gamma.read()):null,l=this.center?o(this.beta.read()):null;const c=[],u=[];for(let t=0;t<i;++t)-1!==this.axis.indexOf(t)?(c.push(r[t]),u.push(1)):(c.push(1),u.push(r[t]));return t=bc(t,c),e=bc(e,c),null!=a&&(a=bc(a,u)),null!=l&&(l=bc(l,u)),f8(n,t,e,l,a,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:m2(this.betaInitializer),gammaInitializer:m2(this.gammaInitializer),betaRegularizer:r6(this.betaRegularizer),gammaRegularizer:r6(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}y8.className="LayerNormalization",wa(y8);class b8 extends I2{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new z0(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new z0(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new z0(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new E2({ndim:4})]}computeOutputShape(t){let e,n;return t=x2(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return Co((()=>{return e=v2(t),n=this.padding,r=this.dataFormat,Co((()=>{if(4!==e.rank)throw new z0(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new z0("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new z0(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],du(e,t)}));
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
var e,n,r}))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function v8(t,e,n,r,i,s){return Co((()=>{let o;b1(i),x1(s),v1(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=m6(t,i);const a="same"===r?"same":"valid";return o="max"===s?Yc(t,e,n,a):sl(t,e,n,a),"channelsFirst"===i&&(o=Do(o,[0,3,1,2])),o}))}function x8(t,e,n,r,i,s){return Co((()=>{let o;b1(i),x1(s),v1(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=g6(t,i);const a="same"===r?"same":"valid";return o="max"===s?Kc(t,e,n,a):ol(t,e,n,a),"channelsFirst"===i&&(o=Do(o,[0,4,1,2,3])),o}))}b8.className="ZeroPadding2D",wa(b8);class w8 extends I2{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new z0(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(s1(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new z0(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}s1(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,v1(this.padding),this.inputSpec=[new E2({ndim:3})]}computeOutputShape(t){const e=p6((t=x2(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return Co((()=>{this.invokeCallHook(t,e),t=O1(v2(t),2);const n=this.poolingFunction(v2(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return wh(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class _8 extends w8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),v8(t,e,n,r,i,"max")}}_8.className="MaxPooling1D",wa(_8);class S8 extends w8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),v8(t,e,n,r,i,"avg")}}S8.className="AveragePooling1D",wa(S8);class k8 extends I2{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new z0(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];s1(this.poolSize,"poolSize"),s1(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,b1(this.dataFormat),v1(this.padding),this.inputSpec=[new E2({ndim:4})]}computeOutputShape(t){t=x2(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=p6(e,this.poolSize[0],this.padding,this.strides[0]),n=p6(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return Co((()=>(this.invokeCallHook(t,e),this.poolingFunction(v2(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class T8 extends k8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),v8(t,e,n,r,i,"max")}}T8.className="MaxPooling2D",wa(T8);class E8 extends k8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),v8(t,e,n,r,i,"avg")}}E8.className="AveragePooling2D",wa(E8);class M8 extends I2{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new z0(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];s1(this.poolSize,"poolSize"),s1(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,b1(this.dataFormat),v1(this.padding),this.inputSpec=[new E2({ndim:5})]}computeOutputShape(t){t=x2(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=p6(e,this.poolSize[0],this.padding,this.strides[0]),n=p6(n,this.poolSize[1],this.padding,this.strides[1]),r=p6(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]}call(t,e){return Co((()=>(this.invokeCallHook(t,e),this.poolingFunction(v2(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class C8 extends M8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),x8(t,e,n,r,i,"max")}}C8.className="MaxPooling3D",wa(C8);class A8 extends M8{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return b1(i),v1(r),x8(t,e,n,r,i,"avg")}}A8.className="AveragePooling3D",wa(A8);class N8 extends I2{constructor(t){super(t),this.inputSpec=[new E2({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new B0}}class I8 extends N8{constructor(t){super(t||{})}call(t,e){return Co((()=>{const e=v2(t);return Qc(e,1)}))}}I8.className="GlobalAveragePooling1D",wa(I8);class $8 extends N8{constructor(t){super(t||{})}call(t,e){return Co((()=>{const e=v2(t);return sc(e,1)}))}}$8.className="GlobalMaxPooling1D",wa($8);class R8 extends I2{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,b1(this.dataFormat),this.inputSpec=[new E2({ndim:4})]}computeOutputShape(t){return"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new B0}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class O8 extends R8{call(t,e){return Co((()=>{const e=v2(t);return"channelsLast"===this.dataFormat?Qc(e,[1,2]):Qc(e,[2,3])}))}}O8.className="GlobalAveragePooling2D",wa(O8);class P8 extends R8{call(t,e){return Co((()=>{const e=v2(t);return"channelsLast"===this.dataFormat?sc(e,[1,2]):sc(e,[2,3])}))}}P8.className="GlobalMaxPooling2D",wa(P8);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class L8 extends I2{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const r=P4(e.layer,n);delete e.layer;const i={layer:r};return Object.assign(i,e),new t(i)}}class D8 extends L8{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=x2(t)).length<3)throw new z0(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=x2(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))}call(t,e){return Co((()=>I6(((t,n)=>[v2(this.layer.call(t,e)),[]]),t=v2(t),[],!1,null,null,!1,!0)[1]))}}D8.className="TimeDistributed",wa(D8);class F8 extends L8{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=P4(n),e.goBackwards=!0!==e.goBackwards;const r={};var i;if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=P4(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,i=this.mergeMode,r1(g1,"BidirectionalMergeMode",i),t.weights)throw new B0("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(r=i.slice(1),e=i[0]):e=i[0],"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):G0(n)}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=N6(t,n,r,this.numConstants);if(t=i.inputs,n=i.initialState,r=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==r)return super.apply(t,e);const s=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new z0("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const r=n.map((t=>new E2({shape:t.shape})));this.forwardLayer.stateSpec=r.slice(0,t/2),this.backwardLayer.stateSpec=r.slice(t/2),o.push(...r)}if(null!=r)throw new B0("Support for constants in Bidirectional layers is not implemented yet.");const a=s[0]instanceof M2;for(const t of s)if(t instanceof M2!==a)throw new z0("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Co((()=>{const n=e.initialState;let r,i,s,o;if(null==n)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const s=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:s})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Zu(i,1)),"concat"===this.mergeMode?o=F1([r,i]):"sum"===this.mergeMode?o=Ma(r,i):"ave"===this.mergeMode?o=Na(.5,Ma(r,i)):"mul"===this.mergeMode?o=Na(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(s):[o].concat(s):o}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){_1(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),_1(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=P4(e.layer);if(delete e.layer,null!=e.numConstants)throw new B0("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=n,new t(r)}}F8.className="Bidirectional",wa(F8);
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class z8 extends I2{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return Co((()=>("float32"!==(t=v2(t)).dtype&&(t=R1(t,"float32")),Ma(Na(t,this.scale),this.offset))))}}function B8(t){return new X6(t)}function U8(t,e){return F4(t,e)}function V8(t){if(!t.modelTopology.model_config||!t.modelTopology.model_config.config||!t.modelTopology.model_config.config.layers||t.modelTopology.model_config.config.layers.length>0&&!t.modelTopology.model_config.config.layers[0].class_name)return t;try{let e=!1;for(const[n,r]of t.modelTopology.model_config.config.layers.entries())if("SeparableConv2D"===r.class_name){const r=["kernel_constraint","kernel_initializer","kernel_regularizer"];for(const i of r)Object.keys(t.modelTopology.model_config.config.layers[n].config).includes(i)&&(e=!0),delete t.modelTopology.model_config.config.layers[n].config[i]}e&&eG.warning("TFJS Model loading: experimentally removing Kernel attributes from SeparableConv2D layers")}catch(t){eG.warning("TFJS Model loading: An error occurred whil experimentally removing Kernel attributes from SeparableConv2D layers",t)}return t}function j8(...t){const e=go(...t),n=e.load.bind(e);return e.load=async function(){return V8(await n())},e}function W8(...t){const e=lo(...t),n=e.load.bind(e);return e.load=async function(){return V8(await n())},e}z8.className="Rescaling",wa(z8);class H8 extends vQ{constructor(){super(...arguments),this.serviceName="tfjs-models"}async warmup(){const t=this.model.inputs[0].shape.map((t=>t&&t>0?t:1)),e=this.model.predict(Co((()=>tu(t))));await e.data(),e.dispose()}async save(t,e,n,r=null){if(!this.model)return null;let i;if(t.backend===gJ.LocalStorage)await this.model.save(`indexeddb://${e}`),i=[["main",`indexeddb://${e}`]];else if(t.backend===gJ.Remote){const e={};if(t.requiresAuth){const n=await t.feathers.authentication.getAccessToken(),r=new Headers({Authorization:`Bearer ${n}`});e.requestInit={headers:r}}i=await this.model.save(j8(`${t.location}/tfjs-models/upload`,e)).then((t=>t.responses[0].json()))}const s={name:e,files:i,format:"tfjs",metadata:{tfjsModelFormat:this.model instanceof N5?"layers-model":"graph-model",...this.labels&&{labels:this.labels},...n}};return this.saveToDatastore(t,s,r)}async load(t,e){if(!e)return null;this.$training.set({status:"loading"}),this.ready=!1;try{const n=await this.loadFromDatastore(t,e);let r;if(this.loadFn="graph-model"===n.metadata.tfjsModelFormat?P0:P5,t.backend===gJ.LocalStorage)r=await this.loadFn(n.files[0][1]);else if(t.backend===gJ.Remote){const e={};if(t.requiresAuth){const n=await t.feathers.authentication.getAccessToken(),r=new Headers({Authorization:`Bearer ${n}`});e.requestInit={headers:r}}r=await this.loadFn(j8(`${t.location}/tfjs-models/${n.id}/model.json`,e))}return r&&(this.model=r,await this.warmup()),n.metadata&&n.metadata.labels?this.labels=n.metadata.labels:this.labels=void 0,this.$training.set({status:"loaded",data:{source:"datastore",url:t.location}}),n}catch(t){throw console.log("[tfjs-model] Loading error",t),this.$training.set({status:"error"}),t}}async download(t){const e=kJ(this.title),n={type:"tfjs-model",tfjsModelFormat:this.model instanceof N5?"layers-model":"graph-model",name:e,...this.labels&&{labels:this.labels},...t},r=new Date(Date.now());await this.model.save(_o((async t=>{const i={modelTopology:t.modelTopology,weightsManifest:[{paths:[`./${e}.weights.bin`],weights:t.weightSpecs}],marcelle:n};return await _J(t.weightData,`${e}.weights.bin`,"application/octet-stream"),await _J(JSON.stringify(i),`${e}.json`,"text/plain"),{modelArtifactsInfo:{dateSaved:r,modelTopologyType:"JSON"}}})))}async upload(...t){this.$training.set({status:"loading"});try{const e=t.filter((t=>t.name.includes(".json"))),n=t.filter((t=>t.name.includes(".bin"))),{marcelle:r}=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=t=>n(new Error(`The provided files are not a valid marcelle model ${t}`)),r.readAsText(e[0])}));if(this.loadFn="graph-model"===r.tfjsModelFormat?P0:P5,1===e.length&&t.length){const t=await this.loadFn(W8([e[0],...n]));return t&&(this.model=t,await this.warmup()),r&&r.labels?this.labels=r.labels:this.labels=null,this.$training.set({status:"loaded",data:{source:"file"}}),{name:r.name,format:"tfjs",files:[],metadata:r}}const i=new Error("The provided files are not compatible with this model");throw i.name="File upload error",i}catch(t){throw this.$training.set({status:"error"}),t}}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */
function G8(t,e){return q8(t,e)}function q8(t,e,n=new Map,r=new Set){if(null==t)return null;if("function"==typeof Blob&&t instanceof Blob)return t.slice();if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(Z8(t)){const i=Array.isArray(t)?[]:{};r.add(t);for(const s in t){const o=q8(t[s],e,n,r);i[s]=o}return r.delete(t),t.__proto__&&(i.__proto__=t.__proto__),i}throw new Error(`Can't recurse into non-iterable type: ${t}`)}return n.set(t,i.value),i.value}function X8(t,e=K8){return Y8(t,e)}function Y8(t,e,n=new Set){const r=t[0];if(n.has(r))throw new Error("Circular references are not supported.");const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(Z8(r)){const i=Array.isArray(r)?[]:{};n.add(r);for(const s in r){const r=Y8(t.map((t=>t[s])),e,n);i[s]=r}return n.delete(r),i}throw new Error(`Can't recurse into non-iterable type: ${r}`)}return i.value}function K8(t){return null===t?null:Z8(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function Z8(t){let e=!1;if(K().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");e=t instanceof n}return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof Si)&&!(t instanceof Promise)&&!e)}function J8(t){return t instanceof Si?{value:t.clone(),recurse:!1}:Z8(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */FH([rG],H8.prototype,"warmup",null),FH([rG],H8.prototype,"upload",null),
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.gather=function(t,e){return this.throwIfDisposed(),wc(this,t,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.argMax=function(t){return this.throwIfDisposed(),Da(this,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.squeeze=function(t){return this.throwIfDisposed(),wh(this,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.expandDims=function(t){return this.throwIfDisposed(),gc(this,t)};class Q8{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */class t7 extends Q8{constructor(){super(t7.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let t=0;t<n;t++)e[t]=this.get(this.wrap(this.begin+t));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function e7(t){return new i7(t)}t7.INITIAL_CAPACITY=32;class n7{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();for(;!n.done;)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);for(;!e.done&&n;)e=await this.next(),n=t(e.value)}handleErrors(t){return new h7(this,t)}filter(t){return new c7(this,t)}map(t){return new u7(this,t)}mapAsync(t){return new d7(this,t)}serialMapAsync(t){return new d7(this,t).serial()}flatmap(t){return new f7(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile((t=>!0===t))}rowMajorBatch(t,e=!0){return new l7(this,t,e)}columnMajorBatch(t,e=!0,n=K8){return this.rowMajorBatch(t,e).map((t=>X8(t,n)))}concatenate(t,e){return new m7(new r7([this,t]),e)}take(t){return t<0||null==t?this:new a7(this,t)}skip(t){return t<0||null==t?this:new o7(this,t)}prefetch(t){return new v7(this,t)}shuffle(t,e){return new x7(this,t,e)}serial(){return new s7(this)}}class r7 extends n7{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:(e=t,G8(e,J8)),done:!1};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */
var e}}class i7 extends n7{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class s7 extends n7{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class o7 extends n7{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;Ao(t.value)}return this.upstream.next()}}class a7 extends n7{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class l7 extends n7{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class c7 extends n7{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;Ao(t.value)}}}class u7 extends n7{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Di(t.value),n=this.transform(t.value),r=Di(n);for(const t of e)Li(t,r)||t.dispose();return{value:n,done:!1}}}class h7 extends n7{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class d7 extends n7{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Di(t.value),n=await this.transform(t.value),r=Di(n);for(const t of e)Li(t,r)||t.dispose();return{value:n,done:!1}}}class p7 extends n7{constructor(){super(),this.outputQueue=new t7,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class f7 extends p7{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=Di(t.value),n=this.transform(t.value),r=Di(n);this.outputQueue.pushAll(n);for(const t of e)Li(t,r)||t.dispose();return!0}}class m7 extends n7{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}var g7,y7,b7;!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(g7||(g7={}));class v7 extends n7{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new Q8(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class x7 extends v7{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=zu.alea(n||li().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */class w7{constructor(){this.size=null}batch(t,e=!0){const n=this;let r;return u(t>0,(()=>`batchSize needs to be positive, but it is\n      ${t}`)),r=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),_7((async()=>(await n.iterator()).columnMajorBatch(t,e,S7)),r)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,_7((async()=>(await e.iterator()).concatenate(await t.iterator())),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,_7((async()=>(await e.iterator()).filter((e=>Co((()=>t(e)))))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return _7((async()=>(await e.iterator()).map((e=>Co((()=>t(e)))))),this.size)}mapAsync(t){const e=this;return _7((async()=>(await e.iterator()).mapAsync(t)),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return _7((async()=>(await e.iterator()).prefetch(t)),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,_7((async()=>{const n=e7((async()=>({value:await e.iterator(),done:!1})));return r=n.take(t),new m7(r,i);var r,i}),n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,_7((async()=>(await e.iterator()).skip(t)),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=zu.alea(e||li().toString());return _7((async()=>{let e=i.int32();return n&&(e+=i.int32()),(await r.iterator()).shuffle(t,e.toString())}),this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,_7((async()=>(await e.iterator()).take(t)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function _7(t,e=null){return new class extends w7{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function S7(t){if(null===t)return null;const e=t[0];if(null==(n=e)||null===(r=n)||"object"!=typeof r&&"function"!=typeof r||Array.isArray(n)||"object"==typeof n&&n instanceof Si||C(n)){return{value:function(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Si?_h(t):os(t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */(t),recurse:!1}}var n,r;return{value:null,recurse:!0}}function k7(t,e=null,n=!1){const r=e?{$select:e}:{},i=bQ(t)?t.items().query(r):t,s=n?i.toArray():Promise.resolve(i);return function(t){return _7((async()=>{const e=await t();return e7((()=>e.next()))}))}((async function*(){const t=await s;for await(const e of t)yield e}))}function T7(t){const e={};for(const[n,r]of Object.entries(t)){e[n.startsWith("val_")?n.replace("val_","")+"Val":n]=r}return e}w7.MAX_BUFFER_SIZE=1e4;class E7 extends H8{constructor({epochs:t=20,batchSize:e=8,validationSplit:n=.2}={}){super(),this.title="TFJSCustomModel",this.loadFn=P5,this.validationSplit=Math.max(Math.min(n,1),0),this.parameters={epochs:new JH(t,!0),batchSize:new JH(e,!0)}}transformDataset(t){return t.map((t=>({xs:os(t.x),ys:os(t.y)})))}async train(t,e){this.$training.set({status:"start",epochs:this.parameters.epochs.get()});const n=bQ(t)?t.$count.value:(await t.toArray()).length,r=Math.min(200,n),i=this.transformDataset(k7(t,["x","y"],n<200)).shuffle(r);let s,o;if(e)s=i,o=this.transformDataset(k7(e,["x","y"],n<200)).shuffle(r);else{const t=Math.floor(n*(1-this.validationSplit));s=i.take(t),o=this.validationSplit>0&&i.skip(t)}const[{xs:a,ys:l}]=await s.take(1).toArray();this.buildModel(a.shape,l.shape),this.fit(s,o)}_predict(t){return this.model?Co((()=>this.model.predict(os(t).expandDims(0)).gather(0))):null}clear(){delete this.model}fit(t,e){this.model.fitDataset(t.batch(this.parameters.batchSize.get()),{...e?{validationData:e.batch(this.parameters.batchSize.get())}:{},epochs:this.parameters.epochs.get(),callbacks:{onEpochEnd:(t,e)=>{this.$training.set({status:"epoch",epoch:t+1,epochs:this.parameters.epochs.get(),data:T7(e)})}}}).then((t=>{this.$training.set({status:"success",data:T7(t.history)})})).catch((t=>{throw this.$training.set({status:"error",data:t}),new iG(t.message)}))}}FH([rG],E7.prototype,"train",null);class M7 extends E7{constructor(){super(...arguments),this.title="TFJSCustomClassifier"}async train(t,e){const n=bQ(t);if(this.labels=n?await t.distinct("y"):this.labels=Array.from(new Set(await t.map((({y:t})=>t)).toArray())),0===this.labels.length)return sG(new iG("This dataset is empty or is missing labels")),void this.$training.set({status:"error"});if(1===this.labels.length)return sG(new iG("At least two classes are needed to train the classifier")),void this.$training.set({status:"error"});const r=this.labels.length;this.transformDataset=t=>t.map((t=>({xs:os(t.x),ys:To(this.labels.indexOf(t.y),r)}))),super.train(t,e)}async predict(t){return this.model?Co((()=>{const e=this._predict(t),n=this.labels[e.argMax().arraySync()],r=e.arraySync().reduce(((t,e,n)=>({...t,[this.labels[n]]:e})),{});return{label:n,confidences:r}})):{label:void 0,confidences:{}}}}function C7(t){let e;return{c(){e=IN("div"),e.textContent="This dataStore does not require authentication"},m(t,n){CN(t,e,n)},p:nN,i:nN,o:nN,d(t){t&&AN(e)}}}function A7(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:$7,then:I7,catch:N7,value:3,blocks:[,,,]};return OI(n=t[1].connect(),i),{c(){e=PN(),i.block.c()},m(t,n){CN(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,2&r&&n!==(n=t[1].connect())&&OI(n,i)||PI(i,t,r)},i(t){r||(NI(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){II(i.blocks[t])}r=!1},d(t){t&&AN(e),i.block.d(t),i.token=null,i=null}}}function N7(t){return{c:nN,m:nN,p:nN,i:nN,o:nN,d:nN}}function I7(t){let e,n,r,i,s,o,a,l,c=t[3].email+"";return{c(){e=IN("p"),n=RN("Hello, "),r=RN(c),i=ON(),s=IN("div"),o=IN("button"),o.textContent="Log out",FN(e,"class","pb-2"),FN(o,"class","btn danger"),FN(s,"class","flex")},m(c,u){CN(c,e,u),TN(e,n),TN(e,r),CN(c,i,u),CN(c,s,u),TN(s,o),a||(l=LN(o,"click",t[2]),a=!0)},p(t,e){2&e&&c!==(c=t[3].email+"")&&BN(r,c)},i:nN,o:nN,d(t){t&&AN(e),t&&AN(i),t&&AN(s),a=!1,l()}}}function $7(t){let e,n;return e=new B$({}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p:nN,i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function R7(t){let e,n,r,i;const s=[A7,C7],o=[];function a(t,e){return t[1].requiresAuth?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=PN()},m(t,n){o[e].m(t,n),CN(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(CI(),II(o[l],1,1,(()=>{o[l]=null})),AI(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),NI(n,1),n.m(r.parentNode,r))},i(t){i||(NI(n),i=!0)},o(t){II(n),i=!1},d(t){o[e].d(t),t&&AN(r)}}}function O7(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[R7]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),18&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function P7(t,e,n){let{title:r}=e,{dataStore:i}=e;return t.$$set=t=>{"title"in t&&n(0,r=t.title),"dataStore"in t&&n(1,i=t.dataStore)},[r,i,function(){i.logout()}]}FH([rG],M7.prototype,"train",null);class L7 extends HI{constructor(t){super(),WI(this,t,P7,O7,lN,{title:0,dataStore:1})}}class D7 extends mG{constructor(t){super(),this.title="account manager",y7.set(this,void 0),BH(this,y7,t,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new L7({target:e,props:{title:this.title,dataStore:zH(this,y7,"f")}}))}}function F7(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[2]?.message+"",m=Math.floor(100*t[2]?.progress)+"";return d=new $$({props:{progress:t[2]?.progress,type:t[2]?.type}}),{c(){e=IN("div"),n=IN("div"),r=IN("div"),i=IN("span"),s=RN(f),o=ON(),a=IN("div"),l=IN("span"),c=RN(m),u=RN("%"),h=ON(),UI(d.$$.fragment),FN(i,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200 svelte-cymqgb"),GN(i,"gray","idle"===t[2]?.type),GN(i,"green","success"===t[2]?.type),GN(i,"red","danger"===t[2]?.type),FN(l,"class","text-xs font-semibold inline-block text-blue-600 svelte-cymqgb"),GN(l,"tgray","idle"===t[2]?.type),GN(l,"tgreen","success"===t[2]?.type),GN(l,"tred","danger"===t[2]?.type),FN(a,"class","text-right"),FN(n,"class","flex mb-2 items-center justify-between"),FN(e,"class","relative pt-6 w-full"),VN(e,"min-width","250px")},m(t,f){CN(t,e,f),TN(e,n),TN(n,r),TN(r,i),TN(i,s),TN(n,o),TN(n,a),TN(a,l),TN(l,c),TN(l,u),TN(e,h),VI(d,e,null),p=!0},p(t,e){(!p||4&e)&&f!==(f=t[2]?.message+"")&&BN(s,f),(!p||4&e)&&GN(i,"gray","idle"===t[2]?.type),(!p||4&e)&&GN(i,"green","success"===t[2]?.type),(!p||4&e)&&GN(i,"red","danger"===t[2]?.type),(!p||4&e)&&m!==(m=Math.floor(100*t[2]?.progress)+"")&&BN(c,m),(!p||4&e)&&GN(l,"tgray","idle"===t[2]?.type),(!p||4&e)&&GN(l,"tgreen","success"===t[2]?.type),(!p||4&e)&&GN(l,"tred","danger"===t[2]?.type);const n={};4&e&&(n.progress=t[2]?.progress),4&e&&(n.type=t[2]?.type),d.$set(n)},i(t){p||(NI(d.$$.fragment,t),p=!0)},o(t){II(d.$$.fragment,t),p=!1},d(t){t&&AN(e),jI(d)}}}function z7(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[F7]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),12&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function B7(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(2,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{progress:a}=e;return s(),t.$$set=t=>{"title"in t&&n(0,o=t.title),"progress"in t&&s(n(1,a=t.progress))},[o,a,r]}y7=new WeakMap;class U7 extends HI{constructor(t){super(),WI(this,t,B7,z7,lN,{title:0,progress:1})}}class V7 extends mG{constructor(t){super(),this.$progress=t,this.title="progress bar",this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new U7({target:e,props:{title:this.title,progress:this.$progress}}))}}function j7(...t){return new V7(...t)}class W7 extends mG{constructor(t,e=wJ()){super(),this.title="batch prediction",b7.set(this,void 0),this.$status=new JH({status:"loading"},!0),this.name=t,this.title=`batch prediction (${t})`,BH(this,b7,e||new xJ,"f"),this.start(),zH(this,b7,"f").connect().then((()=>{this.setup()})).catch((e=>{const n=new Error(null==e?void 0:e.message);n.name=`Batch Prediction Error (${t}): Datastore connection failed`,sG(n,{duration:0})}))}async setup(){const t=kJ(`predictions-${this.name}`);this.predictionService=zH(this,b7,"f").service(t);const{total:e}=await this.predictionService.find({query:{$limit:1,$select:["id"]}});this.$status.set({status:e>0?"loaded":"idle"})}async predict(t,e){try{const n=bQ(e)?e.$count.value:(await e.toArray()).length;this.$status.set({status:"start"});const r=bQ(e)?e.items():e;let i=0;for await(const{id:e,x:s,y:o}of r){const r=await t.predict(s),a=await this.predictionService.create({...r,instanceId:e,yTrue:o});this.$status.set({status:"running",count:++i,total:n,data:a})}this.$status.set({status:"success",count:i,total:n})}catch(t){this.$status.set({status:"error",data:{error:t}})}}async clear(){await this.predictionService.remove(null,{query:{}})}items(){return this.predictionService.items()}mount(){}}function H7(t){let e;return{c(){e=RN(t[10])},m(t,n){CN(t,e,n)},p(t,n){1024&n&&BN(e,t[10])},d(t){t&&AN(e)}}}function G7(t){let e,n,r,i;function s(e){t[11](e)}let o={disabled:t[7],type:t[8],$$slots:{default:[H7]},$$scope:{ctx:t}};return void 0!==t[9]&&(o.pressed=t[9]),n=new XI({props:o}),uI.push((()=>BI(n,"pressed",s))),n.$on("click",t[12]),{c(){e=IN("div"),UI(n.$$.fragment)},m(t,r){CN(t,e,r),VI(n,e,null),i=!0},p(t,e){const i={};128&e&&(i.disabled=t[7]),256&e&&(i.type=t[8]),9216&e&&(i.$$scope={dirty:e,ctx:t}),!r&&512&e&&(r=!0,i.pressed=t[9],bI((()=>r=!1))),n.$set(i)},i(t){i||(NI(n.$$.fragment,t),i=!0)},o(t){II(n.$$.fragment,t),i=!1},d(t){t&&AN(e),jI(n)}}}function q7(t){let e,n;return e=new OU({props:{title:t[0],loading:t[6],$$slots:{default:[G7]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),64&n&&(r.loading=t[6]),10112&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function X7(t,e,n){let r,i,s,o,a,l=nN,c=()=>(l(),l=hN(w,(t=>n(6,r=t))),w),u=nN,h=()=>(u(),u=hN(_,(t=>n(7,i=t))),_),d=nN,p=()=>(d(),d=hN(S,(t=>n(8,s=t))),S),f=nN,m=()=>(f(),f=hN(x,(t=>n(9,o=t))),x),g=nN,y=()=>(g(),g=hN(v,(t=>n(10,a=t))),v);t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u())),t.$$.on_destroy.push((()=>d())),t.$$.on_destroy.push((()=>f())),t.$$.on_destroy.push((()=>g()));let{title:b}=e,{text:v}=e;y();let{pressed:x}=e;m();let{loading:w}=e;c();let{disabled:_}=e;h();let{type:S}=e;return p(),t.$$set=t=>{"title"in t&&n(0,b=t.title),"text"in t&&y(n(1,v=t.text)),"pressed"in t&&m(n(2,x=t.pressed)),"loading"in t&&c(n(3,w=t.loading)),"disabled"in t&&h(n(4,_=t.disabled)),"type"in t&&p(n(5,S=t.type))},[b,v,x,w,_,S,r,i,s,o,a,function(t){o=t,x.set(o)},function(e){lI.call(this,t,e)}]}b7=new WeakMap;class Y7 extends HI{constructor(t){super(),WI(this,t,X7,q7,lN,{title:0,text:1,pressed:2,loading:3,disabled:4,type:5})}}class K7 extends mG{constructor(t="click me"){super(),this.title="button",this.$click=new JH(qV()),this.$pressed=new JH(!1,!0),this.$loading=new JH(!1,!0),this.$disabled=new JH(!1,!0),this.$type=new JH("default",!0),this.$text=new JH(t,!0),this.start(),this.$loading.skip(1).subscribe((t=>{this.$disabled.set(t)}))}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Y7({target:e,props:{title:this.title,text:this.$text,pressed:this.$pressed,loading:this.$loading,disabled:this.$disabled,type:this.$type}}),this.$$.app.$on("click",this.$click.set))}}var Z7,J7,Q7={exports:{}},t9=wr(L0),e9=wr(Ef);function n9(t){let e,n;return{c(){e=RN("COCO-SSD loaded with base "),n=RN(t[2])},m(t,r){CN(t,e,r),CN(t,n,r)},p(t,e){4&e&&BN(n,t[2])},d(t){t&&AN(e),t&&AN(n)}}}function r9(t){let e;return{c(){e=RN(" ")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function i9(t){let e;function n(t,e){return t[3]?r9:n9}let r=n(t),i=r(t);return{c(){e=IN("p"),i.c(),FN(e,"class","p-2 text-sm text-gray-600")},m(t,n){CN(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&AN(e),i.d()}}}function s9(t){let e,n;return e=new OU({props:{title:t[0],loading:t[3],$$slots:{default:[i9]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading=t[3]),28&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function o9(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{base:l}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"base"in t&&n(2,l=t.base)},[o,a,l,r]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
!function(t,e){!function(t,e,n){const r={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class i{constructor(t,e){this.modelPath=e||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(t)}/model.json`}getPrefix(t){return"lite_mobilenet_v2"===t?`ssd${t}`:`ssd_${t}`}async load(){this.model=await e.loadGraphModel(this.modelPath);const t=n.zeros([1,300,300,3],"int32"),r=await this.model.executeAsync(t);await Promise.all(r.map((t=>t.data()))),r.map((t=>t.dispose())),t.dispose()}async infer(t,e,r){const i=n.tidy((()=>(t instanceof n.Tensor||(t=n.browser.fromPixels(t)),n.expandDims(t)))),s=i.shape[1],o=i.shape[2],a=await this.model.executeAsync(i),l=a[0].dataSync(),c=a[1].dataSync();i.dispose(),n.dispose(a);const[u,h]=this.calculateMaxScores(l,a[0].shape[1],a[0].shape[2]),d=n.getBackend();"webgl"===n.getBackend()&&n.setBackend("cpu");const p=n.tidy((()=>{const t=n.tensor2d(c,[a[1].shape[1],a[1].shape[3]]);return n.image.nonMaxSuppression(t,u,e,r,r)})),f=p.dataSync();return p.dispose(),d!==n.getBackend()&&n.setBackend(d),this.buildDetectedObjects(o,s,c,u,f,h)}buildDetectedObjects(t,e,n,i,s,o){const a=s.length,l=[];for(let c=0;c<a;c++){const a=[];for(let t=0;t<4;t++)a[t]=n[4*s[c]+t];const u=a[0]*e,h=a[1]*t,d=a[2]*e,p=a[3]*t;a[0]=h,a[1]=u,a[2]=p-h,a[3]=d-u,l.push({bbox:a,class:r[o[s[c]]+1].displayName,score:i[s[c]]})}return l}calculateMaxScores(t,e,n){const r=[],i=[];for(let s=0;s<e;s++){let e=Number.MIN_VALUE,o=-1;for(let r=0;r<n;r++)t[s*n+r]>e&&(e=t[s*n+r],o=r);r[s]=e,i[s]=o}return[r,i]}async detect(t,e=20,n=.5){return this.infer(t,e,n)}dispose(){null!=this.model&&this.model.dispose()}}t.ObjectDetection=i,t.load=async function(t={}){if(null==n)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const e=t.base||"lite_mobilenet_v2",r=t.modelUrl;if(-1===["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(e))throw new Error(`ObjectDetection constructed with invalid base model ${e}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const s=new i(e,r);return await s.load(),s},t.version="2.2.2",Object.defineProperty(t,"__esModule",{value:!0})}(e,t9,e9)}(0,Q7.exports);class a9 extends HI{constructor(t){super(),WI(this,t,o9,s9,lN,{title:0,loading:1,base:2})}}class l9 extends vQ{constructor({base:t="lite_mobilenet_v2"}={}){super(),this.title="COCO-SSD Object Detection",this.parameters={},this.serviceName="undefined",Z7.set(this,void 0),J7.set(this,void 0),this.$loading=new JH(!0,!0),BH(this,J7,t,"f"),this.setup()}async setup(){const t=await Ys(),e=Object.keys(t).filter((t=>t.includes("cocossd")));try{BH(this,Z7,await Q7.exports.load({base:zH(this,J7,"f"),modelUrl:`indexeddb://cocossd-${zH(this,J7,"f")}`}),"f")}catch(t){e.length>0&&await Ks(e[0]),BH(this,Z7,await Q7.exports.load({base:zH(this,J7,"f")}),"f"),await zH(this,Z7,"f").model.save(`indexeddb://cocossd-${zH(this,J7,"f")}`)}eG.info("COCO-SSD loaded with base `lite_mobilenet_v2`"),this.$loading.set(!1),this.start()}train(){throw new iG("Model `CocoSsd` cannot be trained")}async predict(t){if(!zH(this,Z7,"f"))throw new Error("Model is not loaded");return{outputs:(await zH(this,Z7,"f").detect(t)).map((t=>({bbox:t.bbox,class:t.class,confidence:t.score})))}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new a9({target:e,props:{title:this.title,loading:this.$loading,base:zH(this,J7,"f")}}))}save(){throw new Error("CocoSsd does not support saving")}load(){throw new Error("CocoSsd does not support loading")}download(){throw new Error("CocoSsd does not support downloading")}upload(){throw new Error("CocoSsd does not support uploading")}}Z7=new WeakMap,J7=new WeakMap,FH([rG],l9.prototype,"train",null),FH([rG],l9.prototype,"predict",null),FH([rG],l9.prototype,"save",null),FH([rG],l9.prototype,"load",null),FH([rG],l9.prototype,"download",null),FH([rG],l9.prototype,"upload",null);
/*!
     * Chart.js v3.8.2
     * https://www.chartjs.org
     * (c) 2022 Chart.js Contributors
     * Released under the MIT License
     */
const c9="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function u9(t,e,n){const r=n||(t=>Array.prototype.slice.call(t));let i=!1,s=[];return function(...n){s=r(n),i||(i=!0,c9.call(window,(()=>{i=!1,t.apply(e,s)})))}}const h9=t=>"start"===t?"left":"end"===t?"right":"center",d9=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function p9(){}const f9=function(){let t=0;return function(){return t++}}();function m9(t){return null==t}function g9(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function y9(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const b9=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function v9(t,e){return b9(t)?t:e}function x9(t,e){return void 0===t?e:t}const w9=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function _9(t,e,n){if(t&&"function"==typeof t.call)return t.apply(n,e)}function S9(t,e,n,r){let i,s,o;if(g9(t))if(s=t.length,r)for(i=s-1;i>=0;i--)e.call(n,t[i],i);else for(i=0;i<s;i++)e.call(n,t[i],i);else if(y9(t))for(o=Object.keys(t),s=o.length,i=0;i<s;i++)e.call(n,t[o[i]],o[i])}function k9(t,e){let n,r,i,s;if(!t||!e||t.length!==e.length)return!1;for(n=0,r=t.length;n<r;++n)if(i=t[n],s=e[n],i.datasetIndex!==s.datasetIndex||i.index!==s.index)return!1;return!0}function T9(t){if(g9(t))return t.map(T9);if(y9(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=T9(t[n[i]]);return e}return t}function E9(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function M9(t,e,n,r){if(!E9(t))return;const i=e[t],s=n[t];y9(i)&&y9(s)?C9(i,s,r):e[t]=T9(s)}function C9(t,e,n){const r=g9(e)?e:[e],i=r.length;if(!y9(t))return t;const s=(n=n||{}).merger||M9;for(let o=0;o<i;++o){if(e=r[o],!y9(e))continue;const i=Object.keys(e);for(let r=0,o=i.length;r<o;++r)s(i[r],t,e,n)}return t}function A9(t,e){return C9(t,e,{merger:N9})}function N9(t,e,n){if(!E9(t))return;const r=e[t],i=n[t];y9(r)&&y9(i)?A9(r,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=T9(i))}function I9(t,e){const n=t.indexOf(".",e);return-1===n?t.length:n}function $9(t,e){if(""===e)return t;let n=0,r=I9(e,n);for(;t&&r>n;)t=t[e.slice(n,r)],n=r+1,r=I9(e,n);return t}function R9(t){return t.charAt(0).toUpperCase()+t.slice(1)}const O9=t=>void 0!==t,P9=t=>"function"==typeof t,L9=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};const D9=Math.PI,F9=2*D9,z9=F9+D9,B9=Number.POSITIVE_INFINITY,U9=D9/180,V9=D9/2,j9=D9/4,W9=2*D9/3,H9=Math.log10,G9=Math.sign;function q9(t){const e=Math.round(t);t=Y9(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(H9(t))),r=t/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function X9(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Y9(t,e,n){return Math.abs(t-e)<n}function K9(t,e,n){let r,i,s;for(r=0,i=t.length;r<i;r++)s=t[r][n],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function Z9(t){return t*(D9/180)}function J9(t){return t*(180/D9)}function Q9(t){if(!b9(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function ttt(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s<-.5*D9&&(s+=F9),{angle:s,distance:i}}function ett(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ntt(t,e){return(t-e+z9)%F9-D9}function rtt(t){return(t%F9+F9)%F9}function itt(t,e,n,r){const i=rtt(t),s=rtt(e),o=rtt(n),a=rtt(s-i),l=rtt(o-i),c=rtt(i-s),u=rtt(i-o);return i===s||i===o||r&&s===o||a>l&&c<u}function stt(t,e,n){return Math.max(e,Math.min(n,t))}function ott(t,e,n,r=1e-6){return t>=Math.min(e,n)-r&&t<=Math.max(e,n)+r}const att=t=>0===t||1===t,ltt=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*F9/n),ctt=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*F9/n)+1,utt={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*V9),easeOutSine:t=>Math.sin(t*V9),easeInOutSine:t=>-.5*(Math.cos(D9*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>att(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>att(t)?t:ltt(t,.075,.3),easeOutElastic:t=>att(t)?t:ctt(t,.075,.3),easeInOutElastic(t){const e=.1125;return att(t)?t:t<.5?.5*ltt(2*t,e,.45):.5+.5*ctt(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-utt.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*utt.easeInBounce(2*t):.5*utt.easeOutBounce(2*t-1)+.5};
/*!
     * @kurkle/color v0.2.1
     * https://github.com/kurkle/color#readme
     * (c) 2022 Jukka Kurkela
     * Released under the MIT License
     */
function htt(t){return t+.5|0}const dtt=(t,e,n)=>Math.max(Math.min(t,n),e);function ptt(t){return dtt(htt(2.55*t),0,255)}function ftt(t){return dtt(htt(255*t),0,255)}function mtt(t){return dtt(htt(t/2.55)/100,0,1)}function gtt(t){return dtt(htt(100*t),0,100)}const ytt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},btt=[..."0123456789ABCDEF"],vtt=t=>btt[15&t],xtt=t=>btt[(240&t)>>4]+btt[15&t],wtt=t=>(240&t)>>4==(15&t);function _tt(t){var e=(t=>wtt(t.r)&&wtt(t.g)&&wtt(t.b)&&wtt(t.a))(t)?vtt:xtt;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const Stt=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function ktt(t,e,n){const r=e*Math.min(n,1-n),i=(e,i=(e+t/30)%12)=>n-r*Math.max(Math.min(i-3,9-i,1),-1);return[i(0),i(8),i(4)]}function Ttt(t,e,n){const r=(r,i=(r+t/60)%6)=>n-n*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function Ett(t,e,n){const r=ktt(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function Mtt(t){const e=t.r/255,n=t.g/255,r=t.b/255,i=Math.max(e,n,r),s=Math.min(e,n,r),o=(i+s)/2;let a,l,c;return i!==s&&(c=i-s,l=o>.5?c/(2-i-s):c/(i+s),a=function(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}(e,n,r,c,i),a=60*a+.5),[0|a,l||0,o]}function Ctt(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(ftt)}function Att(t,e,n){return Ctt(ktt,t,e,n)}function Ntt(t){return(t%360+360)%360}function Itt(t){const e=Stt.exec(t);let n,r=255;if(!e)return;e[5]!==n&&(r=e[6]?ptt(+e[5]):ftt(+e[5]));const i=Ntt(+e[2]),s=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return Ctt(Ett,t,e,n)}(i,s,o):"hsv"===e[1]?function(t,e,n){return Ctt(Ttt,t,e,n)}(i,s,o):Att(i,s,o),{r:n[0],g:n[1],b:n[2],a:r}}const $tt={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Rtt={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Ott;function Ptt(t){Ott||(Ott=function(){const t={},e=Object.keys(Rtt),n=Object.keys($tt);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,$tt[s]);s=parseInt(Rtt[o],16),t[a]=[s>>16&255,s>>8&255,255&s]}return t}(),Ott.transparent=[0,0,0,0]);const e=Ott[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const Ltt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Dtt=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Ftt=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function ztt(t,e,n){if(t){let r=Mtt(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,0===e?360:1)),r=Att(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function Btt(t,e){return t?Object.assign(e||{},t):t}function Utt(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=ftt(t[3]))):(e=Btt(t,{r:0,g:0,b:0,a:1})).a=ftt(e.a),e}function Vtt(t){return"r"===t.charAt(0)?function(t){const e=Ltt.exec(t);let n,r,i,s=255;if(e){if(e[7]!==n){const t=+e[7];s=e[8]?ptt(t):dtt(255*t,0,255)}return n=+e[1],r=+e[3],i=+e[5],n=255&(e[2]?ptt(n):dtt(n,0,255)),r=255&(e[4]?ptt(r):dtt(r,0,255)),i=255&(e[6]?ptt(i):dtt(i,0,255)),{r:n,g:r,b:i,a:s}}}(t):Itt(t)}class jtt{constructor(t){if(t instanceof jtt)return t;const e=typeof t;let n;var r,i,s;"object"===e?n=Utt(t):"string"===e&&(s=(r=t).length,"#"===r[0]&&(4===s||5===s?i={r:255&17*ytt[r[1]],g:255&17*ytt[r[2]],b:255&17*ytt[r[3]],a:5===s?17*ytt[r[4]]:255}:7!==s&&9!==s||(i={r:ytt[r[1]]<<4|ytt[r[2]],g:ytt[r[3]]<<4|ytt[r[4]],b:ytt[r[5]]<<4|ytt[r[6]],a:9===s?ytt[r[7]]<<4|ytt[r[8]]:255})),n=i||Ptt(t)||Vtt(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=Btt(this._rgb);return t&&(t.a=mtt(t.a)),t}set rgb(t){this._rgb=Utt(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${mtt(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?_tt(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=Mtt(t),n=e[0],r=gtt(e[1]),i=gtt(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${mtt(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,r=t.rgb;let i;const s=e===i?.5:e,o=2*s-1,a=n.a-r.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;i=1-l,n.r=255&l*n.r+i*r.r+.5,n.g=255&l*n.g+i*r.g+.5,n.b=255&l*n.b+i*r.b+.5,n.a=s*n.a+(1-s)*r.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const r=Ftt(mtt(t.r)),i=Ftt(mtt(t.g)),s=Ftt(mtt(t.b));return{r:ftt(Dtt(r+n*(Ftt(mtt(e.r))-r))),g:ftt(Dtt(i+n*(Ftt(mtt(e.g))-i))),b:ftt(Dtt(s+n*(Ftt(mtt(e.b))-s))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new jtt(this.rgb)}alpha(t){return this._rgb.a=ftt(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=htt(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return ztt(this._rgb,2,t),this}darken(t){return ztt(this._rgb,2,-t),this}saturate(t){return ztt(this._rgb,1,t),this}desaturate(t){return ztt(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=Mtt(t);n[0]=Ntt(n[0]+e),n=Att(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function Wtt(t){return new jtt(t)}function Htt(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function Gtt(t){return Htt(t)?t:Wtt(t)}function qtt(t){return Htt(t)?t:Wtt(t).saturate(.5).darken(.1).hexString()}const Xtt=Object.create(null),Ytt=Object.create(null);function Ktt(t,e){if(!e)return t;const n=e.split(".");for(let e=0,r=n.length;e<r;++e){const r=n[e];t=t[r]||(t[r]=Object.create(null))}return t}function Ztt(t,e,n){return"string"==typeof e?C9(Ktt(t,e),n):C9(Ktt(t,""),e)}var Jtt=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>qtt(e.backgroundColor),this.hoverBorderColor=(t,e)=>qtt(e.borderColor),this.hoverColor=(t,e)=>qtt(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return Ztt(this,t,e)}get(t){return Ktt(this,t)}describe(t,e){return Ztt(Ytt,t,e)}override(t,e){return Ztt(Xtt,t,e)}route(t,e,n,r){const i=Ktt(this,t),s=Ktt(this,n),o="_"+e;Object.defineProperties(i,{[o]:{value:i[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=s[r];return y9(t)?Object.assign({},e,t):x9(t,e)},set(t){this[o]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function Qtt(t,e,n,r,i){let s=e[i];return s||(s=e[i]=t.measureText(i).width,n.push(i)),s>r&&(r=s),r}function tet(t,e,n,r){let i=(r=r||{}).data=r.data||{},s=r.garbageCollect=r.garbageCollect||[];r.font!==e&&(i=r.data={},s=r.garbageCollect=[],r.font=e),t.save(),t.font=e;let o=0;const a=n.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=n[l],null!=h&&!0!==g9(h))o=Qtt(t,i,s,o,h);else if(g9(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||g9(d)||(o=Qtt(t,i,s,o,d));t.restore();const p=s.length/2;if(p>n.length){for(l=0;l<p;l++)delete i[s[l]];s.splice(0,p)}return o}function eet(t,e,n){const r=t.currentDevicePixelRatio,i=0!==n?Math.max(n/2,.5):0;return Math.round((e-i)*r)/r+i}function net(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function ret(t,e,n,r){iet(t,e,n,r,null)}function iet(t,e,n,r,i){let s,o,a,l,c,u;const h=e.pointStyle,d=e.rotation,p=e.radius;let f=(d||0)*U9;if(h&&"object"==typeof h&&(s=h.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return t.save(),t.translate(n,r),t.rotate(f),t.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),void t.restore();if(!(isNaN(p)||p<=0)){switch(t.beginPath(),h){default:i?t.ellipse(n,r,i/2,p,0,0,F9):t.arc(n,r,p,0,F9),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(f)*p,r-Math.cos(f)*p),f+=W9,t.lineTo(n+Math.sin(f)*p,r-Math.cos(f)*p),f+=W9,t.lineTo(n+Math.sin(f)*p,r-Math.cos(f)*p),t.closePath();break;case"rectRounded":c=.516*p,l=p-c,o=Math.cos(f+j9)*l,a=Math.sin(f+j9)*l,t.arc(n-o,r-a,c,f-D9,f-V9),t.arc(n+a,r-o,c,f-V9,f),t.arc(n+o,r+a,c,f,f+V9),t.arc(n-a,r+o,c,f+V9,f+D9),t.closePath();break;case"rect":if(!d){l=Math.SQRT1_2*p,u=i?i/2:l,t.rect(n-u,r-l,2*u,2*l);break}f+=j9;case"rectRot":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+a,r-o),t.lineTo(n+o,r+a),t.lineTo(n-a,r+o),t.closePath();break;case"crossRot":f+=j9;case"cross":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o);break;case"star":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o),f+=j9,o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a),t.moveTo(n+a,r-o),t.lineTo(n-a,r+o);break;case"line":o=i?i/2:Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,r-a),t.lineTo(n+o,r+a);break;case"dash":t.moveTo(n,r),t.lineTo(n+Math.cos(f)*p,r+Math.sin(f)*p)}t.fill(),e.borderWidth>0&&t.stroke()}}function set(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function oet(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function aet(t){t.restore()}function cet(t,e,n,r,i){if(!e)return t.lineTo(n.x,n.y);if("middle"===i){const r=(e.x+n.x)/2;t.lineTo(r,e.y),t.lineTo(r,n.y)}else"after"===i!=!!r?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function uet(t,e,n,r){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function het(t,e,n,r,i,s={}){const o=g9(e)?e:[e],a=s.strokeWidth>0&&""!==s.strokeColor;let l,c;for(t.save(),t.font=i.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]);m9(e.rotation)||t.rotate(e.rotation);e.color&&(t.fillStyle=e.color);e.textAlign&&(t.textAlign=e.textAlign);e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,s),l=0;l<o.length;++l)c=o[l],a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),m9(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(c,n,r,s.maxWidth)),t.fillText(c,n,r,s.maxWidth),det(t,n,r,c,s),r+=i.lineHeight;t.restore()}function det(t,e,n,r,i){if(i.strikethrough||i.underline){const s=t.measureText(r),o=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,l=n-s.actualBoundingBoxAscent,c=n+s.actualBoundingBoxDescent,u=i.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(o,u),t.lineTo(a,u),t.stroke()}}function pet(t,e){const{x:n,y:r,w:i,h:s,radius:o}=e;t.arc(n+o.topLeft,r+o.topLeft,o.topLeft,-V9,D9,!0),t.lineTo(n,r+s-o.bottomLeft),t.arc(n+o.bottomLeft,r+s-o.bottomLeft,o.bottomLeft,D9,V9,!0),t.lineTo(n+i-o.bottomRight,r+s),t.arc(n+i-o.bottomRight,r+s-o.bottomRight,o.bottomRight,V9,0,!0),t.lineTo(n+i,r+o.topRight),t.arc(n+i-o.topRight,r+o.topRight,o.topRight,0,-V9,!0),t.lineTo(n+o.topLeft,r)}const fet=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),met=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function get(t,e){const n=(""+t).match(fet);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}function yet(t,e){const n={},r=y9(e),i=r?Object.keys(e):e,s=y9(t)?r?n=>x9(t[n],t[e[n]]):e=>t[e]:()=>t;for(const t of i)n[t]=+s(t)||0;return n}function bet(t){return yet(t,{top:"y",right:"x",bottom:"y",left:"x"})}function vet(t){return yet(t,["topLeft","topRight","bottomLeft","bottomRight"])}function xet(t){const e=bet(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function wet(t,e){t=t||{},e=e||Jtt.font;let n=x9(t.size,e.size);"string"==typeof n&&(n=parseInt(n,10));let r=x9(t.style,e.style);r&&!(""+r).match(met)&&(console.warn('Invalid font style specified: "'+r+'"'),r="");const i={family:x9(t.family,e.family),lineHeight:get(x9(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:x9(t.weight,e.weight),string:""};return i.string=function(t){return!t||m9(t.size)||m9(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(i),i}function _et(t,e,n,r){let i,s,o,a=!0;for(i=0,s=t.length;i<s;++i)if(o=t[i],void 0!==o&&(void 0!==e&&"function"==typeof o&&(o=o(e),a=!1),void 0!==n&&g9(o)&&(o=o[n%o.length],a=!1),void 0!==o))return r&&!a&&(r.cacheable=!1),o}function ket(t,e){return Object.assign(Object.create(t),e)}function Tet(t,e,n){n=n||(n=>t[n]<e);let r,i=t.length-1,s=0;for(;i-s>1;)r=s+i>>1,n(r)?s=r:i=r;return{lo:s,hi:i}}const Eet=(t,e,n)=>Tet(t,n,(r=>t[r][e]<n)),Met=(t,e,n)=>Tet(t,n,(r=>t[r][e]>=n));const Cet=["push","pop","shift","splice","unshift"];function Aet(t,e){const n=t._chartjs;if(!n)return;const r=n.listeners,i=r.indexOf(e);-1!==i&&r.splice(i,1),r.length>0||(Cet.forEach((e=>{delete t[e]})),delete t._chartjs)}function Net(t){const e=new Set;let n,r;for(n=0,r=t.length;n<r;++n)e.add(t[n]);return e.size===r?t:Array.from(e)}function Iet(t,e=[""],n=t,r,i=(()=>t[0])){O9(r)||(r=Vet("_fallback",t));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:r,_getTarget:i,override:i=>Iet([i,...t],e,n,r)};return new Proxy(s,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,r)=>Let(n,r,(()=>function(t,e,n,r){let i;for(const s of e)if(i=Vet(Oet(s,t),n),O9(i))return Pet(t,i)?Bet(n,r,t,i):i}(r,e,t,n))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>jet(t).includes(e),ownKeys:t=>jet(t),set(t,e,n){const r=t._storage||(t._storage=i());return t[e]=r[e]=n,delete t._keys,!0}})}function $et(t,e,n,r){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:Ret(t,r),setContext:e=>$et(t,e,n,r),override:i=>$et(t.override(i),e,n,r)};return new Proxy(i,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>Let(t,e,(()=>function(t,e,n){const{_proxy:r,_context:i,_subProxy:s,_descriptors:o}=t;let a=r[e];P9(a)&&o.isScriptable(e)&&(a=function(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);a.add(t),e=e(s,o||r),a.delete(t),Pet(t,e)&&(e=Bet(i._scopes,i,t,e));return e}(e,a,t,n));g9(a)&&a.length&&(a=function(t,e,n,r){const{_proxy:i,_context:s,_subProxy:o,_descriptors:a}=n;if(O9(s.index)&&r(t))e=e[s.index%e.length];else if(y9(e[0])){const n=e,r=i._scopes.filter((t=>t!==n));e=[];for(const l of n){const n=Bet(r,i,t,l);e.push($et(n,s,o&&o[t],a))}}return e}(e,a,t,o.isIndexable));Pet(e,a)&&(a=$et(a,i,s&&s[e],o));return a}(t,e,n))),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,r)=>(t[n]=r,delete e[n],!0)})}function Ret(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:r,isScriptable:P9(n)?n:()=>n,isIndexable:P9(r)?r:()=>r}}const Oet=(t,e)=>t?t+R9(e):e,Pet=(t,e)=>y9(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function Let(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const r=n();return t[e]=r,r}function Det(t,e,n){return P9(t)?t(e,n):t}const Fet=(t,e)=>!0===t?e:"string"==typeof t?$9(e,t):void 0;function zet(t,e,n,r,i){for(const s of e){const e=Fet(n,s);if(e){t.add(e);const s=Det(e._fallback,n,i);if(O9(s)&&s!==n&&s!==r)return s}else if(!1===e&&O9(r)&&n!==r)return null}return!1}function Bet(t,e,n,r){const i=e._rootScopes,s=Det(e._fallback,n,r),o=[...t,...i],a=new Set;a.add(r);let l=Uet(a,o,n,s||n,r);return null!==l&&((!O9(s)||s===n||(l=Uet(a,o,s,l,r),null!==l))&&Iet(Array.from(a),[""],i,s,(()=>function(t,e,n){const r=t._getTarget();e in r||(r[e]={});const i=r[e];if(g9(i)&&y9(n))return n;return i}(e,n,r))))}function Uet(t,e,n,r,i){for(;n;)n=zet(t,e,n,r,i);return n}function Vet(t,e){for(const n of e){if(!n)continue;const e=n[t];if(O9(e))return e}}function jet(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function Wet(t,e,n,r){const{iScale:i}=t,{key:s="r"}=this._parsing,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+n,u=e[c],o[a]={r:i.parse($9(u,s),c)};return o}const Het=Number.EPSILON||1e-14,Get=(t,e)=>e<t.length&&!t[e].skip&&t[e],qet=t=>"x"===t?"y":"x";function Xet(t,e,n,r){const i=t.skip?e:t,s=e,o=n.skip?e:n,a=ett(s,i),l=ett(o,s);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=r*c,d=r*u;return{previous:{x:s.x-h*(o.x-i.x),y:s.y-h*(o.y-i.y)},next:{x:s.x+d*(o.x-i.x),y:s.y+d*(o.y-i.y)}}}function Yet(t,e="x"){const n=qet(e),r=t.length,i=Array(r).fill(0),s=Array(r);let o,a,l,c=Get(t,0);for(o=0;o<r;++o)if(a=l,l=c,c=Get(t,o+1),l){if(c){const t=c[e]-l[e];i[o]=0!==t?(c[n]-l[n])/t:0}s[o]=a?c?G9(i[o-1])!==G9(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}!function(t,e,n){const r=t.length;let i,s,o,a,l,c=Get(t,0);for(let u=0;u<r-1;++u)l=c,c=Get(t,u+1),l&&c&&(Y9(e[u],0,Het)?n[u]=n[u+1]=0:(i=n[u]/e[u],s=n[u+1]/e[u],a=Math.pow(i,2)+Math.pow(s,2),a<=9||(o=3/Math.sqrt(a),n[u]=i*o*e[u],n[u+1]=s*o*e[u])))}(t,i,s),function(t,e,n="x"){const r=qet(n),i=t.length;let s,o,a,l=Get(t,0);for(let c=0;c<i;++c){if(o=a,a=l,l=Get(t,c+1),!a)continue;const i=a[n],u=a[r];o&&(s=(i-o[n])/3,a[`cp1${n}`]=i-s,a[`cp1${r}`]=u-s*e[c]),l&&(s=(l[n]-i)/3,a[`cp2${n}`]=i+s,a[`cp2${r}`]=u+s*e[c])}}(t,s,e)}function Ket(t,e,n){return Math.max(Math.min(t,n),e)}function Zet(t,e,n,r,i){let s,o,a,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)Yet(t,i);else{let n=r?t[t.length-1]:t[0];for(s=0,o=t.length;s<o;++s)a=t[s],l=Xet(n,a,t[Math.min(s+1,o-(r?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,n=a}e.capBezierPoints&&function(t,e){let n,r,i,s,o,a=set(t[0],e);for(n=0,r=t.length;n<r;++n)o=s,s=a,a=n<r-1&&set(t[n+1],e),s&&(i=t[n],o&&(i.cp1x=Ket(i.cp1x,e.left,e.right),i.cp1y=Ket(i.cp1y,e.top,e.bottom)),a&&(i.cp2x=Ket(i.cp2x,e.left,e.right),i.cp2y=Ket(i.cp2y,e.top,e.bottom)))}(t,n)}function Jet(){return"undefined"!=typeof window&&"undefined"!=typeof document}function Qet(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function tnt(t,e,n){let r;return"string"==typeof t?(r=parseInt(t,10),-1!==t.indexOf("%")&&(r=r/100*e.parentNode[n])):r=t,r}const ent=t=>window.getComputedStyle(t,null);const nnt=["top","right","bottom","left"];function rnt(t,e,n){const r={};n=n?"-"+n:"";for(let i=0;i<4;i++){const s=nnt[i];r[s]=parseFloat(t[e+"-"+s+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function int(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:r}=e,i=ent(n),s="border-box"===i.boxSizing,o=rnt(i,"padding"),a=rnt(i,"border","width"),{x:l,y:c,box:u}=function(t,e){const n=t.touches,r=n&&n.length?n[0]:t,{offsetX:i,offsetY:s}=r;let o,a,l=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(i,s,t.target))o=i,a=s;else{const t=e.getBoundingClientRect();o=r.clientX-t.left,a=r.clientY-t.top,l=!0}return{x:o,y:a,box:l}}(t,n),h=o.left+(u&&a.left),d=o.top+(u&&a.top);let{width:p,height:f}=e;return s&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-h)/p*n.width/r),y:Math.round((c-d)/f*n.height/r)}}const snt=t=>Math.round(10*t)/10;function ont(t,e,n,r){const i=ent(t),s=rnt(i,"margin"),o=tnt(i.maxWidth,t,"clientWidth")||B9,a=tnt(i.maxHeight,t,"clientHeight")||B9,l=function(t,e,n){let r,i;if(void 0===e||void 0===n){const s=Qet(t);if(s){const t=s.getBoundingClientRect(),o=ent(s),a=rnt(o,"border","width"),l=rnt(o,"padding");e=t.width-l.width-a.width,n=t.height-l.height-a.height,r=tnt(o.maxWidth,s,"clientWidth"),i=tnt(o.maxHeight,s,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:r||B9,maxHeight:i||B9}}(t,e,n);let{width:c,height:u}=l;if("content-box"===i.boxSizing){const t=rnt(i,"border","width"),e=rnt(i,"padding");c-=e.width+t.width,u-=e.height+t.height}return c=Math.max(0,c-s.width),u=Math.max(0,r?Math.floor(c/r):u-s.height),c=snt(Math.min(c,o,l.maxWidth)),u=snt(Math.min(u,a,l.maxHeight)),c&&!u&&(u=snt(c/2)),{width:c,height:u}}function ant(t,e,n){const r=e||1,i=Math.floor(t.height*r),s=Math.floor(t.width*r);t.height=i/r,t.width=s/r;const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==r||o.height!==i||o.width!==s)&&(t.currentDevicePixelRatio=r,o.height=i,o.width=s,t.ctx.setTransform(r,0,0,r,0,0),!0)}const lnt=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function cnt(t,e){const n=function(t,e){return ent(t).getPropertyValue(e)}(t,e),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function unt(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function hnt(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:"middle"===r?n<.5?t.y:e.y:"after"===r?n<1?t.y:e.y:n>0?e.y:t.y}}function dnt(t,e,n,r){const i={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},o=unt(t,i,n),a=unt(i,s,n),l=unt(s,e,n),c=unt(o,a,n),u=unt(a,l,n);return unt(c,u,n)}const pnt=new Map;function fnt(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let r=pnt.get(n);return r||(r=new Intl.NumberFormat(t,e),pnt.set(n,r)),r}(e,n).format(t)}function mnt(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function gnt(t,e){let n,r;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=r)}function ynt(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function bnt(t){return"angle"===t?{between:itt,compare:ntt,normalize:rtt}:{between:ott,compare:(t,e)=>t-e,normalize:t=>t}}function vnt({start:t,end:e,count:n,loop:r,style:i}){return{start:t%n,end:e%n,loop:r&&(e-t+1)%n==0,style:i}}function xnt(t,e,n){if(!n)return[t];const{property:r,start:i,end:s}=n,o=e.length,{compare:a,between:l,normalize:c}=bnt(r),{start:u,end:h,loop:d,style:p}=function(t,e,n){const{property:r,start:i,end:s}=n,{between:o,normalize:a}=bnt(r),l=e.length;let c,u,{start:h,end:d,loop:p}=t;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(a(e[h%l][r]),i,s);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:t.style}}(t,e,n),f=[];let m,g,y,b=!1,v=null;const x=()=>b||l(i,y,m)&&0!==a(i,y),w=()=>!b||0===a(s,m)||l(s,y,m);for(let t=u,n=u;t<=h;++t)g=e[t%o],g.skip||(m=c(g[r]),m!==y&&(b=l(m,i,s),null===v&&x()&&(v=0===a(m,i)?t:n),null!==v&&w()&&(f.push(vnt({start:v,end:t,loop:d,count:o,style:p})),v=null),n=t,y=m));return null!==v&&f.push(vnt({start:v,end:h,loop:d,count:o,style:p})),f}function wnt(t,e){const n=[],r=t.segments;for(let i=0;i<r.length;i++){const s=xnt(r[i],t.points,e);s.length&&n.push(...s)}return n}function _nt(t,e,n,r){return r&&r.setContext&&n?function(t,e,n,r){const i=t._chart.getContext(),s=Snt(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=n.length,c=[];let u=s,h=e[0].start,d=h;function p(t,e,r,i){const s=a?-1:1;if(t!==e){for(t+=l;n[t%l].skip;)t-=s;for(;n[e%l].skip;)e+=s;t%l!=e%l&&(c.push({start:t%l,end:e%l,loop:r,style:i}),u=i,h=e%l)}}for(const t of e){h=a?h:t.start;let e,s=n[h%l];for(d=h+1;d<=t.end;d++){const a=n[d%l];e=Snt(r.setContext(ket(i,{type:"segment",p0:s,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),knt(e,u)&&p(h,d-1,t.loop,u),s=a,u=e}h<d-1&&p(h,d-1,t.loop,u)}return c}(t,e,n,r):e}function Snt(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function knt(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}
/*!
     * Chart.js v3.8.2
     * https://www.chartjs.org
     * (c) 2022 Chart.js Contributors
     * Released under the MIT License
     */var Tnt=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,r){const i=e.listeners[r],s=e.duration;i.forEach((r=>r({chart:t,initial:e.initial,numSteps:s,currentStep:Math.min(n-e.start,s)})))}_refresh(){this._request||(this._running=!0,this._request=c9.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((n,r)=>{if(!n.running||!n.items.length)return;const i=n.items;let s,o=i.length-1,a=!1;for(;o>=0;--o)s=i[o],s._active?(s._total>n.duration&&(n.duration=s._total),s.tick(t),a=!0):(i[o]=i[i.length-1],i.pop());a&&(r.draw(),this._notify(r,n,t,"progress")),i.length||(n.running=!1,this._notify(r,n,t,"complete"),n.initial=!1),e+=i.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let r=n.length-1;for(;r>=0;--r)n[r].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};const Ent="transparent",Mnt={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const r=Gtt(t||Ent),i=r.valid&&Gtt(e||Ent);return i&&i.valid?i.mix(r,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class Cnt{constructor(t,e,n,r){const i=e[n];r=_et([t.to,r,i,t.from]);const s=_et([t.from,i,r]);this._active=!0,this._fn=t.fn||Mnt[t.type||typeof s],this._easing=utt[t.easing]||utt.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=s,this._to=r,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const r=this._target[this._prop],i=n-this._start,s=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=i,this._loop=!!t.loop,this._to=_et([t.to,e,r,t.from]),this._from=_et([t.from,r,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,r=this._prop,i=this._from,s=this._loop,o=this._to;let a;if(this._active=i!==o&&(s||e<n),!this._active)return this._target[r]=o,void this._notify(!0);e<0?this._target[r]=i:(a=e/n%2,a=s&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[r]=this._fn(i,o,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,n)=>{t.push({res:e,rej:n})}))}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let t=0;t<n.length;t++)n[t][e]()}}Jtt.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const Ant=Object.keys(Jtt.animation);Jtt.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),Jtt.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),Jtt.describe("animations",{_fallback:"animation"}),Jtt.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class Nnt{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!y9(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const r=t[n];if(!y9(r))return;const i={};for(const t of Ant)i[t]=r[t];(g9(r.properties)&&r.properties||[n]).forEach((t=>{t!==n&&e.has(t)||e.set(t,i)}))}))}_animateOptions(t,e){const n=e.options,r=function(t,e){if(!e)return;let n=t.options;if(!n)return void(t.options=e);n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(t,n);if(!r)return[];const i=this._createAnimations(r,n);return n.$shared&&function(t,e){const n=[],r=Object.keys(e);for(let e=0;e<r.length;e++){const i=t[r[e]];i&&i.active()&&n.push(i.wait())}return Promise.all(n)}(t.options.$animations,n).then((()=>{t.options=n}),(()=>{})),i}_createAnimations(t,e){const n=this._properties,r=[],i=t.$animations||(t.$animations={}),s=Object.keys(e),o=Date.now();let a;for(a=s.length-1;a>=0;--a){const l=s[a];if("$"===l.charAt(0))continue;if("options"===l){r.push(...this._animateOptions(t,e));continue}const c=e[l];let u=i[l];const h=n.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(i[l]=u=new Cnt(h,t,l,c),r.push(u)):t[l]=c}return r}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(Tnt.add(this._chart,n),!0):void 0}}function Int(t,e){const n=t&&t.options||{},r=n.reverse,i=void 0===n.min?e:0,s=void 0===n.max?e:0;return{start:r?s:i,end:r?i:s}}function $nt(t,e){const n=[],r=t._getSortedDatasetMetas(e);let i,s;for(i=0,s=r.length;i<s;++i)n.push(r[i].index);return n}function Rnt(t,e,n,r={}){const i=t.keys,s="single"===r.mode;let o,a,l,c;if(null!==e){for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===n){if(r.all)continue;break}c=t.values[l],b9(c)&&(s||0===e||G9(e)===G9(c))&&(e+=c)}return e}}function Ont(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function Pnt(t,e,n){const r=t[e]||(t[e]={});return r[n]||(r[n]={})}function Lnt(t,e,n,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const e=t[i.index];if(n&&e>0||!n&&e<0)return i.index}return null}function Dnt(t,e){const{chart:n,_cachedMeta:r}=t,i=n._stacks||(n._stacks={}),{iScale:s,vScale:o,index:a}=r,l=s.axis,c=o.axis,u=function(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}(s,o,r),h=e.length;let d;for(let t=0;t<h;++t){const n=e[t],{[l]:s,[c]:h}=n;d=(n._stacks||(n._stacks={}))[c]=Pnt(i,u,s),d[a]=h,d._top=Lnt(d,o,!0,r.type),d._bottom=Lnt(d,o,!1,r.type)}}function Fnt(t,e){const n=t.scales;return Object.keys(n).filter((t=>n[t].axis===e)).shift()}function znt(t,e){const n=t.controller.index,r=t.vScale&&t.vScale.axis;if(r){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[r]||void 0===e[r][n])return;delete e[r][n]}}}const Bnt=t=>"reset"===t||"none"===t,Unt=(t,e)=>e?t:Object.assign({},t);class Vnt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ont(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&znt(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),r=(t,e,n,r)=>"x"===t?e:"r"===t?r:n,i=e.xAxisID=x9(n.xAxisID,Fnt(t,"x")),s=e.yAxisID=x9(n.yAxisID,Fnt(t,"y")),o=e.rAxisID=x9(n.rAxisID,Fnt(t,"r")),a=e.indexAxis,l=e.iAxisID=r(a,i,s,o),c=e.vAxisID=r(a,s,i,o);e.xScale=this.getScaleForId(i),e.yScale=this.getScaleForId(s),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Aet(this._data,this),t._stacked&&znt(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(y9(e))this._data=function(t){const e=Object.keys(t),n=new Array(e.length);let r,i,s;for(r=0,i=e.length;r<i;++r)s=e[r],n[r]={x:s,y:t[s]};return n}(e);else if(n!==e){if(n){Aet(n,this);const t=this._cachedMeta;znt(t),t._parsed=[]}e&&Object.isExtensible(e)&&(i=this,(r=e)._chartjs?r._chartjs.listeners.push(i):(Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),Cet.forEach((t=>{const e="_onData"+R9(t),n=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...t){const i=n.apply(this,t);return r._chartjs.listeners.forEach((n=>{"function"==typeof n[e]&&n[e](...t)})),i}})})))),this._syncList=[],this._data=e}var r,i}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let r=!1;this._dataCheck();const i=e._stacked;e._stacked=Ont(e.vScale,e),e.stack!==n.stack&&(r=!0,znt(e),e.stack=n.stack),this._resyncElements(t),(r||i!==e._stacked)&&Dnt(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:r}=this,{iScale:i,_stacked:s}=n,o=i.axis;let a,l,c,u=0===t&&e===r.length||n._sorted,h=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=r,n._sorted=!0,c=r;else{c=g9(r[t])?this.parseArrayData(n,r,t,e):y9(r[t])?this.parseObjectData(n,r,t,e):this.parsePrimitiveData(n,r,t,e);const i=()=>null===l[o]||h&&l[o]<h[o];for(a=0;a<e;++a)n._parsed[a+t]=l=c[a],u&&(i()&&(u=!1),h=l);n._sorted=u}s&&Dnt(this,c)}parsePrimitiveData(t,e,n,r){const{iScale:i,vScale:s}=t,o=i.axis,a=s.axis,l=i.getLabels(),c=i===s,u=new Array(r);let h,d,p;for(h=0,d=r;h<d;++h)p=h+n,u[h]={[o]:c||i.parse(l[p],p),[a]:s.parse(e[p],p)};return u}parseArrayData(t,e,n,r){const{xScale:i,yScale:s}=t,o=new Array(r);let a,l,c,u;for(a=0,l=r;a<l;++a)c=a+n,u=e[c],o[a]={x:i.parse(u[0],c),y:s.parse(u[1],c)};return o}parseObjectData(t,e,n,r){const{xScale:i,yScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(r);let c,u,h,d;for(c=0,u=r;c<u;++c)h=c+n,d=e[h],l[c]={x:i.parse($9(d,o),h),y:s.parse($9(d,a),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const r=this.chart,i=this._cachedMeta,s=e[t.axis];return Rnt({keys:$nt(r,!0),values:e._stacks[t.axis]},s,i.index,{mode:n})}updateRangeFromParsed(t,e,n,r){const i=n[e.axis];let s=null===i?NaN:i;const o=r&&n._stacks[e.axis];r&&o&&(r.values=o,s=Rnt(r,i,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,e){const n=this._cachedMeta,r=n._parsed,i=n._sorted&&t===n.iScale,s=r.length,o=this._getOtherScale(t),a=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:$nt(n,!0),values:null})(e,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(t){const{min:e,max:n,minDefined:r,maxDefined:i}=t.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=r[h];const e=d[o.axis];return!b9(d[t.axis])||c>e||u<e}for(h=0;h<s&&(p()||(this.updateRangeFromParsed(l,t,d,a),!i));++h);if(i)for(h=s-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,t,d,a);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let r,i,s;for(r=0,i=e.length;r<i;++r)s=e[r][t.axis],b9(s)&&n.push(s);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,r=e.vScale,i=this.getParsed(t);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:r?""+r.getLabelForValue(i[r.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,r,i;return y9(t)?(e=t.top,n=t.right,r=t.bottom,i=t.left):e=n=r=i=t,{top:e,right:n,bottom:r,left:i,disabled:!1===t}}(x9(this.options.clip,function(t,e,n){if(!1===n)return!1;const r=Int(t,n),i=Int(e,n);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,r=n.data||[],i=e.chartArea,s=[],o=this._drawStart||0,a=this._drawCount||r.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(t,i,o,a),c=o;c<o+a;++c){const e=r[c];e.hidden||(e.active&&l?s.push(e):e.draw(t,i))}for(c=0;c<s.length;++c)s[c].draw(t,i)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const r=this.getDataset();let i;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];i=e.$context||(e.$context=function(t,e,n){return ket(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),i.parsed=this.getParsed(t),i.raw=r.data[t],i.index=i.dataIndex=t}else i=this.$context||(this.$context=function(t,e){return ket(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),i.dataset=r,i.index=i.datasetIndex=this.index;return i.active=!!e,i.mode=n,i}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",n){const r="active"===e,i=this._cachedDataOpts,s=t+"-"+e,o=i[s],a=this.enableOptionSharing&&O9(n);if(o)return Unt(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),u=r?[`${t}Hover`,"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(Jtt.elements[t]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(n,r)),u);return p.$shared&&(p.$shared=a,i[s]=Object.freeze(Unt(p,a))),p}_resolveAnimations(t,e,n){const r=this.chart,i=this._cachedDataOpts,s=`animation-${e}`,o=i[s];if(o)return o;let a;if(!1!==r.options.animation){const r=this.chart.config,i=r.datasetAnimationScopeKeys(this._type,e),s=r.getOptionScopes(this.getDataset(),i);a=r.createResolver(s,this.getContext(t,n,e))}const l=new Nnt(r,a&&a.animations);return a&&a._cacheable&&(i[s]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Bnt(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),r=this._sharedOptions,i=this.getSharedOptions(n),s=this.includeOptions(e,i)||i!==r;return this.updateSharedOptions(i,e,n),{sharedOptions:i,includeOptions:s}}updateElement(t,e,n,r){Bnt(r)?Object.assign(t,n):this._resolveAnimations(e,r).update(t,n)}updateSharedOptions(t,e,n){t&&!Bnt(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,r){t.active=r;const i=this.getStyle(e,r);this._resolveAnimations(e,n,r).update(t,{options:!r&&this.getSharedOptions(i)||i})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[t,e,n]of this._syncList)this[t](e,n);this._syncList=[];const r=n.length,i=e.length,s=Math.min(i,r);s&&this.parse(0,s),i>r?this._insertElements(r,i-r,t):i<r&&this._removeElements(i,r-i)}_insertElements(t,e,n=!0){const r=this._cachedMeta,i=r.data,s=t+e;let o;const a=t=>{for(t.length+=e,o=t.length-1;o>=s;o--)t[o]=t[o-e]};for(a(i),o=t;o<s;++o)i[o]=new this.dataElementType;this._parsing&&a(r._parsed),this.parse(t,e),n&&this.updateElements(i,t,e,"reset")}updateElements(t,e,n,r){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const r=n._parsed.splice(t,e);n._stacked&&znt(n,r)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,r]=t;this[e](n,r)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function jnt(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let r=[];for(let e=0,i=n.length;e<i;e++)r=r.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=Net(r.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let r,i,s,o,a=e._length;const l=()=>{32767!==s&&-32768!==s&&(O9(o)&&(a=Math.min(a,Math.abs(s-o)||a)),o=s)};for(r=0,i=n.length;r<i;++r)s=e.getPixelForValue(n[r]),l();for(o=void 0,r=0,i=e.ticks.length;r<i;++r)s=e.getPixelForTick(r),l();return a}function Wnt(t,e,n,r){return g9(t)?function(t,e,n,r){const i=n.parse(t[0],r),s=n.parse(t[1],r),o=Math.min(i,s),a=Math.max(i,s);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:i,end:s,min:o,max:a}}(t,e,n,r):e[n.axis]=n.parse(t,r),e}function Hnt(t,e,n,r){const i=t.iScale,s=t.vScale,o=i.getLabels(),a=i===s,l=[];let c,u,h,d;for(c=n,u=n+r;c<u;++c)d=e[c],h={},h[i.axis]=a||i.parse(o[c],c),l.push(Wnt(d,h,s,c));return l}function Gnt(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function qnt(t,e,n,r){let i=e.borderSkipped;const s={};if(!i)return void(t.borderSkipped=s);const{start:o,end:a,reverse:l,top:c,bottom:u}=function(t){let e,n,r,i,s;return t.horizontal?(e=t.base>t.x,n="left",r="right"):(e=t.base<t.y,n="bottom",r="top"),e?(i="end",s="start"):(i="start",s="end"),{start:n,end:r,reverse:e,top:i,bottom:s}}(t);"middle"===i&&n&&(t.enableBorderRadius=!0,(n._top||0)===r?i=c:(n._bottom||0)===r?i=u:(s[Xnt(u,o,a,l)]=!0,i=c)),s[Xnt(i,o,a,l)]=!0,t.borderSkipped=s}function Xnt(t,e,n,r){var i,s,o;return r?(o=n,t=Ynt(t=(i=t)===(s=e)?o:i===o?s:i,n,e)):t=Ynt(t,e,n),t}function Ynt(t,e,n){return"start"===t?e:"end"===t?n:t}function Knt(t,{inflateAmount:e},n){t.inflateAmount="auto"===e?1===n?.33:0:e}Vnt.defaults={},Vnt.prototype.datasetElementType=null,Vnt.prototype.dataElementType=null;class Znt extends Vnt{parsePrimitiveData(t,e,n,r){return Hnt(t,e,n,r)}parseArrayData(t,e,n,r){return Hnt(t,e,n,r)}parseObjectData(t,e,n,r){const{iScale:i,vScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===i.axis?o:a,c="x"===s.axis?o:a,u=[];let h,d,p,f;for(h=n,d=n+r;h<d;++h)f=e[h],p={},p[i.axis]=i.parse($9(f,l),h),u.push(Wnt($9(f,c),p,s,h));return u}updateRangeFromParsed(t,e,n,r){super.updateRangeFromParsed(t,e,n,r);const i=n._custom;i&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,i.min),t.max=Math.max(t.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:r}=e,i=this.getParsed(t),s=i._custom,o=Gnt(s)?"["+s.start+", "+s.end+"]":""+r.getLabelForValue(i[r.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,r){const i="reset"===r,{index:s,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,r);for(let d=e;d<e+n;d++){const e=this.getParsed(d),n=i||m9(e[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[o.axis],m={horizontal:l,base:n.base,enableBorderRadius:!f||Gnt(e._custom)||s===f._top||s===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,t[d].active?"active":r));const g=m.options||t[d].options;qnt(m,g,f,s),Knt(m,g,c.ratio),this.updateElement(t[d],d,m,r)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,r=n.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),i=n.options.stacked,s=[],o=t=>{const n=t.controller.getParsed(e),r=n&&n[t.vScale.axis];if(m9(r)||isNaN(r))return!0};for(const n of r)if((void 0===e||!o(n))&&((!1===i||-1===s.indexOf(n.stack)||void 0===i&&void 0===n.stack)&&s.push(n.stack),n.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,n){const r=this._getStacks(t,n),i=void 0!==e?r.indexOf(e):-1;return-1===i?r.length-1:i}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,r=[];let i,s;for(i=0,s=e.data.length;i<s;++i)r.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const o=t.barThickness;return{min:o||jnt(e),pixels:r,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n},options:{base:r,minBarLength:i}}=this,s=r||0,o=this.getParsed(t),a=o._custom,l=Gnt(a);let c,u,h=o[e.axis],d=0,p=n?this.applyStack(e,o,n):h;p!==h&&(d=p-h,p=h),l&&(h=a.barStart,p=a.barEnd-a.barStart,0!==h&&G9(h)!==G9(a.barEnd)&&(d=0),d+=h);const f=m9(r)||l?d:r;let m=e.getPixelForValue(f);if(c=this.chart.getDataVisibility(t)?e.getPixelForValue(d+p):m,u=c-m,Math.abs(u)<i){u=function(t,e,n){return 0!==t?G9(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(u,e,s)*i,h===s&&(m-=u/2);const t=e.getPixelForDecimal(0),n=e.getPixelForDecimal(1),r=Math.min(t,n),o=Math.max(t,n);m=Math.max(Math.min(m,o),r),c=m+u}if(m===e.getPixelForValue(s)){const t=G9(u)*e.getLineWidthForValue(s)/2;m+=t,u-=t}return{size:u,base:m,head:c,center:c+u/2}}_calculateBarIndexPixels(t,e){const n=e.scale,r=this.options,i=r.skipNull,s=x9(r.maxBarThickness,1/0);let o,a;if(e.grouped){const n=i?this._getStackCount(t):e.stackCount,l="flex"===r.barThickness?function(t,e,n,r){const i=e.pixels,s=i[t];let o=t>0?i[t-1]:null,a=t<i.length-1?i[t+1]:null;const l=n.categoryPercentage;null===o&&(o=s-(null===a?e.end-e.start:a-s)),null===a&&(a=s+s-o);const c=s-(s-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/r,ratio:n.barPercentage,start:c}}(t,e,r,n):function(t,e,n,r){const i=n.barThickness;let s,o;return m9(i)?(s=e.min*n.categoryPercentage,o=n.barPercentage):(s=i*r,o=1),{chunk:s/r,ratio:o,start:e.pixels[t]-s/2}}(t,e,r,n),c=this._getStackIndex(this.index,this._cachedMeta.stack,i?t:void 0);o=l.start+l.chunk*c+l.chunk/2,a=Math.min(s,l.chunk*l.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),a=Math.min(s,e.min*e.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,r=n.length;let i=0;for(;i<r;++i)null!==this.getParsed(i)[e.axis]&&n[i].draw(this._ctx)}}Znt.id="bar",Znt.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},Znt.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Jnt extends Vnt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,r){const i=super.parsePrimitiveData(t,e,n,r);for(let t=0;t<i.length;t++)i[t]._custom=this.resolveDataElementOptions(t+n).radius;return i}parseArrayData(t,e,n,r){const i=super.parseArrayData(t,e,n,r);for(let t=0;t<i.length;t++){const r=e[n+t];i[t]._custom=x9(r[2],this.resolveDataElementOptions(t+n).radius)}return i}parseObjectData(t,e,n,r){const i=super.parseObjectData(t,e,n,r);for(let t=0;t<i.length;t++){const r=e[n+t];i[t]._custom=x9(r&&r.r&&+r.r,this.resolveDataElementOptions(t+n).radius)}return i}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:n,yScale:r}=e,i=this.getParsed(t),s=n.getLabelForValue(i.x),o=r.getLabelForValue(i.y),a=i._custom;return{label:e.label,value:"("+s+", "+o+(a?", "+a:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,r){const i="reset"===r,{iScale:s,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(e,r),c=s.axis,u=o.axis;for(let h=e;h<e+n;h++){const e=t[h],n=!i&&this.getParsed(h),d={},p=d[c]=i?s.getPixelForDecimal(.5):s.getPixelForValue(n[c]),f=d[u]=i?o.getBasePixel():o.getPixelForValue(n[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,e.active?"active":r),i&&(d.options.radius=0)),this.updateElement(e,h,d,r)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let r=super.resolveDataElementOptions(t,e);r.$shared&&(r=Object.assign({},r,{$shared:!1}));const i=r.radius;return"active"!==e&&(r.radius=0),r.radius+=x9(n&&n._custom,i),r}}Jnt.id="bubble",Jnt.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Jnt.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class Qnt extends Vnt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,r=this._cachedMeta;if(!1===this._parsing)r._parsed=n;else{let i,s,o=t=>+n[t];if(y9(n[t])){const{key:t="value"}=this._parsing;o=e=>+$9(n[e],t)}for(i=t,s=t+e;i<s;++i)r._parsed[i]=o(i)}}_getRotation(){return Z9(this.options.rotation-90)}_getCircumference(){return Z9(this.options.circumference)}_getRotationExtents(){let t=F9,e=-F9;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){const r=this.chart.getDatasetMeta(n).controller,i=r._getRotation(),s=r._getCircumference();t=Math.min(t,i),e=Math.max(e,i+s)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,r=this._cachedMeta,i=r.data,s=this.getMaxBorderWidth()+this.getMaxOffset(i)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-s)/2,0),a=Math.min((l=this.options.cutout,c=o,"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100:l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,n){let r=1,i=1,s=0,o=0;if(e<F9){const a=t,l=a+e,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(t,e,r)=>itt(t,a,l,!0)?1:Math.max(e,e*n,r,r*n),f=(t,e,r)=>itt(t,a,l,!0)?-1:Math.min(e,e*n,r,r*n),m=p(0,c,h),g=p(V9,u,d),y=f(D9,c,h),b=f(D9+V9,u,d);r=(m-y)/2,i=(g-b)/2,s=-(m+y)/2,o=-(g+b)/2}return{ratioX:r,ratioY:i,offsetX:s,offsetY:o}}(d,h,a),y=(n.width-s)/p,b=(n.height-s)/f,v=Math.max(Math.min(y,b)/2,0),x=w9(this.options.radius,v),w=(x-Math.max(x*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,r.total=this.calculateTotal(),this.outerRadius=x-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*u,0),this.updateElements(i,0,i.length,t)}_circumference(t,e){const n=this.options,r=this._cachedMeta,i=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===r._parsed[t]||r.data[t].hidden?0:this.calculateCircumference(r._parsed[t]*i/F9)}updateElements(t,e,n,r){const i="reset"===r,s=this.chart,o=s.chartArea,a=s.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=i&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,r);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,i);for(m=e;m<e+n;++m){const e=this._circumference(m,i),n=t[m],s={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:d,innerRadius:h};f&&(s.options=p||this.resolveDataElementOptions(m,n.active?"active":r)),g+=e,this.updateElement(n,m,s,r)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,r=0;for(n=0;n<e.length;n++){const i=t._parsed[n];null===i||isNaN(i)||!this.chart.getDataVisibility(n)||e[n].hidden||(r+=Math.abs(i))}return r}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?F9*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,r=n.data.labels||[],i=fnt(e._parsed[t],n.options.locale);return{label:r[t]||"",value:i}}getMaxBorderWidth(t){let e=0;const n=this.chart;let r,i,s,o,a;if(!t)for(r=0,i=n.data.datasets.length;r<i;++r)if(n.isDatasetVisible(r)){s=n.getDatasetMeta(r),t=s.data,o=s.controller;break}if(!t)return 0;for(r=0,i=t.length;r<i;++r)a=o.resolveDataElementOptions(r),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,r=t.length;n<r;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max(x9(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Qnt.id="doughnut",Qnt.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},Qnt.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},Qnt.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,r)=>{const i=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:i.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const n=": "+t.formattedValue;return g9(e)?(e=e.slice(),e[0]+=n):e+=n,e}}}}};class trt extends Vnt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:r=[],_dataset:i}=e,s=this.chart._animationsDisabled;let{start:o,count:a}=function(t,e,n){const r=e.length;let i=0,s=r;if(t._sorted){const{iScale:o,_parsed:a}=t,l=o.axis,{min:c,max:u,minDefined:h,maxDefined:d}=o.getUserBounds();h&&(i=stt(Math.min(Eet(a,o.axis,c).lo,n?r:Eet(e,l,o.getPixelForValue(c)).lo),0,r-1)),s=d?stt(Math.max(Eet(a,o.axis,u).hi+1,n?0:Eet(e,l,o.getPixelForValue(u)).hi+1),i,r)-i:r-i}return{start:i,count:s}}(e,r,s);this._drawStart=o,this._drawCount=a,function(t){const{xScale:e,yScale:n,_scaleRanges:r}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!r)return t._scaleRanges=i,!0;const s=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,i),s}(e)&&(o=0,a=r.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=r;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:l},t),this.updateElements(r,o,a,t)}updateElements(t,e,n,r){const i="reset"===r,{iScale:s,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(e,r),h=s.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=X9(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||i||"none"===r;let y=e>0&&this.getParsed(e-1);for(let p=e;p<e+n;++p){const e=t[p],n=this.getParsed(p),b=g?e:{},v=m9(n[d]),x=b[h]=s.getPixelForValue(n[h],p),w=b[d]=i||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[d],p);b.skip=isNaN(x)||isNaN(w)||v,b.stop=p>0&&Math.abs(n[h]-y[h])>m,f&&(b.parsed=n,b.raw=l.data[p]),u&&(b.options=c||this.resolveDataElementOptions(p,e.active?"active":r)),g||this.updateElement(e,p,b,r),y=n}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,r=t.data||[];if(!r.length)return n;const i=r[0].size(this.resolveDataElementOptions(0)),s=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(n,i,s)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}trt.id="line",trt.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},trt.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class ert extends Vnt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,r=n.data.labels||[],i=fnt(e._parsed[t].r,n.options.locale);return{label:r[t]||"",value:i}}parseObjectData(t,e,n,r){return Wet.bind(this)(t,e,n,r)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,r=Math.min(e.right-e.left,e.bottom-e.top),i=Math.max(r/2,0),s=(i-Math.max(n.cutoutPercentage?i/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=i-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(t,e,n,r){const i="reset"===r,s=this.chart,o=s.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*D9;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,r,p);for(h=e;h<e+n;h++){const e=t[h];let n=d,f=d+this._computeAngle(h,r,p),m=s.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,i&&(o.animateScale&&(m=0),o.animateRotate&&(n=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(h,e.active?"active":r)};this.updateElement(e,h,g,r)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++})),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?Z9(this.resolveDataElementOptions(t,e).angle||n):0}}ert.id="polarArea",ert.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},ert.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,r)=>{const i=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:i.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class nrt extends Qnt{}nrt.id="pie",nrt.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class rrt extends Vnt{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,r){return Wet.bind(this)(t,e,n,r)}update(t){const e=this._cachedMeta,n=e.dataset,r=e.data||[],i=e.iScale.getLabels();if(n.points=r,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const s={_loop:!0,_fullLoop:i.length===r.length,options:e};this.updateElement(n,void 0,s,t)}this.updateElements(r,0,r.length,t)}updateElements(t,e,n,r){const i=this._cachedMeta.rScale,s="reset"===r;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":r),a=i.getPointPositionForValue(o,this.getParsed(o).r),l=s?i.xCenter:a.x,c=s?i.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(e,o,u,r)}}}rrt.id="radar",rrt.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},rrt.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class irt extends trt{}function srt(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}irt.id="scatter",irt.defaults={showLine:!1,fill:!1},irt.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};class art{constructor(t){this.options=t||{}}formats(){return srt()}parse(t,e){return srt()}format(t,e){return srt()}add(t,e,n){return srt()}diff(t,e,n){return srt()}startOf(t,e,n){return srt()}endOf(t,e){return srt()}}art.override=function(t){Object.assign(art.prototype,t)};var lrt={_date:art};function crt(t,e,n,r){const{controller:i,data:s,_sorted:o}=t,a=i._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&o&&s.length){const t=a._reversePixels?Met:Eet;if(!r)return t(s,e,n);if(i._sharedOptions){const r=s[0],i="function"==typeof r.getRange&&r.getRange(e);if(i){const r=t(s,e,n-i),o=t(s,e,n+i);return{lo:r.lo,hi:o.hi}}}}return{lo:0,hi:s.length-1}}function urt(t,e,n,r,i){const s=t.getSortedVisibleDatasetMetas(),o=n[e];for(let t=0,n=s.length;t<n;++t){const{index:n,data:a}=s[t],{lo:l,hi:c}=crt(s[t],e,o,i);for(let t=l;t<=c;++t){const e=a[t];e.skip||r(e,n,t)}}}function hrt(t,e,n,r,i){const s=[];if(!i&&!t.isPointInArea(e))return s;return urt(t,n,e,(function(n,o,a){(i||set(n,t.chartArea,0))&&n.inRange(e.x,e.y,r)&&s.push({element:n,datasetIndex:o,index:a})}),!0),s}function drt(t,e,n,r,i,s){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,r){const i=e?Math.abs(t.x-r.x):0,s=n?Math.abs(t.y-r.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2))}}(n);let l=Number.POSITIVE_INFINITY;return urt(t,n,e,(function(n,c,u){const h=n.inRange(e.x,e.y,i);if(r&&!h)return;const d=n.getCenterPoint(i);if(!(!!s||t.isPointInArea(d))&&!h)return;const p=a(e,d);p<l?(o=[{element:n,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:n,datasetIndex:c,index:u})})),o}function prt(t,e,n,r,i,s){return s||t.isPointInArea(e)?"r"!==n||r?drt(t,e,n,r,i,s):function(t,e,n,r){let i=[];return urt(t,n,e,(function(t,n,s){const{startAngle:o,endAngle:a}=t.getProps(["startAngle","endAngle"],r),{angle:l}=ttt(t,{x:e.x,y:e.y});itt(l,o,a)&&i.push({element:t,datasetIndex:n,index:s})})),i}(t,e,n,i):[]}function frt(t,e,n,r,i){const s=[],o="x"===n?"inXRange":"inYRange";let a=!1;return urt(t,n,e,((t,r,l)=>{t[o](e[n],i)&&(s.push({element:t,datasetIndex:r,index:l}),a=a||t.inRange(e.x,e.y,i))})),r&&!a?[]:s}var mrt={evaluateInteractionItems:urt,modes:{index(t,e,n,r){const i=int(e,t),s=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?hrt(t,i,s,r,o):prt(t,i,s,!1,r,o),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,n=t.data[e];n&&!n.skip&&l.push({element:n,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,n,r){const i=int(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?hrt(t,i,s,r,o):prt(t,i,s,!1,r,o);if(a.length>0){const e=a[0].datasetIndex,n=t.getDatasetMeta(e).data;a=[];for(let t=0;t<n.length;++t)a.push({element:n[t],datasetIndex:e,index:t})}return a},point:(t,e,n,r)=>hrt(t,int(e,t),n.axis||"xy",r,n.includeInvisible||!1),nearest(t,e,n,r){const i=int(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;return prt(t,i,s,n.intersect,r,o)},x:(t,e,n,r)=>frt(t,int(e,t),"x",n.intersect,r),y:(t,e,n,r)=>frt(t,int(e,t),"y",n.intersect,r)}};const grt=["left","top","right","bottom"];function yrt(t,e){return t.filter((t=>t.pos===e))}function brt(t,e){return t.filter((t=>-1===grt.indexOf(t.pos)&&t.box.axis===e))}function vrt(t,e){return t.sort(((t,n)=>{const r=e?n:t,i=e?t:n;return r.weight===i.weight?r.index-i.index:r.weight-i.weight}))}function xrt(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:r,stackWeight:i}=n;if(!t||!grt.includes(r))continue;const s=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=i}return e}(t),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let s,o,a;for(s=0,o=t.length;s<o;++s){a=t[s];const{fullSize:o}=a.box,l=n[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*r:o&&e.availableWidth,a.height=i):(a.width=r,a.height=c?c*i:o&&e.availableHeight)}return n}function wrt(t,e,n,r){return Math.max(t[n],e[n])+Math.max(t[r],e[r])}function _rt(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Srt(t,e,n,r){const{pos:i,box:s}=n,o=t.maxPadding;if(!y9(i)){n.size&&(t[i]-=n.size);const e=r[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?s.height:s.width),n.size=e.size/e.count,t[i]+=n.size}s.getPadding&&_rt(o,s.getPadding());const a=Math.max(0,e.outerWidth-wrt(o,t,"left","right")),l=Math.max(0,e.outerHeight-wrt(o,t,"top","bottom")),c=a!==t.w,u=l!==t.h;return t.w=a,t.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function krt(t,e){const n=e.maxPadding;function r(t){const r={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{r[t]=Math.max(e[t],n[t])})),r}return r(t?["left","right"]:["top","bottom"])}function Trt(t,e,n,r){const i=[];let s,o,a,l,c,u;for(s=0,o=t.length,c=0;s<o;++s){a=t[s],l=a.box,l.update(a.width||e.w,a.height||e.h,krt(a.horizontal,e));const{same:o,other:h}=Srt(e,n,a,r);c|=o&&i.length,u=u||h,l.fullSize||i.push(a)}return c&&Trt(i,e,n,r)||u}function Ert(t,e,n,r,i){t.top=n,t.left=e,t.right=e+r,t.bottom=n+i,t.width=r,t.height=i}function Mrt(t,e,n,r){const i=n.padding;let{x:s,y:o}=e;for(const a of t){const t=a.box,l=r[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const r=e.w*c,s=l.size||t.height;O9(l.start)&&(o=l.start),t.fullSize?Ert(t,i.left,o,n.outerWidth-i.right-i.left,s):Ert(t,e.left+l.placed,o,r,s),l.start=o,l.placed+=r,o=t.bottom}else{const r=e.h*c,o=l.size||t.width;O9(l.start)&&(s=l.start),t.fullSize?Ert(t,s,i.top,o,n.outerHeight-i.bottom-i.top):Ert(t,s,e.top+l.placed,o,r),l.start=s,l.placed+=r,s=t.right}}e.x=s,e.y=o}Jtt.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Crt={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,r){if(!t)return;const i=xet(t.options.layout.padding),s=Math.max(e-i.width,0),o=Math.max(n-i.height,0),a=function(t){const e=function(t){const e=[];let n,r,i,s,o,a;for(n=0,r=(t||[]).length;n<r;++n)i=t[n],({position:s,options:{stack:o,stackWeight:a=1}}=i),e.push({index:n,box:i,pos:s,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&s+o,stackWeight:a});return e}(t),n=vrt(e.filter((t=>t.box.fullSize)),!0),r=vrt(yrt(e,"left"),!0),i=vrt(yrt(e,"right")),s=vrt(yrt(e,"top"),!0),o=vrt(yrt(e,"bottom")),a=brt(e,"x"),l=brt(e,"y");return{fullSize:n,leftAndTop:r.concat(s),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:yrt(e,"chartArea"),vertical:r.concat(i).concat(l),horizontal:s.concat(o).concat(a)}}(t.boxes),l=a.vertical,c=a.horizontal;S9(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const u=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},i);_rt(d,xet(r));const p=Object.assign({maxPadding:d,w:s,h:o,x:i.left,y:i.top},i),f=xrt(l.concat(c),h);Trt(a.fullSize,p,h,f),Trt(l,p,h,f),Trt(c,p,h,f)&&Trt(l,p,h,f),function(t){const e=t.maxPadding;function n(n){const r=Math.max(e[n]-t[n],0);return t[n]+=r,r}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(p),Mrt(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,Mrt(a.rightAndBottom,p,h,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},S9(a.chartArea,(e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class Art{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,r){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,r?Math.floor(e/r):n)}}isAttached(t){return!0}updateConfig(t){}}class Nrt extends Art{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Irt={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},$rt=t=>null===t||""===t;const Rrt=!!lnt&&{passive:!0};function Ort(t,e,n){t.canvas.removeEventListener(e,n,Rrt)}function Prt(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function Lrt(t,e,n){const r=t.canvas,i=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Prt(n.addedNodes,r),e=e&&!Prt(n.removedNodes,r);e&&n()}));return i.observe(document,{childList:!0,subtree:!0}),i}function Drt(t,e,n){const r=t.canvas,i=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Prt(n.removedNodes,r),e=e&&!Prt(n.addedNodes,r);e&&n()}));return i.observe(document,{childList:!0,subtree:!0}),i}const Frt=new Map;let zrt=0;function Brt(){const t=window.devicePixelRatio;t!==zrt&&(zrt=t,Frt.forEach(((e,n)=>{n.currentDevicePixelRatio!==t&&e()})))}function Urt(t,e,n){const r=t.canvas,i=r&&Qet(r);if(!i)return;const s=u9(((t,e)=>{const r=i.clientWidth;n(t,e),r<i.clientWidth&&n()}),window),o=new ResizeObserver((t=>{const e=t[0],n=e.contentRect.width,r=e.contentRect.height;0===n&&0===r||s(n,r)}));return o.observe(i),function(t,e){Frt.size||window.addEventListener("resize",Brt),Frt.set(t,e)}(t,s),o}function Vrt(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){Frt.delete(t),Frt.size||window.removeEventListener("resize",Brt)}(t)}function jrt(t,e,n){const r=t.canvas,i=u9((e=>{null!==t.ctx&&n(function(t,e){const n=Irt[t.type]||t.type,{x:r,y:i}=int(t,e);return{type:n,chart:e,native:t,x:void 0!==r?r:null,y:void 0!==i?i:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,n){t.addEventListener(e,n,Rrt)}(r,e,i),i}class Wrt extends Art{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,r=t.getAttribute("height"),i=t.getAttribute("width");if(t.$chartjs={initial:{height:r,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",$rt(i)){const e=cnt(t,"width");void 0!==e&&(t.width=e)}if($rt(r))if(""===t.style.height)t.height=t.width/(e||2);else{const e=cnt(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e.$chartjs)return!1;const n=e.$chartjs.initial;["height","width"].forEach((t=>{const r=n[t];m9(r)?e.removeAttribute(t):e.setAttribute(t,r)}));const r=n.style||{};return Object.keys(r).forEach((t=>{e.style[t]=r[t]})),e.width=e.width,delete e.$chartjs,!0}addEventListener(t,e,n){this.removeEventListener(t,e);const r=t.$proxies||(t.$proxies={}),i={attach:Lrt,detach:Drt,resize:Urt}[e]||jrt;r[e]=i(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),r=n[e];if(!r)return;({attach:Vrt,detach:Vrt,resize:Vrt}[e]||Ort)(t,e,r),n[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,r){return ont(t,e,n,r)}isAttached(t){const e=Qet(t);return!(!e||!e.isConnected)}}class Hrt{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return X9(this.x)&&X9(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const r={};return t.forEach((t=>{r[t]=n[t]&&n[t].active()?n[t]._to:this[t]})),r}}Hrt.defaults={},Hrt.defaultRoutes=void 0;const Grt={values:t=>g9(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const r=this.chart.options.locale;let i,s=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(i="scientific"),s=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t));return n}(t,n)}const o=H9(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),fnt(t,r,l)},logarithmic(t,e,n){if(0===t)return"0";const r=t/Math.pow(10,Math.floor(H9(t)));return 1===r||2===r||5===r?Grt.numeric.call(this,t,e,n):""}};var qrt={formatters:Grt};function Xrt(t,e){const n=t.options.ticks,r=n.maxTicksLimit||function(t){const e=t.options.offset,n=t._tickSize(),r=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(r,i))}(t),i=n.major.enabled?function(t){const e=[];let n,r;for(n=0,r=t.length;n<r;n++)t[n].major&&e.push(n);return e}(e):[],s=i.length,o=i[0],a=i[s-1],l=[];if(s>r)return function(t,e,n,r){let i,s=0,o=n[0];for(r=Math.ceil(r),i=0;i<t.length;i++)i===o&&(e.push(t[i]),s++,o=n[s*r])}(e,l,i,s/r),l;const c=function(t,e,n){const r=function(t){const e=t.length;let n,r;if(e<2)return!1;for(r=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==r)return!1;return r}(t),i=e.length/n;if(!r)return Math.max(i,1);const s=function(t){const e=[],n=Math.sqrt(t);let r;for(r=1;r<n;r++)t%r==0&&(e.push(r),e.push(t/r));return n===(0|n)&&e.push(n),e.sort(((t,e)=>t-e)).pop(),e}(r);for(let t=0,e=s.length-1;t<e;t++){const e=s[t];if(e>i)return e}return Math.max(i,1)}(i,e,r);if(s>0){let t,n;const r=s>1?Math.round((a-o)/(s-1)):null;for(Yrt(e,l,c,m9(r)?0:o-r,o),t=0,n=s-1;t<n;t++)Yrt(e,l,c,i[t],i[t+1]);return Yrt(e,l,c,a,m9(r)?e.length:a+r),l}return Yrt(e,l,c),l}function Yrt(t,e,n,r,i){const s=x9(r,0),o=Math.min(x9(i,t.length),t.length);let a,l,c,u=0;for(n=Math.ceil(n),i&&(a=i-r,n=a/Math.floor(a/n)),c=s;c<0;)u++,c=Math.round(s+u*n);for(l=Math.max(s,0);l<o;l++)l===c&&(e.push(t[l]),u++,c=Math.round(s+u*n))}Jtt.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:qrt.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),Jtt.route("scale.ticks","color","","color"),Jtt.route("scale.grid","color","","borderColor"),Jtt.route("scale.grid","borderColor","","borderColor"),Jtt.route("scale.title","color","","color"),Jtt.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),Jtt.describe("scales",{_fallback:"scale"}),Jtt.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const Krt=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n;function Zrt(t,e){const n=[],r=t.length/e,i=t.length;let s=0;for(;s<i;s+=r)n.push(t[Math.floor(s)]);return n}function Jrt(t,e,n){const r=t.ticks.length,i=Math.min(e,r-1),s=t._startPixel,o=t._endPixel,a=1e-6;let l,c=t.getPixelForTick(i);if(!(n&&(l=1===r?Math.max(c-s,o-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(i-1))/2,c+=i<e?l:-l,c<s-a||c>o+a)))return c}function Qrt(t){return t.drawTicks?t.tickLength:0}function tit(t,e){if(!t.display)return 0;const n=wet(t.font,e),r=xet(t.padding);return(g9(t.text)?t.text.length:1)*n.lineHeight+r.height}function eit(t,e,n){let r=h9(t);return(n&&"right"!==e||!n&&"right"===e)&&(r=(t=>"left"===t?"right":"right"===t?"left":t)(r)),r}class nit extends Hrt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:r}=this;return t=v9(t,Number.POSITIVE_INFINITY),e=v9(e,Number.NEGATIVE_INFINITY),n=v9(n,Number.POSITIVE_INFINITY),r=v9(r,Number.NEGATIVE_INFINITY),{min:v9(t,n),max:v9(e,r),minDefined:b9(t),maxDefined:b9(e)}}getMinMax(t){let e,{min:n,max:r,minDefined:i,maxDefined:s}=this.getUserBounds();if(i&&s)return{min:n,max:r};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)e=o[a].controller.getMinMax(this,t),i||(n=Math.min(n,e.min)),s||(r=Math.max(r,e.max));return n=s&&n>r?r:n,r=i&&n>r?n:r,{min:v9(n,v9(r,n)),max:v9(r,v9(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){_9(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:r,grace:i,ticks:s}=this.options,o=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:r,max:i}=t,s=w9(e,(i-r)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(r,-Math.abs(s)),max:o(i,s)}}(this,i,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?Zrt(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=Xrt(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){_9(this.options.afterUpdate,[this])}beforeSetDimensions(){_9(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){_9(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),_9(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){_9(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,r,i;for(n=0,r=t.length;n<r;n++)i=t[n],i.label=_9(e.callback,[i.value,n,t],this)}afterTickToLabelConversion(){_9(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){_9(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=this.ticks.length,r=e.minRotation||0,i=e.maxRotation;let s,o,a,l=r;if(!this._isVisible()||!e.display||r>=i||n<=1||!this.isHorizontal())return void(this.labelRotation=r);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=stt(this.chart.width-u,0,this.maxWidth);s=t.offset?this.maxWidth/n:d/(n-1),u+6>s&&(s=d/(n-(t.offset?.5:1)),o=this.maxHeight-Qrt(t.grid)-e.padding-tit(t.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=J9(Math.min(Math.asin(stt((c.highest.height+6)/s,-1,1)),Math.asin(stt(o/a,-1,1))-Math.asin(stt(h/a,-1,1)))),l=Math.max(r,Math.min(i,l))),this.labelRotation=l}afterCalculateLabelRotation(){_9(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){_9(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:r,grid:i}}=this,s=this._isVisible(),o=this.isHorizontal();if(s){const s=tit(r,e.options.font);if(o?(t.width=this.maxWidth,t.height=Qrt(i)+s):(t.height=this.maxHeight,t.width=Qrt(i)+s),n.display&&this.ticks.length){const{first:e,last:r,widest:i,highest:s}=this._getLabelSizes(),a=2*n.padding,l=Z9(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const e=n.mirror?0:u*i.width+c*s.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=n.mirror?0:c*i.width+u*s.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,r,u,c)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,r){const{ticks:{align:i,padding:s},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=r*t.width,h=n*e.height):(u=n*t.height,h=r*e.width):"start"===i?h=e.width:"end"===i?u=t.width:"inner"!==i&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-o+s)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+s)*this.width/(this.width-c),0)}else{let n=e.height/2,r=t.height/2;"start"===i?(n=0,r=t.height):"end"===i&&(n=e.height,r=0),this.paddingTop=n+s,this.paddingBottom=r+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){_9(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)m9(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=Zrt(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length)}return t}_computeLabelSizes(t,e){const{ctx:n,_longestTextCache:r}=this,i=[],s=[];let o,a,l,c,u,h,d,p,f,m,g,y=0,b=0;for(o=0;o<e;++o){if(c=t[o].label,u=this._resolveTickFontOptions(o),n.font=h=u.string,d=r[h]=r[h]||{data:{},gc:[]},p=u.lineHeight,f=m=0,m9(c)||g9(c)){if(g9(c))for(a=0,l=c.length;a<l;++a)g=c[a],m9(g)||g9(g)||(f=Qtt(n,d.data,d.gc,f,g),m+=p)}else f=Qtt(n,d.data,d.gc,f,c),m=p;i.push(f),s.push(m),y=Math.max(f,y),b=Math.max(m,b)}!function(t,e){S9(t,(t=>{const n=t.gc,r=n.length/2;let i;if(r>e){for(i=0;i<r;++i)delete t.data[n[i]];n.splice(0,r)}}))}(r,e);const v=i.indexOf(y),x=s.indexOf(b),w=t=>({width:i[t]||0,height:s[t]||0});return{first:w(0),last:w(e-1),widest:w(v),highest:w(x),widths:i,heights:s}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return stt(this._alignToPixels?eet(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return ket(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=function(t,e){return ket(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Z9(this.labelRotation),n=Math.abs(Math.cos(e)),r=Math.abs(Math.sin(e)),i=this._getLabelSizes(),s=t.autoSkipPadding||0,o=i?i.widest.width+s:0,a=i?i.highest.height+s:0;return this.isHorizontal()?a*n>o*r?o/n:a/r:a*r<o*n?a/n:o/r}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,r=this.options,{grid:i,position:s}=r,o=i.offset,a=this.isHorizontal(),l=this.ticks.length+(o?1:0),c=Qrt(i),u=[],h=i.setContext(this.getContext()),d=h.drawBorder?h.borderWidth:0,p=d/2,f=function(t){return eet(n,t,d)};let m,g,y,b,v,x,w,_,S,k,T,E;if("top"===s)m=f(this.bottom),x=this.bottom-c,_=m-p,k=f(t.top)+p,E=t.bottom;else if("bottom"===s)m=f(this.top),k=t.top,E=f(t.bottom)-p,x=m+p,_=this.top+c;else if("left"===s)m=f(this.right),v=this.right-c,w=m-p,S=f(t.left)+p,T=t.right;else if("right"===s)m=f(this.left),S=t.left,T=f(t.right)-p,v=m+p,w=this.left+c;else if("x"===e){if("center"===s)m=f((t.top+t.bottom)/2+.5);else if(y9(s)){const t=Object.keys(s)[0],e=s[t];m=f(this.chart.scales[t].getPixelForValue(e))}k=t.top,E=t.bottom,x=m+p,_=x+c}else if("y"===e){if("center"===s)m=f((t.left+t.right)/2);else if(y9(s)){const t=Object.keys(s)[0],e=s[t];m=f(this.chart.scales[t].getPixelForValue(e))}v=m-p,w=v-c,S=t.left,T=t.right}const M=x9(r.ticks.maxTicksLimit,l),C=Math.max(1,Math.ceil(l/M));for(g=0;g<l;g+=C){const t=i.setContext(this.getContext(g)),e=t.lineWidth,r=t.color,s=i.borderDash||[],l=t.borderDashOffset,c=t.tickWidth,h=t.tickColor,d=t.tickBorderDash||[],p=t.tickBorderDashOffset;y=Jrt(this,g,o),void 0!==y&&(b=eet(n,y,e),a?v=w=S=T=b:x=_=k=E=b,u.push({tx1:v,ty1:x,tx2:w,ty2:_,x1:S,y1:k,x2:T,y2:E,width:e,color:r,borderDash:s,borderDashOffset:l,tickWidth:c,tickColor:h,tickBorderDash:d,tickBorderDashOffset:p}))}return this._ticksLength=l,this._borderValue=m,u}_computeLabelItems(t){const e=this.axis,n=this.options,{position:r,ticks:i}=n,s=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=i,h=Qrt(n.grid),d=h+c,p=u?-c:d,f=-Z9(this.labelRotation),m=[];let g,y,b,v,x,w,_,S,k,T,E,M,C="middle";if("top"===r)w=this.bottom-p,_=this._getXAxisLabelAlignment();else if("bottom"===r)w=this.top+p,_=this._getXAxisLabelAlignment();else if("left"===r){const t=this._getYAxisLabelAlignment(h);_=t.textAlign,x=t.x}else if("right"===r){const t=this._getYAxisLabelAlignment(h);_=t.textAlign,x=t.x}else if("x"===e){if("center"===r)w=(t.top+t.bottom)/2+d;else if(y9(r)){const t=Object.keys(r)[0],e=r[t];w=this.chart.scales[t].getPixelForValue(e)+d}_=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===r)x=(t.left+t.right)/2-d;else if(y9(r)){const t=Object.keys(r)[0],e=r[t];x=this.chart.scales[t].getPixelForValue(e)}_=this._getYAxisLabelAlignment(h).textAlign}"y"===e&&("start"===a?C="top":"end"===a&&(C="bottom"));const A=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){b=o[g],v=b.label;const t=i.setContext(this.getContext(g));S=this.getPixelForTick(g)+i.labelOffset,k=this._resolveTickFontOptions(g),T=k.lineHeight,E=g9(v)?v.length:1;const e=E/2,n=t.color,a=t.textStrokeColor,c=t.textStrokeWidth;let h,d=_;if(s?(x=S,"inner"===_&&(d=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),M="top"===r?"near"===l||0!==f?-E*T+T/2:"center"===l?-A.highest.height/2-e*T+T:-A.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?A.highest.height/2-e*T:A.highest.height-E*T,u&&(M*=-1)):(w=S,M=(1-E)*T/2),t.showLabelBackdrop){const e=xet(t.backdropPadding),n=A.heights[g],r=A.widths[g];let i=w+M-e.top,s=x-e.left;switch(C){case"middle":i-=n/2;break;case"bottom":i-=n}switch(_){case"center":s-=r/2;break;case"right":s-=r}h={left:s,top:i,width:r+e.width,height:n+e.height,color:t.backdropColor}}m.push({rotation:f,label:v,font:k,color:n,strokeColor:a,strokeWidth:c,textOffset:M,textAlign:d,textBaseline:C,translation:[x,w],backdrop:h})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Z9(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:r,padding:i}}=this.options,s=t+i,o=this._getLabelSizes().widest.width;let a,l;return"left"===e?r?(l=this.right+i,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-s,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l=this.left)):"right"===e?r?(l=this.left+i,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+s,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:r,width:i,height:s}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,r,i,s),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex((e=>e.value===t));if(n>=0){return e.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,n=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let i,s;const o=(t,e,r)=>{r.width&&r.color&&(n.save(),n.lineWidth=r.width,n.strokeStyle=r.color,n.setLineDash(r.borderDash||[]),n.lineDashOffset=r.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(i=0,s=r.length;i<s;++i){const t=r[i];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:n}}=this,r=n.setContext(this.getContext()),i=n.drawBorder?r.borderWidth:0;if(!i)return;const s=n.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,l,c,u;this.isHorizontal()?(a=eet(t,this.left,i)-i/2,l=eet(t,this.right,s)+s/2,c=u=o):(c=eet(t,this.top,i)-i/2,u=eet(t,this.bottom,s)+s/2,a=l=o),e.save(),e.lineWidth=r.borderWidth,e.strokeStyle=r.borderColor,e.beginPath(),e.moveTo(a,c),e.lineTo(l,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&oet(e,n);const r=this._labelItems||(this._labelItems=this._computeLabelItems(t));let i,s;for(i=0,s=r.length;i<s;++i){const t=r[i],n=t.font,s=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),het(e,s,0,t.textOffset,n,t)}n&&aet(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:r}}=this;if(!n.display)return;const i=wet(n.font),s=xet(n.padding),o=n.align;let a=i.lineHeight/2;"bottom"===e||"center"===e||y9(e)?(a+=s.bottom,g9(n.text)&&(a+=i.lineHeight*(n.text.length-1))):a+=s.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(t,e,n,r){const{top:i,left:s,bottom:o,right:a,chart:l}=t,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-i,g=a-s;if(t.isHorizontal()){if(d=d9(r,s,a),y9(n)){const t=Object.keys(n)[0],r=n[t];p=u[t].getPixelForValue(r)+m-e}else p="center"===n?(c.bottom+c.top)/2+m-e:Krt(t,n,e);h=a-s}else{if(y9(n)){const t=Object.keys(n)[0],r=n[t];d=u[t].getPixelForValue(r)-g+e}else d="center"===n?(c.left+c.right)/2-g+e:Krt(t,n,e);p=d9(r,o,i),f="left"===n?-V9:V9}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,e,o);het(t,n.text,0,0,i,{color:n.color,maxWidth:u,rotation:h,textAlign:eit(o,e,r),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=x9(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===nit.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",r=[];let i,s;for(i=0,s=e.length;i<s;++i){const s=e[i];s[n]!==this.id||t&&s.type!==t||r.push(s)}return r}_resolveTickFontOptions(t){return wet(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class rit{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const r=this.items,i=t.id,s=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+t);return i in r||(r[i]=t,function(t,e,n){const r=C9(Object.create(null),[n?Jtt.get(n):{},Jtt.get(e),t.defaults]);Jtt.set(e,r),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((n=>{const r=n.split("."),i=r.pop(),s=[t].concat(r).join("."),o=e[n].split("."),a=o.pop(),l=o.join(".");Jtt.route(s,i,l,a)}))}(e,t.defaultRoutes);t.descriptors&&Jtt.describe(e,t.descriptors)}(t,s,n),this.override&&Jtt.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,r=this.scope;n in e&&delete e[n],r&&n in Jtt[r]&&(delete Jtt[r][n],this.override&&delete Xtt[n])}}var iit=new class{constructor(){this.controllers=new rit(Vnt,"datasets",!0),this.elements=new rit(Hrt,"elements"),this.plugins=new rit(Object,"plugins"),this.scales=new rit(nit,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,n){[...e].forEach((e=>{const r=n||this._getRegistryForType(e);n||r.isForType(e)||r===this.plugins&&e.id?this._exec(t,r,e):S9(e,(e=>{const r=n||this._getRegistryForType(e);this._exec(t,r,e)}))}))}_exec(t,e,n){const r=R9(t);_9(n["before"+r],[],n),e[t](n),_9(n["after"+r],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const r=e.get(t);if(void 0===r)throw new Error('"'+t+'" is not a registered '+n+".");return r}};class sit{constructor(){this._init=[]}notify(t,e,n,r){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const i=r?this._descriptors(t).filter(r):this._descriptors(t),s=this._notify(i,t,e,n);return"afterDestroy"===e&&(this._notify(i,t,"stop"),this._notify(this._init,t,"uninstall")),s}_notify(t,e,n,r){r=r||{};for(const i of t){const t=i.plugin;if(!1===_9(t[n],[e,r,i.options],t)&&r.cancelable)return!1}return!0}invalidate(){m9(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,r=x9(n.options&&n.options.plugins,{}),i=function(t){const e={},n=[],r=Object.keys(iit.plugins.items);for(let t=0;t<r.length;t++)n.push(iit.getPlugin(r[t]));const i=t.plugins||[];for(let t=0;t<i.length;t++){const r=i[t];-1===n.indexOf(r)&&(n.push(r),e[r.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==r||e?function(t,{plugins:e,localIds:n},r,i){const s=[],o=t.getContext();for(const a of e){const e=a.id,l=oit(r[e],i);null!==l&&s.push({plugin:a,options:ait(t.config,{plugin:a,local:n[e]},l,o)})}return s}(t,i,r,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,r=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(r(e,n),t,"stop"),this._notify(r(n,e),t,"start")}}function oit(t,e){return e||!1!==t?!0===t?{}:t:null}function ait(t,{plugin:e,local:n},r,i){const s=t.pluginScopeKeys(e),o=t.getOptionScopes(r,s);return n&&e.defaults&&o.push(e.defaults),t.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function lit(t,e){const n=Jtt.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function cit(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(n=e.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||t.charAt(0).toLowerCase();var n}function uit(t){const e=t.options||(t.options={});e.plugins=x9(e.plugins,{}),e.scales=function(t,e){const n=Xtt[t.type]||{scales:{}},r=e.scales||{},i=lit(t.type,e),s=Object.create(null),o=Object.create(null);return Object.keys(r).forEach((t=>{const e=r[t];if(!y9(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=cit(t,e),l=function(t,e){return t===e?"_index_":"_value_"}(a,i),c=n.scales||{};s[a]=s[a]||t,o[t]=A9(Object.create(null),[{axis:a},e,c[a],c[l]])})),t.data.datasets.forEach((n=>{const i=n.type||t.type,a=n.indexAxis||lit(i,e),l=(Xtt[i]||{}).scales||{};Object.keys(l).forEach((t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,a),i=n[e+"AxisID"]||s[e]||e;o[i]=o[i]||Object.create(null),A9(o[i],[{axis:e},r[i],l[t]])}))})),Object.keys(o).forEach((t=>{const e=o[t];A9(e,[Jtt.scales[e.type],Jtt.scale])})),o}(t,e)}function hit(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const dit=new Map,pit=new Set;function fit(t,e){let n=dit.get(t);return n||(n=e(),dit.set(t,n),pit.add(n)),n}const mit=(t,e,n)=>{const r=$9(e,n);void 0!==r&&t.add(r)};class git{constructor(t){this._config=function(t){return(t=t||{}).data=hit(t.data),uit(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=hit(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),uit(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return fit(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return fit(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return fit(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return fit(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const n=this._scopeCache;let r=n.get(t);return r&&!e||(r=new Map,n.set(t,r)),r}getOptionScopes(t,e,n){const{options:r,type:i}=this,s=this._cachedScopes(t,n),o=s.get(e);if(o)return o;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>mit(a,t,e)))),e.forEach((t=>mit(a,r,t))),e.forEach((t=>mit(a,Xtt[i]||{},t))),e.forEach((t=>mit(a,Jtt,t))),e.forEach((t=>mit(a,Ytt,t)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),pit.has(e)&&s.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,Xtt[e]||{},Jtt.datasets[e]||{},{type:e},Jtt,Ytt]}resolveNamedOptions(t,e,n,r=[""]){const i={$shared:!0},{resolver:s,subPrefixes:o}=yit(this._resolverCache,t,r);let a=s;if(function(t,e){const{isScriptable:n,isIndexable:r}=Ret(t);for(const i of e){const e=n(i),s=r(i),o=(s||e)&&t[i];if(e&&(P9(o)||bit(o))||s&&g9(o))return!0}return!1}(s,e)){i.$shared=!1;a=$et(s,n=P9(n)?n():n,this.createResolver(t,n,o))}for(const t of e)i[t]=a[t];return i}createResolver(t,e,n=[""],r){const{resolver:i}=yit(this._resolverCache,t,n);return y9(e)?$et(i,e,void 0,r):i}}function yit(t,e,n){let r=t.get(e);r||(r=new Map,t.set(e,r));const i=n.join();let s=r.get(i);if(!s){s={resolver:Iet(e,n),subPrefixes:n.filter((t=>!t.toLowerCase().includes("hover")))},r.set(i,s)}return s}const bit=t=>y9(t)&&Object.getOwnPropertyNames(t).reduce(((e,n)=>e||P9(t[n])),!1);const vit=["top","bottom","left","right","chartArea"];function xit(t,e){return"top"===t||"bottom"===t||-1===vit.indexOf(t)&&"x"===e}function wit(t,e){return function(n,r){return n[t]===r[t]?n[e]-r[e]:n[t]-r[t]}}function _it(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),_9(n&&n.onComplete,[t],e)}function Sit(t){const e=t.chart,n=e.options.animation;_9(n&&n.onProgress,[t],e)}function kit(t){return Jet()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const Tit={},Eit=t=>{const e=kit(t);return Object.values(Tit).filter((t=>t.canvas===e)).pop()};function Mit(t,e,n){const r=Object.keys(t);for(const i of r){const r=+i;if(r>=e){const s=t[i];delete t[i],(n>0||r>e)&&(t[r+n]=s)}}}class Cit{constructor(t,e){const n=this.config=new git(e),r=kit(t),i=Eit(r);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const s=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!Jet()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Nrt:Wrt}(r)),this.platform.updateConfig(n);const o=this.platform.acquireContext(r,s.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=f9(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new sit,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(...r){return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}((t=>this.update(t)),s.resizeDelay||0),this._dataChanges=[],Tit[this.id]=this,o&&a?(Tnt.listen(this,"complete",_it),Tnt.listen(this,"progress",Sit),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:r,_aspectRatio:i}=this;return m9(t)?e&&i?i:r?n/r:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ant(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return net(this.canvas,this.ctx),this}stop(){return Tnt.stop(this),this}resize(t,e){Tnt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,r=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(r,t,e,i),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,ant(this,o,!0)&&(this.notifyPlugins("resize",{size:s}),_9(n.onResize,[this,s],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){S9(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,r=Object.keys(n).reduce(((t,e)=>(t[e]=!1,t)),{});let i=[];e&&(i=i.concat(Object.keys(e).map((t=>{const n=e[t],r=cit(t,n),i="r"===r,s="x"===r;return{options:n,dposition:i?"chartArea":s?"bottom":"left",dtype:i?"radialLinear":s?"category":"linear"}})))),S9(i,(e=>{const i=e.options,s=i.id,o=cit(s,i),a=x9(i.type,e.dtype);void 0!==i.position&&xit(i.position,o)===xit(e.dposition)||(i.position=e.dposition),r[s]=!0;let l=null;if(s in n&&n[s].type===a)l=n[s];else{l=new(iit.getScale(a))({id:s,type:a,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(i,t)})),S9(r,((t,e)=>{t||delete n[e]})),S9(n,(t=>{Crt.configure(this,t,t.options),Crt.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort(((t,e)=>t.index-e.index)),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(wit("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,n)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(n)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,r;for(this._removeUnreferencedMetasets(),n=0,r=e.length;n<r;n++){const r=e[n];let i=this.getDatasetMeta(n);const s=r.type||this.config.type;if(i.type&&i.type!==s&&(this._destroyDatasetMeta(n),i=this.getDatasetMeta(n)),i.type=s,i.indexAxis=r.indexAxis||lit(s,this.options),i.order=r.order||0,i.index=n,i.label=""+r.label,i.visible=this.isDatasetVisible(n),i.controller)i.controller.updateIndex(n),i.controller.linkScales();else{const e=iit.getController(s),{datasetElementType:r,dataElementType:o}=Jtt.datasets[s];Object.assign(e.prototype,{dataElementType:iit.getElement(o),datasetElementType:r&&iit.getElement(r)}),i.controller=new e(this,n),t.push(i.controller)}}return this._updateMetasets(),t}_resetElements(){S9(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),n=!r&&-1===i.indexOf(e);e.buildOrUpdateElements(n),s=Math.max(+e.getMaxOverflow(),s)}s=this._minPadding=n.layout.autoPadding?s:0,this._updateLayout(s),r||S9(i,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(wit("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){S9(this.scales,(t=>{Crt.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);L9(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:r,count:i}of e){Mit(t,r,"_removeElements"===n?-i:i)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),r=n(0);for(let t=1;t<e;t++)if(!L9(r,n(t)))return;return Array.from(r).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Crt.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],S9(this.boxes,(t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,P9(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),r={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",r)&&(n.controller._update(e),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Tnt.has(this)?this.attached&&!Tnt.running(this)&&Tnt.start(this):(this.draw(),_it({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let r,i;for(r=0,i=e.length;r<i;++r){const i=e[r];t&&!i.visible||n.push(i)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n=t._clip,r=!n.disabled,i=this.chartArea,s={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(r&&oet(e,{left:!1===n.left?0:i.left-n.left,right:!1===n.right?this.width:i.right+n.right,top:!1===n.top?0:i.top-n.top,bottom:!1===n.bottom?this.height:i.bottom+n.bottom}),t.controller.draw(),r&&aet(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return set(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,r){const i=mrt.modes[e];return"function"==typeof i?i(this,t,n,r):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let r=n.filter((t=>t&&t._dataset===e)).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(r)),r}getContext(){return this.$context||(this.$context=ket(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"==typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const r=n?"show":"hide",i=this.getDatasetMeta(t),s=i.controller._resolveAnimations(void 0,r);O9(e)?(i.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),s.update(i,{visible:n}),this.update((e=>e.datasetIndex===t?r:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Tnt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),net(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Tit[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,r)=>{e.addEventListener(this,n,r),t[n]=r},r=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};S9(this.options.events,(t=>n(t,r)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,r)=>{e.addEventListener(this,n,r),t[n]=r},r=(n,r)=>{t[n]&&(e.removeEventListener(this,n,r),delete t[n])},i=(t,e)=>{this.canvas&&this.resize(t,e)};let s;const o=()=>{r("attach",o),this.attached=!0,this.resize(),n("resize",i),n("detach",s)};s=()=>{this.attached=!1,r("resize",i),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():s()}unbindEvents(){S9(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},S9(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const r=n?"set":"remove";let i,s,o,a;for("dataset"===e&&(i=this.getDatasetMeta(t[0].datasetIndex),i.controller["_"+r+"DatasetHoverStyle"]()),o=0,a=t.length;o<a;++o){s=t[o];const e=s&&this.getDatasetMeta(s.datasetIndex).controller;e&&e[r+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map((({datasetIndex:t,index:e})=>{const n=this.getDatasetMeta(t);if(!n)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:n.data[e],index:e}}));!k9(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}_updateHoverStyles(t,e,n){const r=this.options.hover,i=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),s=i(e,t),o=n?t:i(t,e);s.length&&this.updateHoverStyle(s,r.mode,!1),o.length&&r.mode&&this.updateHoverStyle(o,r.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},r=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,r))return;const i=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,r),(i||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:r=[],options:i}=this,s=e,o=this._getActiveElements(t,r,n,s),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,n,r){return n&&"mouseout"!==t.type?r?e:t:null}(t,this._lastEvent,n,a);n&&(this._lastEvent=null,_9(i.onHover,[t,o,this],this),a&&_9(i.onClick,[t,o,this],this));const c=!k9(o,r);return(c||e)&&(this._active=o,this._updateHoverStyles(o,r,e)),this._lastEvent=l,c}_getActiveElements(t,e,n,r){if("mouseout"===t.type)return[];if(!n)return e;const i=this.options.hover;return this.getElementsAtEventForMode(t,i.mode,i,r)}}const Ait=()=>S9(Cit.instances,(t=>t._plugins.invalidate())),Nit=!0;function Iit(t,e,n){const{startAngle:r,pixelMargin:i,x:s,y:o,outerRadius:a,innerRadius:l}=e;let c=i/a;t.beginPath(),t.arc(s,o,a,r-c,n+c),l>i?(c=i/l,t.arc(s,o,l,n+c,r-c,!0)):t.arc(s,o,i,n+V9,r-V9),t.closePath(),t.clip()}function $it(t,e,n,r){const i=yet(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const s=(n-e)/2,o=Math.min(s,r*e/2),a=t=>{const e=(n-Math.min(s,t))*r/2;return stt(t,0,Math.min(s,e))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:stt(i.innerStart,0,o),innerEnd:stt(i.innerEnd,0,o)}}function Rit(t,e,n,r){return{x:n+t*Math.cos(e),y:r+t*Math.sin(e)}}function Oit(t,e,n,r,i){const{x:s,y:o,startAngle:a,pixelMargin:l,innerRadius:c}=e,u=Math.max(e.outerRadius+r+n-l,0),h=c>0?c+r+n+l:0;let d=0;const p=i-a;if(r){const t=((c>0?c-r:0)+(u>0?u-r:0))/2;d=(p-(0!==t?p*t/(t+r):p))/2}const f=(p-Math.max(.001,p*u-n/D9)/u)/2,m=a+f+d,g=i-f-d,{outerStart:y,outerEnd:b,innerStart:v,innerEnd:x}=$it(e,h,u,g-m),w=u-y,_=u-b,S=m+y/w,k=g-b/_,T=h+v,E=h+x,M=m+v/T,C=g-x/E;if(t.beginPath(),t.arc(s,o,u,S,k),b>0){const e=Rit(_,k,s,o);t.arc(e.x,e.y,b,k,g+V9)}const A=Rit(E,g,s,o);if(t.lineTo(A.x,A.y),x>0){const e=Rit(E,C,s,o);t.arc(e.x,e.y,x,g+V9,C+Math.PI)}if(t.arc(s,o,h,g-x/h,m+v/h,!0),v>0){const e=Rit(T,M,s,o);t.arc(e.x,e.y,v,M+Math.PI,m-V9)}const N=Rit(w,m,s,o);if(t.lineTo(N.x,N.y),y>0){const e=Rit(w,S,s,o);t.arc(e.x,e.y,y,m-V9,S)}t.closePath()}function Pit(t,e,n,r,i){const{options:s}=e,{borderWidth:o,borderJoinStyle:a}=s,l="inner"===s.borderAlign;o&&(l?(t.lineWidth=2*o,t.lineJoin=a||"round"):(t.lineWidth=o,t.lineJoin=a||"bevel"),e.fullCircles&&function(t,e,n){const{x:r,y:i,startAngle:s,pixelMargin:o,fullCircles:a}=e,l=Math.max(e.outerRadius-o,0),c=e.innerRadius+o;let u;for(n&&Iit(t,e,s+F9),t.beginPath(),t.arc(r,i,c,s+F9,s,!0),u=0;u<a;++u)t.stroke();for(t.beginPath(),t.arc(r,i,l,s,s+F9),u=0;u<a;++u)t.stroke()}(t,e,l),l&&Iit(t,e,i),Oit(t,e,n,r,i),t.stroke())}Object.defineProperties(Cit,{defaults:{enumerable:Nit,value:Jtt},instances:{enumerable:Nit,value:Tit},overrides:{enumerable:Nit,value:Xtt},registry:{enumerable:Nit,value:iit},version:{enumerable:Nit,value:"3.8.2"},getChart:{enumerable:Nit,value:Eit},register:{enumerable:Nit,value:(...t)=>{iit.add(...t),Ait()}},unregister:{enumerable:Nit,value:(...t)=>{iit.remove(...t),Ait()}}});class Lit extends Hrt{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const r=this.getProps(["x","y"],n),{angle:i,distance:s}=ttt(r,{x:t,y:e}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=this.options.spacing/2,d=x9(u,a-o)>=F9||itt(i,o,a),p=ott(s,l+h,c+h);return d&&p}getCenterPoint(t){const{x:e,y:n,startAngle:r,endAngle:i,innerRadius:s,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:a,spacing:l}=this.options,c=(r+i)/2,u=(s+o+l+a)/2;return{x:e+Math.cos(c)*u,y:n+Math.sin(c)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,r=(e.offset||0)/2,i=(e.spacing||0)/2;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>F9?Math.floor(n/F9):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();let s=0;if(r){s=r/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*s,Math.sin(e)*s),this.circumference>=D9&&(s=r)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const o=function(t,e,n,r){const{fullCircles:i,startAngle:s,circumference:o}=e;let a=e.endAngle;if(i){Oit(t,e,n,r,s+F9);for(let e=0;e<i;++e)t.fill();isNaN(o)||(a=s+o%F9,o%F9==0&&(a+=F9))}return Oit(t,e,n,r,a),t.fill(),a}(t,this,s,i);Pit(t,this,s,i,o),t.restore()}}function Dit(t,e,n=e){t.lineCap=x9(n.borderCapStyle,e.borderCapStyle),t.setLineDash(x9(n.borderDash,e.borderDash)),t.lineDashOffset=x9(n.borderDashOffset,e.borderDashOffset),t.lineJoin=x9(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=x9(n.borderWidth,e.borderWidth),t.strokeStyle=x9(n.borderColor,e.borderColor)}function Fit(t,e,n){t.lineTo(n.x,n.y)}function zit(t,e,n={}){const r=t.length,{start:i=0,end:s=r-1}=n,{start:o,end:a}=e,l=Math.max(i,o),c=Math.min(s,a),u=i<o&&s<o||i>a&&s>a;return{count:r,start:l,loop:e.loop,ilen:c<l&&!u?r+c-l:c-l}}function Bit(t,e,n,r){const{points:i,options:s}=e,{count:o,start:a,loop:l,ilen:c}=zit(i,n,r),u=function(t){return t.stepped?cet:t.tension||"monotone"===t.cubicInterpolationMode?uet:Fit}(s);let h,d,p,{move:f=!0,reverse:m}=r||{};for(h=0;h<=c;++h)d=i[(a+(m?c-h:h))%o],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):u(t,p,d,m,s.stepped),p=d);return l&&(d=i[(a+(m?c:0))%o],u(t,p,d,m,s.stepped)),!!l}function Uit(t,e,n,r){const i=e.points,{count:s,start:o,ilen:a}=zit(i,n,r),{move:l=!0,reverse:c}=r||{};let u,h,d,p,f,m,g=0,y=0;const b=t=>(o+(c?a-t:t))%s,v=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(h=i[b(0)],t.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=i[b(u)],h.skip)continue;const e=h.x,n=h.y,r=0|e;r===d?(n<p?p=n:n>f&&(f=n),g=(y*g+e)/++y):(v(),t.lineTo(e,n),d=r,y=0,p=f=n),m=n}v()}function Vit(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!(t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||n)?Uit:Bit}Lit.id="arc",Lit.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},Lit.defaultRoutes={backgroundColor:"backgroundColor"};const jit="function"==typeof Path2D;function Wit(t,e,n,r){jit&&!e.options.segment?function(t,e,n,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,r)&&i.closePath()),Dit(t,e.options),t.stroke(i)}(t,e,n,r):function(t,e,n,r){const{segments:i,options:s}=e,o=Vit(e);for(const a of i)Dit(t,s,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+r-1})&&t.closePath(),t.stroke()}(t,e,n,r)}class Hit extends Hrt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const r=n.spanGaps?this._loop:this._fullLoop;Zet(this._points,n,t,r,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,r=t.options.spanGaps,i=n.length;if(!i)return[];const s=!!t._loop,{start:o,end:a}=function(t,e,n,r){let i=0,s=e-1;if(n&&!r)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(s+=i);s>i&&t[s%e].skip;)s--;return s%=e,{start:i,end:s}}(n,i,s,r);return _nt(t,!0===r?[{start:o,end:a,loop:s}]:function(t,e,n,r){const i=t.length,s=[];let o,a=e,l=t[e];for(o=e+1;o<=n;++o){const n=t[o%i];n.skip||n.stop?l.skip||(r=!1,s.push({start:e%i,end:(o-1)%i,loop:r}),e=a=n.stop?o:null):(a=o,l.skip&&(e=o)),l=n}return null!==a&&s.push({start:e%i,end:a%i,loop:r}),s}(n,o,a<o?a+i:a,!!t._fullLoop&&0===o&&a===i-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,r=t[e],i=this.points,s=wnt(this,{property:e,start:r,end:r});if(!s.length)return;const o=[],a=function(t){return t.stepped?hnt:t.tension||"monotone"===t.cubicInterpolationMode?dnt:unt}(n);let l,c;for(l=0,c=s.length;l<c;++l){const{start:c,end:u}=s[l],h=i[c],d=i[u];if(h===d){o.push(h);continue}const p=a(h,d,Math.abs((r-h[e])/(d[e]-h[e])),n.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return Vit(this)(t,this,e,n)}path(t,e,n){const r=this.segments,i=Vit(this);let s=this._loop;e=e||0,n=n||this.points.length-e;for(const o of r)s&=i(t,this,o,{start:e,end:e+n-1});return!!s}draw(t,e,n,r){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(t.save(),Wit(t,this,n,r),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Git(t,e,n,r){const i=t.options,{[n]:s}=t.getProps([n],r);return Math.abs(e-s)<i.radius+i.hitRadius}Hit.id="line",Hit.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},Hit.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},Hit.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class qit extends Hrt{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const r=this.options,{x:i,y:s}=this.getProps(["x","y"],n);return Math.pow(t-i,2)+Math.pow(e-s,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(t,e){return Git(this,t,"x",e)}inYRange(t,e){return Git(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!set(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,ret(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Xit(t,e){const{x:n,y:r,base:i,width:s,height:o}=t.getProps(["x","y","base","width","height"],e);let a,l,c,u,h;return t.horizontal?(h=o/2,a=Math.min(n,i),l=Math.max(n,i),c=r-h,u=r+h):(h=s/2,a=n-h,l=n+h,c=Math.min(r,i),u=Math.max(r,i)),{left:a,top:c,right:l,bottom:u}}function Yit(t,e,n,r){return t?0:stt(e,n,r)}function Kit(t){const e=Xit(t),n=e.right-e.left,r=e.bottom-e.top,i=function(t,e,n){const r=t.options.borderWidth,i=t.borderSkipped,s=bet(r);return{t:Yit(i.top,s.top,0,n),r:Yit(i.right,s.right,0,e),b:Yit(i.bottom,s.bottom,0,n),l:Yit(i.left,s.left,0,e)}}(t,n/2,r/2),s=function(t,e,n){const{enableBorderRadius:r}=t.getProps(["enableBorderRadius"]),i=t.options.borderRadius,s=vet(i),o=Math.min(e,n),a=t.borderSkipped,l=r||y9(i);return{topLeft:Yit(!l||a.top||a.left,s.topLeft,0,o),topRight:Yit(!l||a.top||a.right,s.topRight,0,o),bottomLeft:Yit(!l||a.bottom||a.left,s.bottomLeft,0,o),bottomRight:Yit(!l||a.bottom||a.right,s.bottomRight,0,o)}}(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r,radius:s},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,s.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(i.b,i.r))}}}}function Zit(t,e,n,r){const i=null===e,s=null===n,o=t&&!(i&&s)&&Xit(t,r);return o&&(i||ott(e,o.left,o.right))&&(s||ott(n,o.top,o.bottom))}function Jit(t,e){t.rect(e.x,e.y,e.w,e.h)}function Qit(t,e,n={}){const r=t.x!==n.x?-e:0,i=t.y!==n.y?-e:0,s=(t.x+t.w!==n.x+n.w?e:0)-r,o=(t.y+t.h!==n.y+n.h?e:0)-i;return{x:t.x+r,y:t.y+i,w:t.w+s,h:t.h+o,radius:t.radius}}qit.id="point",qit.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},qit.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class tst extends Hrt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:r}}=this,{inner:i,outer:s}=Kit(this),o=(a=s.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?pet:Jit;var a;t.save(),s.w===i.w&&s.h===i.h||(t.beginPath(),o(t,Qit(s,e,i)),t.clip(),o(t,Qit(i,-e,s)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,Qit(i,e)),t.fillStyle=r,t.fill(),t.restore()}inRange(t,e,n){return Zit(this,t,e,n)}inXRange(t,e){return Zit(this,t,null,e)}inYRange(t,e){return Zit(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:r,horizontal:i}=this.getProps(["x","y","base","horizontal"],t);return{x:i?(e+r)/2:e,y:i?n:(n+r)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}function est(t,e,n,r){if(r)return;let i=e[t],s=n[t];return"angle"===t&&(i=rtt(i),s=rtt(s)),{property:t,start:i,end:s}}function nst(t,e,n){for(;e>t;e--){const t=n[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function rst(t,e,n,r){return t&&e?r(t[n],e[n]):t?t[n]:e?e[n]:0}function ist(t,e){let n=[],r=!1;return g9(t)?(r=!0,n=t):n=function(t,e){const{x:n=null,y:r=null}=t||{},i=e.points,s=[];return e.segments.forEach((({start:t,end:e})=>{e=nst(t,e,i);const o=i[t],a=i[e];null!==r?(s.push({x:o.x,y:r}),s.push({x:a.x,y:r})):null!==n&&(s.push({x:n,y:o.y}),s.push({x:n,y:a.y}))})),s}(t,e),n.length?new Hit({points:n,options:{tension:0},_loop:r,_fullLoop:r}):null}function sst(t){return t&&!1!==t.fill}function ost(t,e,n){let r=t[e].fill;const i=[e];let s;if(!n)return r;for(;!1!==r&&-1===i.indexOf(r);){if(!b9(r))return r;if(s=t[r],!s)return!1;if(s.visible)return r;i.push(r),r=s.fill}return!1}function ast(t,e,n){const r=function(t){const e=t.options,n=e.fill;let r=x9(n&&n.target,n);void 0===r&&(r=!!e.backgroundColor);if(!1===r||null===r)return!1;if(!0===r)return"origin";return r}(t);if(y9(r))return!isNaN(r.value)&&r;let i=parseFloat(r);return b9(i)&&Math.floor(i)===i?function(t,e,n,r){"-"!==t&&"+"!==t||(n=e+n);if(n===e||n<0||n>=r)return!1;return n}(r[0],e,i,n):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function lst(t,e,n){const r=[];for(let i=0;i<n.length;i++){const s=n[i],{first:o,last:a,point:l}=cst(s,e,"x");if(!(!l||o&&a))if(o)r.unshift(l);else if(t.push(l),!a)break}t.push(...r)}function cst(t,e,n){const r=t.interpolate(e,n);if(!r)return{};const i=r[n],s=t.segments,o=t.points;let a=!1,l=!1;for(let t=0;t<s.length;t++){const e=s[t],r=o[e.start][n],c=o[e.end][n];if(ott(i,r,c)){a=i===r,l=i===c;break}}return{first:a,last:l,point:r}}tst.id="bar",tst.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},tst.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class ust{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,n){const{x:r,y:i,radius:s}=this;return e=e||{start:0,end:F9},t.arc(r,i,s,e.end,e.start,!0),!n.bounds}interpolate(t){const{x:e,y:n,radius:r}=this,i=t.angle;return{x:e+Math.cos(i)*r,y:n+Math.sin(i)*r,angle:i}}}function hst(t){const{chart:e,fill:n,line:r}=t;if(b9(n))return function(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}(e,n);if("stack"===n)return function(t){const{scale:e,index:n,line:r}=t,i=[],s=r.segments,o=r.points,a=function(t,e){const n=[],r=t.getMatchingVisibleMetas("line");for(let t=0;t<r.length;t++){const i=r[t];if(i.index===e)break;i.hidden||n.unshift(i.dataset)}return n}(e,n);a.push(ist({x:null,y:e.bottom},r));for(let t=0;t<s.length;t++){const e=s[t];for(let t=e.start;t<=e.end;t++)lst(i,o[t],a)}return new Hit({points:i,options:{}})}(t);if("shape"===n)return!0;const i=function(t){if((t.scale||{}).getPointPositionForValue)return function(t){const{scale:e,fill:n}=t,r=e.options,i=e.getLabels().length,s=r.reverse?e.max:e.min,o=function(t,e,n){let r;return r="start"===t?n:"end"===t?e.options.reverse?e.min:e.max:y9(t)?t.value:e.getBaseValue(),r}(n,e,s),a=[];if(r.grid.circular){const t=e.getPointPositionForValue(0,s);return new ust({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let t=0;t<i;++t)a.push(e.getPointPositionForValue(t,o));return a}(t);return function(t){const{scale:e={},fill:n}=t,r=function(t,e){let n=null;return"start"===t?n=e.bottom:"end"===t?n=e.top:y9(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}(n,e);if(b9(r)){const t=e.isHorizontal();return{x:t?r:null,y:t?null:r}}return null}(t)}(t);return i instanceof ust?i:ist(i,r)}function dst(t,e,n){const r=hst(e),{line:i,scale:s,axis:o}=e,a=i.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};r&&i.points.length&&(oet(t,n),function(t,e){const{line:n,target:r,above:i,below:s,area:o,scale:a}=e,l=n._loop?"angle":e.axis;t.save(),"x"===l&&s!==i&&(pst(t,r,o.top),fst(t,{line:n,target:r,color:i,scale:a,property:l}),t.restore(),t.save(),pst(t,r,o.bottom));fst(t,{line:n,target:r,color:s,scale:a,property:l}),t.restore()}(t,{line:i,target:r,above:u,below:h,area:n,scale:s,axis:o}),aet(t))}function pst(t,e,n){const{segments:r,points:i}=e;let s=!0,o=!1;t.beginPath();for(const a of r){const{start:r,end:l}=a,c=i[r],u=i[nst(r,l,i)];s?(t.moveTo(c.x,c.y),s=!1):(t.lineTo(c.x,n),t.lineTo(c.x,c.y)),o=!!e.pathSegment(t,a,{move:o}),o?t.closePath():t.lineTo(u.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function fst(t,e){const{line:n,target:r,property:i,color:s,scale:o}=e,a=function(t,e,n){const r=t.segments,i=t.points,s=e.points,o=[];for(const t of r){let{start:r,end:a}=t;a=nst(r,a,i);const l=est(n,i[r],i[a],t.loop);if(!e.segments){o.push({source:t,target:l,start:i[r],end:i[a]});continue}const c=wnt(e,l);for(const e of c){const r=est(n,s[e.start],s[e.end],e.loop),a=xnt(t,i,r);for(const t of a)o.push({source:t,target:e,start:{[n]:rst(l,r,"start",Math.max)},end:{[n]:rst(l,r,"end",Math.min)}})}}return o}(n,r,i);for(const{source:e,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=s}={}}=e,h=!0!==r;t.save(),t.fillStyle=a,mst(t,o,h&&est(i,c,u)),t.beginPath();const d=!!n.pathSegment(t,e);let p;if(h){d?t.closePath():gst(t,r,u,i);const e=!!r.pathSegment(t,l,{move:d,reverse:!0});p=d&&e,p||gst(t,r,c,i)}t.closePath(),t.fill(p?"evenodd":"nonzero"),t.restore()}}function mst(t,e,n){const{top:r,bottom:i}=e.chart.chartArea,{property:s,start:o,end:a}=n||{};"x"===s&&(t.beginPath(),t.rect(o,r,a-o,i-r),t.clip())}function gst(t,e,n,r){const i=e.interpolate(n,r);i&&t.lineTo(i.x,i.y)}var yst={id:"filler",afterDatasetsUpdate(t,e,n){const r=(t.data.datasets||[]).length,i=[];let s,o,a,l;for(o=0;o<r;++o)s=t.getDatasetMeta(o),a=s.dataset,l=null,a&&a.options&&a instanceof Hit&&(l={visible:t.isDatasetVisible(o),index:o,fill:ast(a,o,r),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=l,i.push(l);for(o=0;o<r;++o)l=i[o],l&&!1!==l.fill&&(l.fill=ost(i,o,n.propagate))},beforeDraw(t,e,n){const r="beforeDraw"===n.drawTime,i=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let e=i.length-1;e>=0;--e){const n=i[e].$filler;n&&(n.line.updateControlPoints(s,n.axis),r&&n.fill&&dst(t.ctx,n,s))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const r=t.getSortedVisibleDatasetMetas();for(let e=r.length-1;e>=0;--e){const n=r[e].$filler;sst(n)&&dst(t.ctx,n,t.chartArea)}},beforeDatasetDraw(t,e,n){const r=e.meta.$filler;sst(r)&&"beforeDatasetDraw"===n.drawTime&&dst(t.ctx,r,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const bst=(t,e)=>{let{boxHeight:n=e,boxWidth:r=e}=t;return t.usePointStyle&&(n=Math.min(n,e),r=t.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(e,n)}};class vst extends Hrt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=_9(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,n)=>t.sort(e,n,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,r=wet(n.font),i=r.size,s=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=bst(n,i);let l,c;e.font=r.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(s,i,o,a)+10):(c=this.maxHeight,l=this._fitCols(s,i,o,a)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,r){const{ctx:i,maxWidth:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=r+o;let u=t;i.textAlign="left",i.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((t,p)=>{const f=n+e/2+i.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>s)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:r},l[l.length-1]+=f+o})),u}_fitCols(t,e,n,r){const{ctx:i,maxHeight:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=s-t;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((t,s)=>{const m=n+e/2+i.measureText(t.text).width;s>0&&d+r+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),a[s]={left:p,top:d,col:f,width:m,height:r},h=Math.max(h,m),d+=r+o})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:r},rtl:i}}=this,s=mnt(i,this.left,this.width);if(this.isHorizontal()){let i=0,o=d9(n,this.left+r,this.right-this.lineWidths[i]);for(const a of e)i!==a.row&&(i=a.row,o=d9(n,this.left+r,this.right-this.lineWidths[i])),a.top+=this.top+t+r,a.left=s.leftForLtr(s.x(o),a.width),o+=a.width+r}else{let i=0,o=d9(n,this.top+t+r,this.bottom-this.columnSizes[i].height);for(const a of e)a.col!==i&&(i=a.col,o=d9(n,this.top+t+r,this.bottom-this.columnSizes[i].height)),a.top=o,a.left+=this.left+r,a.left=s.leftForLtr(s.x(a.left),a.width),o+=a.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;oet(t,this),this._draw(),aet(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:r}=this,{align:i,labels:s}=t,o=Jtt.color,a=mnt(t.rtl,this.left,this.width),l=wet(s.font),{color:c,padding:u}=s,h=l.size,d=h/2;let p;this.drawTitle(),r.textAlign=a.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=l.string;const{boxWidth:f,boxHeight:m,itemHeight:g}=bst(s,h),y=this.isHorizontal(),b=this._computeTitleHeight();p=y?{x:d9(i,this.left+u,this.right-n[0]),y:this.top+u+b,line:0}:{x:this.left+u,y:d9(i,this.top+b+u,this.bottom-e[0].height),line:0},gnt(this.ctx,t.textDirection);const v=g+u;this.legendItems.forEach(((x,w)=>{r.strokeStyle=x.fontColor||c,r.fillStyle=x.fontColor||c;const _=r.measureText(x.text).width,S=a.textAlign(x.textAlign||(x.textAlign=s.textAlign)),k=f+d+_;let T=p.x,E=p.y;a.setWidth(this.width),y?w>0&&T+k+u>this.right&&(E=p.y+=v,p.line++,T=p.x=d9(i,this.left+u,this.right-n[p.line])):w>0&&E+v>this.bottom&&(T=p.x=T+e[p.line].width+u,p.line++,E=p.y=d9(i,this.top+b+u,this.bottom-e[p.line].height));!function(t,e,n){if(isNaN(f)||f<=0||isNaN(m)||m<0)return;r.save();const i=x9(n.lineWidth,1);if(r.fillStyle=x9(n.fillStyle,o),r.lineCap=x9(n.lineCap,"butt"),r.lineDashOffset=x9(n.lineDashOffset,0),r.lineJoin=x9(n.lineJoin,"miter"),r.lineWidth=i,r.strokeStyle=x9(n.strokeStyle,o),r.setLineDash(x9(n.lineDash,[])),s.usePointStyle){const s={radius:m*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:i},o=a.xPlus(t,f/2);iet(r,s,o,e+d,f)}else{const s=e+Math.max((h-m)/2,0),o=a.leftForLtr(t,f),l=vet(n.borderRadius);r.beginPath(),Object.values(l).some((t=>0!==t))?pet(r,{x:o,y:s,w:f,h:m,radius:l}):r.rect(o,s,f,m),r.fill(),0!==i&&r.stroke()}r.restore()}(a.x(T),E,x),T=((t,e,n,r)=>t===(r?"left":"right")?n:"center"===t?(e+n)/2:e)(S,T+f+d,y?T+k:this.right,t.rtl),function(t,e,n){het(r,n.text,t,e+g/2,l,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(T),E,x),y?p.x+=k+u:p.y+=v})),ynt(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=wet(e.font),r=xet(e.padding);if(!e.display)return;const i=mnt(t.rtl,this.left,this.width),s=this.ctx,o=e.position,a=n.size/2,l=r.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=d9(t.align,u,this.right-h);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);c=l+d9(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=d9(o,u,u+h);s.textAlign=i.textAlign(h9(o)),s.textBaseline="middle",s.strokeStyle=e.color,s.fillStyle=e.color,s.font=n.string,het(s,e.text,d,c,n)}_computeTitleHeight(){const t=this.options.title,e=wet(t.font),n=xet(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,r,i;if(ott(t,this.left,this.right)&&ott(e,this.top,this.bottom))for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(r=i[n],ott(t,r.left,r.left+r.width)&&ott(e,r.top,r.top+r.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const s=this._hoveredItem,o=(i=n,null!==(r=s)&&null!==i&&r.datasetIndex===i.datasetIndex&&r.index===i.index);s&&!o&&_9(e.onLeave,[t,s,this],this),this._hoveredItem=n,n&&!o&&_9(e.onHover,[t,n,this],this)}else n&&_9(e.onClick,[t,n,this],this);var r,i}}var xst={id:"legend",_element:vst,start(t,e,n){const r=t.legend=new vst({ctx:t.ctx,options:n,chart:t});Crt.configure(t,r,n),Crt.addBox(t,r)},stop(t){Crt.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const r=t.legend;Crt.configure(t,r,n),r.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const r=e.datasetIndex,i=n.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:i,color:s}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const o=t.controller.getStyle(n?0:void 0),a=xet(o.borderWidth);return{text:e[t.index].label,fillStyle:o.backgroundColor,fontColor:s,hidden:!t.visible,lineCap:o.borderCapStyle,lineDash:o.borderDash,lineDashOffset:o.borderDashOffset,lineJoin:o.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:o.borderColor,pointStyle:r||o.pointStyle,rotation:o.rotation,textAlign:i||o.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class wst extends Hrt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const r=g9(n.text)?n.text.length:1;this._padding=xet(n.padding);const i=r*wet(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:r,right:i,options:s}=this,o=s.align;let a,l,c,u=0;return this.isHorizontal()?(l=d9(o,n,i),c=e+t,a=i-n):("left"===s.position?(l=n+t,c=d9(o,r,e),u=-.5*D9):(l=i-t,c=d9(o,e,r),u=.5*D9),a=r-e),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=wet(e.font),r=n.lineHeight/2+this._padding.top,{titleX:i,titleY:s,maxWidth:o,rotation:a}=this._drawArgs(r);het(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:a,textAlign:h9(e.align),textBaseline:"middle",translation:[i,s]})}}var _st={id:"title",_element:wst,start(t,e,n){!function(t,e){const n=new wst({ctx:t.ctx,options:e,chart:t});Crt.configure(t,n,e),Crt.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;Crt.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const r=t.titleBlock;Crt.configure(t,r,n),r.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Sst={average(t){if(!t.length)return!1;let e,n,r=0,i=0,s=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();r+=t.x,i+=t.y,++s}}return{x:r/s,y:i/s}},nearest(t,e){if(!t.length)return!1;let n,r,i,s=e.x,o=e.y,a=Number.POSITIVE_INFINITY;for(n=0,r=t.length;n<r;++n){const r=t[n].element;if(r&&r.hasValue()){const t=ett(e,r.getCenterPoint());t<a&&(a=t,i=r)}}if(i){const t=i.tooltipPosition();s=t.x,o=t.y}return{x:s,y:o}}};function kst(t,e){return e&&(g9(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Tst(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function Est(t,e){const{element:n,datasetIndex:r,index:i}=e,s=t.getDatasetMeta(r).controller,{label:o,value:a}=s.getLabelAndValue(i);return{chart:t,label:o,parsed:s.getParsed(i),raw:t.data.datasets[r].data[i],formattedValue:a,dataset:s.getDataset(),dataIndex:i,datasetIndex:r,element:n}}function Mst(t,e){const n=t.chart.ctx,{body:r,footer:i,title:s}=t,{boxWidth:o,boxHeight:a}=e,l=wet(e.bodyFont),c=wet(e.titleFont),u=wet(e.footerFont),h=s.length,d=i.length,p=r.length,f=xet(e.padding);let m=f.height,g=0,y=r.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){m+=p*(e.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(y-p)*l.lineHeight+(y-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let b=0;const v=function(t){g=Math.max(g,n.measureText(t).width+b)};return n.save(),n.font=c.string,S9(t.title,v),n.font=l.string,S9(t.beforeBody.concat(t.afterBody),v),b=e.displayColors?o+2+e.boxPadding:0,S9(r,(t=>{S9(t.before,v),S9(t.lines,v),S9(t.after,v)})),b=0,n.font=u.string,S9(t.footer,v),n.restore(),g+=f.width,{width:g,height:m}}function Cst(t,e,n,r){const{x:i,width:s}=n,{width:o,chartArea:{left:a,right:l}}=t;let c="center";return"center"===r?c=i<=(a+l)/2?"left":"right":i<=s/2?c="left":i>=o-s/2&&(c="right"),function(t,e,n,r){const{x:i,width:s}=r,o=n.caretSize+n.caretPadding;return"left"===t&&i+s+o>e.width||"right"===t&&i-s-o<0||void 0}(c,t,e,n)&&(c="center"),c}function Ast(t,e,n){const r=n.yAlign||e.yAlign||function(t,e){const{y:n,height:r}=e;return n<r/2?"top":n>t.height-r/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||Cst(t,e,n,r),yAlign:r}}function Nst(t,e,n,r){const{caretSize:i,caretPadding:s,cornerRadius:o}=t,{xAlign:a,yAlign:l}=n,c=i+s,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=vet(o);let f=function(t,e){let{x:n,width:r}=t;return"right"===e?n-=r:"center"===e&&(n-=r/2),n}(e,a);const m=function(t,e,n){let{y:r,height:i}=t;return"top"===e?r+=n:r-="bottom"===e?i+n:i/2,r}(e,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+i:"right"===a&&(f+=Math.max(h,p)+i),{x:stt(f,0,r.width-e.width),y:stt(m,0,r.height-e.height)}}function Ist(t,e,n){const r=xet(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-r.right:t.x+r.left}function $st(t){return kst([],Tst(t))}function Rst(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}class Ost extends Hrt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),r=n.enabled&&e.options.animation&&n.animations,i=new Nnt(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,n=this._tooltipItems,ket(t,{tooltip:e,tooltipItems:n,type:"tooltip"})));var t,e,n}getTitle(t,e){const{callbacks:n}=e,r=n.beforeTitle.apply(this,[t]),i=n.title.apply(this,[t]),s=n.afterTitle.apply(this,[t]);let o=[];return o=kst(o,Tst(r)),o=kst(o,Tst(i)),o=kst(o,Tst(s)),o}getBeforeBody(t,e){return $st(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:n}=e,r=[];return S9(t,(t=>{const e={before:[],lines:[],after:[]},i=Rst(n,t);kst(e.before,Tst(i.beforeLabel.call(this,t))),kst(e.lines,i.label.call(this,t)),kst(e.after,Tst(i.afterLabel.call(this,t))),r.push(e)})),r}getAfterBody(t,e){return $st(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:n}=e,r=n.beforeFooter.apply(this,[t]),i=n.footer.apply(this,[t]),s=n.afterFooter.apply(this,[t]);let o=[];return o=kst(o,Tst(r)),o=kst(o,Tst(i)),o=kst(o,Tst(s)),o}_createItems(t){const e=this._active,n=this.chart.data,r=[],i=[],s=[];let o,a,l=[];for(o=0,a=e.length;o<a;++o)l.push(Est(this.chart,e[o]));return t.filter&&(l=l.filter(((e,r,i)=>t.filter(e,r,i,n)))),t.itemSort&&(l=l.sort(((e,r)=>t.itemSort(e,r,n)))),S9(l,(e=>{const n=Rst(t.callbacks,e);r.push(n.labelColor.call(this,e)),i.push(n.labelPointStyle.call(this,e)),s.push(n.labelTextColor.call(this,e))})),this.labelColors=r,this.labelPointStyles=i,this.labelTextColors=s,this.dataPoints=l,l}update(t,e){const n=this.options.setContext(this.getContext()),r=this._active;let i,s=[];if(r.length){const t=Sst[n.position].call(this,r,this._eventPosition);s=this._createItems(n),this.title=this.getTitle(s,n),this.beforeBody=this.getBeforeBody(s,n),this.body=this.getBody(s,n),this.afterBody=this.getAfterBody(s,n),this.footer=this.getFooter(s,n);const e=this._size=Mst(this,n),o=Object.assign({},t,e),a=Ast(this.chart,n,o),l=Nst(n,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,i={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(i={opacity:0});this._tooltipItems=s,this.$context=void 0,i&&this._resolveAnimations().update(this,i),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,r){const i=this.getCaretPosition(t,n,r);e.lineTo(i.x1,i.y1),e.lineTo(i.x2,i.y2),e.lineTo(i.x3,i.y3)}getCaretPosition(t,e,n){const{xAlign:r,yAlign:i}=this,{caretSize:s,cornerRadius:o}=n,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=vet(o),{x:h,y:d}=t,{width:p,height:f}=e;let m,g,y,b,v,x;return"center"===i?(v=d+f/2,"left"===r?(m=h,g=m-s,b=v+s,x=v-s):(m=h+p,g=m+s,b=v-s,x=v+s),y=m):(g="left"===r?h+Math.max(a,c)+s:"right"===r?h+p-Math.max(l,u)-s:this.caretX,"top"===i?(b=d,v=b-s,m=g-s,y=g+s):(b=d+f,v=b+s,m=g+s,y=g-s),x=b),{x1:m,x2:g,x3:y,y1:b,y2:v,y3:x}}drawTitle(t,e,n){const r=this.title,i=r.length;let s,o,a;if(i){const l=mnt(n.rtl,this.x,this.width);for(t.x=Ist(this,n.titleAlign,n),e.textAlign=l.textAlign(n.titleAlign),e.textBaseline="middle",s=wet(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=s.string,a=0;a<i;++a)e.fillText(r[a],l.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+o,a+1===i&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,r,i){const s=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:a,boxWidth:l,boxPadding:c}=i,u=wet(i.bodyFont),h=Ist(this,"left",i),d=r.x(h),p=a<u.lineHeight?(u.lineHeight-a)/2:0,f=e.y+p;if(i.usePointStyle){const e={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=r.leftForLtr(d,l)+l/2,c=f+a/2;t.strokeStyle=i.multiKeyBackground,t.fillStyle=i.multiKeyBackground,ret(t,e,n,c),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,ret(t,e,n,c)}else{t.lineWidth=y9(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const e=r.leftForLtr(d,l-c),n=r.leftForLtr(r.xPlus(d,1),l-c-2),o=vet(s.borderRadius);Object.values(o).some((t=>0!==t))?(t.beginPath(),t.fillStyle=i.multiKeyBackground,pet(t,{x:e,y:f,w:l,h:a,radius:o}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),pet(t,{x:n,y:f+1,w:l-2,h:a-2,radius:o}),t.fill()):(t.fillStyle=i.multiKeyBackground,t.fillRect(e,f,l,a),t.strokeRect(e,f,l,a),t.fillStyle=s.backgroundColor,t.fillRect(n,f+1,l-2,a-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:r}=this,{bodySpacing:i,bodyAlign:s,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=n,u=wet(n.bodyFont);let h=u.lineHeight,d=0;const p=mnt(n.rtl,this.x,this.width),f=function(n){e.fillText(n,p.x(t.x+d),t.y+h/2),t.y+=h+i},m=p.textAlign(s);let g,y,b,v,x,w,_;for(e.textAlign=s,e.textBaseline="middle",e.font=u.string,t.x=Ist(this,m,n),e.fillStyle=n.bodyColor,S9(this.beforeBody,f),d=o&&"right"!==m?"center"===s?l/2+c:l+2+c:0,v=0,w=r.length;v<w;++v){for(g=r[v],y=this.labelTextColors[v],e.fillStyle=y,S9(g.before,f),b=g.lines,o&&b.length&&(this._drawColorBox(e,t,v,p,n),h=Math.max(u.lineHeight,a)),x=0,_=b.length;x<_;++x)f(b[x]),h=u.lineHeight;S9(g.after,f)}d=0,h=u.lineHeight,S9(this.afterBody,f),t.y-=i}drawFooter(t,e,n){const r=this.footer,i=r.length;let s,o;if(i){const a=mnt(n.rtl,this.x,this.width);for(t.x=Ist(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=a.textAlign(n.footerAlign),e.textBaseline="middle",s=wet(n.footerFont),e.fillStyle=n.footerColor,e.font=s.string,o=0;o<i;++o)e.fillText(r[o],a.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+n.footerSpacing}}drawBackground(t,e,n,r){const{xAlign:i,yAlign:s}=this,{x:o,y:a}=t,{width:l,height:c}=n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=vet(r.cornerRadius);e.fillStyle=r.backgroundColor,e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.beginPath(),e.moveTo(o+u,a),"top"===s&&this.drawCaret(t,e,n,r),e.lineTo(o+l-h,a),e.quadraticCurveTo(o+l,a,o+l,a+h),"center"===s&&"right"===i&&this.drawCaret(t,e,n,r),e.lineTo(o+l,a+c-p),e.quadraticCurveTo(o+l,a+c,o+l-p,a+c),"bottom"===s&&this.drawCaret(t,e,n,r),e.lineTo(o+d,a+c),e.quadraticCurveTo(o,a+c,o,a+c-d),"center"===s&&"left"===i&&this.drawCaret(t,e,n,r),e.lineTo(o,a+u),e.quadraticCurveTo(o,a,o+u,a),e.closePath(),e.fill(),r.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,r=n&&n.x,i=n&&n.y;if(r||i){const n=Sst[t.position].call(this,this._active,this._eventPosition);if(!n)return;const s=this._size=Mst(this,t),o=Object.assign({},n,this._size),a=Ast(e,t,o),l=Nst(t,o,a,e);r._to===l.x&&i._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=s.width,this.height=s.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const r={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const s=xet(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(i,t,r,e),gnt(t,e.textDirection),i.y+=s.top,this.drawTitle(i,t,e),this.drawBody(i,t,e),this.drawFooter(i,t,e),ynt(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,r=t.map((({datasetIndex:t,index:e})=>{const n=this.chart.getDatasetMeta(t);if(!n)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:n.data[e],index:e}})),i=!k9(n,r),s=this._positionChanged(r,e);(i||s)&&(this._active=r,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,n=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,i=this._active||[],s=this._getActiveElements(t,i,e,n),o=this._positionChanged(s,t),a=e||!k9(s,i)||o;return a&&(this._active=s,(r.enabled||r.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,n,r){const i=this.options;if("mouseout"===t.type)return[];if(!r)return e;const s=this.chart.getElementsAtEventForMode(t,i.mode,i,n);return i.reverse&&s.reverse(),s}_positionChanged(t,e){const{caretX:n,caretY:r,options:i}=this,s=Sst[i.position].call(this,t,e);return!1!==s&&(n!==s.x||r!==s.y)}}Ost.positioners=Sst;var Pst={id:"tooltip",_element:Ost,positioners:Sst,afterInit(t,e,n){n&&(t.tooltip=new Ost({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",n))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:p9,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,r=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return n[e.dataIndex]}return""},afterTitle:p9,beforeBody:p9,beforeLabel:p9,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return m9(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:p9,afterBody:p9,beforeFooter:p9,footer:p9,afterFooter:p9}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function Lst(t,e,n,r){const i=t.indexOf(e);if(-1===i)return((t,e,n,r)=>("string"==typeof e?(n=t.push(e)-1,r.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,r);return i!==t.lastIndexOf(e)?n:i}class Dst extends nit{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:r}of e)t[n]===r&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(m9(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:stt(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:Lst(n,t,x9(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:r}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(r=this.getLabels().length-1)),this.min=n,this.max=r}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,r=[];let i=this.getLabels();i=0===t&&e===i.length-1?i:i.slice(t,e+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let n=t;n<=e;n++)r.push({value:n});return r}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function Fst(t,e){const n=[],{bounds:r,step:i,min:s,max:o,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=t,d=i||1,p=c-1,{min:f,max:m}=e,g=!m9(s),y=!m9(o),b=!m9(l),v=(m-f)/(u+1);let x,w,_,S,k=q9((m-f)/p/d)*d;if(k<1e-14&&!g&&!y)return[{value:f},{value:m}];S=Math.ceil(m/k)-Math.floor(f/k),S>p&&(k=q9(S*k/p/d)*d),m9(a)||(x=Math.pow(10,a),k=Math.ceil(k*x)/x),"ticks"===r?(w=Math.floor(f/k)*k,_=Math.ceil(m/k)*k):(w=f,_=m),g&&y&&i&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-s)/i,k/1e3)?(S=Math.round(Math.min((o-s)/k,c)),k=(o-s)/S,w=s,_=o):b?(w=g?s:w,_=y?o:_,S=l-1,k=(_-w)/S):(S=(_-w)/k,S=Y9(S,Math.round(S),k/1e3)?Math.round(S):Math.ceil(S));const T=Math.max(Q9(k),Q9(w));x=Math.pow(10,m9(a)?T:a),w=Math.round(w*x)/x,_=Math.round(_*x)/x;let E=0;for(g&&(h&&w!==s?(n.push({value:s}),w<s&&E++,Y9(Math.round((w+E*k)*x)/x,s,zst(s,v,t))&&E++):w<s&&E++);E<S;++E)n.push({value:Math.round((w+E*k)*x)/x});return y&&h&&_!==o?n.length&&Y9(n[n.length-1].value,o,zst(o,v,t))?n[n.length-1].value=o:n.push({value:o}):y&&_!==o||n.push({value:_}),n}function zst(t,e,{horizontal:n,minRotation:r}){const i=Z9(r),s=(n?Math.sin(i):Math.cos(i))||.001,o=.75*e*(""+t).length;return Math.min(e/s,o)}Dst.id="category",Dst.defaults={ticks:{callback:Dst.prototype.getLabelForValue}};class Bst extends nit{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return m9(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this;const s=t=>r=e?r:t,o=t=>i=n?i:t;if(t){const t=G9(r),e=G9(i);t<0&&e<0?o(0):t>0&&e>0&&s(0)}if(r===i){let e=1;(i>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*i)),o(i+e),t||s(r-e)}this.min=r,this.max=i}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:r}=t;return r?(e=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const r=Fst({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&K9(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const r=(n-e)/Math.max(t.length-1,1)/2;e-=r,n+=r}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return fnt(t,this.chart.options.locale,this.options.ticks.format)}}class Ust extends Bst{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=b9(t)?t:0,this.max=b9(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=Z9(this.options.ticks.minRotation),r=(t?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,i.lineHeight/r))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function Vst(t){return 1===t/Math.pow(10,Math.floor(H9(t)))}Ust.id="linear",Ust.defaults={ticks:{callback:qrt.formatters.numeric}};class jst extends nit{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=Bst.prototype.parse.apply(this,[t,e]);if(0!==n)return b9(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=b9(t)?Math.max(0,t):null,this.max=b9(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,r=this.max;const i=e=>n=t?n:e,s=t=>r=e?r:t,o=(t,e)=>Math.pow(10,Math.floor(H9(t))+e);n===r&&(n<=0?(i(1),s(10)):(i(o(n,-1)),s(o(r,1)))),n<=0&&i(o(r,-1)),r<=0&&s(o(n,1)),this._zero&&this.min!==this._suggestedMin&&n===o(this.min,0)&&i(o(n,-1)),this.min=n,this.max=r}buildTicks(){const t=this.options,e=function(t,e){const n=Math.floor(H9(e.max)),r=Math.ceil(e.max/Math.pow(10,n)),i=[];let s=v9(t.min,Math.pow(10,Math.floor(H9(e.min)))),o=Math.floor(H9(s)),a=Math.floor(s/Math.pow(10,o)),l=o<0?Math.pow(10,Math.abs(o)):1;do{i.push({value:s,major:Vst(s)}),++a,10===a&&(a=1,++o,l=o>=0?1:l),s=Math.round(a*Math.pow(10,o)*l)/l}while(o<n||o===n&&a<r);const c=v9(t.max,s);return i.push({value:c,major:Vst(s)}),i}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&K9(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":fnt(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=H9(t),this._valueRange=H9(this.max)-H9(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(H9(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Wst(t){const e=t.ticks;if(e.display&&t.display){const t=xet(e.backdropPadding);return x9(e.font&&e.font.size,Jtt.font.size)+t.height}return 0}function Hst(t,e,n){return n=g9(n)?n:[n],{w:tet(t,e.string,n),h:n.length*e.lineHeight}}function Gst(t,e,n,r,i){return t===r||t===i?{start:e-n/2,end:e+n/2}:t<r||t>i?{start:e-n,end:e}:{start:e,end:e+n}}function qst(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),r=[],i=[],s=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?D9/s:0;for(let l=0;l<s;l++){const s=o.setContext(t.getPointLabelContext(l));i[l]=s.padding;const c=t.getPointPosition(l,t.drawingArea+i[l],a),u=wet(s.font),h=Hst(t.ctx,u,t._pointLabels[l]);r[l]=h;const d=rtt(t.getIndexAngle(l)+a),p=Math.round(J9(d));Xst(n,e,d,Gst(p,c.x,h.w,0,180),Gst(p,c.y,h.h,90,270))}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const r=[],i=t._pointLabels.length,s=t.options,o=Wst(s)/2,a=t.drawingArea,l=s.pointLabels.centerPointLabels?D9/i:0;for(let s=0;s<i;s++){const i=t.getPointPosition(s,a+o+n[s],l),c=Math.round(J9(rtt(i.angle+V9))),u=e[s],h=Zst(i.y,u.h,c),d=Yst(c),p=Kst(i.x,u.w,d);r.push({x:i.x,y:h,textAlign:d,left:p,top:h,right:p+u.w,bottom:h+u.h})}return r}(t,r,i)}function Xst(t,e,n,r,i){const s=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,l=0;r.start<e.l?(a=(e.l-r.start)/s,t.l=Math.min(t.l,e.l-a)):r.end>e.r&&(a=(r.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),i.start<e.t?(l=(e.t-i.start)/o,t.t=Math.min(t.t,e.t-l)):i.end>e.b&&(l=(i.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function Yst(t){return 0===t||180===t?"center":t<180?"left":"right"}function Kst(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function Zst(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function Jst(t,e,n,r){const{ctx:i}=t;if(n)i.arc(t.xCenter,t.yCenter,e,0,F9);else{let n=t.getPointPosition(0,e);i.moveTo(n.x,n.y);for(let s=1;s<r;s++)n=t.getPointPosition(s,e),i.lineTo(n.x,n.y)}}jst.id="logarithmic",jst.defaults={ticks:{callback:qrt.formatters.logarithmic,major:{enabled:!0}}};class Qst extends Bst{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=xet(Wst(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=b9(t)&&!isNaN(t)?t:0,this.max=b9(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Wst(this.options))}generateTickLabels(t){Bst.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const n=_9(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?qst(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,r){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,r))}getIndexAngle(t){return rtt(t*(F9/(this._pointLabels.length||1))+Z9(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(m9(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(m9(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return ket(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e,n=0){const r=this.getIndexAngle(t)-V9+n;return{x:Math.cos(r)*e+this.xCenter,y:Math.sin(r)*e+this.yCenter,angle:r}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:r,bottom:i}=this._pointLabelItems[t];return{left:e,top:n,right:r,bottom:i}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),Jst(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:r}=e,i=this._pointLabels.length;let s,o,a;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:r}}=t;for(let i=e-1;i>=0;i--){const e=r.setContext(t.getPointLabelContext(i)),s=wet(e.font),{x:o,y:a,textAlign:l,left:c,top:u,right:h,bottom:d}=t._pointLabelItems[i],{backdropColor:p}=e;if(!m9(p)){const t=vet(e.borderRadius),r=xet(e.backdropPadding);n.fillStyle=p;const i=c-r.left,s=u-r.top,o=h-c+r.width,a=d-u+r.height;Object.values(t).some((t=>0!==t))?(n.beginPath(),pet(n,{x:i,y:s,w:o,h:a,radius:t}),n.fill()):n.fillRect(i,s,o,a)}het(n,t._pointLabels[i],o,a+s.lineHeight/2,s,{color:e.color,textAlign:l,textBaseline:"middle"})}}(this,i),r.display&&this.ticks.forEach(((t,e)=>{if(0!==e){o=this.getDistanceFromCenterForValue(t.value);!function(t,e,n,r){const i=t.ctx,s=e.circular,{color:o,lineWidth:a}=e;!s&&!r||!o||!a||n<0||(i.save(),i.strokeStyle=o,i.lineWidth=a,i.setLineDash(e.borderDash),i.lineDashOffset=e.borderDashOffset,i.beginPath(),Jst(t,n,s,r),i.closePath(),i.stroke(),i.restore())}(this,r.setContext(this.getContext(e-1)),o,i)}})),n.display){for(t.save(),s=i-1;s>=0;s--){const r=n.setContext(this.getPointLabelContext(s)),{color:i,lineWidth:l}=r;l&&i&&(t.lineWidth=l,t.strokeStyle=i,t.setLineDash(r.borderDash),t.lineDashOffset=r.borderDashOffset,o=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),a=this.getPointPosition(s,o),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(a.x,a.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const r=this.getIndexAngle(0);let i,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(r),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((r,o)=>{if(0===o&&!e.reverse)return;const a=n.setContext(this.getContext(o)),l=wet(a.font);if(i=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){t.font=l.string,s=t.measureText(r.label).width,t.fillStyle=a.backdropColor;const e=xet(a.backdropPadding);t.fillRect(-s/2-e.left,-i-l.size/2-e.top,s+e.width,l.size+e.height)}het(t,r.label,0,-i,l,{color:a.color})})),t.restore()}drawTitle(){}}Qst.id="radialLinear",Qst.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:qrt.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},Qst.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},Qst.descriptors={angleLines:{_fallback:"grid"}};const tot={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},eot=Object.keys(tot);function not(t,e){return t-e}function rot(t,e){if(m9(e))return null;const n=t._adapter,{parser:r,round:i,isoWeekday:s}=t._parseOpts;let o=e;return"function"==typeof r&&(o=r(o)),b9(o)||(o="string"==typeof r?n.parse(o,r):n.parse(o)),null===o?null:(i&&(o="week"!==i||!X9(s)&&!0!==s?n.startOf(o,i):n.startOf(o,"isoWeek",s)),+o)}function iot(t,e,n,r){const i=eot.length;for(let s=eot.indexOf(t);s<i-1;++s){const t=tot[eot[s]],i=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(i*t.size))<=r)return eot[s]}return eot[i-1]}function sot(t,e,n){if(n){if(n.length){const{lo:r,hi:i}=Tet(n,e);t[n[r]>=e?n[r]:n[i]]=!0}}else t[e]=!0}function oot(t,e,n){const r=[],i={},s=e.length;let o,a;for(o=0;o<s;++o)a=e[o],i[a]=o,r.push({value:a,major:!1});return 0!==s&&n?function(t,e,n,r){const i=t._adapter,s=+i.startOf(e[0].value,r),o=e[e.length-1].value;let a,l;for(a=s;a<=o;a=+i.add(a,1,r))l=n[a],l>=0&&(e[l].major=!0);return e}(t,r,i,n):r}class aot extends nit{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const n=t.time||(t.time={}),r=this._adapter=new lrt._date(t.adapters.date);A9(n.displayFormats,r.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:rot(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:r,max:i,minDefined:s,maxDefined:o}=this.getUserBounds();function a(t){s||isNaN(t.min)||(r=Math.min(r,t.min)),o||isNaN(t.max)||(i=Math.max(i,t.max))}s&&o||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),r=b9(r)&&!isNaN(r)?r:+e.startOf(Date.now(),n),i=b9(i)&&!isNaN(i)?i:+e.endOf(Date.now(),n)+1,this.min=Math.min(r,i-1),this.max=Math.max(r+1,i)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,r="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const i=this.min,s=function(t,e,n){let r=0,i=t.length;for(;r<i&&t[r]<e;)r++;for(;i>r&&t[i-1]>n;)i--;return r>0||i<t.length?t.slice(r,i):t}(r,i,this.max);return this._unit=e.unit||(n.autoSkip?iot(e.minUnit,this.min,this.max,this._getLabelCapacity(i)):function(t,e,n,r,i){for(let s=eot.length-1;s>=eot.indexOf(n);s--){const n=eot[s];if(tot[n].common&&t._adapter.diff(i,r,n)>=e-1)return n}return eot[n?eot.indexOf(n):0]}(this,s.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=eot.indexOf(t)+1,n=eot.length;e<n;++e)if(tot[eot[e]].common)return eot[e]}(this._unit):void 0,this.initOffsets(r),t.reverse&&s.reverse(),oot(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t){let e,n,r=0,i=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),r=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,n=this.getDecimalForValue(t[t.length-1]),i=1===t.length?n:(n-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;r=stt(r,0,s),i=stt(i,0,s),this._offsets={start:r,end:i,factor:1/(r+1+i)}}_generate(){const t=this._adapter,e=this.min,n=this.max,r=this.options,i=r.time,s=i.unit||iot(i.minUnit,e,n,this._getLabelCapacity(e)),o=x9(i.stepSize,1),a="week"===s&&i.isoWeekday,l=X9(a)||!0===a,c={};let u,h,d=e;if(l&&(d=+t.startOf(d,"isoWeek",a)),d=+t.startOf(d,l?"day":s),t.diff(n,e,s)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+s);const p="data"===r.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<n;u=+t.add(u,o,s),h++)sot(c,u,p);return u!==n&&"ticks"!==r.bounds&&1!==h||sot(c,u,p),Object.keys(c).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}_tickFormatFunction(t,e,n,r){const i=this.options,s=i.time.displayFormats,o=this._unit,a=this._majorUnit,l=o&&s[o],c=a&&s[a],u=n[e],h=a&&c&&u&&u.major,d=this._adapter.format(t,r||(h?c:l)),p=i.ticks.callback;return p?_9(p,[d,e,n],this):d}generateTickLabels(t){let e,n,r;for(e=0,n=t.length;e<n;++e)r=t[e],r.label=this._tickFormatFunction(r.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,r=Z9(this.isHorizontal()?e.maxRotation:e.minRotation),i=Math.cos(r),s=Math.sin(r),o=this._resolveTickFontOptions(0).size;return{w:n*i+o*s,h:n*s+o*i}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,r=n[e.unit]||n.millisecond,i=this._tickFormatFunction(t,0,oot(this,[t],this._majorUnit),r),s=this._getLabelSize(i),o=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(t=0,e=r.length;t<e;++t)n=n.concat(r[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const r=this.getLabels();for(e=0,n=r.length;e<n;++e)t.push(rot(this,r[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Net(t.sort(not))}}function lot(t,e,n){let r,i,s,o,a=0,l=t.length-1;n?(e>=t[a].pos&&e<=t[l].pos&&({lo:a,hi:l}=Eet(t,"pos",e)),({pos:r,time:s}=t[a]),({pos:i,time:o}=t[l])):(e>=t[a].time&&e<=t[l].time&&({lo:a,hi:l}=Eet(t,"time",e)),({time:r,pos:s}=t[a]),({time:i,pos:o}=t[l]));const c=i-r;return c?s+(o-s)*(e-r)/c:s}aot.id="time",aot.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class cot extends aot{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=lot(e,this.min),this._tableRange=lot(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,r=[],i=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;++s)l=t[s],l>=e&&l<=n&&r.push(l);if(r.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(s=0,o=r.length;s<o;++s)c=r[s+1],a=r[s-1],l=r[s],Math.round((c+a)/2)!==l&&i.push({time:l,pos:s/(o-1)});return i}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(lot(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return lot(this._table,n*this._tableRange+this._minPos,!0)}}cot.id="timeseries",cot.defaults=aot.defaults;class uot extends Error{}class hot extends uot{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class dot extends uot{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class pot extends uot{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class fot extends uot{}class mot extends uot{constructor(t){super(`Invalid unit ${t}`)}}class got extends uot{}class yot extends uot{constructor(){super("Zone is an abstract class")}}const bot="numeric",vot="short",xot="long",wot={year:bot,month:bot,day:bot},_ot={year:bot,month:vot,day:bot},Sot={year:bot,month:vot,day:bot,weekday:vot},kot={year:bot,month:xot,day:bot},Tot={year:bot,month:xot,day:bot,weekday:xot},Eot={hour:bot,minute:bot},Mot={hour:bot,minute:bot,second:bot},Cot={hour:bot,minute:bot,second:bot,timeZoneName:vot},Aot={hour:bot,minute:bot,second:bot,timeZoneName:xot},Not={hour:bot,minute:bot,hourCycle:"h23"},Iot={hour:bot,minute:bot,second:bot,hourCycle:"h23"},$ot={hour:bot,minute:bot,second:bot,hourCycle:"h23",timeZoneName:vot},Rot={hour:bot,minute:bot,second:bot,hourCycle:"h23",timeZoneName:xot},Oot={year:bot,month:bot,day:bot,hour:bot,minute:bot},Pot={year:bot,month:bot,day:bot,hour:bot,minute:bot,second:bot},Lot={year:bot,month:vot,day:bot,hour:bot,minute:bot},Dot={year:bot,month:vot,day:bot,hour:bot,minute:bot,second:bot},Fot={year:bot,month:vot,day:bot,weekday:vot,hour:bot,minute:bot},zot={year:bot,month:xot,day:bot,hour:bot,minute:bot,timeZoneName:vot},Bot={year:bot,month:xot,day:bot,hour:bot,minute:bot,second:bot,timeZoneName:vot},Uot={year:bot,month:xot,day:bot,weekday:xot,hour:bot,minute:bot,timeZoneName:xot},Vot={year:bot,month:xot,day:bot,weekday:xot,hour:bot,minute:bot,second:bot,timeZoneName:xot};function jot(t){return void 0===t}function Wot(t){return"number"==typeof t}function Hot(t){return"number"==typeof t&&t%1==0}function Got(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(t){return!1}}function qot(t,e,n){if(0!==t.length)return t.reduce(((t,r)=>{const i=[e(r),r];return t&&n(t[0],i[0])===t[0]?t:i}),null)[1]}function Xot(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Yot(t,e,n){return Hot(t)&&t>=e&&t<=n}function Kot(t,e=2){let n;return n=t<0?"-"+(""+-t).padStart(e,"0"):(""+t).padStart(e,"0"),n}function Zot(t){return jot(t)||null===t||""===t?void 0:parseInt(t,10)}function Jot(t){return jot(t)||null===t||""===t?void 0:parseFloat(t)}function Qot(t){if(!jot(t)&&null!==t&&""!==t){const e=1e3*parseFloat("0."+t);return Math.floor(e)}}function tat(t,e,n=!1){const r=10**e;return(n?Math.trunc:Math.round)(t*r)/r}function eat(t){return t%4==0&&(t%100!=0||t%400==0)}function nat(t){return eat(t)?366:365}function rat(t,e){const n=function(t,e){return t-e*Math.floor(t/e)}(e-1,12)+1;return 2===n?eat(t+(e-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function iat(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function sat(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,n=t-1,r=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return 4===e||3===r?53:52}function oat(t){return t>99?t:t>60?1900+t:2e3+t}function aat(t,e,n,r=null){const i=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(n,o).formatToParts(i).find((t=>"timezonename"===t.type.toLowerCase()));return a?a.value:null}function lat(t,e){let n=parseInt(t,10);Number.isNaN(n)&&(n=0);const r=parseInt(e,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function cat(t){const e=Number(t);if("boolean"==typeof t||""===t||Number.isNaN(e))throw new got(`Invalid unit value ${t}`);return e}function uat(t,e){const n={};for(const r in t)if(Xot(t,r)){const i=t[r];if(null==i)continue;n[e(r)]=cat(i)}return n}function hat(t,e){const n=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),i=t>=0?"+":"-";switch(e){case"short":return`${i}${Kot(n,2)}:${Kot(r,2)}`;case"narrow":return`${i}${n}${r>0?`:${r}`:""}`;case"techie":return`${i}${Kot(n,2)}${Kot(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function dat(t){return function(t,e){return e.reduce(((e,n)=>(e[n]=t[n],e)),{})}(t,["hour","minute","second","millisecond"])}const pat=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,fat=["January","February","March","April","May","June","July","August","September","October","November","December"],mat=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],gat=["J","F","M","A","M","J","J","A","S","O","N","D"];function yat(t){switch(t){case"narrow":return[...gat];case"short":return[...mat];case"long":return[...fat];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const bat=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],vat=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],xat=["M","T","W","T","F","S","S"];function wat(t){switch(t){case"narrow":return[...xat];case"short":return[...vat];case"long":return[...bat];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const _at=["AM","PM"],Sat=["Before Christ","Anno Domini"],kat=["BC","AD"],Tat=["B","A"];function Eat(t){switch(t){case"narrow":return[...Tat];case"short":return[...kat];case"long":return[...Sat];default:return null}}function Mat(t,e){let n="";for(const r of t)r.literal?n+=r.val:n+=e(r.val);return n}const Cat={D:wot,DD:_ot,DDD:kot,DDDD:Tot,t:Eot,tt:Mot,ttt:Cot,tttt:Aot,T:Not,TT:Iot,TTT:$ot,TTTT:Rot,f:Oot,ff:Lot,fff:zot,ffff:Uot,F:Pot,FF:Dot,FFF:Bot,FFFF:Vot};class Aat{static create(t,e={}){return new Aat(t,e)}static parseFormat(t){let e=null,n="",r=!1;const i=[];for(let s=0;s<t.length;s++){const o=t.charAt(s);"'"===o?(n.length>0&&i.push({literal:r,val:n}),e=null,n="",r=!r):r||o===e?n+=o:(n.length>0&&i.push({literal:!1,val:n}),n=o,e=o)}return n.length>0&&i.push({literal:r,val:n}),i}static macroTokenToFormatOpts(t){return Cat[t]}constructor(t,e){this.opts=e,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,e){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(t,{...this.opts,...e}).format()}formatDateTime(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).format()}formatDateTimeParts(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).formatToParts()}resolvedOptions(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e}).resolvedOptions()}num(t,e=0){if(this.opts.forceSimple)return Kot(t,e);const n={...this.opts};return e>0&&(n.padTo=e),this.loc.numberFormatter(n).format(t)}formatDateTimeFromString(t,e){const n="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,i=(e,n)=>this.loc.extract(t,e,n),s=e=>t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):"",o=()=>n?function(t){return _at[t.hour<12?0:1]}(t):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(e,r)=>n?function(t,e){return yat(e)[t.month-1]}(t,e):i(r?{month:e}:{month:e,day:"numeric"},"month"),l=(e,r)=>n?function(t,e){return wat(e)[t.weekday-1]}(t,e):i(r?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday"),c=e=>{const n=Aat.macroTokenToFormatOpts(e);return n?this.formatWithSystemDefault(t,n):e},u=e=>n?function(t,e){return Eat(e)[t.year<0?0:1]}(t,e):i({era:e},"era");return Mat(Aat.parseFormat(e),(e=>{switch(e){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12==0?12:t.hour%12);case"hh":return this.num(t.hour%12==0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return o();case"d":return r?i({day:"numeric"},"day"):this.num(t.day);case"dd":return r?i({day:"2-digit"},"day"):this.num(t.day,2);case"c":case"E":return this.num(t.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?i({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return r?i({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return r?i({month:"numeric"},"month"):this.num(t.month);case"MM":return r?i({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return r?i({year:"numeric"},"year"):this.num(t.year);case"yy":return r?i({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return r?i({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return r?i({year:"numeric"},"year"):this.num(t.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return c(e)}}))}formatDurationFromString(t,e){const n=t=>{switch(t[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=Aat.parseFormat(e),i=r.reduce(((t,{literal:e,val:n})=>e?t:t.concat(n)),[]);return Mat(r,(t=>e=>{const r=n(e);return r?this.num(t.get(r),e.length):e})(t.shiftTo(...i.map(n).filter((t=>t)))))}}class Nat{constructor(t,e){this.reason=t,this.explanation=e}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class Iat{get type(){throw new yot}get name(){throw new yot}get ianaName(){return this.name}get isUniversal(){throw new yot}offsetName(t,e){throw new yot}formatOffset(t,e){throw new yot}offset(t){throw new yot}equals(t){throw new yot}get isValid(){throw new yot}}let $at=null;class Rat extends Iat{static get instance(){return null===$at&&($at=new Rat),$at}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return aat(t,e,n)}formatOffset(t,e){return hat(this.offset(t),e)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return"system"===t.type}get isValid(){return!0}}let Oat={};const Pat={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Lat={};class Dat extends Iat{static create(t){return Lat[t]||(Lat[t]=new Dat(t)),Lat[t]}static resetCache(){Lat={},Oat={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch(t){return!1}}constructor(t){super(),this.zoneName=t,this.valid=Dat.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return aat(t,e,n,this.name)}formatOffset(t,e){return hat(this.offset(t),e)}offset(t){const e=new Date(t);if(isNaN(e))return NaN;const n=(r=this.name,Oat[r]||(Oat[r]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Oat[r]);var r;let[i,s,o,a,l,c,u]=n.formatToParts?function(t,e){const n=t.formatToParts(e),r=[];for(let t=0;t<n.length;t++){const{type:e,value:i}=n[t],s=Pat[e];"era"===e?r[s]=i:jot(s)||(r[s]=parseInt(i,10))}return r}(n,e):function(t,e){const n=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,i,s,o,a,l,c,u]=r;return[o,i,s,a,l,c,u]}(n,e);"BC"===a&&(i=1-Math.abs(i));let h=+e;const d=h%1e3;return h-=d>=0?d:1e3+d,(iat({year:i,month:s,day:o,hour:24===l?0:l,minute:c,second:u,millisecond:0})-h)/6e4}equals(t){return"iana"===t.type&&t.name===this.name}get isValid(){return this.valid}}let Fat=null;class zat extends Iat{static get utcInstance(){return null===Fat&&(Fat=new zat(0)),Fat}static instance(t){return 0===t?zat.utcInstance:new zat(t)}static parseSpecifier(t){if(t){const e=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(e)return new zat(lat(e[1],e[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${hat(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${hat(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,e){return hat(this.fixed,e)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return"fixed"===t.type&&t.fixed===this.fixed}get isValid(){return!0}}class Bat extends Iat{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Uat(t,e){if(jot(t)||null===t)return e;if(t instanceof Iat)return t;if("string"==typeof t){const n=t.toLowerCase();return"local"===n||"system"===n?e:"utc"===n||"gmt"===n?zat.utcInstance:zat.parseSpecifier(n)||Dat.create(t)}return Wot(t)?zat.instance(t):"object"==typeof t&&t.offset&&"number"==typeof t.offset?t:new Bat(t)}let Vat,jat=()=>Date.now(),Wat="system",Hat=null,Gat=null,qat=null;class Xat{static get now(){return jat}static set now(t){jat=t}static set defaultZone(t){Wat=t}static get defaultZone(){return Uat(Wat,Rat.instance)}static get defaultLocale(){return Hat}static set defaultLocale(t){Hat=t}static get defaultNumberingSystem(){return Gat}static set defaultNumberingSystem(t){Gat=t}static get defaultOutputCalendar(){return qat}static set defaultOutputCalendar(t){qat=t}static get throwOnInvalid(){return Vat}static set throwOnInvalid(t){Vat=t}static resetCaches(){slt.resetCache(),Dat.resetCache()}}let Yat={};let Kat={};function Zat(t,e={}){const n=JSON.stringify([t,e]);let r=Kat[n];return r||(r=new Intl.DateTimeFormat(t,e),Kat[n]=r),r}let Jat={};let Qat={};let tlt=null;function elt(t,e,n,r,i){const s=t.listingMode(n);return"error"===s?null:"en"===s?r(e):i(e)}class nlt{constructor(t,e,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:r,floor:i,...s}=n;if(!e||Object.keys(s).length>0){const e={useGrouping:!1,...n};n.padTo>0&&(e.minimumIntegerDigits=n.padTo),this.inf=function(t,e={}){const n=JSON.stringify([t,e]);let r=Jat[n];return r||(r=new Intl.NumberFormat(t,e),Jat[n]=r),r}(t,e)}}format(t){if(this.inf){const e=this.floor?Math.floor(t):t;return this.inf.format(e)}return Kot(this.floor?Math.floor(t):tat(t,3),this.padTo)}}class rlt{constructor(t,e,n){let r;if(this.opts=n,t.zone.isUniversal){const e=t.offset/60*-1,i=e>=0?`Etc/GMT+${e}`:`Etc/GMT${e}`;0!==t.offset&&Dat.create(i).valid?(r=i,this.dt=t):(r="UTC",n.timeZoneName?this.dt=t:this.dt=0===t.offset?t:iut.fromMillis(t.ts+60*t.offset*1e3))}else"system"===t.zone.type?this.dt=t:(this.dt=t,r=t.zone.name);const i={...this.opts};r&&(i.timeZone=r),this.dtf=Zat(e,i)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class ilt{constructor(t,e,n){this.opts={style:"long",...n},!e&&Got()&&(this.rtf=function(t,e={}){const{base:n,...r}=e,i=JSON.stringify([t,r]);let s=Qat[i];return s||(s=new Intl.RelativeTimeFormat(t,e),Qat[i]=s),s}(t,n))}format(t,e){return this.rtf?this.rtf.format(t,e):function(t,e,n="always",r=!1){const i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(t);if("auto"===n&&s){const n="days"===t;switch(e){case 1:return n?"tomorrow":`next ${i[t][0]}`;case-1:return n?"yesterday":`last ${i[t][0]}`;case 0:return n?"today":`this ${i[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=1===a,c=i[t],u=r?l?c[1]:c[2]||c[1]:l?i[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}(e,t,this.opts.numeric,"long"!==this.opts.style)}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}}class slt{static fromOpts(t){return slt.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,e,n,r=!1){const i=t||Xat.defaultLocale,s=i||(r?"en-US":tlt||(tlt=(new Intl.DateTimeFormat).resolvedOptions().locale,tlt)),o=e||Xat.defaultNumberingSystem,a=n||Xat.defaultOutputCalendar;return new slt(s,o,a,i)}static resetCache(){tlt=null,Kat={},Jat={},Qat={}}static fromObject({locale:t,numberingSystem:e,outputCalendar:n}={}){return slt.create(t,e,n)}constructor(t,e,n,r){const[i,s,o]=function(t){const e=t.indexOf("-u-");if(-1===e)return[t];{let n;const r=t.substring(0,e);try{n=Zat(t).resolvedOptions()}catch(t){n=Zat(r).resolvedOptions()}const{numberingSystem:i,calendar:s}=n;return[r,i,s]}}(t);this.locale=i,this.numberingSystem=e||s||null,this.outputCalendar=n||o||null,this.intl=function(t,e,n){return n||e?(t+="-u",n&&(t+=`-ca-${n}`),e&&(t+=`-nu-${e}`),t):t}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var t;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(t=this).numberingSystem||"latn"===t.numberingSystem)&&("latn"===t.numberingSystem||!t.locale||t.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),e=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t&&e?"en":"intl"}clone(t){return t&&0!==Object.getOwnPropertyNames(t).length?slt.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,e=!1,n=!0){return elt(this,t,n,yat,(()=>{const n=e?{month:t,day:"numeric"}:{month:t},r=e?"format":"standalone";return this.monthsCache[r][t]||(this.monthsCache[r][t]=function(t){const e=[];for(let n=1;n<=12;n++){const r=iut.utc(2016,n,1);e.push(t(r))}return e}((t=>this.extract(t,n,"month")))),this.monthsCache[r][t]}))}weekdays(t,e=!1,n=!0){return elt(this,t,n,wat,(()=>{const n=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},r=e?"format":"standalone";return this.weekdaysCache[r][t]||(this.weekdaysCache[r][t]=function(t){const e=[];for(let n=1;n<=7;n++){const r=iut.utc(2016,11,13+n);e.push(t(r))}return e}((t=>this.extract(t,n,"weekday")))),this.weekdaysCache[r][t]}))}meridiems(t=!0){return elt(this,void 0,t,(()=>_at),(()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[iut.utc(2016,11,13,9),iut.utc(2016,11,13,19)].map((e=>this.extract(e,t,"dayperiod")))}return this.meridiemCache}))}eras(t,e=!0){return elt(this,t,e,Eat,(()=>{const e={era:t};return this.eraCache[t]||(this.eraCache[t]=[iut.utc(-40,1,1),iut.utc(2017,1,1)].map((t=>this.extract(t,e,"era")))),this.eraCache[t]}))}extract(t,e,n){const r=this.dtFormatter(t,e).formatToParts().find((t=>t.type.toLowerCase()===n));return r?r.value:null}numberFormatter(t={}){return new nlt(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new rlt(t,this.intl,e)}relFormatter(t={}){return new ilt(this.intl,this.isEnglish(),t)}listFormatter(t={}){return function(t,e={}){const n=JSON.stringify([t,e]);let r=Yat[n];return r||(r=new Intl.ListFormat(t,e),Yat[n]=r),r}(this.intl,t)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function olt(...t){const e=t.reduce(((t,e)=>t+e.source),"");return RegExp(`^${e}$`)}function alt(...t){return e=>t.reduce((([t,n,r],i)=>{const[s,o,a]=i(e,r);return[{...t,...s},o||n,a]}),[{},null,1]).slice(0,2)}function llt(t,...e){if(null==t)return[null,null];for(const[n,r]of e){const e=n.exec(t);if(e)return r(e)}return[null,null]}function clt(...t){return(e,n)=>{const r={};let i;for(i=0;i<t.length;i++)r[t[i]]=Zot(e[n+i]);return[r,null,n+i]}}const ult=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,hlt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,dlt=RegExp(`${hlt.source}${`(?:${ult.source}?(?:\\[(${pat.source})\\])?)?`}`),plt=RegExp(`(?:T${dlt.source})?`),flt=clt("weekYear","weekNumber","weekDay"),mlt=clt("year","ordinal"),glt=RegExp(`${hlt.source} ?(?:${ult.source}|(${pat.source}))?`),ylt=RegExp(`(?: ${glt.source})?`);function blt(t,e,n){const r=t[e];return jot(r)?n:Zot(r)}function vlt(t,e){return[{hours:blt(t,e,0),minutes:blt(t,e+1,0),seconds:blt(t,e+2,0),milliseconds:Qot(t[e+3])},null,e+4]}function xlt(t,e){const n=!t[e]&&!t[e+1],r=lat(t[e+1],t[e+2]);return[{},n?null:zat.instance(r),e+3]}function wlt(t,e){return[{},t[e]?Dat.create(t[e]):null,e+1]}const _lt=RegExp(`^T?${hlt.source}$`),Slt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function klt(t){const[e,n,r,i,s,o,a,l,c]=t,u="-"===e[0],h=l&&"-"===l[0],d=(t,e=!1)=>void 0!==t&&(e||t&&u)?-t:t;return[{years:d(Jot(n)),months:d(Jot(r)),weeks:d(Jot(i)),days:d(Jot(s)),hours:d(Jot(o)),minutes:d(Jot(a)),seconds:d(Jot(l),"-0"===l),milliseconds:d(Qot(c),h)}]}const Tlt={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Elt(t,e,n,r,i,s,o){const a={year:2===e.length?oat(Zot(e)):Zot(e),month:mat.indexOf(n)+1,day:Zot(r),hour:Zot(i),minute:Zot(s)};return o&&(a.second=Zot(o)),t&&(a.weekday=t.length>3?bat.indexOf(t)+1:vat.indexOf(t)+1),a}const Mlt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Clt(t){const[,e,n,r,i,s,o,a,l,c,u,h]=t,d=Elt(e,i,r,n,s,o,a);let p;return p=l?Tlt[l]:c?0:lat(u,h),[d,new zat(p)]}const Alt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Nlt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Ilt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function $lt(t){const[,e,n,r,i,s,o,a]=t;return[Elt(e,i,r,n,s,o,a),zat.utcInstance]}function Rlt(t){const[,e,n,r,i,s,o,a]=t;return[Elt(e,a,n,r,i,s,o),zat.utcInstance]}const Olt=olt(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,plt),Plt=olt(/(\d{4})-?W(\d\d)(?:-?(\d))?/,plt),Llt=olt(/(\d{4})-?(\d{3})/,plt),Dlt=olt(dlt),Flt=alt((function(t,e){return[{year:blt(t,e),month:blt(t,e+1,1),day:blt(t,e+2,1)},null,e+3]}),vlt,xlt,wlt),zlt=alt(flt,vlt,xlt,wlt),Blt=alt(mlt,vlt,xlt,wlt),Ult=alt(vlt,xlt,wlt);const Vlt=alt(vlt);const jlt=olt(/(\d{4})-(\d\d)-(\d\d)/,ylt),Wlt=olt(glt),Hlt=alt(vlt,xlt,wlt);const Glt={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},qlt={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...Glt},Xlt=365.2425,Ylt=30.436875,Klt={years:{quarters:4,months:12,weeks:52.1775,days:Xlt,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:Ylt,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...Glt},Zlt=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Jlt=Zlt.slice(0).reverse();function Qlt(t,e,n=!1){const r={values:n?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy};return new ect(r)}function tct(t,e,n,r,i){const s=t[i][n],o=e[n]/s,a=!(Math.sign(o)===Math.sign(r[i]))&&0!==r[i]&&Math.abs(o)<=1?function(t){return t<0?Math.floor(t):Math.ceil(t)}(o):Math.trunc(o);r[i]+=a,e[n]-=a*s}class ect{constructor(t){const e="longterm"===t.conversionAccuracy||!1;this.values=t.values,this.loc=t.loc||slt.create(),this.conversionAccuracy=e?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=e?Klt:qlt,this.isLuxonDuration=!0}static fromMillis(t,e){return ect.fromObject({milliseconds:t},e)}static fromObject(t,e={}){if(null==t||"object"!=typeof t)throw new got("Duration.fromObject: argument expected to be an object, got "+(null===t?"null":typeof t));return new ect({values:uat(t,ect.normalizeUnit),loc:slt.fromObject(e),conversionAccuracy:e.conversionAccuracy})}static fromDurationLike(t){if(Wot(t))return ect.fromMillis(t);if(ect.isDuration(t))return t;if("object"==typeof t)return ect.fromObject(t);throw new got(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,e){const[n]=function(t){return llt(t,[Slt,klt])}(t);return n?ect.fromObject(n,e):ect.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,e){const[n]=function(t){return llt(t,[_lt,Vlt])}(t);return n?ect.fromObject(n,e):ect.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,e=null){if(!t)throw new got("need to specify a reason the Duration is invalid");const n=t instanceof Nat?t:new Nat(t,e);if(Xat.throwOnInvalid)throw new pot(n);return new ect({invalid:n})}static normalizeUnit(t){const e={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t?t.toLowerCase():t];if(!e)throw new mot(t);return e}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,e={}){const n={...e,floor:!1!==e.round&&!1!==e.floor};return this.isValid?Aat.create(this.loc,n).formatDurationFromString(this,t):"Invalid Duration"}toHuman(t={}){const e=Zlt.map((e=>{const n=this.values[e];return jot(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:e.slice(0,-1)}).format(n)})).filter((t=>t));return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(e)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return 0!==this.years&&(t+=this.years+"Y"),0===this.months&&0===this.quarters||(t+=this.months+3*this.quarters+"M"),0!==this.weeks&&(t+=this.weeks+"W"),0!==this.days&&(t+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(t+="T"),0!==this.hours&&(t+=this.hours+"H"),0!==this.minutes&&(t+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(t+=tat(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===t&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const e=this.toMillis();if(e<0||e>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const n=this.shiftTo("hours","minutes","seconds","milliseconds");let r="basic"===t.format?"hhmm":"hh:mm";t.suppressSeconds&&0===n.seconds&&0===n.milliseconds||(r+="basic"===t.format?"ss":":ss",t.suppressMilliseconds&&0===n.milliseconds||(r+=".SSS"));let i=n.toFormat(r);return t.includePrefix&&(i="T"+i),i}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const e=ect.fromDurationLike(t),n={};for(const t of Zlt)(Xot(e.values,t)||Xot(this.values,t))&&(n[t]=e.get(t)+this.get(t));return Qlt(this,{values:n},!0)}minus(t){if(!this.isValid)return this;const e=ect.fromDurationLike(t);return this.plus(e.negate())}mapUnits(t){if(!this.isValid)return this;const e={};for(const n of Object.keys(this.values))e[n]=cat(t(this.values[n],n));return Qlt(this,{values:e},!0)}get(t){return this[ect.normalizeUnit(t)]}set(t){if(!this.isValid)return this;return Qlt(this,{values:{...this.values,...uat(t,ect.normalizeUnit)}})}reconfigure({locale:t,numberingSystem:e,conversionAccuracy:n}={}){const r={loc:this.loc.clone({locale:t,numberingSystem:e})};return n&&(r.conversionAccuracy=n),Qlt(this,r)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return function(t,e){Jlt.reduce(((n,r)=>jot(e[r])?n:(n&&tct(t,e,n,e,r),r)),null)}(this.matrix,t),Qlt(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(0===t.length)return this;t=t.map((t=>ect.normalizeUnit(t)));const e={},n={},r=this.toObject();let i;for(const s of Zlt)if(t.indexOf(s)>=0){i=s;let t=0;for(const e in n)t+=this.matrix[e][s]*n[e],n[e]=0;Wot(r[s])&&(t+=r[s]);const o=Math.trunc(t);e[s]=o,n[s]=(1e3*t-1e3*o)/1e3;for(const t in r)Zlt.indexOf(t)>Zlt.indexOf(s)&&tct(this.matrix,r,t,e,s)}else Wot(r[s])&&(n[s]=r[s]);for(const t in n)0!==n[t]&&(e[i]+=t===i?n[t]:n[t]/this.matrix[i][t]);return Qlt(this,{values:e},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const e of Object.keys(this.values))t[e]=0===this.values[e]?0:-this.values[e];return Qlt(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid)return!1;if(!this.loc.equals(t.loc))return!1;for(const r of Zlt)if(e=this.values[r],n=t.values[r],!(void 0===e||0===e?void 0===n||0===n:e===n))return!1;var e,n;return!0}}const nct="Invalid Interval";class rct{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,e=null){if(!t)throw new got("need to specify a reason the Interval is invalid");const n=t instanceof Nat?t:new Nat(t,e);if(Xat.throwOnInvalid)throw new dot(n);return new rct({invalid:n})}static fromDateTimes(t,e){const n=sut(t),r=sut(e),i=function(t,e){return t&&t.isValid?e&&e.isValid?e<t?rct.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null:rct.invalid("missing or invalid end"):rct.invalid("missing or invalid start")}(n,r);return null==i?new rct({start:n,end:r}):i}static after(t,e){const n=ect.fromDurationLike(e),r=sut(t);return rct.fromDateTimes(r,r.plus(n))}static before(t,e){const n=ect.fromDurationLike(e),r=sut(t);return rct.fromDateTimes(r.minus(n),r)}static fromISO(t,e){const[n,r]=(t||"").split("/",2);if(n&&r){let t,i,s,o;try{t=iut.fromISO(n,e),i=t.isValid}catch(r){i=!1}try{s=iut.fromISO(r,e),o=s.isValid}catch(r){o=!1}if(i&&o)return rct.fromDateTimes(t,s);if(i){const n=ect.fromISO(r,e);if(n.isValid)return rct.after(t,n)}else if(o){const t=ect.fromISO(n,e);if(t.isValid)return rct.before(s,t)}}return rct.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const e=this.start.startOf(t),n=this.end.startOf(t);return Math.floor(n.diff(e,t).get(t))+1}hasSame(t){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,t))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return!!this.isValid&&this.s>t}isBefore(t){return!!this.isValid&&this.e<=t}contains(t){return!!this.isValid&&(this.s<=t&&this.e>t)}set({start:t,end:e}={}){return this.isValid?rct.fromDateTimes(t||this.s,e||this.e):this}splitAt(...t){if(!this.isValid)return[];const e=t.map(sut).filter((t=>this.contains(t))).sort(),n=[];let{s:r}=this,i=0;for(;r<this.e;){const t=e[i]||this.e,s=+t>+this.e?this.e:t;n.push(rct.fromDateTimes(r,s)),r=s,i+=1}return n}splitBy(t){const e=ect.fromDurationLike(t);if(!this.isValid||!e.isValid||0===e.as("milliseconds"))return[];let n,{s:r}=this,i=1;const s=[];for(;r<this.e;){const t=this.start.plus(e.mapUnits((t=>t*i)));n=+t>+this.e?this.e:t,s.push(rct.fromDateTimes(r,n)),r=n,i+=1}return s}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return!!this.isValid&&+this.e==+t.s}abutsEnd(t){return!!this.isValid&&+t.e==+this.s}engulfs(t){return!!this.isValid&&(this.s<=t.s&&this.e>=t.e)}equals(t){return!(!this.isValid||!t.isValid)&&(this.s.equals(t.s)&&this.e.equals(t.e))}intersection(t){if(!this.isValid)return this;const e=this.s>t.s?this.s:t.s,n=this.e<t.e?this.e:t.e;return e>=n?null:rct.fromDateTimes(e,n)}union(t){if(!this.isValid)return this;const e=this.s<t.s?this.s:t.s,n=this.e>t.e?this.e:t.e;return rct.fromDateTimes(e,n)}static merge(t){const[e,n]=t.sort(((t,e)=>t.s-e.s)).reduce((([t,e],n)=>e?e.overlaps(n)||e.abutsStart(n)?[t,e.union(n)]:[t.concat([e]),n]:[t,n]),[[],null]);return n&&e.push(n),e}static xor(t){let e=null,n=0;const r=[],i=t.map((t=>[{time:t.s,type:"s"},{time:t.e,type:"e"}])),s=Array.prototype.concat(...i).sort(((t,e)=>t.time-e.time));for(const t of s)n+="s"===t.type?1:-1,1===n?e=t.time:(e&&+e!=+t.time&&r.push(rct.fromDateTimes(e,t.time)),e=null);return rct.merge(r)}difference(...t){return rct.xor([this].concat(t)).map((t=>this.intersection(t))).filter((t=>t&&!t.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:nct}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:nct}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:nct}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:nct}toFormat(t,{separator:e=" – "}={}){return this.isValid?`${this.s.toFormat(t)}${e}${this.e.toFormat(t)}`:nct}toDuration(t,e){return this.isValid?this.e.diff(this.s,t,e):ect.invalid(this.invalidReason)}mapEndpoints(t){return rct.fromDateTimes(t(this.s),t(this.e))}}class ict{static hasDST(t=Xat.defaultZone){const e=iut.now().setZone(t).set({month:12});return!t.isUniversal&&e.offset!==e.set({month:6}).offset}static isValidIANAZone(t){return Dat.isValidZone(t)}static normalizeZone(t){return Uat(t,Xat.defaultZone)}static months(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||slt.create(e,n,i)).months(t)}static monthsFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||slt.create(e,n,i)).months(t,!0)}static weekdays(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||slt.create(e,n,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||slt.create(e,n,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return slt.create(t).meridiems()}static eras(t="short",{locale:e=null}={}){return slt.create(e,null,"gregory").eras(t)}static features(){return{relative:Got()}}}function sct(t,e){const n=t=>t.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(e)-n(t);return Math.floor(ect.fromMillis(r).as("days"))}function oct(t,e,n,r){let[i,s,o,a]=function(t,e,n){const r=[["years",(t,e)=>e.year-t.year],["quarters",(t,e)=>e.quarter-t.quarter],["months",(t,e)=>e.month-t.month+12*(e.year-t.year)],["weeks",(t,e)=>{const n=sct(t,e);return(n-n%7)/7}],["days",sct]],i={};let s,o;for(const[a,l]of r)if(n.indexOf(a)>=0){s=a;let n=l(t,e);o=t.plus({[a]:n}),o>e?(t=t.plus({[a]:n-1}),n-=1):t=o,i[a]=n}return[t,i,o,s]}(t,e,n);const l=e-i,c=n.filter((t=>["hours","minutes","seconds","milliseconds"].indexOf(t)>=0));0===c.length&&(o<e&&(o=i.plus({[a]:1})),o!==i&&(s[a]=(s[a]||0)+l/(o-i)));const u=ect.fromObject(s,r);return c.length>0?ect.fromMillis(l,r).shiftTo(...c).plus(u):u}const act={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},lct={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},cct=act.hanidec.replace(/[\[|\]]/g,"").split("");function uct({numberingSystem:t},e=""){return new RegExp(`${act[t||"latn"]}${e}`)}function hct(t,e=(t=>t)){return{regex:t,deser:([t])=>e(function(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);if(-1!==t[n].search(act.hanidec))e+=cct.indexOf(t[n]);else for(const t in lct){const[n,i]=lct[t];r>=n&&r<=i&&(e+=r-n)}}return parseInt(e,10)}return e}(t))}}const dct=`[ ${String.fromCharCode(160)}]`,pct=new RegExp(dct,"g");function fct(t){return t.replace(/\./g,"\\.?").replace(pct,dct)}function mct(t){return t.replace(/\./g,"").replace(pct," ").toLowerCase()}function gct(t,e){return null===t?null:{regex:RegExp(t.map(fct).join("|")),deser:([n])=>t.findIndex((t=>mct(n)===mct(t)))+e}}function yct(t,e){return{regex:t,deser:([,t,e])=>lat(t,e),groups:e}}function bct(t){return{regex:t,deser:([t])=>t}}const vct={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let xct=null;function wct(t,e){if(t.literal)return t;const n=Aat.macroTokenToFormatOpts(t.val);if(!n)return t;const r=Aat.create(e,n).formatDateTimeParts((xct||(xct=iut.fromMillis(1555555555555)),xct)).map((t=>function(t,e,n){const{type:r,value:i}=t;if("literal"===r)return{literal:!0,val:i};const s=n[r];let o=vct[r];return"object"==typeof o&&(o=o[s]),o?{literal:!1,val:o}:void 0}(t,0,n)));return r.includes(void 0)?t:r}function _ct(t,e,n){const r=function(t,e){return Array.prototype.concat(...t.map((t=>wct(t,e))))}(Aat.parseFormat(n),t),i=r.map((e=>function(t,e){const n=uct(e),r=uct(e,"{2}"),i=uct(e,"{3}"),s=uct(e,"{4}"),o=uct(e,"{6}"),a=uct(e,"{1,2}"),l=uct(e,"{1,3}"),c=uct(e,"{1,6}"),u=uct(e,"{1,9}"),h=uct(e,"{2,4}"),d=uct(e,"{4,6}"),p=t=>{return{regex:RegExp((e=t.val,e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([t])=>t,literal:!0};var e},f=(f=>{if(t.literal)return p(f);switch(f.val){case"G":return gct(e.eras("short",!1),0);case"GG":return gct(e.eras("long",!1),0);case"y":return hct(c);case"yy":case"kk":return hct(h,oat);case"yyyy":case"kkkk":return hct(s);case"yyyyy":return hct(d);case"yyyyyy":return hct(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return hct(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return hct(r);case"MMM":return gct(e.months("short",!0,!1),1);case"MMMM":return gct(e.months("long",!0,!1),1);case"LLL":return gct(e.months("short",!1,!1),1);case"LLLL":return gct(e.months("long",!1,!1),1);case"o":case"S":return hct(l);case"ooo":case"SSS":return hct(i);case"u":return bct(u);case"uu":return bct(a);case"uuu":case"E":case"c":return hct(n);case"a":return gct(e.meridiems(),0);case"EEE":return gct(e.weekdays("short",!1,!1),1);case"EEEE":return gct(e.weekdays("long",!1,!1),1);case"ccc":return gct(e.weekdays("short",!0,!1),1);case"cccc":return gct(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return yct(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return yct(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return bct(/[a-z_+-/]{1,256}?/i);default:return p(f)}})(t)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return f.token=t,f}(e,t))),s=i.find((t=>t.invalidReason));if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[t,n]=function(t){return[`^${t.map((t=>t.regex)).reduce(((t,e)=>`${t}(${e.source})`),"")}$`,t]}(i),s=RegExp(t,"i"),[o,a]=function(t,e,n){const r=t.match(e);if(r){const t={};let e=1;for(const i in n)if(Xot(n,i)){const s=n[i],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(t[s.token.val[0]]=s.deser(r.slice(e,e+o))),e+=o}return[r,t]}return[r,{}]}(e,s,n),[l,c,u]=a?function(t){let e,n=null;return jot(t.z)||(n=Dat.create(t.z)),jot(t.Z)||(n||(n=new zat(t.Z)),e=t.Z),jot(t.q)||(t.M=3*(t.q-1)+1),jot(t.h)||(t.h<12&&1===t.a?t.h+=12:12===t.h&&0===t.a&&(t.h=0)),0===t.G&&t.y&&(t.y=-t.y),jot(t.u)||(t.S=Qot(t.u)),[Object.keys(t).reduce(((e,n)=>{const r=(t=>{switch(t){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return r&&(e[r]=t[n]),e}),{}),n,e]}(a):[null,null,void 0];if(Xot(a,"a")&&Xot(a,"H"))throw new fot("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:s,rawMatches:o,matches:a,result:l,zone:c,specificOffset:u}}}const Sct=[0,31,59,90,120,151,181,212,243,273,304,334],kct=[0,31,60,91,121,152,182,213,244,274,305,335];function Tct(t,e){return new Nat("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Ect(t,e,n){const r=new Date(Date.UTC(t,e-1,n));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const i=r.getUTCDay();return 0===i?7:i}function Mct(t,e,n){return n+(eat(t)?kct:Sct)[e-1]}function Cct(t,e){const n=eat(t)?kct:Sct,r=n.findIndex((t=>t<e));return{month:r+1,day:e-n[r]}}function Act(t){const{year:e,month:n,day:r}=t,i=Mct(e,n,r),s=Ect(e,n,r);let o,a=Math.floor((i-s+10)/7);return a<1?(o=e-1,a=sat(o)):a>sat(e)?(o=e+1,a=1):o=e,{weekYear:o,weekNumber:a,weekday:s,...dat(t)}}function Nct(t){const{weekYear:e,weekNumber:n,weekday:r}=t,i=Ect(e,1,4),s=nat(e);let o,a=7*n+r-i-3;a<1?(o=e-1,a+=nat(o)):a>s?(o=e+1,a-=nat(e)):o=e;const{month:l,day:c}=Cct(o,a);return{year:o,month:l,day:c,...dat(t)}}function Ict(t){const{year:e,month:n,day:r}=t;return{year:e,ordinal:Mct(e,n,r),...dat(t)}}function $ct(t){const{year:e,ordinal:n}=t,{month:r,day:i}=Cct(e,n);return{year:e,month:r,day:i,...dat(t)}}function Rct(t){const e=Hot(t.year),n=Yot(t.month,1,12),r=Yot(t.day,1,rat(t.year,t.month));return e?n?!r&&Tct("day",t.day):Tct("month",t.month):Tct("year",t.year)}function Oct(t){const{hour:e,minute:n,second:r,millisecond:i}=t,s=Yot(e,0,23)||24===e&&0===n&&0===r&&0===i,o=Yot(n,0,59),a=Yot(r,0,59),l=Yot(i,0,999);return s?o?a?!l&&Tct("millisecond",i):Tct("second",r):Tct("minute",n):Tct("hour",e)}const Pct="Invalid DateTime",Lct=864e13;function Dct(t){return new Nat("unsupported zone",`the zone "${t.name}" is not supported`)}function Fct(t){return null===t.weekData&&(t.weekData=Act(t.c)),t.weekData}function zct(t,e){const n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new iut({...n,...e,old:n})}function Bct(t,e,n){let r=t-60*e*1e3;const i=n.offset(r);if(e===i)return[r,e];r-=60*(i-e)*1e3;const s=n.offset(r);return i===s?[r,i]:[t-60*Math.min(i,s)*1e3,Math.max(i,s)]}function Uct(t,e){const n=new Date(t+=60*e*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function Vct(t,e,n){return Bct(iat(t),e,n)}function jct(t,e){const n=t.o,r=t.c.year+Math.trunc(e.years),i=t.c.month+Math.trunc(e.months)+3*Math.trunc(e.quarters),s={...t.c,year:r,month:i,day:Math.min(t.c.day,rat(r,i))+Math.trunc(e.days)+7*Math.trunc(e.weeks)},o=ect.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=iat(s);let[l,c]=Bct(a,n,t.zone);return 0!==o&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function Wct(t,e,n,r,i,s){const{setZone:o,zone:a}=n;if(t&&0!==Object.keys(t).length){const r=e||a,i=iut.fromObject(t,{...n,zone:r,specificOffset:s});return o?i:i.setZone(a)}return iut.invalid(new Nat("unparsable",`the input "${i}" can't be parsed as ${r}`))}function Hct(t,e,n=!0){return t.isValid?Aat.create(slt.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Gct(t,e){const n=t.c.year>9999||t.c.year<0;let r="";return n&&t.c.year>=0&&(r+="+"),r+=Kot(t.c.year,n?6:4),e?(r+="-",r+=Kot(t.c.month),r+="-",r+=Kot(t.c.day)):(r+=Kot(t.c.month),r+=Kot(t.c.day)),r}function qct(t,e,n,r,i,s){let o=Kot(t.c.hour);return e?(o+=":",o+=Kot(t.c.minute),0===t.c.second&&n||(o+=":")):o+=Kot(t.c.minute),0===t.c.second&&n||(o+=Kot(t.c.second),0===t.c.millisecond&&r||(o+=".",o+=Kot(t.c.millisecond,3))),i&&(t.isOffsetFixed&&0===t.offset&&!s?o+="Z":t.o<0?(o+="-",o+=Kot(Math.trunc(-t.o/60)),o+=":",o+=Kot(Math.trunc(-t.o%60))):(o+="+",o+=Kot(Math.trunc(t.o/60)),o+=":",o+=Kot(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const Xct={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Yct={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Kct={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Zct=["year","month","day","hour","minute","second","millisecond"],Jct=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Qct=["year","ordinal","hour","minute","second","millisecond"];function tut(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new mot(t);return e}function eut(t,e){const n=Uat(e.zone,Xat.defaultZone),r=slt.fromObject(e),i=Xat.now();let s,o;if(jot(t.year))s=i;else{for(const e of Zct)jot(t[e])&&(t[e]=Xct[e]);const e=Rct(t)||Oct(t);if(e)return iut.invalid(e);const r=n.offset(i);[s,o]=Vct(t,r,n)}return new iut({ts:s,zone:n,loc:r,o:o})}function nut(t,e,n){const r=!!jot(n.round)||n.round,i=(t,i)=>{t=tat(t,r||n.calendary?0:2,!0);return e.loc.clone(n).relFormatter(n).format(t,i)},s=r=>n.calendary?e.hasSame(t,r)?0:e.startOf(r).diff(t.startOf(r),r).get(r):e.diff(t,r).get(r);if(n.unit)return i(s(n.unit),n.unit);for(const t of n.units){const e=s(t);if(Math.abs(e)>=1)return i(e,t)}return i(t>e?-0:0,n.units[n.units.length-1])}function rut(t){let e,n={};return t.length>0&&"object"==typeof t[t.length-1]?(n=t[t.length-1],e=Array.from(t).slice(0,t.length-1)):e=Array.from(t),[n,e]}class iut{constructor(t){const e=t.zone||Xat.defaultZone;let n=t.invalid||(Number.isNaN(t.ts)?new Nat("invalid input"):null)||(e.isValid?null:Dct(e));this.ts=jot(t.ts)?Xat.now():t.ts;let r=null,i=null;if(!n){if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e))[r,i]=[t.old.c,t.old.o];else{const t=e.offset(this.ts);r=Uct(this.ts,t),n=Number.isNaN(r.year)?new Nat("invalid input"):null,r=n?null:r,i=n?null:t}}this._zone=e,this.loc=t.loc||slt.create(),this.invalid=n,this.weekData=null,this.c=r,this.o=i,this.isLuxonDateTime=!0}static now(){return new iut({})}static local(){const[t,e]=rut(arguments),[n,r,i,s,o,a,l]=e;return eut({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static utc(){const[t,e]=rut(arguments),[n,r,i,s,o,a,l]=e;return t.zone=zat.utcInstance,eut({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static fromJSDate(t,e={}){const n=(r=t,"[object Date]"===Object.prototype.toString.call(r)?t.valueOf():NaN);var r;if(Number.isNaN(n))return iut.invalid("invalid input");const i=Uat(e.zone,Xat.defaultZone);return i.isValid?new iut({ts:n,zone:i,loc:slt.fromObject(e)}):iut.invalid(Dct(i))}static fromMillis(t,e={}){if(Wot(t))return t<-Lct||t>Lct?iut.invalid("Timestamp out of range"):new iut({ts:t,zone:Uat(e.zone,Xat.defaultZone),loc:slt.fromObject(e)});throw new got(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,e={}){if(Wot(t))return new iut({ts:1e3*t,zone:Uat(e.zone,Xat.defaultZone),loc:slt.fromObject(e)});throw new got("fromSeconds requires a numerical input")}static fromObject(t,e={}){t=t||{};const n=Uat(e.zone,Xat.defaultZone);if(!n.isValid)return iut.invalid(Dct(n));const r=Xat.now(),i=jot(e.specificOffset)?n.offset(r):e.specificOffset,s=uat(t,tut),o=!jot(s.ordinal),a=!jot(s.year),l=!jot(s.month)||!jot(s.day),c=a||l,u=s.weekYear||s.weekNumber,h=slt.fromObject(e);if((c||o)&&u)throw new fot("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new fot("Can't mix ordinal dates with month/day");const d=u||s.weekday&&!c;let p,f,m=Uct(r,i);d?(p=Jct,f=Yct,m=Act(m)):o?(p=Qct,f=Kct,m=Ict(m)):(p=Zct,f=Xct);let g=!1;for(const t of p){jot(s[t])?s[t]=g?f[t]:m[t]:g=!0}const y=d?function(t){const e=Hot(t.weekYear),n=Yot(t.weekNumber,1,sat(t.weekYear)),r=Yot(t.weekday,1,7);return e?n?!r&&Tct("weekday",t.weekday):Tct("week",t.week):Tct("weekYear",t.weekYear)}(s):o?function(t){const e=Hot(t.year),n=Yot(t.ordinal,1,nat(t.year));return e?!n&&Tct("ordinal",t.ordinal):Tct("year",t.year)}(s):Rct(s),b=y||Oct(s);if(b)return iut.invalid(b);const v=d?Nct(s):o?$ct(s):s,[x,w]=Vct(v,i,n),_=new iut({ts:x,zone:n,o:w,loc:h});return s.weekday&&c&&t.weekday!==_.weekday?iut.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${_.toISO()}`):_}static fromISO(t,e={}){const[n,r]=function(t){return llt(t,[Olt,Flt],[Plt,zlt],[Llt,Blt],[Dlt,Ult])}(t);return Wct(n,r,e,"ISO 8601",t)}static fromRFC2822(t,e={}){const[n,r]=function(t){return llt(function(t){return t.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(t),[Mlt,Clt])}(t);return Wct(n,r,e,"RFC 2822",t)}static fromHTTP(t,e={}){const[n,r]=function(t){return llt(t,[Alt,$lt],[Nlt,$lt],[Ilt,Rlt])}(t);return Wct(n,r,e,"HTTP",e)}static fromFormat(t,e,n={}){if(jot(t)||jot(e))throw new got("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:i=null}=n,s=slt.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),[o,a,l,c]=function(t,e,n){const{result:r,zone:i,specificOffset:s,invalidReason:o}=_ct(t,e,n);return[r,i,s,o]}(s,t,e);return c?iut.invalid(c):Wct(o,a,n,`format ${e}`,t,l)}static fromString(t,e,n={}){return iut.fromFormat(t,e,n)}static fromSQL(t,e={}){const[n,r]=function(t){return llt(t,[jlt,Flt],[Wlt,Hlt])}(t);return Wct(n,r,e,"SQL",t)}static invalid(t,e=null){if(!t)throw new got("need to specify a reason the DateTime is invalid");const n=t instanceof Nat?t:new Nat(t,e);if(Xat.throwOnInvalid)throw new hot(n);return new iut({invalid:n})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Fct(this).weekYear:NaN}get weekNumber(){return this.isValid?Fct(this).weekNumber:NaN}get weekday(){return this.isValid?Fct(this).weekday:NaN}get ordinal(){return this.isValid?Ict(this.c).ordinal:NaN}get monthShort(){return this.isValid?ict.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?ict.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?ict.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?ict.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}get isInLeapYear(){return eat(this.year)}get daysInMonth(){return rat(this.year,this.month)}get daysInYear(){return this.isValid?nat(this.year):NaN}get weeksInWeekYear(){return this.isValid?sat(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:e,numberingSystem:n,calendar:r}=Aat.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e,numberingSystem:n,outputCalendar:r}}toUTC(t=0,e={}){return this.setZone(zat.instance(t),e)}toLocal(){return this.setZone(Xat.defaultZone)}setZone(t,{keepLocalTime:e=!1,keepCalendarTime:n=!1}={}){if((t=Uat(t,Xat.defaultZone)).equals(this.zone))return this;if(t.isValid){let r=this.ts;if(e||n){const e=t.offset(this.ts),n=this.toObject();[r]=Vct(n,e,t)}return zct(this,{ts:r,zone:t})}return iut.invalid(Dct(t))}reconfigure({locale:t,numberingSystem:e,outputCalendar:n}={}){return zct(this,{loc:this.loc.clone({locale:t,numberingSystem:e,outputCalendar:n})})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const e=uat(t,tut),n=!jot(e.weekYear)||!jot(e.weekNumber)||!jot(e.weekday),r=!jot(e.ordinal),i=!jot(e.year),s=!jot(e.month)||!jot(e.day),o=i||s,a=e.weekYear||e.weekNumber;if((o||r)&&a)throw new fot("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&r)throw new fot("Can't mix ordinal dates with month/day");let l;n?l=Nct({...Act(this.c),...e}):jot(e.ordinal)?(l={...this.toObject(),...e},jot(e.day)&&(l.day=Math.min(rat(l.year,l.month),l.day))):l=$ct({...Ict(this.c),...e});const[c,u]=Vct(l,this.o,this.zone);return zct(this,{ts:c,o:u})}plus(t){if(!this.isValid)return this;return zct(this,jct(this,ect.fromDurationLike(t)))}minus(t){if(!this.isValid)return this;return zct(this,jct(this,ect.fromDurationLike(t).negate()))}startOf(t){if(!this.isValid)return this;const e={},n=ect.normalizeUnit(t);switch(n){case"years":e.month=1;case"quarters":case"months":e.day=1;case"weeks":case"days":e.hour=0;case"hours":e.minute=0;case"minutes":e.second=0;case"seconds":e.millisecond=0}if("weeks"===n&&(e.weekday=1),"quarters"===n){const t=Math.ceil(this.month/3);e.month=3*(t-1)+1}return this.set(e)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,e={}){return this.isValid?Aat.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):Pct}toLocaleString(t=wot,e={}){return this.isValid?Aat.create(this.loc.clone(e),t).formatDateTime(this):Pct}toLocaleParts(t={}){return this.isValid?Aat.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:e=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:i=!1}={}){if(!this.isValid)return null;const s="extended"===t;let o=Gct(this,s);return o+="T",o+=qct(this,s,e,n,r,i),o}toISODate({format:t="extended"}={}){return this.isValid?Gct(this,"extended"===t):null}toISOWeekDate(){return Hct(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:e=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:i=!1,format:s="extended"}={}){if(!this.isValid)return null;return(r?"T":"")+qct(this,"extended"===s,e,t,n,i)}toRFC2822(){return Hct(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Hct(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Gct(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:e=!1,includeOffsetSpace:n=!0}={}){let r="HH:mm:ss.SSS";return(e||t)&&(n&&(r+=" "),e?r+="z":t&&(r+="ZZ")),Hct(this,r,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():Pct}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const e={...this.c};return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,e="milliseconds",n={}){if(!this.isValid||!t.isValid)return ect.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...n},i=(a=e,Array.isArray(a)?a:[a]).map(ect.normalizeUnit),s=t.valueOf()>this.valueOf(),o=oct(s?this:t,s?t:this,i,r);var a;return s?o.negate():o}diffNow(t="milliseconds",e={}){return this.diff(iut.now(),t,e)}until(t){return this.isValid?rct.fromDateTimes(this,t):this}hasSame(t,e){if(!this.isValid)return!1;const n=t.valueOf(),r=this.setZone(t.zone,{keepLocalTime:!0});return r.startOf(e)<=n&&n<=r.endOf(e)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const e=t.base||iut.fromObject({},{zone:this.zone}),n=t.padding?this<e?-t.padding:t.padding:0;let r=["years","months","days","hours","minutes","seconds"],i=t.unit;return Array.isArray(t.unit)&&(r=t.unit,i=void 0),nut(e,this.plus(n),{...t,numeric:"always",units:r,unit:i})}toRelativeCalendar(t={}){return this.isValid?nut(t.base||iut.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(iut.isDateTime))throw new got("min requires all arguments be DateTimes");return qot(t,(t=>t.valueOf()),Math.min)}static max(...t){if(!t.every(iut.isDateTime))throw new got("max requires all arguments be DateTimes");return qot(t,(t=>t.valueOf()),Math.max)}static fromFormatExplain(t,e,n={}){const{locale:r=null,numberingSystem:i=null}=n;return _ct(slt.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),t,e)}static fromStringExplain(t,e,n={}){return iut.fromFormatExplain(t,e,n)}static get DATE_SHORT(){return wot}static get DATE_MED(){return _ot}static get DATE_MED_WITH_WEEKDAY(){return Sot}static get DATE_FULL(){return kot}static get DATE_HUGE(){return Tot}static get TIME_SIMPLE(){return Eot}static get TIME_WITH_SECONDS(){return Mot}static get TIME_WITH_SHORT_OFFSET(){return Cot}static get TIME_WITH_LONG_OFFSET(){return Aot}static get TIME_24_SIMPLE(){return Not}static get TIME_24_WITH_SECONDS(){return Iot}static get TIME_24_WITH_SHORT_OFFSET(){return $ot}static get TIME_24_WITH_LONG_OFFSET(){return Rot}static get DATETIME_SHORT(){return Oot}static get DATETIME_SHORT_WITH_SECONDS(){return Pot}static get DATETIME_MED(){return Lot}static get DATETIME_MED_WITH_SECONDS(){return Dot}static get DATETIME_MED_WITH_WEEKDAY(){return Fot}static get DATETIME_FULL(){return zot}static get DATETIME_FULL_WITH_SECONDS(){return Bot}static get DATETIME_HUGE(){return Uot}static get DATETIME_HUGE_WITH_SECONDS(){return Vot}}function sut(t){if(iut.isDateTime(t))return t;if(t&&t.valueOf&&Wot(t.valueOf()))return iut.fromJSDate(t);if(t&&"object"==typeof t)return iut.fromObject(t);throw new got(`Unknown datetime argument: ${t}, of type ${typeof t}`)}
/*!
     * chartjs-adapter-luxon v1.2.0
     * https://www.chartjs.org
     * (c) 2022 chartjs-adapter-luxon Contributors
     * Released under the MIT license
     */const out={datetime:iut.DATETIME_MED_WITH_SECONDS,millisecond:"h:mm:ss.SSS a",second:iut.TIME_WITH_SECONDS,minute:iut.TIME_SIMPLE,hour:{hour:"numeric"},day:{day:"numeric",month:"short"},week:"DD",month:{month:"short",year:"numeric"},quarter:"'Q'q - yyyy",year:{year:"numeric"}};function aut(t){let e,n;return{c(){e=IN("div"),n=IN("canvas"),FN(e,"class","w-full h-96")},m(r,i){CN(r,e,i),TN(e,n),t[6](n)},p:nN,d(n){n&&AN(e),t[6](null)}}}function lut(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[aut]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),32770&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function cut(t,e,n){let{title:r}=e,{preset:i}=e,{options:s}=e,{datasets:o}=e;Cit.register(Lit,Znt,Jnt,Dst,Qnt,yst,xst,Hit,trt,Ust,jst,nrt,qit,ert,rrt,Qst,tst,irt,aot,cot,_st,Pst);const a=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"],l={data:{},options:{maintainAspectRatio:!1,animation:{duration:200},borderWidth:4}};function c(t){return{borderColor:a[t%6],backgroundColor:a[t%6],fill:!1,lineTension:.2}}function u(t,e,n){const r={labels:[]};let i=0;return r.datasets=t.map((({dataStream:s,label:o,options:l},u)=>{i=Math.max(i,s.get()?s.get().length:0),0===u&&(r.labels=l.labels||[],!l.labels&&s.get()&&s.get().length>0&&("number"==typeof s.get()[0]?r.labels=Array.from(Array(s.get().length),((t,e)=>e.toString())):r.labels=s.get().map((t=>t.x.toString()))));let h={...c(u),...e,...l,label:o,data:s.get()||[]};return(["bar","bar-fast"].includes(l.type)||["bar","bar-fast"].includes(n.type)&&!l.type)&&1===t.length&&(h.borderColor=a,h.backgroundColor=a),h})),r}let h,d,p=[];function f(){let t=dG(l,i.global);t=dG(t,{data:u(o,i.datasets,t),options:s}),s.xlabel&&(t=dG(t,{options:{scales:{x:{title:{display:!0,text:s.xlabel}}}}})),s.ylabel&&(t=dG(t,{options:{scales:{y:{title:{display:!0,text:s.ylabel}}}}}));const e=o.map((({dataStream:t})=>{var e;return(null===(e=t.get())||void 0===e?void 0:e.length)||0}));p=o.map((({dataStream:n,options:r},i)=>n.subscribe((n=>{if(n&&h){const s=e.reduce(((t,e)=>Math.max(t,e)));e[i]=n.length,!r.labels&&n.length>0&&e[i]>s&&("number"==typeof n[0]?t.data.labels=Array.from(Array(n.length),((t,e)=>e.toString())):t.data.labels=n.map((t=>t.x.toString()))),t.data.datasets[i].data=n;try{h.update()}catch(t){console.log(t)}}}))));const n=d.getContext("2d");h=new Cit(n,t)}function m(){for(const t of p)t();null==h||h.destroy()}rI((async()=>{await gI(),await gI(),f()}));let g=o.length;return sI(m),t.$$set=t=>{"title"in t&&n(0,r=t.title),"preset"in t&&n(2,i=t.preset),"options"in t&&n(3,s=t.options),"datasets"in t&&n(4,o=t.datasets)},t.$$.update=()=>{48&t.$$.dirty&&o.length!==g&&(m(),f(),n(5,g=o.length))},[r,d,i,s,o,g,function(t){uI[t?"unshift":"push"]((()=>{d=t,n(1,d)}))}]}lrt._date.override({_id:"luxon",_create:function(t){return iut.fromMillis(t,this.options)},init(t){this.options.locale||(this.options.locale=t.locale)},formats:function(){return out},parse:function(t,e){const n=this.options,r=typeof t;return null===t||"undefined"===r?null:("number"===r?t=this._create(t):"string"===r?t="string"==typeof e?iut.fromFormat(t,e,n):iut.fromISO(t,n):t instanceof Date?t=iut.fromJSDate(t,n):"object"!==r||t instanceof iut||(t=iut.fromObject(t,n)),t.isValid?t.valueOf():null)},format:function(t,e){const n=this._create(t);return"string"==typeof e?n.toFormat(e):n.toLocaleString(e)},add:function(t,e,n){const r={};return r[n]=e,this._create(t).plus(r).valueOf()},diff:function(t,e,n){return this._create(t).diff(this._create(e)).as(n).valueOf()},startOf:function(t,e,n){if("isoWeek"===e){n=Math.trunc(Math.min(Math.max(0,n),6));const e=this._create(t);return e.minus({days:(e.weekday-n+7)%7}).startOf("day").valueOf()}return e?this._create(t).startOf(e).valueOf():t},endOf:function(t,e){return this._create(t).endOf(e).valueOf()}});class uut extends HI{constructor(t){super(),WI(this,t,cut,lut,lN,{title:0,preset:2,options:3,datasets:4})}}var hut,dut,put;const fut={line:{global:{type:"line",options:{animation:{duration:200},scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:.2}},"line-fast":{global:{type:"line",options:{elements:{point:{radius:0}},animation:!1,tooltips:!1,spanGaps:!0,scales:{x:{ticks:{sampleSize:11}}}}},datasets:{fill:!1,lineTension:0}},bar:{global:{type:"bar",options:{animation:{duration:200},scales:{y:{beginAtZero:!0}}}}},"bar-fast":{global:{type:"bar",options:{animation:!1,scales:{y:{beginAtZero:!0}}}}},scatter:{global:{type:"scatter",options:{scales:{x:{type:"linear",position:"bottom"}}}}}};class mut extends mG{constructor({preset:t="line",options:e={}}={}){super(),this.title="generic chart",hut.set(this,void 0),dut.set(this,void 0),put.set(this,[]),Object.keys(fut).includes(t)||sG(new Error(`Preset ${t} is not recognized`)),BH(this,hut,t,"f"),BH(this,dut,fut[t],"f"),this.options=e,this.start()}addSeries(t,e,n={}){if(ZH(t)){if("line-fast"===zH(this,hut,"f")){const r=t.debounce(10);r.value=t.get(),zH(this,put,"f").push({dataStream:r,label:e,options:n})}else zH(this,put,"f").push({dataStream:t,label:e,options:n});this.updateView()}else t.toArray().then((t=>{const r=new JH(t,!0);zH(this,put,"f").push({dataStream:r,label:e,options:n}),this.updateView()}))}setColors(t){zH(this,put,"f")[0].label="clusters",zH(this,put,"f")[0].options.backgroundColor=t.get(),zH(this,put,"f")[0].options.color=t.get()}removeSeries(t){const e=zH(this,put,"f").map((t=>t.dataStream)).indexOf(t);e>-1&&zH(this,put,"f").splice(e,1)}clear(){BH(this,put,[],"f"),this.updateView()}updateView(){this.$$.app&&this.$$.app.$set({datasets:zH(this,put,"f")})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new uut({target:e,props:{title:this.title,preset:zH(this,dut,"f"),options:this.options,datasets:zH(this,put,"f")}}))}}function gut(...t){return new mut(...t)}function yut(t){let e,n;return{c(){e=new XN(!1),n=PN(),e.a=n},m(r,i){e.m(t[2],r,i),CN(r,n,i)},p(t,n){4&n&&e.p(t[2])},d(t){t&&AN(n),t&&e.d()}}}function but(t){let e,n=t[2]&&yut(t);return{c(){e=IN("div"),n&&n.c(),FN(e,"class","grow")},m(t,r){CN(t,e,r),n&&n.m(e,null)},p(t,r){t[2]?n?n.p(t,r):(n=yut(t),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(t){t&&AN(e),n&&n.d()}}}function vut(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[but]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),12&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function xut(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(2,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{text:a}=e;return s(),t.$$set=t=>{"title"in t&&n(0,o=t.title),"text"in t&&s(n(1,a=t.text))},[o,a,r]}hut=new WeakMap,dut=new WeakMap,put=new WeakMap;class wut extends HI{constructor(t){super(),WI(this,t,xut,vut,lN,{title:0,text:1})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),_I()}get text(){return this.$$.ctx[1]}set text(t){this.$$set({text:t}),_I()}}class _ut extends mG{constructor(t="click me"){super(),this.title="text",this.$value=new JH(t,!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new wut({target:e,props:{title:this.title,text:this.$value}}))}}function Sut(...t){return new _ut(...t)}var kut,Tut;class Eut extends mG{constructor(t){super(),this.title="confidence plot",kut.set(this,void 0),Tut.set(this,void 0),this.$confidenceStream=t.map((({confidences:t})=>Object.entries(t).map((([t,e])=>({x:t,y:e}))).sort(((t,e)=>t.x<e.x?-1:t.x>e.x?1:0)))),BH(this,kut,gut({preset:"bar-fast",options:{xlabel:"Label",ylabel:"Confidence",scales:{y:{suggestedMax:1}}}}),"f"),zH(this,kut,"f").addSeries(this.$confidenceStream,"Confidences"),zH(this,kut,"f").title="",BH(this,Tut,Sut("Waiting for predictions..."),"f"),zH(this,Tut,"f").title=this.title,zH(this,Tut,"f").$value=new JH(t.map((({label:t})=>`<p>Predicted Label: <code style="font-size: 1.5rem;">${t}</code></p>`)).startWith("Waiting for predictions..."),!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);if(!e)return;const n=document.createElement("div");n.id=`${e.id}-${zH(this,Tut,"f").id}`;const r=document.createElement("div");r.id=`${e.id}-${zH(this,kut,"f").id}`,e.appendChild(n),e.appendChild(r),zH(this,Tut,"f").title=this.title,zH(this,Tut,"f").mount(n),zH(this,kut,"f").mount(r),this.destroy=()=>{n.parentElement.removeChild(n),r.parentElement.removeChild(r),zH(this,Tut,"f").destroy(),zH(this,kut,"f").destroy()}}destroy(){zH(this,Tut,"f").destroy(),zH(this,kut,"f").destroy()}}kut=new WeakMap,Tut=new WeakMap;var Mut=Object.prototype.hasOwnProperty;function Cut(t,e,n){for(n of t.keys())if(Aut(n,e))return n}function Aut(t,e){var n,r,i;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&Aut(t[r],e[r]););return-1===r}if(n===Set){if(t.size!==e.size)return!1;for(r of t){if((i=r)&&"object"==typeof i&&!(i=Cut(e,i)))return!1;if(!e.has(i))return!1}return!0}if(n===Map){if(t.size!==e.size)return!1;for(r of t){if((i=r[0])&&"object"==typeof i&&!(i=Cut(e,i)))return!1;if(!Aut(r[1],e.get(i)))return!1}return!0}if(n===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(n===DataView){if((r=t.byteLength)===e.byteLength)for(;r--&&t.getInt8(r)===e.getInt8(r););return-1===r}if(ArrayBuffer.isView(t)){if((r=t.byteLength)===e.byteLength)for(;r--&&t[r]===e[r];);return-1===r}if(!n||"object"==typeof t){for(n in r=0,t){if(Mut.call(t,n)&&++r&&!Mut.call(e,n))return!1;if(!(n in e)||!Aut(t[n],e[n]))return!1}return Object.keys(e).length===r}}return t!=t&&e!=e}
/*!
     * chartjs-chart-matrix v1.2.0
     * https://chartjs-chart-matrix.pages.dev/
     * (c) 2022 Jukka Kurkela
     * Released under the MIT license
     */var Nut;class Iut extends Vnt{initialize(){this.enableOptionSharing=!0,super.initialize()}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,r){const i=this,s="reset"===r,{xScale:o,yScale:a}=i._cachedMeta,l=i.resolveDataElementOptions(e,r),c=i.getSharedOptions(r,t[e],l);for(let l=e;l<e+n;l++){const e=!s&&i.getParsed(l),n=s?o.getBasePixel():o.getPixelForValue(e.x),c=s?a.getBasePixel():a.getPixelForValue(e.y),u=i.resolveDataElementOptions(l,r),{width:h,height:d,anchorX:p,anchorY:f}=u,m={x:$ut(p,n,h),y:Rut(f,c,d),width:h,height:d,options:u};i.updateElement(t[l],l,m,r)}i.updateSharedOptions(c,r)}draw(){const t=this,e=t.getMeta().data||[];let n,r;for(n=0,r=e.length;n<r;++n)e[n].draw(t._ctx)}}function $ut(t,e,n){return"left"===t||"start"===t?e:"right"===t||"end"===t?e-n:e-n/2}function Rut(t,e,n){return"top"===t||"start"===t?e:"bottom"===t||"end"===t?e-n:e-n/2}function Out(t,e){const{x:n,y:r,width:i,height:s}=t.getProps(["x","y","width","height"],e);return{left:n,top:r,right:n+i,bottom:r+s}}function Put(t,e,n){return Math.max(Math.min(t,n),e)}function Lut(t){const e=Out(t),n=e.right-e.left,r=e.bottom-e.top,i=function(t,e,n){const r=t.options.borderWidth;let i,s,o,a;return y9(r)?(i=+r.top||0,s=+r.right||0,o=+r.bottom||0,a=+r.left||0):i=s=o=a=+r||0,{t:Put(i,0,n),r:Put(s,0,e),b:Put(o,0,n),l:Put(a,0,e)}}(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b}}}function Dut(t,e,n,r){const i=null===e,s=null===n,o=!(!t||i&&s)&&Out(t,r);return o&&(i||e>=o.left&&e<=o.right)&&(s||n>=o.top&&n<=o.bottom)}Iut.id="matrix",Iut.version="1.2.0",Iut.defaults={dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}},anchorX:"center",anchorY:"center"},Iut.overrides={interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}};class Fut extends Hrt{constructor(t){super(),this.options=void 0,this.width=void 0,this.height=void 0,t&&Object.assign(this,t)}draw(t){const e=this.options,{inner:n,outer:r}=Lut(this),i=vet(e.borderRadius);t.save(),r.w!==n.w||r.h!==n.h?(t.beginPath(),pet(t,{x:r.x,y:r.y,w:r.w,h:r.h,radius:i}),pet(t,{x:n.x,y:n.y,w:n.w,h:n.h,radius:i}),t.fillStyle=e.backgroundColor,t.fill(),t.fillStyle=e.borderColor,t.fill("evenodd")):(t.beginPath(),pet(t,{x:n.x,y:n.y,w:n.w,h:n.h,radius:i}),t.fillStyle=e.backgroundColor,t.fill()),t.restore()}inRange(t,e,n){return Dut(this,t,e,n)}inXRange(t,e){return Dut(this,t,null,e)}inYRange(t,e){return Dut(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,width:r,height:i}=this.getProps(["x","y","width","height"],t);return{x:e+r/2,y:n+i/2}}tooltipPosition(){return this.getCenterPoint()}getRange(t){return"x"===t?this.width/2:this.height/2}}function zut(t){let e;return{c(){e=IN("p"),e.textContent="Waiting for predictions...",FN(e,"class","m-2")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function But(t){let e,n,r,i,s,o,a,l,c=t[6].toFixed(2)+"";return{c(){e=IN("p"),n=RN("Global Accuracy: "),r=RN(c),i=ON(),s=IN("div"),o=IN("canvas"),FN(e,"class","m-2"),FN(s,"class","confusion-container svelte-1d2i0ke")},m(c,u){var h;CN(c,e,u),TN(e,n),TN(e,r),CN(c,i,u),CN(c,s,u),TN(s,o),a||(h=t[7].call(null,o),l=h&&aN(h.destroy)?h.destroy:nN,a=!0)},p(t,e){64&e&&c!==(c=t[6].toFixed(2)+"")&&BN(r,c)},d(t){t&&AN(e),t&&AN(i),t&&AN(s),a=!1,l()}}}function Uut(t){let e;function n(t,e){return void 0!==t[6]?But:zut}let r=n(t),i=r(t);return{c(){i.c(),e=PN()},m(t,n){i.m(t,n),CN(t,e,n)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},d(t){i.d(t),t&&AN(e)}}}function Vut(t){let e,n;return e=new OU({props:{title:t[0],loading:t[4],progress:t[5],$$slots:{default:[Uut]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16&n&&(r.loading=t[4]),32&n&&(r.progress=t[5]),131136&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function jut(t,e,n){let r,i,s,o=nN,a=()=>(o(),o=hN(p,(t=>n(4,r=t))),p),l=nN,c=()=>(l(),l=hN(f,(t=>n(5,i=t))),f),u=nN,h=()=>(u(),u=hN(m,(t=>n(6,s=t))),m);t.$$.on_destroy.push((()=>o())),t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u()));let{title:d}=e,{loading:p}=e;a();let{progress:f}=e;c();let{accuracy:m}=e;h();let{confusion:g}=e,{labels:y}=e,{selected:b}=e;Cit.register(Dst,_st,Pst,Fut,Iut);let v=1,x=1,w=-1;const _={type:"matrix",data:{datasets:[{label:"Confusion Matrix",data:[],backgroundColor(t){if(t.dataset.data.length>0){if(t.dataIndex===w){const{x:e,y:n}=t.dataset.data[t.dataIndex];return e===n?"green":"red"}return`rgba(54, 162, 235, ${t.dataset.data[t.dataIndex].v/v})`}return"rgba(54, 162, 235, 0)"},width(t){const e=t.chart.chartArea;return e?(e.right-e.left)/x-2:0},height(t){const e=t.chart.chartArea;return e?(e.bottom-e.top)/x-2:0}}]},options:{aspectRatio:1,legend:{display:!1},plugins:{tooltip:{callbacks:{title:([t])=>["count: "+t.dataset.data[t.dataIndex].v],label(t){const e=t.dataset.data[t.dataIndex];return["true label: "+e.y,"predicted label: "+e.x]}}}},scales:{x:{type:"category",labels:[],ticks:{display:!0,autoSkip:!1},gridLines:{display:!1},title:{display:!0,text:"Predicted Label"}},y:{type:"category",labels:[],offset:!0,reverse:!0,ticks:{display:!0,autoSkip:!1},gridLines:{display:!1},title:{display:!0,text:"True Label"}}},onClick(t){try{const e=t.chart.tooltip.dataPoints[0].dataIndex;w===e?(b.set(null),w=-1):(b.set(t.chart.tooltip.dataPoints[0].raw),w=e,t.chart.update())}catch(t){console.log("[confusion matrix] selection error:",t)}}}};let S,k=[];return sI((()=>{for(const t of k)t()})),t.$$set=t=>{"title"in t&&n(0,d=t.title),"loading"in t&&a(n(1,p=t.loading)),"progress"in t&&c(n(2,f=t.progress)),"accuracy"in t&&h(n(3,m=t.accuracy)),"confusion"in t&&n(8,g=t.confusion),"labels"in t&&n(9,y=t.labels),"selected"in t&&n(10,b=t.selected)},[d,p,f,m,r,i,s,function(t){const e=t.getContext("2d");S=new Cit(e,_),k.push(y.subscribe((t=>{x=t.length,_.options.scales.x.labels=t.sort(),_.options.scales.y.labels=t.sort(),S.update()}))),k.push(g.subscribe((t=>{v=t.reduce(((t,{v:e})=>Math.max(t,e)),0),_.data.datasets[0].data=t,S.update()})))},g,y,b]}Fut.id="matrix",Fut.defaults={backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:void 0,anchorY:void 0,width:20,height:20};class Wut extends HI{constructor(t){super(),WI(this,t,jut,Vut,lN,{title:0,loading:1,progress:2,accuracy:3,confusion:8,labels:9,selected:10})}}class Hut extends mG{constructor(t){super(),this.title="confusion matrix",Nut.set(this,void 0),this.$confusion=new JH([],!0),this.$accuracy=new JH(void 0,!0),this.$labels=new JH([],!0),this.$selected=new JH(null,!0),this.$progress=new JH(!1,!0),BH(this,Nut,t,"f"),this.start(),this.setup()}setup(){let t=[];zH(this,Nut,"f").$status.subscribe((async({status:e,count:n,total:r,data:i})=>{"start"===e?(t=[],this.$progress.set(null)):"running"===e?(t.push(i),this.$progress.set(n/r)):"loaded"===e?(t=await zH(this,Nut,"f").predictionService.items().query({$select:["id","label","yTrue"]}).toArray(),this.$progress.set(!1)):"loading"===e?(t=[],this.$progress.set(null)):this.$progress.set(!1),this.updateConfusionMatrix(t),this.updateAccuracy(t)}))}updateConfusionMatrix(t){const e=t.map((t=>t.label)),n=t.map((t=>t.yTrue)),r=Array.from(new Set(e.concat(n)));Aut(r,this.$labels.value)||this.$labels.set(r);const i=r.length,s=r.reduce(((t,e,n)=>({...t,[e]:n})),{}),o=Array.from(Array(i**2),(()=>0));for(let t=0;t<e.length;t+=1)o[s[e[t]]*i+s[n[t]]]+=1;const a=o.map(((t,e)=>({x:r[Math.floor(e/i)],y:r[e%i],v:t})));this.$confusion.set(a)}updateAccuracy(t){0===t.length?this.$accuracy.set(void 0):this.$accuracy.set(t.reduce(((t,{label:e,yTrue:n})=>t+(e===n?1:0)),0)/t.length)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Wut({target:e,props:{title:this.title,loading:zH(this,Nut,"f").$status.map((({status:t})=>"loading"===t)),progress:this.$progress,confusion:this.$confusion,accuracy:this.$accuracy,labels:this.$labels,selected:this.$selected}}))}}Nut=new WeakMap;const{window:Gut}=LI;function qut(t,e,n){const r=t.slice();return r[26]=e[n][0],r[27]=e[n][1].loaded,r[28]=e[n][1].total,r[29]=e[n][1].instances,r}function Xut(t,e,n){const r=t.slice();return r[32]=e[n].id,r[33]=e[n].thumbnail,r}function Yut(t){let e,n,r,i,s;function o(t,e){return t[6]>0?Zut:Kut}let a=o(t),l=a(t),c=Object.entries(t[5]),u=[];for(let e=0;e<c.length;e+=1)u[e]=eht(qut(t,c,e));const h=t=>II(u[t],1,1,(()=>{u[t]=null}));return{c(){l.c(),e=ON(),n=IN("div");for(let t=0;t<u.length;t+=1)u[t].c();FN(n,"class","flex flex-wrap")},m(o,a){l.m(o,a),CN(o,e,a),CN(o,n,a);for(let t=0;t<u.length;t+=1)u[t].m(n,null);r=!0,i||(s=LN(n,"click",t[18]),i=!0)},p(t,r){if(a===(a=o(t))&&l?l.p(t,r):(l.d(1),l=a(t),l&&(l.c(),l.m(e.parentNode,e))),6560&r[0]){let e;for(c=Object.entries(t[5]),e=0;e<c.length;e+=1){const i=qut(t,c,e);u[e]?(u[e].p(i,r),NI(u[e],1)):(u[e]=eht(i),u[e].c(),NI(u[e],1),u[e].m(n,null))}for(CI(),e=c.length;e<u.length;e+=1)h(e);AI()}},i(t){if(!r){for(let t=0;t<c.length;t+=1)NI(u[t]);r=!0}},o(t){u=u.filter(Boolean);for(let t=0;t<u.length;t+=1)II(u[t]);r=!1},d(t){l.d(t),t&&AN(e),t&&AN(n),NN(u,t),i=!1,s()}}}function Kut(t){let e;return{c(){e=IN("p"),e.textContent="This dataset is empty.",FN(e,"class","ml-3 mt-2")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function Zut(t){let e,n,r,i,s,o,a=t[6]>1?"s":"";return{c(){e=IN("p"),n=RN("This dataset contains "),r=RN(t[6]),i=RN(" instance"),s=RN(a),o=RN("."),FN(e,"class","ml-3 mt-2")},m(t,a){CN(t,e,a),TN(e,n),TN(e,r),TN(e,i),TN(e,s),TN(e,o)},p(t,e){64&e[0]&&BN(r,t[6]),64&e[0]&&a!==(a=t[6]>1?"s":"")&&BN(s,a)},d(t){t&&AN(e)}}}function Jut(t,e){let n,r,i,s,o,a,l;function c(){return e[16](e[32])}return{key:t,first:null,c(){n=IN("img"),uN(n.src,r=e[33])||FN(n,"src",r),FN(n,"alt","thumbnail"),FN(n,"class","m-1 svelte-14ms951"),GN(n,"selected",e[7].includes(e[32])),this.first=n},m(t,e){var r;CN(t,n,e),o=!0,a||(l=LN(n,"click",(r=c,function(t){return t.stopPropagation(),r.call(this,t)})),a=!0)},p(t,i){e=t,(!o||32&i[0]&&!uN(n.src,r=e[33]))&&FN(n,"src",r),(!o||160&i[0])&&GN(n,"selected",e[7].includes(e[32]))},i(t){o||(yI((()=>{s&&s.end(1),i=function(t,e,n){let r,i,s=e(t,n),o=!1,a=0;function l(){r&&QN(t,r)}function c(){const{delay:e=0,duration:n=300,easing:c=rN,tick:u=nN,css:h}=s||$I;h&&(r=JN(t,0,1,n,e,c,h,a++)),u(0,1);const d=xN()+e,p=d+n;i&&i.abort(),o=!0,yI((()=>TI(t,!0,"start"))),i=kN((e=>{if(o){if(e>=p)return u(1,0),TI(t,!0,"end"),l(),o=!1;if(e>=d){const t=c((e-d)/n);u(t,1-t)}}return o}))}let u=!1;return{start(){u||(u=!0,QN(t),aN(s)?(s=s(),kI().then(c)):c())},invalidate(){u=!1},end(){o&&(l(),o=!1)}}}(n,s$,{}),i.start()})),o=!0)},o(t){i&&i.invalidate(),s=function(t,e,n){let r,i=e(t,n),s=!0;const o=MI;function a(){const{delay:e=0,duration:n=300,easing:a=rN,tick:l=nN,css:c}=i||$I;c&&(r=JN(t,1,0,n,e,a,c));const u=xN()+e,h=u+n;yI((()=>TI(t,!1,"start"))),kN((e=>{if(s){if(e>=h)return l(0,1),TI(t,!1,"end"),--o.r||oN(o.c),!1;if(e>=u){const t=a((e-u)/n);l(1-t,t)}}return s}))}return o.r+=1,aN(i)?kI().then((()=>{i=i(),a()})):a(),{end(e){e&&i.tick&&i.tick(1,0),s&&(r&&QN(t,r),s=!1)}}}(n,s$,{}),o=!1},d(t){t&&AN(n),t&&s&&s.end(),a=!1,l()}}}function Qut(t){let e,n;return e=new XI({props:{size:"small",variant:"light",$$slots:{default:[tht]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[17](t[26])})),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(n,r){t=n;const i={};32&r[1]&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function tht(t){let e;return{c(){e=RN("View More")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function eht(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[26]+"",m=[],g=new Map;a=new A$({props:{actions:[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[7].length>0?[{code:"deleteInstances",text:"Delete selected instance"+(t[7].length>1?"s":"")},{code:"relabelInstances",text:"Relabel selected instance"+(t[7].length>1?"s":"")}]:[])}}),a.$on("select",(function(...e){return t[15](t[26],...e)}));let y=t[29];const b=t=>t[32];for(let e=0;e<y.length;e+=1){let n=Xut(t,y,e),r=b(n);g.set(r,m[e]=Jut(r,n))}let v=t[27]<t[28]&&Qut(t);return{c(){e=IN("div"),n=IN("div"),r=IN("div"),i=IN("span"),s=RN(f),o=ON(),UI(a.$$.fragment),l=ON(),c=IN("div");for(let t=0;t<m.length;t+=1)m[t].c();u=ON(),h=IN("div"),v&&v.c(),d=ON(),FN(i,"class","browser-class-title svelte-14ms951"),FN(r,"class","browser-class-header svelte-14ms951"),FN(c,"class","browser-class-body svelte-14ms951"),FN(n,"class","w-full"),FN(h,"class","pb-1"),FN(e,"class","browser-class svelte-14ms951")},m(t,f){CN(t,e,f),TN(e,n),TN(n,r),TN(r,i),TN(i,s),TN(r,o),VI(a,r,null),TN(n,l),TN(n,c);for(let t=0;t<m.length;t+=1)m[t].m(c,null);TN(e,u),TN(e,h),v&&v.m(h,null),TN(e,d),p=!0},p(e,n){t=e,(!p||32&n[0])&&f!==(f=t[26]+"")&&BN(s,f);const r={};128&n[0]&&(r.actions=[{code:"edit",text:"Edit class label"},{code:"delete",text:"Delete class"}].concat(t[7].length>0?[{code:"deleteInstances",text:"Delete selected instance"+(t[7].length>1?"s":"")},{code:"relabelInstances",text:"Relabel selected instance"+(t[7].length>1?"s":"")}]:[])),a.$set(r),2208&n[0]&&(y=t[29],CI(),m=zI(m,n,b,1,t,y,g,c,DI,Jut,null,Xut),AI()),t[27]<t[28]?v?(v.p(t,n),32&n[0]&&NI(v,1)):(v=Qut(t),v.c(),NI(v,1),v.m(h,null)):v&&(CI(),II(v,1,1,(()=>{v=null})),AI())},i(t){if(!p){NI(a.$$.fragment,t);for(let t=0;t<y.length;t+=1)NI(m[t]);NI(v),p=!0}},o(t){II(a.$$.fragment,t);for(let t=0;t<m.length;t+=1)II(m[t]);II(v),p=!1},d(t){t&&AN(e),jI(a);for(let t=0;t<m.length;t+=1)m[t].d();v&&v.d()}}}function nht(t){let e;return{c(){e=IN("div"),e.innerHTML='<svg class="inline flex-shrink-0 mr-3 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> \n      <div><span class="font-medium">Data Store connection Error!</span> This data store probably requires\n        authentication</div>',FN(e,"class","flex p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800"),FN(e,"role","alert")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function rht(t){let e,n,r,i=t[5]&&!t[4]&&Yut(t),s=t[4]&&nht();return{c(){i&&i.c(),e=ON(),s&&s.c(),n=PN()},m(t,o){i&&i.m(t,o),CN(t,e,o),s&&s.m(t,o),CN(t,n,o),r=!0},p(t,r){t[5]&&!t[4]?i?(i.p(t,r),48&r[0]&&NI(i,1)):(i=Yut(t),i.c(),NI(i,1),i.m(e.parentNode,e)):i&&(CI(),II(i,1,1,(()=>{i=null})),AI()),t[4]?s||(s=nht(),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(t){r||(NI(i),r=!0)},o(t){II(i),r=!1},d(t){i&&i.d(t),t&&AN(e),s&&s.d(t),t&&AN(n)}}}function iht(t){let e,n,r,i;return e=new OU({props:{title:t[0],loading:t[3],$$slots:{default:[rht]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(s,o){VI(e,s,o),n=!0,r||(i=[LN(Gut,"keydown",t[9]),LN(Gut,"keyup",t[10])],r=!0)},p(t,n){const r={};1&n[0]&&(r.title=t[0]),8&n[0]&&(r.loading=t[3]),240&n[0]|32&n[1]&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t),r=!1,oN(i)}}}function sht(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(h,(t=>n(6,r=t))),h),a=nN,l=()=>(a(),a=hN(p,(t=>n(7,i=t))),p);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{batchSize:u}=e,{count:h}=e;o();let{dataset:d}=e,{selected:p}=e;l();let f=!1,m=!1,g={};async function y(t){await d.ready;for await(const e of d.items().query({y:t,$sort:{updatedAt:-1}}).skip(g[t].loaded).take(u).select(["id","y","thumbnail"]))n(5,g[t].instances=[...g[t].instances,e],g),n(5,g[t].loaded+=1,g)}async function b(){if(f)return;n(3,f=!0);try{n(4,m=!1),await d.ready}catch(t){return n(3,f=!1),void n(4,m=!0)}const t=await d.distinct("y");n(5,g=t.reduce(((t,e)=>({...t,[e]:{total:0,loaded:0,instances:[]}})),{}));for(const e of t){const{total:t}=await d.find({query:{$limit:0,y:e}});if(n(5,g[e].total=t,g),u>0)await y(e);else for(;g[e].loaded<g[e].total;)await y(e)}n(3,f=!1)}function v(t){for(const[e,{instances:n}]of Object.entries(g))if(n.map((t=>t.id)).includes(t))return e;return null}async function x(){let t=Promise.resolve();for(const e of p.get())t=t.then((()=>d.remove(e)));await t,p.set([])}let w=!1,_=!1;let S=null;function k(t){if(w){if(!t)return;p.get().includes(t)?p.set(p.get().filter((e=>e!==t))):p.set(p.get().concat([t]))}else if(_){if(!S||!t)return;const e=v(S);if(e!==v(t))return;const n=g[e].instances.map((t=>t.id)),r=n.indexOf(S),i=n.indexOf(t);p.set(r<i?n.slice(r,i+1):n.slice(i,r+1))}else p.set(t?[t]:[]),S=t}function T(t,e){let n;switch(e){case"edit":n=window.prompt("Enter the new label",t),n&&d.patch(null,{y:n},{query:{y:t}});break;case"delete":d.remove(null,{query:{y:t}});break;case"deleteInstances":x();break;case"relabelInstances":n=window.prompt("Enter the new label",t),n&&async function(t){let e=Promise.resolve();for(const n of p.get())e=e.then((()=>d.patch(n,{y:t})));await e,p.set([])}(n);break;default:alert(`Class ${t}: ${e}`)}}rI((()=>{b(),d.$changes.subscribe((async t=>{for(const{level:e,type:r,data:i}of t)if("dataset"===e)"created"===r&&(k(),b());else if("instance"===e)if("created"===r)g[i.y]||n(5,g[i.y]={total:0,loaded:0,instances:[]},g),n(5,g[i.y].total+=1,g),n(5,g[i.y].loaded+=1,g),n(5,g[i.y].instances=[{id:i.id,y:i.y,thumbnail:i.thumbnail},...g[i.y].instances],g);else if("updated"===r){const t=v(i.id);n(5,g[t].total-=1,g),n(5,g[t].loaded-=1,g),n(5,g[t].instances=g[t].instances.filter((({id:t})=>t!==i.id)),g),0===g[t].total&&(delete g[t],n(5,g)),g[i.y]||n(5,g[i.y]={total:0,loaded:0,instances:[]},g),n(5,g[i.y].instances=[{id:i.id,y:i.y,thumbnail:i.thumbnail},...g[i.y].instances],g)}else"removed"===r&&(n(5,g[i.y].total-=1,g),n(5,g[i.y].loaded-=1,g),n(5,g[i.y].instances=g[i.y].instances.filter((({id:t})=>t!==i.id)),g),0===g[i.y].total&&(delete g[i.y],n(5,g)))}))}));return t.$$set=t=>{"title"in t&&n(0,c=t.title),"batchSize"in t&&n(13,u=t.batchSize),"count"in t&&o(n(1,h=t.count)),"dataset"in t&&n(14,d=t.dataset),"selected"in t&&l(n(2,p=t.selected))},[c,h,p,f,m,g,r,i,y,function(t){["Meta","Control"].includes(t.key)?w=!0:"Shift"===t.key?_=!0:("Delete"===t.key||"Backspace"===t.key&&w)&&x()},function(t){["Meta","Control"].includes(t.key)?w=!1:"Shift"===t.key&&(_=!1)},k,T,u,d,(t,e)=>T(t,e.detail),t=>k(t),t=>y(t),()=>k()]}class oht extends HI{constructor(t){super(),WI(this,t,sht,iht,lN,{title:0,batchSize:13,count:1,dataset:14,selected:2},null,[-1,-1])}}var aht;class lht extends mG{constructor(t,{batchSize:e=6}={}){super(),this.title="dataset browser",aht.set(this,void 0),this.$selected=new JH([],!0),BH(this,aht,t,"f"),this.batchSize=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new oht({target:e,props:{title:this.title,batchSize:this.batchSize,count:zH(this,aht,"f").$count,dataset:zH(this,aht,"f"),selected:this.$selected}}))}}
/*!
     * @kurkle/color v0.2.1
     * https://github.com/kurkle/color#readme
     * (c) 2022 Jukka Kurkela
     * Released under the MIT License
     */
function cht(t){return t+.5|0}aht=new WeakMap;const uht=(t,e,n)=>Math.max(Math.min(t,n),e);function hht(t){return uht(cht(2.55*t),0,255)}function dht(t){return uht(cht(255*t),0,255)}function pht(t){return uht(cht(t/2.55)/100,0,1)}function fht(t){return uht(cht(100*t),0,100)}const mht={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ght=[..."0123456789ABCDEF"],yht=t=>ght[15&t],bht=t=>ght[(240&t)>>4]+ght[15&t],vht=t=>(240&t)>>4==(15&t);function xht(t){var e=(t=>vht(t.r)&&vht(t.g)&&vht(t.b)&&vht(t.a))(t)?yht:bht;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const wht=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function _ht(t,e,n){const r=e*Math.min(n,1-n),i=(e,i=(e+t/30)%12)=>n-r*Math.max(Math.min(i-3,9-i,1),-1);return[i(0),i(8),i(4)]}function Sht(t,e,n){const r=(r,i=(r+t/60)%6)=>n-n*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function kht(t,e,n){const r=_ht(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function Tht(t){const e=t.r/255,n=t.g/255,r=t.b/255,i=Math.max(e,n,r),s=Math.min(e,n,r),o=(i+s)/2;let a,l,c;return i!==s&&(c=i-s,l=o>.5?c/(2-i-s):c/(i+s),a=function(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}(e,n,r,c,i),a=60*a+.5),[0|a,l||0,o]}function Eht(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(dht)}function Mht(t,e,n){return Eht(_ht,t,e,n)}function Cht(t){return(t%360+360)%360}function Aht(t){const e=wht.exec(t);let n,r=255;if(!e)return;e[5]!==n&&(r=e[6]?hht(+e[5]):dht(+e[5]));const i=Cht(+e[2]),s=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return Eht(kht,t,e,n)}(i,s,o):"hsv"===e[1]?function(t,e,n){return Eht(Sht,t,e,n)}(i,s,o):Mht(i,s,o),{r:n[0],g:n[1],b:n[2],a:r}}const Nht={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Iht={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let $ht;function Rht(t){$ht||($ht=function(){const t={},e=Object.keys(Iht),n=Object.keys(Nht);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,Nht[s]);s=parseInt(Iht[o],16),t[a]=[s>>16&255,s>>8&255,255&s]}return t}(),$ht.transparent=[0,0,0,0]);const e=$ht[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const Oht=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Pht=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Lht=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Dht(t,e,n){if(t){let r=Tht(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,0===e?360:1)),r=Mht(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function Fht(t,e){return t?Object.assign(e||{},t):t}function zht(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=dht(t[3]))):(e=Fht(t,{r:0,g:0,b:0,a:1})).a=dht(e.a),e}function Bht(t){return"r"===t.charAt(0)?function(t){const e=Oht.exec(t);let n,r,i,s=255;if(e){if(e[7]!==n){const t=+e[7];s=e[8]?hht(t):uht(255*t,0,255)}return n=+e[1],r=+e[3],i=+e[5],n=255&(e[2]?hht(n):uht(n,0,255)),r=255&(e[4]?hht(r):uht(r,0,255)),i=255&(e[6]?hht(i):uht(i,0,255)),{r:n,g:r,b:i,a:s}}}(t):Aht(t)}class Uht{constructor(t){if(t instanceof Uht)return t;const e=typeof t;let n;var r,i,s;"object"===e?n=zht(t):"string"===e&&(s=(r=t).length,"#"===r[0]&&(4===s||5===s?i={r:255&17*mht[r[1]],g:255&17*mht[r[2]],b:255&17*mht[r[3]],a:5===s?17*mht[r[4]]:255}:7!==s&&9!==s||(i={r:mht[r[1]]<<4|mht[r[2]],g:mht[r[3]]<<4|mht[r[4]],b:mht[r[5]]<<4|mht[r[6]],a:9===s?mht[r[7]]<<4|mht[r[8]]:255})),n=i||Rht(t)||Bht(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=Fht(this._rgb);return t&&(t.a=pht(t.a)),t}set rgb(t){this._rgb=zht(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${pht(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?xht(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=Tht(t),n=e[0],r=fht(e[1]),i=fht(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${pht(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,r=t.rgb;let i;const s=e===i?.5:e,o=2*s-1,a=n.a-r.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;i=1-l,n.r=255&l*n.r+i*r.r+.5,n.g=255&l*n.g+i*r.g+.5,n.b=255&l*n.b+i*r.b+.5,n.a=s*n.a+(1-s)*r.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const r=Lht(pht(t.r)),i=Lht(pht(t.g)),s=Lht(pht(t.b));return{r:dht(Pht(r+n*(Lht(pht(e.r))-r))),g:dht(Pht(i+n*(Lht(pht(e.g))-i))),b:dht(Pht(s+n*(Lht(pht(e.b))-s))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Uht(this.rgb)}alpha(t){return this._rgb.a=dht(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=cht(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Dht(this._rgb,2,t),this}darken(t){return Dht(this._rgb,2,-t),this}saturate(t){return Dht(this._rgb,1,t),this}desaturate(t){return Dht(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=Tht(t);n[0]=Cht(n[0]+e),n=Mht(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}var Vht={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2016 Jorik Tangelder;
     * Licensed under the MIT license */!function(t){!function(e,n,r,i){var s,o=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l=Math.round,c=Math.abs,u=Date.now;function h(t,e,n){return setTimeout(b(t,n),e)}function d(t,e,n){return!!Array.isArray(t)&&(p(t,n[e],n),!0)}function p(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function f(t,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,i,r),t.apply(this,arguments)}}s="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])}return e}:Object.assign;var m=f((function(t,e,n){for(var r=Object.keys(e),s=0;s<r.length;)(!n||n&&t[r[s]]===i)&&(t[r[s]]=e[r[s]]),s++;return t}),"extend","Use `assign`."),g=f((function(t,e){return m(t,e,!0)}),"merge","Use `assign`.");function y(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&s(r,n)}function b(t,e){return function(){return t.apply(e,arguments)}}function v(t,e){return"function"==typeof t?t.apply(e&&e[0]||i,e):t}function x(t,e){return t===i?e:t}function w(t,e,n){p(T(e),(function(e){t.addEventListener(e,n,!1)}))}function _(t,e,n){p(T(e),(function(e){t.removeEventListener(e,n,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function k(t,e){return t.indexOf(e)>-1}function T(t){return t.trim().split(/\s+/g)}function E(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function M(t){return Array.prototype.slice.call(t,0)}function C(t,e,n){for(var r=[],i=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];E(i,o)<0&&r.push(t[s]),i[s]=o,s++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function A(t,e){for(var n,r,s=e[0].toUpperCase()+e.slice(1),a=0;a<o.length;){if((r=(n=o[a])?n+s:e)in t)return r;a++}return i}var N=1;function I(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var $="ontouchstart"in e,R=A(e,"PointerEvent")!==i,O=$&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),P="touch",L="mouse",D=24,F=["x","y"],z=["clientX","clientY"];function B(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){v(t.options.enable,[t])&&n.handler(e)},this.init()}function U(t,e,n){var r=n.pointers.length,s=n.changedPointers.length,o=1&e&&r-s==0,a=12&e&&r-s==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,s=r.length;n.firstInput||(n.firstInput=V(e));s>1&&!n.firstMultiple?n.firstMultiple=V(e):1===s&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,l=a?a.center:o.center,h=e.center=j(r);e.timeStamp=u(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=q(l,h),e.distance=G(l,h),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},s=t.prevInput||{};1!==e.eventType&&4!==s.eventType||(i=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=H(e.deltaX,e.deltaY);var d=W(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=c(d.x)>c(d.y)?d.x:d.y,e.scale=a?(p=a.pointers,f=r,G(f[0],f[1],z)/G(p[0],p[1],z)):1,e.rotation=a?function(t,e){return q(e[1],e[0],z)+q(t[1],t[0],z)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,s,o,a=t.lastInterval||e,l=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(l>25||a.velocity===i)){var u=e.deltaX-a.deltaX,h=e.deltaY-a.deltaY,d=W(l,u,h);r=d.x,s=d.y,n=c(d.x)>c(d.y)?d.x:d.y,o=H(u,h),t.lastInterval=e}else n=a.velocity,r=a.velocityX,s=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=s,e.direction=o}(n,e);var p,f;var m=t.element;S(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function V(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:l(t.pointers[n].clientX),clientY:l(t.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:e,center:j(e),deltaX:t.deltaX,deltaY:t.deltaY}}function j(t){var e=t.length;if(1===e)return{x:l(t[0].clientX),y:l(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:l(n/e),y:l(r/e)}}function W(t,e,n){return{x:e/t||0,y:n/t||0}}function H(t,e){return t===e?1:c(t)>=c(e)?t<0?2:4:e<0?8:16}function G(t,e,n){n||(n=F);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function q(t,e,n){n||(n=F);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}B.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(I(this.element),this.evWin,this.domHandler)}};var X={mousedown:1,mousemove:2,mouseup:4},Y="mousedown",K="mousemove mouseup";function Z(){this.evEl=Y,this.evWin=K,this.pressed=!1,B.apply(this,arguments)}y(Z,B,{handler:function(t){var e=X[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:L,srcEvent:t}))}});var J={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:P,3:"pen",4:L,5:"kinect"},tt="pointerdown",et="pointermove pointerup pointercancel";function nt(){this.evEl=tt,this.evWin=et,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(tt="MSPointerDown",et="MSPointerMove MSPointerUp MSPointerCancel"),y(nt,B,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=J[r],s=Q[t.pointerType]||t.pointerType,o=s==P,a=E(e,t.pointerId,"pointerId");1&i&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):12&i&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var rt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},it="touchstart",st="touchstart touchmove touchend touchcancel";function ot(){this.evTarget=it,this.evWin=st,this.started=!1,B.apply(this,arguments)}function at(t,e){var n=M(t.touches),r=M(t.changedTouches);return 12&e&&(n=C(n.concat(r),"identifier",!0)),[n,r]}y(ot,B,{handler:function(t){var e=rt[t.type];if(1===e&&(this.started=!0),this.started){var n=at.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:P,srcEvent:t})}}});var lt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ct="touchstart touchmove touchend touchcancel";function ut(){this.evTarget=ct,this.targetIds={},B.apply(this,arguments)}function ht(t,e){var n=M(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,s,o=M(t.changedTouches),a=[],l=this.target;if(s=n.filter((function(t){return S(t.target,l)})),1===e)for(i=0;i<s.length;)r[s[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&a.push(o[i]),12&e&&delete r[o[i].identifier],i++;return a.length?[C(s.concat(a),"identifier",!0),a]:void 0}y(ut,B,{handler:function(t){var e=lt[t.type],n=ht.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:P,srcEvent:t})}});function dt(){B.apply(this,arguments);var t=b(this.handler,this);this.touch=new ut(this.manager,t),this.mouse=new Z(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function pt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ft.call(this,e)):12&t&&ft.call(this,e)}function ft(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function mt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],s=Math.abs(e-i.x),o=Math.abs(n-i.y);if(s<=25&&o<=25)return!0}return!1}y(dt,B,{handler:function(t,e,n){var r=n.pointerType==P,i=n.pointerType==L;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)pt.call(this,e,n);else if(i&&mt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var gt=A(a.style,"touchAction"),yt=gt!==i,bt="compute",vt="auto",xt="manipulation",wt="none",_t="pan-x",St="pan-y",kt=function(){if(!yt)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!n||e.CSS.supports("touch-action",r)})),t}();function Tt(t,e){this.manager=t,this.set(e)}Tt.prototype={set:function(t){t==bt&&(t=this.compute()),yt&&this.manager.element.style&&kt[t]&&(this.manager.element.style[gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return p(this.manager.recognizers,(function(e){v(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(k(t,wt))return wt;var e=k(t,_t),n=k(t,St);if(e&&n)return wt;if(e||n)return e?_t:St;if(k(t,xt))return xt;return vt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=k(r,wt)&&!kt.none,s=k(r,St)&&!kt["pan-y"],o=k(r,_t)&&!kt["pan-x"];if(i){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}if(!o||!s)return i||s&&6&n||o&&n&D?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Et=32;function Mt(t){this.options=s({},this.defaults,t||{}),this.id=N++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ct(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function At(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Nt(t,e){var n=e.manager;return n?n.get(t):t}function It(){Mt.apply(this,arguments)}function $t(){It.apply(this,arguments),this.pX=null,this.pY=null}function Rt(){It.apply(this,arguments)}function Ot(){Mt.apply(this,arguments),this._timer=null,this._input=null}function Pt(){It.apply(this,arguments)}function Lt(){It.apply(this,arguments)}function Dt(){Mt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ft(t,e){return(e=e||{}).recognizers=x(e.recognizers,Ft.defaults.preset),new zt(t,e)}Mt.prototype={defaults:{},set:function(t){return s(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Nt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return d(t,"dropRecognizeWith",this)||(t=Nt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===E(e,t=Nt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(d(t,"dropRequireFailure",this))return this;t=Nt(t,this);var e=E(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Ct(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Ct(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Et},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=s({},t);if(!v(this.options.enable,[this,e]))return this.reset(),void(this.state=Et);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},y(It,Mt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:Et}}),y($t,It,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(St),t&D&&e.push(_t),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,s=t.deltaX,o=t.deltaY;return i&e.direction||(6&e.direction?(i=0===s?1:s<0?2:4,n=s!=this.pX,r=Math.abs(t.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return It.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=At(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),y(Rt,It,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),y(Ot,Mt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[vt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=h((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Et},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),y(Pt,It,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),y(Lt,It,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return $t.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&D&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=At(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),y(Dt,Mt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||G(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=h((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Et},failTimeout:function(){return this._timer=h((function(){this.state=Et}),this.options.interval,this),Et},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ft.VERSION="2.0.7",Ft.defaults={domEvents:!1,touchAction:bt,enable:!0,inputTarget:null,inputClass:null,preset:[[Pt,{enable:!1}],[Rt,{enable:!1},["rotate"]],[Lt,{direction:6}],[$t,{direction:6},["swipe"]],[Dt],[Dt,{event:"doubletap",taps:2},["tap"]],[Ot]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function zt(t,e){this.options=s({},Ft.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){return new(t.options.inputClass||(R?nt:O?ut:$?dt:Z))(t,U)}(this),this.touchAction=new Tt(this,this.options.touchAction),Bt(this,!0),p(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Bt(t,e){var n,r=t.element;r.style&&(p(t.options.cssProps,(function(i,s){n=A(r.style,s),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}zt.prototype={set:function(t){return s(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var s=0;s<r.length;)n=r[s],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),s++}},get:function(t){if(t instanceof Mt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=E(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return p(T(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==i){var n=this.handlers;return p(T(t),(function(t){e?n[t]&&n[t].splice(E(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var r=n.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=e,e.target.dispatchEvent(r)}(t,e);var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](e),i++}},destroy:function(){this.element&&Bt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},s(Ft,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Et,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:D,DIRECTION_ALL:30,Manager:zt,Input:B,TouchAction:Tt,TouchInput:ut,MouseInput:Z,PointerEventInput:nt,TouchMouseInput:dt,SingleTouchInput:ot,Recognizer:Mt,AttrRecognizer:It,Tap:Dt,Pan:$t,Swipe:Lt,Pinch:Rt,Rotate:Pt,Press:Ot,on:w,off:_,each:p,merge:g,extend:m,assign:s,inherit:y,bindFn:b,prefixed:A}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Ft,t.exports?t.exports=Ft:e.Hammer=Ft}(window,document)}(Vht);var jht=Vht.exports;
/*!
    * chartjs-plugin-zoom v1.2.1
    * undefined
     * (c) 2016-2022 chartjs-plugin-zoom Contributors
     * Released under the MIT License
     */const Wht=t=>t&&t.enabled&&t.modifierKey,Hht=(t,e)=>t&&e[t+"Key"],Ght=(t,e)=>t&&!e[t+"Key"];function qht(t,e,n){return void 0===t||("string"==typeof t?-1!==t.indexOf(e):"function"==typeof t&&-1!==t({chart:n}).indexOf(e))}function Xht(t,e,n){const r=function({x:t,y:e},n){const r=n.scales,i=Object.keys(r);for(let n=0;n<i.length;n++){const s=r[i[n]];if(e>=s.top&&e<=s.bottom&&t>=s.left&&t<=s.right)return s}return null}(e,n);if(r&&qht(t,r.axis,n))return[r];const i=[];return S9(n.scales,(function(e){qht(t,e.axis,n)||i.push(e)})),i}const Yht=new WeakMap;function Kht(t){let e=Yht.get(t);return e||(e={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{}},Yht.set(t,e)),e}function Zht(t,e,n){const r=t.max-t.min,i=r*(e-1),s=t.isHorizontal()?n.x:n.y,o=Math.max(0,Math.min(1,(t.getValueForPixel(s)-t.min)/r||0));return{min:i*o,max:i*(1-o)}}function Jht(t,e,n,r,i){let s=n[r];if("original"===s){const n=t.originalScaleLimits[e.id][r];s=x9(n.options,n.scale)}return x9(s,i)}function Qht(t,{min:e,max:n},r,i=!1){const s=Kht(t.chart),{id:o,axis:a,options:l}=t,c=r&&(r[o]||r[a])||{},{minRange:u=0}=c,h=Jht(s,t,c,"min",-1/0),d=Jht(s,t,c,"max",1/0),p=Math.max(e,h),f=Math.min(n,d),m=i?Math.max(f-p,u):t.max-t.min;if(f-p!==m)if(h>f-m)e=p,n=p+m;else if(d<p+m)n=f,e=f-m;else{const t=(m-f+p)/2;e=p-t,n=f+t}else e=p,n=f;return l.min=e,l.max=n,s.updatedScaleLimits[t.id]={min:e,max:n},t.parse(e)!==t.min||t.parse(n)!==t.max}const tdt=t=>0===t||isNaN(t)?0:t<0?Math.min(Math.round(t),-1):Math.max(Math.round(t),1);const edt={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function ndt(t,e,n,r=!1){const{min:i,max:s,options:o}=t,a=o.time&&o.time.round,l=edt[a]||0,c=t.getValueForPixel(t.getPixelForValue(i+l)-e),u=t.getValueForPixel(t.getPixelForValue(s+l)-e),{min:h=-1/0,max:d=1/0}=r&&n&&n[t.axis]||{};return!!(isNaN(c)||isNaN(u)||c<h||u>d)||Qht(t,{min:c,max:u},n,r)}function rdt(t,e,n){return ndt(t,e,n,!0)}const idt={category:function(t,e,n,r){const i=Zht(t,e,n);return t.min===t.max&&e<1&&function(t){const e=t.getLabels().length-1;t.min>0&&(t.min-=1),t.max<e&&(t.max+=1)}(t),Qht(t,{min:t.min+tdt(i.min),max:t.max-tdt(i.max)},r,!0)},default:function(t,e,n,r){const i=Zht(t,e,n);return Qht(t,{min:t.min+i.min,max:t.max-i.max},r,!0)}},sdt={category:function(t,e,n){const r=t.getLabels().length-1;let{min:i,max:s}=t;const o=Math.max(s-i,1),a=Math.round(function(t){return t.isHorizontal()?t.width:t.height}(t)/Math.max(o,10)),l=Math.round(Math.abs(e/a));let c;return e<-a?(s=Math.min(s+l,r),i=1===o?s:s-o,c=s===r):e>a&&(i=Math.max(0,i-l),s=1===o?i:i+o,c=0===i),Qht(t,{min:i,max:s},n)||c},default:ndt,logarithmic:rdt,timeseries:rdt};function odt(t,e){S9(t,((n,r)=>{e[r]||delete t[r]}))}function adt(t,e){const{scales:n}=t,{originalScaleLimits:r,updatedScaleLimits:i}=e;return S9(n,(function(t){(function(t,e,n){const{id:r,options:{min:i,max:s}}=t;if(!e[r]||!n[r])return!0;const o=n[r];return o.min!==i||o.max!==s})(t,r,i)&&(r[t.id]={min:{scale:t.min,options:t.options.min},max:{scale:t.max,options:t.options.max}})})),odt(r,n),odt(i,n),r}function ldt(t,e,n,r){_9(idt[t.type]||idt.default,[t,e,n,r])}function cdt(t){const e=t.chartArea;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}function udt(t,e,n="none"){const{x:r=1,y:i=1,focalPoint:s=cdt(t)}="number"==typeof e?{x:e,y:e}:e,o=Kht(t),{options:{limits:a,zoom:l}}=o,{mode:c="xy",overScaleMode:u}=l||{};adt(t,o);const h=1!==r&&qht(c,"x",t),d=1!==i&&qht(c,"y",t);S9(u&&Xht(u,s,t)||t.scales,(function(t){t.isHorizontal()&&h?ldt(t,r,s,a):!t.isHorizontal()&&d&&ldt(t,i,s,a)})),t.update(n),_9(l.onZoom,[{chart:t}])}function hdt(t,e,n){const r=t.getValueForPixel(e),i=t.getValueForPixel(n);return{min:Math.min(r,i),max:Math.max(r,i)}}function ddt(t){const e=Kht(t);let n=1,r=1;return S9(t.scales,(function(t){const i=function(t,e){const n=t.originalScaleLimits[e];if(!n)return;const{min:r,max:i}=n;return x9(i.options,i.scale)-x9(r.options,r.scale)}(e,t.id);if(i){const e=Math.round(i/(t.max-t.min)*100)/100;n=Math.min(n,e),r=Math.max(r,e)}})),n<1?n:r}function pdt(t,e,n,r){const{panDelta:i}=r,s=i[t.id]||0;G9(s)===G9(e)&&(e+=s);_9(sdt[t.type]||sdt.default,[t,e,n])?i[t.id]=0:i[t.id]=e}function fdt(t,e,n,r="none"){const{x:i=0,y:s=0}="number"==typeof e?{x:e,y:e}:e,o=Kht(t),{options:{pan:a,limits:l}}=o,{mode:c="xy",onPan:u}=a||{};adt(t,o);const h=0!==i&&qht(c,"x",t),d=0!==s&&qht(c,"y",t);S9(n||t.scales,(function(t){t.isHorizontal()&&h?pdt(t,i,l,o):!t.isHorizontal()&&d&&pdt(t,s,l,o)})),t.update(r),_9(u,[{chart:t}])}function mdt(t){const e=Kht(t),n={};for(const r of Object.keys(t.scales)){const{min:t,max:i}=e.originalScaleLimits[r]||{min:{},max:{}};n[r]={min:t.scale,max:i.scale}}return n}function gdt(t,e){const{handlers:n}=Kht(t),r=n[e];r&&r.target&&(r.target.removeEventListener(e,r),delete n[e])}function ydt(t,e,n,r){const{handlers:i,options:s}=Kht(t),o=i[n];o&&o.target===e||(gdt(t,n),i[n]=e=>r(t,e,s),i[n].target=e,e.addEventListener(n,i[n]))}function bdt(t,e){const n=Kht(t);n.dragStart&&(n.dragging=!0,n.dragEnd=e,t.update("none"))}function vdt(t,e,n){const{onZoomStart:r,onZoomRejected:i}=n;if(r){const{left:n,top:s}=e.target.getBoundingClientRect();if(!1===_9(r,[{chart:t,event:e,point:{x:e.clientX-n,y:e.clientY-s}}]))return _9(i,[{chart:t,event:e}]),!1}}function xdt(t,e){const n=Kht(t),{pan:r,zoom:i={}}=n.options;if(Hht(Wht(r),e)||Ght(Wht(i.drag),e))return _9(i.onZoomRejected,[{chart:t,event:e}]);!1!==vdt(t,e,i)&&(n.dragStart=e,ydt(t,t.canvas,"mousemove",bdt))}function wdt(t,e,n,r){const{left:i,top:s}=n.target.getBoundingClientRect(),o=qht(e,"x",t),a=qht(e,"y",t);let{top:l,left:c,right:u,bottom:h,width:d,height:p}=t.chartArea;o&&(c=Math.min(n.clientX,r.clientX)-i,u=Math.max(n.clientX,r.clientX)-i),a&&(l=Math.min(n.clientY,r.clientY)-s,h=Math.max(n.clientY,r.clientY)-s);const f=u-c,m=h-l;return{left:c,top:l,right:u,bottom:h,width:f,height:m,zoomX:o&&f?1+(d-f)/d:1,zoomY:a&&m?1+(p-m)/p:1}}function _dt(t,e){const n=Kht(t);if(!n.dragStart)return;gdt(t,"mousemove");const{mode:r,onZoomComplete:i,drag:{threshold:s=0}}=n.options.zoom,o=wdt(t,r,n.dragStart,e),a=qht(r,"x",t)?o.width:0,l=qht(r,"y",t)?o.height:0,c=Math.sqrt(a*a+l*l);if(n.dragStart=n.dragEnd=null,c<=s)return n.dragging=!1,void t.update("none");!function(t,e,n,r="none"){const i=Kht(t),{options:{limits:s,zoom:o}}=i,{mode:a="xy"}=o;adt(t,i);const l=qht(a,"x",t),c=qht(a,"y",t);S9(t.scales,(function(t){t.isHorizontal()&&l?Qht(t,hdt(t,e.x,n.x),s,!0):!t.isHorizontal()&&c&&Qht(t,hdt(t,e.y,n.y),s,!0)})),t.update(r),_9(o.onZoom,[{chart:t}])}(t,{x:o.left,y:o.top},{x:o.right,y:o.bottom},"zoom"),setTimeout((()=>n.dragging=!1),500),_9(i,[{chart:t}])}function Sdt(t,e){const{handlers:{onZoomComplete:n},options:{zoom:r}}=Kht(t);if(!function(t,e,n){if(Ght(Wht(n.wheel),e))_9(n.onZoomRejected,[{chart:t,event:e}]);else if(!1!==vdt(t,e,n)&&(e.cancelable&&e.preventDefault(),void 0!==e.deltaY))return!0}(t,e,r))return;const i=e.target.getBoundingClientRect(),s=1+(e.deltaY>=0?-r.wheel.speed:r.wheel.speed);udt(t,{x:s,y:s,focalPoint:{x:e.clientX-i.left,y:e.clientY-i.top}}),n&&n()}function kdt(t,e,n,r){n&&(Kht(t).handlers[e]=function(t,e){let n;return function(){return clearTimeout(n),n=setTimeout(t,e),e}}((()=>_9(n,[{chart:t}])),r))}function Tdt(t,e){return function(n,r){const{pan:i,zoom:s={}}=e.options;if(!i||!i.enabled)return!1;const o=r&&r.srcEvent;return!o||(!(!e.panning&&"mouse"===r.pointerType&&(Ght(Wht(i),o)||Hht(Wht(s.drag),o)))||(_9(i.onPanRejected,[{chart:t,event:r}]),!1))}}function Edt(t,e,n){if(e.scale){const{center:r,pointers:i}=n,s=1/e.scale*n.scale,o=n.target.getBoundingClientRect(),a=function(t,e){const n=Math.abs(t.clientX-e.clientX),r=Math.abs(t.clientY-e.clientY),i=n/r;let s,o;return i>.3&&i<1.7?s=o=!0:n>r?s=!0:o=!0,{x:s,y:o}}(i[0],i[1]),l=e.options.zoom.mode;udt(t,{x:a.x&&qht(l,"x",t)?s:1,y:a.y&&qht(l,"y",t)?s:1,focalPoint:{x:r.x-o.left,y:r.y-o.top}}),e.scale=n.scale}}function Mdt(t,e,n){const r=e.delta;r&&(e.panning=!0,fdt(t,{x:n.deltaX-r.x,y:n.deltaY-r.y},e.panScales),e.delta={x:n.deltaX,y:n.deltaY})}const Cdt=new WeakMap;function Adt(t,e){const n=Kht(t),r=t.canvas,{pan:i,zoom:s}=e,o=new jht.Manager(r);s&&s.pinch.enabled&&(o.add(new jht.Pinch),o.on("pinchstart",(()=>function(t,e){e.options.zoom.pinch.enabled&&(e.scale=1)}(0,n))),o.on("pinch",(e=>Edt(t,n,e))),o.on("pinchend",(e=>function(t,e,n){e.scale&&(Edt(t,e,n),e.scale=null,_9(e.options.zoom.onZoomComplete,[{chart:t}]))}(t,n,e)))),i&&i.enabled&&(o.add(new jht.Pan({threshold:i.threshold,enable:Tdt(t,n)})),o.on("panstart",(e=>function(t,e,n){const{enabled:r,overScaleMode:i,onPanStart:s,onPanRejected:o}=e.options.pan;if(!r)return;const a=n.target.getBoundingClientRect(),l={x:n.center.x-a.left,y:n.center.y-a.top};if(!1===_9(s,[{chart:t,event:n,point:l}]))return _9(o,[{chart:t,event:n}]);e.panScales=i&&Xht(i,l,t),e.delta={x:0,y:0},clearTimeout(e.panEndTimeout),Mdt(t,e,n)}(t,n,e))),o.on("panmove",(e=>Mdt(t,n,e))),o.on("panend",(()=>function(t,e){e.delta=null,e.panning&&(e.panEndTimeout=setTimeout((()=>e.panning=!1),500),_9(e.options.pan.onPanComplete,[{chart:t}]))}(t,n)))),Cdt.set(t,o)}var Ndt={id:"zoom",version:"1.2.1",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(t,e,n){Kht(t).options=n,Object.prototype.hasOwnProperty.call(n.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),jht&&Adt(t,n),t.pan=(e,n,r)=>fdt(t,e,n,r),t.zoom=(e,n)=>udt(t,e,n),t.zoomScale=(e,n,r)=>function(t,e,n,r="none"){adt(t,Kht(t)),Qht(t.scales[e],n,void 0,!0),t.update(r)}(t,e,n,r),t.resetZoom=e=>function(t,e="default"){const n=Kht(t),r=adt(t,n);S9(t.scales,(function(t){const e=t.options;r[t.id]?(e.min=r[t.id].min.options,e.max=r[t.id].max.options):(delete e.min,delete e.max)})),t.update(e),_9(n.options.zoom.onZoomComplete,[{chart:t}])}(t,e),t.getZoomLevel=()=>ddt(t),t.getInitialScaleBounds=()=>mdt(t),t.isZoomedOrPanned=()=>function(t){const e=mdt(t);for(const n of Object.keys(t.scales)){const{min:r,max:i}=e[n];if(void 0!==r&&t.scales[n].min!==r)return!0;if(void 0!==i&&t.scales[n].max!==i)return!0}return!1}(t)},beforeEvent(t){const e=Kht(t);if(e.panning||e.dragging)return!1},beforeUpdate:function(t,e,n){Kht(t).options=n,function(t,e){const n=t.canvas,{wheel:r,drag:i,onZoomComplete:s}=e.zoom;r.enabled?(ydt(t,n,"wheel",Sdt),kdt(t,"onZoomComplete",s,250)):gdt(t,"wheel"),i.enabled?(ydt(t,n,"mousedown",xdt),ydt(t,n.ownerDocument,"mouseup",_dt)):(gdt(t,"mousedown"),gdt(t,"mousemove"),gdt(t,"mouseup"))}(t,n)},beforeDatasetsDraw:function(t,e,n){const{dragStart:r,dragEnd:i}=Kht(t);if(i){const{left:e,top:s,width:o,height:a}=wdt(t,n.zoom.mode,r,i),l=n.zoom.drag,c=t.ctx;c.save(),c.beginPath(),c.fillStyle=l.backgroundColor||"rgba(225,225,225,0.3)",c.fillRect(e,s,o,a),l.borderWidth>0&&(c.lineWidth=l.borderWidth,c.strokeStyle=l.borderColor||"rgba(225,225,225)",c.strokeRect(e,s,o,a)),c.restore()}},stop:function(t){!function(t){gdt(t,"mousedown"),gdt(t,"mousemove"),gdt(t,"mouseup"),gdt(t,"wheel"),gdt(t,"click")}(t),jht&&function(t){const e=Cdt.get(t);e&&(e.remove("pinchstart"),e.remove("pinch"),e.remove("pinchend"),e.remove("panstart"),e.remove("pan"),e.remove("panend"),e.destroy(),Cdt.delete(t))}(t),function(t){Yht.delete(t)}(t)},panFunctions:sdt,zoomFunctions:idt};function Idt(t){let e;return{c(){e=RN("Reset Zoom")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function $dt(t){let e,n,r,i,s,o;return s=new XI({props:{size:"small",$$slots:{default:[Idt]},$$scope:{ctx:t}}}),s.$on("click",t[8]),{c(){e=IN("div"),n=IN("canvas"),r=ON(),i=IN("div"),UI(s.$$.fragment),FN(e,"id","scatter-container"),FN(e,"class","svelte-ei9k3k"),FN(i,"class","flex justify-end")},m(a,l){CN(a,e,l),TN(e,n),t[7](n),CN(a,r,l),CN(a,i,l),VI(s,i,null),o=!0},p(t,e){const n={};8192&e&&(n.$$scope={dirty:e,ctx:t}),s.$set(n)},i(t){o||(NI(s.$$.fragment,t),o=!0)},o(t){II(s.$$.fragment,t),o=!1},d(n){n&&AN(e),t[7](null),n&&AN(r),n&&AN(i),jI(s)}}}function Rdt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[$dt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8198&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Odt(t,e,n){Cit.register(yst,xst,Hit,Ust,qit,irt,_st,Pst),Cit.register(Ndt);let{title:r}=e,{data:i}=e,{hovered:s}=e,{clicked:o}=e;function a(t){const{chart:e,tooltip:n}=t,r=(t=>{let e=t.canvas.parentNode.querySelector("div");if(!e){e=document.createElement("div"),e.style.background="transparent",e.style.borderRadius="3px",e.style.color="white",e.style.opacity=1,e.style.pointerEvents="none",e.style.position="absolute",e.style.transform="translate(-50%, 0)",e.style.transition="all .1s ease";const n=document.createElement("img");n.style.borderRadius="4px",n.style.margin="0px",n.width=100,n.height=100,e.appendChild(n),t.canvas.parentNode.appendChild(e)}return e})(e);if(0===n.opacity)return void(r.style.opacity=0);r.querySelector("img").src=n.dataPoints[0].raw.thumbnail;const{offsetLeft:i,offsetTop:s}=e.canvas;r.style.opacity=1,r.style.left=i+n.caretX+70+"px",r.style.top=s+n.caretY+20+"px",r.style.font=n.options.bodyFont.string,r.style.padding=n.options.padding+"px "+n.options.padding+"px"}const l={type:"scatter",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:200},scales:{y:{position:"center",ticks:{display:!1}},x:{position:"center",ticks:{display:!1}}},elements:{point:{radius:8,hoverRadius:10,borderWidth:0,hoverBorderWidth:3}},plugins:{legend:{position:"top"},tooltip:{enabled:!1,position:"nearest",external:a},zoom:{zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"}}},onClick(t,e){o.set(e.map((({element:t})=>t)))},onHover(t,e){const n=e.map((({element:t})=>{var e,n;return null===(n=null===(e=null==t?void 0:t.$context)||void 0===e?void 0:e.raw)||void 0===n?void 0:n.id}));Aut(n,s.get())||s.set(n)}}};let c,u,h=()=>{};rI((async()=>{await gI(),await gI(),async function(){h();const t={...l,data:i.get()};h=i.filter((t=>!!t)).subscribe((e=>{t.data=e,c.update(),c.resetZoom()}));const e=u.getContext("2d");n(1,c=new Cit(e,t))}()})),sI((()=>{h(),null==c||c.destroy()}));return t.$$set=t=>{"title"in t&&n(0,r=t.title),"data"in t&&n(3,i=t.data),"hovered"in t&&n(4,s=t.hovered),"clicked"in t&&n(5,o=t.clicked)},[r,c,u,i,s,o,a,function(t){uI[t?"unshift":"push"]((()=>{u=t,n(2,u)}))},()=>c.resetZoom()]}class Pdt extends HI{constructor(t){super(),WI(this,t,Odt,Rdt,lN,{title:0,data:3,hovered:4,clicked:5,externalTooltipHandler:6})}get externalTooltipHandler(){return this.$$.ctx[6]}}const Ldt=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"];class Ddt extends mG{constructor(t){super(),this.dataset=t,this.title="Dataset ScatterPlot",this.transforms={xy:t=>[t.x[0],t.x[1]],label:t=>t.y},this.$data=new JH(void 0,!0),this.$hovered=new JH([],!0),this.$clicked=new JH([],!0),this.dataset.ready.then((()=>{this.updateData()}))}setTransforms(t){this.transforms={...this.transforms,...t},this.updateData()}async updateData(){await this.dataset.ready;const t=await Promise.all(await this.dataset.items().map((async t=>{const[e,n]=await this.transforms.xy(t);return{x:e,y:n,label:await this.transforms.label(t),id:t.id,thumbnail:t.thumbnail}})).toArray()),e=t.map((t=>t.label)),n=Array.from(new Set(e));n.sort();const r={labels:e,datasets:n.map(((e,n)=>{return{label:e,data:t.filter((t=>t.label===e)),borderColor:(r=Ldt[n],new Uht(r)).darken(.5).rgbString(),backgroundColor:Ldt[n]};var r}))};this.$data.set(r)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Pdt({target:e,props:{title:this.title,data:this.$data,hovered:this.$hovered,clicked:this.$clicked}}))}}function Fdt(t){return{c:nN,m:nN,p:nN,i:nN,o:nN,d:nN}}function zdt(t){let e,n,r=t[5]&&Bdt(t);return{c(){r&&r.c(),e=PN()},m(t,i){r&&r.m(t,i),CN(t,e,i),n=!0},p(t,n){t[5]?r?(r.p(t,n),32&n&&NI(r,1)):(r=Bdt(t),r.c(),NI(r,1),r.m(e.parentNode,e)):r&&(CI(),II(r,1,1,(()=>{r=null})),AI())},i(t){n||(NI(r),n=!0)},o(t){II(r),n=!1},d(t){r&&r.d(t),t&&AN(e)}}}function Bdt(t){let e,n;return e=new _U({props:{provider:t[5],columns:t[4],singleSelection:t[2],actions:[{name:"delete"}]}}),e.$on("selection",t[7]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};32&n&&(r.provider=t[5]),16&n&&(r.columns=t[4]),4&n&&(r.singleSelection=t[2]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Udt(t){let e,n;return e=new B$({}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p:nN,i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Vdt(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:Udt,then:zdt,catch:Fdt,value:8,blocks:[,,,]};return OI(n=t[1].ready,i),{c(){e=PN(),i.block.c()},m(t,n){CN(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,2&r&&n!==(n=t[1].ready)&&OI(n,i)||PI(i,t,r)},i(t){r||(NI(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){II(i.blocks[t])}r=!1},d(t){t&&AN(e),i.block.d(t),i.token=null,i=null}}}function jdt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[Vdt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),574&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Wdt(t){return"string"==typeof t&&t.includes("data:image/")?"image":"string"!=typeof t||isNaN(Date.parse(t))?Array.isArray(t)&&(t.length>1&&Array.isArray(t[0])||t.length>3)?"array":"generic":"date"}function Hdt(t){return"image"!==Wdt(t)}function Gdt(t,e,n){let r,{title:i}=e,{dataset:s}=e,{colNames:o}=e,{singleSelection:a=!1}=e,{selection:l}=e,c=[{name:"x"},{name:"y",sortable:!0},{name:"thumbnail",type:"image"},{name:"updatedAt",sortable:!0}];rI((async()=>{await gI(),await s.ready,n(5,r=new AU({service:s.instanceService,columns:c})),o.subscribe((async t=>{if(n(4,c=t.map((t=>({name:t})))),s.$count.get()>0){const[t]=await s.items().take(1).toArray();n(4,c=c.map((({name:e})=>({name:e,type:Wdt(t[e]),sortable:Hdt(t[e])}))))}n(5,r.query.$select=c.map((t=>t.name)).concat(["id"]),r),r.update()}));const t=s.$count.subscribe((async e=>{if(e>0){const[e]=await s.items().take(1).toArray();n(4,c=c.map((({name:t})=>({name:t,type:Wdt(e[t]),sortable:Hdt(e[t])})))),t()}}))}));return t.$$set=t=>{"title"in t&&n(0,i=t.title),"dataset"in t&&n(1,s=t.dataset),"colNames"in t&&n(6,o=t.colNames),"singleSelection"in t&&n(2,a=t.singleSelection),"selection"in t&&n(3,l=t.selection)},[i,s,a,l,c,r,o,({detail:t})=>{l.set(t)}]}class qdt extends HI{constructor(t){super(),WI(this,t,Gdt,jdt,lN,{title:0,dataset:1,colNames:6,singleSelection:2,selection:3})}}var Xdt,Ydt;class Kdt extends mG{constructor(t,e,n=!1){super(),this.title="dataset table",Xdt.set(this,void 0),this.$selection=new JH([],!0),this.singleSelection=!1,BH(this,Xdt,t,"f"),this.singleSelection=n,this.$columns=new JH(e||["x","y","thumbnail","updatedAt"],!0),e||zH(this,Xdt,"f").ready.then((()=>zH(this,Xdt,"f").items().take(1).toArray())).then((t=>{if(t.length>0){const e=Object.keys(t[0]);this.$columns.set(e)}})).catch((t=>{console.log("An error occured while fetching the first instance.",t)})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new qdt({target:e,props:{title:this.title,dataset:zH(this,Xdt,"f"),colNames:this.$columns,singleSelection:this.singleSelection,selection:this.$selection}}))}}function Zdt(t){let e;return{c(){e=IN("canvas"),FN(e,"id","can"),FN(e,"class","w-full max-w-full")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function Jdt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[Zdt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Qdt(t,e,n){let{title:r}=e,{imageStream:i}=e,{objectDetectionResults:s}=e;return rI((()=>{const t=document.getElementById("can"),e=t.getContext("2d");i.subscribe((n=>{t.height=n.height,t.width=n.width,e.putImageData(n,0,0)})),s.subscribe((({outputs:n})=>{for(let r=0;r<n.length;r++){e.font=`${Math.floor(t.width/60)}px sans-serif`;const i=`${n[r].confidence.toFixed(3)} ${n[r].class}`,s=e.measureText(i);e.beginPath(),e.rect(...n[r].bbox),e.lineWidth=t.width/300,e.strokeStyle="green",e.fillStyle="green",e.stroke(),e.fillRect(n[r].bbox[0]-e.lineWidth/2,n[r].bbox[1]>s.actualBoundingBoxAscent?n[r].bbox[1]-s.actualBoundingBoxAscent-1.5*e.lineWidth:0,s.width+e.lineWidth,s.actualBoundingBoxAscent+e.lineWidth),e.fillStyle="white",e.fillText(i,n[r].bbox[0],n[r].bbox[1]>s.actualBoundingBoxAscent?n[r].bbox[1]-e.lineWidth:s.actualBoundingBoxAscent)}}))})),t.$$set=t=>{"title"in t&&n(0,r=t.title),"imageStream"in t&&n(1,i=t.imageStream),"objectDetectionResults"in t&&n(2,s=t.objectDetectionResults)},[r,i,s]}Xdt=new WeakMap;class tpt extends HI{constructor(t){super(),WI(this,t,Qdt,Jdt,lN,{title:0,imageStream:1,objectDetectionResults:2})}}class ept extends mG{constructor(t,e){super(),this.title="Visualize Object Detections",this.$imgStream=t,this.$objectDetectionResults=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new tpt({target:e,props:{title:this.title,imageStream:this.$imgStream,objectDetectionResults:this.$objectDetectionResults}}))}}function npt(t){let e;return{c(){e=IN("div"),e.innerHTML='<i><svg class="fill-current w-12 h-12 mb-3 text-blue-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.479 10.092c-.212-3.951-3.473-7.092-7.479-7.092-4.005 0-7.267 3.141-7.479 7.092-2.57.463-4.521 2.706-4.521 5.408 0 3.037 2.463 5.5 5.5 5.5h13c3.037 0 5.5-2.463 5.5-5.5 0-2.702-1.951-4.945-4.521-5.408zm-7.479-1.092l4 4h-3v4h-2v-4h-3l4-4z"></path></svg></i> \n      <p class="text-lg text-blue-700">Drop files to upload</p>',FN(e,"class","overlay svelte-10fctvd")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function rpt(t){let e;return{c(){e=RN("Upload a file")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function ipt(t){let e,n,r,i,s,o,a,l,c,u,h,d=t[2]&&npt();return l=new XI({props:{$$slots:{default:[rpt]},$$scope:{ctx:t}}}),l.$on("click",t[7]),{c(){d&&d.c(),e=ON(),n=IN("div"),r=IN("div"),i=IN("p"),i.innerHTML="<span>Drop Files here or:</span>",s=ON(),o=IN("input"),a=ON(),UI(l.$$.fragment),FN(i,"class","mb-3 font-semibold text-gray-900 flex flex-wrap justify-center"),FN(o,"type","file"),o.multiple=!0,FN(o,"class","hidden"),FN(r,"class","border-dashed border-2 border-gray-300 py-8 flex flex-col justify-center items-center"),FN(n,"class","file-upload svelte-10fctvd")},m(p,f){d&&d.m(p,f),CN(p,e,f),CN(p,n,f),TN(n,r),TN(r,i),TN(r,s),TN(r,o),t[9](o),TN(r,a),VI(l,r,null),c=!0,u||(h=[LN(n,"dragenter",t[3]),LN(n,"dragleave",t[4]),LN(n,"dragover",t[5]),LN(n,"drop",t[6])],u=!0)},p(t,n){t[2]?d||(d=npt(),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null);const r={};8192&n&&(r.$$scope={dirty:n,ctx:t}),l.$set(r)},i(t){c||(NI(l.$$.fragment,t),c=!0)},o(t){II(l.$$.fragment,t),c=!1},d(r){d&&d.d(r),r&&AN(e),r&&AN(n),t[9](null),jI(l),u=!1,oN(h)}}}function spt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[ipt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8198&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function opt(t,e,n){let r,{title:i}=e,{fileStream:s}=e,o=0,a=!1;const l=({dataTransfer:{types:t=[]}})=>t.indexOf("Files")>-1;function c(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]);s.set(e)}return rI((async()=>{await gI(),await gI(),r.addEventListener("change",(t=>{c(t.target.files)}))})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"fileStream"in t&&n(8,s=t.fileStream)},[i,r,a,function(t){t.preventDefault(),l(t)&&(o+=1,n(2,a=!0))},function(){o-=1,o<1&&n(2,a=!1)},function(t){l(t)&&t.preventDefault()},function(t){t.preventDefault(),n(2,a=!1),c(t.dataTransfer.files)},function(){r&&r.click()},s,function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class apt extends HI{constructor(t){super(),WI(this,t,opt,spt,lN,{title:0,fileStream:8})}}class lpt extends mG{constructor(){super(),this.title="file upload",this.$files=new JH(qV()),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new apt({target:e,props:{title:this.title,fileStream:this.$files}}))}}function cpt(t){let e;return{c(){e=IN("canvas"),FN(e,"class","w-full max-w-full")},m(n,r){CN(n,e,r),t[3](e)},p:nN,d(n){n&&AN(e),t[3](null)}}}function upt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[cpt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),34&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function hpt(t,e,n){let r,{title:i}=e,{imageStream:s}=e,o=XH;return rI((async()=>{await gI(),await gI();const t=r.getContext("2d");o=s.subscribe((e=>{if(!Array.isArray(e)||0!==e.length)if(e instanceof ImageData)n(1,r.width=e.width,r),n(1,r.height=e.height,r),t.putImageData(e,0,0);else if(Array.isArray(e))throw new Error("This component does not yet support multiple images")}))})),sI((()=>{o()})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"imageStream"in t&&n(2,s=t.imageStream)},[i,r,s,function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class dpt extends HI{constructor(t){super(),WI(this,t,hpt,upt,lN,{title:0,imageStream:2})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),_I()}get imageStream(){return this.$$.ctx[2]}set imageStream(t){this.$$set({imageStream:t}),_I()}}class ppt extends mG{constructor(t){super(),this.title="image display",Ydt.set(this,void 0),BH(this,Ydt,t,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new dpt({target:e,props:{title:this.title,imageStream:zH(this,Ydt,"f")}}))}}Ydt=new WeakMap;var fpt={exports:{}},mpt={exports:{}};!function(t){!function(e){var n=e.URL||e.webkitURL;function r(t){return!!n&&n.createObjectURL(t)}function i(t){return!!n&&n.revokeObjectURL(t)}function s(t,e){!t||"blob:"!==t.slice(0,5)||e&&e.noRevoke||i(t)}function o(t,n,r,i){if(!e.FileReader)return!1;var s=new FileReader;s.onload=function(){n.call(s,this.result)},r&&(s.onabort=s.onerror=function(){r.call(s,this.error)});var o=s[i||"readAsDataURL"];return o?(o.call(s,t),s):void 0}function a(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"}function l(t,n,i){function c(n,c){var u,h=document.createElement("img");function d(t,e){n!==c?t instanceof Error?c(t):((e=e||{}).image=t,n(e)):n&&n(t,e)}function p(n,s){s&&e.console&&console.log(s),n&&a("Blob",n)?u=r(t=n):(u=t,i&&i.crossOrigin&&(h.crossOrigin=i.crossOrigin)),h.src=u}return h.onerror=function(t){s(u,i),c&&c.call(h,t)},h.onload=function(){s(u,i);var e={originalWidth:h.naturalWidth||h.width,originalHeight:h.naturalHeight||h.height};try{l.transform(h,i,d,t,e)}catch(t){c&&c(t)}},"string"==typeof t?(l.requiresMetaData(i)?l.fetchBlob(t,p,i):p(),h):a("Blob",t)||a("File",t)?(u=r(t))?(h.src=u,h):o(t,(function(t){h.src=t}),c):void 0}return e.Promise&&"function"!=typeof n?(i=n,new Promise(c)):c(n,n)}l.requiresMetaData=function(t){return t&&t.meta},l.fetchBlob=function(t,e){e()},l.transform=function(t,e,n,r,i){n(t,i)},l.global=e,l.readFile=o,l.isInstanceOf=a,l.createObjectURL=r,l.revokeObjectURL=i,t.exports?t.exports=l:e.loadImage=l}("undefined"!=typeof window&&window||vr)}(mpt);var gpt={exports:{}};!function(t){var e;e=function(t){var e=t.transform;t.createCanvas=function(e,n,r){if(r&&t.global.OffscreenCanvas)return new OffscreenCanvas(e,n);var i=document.createElement("canvas");return i.width=e,i.height=n,i},t.transform=function(n,r,i,s,o){e.call(t,t.scale(n,r,o),r,i,s,o)},t.transformCoordinates=function(){},t.getTransformedOptions=function(t,e){var n,r,i,s,o=e.aspectRatio;if(!o)return e;for(r in n={},e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.crop=!0,(i=t.naturalWidth||t.width)/(s=t.naturalHeight||t.height)>o?(n.maxWidth=s*o,n.maxHeight=s):(n.maxWidth=i,n.maxHeight=i/o),n},t.drawImage=function(t,e,n,r,i,s,o,a,l){var c=e.getContext("2d");return!1===l.imageSmoothingEnabled?(c.msImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1):l.imageSmoothingQuality&&(c.imageSmoothingQuality=l.imageSmoothingQuality),c.drawImage(t,n,r,i,s,0,0,o,a),c},t.requiresCanvas=function(t){return t.canvas||t.crop||!!t.aspectRatio},t.scale=function(e,n,r){n=n||{},r=r||{};var i,s,o,a,l,c,u,h,d,p,f,m,g=e.getContext||t.requiresCanvas(n)&&!!t.global.HTMLCanvasElement,y=e.naturalWidth||e.width,b=e.naturalHeight||e.height,v=y,x=b;function w(){var t=Math.max((o||v)/v,(a||x)/x);t>1&&(v*=t,x*=t)}function _(){var t=Math.min((i||v)/v,(s||x)/x);t<1&&(v*=t,x*=t)}if(g&&(u=(n=t.getTransformedOptions(e,n,r)).left||0,h=n.top||0,n.sourceWidth?(l=n.sourceWidth,void 0!==n.right&&void 0===n.left&&(u=y-l-n.right)):l=y-u-(n.right||0),n.sourceHeight?(c=n.sourceHeight,void 0!==n.bottom&&void 0===n.top&&(h=b-c-n.bottom)):c=b-h-(n.bottom||0),v=l,x=c),i=n.maxWidth,s=n.maxHeight,o=n.minWidth,a=n.minHeight,g&&i&&s&&n.crop?(v=i,x=s,(f=l/c-i/s)<0?(c=s*l/i,void 0===n.top&&void 0===n.bottom&&(h=(b-c)/2)):f>0&&(l=i*c/s,void 0===n.left&&void 0===n.right&&(u=(y-l)/2))):((n.contain||n.cover)&&(o=i=i||o,a=s=s||a),n.cover?(_(),w()):(w(),_())),g){if((d=n.pixelRatio)>1&&(!e.style.width||Math.floor(parseFloat(e.style.width,10))!==Math.floor(y/d))&&(v*=d,x*=d),t.orientationCropBug&&!e.getContext&&(u||h||l!==y||c!==b)&&(f=e,e=t.createCanvas(y,b,!0),t.drawImage(f,e,0,0,y,b,y,b,n)),(p=n.downsamplingRatio)>0&&p<1&&v<l&&x<c)for(;l*p>v;)m=t.createCanvas(l*p,c*p,!0),t.drawImage(e,m,u,h,l,c,m.width,m.height,n),u=0,h=0,l=m.width,c=m.height,e=m;return m=t.createCanvas(v,x),t.transformCoordinates(m,n,r),d>1&&(m.style.width=m.width/d+"px"),t.drawImage(e,m,u,h,l,c,v,x,n).setTransform(1,0,0,1,0,0),m}return e.width=v,e.height=x,e}},e(t.exports?mpt.exports:window.loadImage)}(gpt);var ypt={exports:{}};!function(t){var e;e=function(t){var e=t.global,n=t.transform,r=e.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),i=e.ArrayBuffer&&ArrayBuffer.prototype.slice||function(t,e){e=e||this.byteLength-t;var n=new Uint8Array(this,t,e),r=new Uint8Array(e);return r.set(n),r.buffer},s={jpeg:{65505:[],65517:[]}};function o(n,o,a,l){var c=this;function u(o,u){if(!(e.DataView&&r&&n&&n.size>=12&&"image/jpeg"===n.type))return o(l);var h=a.maxMetaDataSize||262144;t.readFile(r.call(n,0,h),(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return u(new Error("Invalid JPEG file: Missing JPEG marker."));for(var n,r,h,d,p=2,f=e.byteLength-4,m=p;p<f&&((n=e.getUint16(p))>=65504&&n<=65519||65534===n);){if(p+(r=e.getUint16(p+2)+2)>e.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if((h=s.jpeg[n])&&!a.disableMetaDataParsers)for(d=0;d<h.length;d+=1)h[d].call(c,e,p,r,l,a);m=p+=r}!a.disableImageHead&&m>6&&(l.imageHead=i.call(t,0,m)),o(l)}),u,"readAsArrayBuffer")||o(l)}return a=a||{},e.Promise&&"function"!=typeof o?(l=a=o||{},new Promise(u)):(l=l||{},u(o,o))}function a(t,e,n){return t&&e&&n?new Blob([n,r.call(t,e.byteLength)],{type:"image/jpeg"}):null}t.transform=function(r,i,s,a,l){t.requiresMetaData(i)?o(a,(function(o){o!==l&&(e.console&&console.log(o),o=l),n.call(t,r,i,s,a,o)}),i,l=l||{}):n.apply(t,arguments)},t.blobSlice=r,t.bufferSlice=i,t.replaceHead=function(t,n,r){var i={maxMetaDataSize:1024,disableMetaDataParsers:!0};if(!r&&e.Promise)return o(t,i).then((function(e){return a(t,e.imageHead,n)}));o(t,(function(e){r(a(t,e.imageHead,n))}),i)},t.parseMetaData=o,t.metaDataParsers=s},e(t.exports?mpt.exports:window.loadImage)}(ypt);!function(t){var e;e=function(t){var e=t.global;e.fetch&&e.Request&&e.Response&&e.Response.prototype.blob?t.fetchBlob=function(t,n,r){function i(t){return t.blob()}if(e.Promise&&"function"!=typeof n)return fetch(new Request(t,n)).then(i);fetch(new Request(t,r)).then(i).then(n).catch((function(t){n(null,t)}))}:e.XMLHttpRequest&&""===(new XMLHttpRequest).responseType&&(t.fetchBlob=function(t,n,r){function i(e,n){r=r||{};var i=new XMLHttpRequest;i.open(r.method||"GET",t),r.headers&&Object.keys(r.headers).forEach((function(t){i.setRequestHeader(t,r.headers[t])})),i.withCredentials="include"===r.credentials,i.responseType="blob",i.onload=function(){e(i.response)},i.onerror=i.onabort=i.ontimeout=function(t){e===n?n(null,t):n(t)},i.send(r.body)}return e.Promise&&"function"!=typeof n?(r=n,new Promise(i)):i(n,n)})},e(t.exports?mpt.exports:window.loadImage)}({exports:{}});var bpt={exports:{}};!function(t){var e;e=function(t){function e(t){t&&(Object.defineProperty(this,"map",{value:this.ifds[t].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[t]||{}}))}e.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965},e.prototype.ifds={ifd1:{name:"Thumbnail",map:e.prototype.map},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},e.prototype.get=function(t){return this[t]||this[this.map[t]]};var n={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,n){return t.getUint16(e,n)},size:2},4:{getValue:function(t,e,n){return t.getUint32(e,n)},size:4},5:{getValue:function(t,e,n){return t.getUint32(e,n)/t.getUint32(e+4,n)},size:8},9:{getValue:function(t,e,n){return t.getInt32(e,n)},size:4},10:{getValue:function(t,e,n){return t.getInt32(e,n)/t.getInt32(e+4,n)},size:8}};function r(t,e,r,i,s,o){var a,l,c,u,h,d,p=n[i];if(p){if(!((l=(a=p.size*s)>4?e+t.getUint32(r+8,o):r+8)+a>t.byteLength)){if(1===s)return p.getValue(t,l,o);for(c=[],u=0;u<s;u+=1)c[u]=p.getValue(t,l+u*p.size,o);if(p.ascii){for(h="",u=0;u<c.length&&"\0"!==(d=c[u]);u+=1)h+=d;return h}return c}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}function i(t,e,n){return(!t||t[n])&&(!e||!0!==e[n])}function s(t,e,n,s,o,a,l,c){var u,h,d,p,f,m;if(n+6>t.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((h=n+2+12*(u=t.getUint16(n,s)))+4>t.byteLength)){for(d=0;d<u;d+=1)p=n+2+12*d,i(l,c,f=t.getUint16(p,s))&&(m=r(t,e,p,t.getUint16(p+2,s),t.getUint32(p+4,s),s),o[f]=m,a&&(a[f]=p));return t.getUint32(h,s)}console.log("Invalid Exif data: Invalid directory size.")}}n[7]=n[1],t.parseExifData=function(n,r,o,a,l){if(!l.disableExif){var c,u,h,d=l.includeExifTags,p=l.excludeExifTags||{34665:{37500:!0}},f=r+10;if(1165519206===n.getUint32(r+4))if(f+8>n.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===n.getUint16(r+8)){switch(n.getUint16(f)){case 18761:c=!0;break;case 19789:c=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===n.getUint16(f+2,c)?(u=n.getUint32(f+4,c),a.exif=new e,l.disableExifOffsets||(a.exifOffsets=new e,a.exifTiffOffset=f,a.exifLittleEndian=c),(u=s(n,f,f+u,c,a.exif,a.exifOffsets,d,p))&&i(d,p,"ifd1")&&(a.exif.ifd1=u,a.exifOffsets&&(a.exifOffsets.ifd1=f+u)),Object.keys(a.exif.ifds).forEach((function(t){!function(t,n,r,i,o,a,l){var c=t.exif[n];c&&(t.exif[n]=new e(n),t.exifOffsets&&(t.exifOffsets[n]=new e(n)),s(r,i,i+c,o,t.exif[n],t.exifOffsets&&t.exifOffsets[n],a&&a[n],l&&l[n]))}(a,t,n,f,c,d,p)})),(h=a.exif.ifd1)&&h[513]&&(h[513]=function(e,n,r){if(r){if(!(n+r>e.byteLength))return new Blob([t.bufferSlice.call(e.buffer,n,n+r)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}}(n,f+h[513],h[514]))):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},t.metaDataParsers.jpeg[65505].push(t.parseExifData),t.exifWriters={274:function(t,e,n){var r=e.exifOffsets[274];return r?(new DataView(t,r+8,2).setUint16(0,n,e.exifLittleEndian),t):t}},t.writeExifData=function(e,n,r,i){return t.exifWriters[n.exif.map[r]](e,n,i)},t.ExifMap=e},e(t.exports?mpt.exports:window.loadImage)}(bpt);!function(t){var e;e=function(t){var e=t.ExifMap.prototype;e.tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",34665:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber"},34853:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},40965:{1:"InteroperabilityIndex"}},e.tags.ifd1=e.tags,e.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"Original",2:"Horizontal flip",3:"Rotate 180° CCW",4:"Vertical flip",5:"Vertical flip + Rotate 90° CW",6:"Rotate 90° CW",7:"Horizontal flip + Rotate 90° CW",8:"Rotate 90° CCW"}},e.getText=function(t){var e=this.get(t);switch(t){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[t][e];case"ExifVersion":case"FlashpixVersion":if(!e)return;return String.fromCharCode(e[0],e[1],e[2],e[3]);case"ComponentsConfiguration":if(!e)return;return this.stringValues[t][e[0]]+this.stringValues[t][e[1]]+this.stringValues[t][e[2]]+this.stringValues[t][e[3]];case"GPSVersionID":if(!e)return;return e[0]+"."+e[1]+"."+e[2]+"."+e[3]}return String(e)},e.getAll=function(){var t,e,n,r={};for(t in this)Object.prototype.hasOwnProperty.call(this,t)&&((e=this[t])&&e.getAll?r[this.ifds[t].name]=e.getAll():(n=this.tags[t])&&(r[n]=this.getText(n)));return r},e.getName=function(t){var e=this.tags[t];return"object"==typeof e?this.ifds[t].name:e},function(){var t,n,r,i=e.tags;for(t in i)if(Object.prototype.hasOwnProperty.call(i,t))if(n=e.ifds[t])for(t in r=i[t])Object.prototype.hasOwnProperty.call(r,t)&&(n.map[r[t]]=Number(t));else e.map[i[t]]=Number(t)}()},e(t.exports?mpt.exports:window.loadImage)}({exports:{}});var vpt={exports:{}};!function(t){var e;e=function(t){function e(){}function n(t,e,n,r,i){return"binary"===e.types[t]?new Blob([n.buffer.slice(r,r+i)]):"Uint16"===e.types[t]?n.getUint16(r):function(t,e,n){for(var r="",i=e+n,s=e;s<i;s+=1)r+=String.fromCharCode(t.getUint8(s));return r}(n,r,i)}function r(t,e){return void 0===t?e:t instanceof Array?(t.push(e),t):[t,e]}function i(t,e,i,s,o,a){for(var l,c,u,h=e+i,d=e;d<h;)28===t.getUint8(d)&&2===t.getUint8(d+1)&&(u=t.getUint8(d+2),o&&!o[u]||a&&a[u]||(c=t.getInt16(d+3),l=n(u,s.iptc,t,d+5,c),s.iptc[u]=r(s.iptc[u],l),s.iptcOffsets&&(s.iptcOffsets[u]=d))),d+=1}function s(t,e){return 943868237===t.getUint32(e)&&1028===t.getUint16(e+4)}function o(t,e){var n=t.getUint8(e+7);return n%2!=0&&(n+=1),0===n&&(n=4),n}e.prototype.map={ObjectName:5},e.prototype.types={0:"Uint16",200:"Uint16",201:"Uint16",202:"binary"},e.prototype.get=function(t){return this[t]||this[this.map[t]]},t.parseIptcData=function(t,n,r,a,l){if(!l.disableIptc)for(var c=n+r;n+8<c;){if(s(t,n)){var u=o(t,n),h=n+8+u;if(h>c){console.log("Invalid IPTC data: Invalid segment offset.");break}var d=t.getUint16(n+6+u);if(n+d>c){console.log("Invalid IPTC data: Invalid segment size.");break}return a.iptc=new e,l.disableIptcOffsets||(a.iptcOffsets=new e),void i(t,h,d,a,l.includeIptcTags,l.excludeIptcTags||{202:!0})}n+=1}},t.metaDataParsers.jpeg[65517].push(t.parseIptcData),t.IptcMap=e},e(t.exports?mpt.exports:window.loadImage)}(vpt);!function(t){var e;e=function(t){var e=t.IptcMap.prototype;e.tags={0:"ApplicationRecordVersion",3:"ObjectTypeReference",4:"ObjectAttributeReference",5:"ObjectName",7:"EditStatus",8:"EditorialUpdate",10:"Urgency",12:"SubjectReference",15:"Category",20:"SupplementalCategories",22:"FixtureIdentifier",25:"Keywords",26:"ContentLocationCode",27:"ContentLocationName",30:"ReleaseDate",35:"ReleaseTime",37:"ExpirationDate",38:"ExpirationTime",40:"SpecialInstructions",42:"ActionAdvised",45:"ReferenceService",47:"ReferenceDate",50:"ReferenceNumber",55:"DateCreated",60:"TimeCreated",62:"DigitalCreationDate",63:"DigitalCreationTime",65:"OriginatingProgram",70:"ProgramVersion",75:"ObjectCycle",80:"Byline",85:"BylineTitle",90:"City",92:"Sublocation",95:"State",100:"CountryCode",101:"Country",103:"OriginalTransmissionReference",105:"Headline",110:"Credit",115:"Source",116:"CopyrightNotice",118:"Contact",120:"Caption",121:"LocalCaption",122:"Writer",125:"RasterizedCaption",130:"ImageType",131:"ImageOrientation",135:"LanguageIdentifier",150:"AudioType",151:"AudioSamplingRate",152:"AudioSamplingResolution",153:"AudioDuration",154:"AudioOutcue",184:"JobID",185:"MasterDocumentID",186:"ShortDocumentID",187:"UniqueDocumentID",188:"OwnerID",200:"ObjectPreviewFileFormat",201:"ObjectPreviewFileVersion",202:"ObjectPreviewData",221:"Prefs",225:"ClassifyState",228:"SimilarityIndex",230:"DocumentNotes",231:"DocumentHistory",232:"ExifCameraInfo",255:"CatalogSets"},e.stringValues={10:{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"},75:{a:"Morning",b:"Both Morning and Evening",p:"Evening"},131:{L:"Landscape",P:"Portrait",S:"Square"}},e.getText=function(t){var e=this.get(t),n=this.map[t],r=this.stringValues[n];return r?r[e]:String(e)},e.getAll=function(){var t,e,n={};for(t in this)Object.prototype.hasOwnProperty.call(this,t)&&(e=this.tags[t])&&(n[e]=this.getText(e));return n},e.getName=function(t){return this.tags[t]},function(){var t,n=e.tags,r=e.map||{};for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[n[t]]=Number(t))}()},e(t.exports?mpt.exports:window.loadImage)}({exports:{}});!function(t){var e;e=function(t){var e=t.transform,n=t.requiresCanvas,r=t.requiresMetaData,i=t.transformCoordinates,s=t.getTransformedOptions;function o(e,n){var r=e&&e.orientation;return!0===r&&!t.orientation||1===r&&t.orientation||(!n||t.orientation)&&r>1&&r<9}function a(t,e){return t!==e&&(1===t&&e>1&&e<9||t>1&&t<9)}function l(t,e){if(e>1&&e<9)switch(t){case 2:case 4:return e>4;case 5:case 7:return e%2==0;case 6:case 8:return 2===e||4===e||5===e||7===e}return!1}!function(t){if(t.global.document){var e=document.createElement("img");e.onload=function(){if(t.orientation=2===e.width&&3===e.height,t.orientation){var n=t.createCanvas(1,1,!0).getContext("2d");n.drawImage(e,1,1,1,1,0,0,1,1),t.orientationCropBug="255,255,255,255"!==n.getImageData(0,0,1,1).data.toString()}},e.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="}}(t),t.requiresCanvas=function(e){return o(e)||n.call(t,e)},t.requiresMetaData=function(e){return o(e,!0)||r.call(t,e)},t.transform=function(n,r,i,s,o){e.call(t,n,r,(function(e,n){if(n){var r=t.orientation&&n.exif&&n.exif.get("Orientation");if(r>4&&r<9){var s=n.originalWidth,o=n.originalHeight;n.originalWidth=o,n.originalHeight=s}}i(e,n)}),s,o)},t.getTransformedOptions=function(e,n,r){var i=s.call(t,e,n),o=r.exif&&r.exif.get("Orientation"),c=i.orientation,u=t.orientation&&o;if(!0===c&&(c=o),!a(c,u))return i;var h=i.top,d=i.right,p=i.bottom,f=i.left,m={};for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&(m[g]=i[g]);if(m.orientation=c,(c>4&&!(u>4)||c<5&&u>4)&&(m.maxWidth=i.maxHeight,m.maxHeight=i.maxWidth,m.minWidth=i.minHeight,m.minHeight=i.minWidth,m.sourceWidth=i.sourceHeight,m.sourceHeight=i.sourceWidth),u>1){switch(u){case 2:d=i.left,f=i.right;break;case 3:h=i.bottom,d=i.left,p=i.top,f=i.right;break;case 4:h=i.bottom,p=i.top;break;case 5:h=i.left,d=i.bottom,p=i.right,f=i.top;break;case 6:h=i.left,d=i.top,p=i.right,f=i.bottom;break;case 7:h=i.right,d=i.top,p=i.left,f=i.bottom;break;case 8:h=i.right,d=i.bottom,p=i.left,f=i.top}if(l(c,u)){var y=h,b=d;h=p,d=f,p=y,f=b}}switch(m.top=h,m.right=d,m.bottom=p,m.left=f,c){case 2:m.right=f,m.left=d;break;case 3:m.top=p,m.right=f,m.bottom=h,m.left=d;break;case 4:m.top=p,m.bottom=h;break;case 5:m.top=f,m.right=p,m.bottom=d,m.left=h;break;case 6:m.top=d,m.right=p,m.bottom=f,m.left=h;break;case 7:m.top=d,m.right=h,m.bottom=f,m.left=p;break;case 8:m.top=f,m.right=h,m.bottom=d,m.left=p}return m},t.transformCoordinates=function(e,n,r){i.call(t,e,n,r);var s=n.orientation,o=t.orientation&&r.exif&&r.exif.get("Orientation");if(a(s,o)){var c=e.getContext("2d"),u=e.width,h=e.height,d=u,p=h;switch((s>4&&!(o>4)||s<5&&o>4)&&(e.width=h,e.height=u),s>4&&(d=h,p=u),o){case 2:c.translate(d,0),c.scale(-1,1);break;case 3:c.translate(d,p),c.rotate(Math.PI);break;case 4:c.translate(0,p),c.scale(1,-1);break;case 5:c.rotate(-.5*Math.PI),c.scale(-1,1);break;case 6:c.rotate(-.5*Math.PI),c.translate(-d,0);break;case 7:c.rotate(-.5*Math.PI),c.translate(-d,p),c.scale(1,-1);break;case 8:c.rotate(.5*Math.PI),c.translate(0,-p)}switch(l(s,o)&&(c.translate(d,p),c.rotate(Math.PI)),s){case 2:c.translate(u,0),c.scale(-1,1);break;case 3:c.translate(u,h),c.rotate(Math.PI);break;case 4:c.translate(0,h),c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI),c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI),c.translate(0,-h);break;case 7:c.rotate(.5*Math.PI),c.translate(u,-h),c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-u,0)}}}},e(t.exports?mpt.exports:window.loadImage)}({exports:{}}),function(t){t.exports=mpt.exports}(fpt);var xpt,wpt,_pt=xr(fpt.exports);function Spt(t,e,n){const r=t.slice();return r[18]=e[n],r}function kpt(t){let e;return{c(){e=IN("div"),e.innerHTML='<i><svg class="fill-current w-12 h-12 mb-3 text-blue-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.479 10.092c-.212-3.951-3.473-7.092-7.479-7.092-4.005 0-7.267 3.141-7.479 7.092-2.57.463-4.521 2.706-4.521 5.408 0 3.037 2.463 5.5 5.5 5.5h13c3.037 0 5.5-2.463 5.5-5.5 0-2.702-1.951-4.945-4.521-5.408zm-7.479-1.092l4 4h-3v4h-2v-4h-3l4-4z"></path></svg></i> \n      <p class="text-lg text-blue-700">Drop files to upload</p>',FN(e,"class","overlay svelte-u8vb5e")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function Tpt(t){let e;return{c(){e=RN("Upload a file")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function Ept(t){let e,n;return{c(){e=IN("img"),FN(e,"class","mx-auto my-2 w-32"),uN(e.src,n=t[18]||"https://user-images.githubusercontent.com/507615/54591670-ac0a0180-4a65-11e9-846c-e55ffce0fe7b.png")||FN(e,"src",n),FN(e,"alt","no data")},m(t,n){CN(t,e,n)},p(t,r){8&r&&!uN(e.src,n=t[18]||"https://user-images.githubusercontent.com/507615/54591670-ac0a0180-4a65-11e9-846c-e55ffce0fe7b.png")&&FN(e,"src",n)},d(t){t&&AN(e)}}}function Mpt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f=t[2]&&kpt();l=new XI({props:{$$slots:{default:[Tpt]},$$scope:{ctx:t}}}),l.$on("click",t[8]);let m=t[3],g=[];for(let e=0;e<m.length;e+=1)g[e]=Ept(Spt(t,m,e));return{c(){f&&f.c(),e=ON(),n=IN("div"),r=IN("div"),i=IN("p"),i.innerHTML="<span>Drag and drop an image or</span>",s=ON(),o=IN("input"),a=ON(),UI(l.$$.fragment),c=ON(),u=IN("div");for(let t=0;t<g.length;t+=1)g[t].c();FN(i,"class","mb-3 font-semibold text-gray-900 flex flex-wrap justify-center"),FN(o,"type","file"),o.multiple=!0,FN(o,"class","hidden"),FN(r,"class","border-dashed border-2 border-gray-300 py-8 flex flex-col justify-center items-center"),FN(u,"class","flex flex-wrap"),FN(n,"class","image-upload svelte-u8vb5e")},m(m,y){f&&f.m(m,y),CN(m,e,y),CN(m,n,y),TN(n,r),TN(r,i),TN(r,s),TN(r,o),t[13](o),TN(r,a),VI(l,r,null),TN(n,c),TN(n,u);for(let t=0;t<g.length;t+=1)g[t].m(u,null);h=!0,d||(p=[LN(n,"dragenter",t[4]),LN(n,"dragleave",t[5]),LN(n,"dragover",t[6]),LN(n,"drop",t[7])],d=!0)},p(t,n){t[2]?f||(f=kpt(),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null);const r={};if(2097152&n&&(r.$$scope={dirty:n,ctx:t}),l.$set(r),8&n){let e;for(m=t[3],e=0;e<m.length;e+=1){const r=Spt(t,m,e);g[e]?g[e].p(r,n):(g[e]=Ept(r),g[e].c(),g[e].m(u,null))}for(;e<g.length;e+=1)g[e].d(1);g.length=m.length}},i(t){h||(NI(l.$$.fragment,t),h=!0)},o(t){II(l.$$.fragment,t),h=!1},d(r){f&&f.d(r),r&&AN(e),r&&AN(n),t[13](null),jI(l),NN(g,r),d=!1,oN(p)}}}function Cpt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[Mpt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),2097166&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Apt(t,e,n){let r,{title:i}=e,{images:s}=e,{thumbnails:o}=e,{width:a}=e,{height:l}=e,c=0,u=!1,h=[];const d=({dataTransfer:{types:t=[]}})=>t.indexOf("Files")>-1;async function p(t){const{image:e}=await _pt(t,{...a>0&&{maxWidth:a},...l>0&&{maxHeight:l},cover:!0,crop:!0,canvas:!0,crossOrigin:"Anonymous"}),{image:n}=await _pt(t,{maxWidth:60,maxHeight:60,cover:!0,crop:!0,canvas:!0,crossOrigin:"Anonymous"}),r=e,i=r.getContext("2d").getImageData(0,0,a||r.width,l||r.height),c=n.toDataURL("image/jpeg");o.set(c),s.set(i)}async function f(t){n(3,h=[]);let e=Promise.resolve();for(let r=0;r<t.length;r++){const i=t[r];i.type.match("image.*")&&(e=e.then((()=>p(i)))),n(2,u=!1),c=0}await e}return rI((async()=>{await gI(),await gI(),r.addEventListener("change",(t=>{f(t.target.files)}))})),t.$$set=t=>{"title"in t&&n(0,i=t.title),"images"in t&&n(9,s=t.images),"thumbnails"in t&&n(10,o=t.thumbnails),"width"in t&&n(11,a=t.width),"height"in t&&n(12,l=t.height)},[i,r,u,h,function(t){t.preventDefault(),d(t)&&(c+=1,n(2,u=!0))},function(){c-=1,c<1&&n(2,u=!1)},function(t){d(t)&&t.preventDefault()},function(t){t.preventDefault(),f(t.dataTransfer.files)},function(){r&&r.click()},s,o,a,l,function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Npt extends HI{constructor(t){super(),WI(this,t,Apt,Cpt,lN,{title:0,images:9,thumbnails:10,width:11,height:12})}}class Ipt extends mG{constructor({width:t=0,height:e=0}={}){super(),this.title="image upload",this.$images=new JH(qV()),this.$thumbnails=new JH(qV()),xpt.set(this,void 0),wpt.set(this,void 0),BH(this,xpt,t,"f"),BH(this,wpt,e,"f"),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Npt({target:e,props:{title:this.title,images:this.$images,thumbnails:this.$thumbnails,width:zH(this,xpt,"f"),height:zH(this,wpt,"f")}}))}}function $pt(t,e){let n=0;for(let r=0;r<t.length;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return n}xpt=new WeakMap,wpt=new WeakMap;const Rpt={distanceFunction:$pt};function Opt(t,e,n=Rpt){const r=n.distanceFunction||Rpt.distanceFunction,i=n.similarityFunction||Rpt.similarityFunction;let s=-1;if("function"==typeof i){let n=Number.MIN_VALUE;for(let r=0;r<t.length;r++){const o=i(e,t[r]);o>n&&(n=o,s=r)}}else{if("function"!=typeof r)throw new Error("A similarity or distance function it's required");{let n=Number.MAX_VALUE;for(let i=0;i<t.length;i++){const o=r(e,t[i]);o<n&&(n=o,s=i)}}}return s}function Ppt(t,e,n,r){for(var i=0;i<t.length;i++)n[i]=Opt(e,t[i],{distanceFunction:r});return n}function Lpt(t,e){const n=65535&(t>>>=0);return((t-n)*(e>>>=0)>>>0)+n*e>>>0}class Dpt{constructor(t=Date.now()){this.state=new Uint32Array(4),this.init(t),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return 5.960464477539063e-8*(this.getUint32()>>>8)}init(t){if(!Number.isInteger(t))throw new TypeError("seed must be an integer");this.state[0]=t,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let t=1;t<8;t++)this.state[3&t]^=t+Lpt(1812433253,this.state[t-1&3]^this.state[t-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let t=0;t<8;t++)this.nextState()}periodCertification(){0===this.state[0]&&0===this.state[1]&&0===this.state[2]&&0===this.state[3]&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let t=this.state[0];t^=t<<15,t^=t>>>18,t^=this.state[3]<<11,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=t}}function Fpt(t,e={},n=Math.random){const{size:r=1,replace:i=!1,probabilities:s}=e;let o,a;if(o="number"==typeof t?function(t){const e=[];for(let n=0;n<t;n++)e.push(n);return e}(t):t.slice(),s){if(!i)throw new Error("choice with probabilities and no replacement is not implemented");if(s.length!==o.length)throw new Error("the length of probabilities option should be equal to the number of choices");a=[s[0]];for(let t=1;t<s.length;t++)a[t]=a[t-1]+s[t];if(Math.abs(1-a[a.length-1])>1e-8)throw new Error(`probabilities should sum to 1, but instead sums to ${a[a.length-1]}`)}if(!1===i&&r>o.length)throw new Error("size option is too large");const l=[];for(let t=0;t<r;t++){const t=zpt(o.length,n,a);l.push(o[t]),i||o.splice(t,1)}return l}function zpt(t,e,n){const r=e();if(n){let t=0;for(;r>n[t];)t++;return t}return Math.floor(r*t)}class Bpt{constructor(t=Math.random){if("number"==typeof t){const e=new Dpt(t);this.randomGenerator=e.random}else this.randomGenerator=t}choice(t,e){return Fpt(t,e,this.randomGenerator)}random(){return this.randomGenerator()}randInt(t,e){return void 0===e&&(e=t,t=0),t+Math.floor(this.randomGenerator()*(e-t))}randomSample(t){const e=[];for(let n=0;n<t;n++)e.push(this.random());return e}}const Upt=Object.prototype.toString;function Vpt(t){return Upt.call(t).endsWith("Array]")}function jpt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Vpt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]>o&&(o=t[a]);return o}function Wpt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Vpt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[r],a=r+1;a<s;a++)t[a]<o&&(o=t[a]);return o}function Hpt(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Vpt(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!Vpt(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var r=Wpt(t),i=jpt(t);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=n.min,o=void 0===s?n.autoMinMax?r:0:s,a=n.max,l=void 0===a?n.autoMinMax?i:1:a;if(o>=l)throw new RangeError("min option must be smaller than max option");for(var c=(l-o)/(i-r),u=0;u<t.length;u++)e[u]=(t[u]-r)*c+o;return e}const Gpt=" ".repeat(2),qpt=" ".repeat(4);function Xpt(t,e={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8}=e;return`${t.constructor.name} {\n${Gpt}[\n${qpt}${function(t,e,n,r){const{rows:i,columns:s}=t,o=Math.min(i,e),a=Math.min(s,n),l=[];for(let e=0;e<o;e++){let n=[];for(let i=0;i<a;i++)n.push(Ypt(t.get(e,i),r));l.push(`${n.join(" ")}`)}a!==s&&(l[l.length-1]+=` ... ${s-n} more columns`);o!==i&&l.push(`... ${i-e} more rows`);return l.join(`\n${qpt}`)}(t,n,r,i)}\n${Gpt}]\n${Gpt}rows: ${t.rows}\n${Gpt}columns: ${t.columns}\n}`}function Ypt(t,e){const n=String(t);if(n.length<=e)return n.padEnd(e," ");const r=t.toPrecision(e-2);if(r.length<=e)return r;const i=t.toExponential(e-2),s=i.indexOf("e"),o=i.slice(s);return i.slice(0,e-o.length)+o}function Kpt(t,e,n){let r=n?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function Zpt(t,e,n){let r=n?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function Jpt(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Qpt(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function tft(t,e,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(nft("startRow",e),nft("endRow",n),nft("startColumn",r),nft("endColumn",i),e>n||r>i||e<0||e>=t.rows||n<0||n>=t.rows||r<0||r>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function eft(t,e=0){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function nft(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function rft(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class ift{static from1DArray(t,e,n){if(t*e!==n.length)throw new RangeError("data length does not match given dimensions");let r=new oft(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++)r.set(i,t,n[i*e+t]);return r}static rowVector(t){let e=new oft(1,t.length);for(let n=0;n<t.length;n++)e.set(0,n,t[n]);return e}static columnVector(t){let e=new oft(t.length,1);for(let n=0;n<t.length;n++)e.set(n,0,t[n]);return e}static zeros(t,e){return new oft(t,e)}static ones(t,e){return new oft(t,e).fill(1)}static rand(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{random:r=Math.random}=n;let i=new oft(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r());return i}static randInt(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{min:r=0,max:i=1e3,random:s=Math.random}=n;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(r>=i)throw new RangeError("min must be smaller than max");let o=i-r,a=new oft(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=r+Math.round(s()*o);a.set(n,t,e)}return a}static eye(t,e,n){void 0===e&&(e=t),void 0===n&&(n=1);let r=Math.min(t,e),i=this.zeros(t,e);for(let t=0;t<r;t++)i.set(t,t,n);return i}static diag(t,e,n){let r=t.length;void 0===e&&(e=r),void 0===n&&(n=e);let i=Math.min(r,e,n),s=this.zeros(e,n);for(let e=0;e<i;e++)s.set(e,e,t[e]);return s}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new oft(n,r);for(let s=0;s<n;s++)for(let n=0;n<r;n++)i.set(s,n,Math.min(t.get(s,n),e.get(s,n)));return i}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new this(n,r);for(let s=0;s<n;s++)for(let n=0;n<r;n++)i.set(s,n,Math.max(t.get(s,n),e.get(s,n)));return i}static checkMatrix(t){return ift.isMatrix(t)?t:new oft(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.call(this,e,n);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let n=0;n<this.columns;n++)t[e].push(this.get(e,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);t++}return r}isReducedEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);for(let n=e+1;n<this.rows;n++)0!==this.get(t,n)&&(r=!1);t++}return r}echelonForm(){let t=this.clone(),e=0,n=0;for(;e<t.rows&&n<t.columns;){let r=e;for(let i=e;i<t.rows;i++)t.get(i,n)>t.get(r,n)&&(r=i);if(0===t.get(r,n))n++;else{t.swapRows(e,r);let i=t.get(e,n);for(let r=n;r<t.columns;r++)t.set(e,r,t.get(e,r)/i);for(let r=e+1;r<t.rows;r++){let i=t.get(r,n)/t.get(e,n);t.set(r,n,0);for(let s=n+1;s<t.columns;s++)t.set(r,s,t.get(r,s)-t.get(e,s)*i)}e++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,n=t.rows,r=n-1;for(;r>=0;)if(0===t.maxRow(r))r--;else{let i=0,s=!1;for(;i<n&&!1===s;)1===t.get(r,i)?s=!0:i++;for(let n=0;n<r;n++){let s=t.get(n,i);for(let o=i;o<e;o++){let e=t.get(n,o)-s*t.get(r,o);t.set(n,o,e)}}r--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let r=new oft(this.rows*e,this.columns*n);for(let t=0;t<e;t++)for(let e=0;e<n;e++)r.setSubMatrix(this,this.rows*t,this.columns*e);return r}fill(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,t);return this}neg(){return this.mulS(-1)}getRow(t){Kpt(this,t);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}getRowVector(t){return oft.rowVector(this.getRow(t))}setRow(t,e){Kpt(this,t),e=Jpt(this,e);for(let n=0;n<this.columns;n++)this.set(t,n,e[n]);return this}swapRows(t,e){Kpt(this,t),Kpt(this,e);for(let n=0;n<this.columns;n++){let r=this.get(t,n);this.set(t,n,this.get(e,n)),this.set(e,n,r)}return this}getColumn(t){Zpt(this,t);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,t));return e}getColumnVector(t){return oft.columnVector(this.getColumn(t))}setColumn(t,e){Zpt(this,t),e=Qpt(this,e);for(let n=0;n<this.rows;n++)this.set(n,t,e[n]);return this}swapColumns(t,e){Zpt(this,t),Zpt(this,e);for(let n=0;n<this.rows;n++){let r=this.get(n,t);this.set(n,t,this.get(n,e)),this.set(n,e,r)}return this}addRowVector(t){t=Jpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[n]);return this}subRowVector(t){t=Jpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[n]);return this}mulRowVector(t){t=Jpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[n]);return this}divRowVector(t){t=Jpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[n]);return this}addColumnVector(t){t=Qpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[e]);return this}subColumnVector(t){t=Qpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[e]);return this}mulColumnVector(t){t=Qpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[e]);return this}divColumnVector(t){t=Qpt(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[e]);return this}mulRow(t,e){Kpt(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this}mulColumn(t,e){Zpt(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){rft(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[e]&&(t[e]=this.get(e,n));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t[n]&&(t[n]=this.get(e,n));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){rft(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}maxRow(t){if(Kpt(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxRowIndex(t){Kpt(this,t),rft(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),n[1]=r);return n}minRow(t){if(Kpt(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minRowIndex(t){Kpt(this,t),rft(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),n[1]=r);return n}maxColumn(t){if(Zpt(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t));return e}maxColumnIndex(t){Zpt(this,t),rft(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t),n[0]=r);return n}minColumn(t){if(Zpt(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t));return e}minColumnIndex(t){Zpt(this,t),rft(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t),n[0]=r);return n}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let n=0;n<t;n++)e.push(this.get(n,n));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e+=this.get(t,n)*this.get(t,n);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n),this.set(e,n,t);return this}dot(t){ift.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}mmul(t){t=oft.checkMatrix(t);let e=this.rows,n=this.columns,r=t.columns,i=new oft(e,r),s=new Float64Array(n);for(let o=0;o<r;o++){for(let e=0;e<n;e++)s[e]=t.get(e,o);for(let t=0;t<e;t++){let e=0;for(let r=0;r<n;r++)e+=this.get(t,r)*s[r];i.set(t,o,e)}}return i}strassen2x2(t){t=oft.checkMatrix(t);let e=new oft(2,2);const n=this.get(0,0),r=t.get(0,0),i=this.get(0,1),s=t.get(0,1),o=this.get(1,0),a=t.get(1,0),l=this.get(1,1),c=t.get(1,1),u=(n+l)*(r+c),h=(o+l)*r,d=n*(s-c),p=l*(a-r),f=(n+i)*c,m=u+p-f+(i-l)*(a+c),g=d+f,y=h+p,b=u-h+d+(o-n)*(r+s);return e.set(0,0,m),e.set(0,1,g),e.set(1,0,y),e.set(1,1,b),e}strassen3x3(t){t=oft.checkMatrix(t);let e=new oft(3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),s=this.get(1,0),o=this.get(1,1),a=this.get(1,2),l=this.get(2,0),c=this.get(2,1),u=this.get(2,2),h=t.get(0,0),d=t.get(0,1),p=t.get(0,2),f=t.get(1,0),m=t.get(1,1),g=t.get(1,2),y=t.get(2,0),b=t.get(2,1),v=t.get(2,2),x=(n-s)*(-d+m),w=(-n+s+o)*(h-d+m),_=(s+o)*(-h+d),S=n*h,k=(-n+l+c)*(h-p+g),T=(-n+l)*(p-g),E=(l+c)*(-h+p),M=(-i+c+u)*(m+y-b),C=(i-u)*(m-b),A=i*y,N=(c+u)*(-y+b),I=(-i+o+a)*(g+y-v),$=(i-a)*(g-v),R=(o+a)*(-y+v),O=S+A+r*f,P=(n+r+i-s-o-c-u)*m+w+_+S+M+A+N,L=S+k+E+(n+r+i-o-a-l-c)*g+A+I+R,D=x+o*(-h+d+f-m-g-y+v)+w+S+A+I+$,F=x+w+_+S+a*b,z=A+I+$+R+s*p,B=S+k+T+c*(-h+p+f-m-g-y+b)+M+C+A,U=M+C+A+N+l*d,V=S+k+T+E+u*v;return e.set(0,0,O),e.set(0,1,P),e.set(0,2,L),e.set(1,0,D),e.set(1,1,F),e.set(1,2,z),e.set(2,0,B),e.set(2,1,U),e.set(2,2,V),e}mmulStrassen(t){t=oft.checkMatrix(t);let e=this.clone(),n=e.rows,r=e.columns,i=t.rows,s=t.columns;function o(t,e,n){let r=t.rows,i=t.columns;if(r===e&&i===n)return t;{let r=ift.zeros(e,n);return r=r.setSubMatrix(t,0,0),r}}r!==i&&console.warn(`Multiplying ${n} x ${r} and ${i} x ${s} matrix: dimensions do not match.`);let a=Math.max(n,i),l=Math.max(r,s);return e=o(e,a,l),function t(e,n,r,i){if(r<=512||i<=512)return e.mmul(n);r%2==1&&i%2==1?(e=o(e,r+1,i+1),n=o(n,r+1,i+1)):r%2==1?(e=o(e,r+1,i),n=o(n,r+1,i)):i%2==1&&(e=o(e,r,i+1),n=o(n,r,i+1));let s=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),l=e.subMatrix(0,s-1,0,a-1),c=n.subMatrix(0,s-1,0,a-1),u=e.subMatrix(0,s-1,a,e.columns-1),h=n.subMatrix(0,s-1,a,n.columns-1),d=e.subMatrix(s,e.rows-1,0,a-1),p=n.subMatrix(s,n.rows-1,0,a-1),f=e.subMatrix(s,e.rows-1,a,e.columns-1),m=n.subMatrix(s,n.rows-1,a,n.columns-1),g=t(ift.add(l,f),ift.add(c,m),s,a),y=t(ift.add(d,f),c,s,a),b=t(l,ift.sub(h,m),s,a),v=t(f,ift.sub(p,c),s,a),x=t(ift.add(l,u),m,s,a),w=t(ift.sub(d,l),ift.add(c,h),s,a),_=t(ift.sub(u,f),ift.add(p,m),s,a),S=ift.add(g,v);S.sub(x),S.add(_);let k=ift.add(b,x),T=ift.add(y,v),E=ift.sub(g,y);E.add(b),E.add(w);let M=ift.zeros(2*S.rows,2*S.columns);return M=M.setSubMatrix(S,0,0),M=M.setSubMatrix(k,S.rows,0),M=M.setSubMatrix(T,0,S.columns),M=M.setSubMatrix(E,S.rows,S.columns),M.subMatrix(0,r-1,0,i-1)}(e,t=o(t,a,l),a,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new oft(this.rows,this.columns);for(let t=0;t<this.rows;t++){const i=this.getRow(t);i.length>0&&Hpt(i,{min:e,max:n,output:i}),r.setRow(t,i)}return r}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new oft(this.rows,this.columns);for(let t=0;t<this.columns;t++){const i=this.getColumn(t);i.length&&Hpt(i,{min:e,max:n,output:i}),r.setColumn(t,i)}return r}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<t;n++){let t=this.get(e,n),r=this.get(e,this.columns-1-n);this.set(e,n,r),this.set(e,this.columns-1-n,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<t;n++){let t=this.get(n,e),r=this.get(this.rows-1-n,e);this.set(n,e,r),this.set(this.rows-1-n,e,t)}return this}kroneckerProduct(t){t=oft.checkMatrix(t);let e=this.rows,n=this.columns,r=t.rows,i=t.columns,s=new oft(e*r,n*i);for(let o=0;o<e;o++)for(let e=0;e<n;e++)for(let n=0;n<r;n++)for(let a=0;a<i;a++)s.set(r*o+n,i*e+a,this.get(o,e)*t.get(n,a));return s}kroneckerSum(t){if(t=oft.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=t.rows,r=this.kroneckerProduct(oft.eye(n,n)),i=oft.eye(e,e).kroneckerProduct(t);return r.add(i)}transpose(){let t=new oft(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(n,e,this.get(e,n));return t}sortRows(t=sft){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=sft){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,n,r){tft(this,t,e,n,r);let i=new oft(e-t+1,r-n+1);for(let s=t;s<=e;s++)for(let e=n;e<=r;e++)i.set(s-t,e-n,this.get(s,e));return i}subMatrixRow(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let r=new oft(t.length,n-e+1);for(let i=0;i<t.length;i++)for(let s=e;s<=n;s++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);r.set(i,s-e,this.get(t[i],s))}return r}subMatrixColumn(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let r=new oft(n-e+1,t.length);for(let i=0;i<t.length;i++)for(let s=e;s<=n;s++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);r.set(s-e,i,this.get(s,t[i]))}return r}setSubMatrix(t,e,n){if((t=oft.checkMatrix(t)).isEmpty())return this;tft(this,e,e+t.rows-1,n,n+t.columns-1);for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)this.set(e+r,n+i,t.get(r,i));return this}selection(t,e){!function(t,e){if(!Vpt(e))throw new TypeError("row indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.rows)throw new RangeError("row indices are out of range")}(this,t),function(t,e){if(!Vpt(e))throw new TypeError("column indices must be an array");for(let n=0;n<e.length;n++)if(e[n]<0||e[n]>=t.columns)throw new RangeError("column indices are out of range")}(this,e);let n=new oft(t.length,e.length);for(let r=0;r<t.length;r++){let i=t[r];for(let t=0;t<e.length;t++){let s=e[t];n.set(r,t,this.get(i,s))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let n=0;n<t;n++)e+=this.get(n,n);return e}clone(){let t=new oft(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(e,n,this.get(e,n));return t}sum(t){switch(t){case"row":return function(t){let e=eft(t.rows);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]+=t.get(n,r);return e}(this);case"column":return function(t){let e=eft(t.columns);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]+=t.get(n,r);return e}(this);case void 0:return function(t){let e=0;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e+=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=eft(t.rows,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]*=t.get(n,r);return e}(this);case"column":return function(t){let e=eft(t.columns,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]*=t.get(n,r);return e}(this);case void 0:return function(t){let e=1;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e*=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:n=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof n)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Vpt(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<r;o++){let r=0,a=0,l=0;for(let e=0;e<i;e++)l=t.get(o,e)-n[o],r+=l,a+=l*l;e?s.push((a-r*r/i)/(i-1)):s.push((a-r*r/i)/i)}return s}(this,n,r);case"column":if(!Vpt(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,s=[];for(let o=0;o<i;o++){let i=0,a=0,l=0;for(let e=0;e<r;e++)l=t.get(e,o)-n[o],i+=l,a+=l*l;e?s.push((a-i*i/r)/(r-1)):s.push((a-i*i/r)/r)}return s}(this,n,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,n){const r=t.rows,i=t.columns,s=r*i;let o=0,a=0,l=0;for(let e=0;e<r;e++)for(let r=0;r<i;r++)l=t.get(e,r)-n,o+=l,a+=l*l;return e?(a-o*o/s)/(s-1):(a-o*o/s)/s}(this,n,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const n=this.variance(t,e);if(void 0===t)return Math.sqrt(n);for(let t=0;t<n.length;t++)n[t]=Math.sqrt(n[t]);return n}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:n=this.mean(t)}=e;switch(t){case"row":if(!Vpt(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[n])}(this,n),this;case"column":if(!Vpt(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[r])}(this,n),this;case void 0:if("number"!=typeof n)throw new TypeError("center must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let n=e.scale;switch(t){case"row":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.rows;n++){let r=0;for(let e=0;e<t.columns;e++)r+=Math.pow(t.get(n,e),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}(this);else if(!Vpt(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[n])}(this,n),this;case"column":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.columns;n++){let r=0;for(let e=0;e<t.rows;e++)r+=Math.pow(t.get(e,n),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}(this);else if(!Vpt(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[r])}(this,n),this;case void 0:if(void 0===n)n=function(t){const e=t.size-1;let n=0;for(let r=0;r<t.columns;r++)for(let i=0;i<t.rows;i++)n+=Math.pow(t.get(i,r),2)/e;return Math.sqrt(n)}(this);else if("number"!=typeof n)throw new TypeError("scale must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return Xpt(this,t)}}function sft(t,e){return t-e}ift.prototype.klass="Matrix","undefined"!=typeof Symbol&&(ift.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return Xpt(this)}),ift.random=ift.rand,ift.randomInt=ift.randInt,ift.diagonal=ift.diag,ift.prototype.diagonal=ift.prototype.diag,ift.identity=ift.eye,ift.prototype.negate=ift.prototype.neg,ift.prototype.tensorProduct=ift.prototype.kroneckerProduct;class oft extends ift{constructor(t,e){if(super(),oft.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let n=0;n<t;n++)this.data.push(new Float64Array(e))}else{if(!Vpt(t))throw new TypeError("First argument must be a positive number or an array");{const n=t;if("number"!=typeof(e=(t=n.length)?n[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<t;r++){if(n[r].length!==e)throw new RangeError("Inconsistent array dimensions");if(!n[r].every((t=>"number"==typeof t)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[r]))}}}this.rows=t,this.columns=e}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}removeRow(t){return Kpt(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),Kpt(this,t,!0),e=Float64Array.from(Jpt(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){Zpt(this,t);for(let e=0;e<this.rows;e++){const n=new Float64Array(this.columns-1);for(let r=0;r<t;r++)n[r]=this.data[e][r];for(let r=t+1;r<this.columns;r++)n[r-1]=this.data[e][r];this.data[e]=n}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),Zpt(this,t,!0),e=Qpt(this,e);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns+1);let i=0;for(;i<t;i++)r[i]=this.data[n][i];for(r[i++]=e[n];i<this.columns+1;i++)r[i]=this.data[n][i-1];this.data[n]=r}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t.get(e,n));return this},t.add=function(t,n){return new e(t).add(n)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t.get(e,n));return this},t.sub=function(t,n){return new e(t).sub(n)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t.get(e,n));return this},t.mul=function(t,n){return new e(t).mul(n)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t.get(e,n));return this},t.div=function(t,n){return new e(t).div(n)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t.get(e,n));return this},t.mod=function(t,n){return new e(t).mod(n)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t.get(e,n));return this},t.and=function(t,n){return new e(t).and(n)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t.get(e,n));return this},t.or=function(t,n){return new e(t).or(n)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t.get(e,n));return this},t.xor=function(t,n){return new e(t).xor(n)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t.get(e,n));return this},t.leftShift=function(t,n){return new e(t).leftShift(n)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t.get(e,n));return this},t.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t.get(e,n));return this},t.rightShift=function(t,n){return new e(t).rightShift(n)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,n){return new e(t).pow(n)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t.get(e,n)));return this}}(ift,oft);class aft extends ift{constructor(t,e,n){super(),this.matrix=t,this.rows=e,this.columns=n}}class lft extends aft{constructor(t){super(t,t.columns,t.rows)}set(t,e,n){return this.matrix.set(e,t,n),this}get(t,e){return this.matrix.get(e,t)}}class cft extends ift{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}}class uft{constructor(t){let e,n,r,i,s,o,a,l,c,u=(t=cft.checkMatrix(t)).clone(),h=u.rows,d=u.columns,p=new Float64Array(h),f=1;for(e=0;e<h;e++)p[e]=e;for(l=new Float64Array(h),n=0;n<d;n++){for(e=0;e<h;e++)l[e]=u.get(e,n);for(e=0;e<h;e++){for(c=Math.min(e,n),s=0,r=0;r<c;r++)s+=u.get(e,r)*l[r];l[e]-=s,u.set(e,n,l[e])}for(i=n,e=n+1;e<h;e++)Math.abs(l[e])>Math.abs(l[i])&&(i=e);if(i!==n){for(r=0;r<d;r++)o=u.get(i,r),u.set(i,r,u.get(n,r)),u.set(n,r,o);a=p[i],p[i]=p[n],p[n]=a,f=-f}if(n<h&&0!==u.get(n,n))for(e=n+1;e<h;e++)u.set(e,n,u.get(e,n)/u.get(n,n))}this.LU=u,this.pivotVector=p,this.pivotSign=f}isSingular(){let t=this.LU,e=t.columns;for(let n=0;n<e;n++)if(0===t.get(n,n))return!0;return!1}solve(t){t=oft.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n,r,i,s=t.columns,o=t.subMatrixRow(this.pivotVector,0,s-1),a=e.columns;for(i=0;i<a;i++)for(n=i+1;n<a;n++)for(r=0;r<s;r++)o.set(n,r,o.get(n,r)-o.get(i,r)*e.get(n,i));for(i=a-1;i>=0;i--){for(r=0;r<s;r++)o.set(i,r,o.get(i,r)/e.get(i,i));for(n=0;n<i;n++)for(r=0;r<s;r++)o.set(n,r,o.get(n,r)-o.get(i,r)*e.get(n,i))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,n=t.columns;for(let r=0;r<n;r++)e*=t.get(r,r);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new oft(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i>e?r.set(i,e,t.get(i,e)):i===e?r.set(i,e,1):r.set(i,e,0);return r}get upperTriangularMatrix(){let t=this.LU,e=t.rows,n=t.columns,r=new oft(e,n);for(let i=0;i<e;i++)for(let e=0;e<n;e++)i<=e?r.set(i,e,t.get(i,e)):r.set(i,e,0);return r}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hft(t,e){let n=0;return Math.abs(t)>Math.abs(e)?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0!==e?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0}class dft{constructor(t){let e,n,r,i,s=(t=cft.checkMatrix(t)).clone(),o=t.rows,a=t.columns,l=new Float64Array(a);for(r=0;r<a;r++){let t=0;for(e=r;e<o;e++)t=hft(t,s.get(e,r));if(0!==t){for(s.get(r,r)<0&&(t=-t),e=r;e<o;e++)s.set(e,r,s.get(e,r)/t);for(s.set(r,r,s.get(r,r)+1),n=r+1;n<a;n++){for(i=0,e=r;e<o;e++)i+=s.get(e,r)*s.get(e,n);for(i=-i/s.get(r,r),e=r;e<o;e++)s.set(e,n,s.get(e,n)+i*s.get(e,r))}}l[r]=-t}this.QR=s,this.Rdiag=l}solve(t){t=oft.checkMatrix(t);let e=this.QR,n=e.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let r,i,s,o,a=t.columns,l=t.clone(),c=e.columns;for(s=0;s<c;s++)for(i=0;i<a;i++){for(o=0,r=s;r<n;r++)o+=e.get(r,s)*l.get(r,i);for(o=-o/e.get(s,s),r=s;r<n;r++)l.set(r,i,l.get(r,i)+o*e.get(r,s))}for(s=c-1;s>=0;s--){for(i=0;i<a;i++)l.set(s,i,l.get(s,i)/this.Rdiag[s]);for(r=0;r<s;r++)for(i=0;i<a;i++)l.set(r,i,l.get(r,i)-l.get(s,i)*e.get(r,s))}return l.subMatrix(0,c-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,n=this.QR,r=n.columns,i=new oft(r,r);for(t=0;t<r;t++)for(e=0;e<r;e++)t<e?i.set(t,e,n.get(t,e)):t===e?i.set(t,e,this.Rdiag[t]):i.set(t,e,0);return i}get orthogonalMatrix(){let t,e,n,r,i=this.QR,s=i.rows,o=i.columns,a=new oft(s,o);for(n=o-1;n>=0;n--){for(t=0;t<s;t++)a.set(t,n,0);for(a.set(n,n,1),e=n;e<o;e++)if(0!==i.get(n,n)){for(r=0,t=n;t<s;t++)r+=i.get(t,n)*a.get(t,e);for(r=-r/i.get(n,n),t=n;t<s;t++)a.set(t,e,a.get(t,e)+r*i.get(t,n))}}return a}}class pft{constructor(t,e={}){if((t=cft.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,r=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:s=!0,autoTranspose:o=!1}=e;let a,l=Boolean(i),c=Boolean(s),u=!1;if(n<r)if(o){a=t.transpose(),n=a.rows,r=a.columns,u=!0;let e=l;l=c,c=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let h=Math.min(n,r),d=Math.min(n+1,r),p=new Float64Array(d),f=new oft(n,h),m=new oft(r,r),g=new Float64Array(r),y=new Float64Array(n),b=new Float64Array(d);for(let t=0;t<d;t++)b[t]=t;let v=Math.min(n-1,r),x=Math.max(0,Math.min(r-2,n)),w=Math.max(v,x);for(let t=0;t<w;t++){if(t<v){p[t]=0;for(let e=t;e<n;e++)p[t]=hft(p[t],a.get(e,t));if(0!==p[t]){a.get(t,t)<0&&(p[t]=-p[t]);for(let e=t;e<n;e++)a.set(e,t,a.get(e,t)/p[t]);a.set(t,t,a.get(t,t)+1)}p[t]=-p[t]}for(let e=t+1;e<r;e++){if(t<v&&0!==p[t]){let r=0;for(let i=t;i<n;i++)r+=a.get(i,t)*a.get(i,e);r=-r/a.get(t,t);for(let i=t;i<n;i++)a.set(i,e,a.get(i,e)+r*a.get(i,t))}g[e]=a.get(t,e)}if(l&&t<v)for(let e=t;e<n;e++)f.set(e,t,a.get(e,t));if(t<x){g[t]=0;for(let e=t+1;e<r;e++)g[t]=hft(g[t],g[e]);if(0!==g[t]){g[t+1]<0&&(g[t]=0-g[t]);for(let e=t+1;e<r;e++)g[e]/=g[t];g[t+1]+=1}if(g[t]=-g[t],t+1<n&&0!==g[t]){for(let e=t+1;e<n;e++)y[e]=0;for(let e=t+1;e<n;e++)for(let n=t+1;n<r;n++)y[e]+=g[n]*a.get(e,n);for(let e=t+1;e<r;e++){let r=-g[e]/g[t+1];for(let i=t+1;i<n;i++)a.set(i,e,a.get(i,e)+r*y[i])}}if(c)for(let e=t+1;e<r;e++)m.set(e,t,g[e])}}let _=Math.min(r,n+1);if(v<r&&(p[v]=a.get(v,v)),n<_&&(p[_-1]=0),x+1<_&&(g[x]=a.get(x,_-1)),g[_-1]=0,l){for(let t=v;t<h;t++){for(let e=0;e<n;e++)f.set(e,t,0);f.set(t,t,1)}for(let t=v-1;t>=0;t--)if(0!==p[t]){for(let e=t+1;e<h;e++){let r=0;for(let i=t;i<n;i++)r+=f.get(i,t)*f.get(i,e);r=-r/f.get(t,t);for(let i=t;i<n;i++)f.set(i,e,f.get(i,e)+r*f.get(i,t))}for(let e=t;e<n;e++)f.set(e,t,-f.get(e,t));f.set(t,t,1+f.get(t,t));for(let e=0;e<t-1;e++)f.set(e,t,0)}else{for(let e=0;e<n;e++)f.set(e,t,0);f.set(t,t,1)}}if(c)for(let t=r-1;t>=0;t--){if(t<x&&0!==g[t])for(let e=t+1;e<r;e++){let n=0;for(let i=t+1;i<r;i++)n+=m.get(i,t)*m.get(i,e);n=-n/m.get(t+1,t);for(let i=t+1;i<r;i++)m.set(i,e,m.get(i,e)+n*m.get(i,t))}for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}let S=_-1,k=Number.EPSILON;for(;_>0;){let t,e;for(t=_-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+k*Math.abs(p[t]+Math.abs(p[t+1]));if(Math.abs(g[t])<=e||Number.isNaN(g[t])){g[t]=0;break}}if(t===_-2)e=4;else{let n;for(n=_-1;n>=t&&n!==t;n--){let e=(n!==_?Math.abs(g[n]):0)+(n!==t+1?Math.abs(g[n-1]):0);if(Math.abs(p[n])<=k*e){p[n]=0;break}}n===t?e=3:n===_-1?e=1:(e=2,t=n)}switch(t++,e){case 1:{let e=g[_-2];g[_-2]=0;for(let n=_-2;n>=t;n--){let i=hft(p[n],e),s=p[n]/i,o=e/i;if(p[n]=i,n!==t&&(e=-o*g[n-1],g[n-1]=s*g[n-1]),c)for(let t=0;t<r;t++)i=s*m.get(t,n)+o*m.get(t,_-1),m.set(t,_-1,-o*m.get(t,n)+s*m.get(t,_-1)),m.set(t,n,i)}break}case 2:{let e=g[t-1];g[t-1]=0;for(let r=t;r<_;r++){let i=hft(p[r],e),s=p[r]/i,o=e/i;if(p[r]=i,e=-o*g[r],g[r]=s*g[r],l)for(let e=0;e<n;e++)i=s*f.get(e,r)+o*f.get(e,t-1),f.set(e,t-1,-o*f.get(e,r)+s*f.get(e,t-1)),f.set(e,r,i)}break}case 3:{const e=Math.max(Math.abs(p[_-1]),Math.abs(p[_-2]),Math.abs(g[_-2]),Math.abs(p[t]),Math.abs(g[t])),i=p[_-1]/e,s=p[_-2]/e,o=g[_-2]/e,a=p[t]/e,u=g[t]/e,h=((s+i)*(s-i)+o*o)/2,d=i*o*(i*o);let y=0;0===h&&0===d||(y=h<0?0-Math.sqrt(h*h+d):Math.sqrt(h*h+d),y=d/(h+y));let b=(a+i)*(a-i)+y,v=a*u;for(let e=t;e<_-1;e++){let i=hft(b,v);0===i&&(i=Number.MIN_VALUE);let s=b/i,o=v/i;if(e!==t&&(g[e-1]=i),b=s*p[e]+o*g[e],g[e]=s*g[e]-o*p[e],v=o*p[e+1],p[e+1]=s*p[e+1],c)for(let t=0;t<r;t++)i=s*m.get(t,e)+o*m.get(t,e+1),m.set(t,e+1,-o*m.get(t,e)+s*m.get(t,e+1)),m.set(t,e,i);if(i=hft(b,v),0===i&&(i=Number.MIN_VALUE),s=b/i,o=v/i,p[e]=i,b=s*g[e]+o*p[e+1],p[e+1]=-o*g[e]+s*p[e+1],v=o*g[e+1],g[e+1]=s*g[e+1],l&&e<n-1)for(let t=0;t<n;t++)i=s*f.get(t,e)+o*f.get(t,e+1),f.set(t,e+1,-o*f.get(t,e)+s*f.get(t,e+1)),f.set(t,e,i)}g[_-2]=b;break}case 4:if(p[t]<=0&&(p[t]=p[t]<0?-p[t]:0,c))for(let e=0;e<=S;e++)m.set(e,t,-m.get(e,t));for(;t<S&&!(p[t]>=p[t+1]);){let e=p[t];if(p[t]=p[t+1],p[t+1]=e,c&&t<r-1)for(let n=0;n<r;n++)e=m.get(n,t+1),m.set(n,t+1,m.get(n,t)),m.set(n,t,e);if(l&&t<n-1)for(let r=0;r<n;r++)e=f.get(r,t+1),f.set(r,t+1,f.get(r,t)),f.set(r,t,e);t++}_--}}if(u){let t=m;m=f,f=t}this.m=n,this.n=r,this.s=p,this.U=f,this.V=m}solve(t){let e=t,n=this.threshold,r=this.s.length,i=oft.zeros(r,r);for(let t=0;t<r;t++)Math.abs(this.s[t])<=n?i.set(t,t,0):i.set(t,t,1/this.s[t]);let s=this.U,o=this.rightSingularVectors,a=o.mmul(i),l=o.rows,c=s.rows,u=oft.zeros(l,c);for(let t=0;t<l;t++)for(let e=0;e<c;e++){let n=0;for(let i=0;i<r;i++)n+=a.get(t,i)*s.get(e,i);u.set(t,e,n)}return u.mmul(e)}solveForDiagonal(t){return this.solve(oft.diag(t))}inverse(){let t=this.V,e=this.threshold,n=t.rows,r=t.columns,i=new oft(n,this.s.length);for(let s=0;s<n;s++)for(let n=0;n<r;n++)Math.abs(this.s[n])>e&&i.set(s,n,t.get(s,n)/this.s[n]);let s=this.U,o=s.rows,a=s.columns,l=new oft(n,o);for(let t=0;t<n;t++)for(let e=0;e<o;e++){let n=0;for(let r=0;r<a;r++)n+=i.get(t,r)*s.get(e,r);l.set(t,e,n)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let r=0,i=n.length;r<i;r++)n[r]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return oft.diag(this.s)}}function fft(t,e=!1){return t=cft.checkMatrix(t),e?new pft(t).inverse():function(t,e,n=!1){return t=cft.checkMatrix(t),e=cft.checkMatrix(e),n?new pft(t).solve(e):t.isSquare()?new uft(t).solve(e):new dft(t).solve(e)}(t,oft.eye(t.rows))}class mft{constructor(t,e={}){const{assumeSymmetric:n=!1}=e;if(!(t=cft.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let r,i,s=t.columns,o=new oft(s,s),a=new Float64Array(s),l=new Float64Array(s),c=t,u=!1;if(u=!!n||t.isSymmetric(),u){for(r=0;r<s;r++)for(i=0;i<s;i++)o.set(r,i,c.get(r,i));!function(t,e,n,r){let i,s,o,a,l,c,u,h;for(l=0;l<t;l++)n[l]=r.get(t-1,l);for(a=t-1;a>0;a--){for(h=0,o=0,c=0;c<a;c++)h+=Math.abs(n[c]);if(0===h)for(e[a]=n[a-1],l=0;l<a;l++)n[l]=r.get(a-1,l),r.set(a,l,0),r.set(l,a,0);else{for(c=0;c<a;c++)n[c]/=h,o+=n[c]*n[c];for(i=n[a-1],s=Math.sqrt(o),i>0&&(s=-s),e[a]=h*s,o-=i*s,n[a-1]=i-s,l=0;l<a;l++)e[l]=0;for(l=0;l<a;l++){for(i=n[l],r.set(l,a,i),s=e[l]+r.get(l,l)*i,c=l+1;c<=a-1;c++)s+=r.get(c,l)*n[c],e[c]+=r.get(c,l)*i;e[l]=s}for(i=0,l=0;l<a;l++)e[l]/=o,i+=e[l]*n[l];for(u=i/(o+o),l=0;l<a;l++)e[l]-=u*n[l];for(l=0;l<a;l++){for(i=n[l],s=e[l],c=l;c<=a-1;c++)r.set(c,l,r.get(c,l)-(i*e[c]+s*n[c]));n[l]=r.get(a-1,l),r.set(a,l,0)}}n[a]=o}for(a=0;a<t-1;a++){if(r.set(t-1,a,r.get(a,a)),r.set(a,a,1),o=n[a+1],0!==o){for(c=0;c<=a;c++)n[c]=r.get(c,a+1)/o;for(l=0;l<=a;l++){for(s=0,c=0;c<=a;c++)s+=r.get(c,a+1)*r.get(c,l);for(c=0;c<=a;c++)r.set(c,l,r.get(c,l)-s*n[c])}}for(c=0;c<=a;c++)r.set(c,a+1,0)}for(l=0;l<t;l++)n[l]=r.get(t-1,l),r.set(t-1,l,0);r.set(t-1,t-1,1),e[0]=0}(s,l,a,o),function(t,e,n,r){let i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v;for(o=1;o<t;o++)e[o-1]=e[o];e[t-1]=0;let x=0,w=0,_=Number.EPSILON;for(c=0;c<t;c++){for(w=Math.max(w,Math.abs(n[c])+Math.abs(e[c])),u=c;u<t&&!(Math.abs(e[u])<=_*w);)u++;if(u>c)do{for(i=n[c],h=(n[c+1]-i)/(2*e[c]),d=hft(h,1),h<0&&(d=-d),n[c]=e[c]/(h+d),n[c+1]=e[c]*(h+d),p=n[c+1],s=i-n[c],o=c+2;o<t;o++)n[o]-=s;for(x+=s,h=n[u],f=1,m=f,g=f,y=e[c+1],b=0,v=0,o=u-1;o>=c;o--)for(g=m,m=f,v=b,i=f*e[o],s=f*h,d=hft(h,e[o]),e[o+1]=b*d,b=e[o]/d,f=h/d,h=f*n[o]-b*i,n[o+1]=s+b*(f*i+b*n[o]),l=0;l<t;l++)s=r.get(l,o+1),r.set(l,o+1,b*r.get(l,o)+f*s),r.set(l,o,f*r.get(l,o)-b*s);h=-b*v*g*y*e[c]/p,e[c]=b*h,n[c]=f*h}while(Math.abs(e[c])>_*w);n[c]=n[c]+x,e[c]=0}for(o=0;o<t-1;o++){for(l=o,h=n[o],a=o+1;a<t;a++)n[a]<h&&(l=a,h=n[a]);if(l!==o)for(n[l]=n[o],n[o]=h,a=0;a<t;a++)h=r.get(a,o),r.set(a,o,r.get(a,l)),r.set(a,l,h)}}(s,l,a,o)}else{let t=new oft(s,s),e=new Float64Array(s);for(i=0;i<s;i++)for(r=0;r<s;r++)t.set(r,i,c.get(r,i));!function(t,e,n,r){let i,s,o,a,l,c,u,h=0,d=t-1;for(c=h+1;c<=d-1;c++){for(u=0,a=c;a<=d;a++)u+=Math.abs(e.get(a,c-1));if(0!==u){for(o=0,a=d;a>=c;a--)n[a]=e.get(a,c-1)/u,o+=n[a]*n[a];for(s=Math.sqrt(o),n[c]>0&&(s=-s),o-=n[c]*s,n[c]=n[c]-s,l=c;l<t;l++){for(i=0,a=d;a>=c;a--)i+=n[a]*e.get(a,l);for(i/=o,a=c;a<=d;a++)e.set(a,l,e.get(a,l)-i*n[a])}for(a=0;a<=d;a++){for(i=0,l=d;l>=c;l--)i+=n[l]*e.get(a,l);for(i/=o,l=c;l<=d;l++)e.set(a,l,e.get(a,l)-i*n[l])}n[c]=u*n[c],e.set(c,c-1,u*s)}}for(a=0;a<t;a++)for(l=0;l<t;l++)r.set(a,l,a===l?1:0);for(c=d-1;c>=h+1;c--)if(0!==e.get(c,c-1)){for(a=c+1;a<=d;a++)n[a]=e.get(a,c-1);for(l=c;l<=d;l++){for(s=0,a=c;a<=d;a++)s+=n[a]*r.get(a,l);for(s=s/n[c]/e.get(c,c-1),a=c;a<=d;a++)r.set(a,l,r.get(a,l)+s*n[a])}}}(s,t,e,o),function(t,e,n,r,i){let s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x=t-1,w=0,_=t-1,S=Number.EPSILON,k=0,T=0,E=0,M=0,C=0,A=0,N=0,I=0;for(s=0;s<t;s++)for((s<w||s>_)&&(n[s]=i.get(s,s),e[s]=0),o=Math.max(s-1,0);o<t;o++)T+=Math.abs(i.get(s,o));for(;x>=w;){for(l=x;l>w&&(A=Math.abs(i.get(l-1,l-1))+Math.abs(i.get(l,l)),0===A&&(A=T),!(Math.abs(i.get(l,l-1))<S*A));)l--;if(l===x)i.set(x,x,i.get(x,x)+k),n[x]=i.get(x,x),e[x]=0,x--,I=0;else if(l===x-1){if(h=i.get(x,x-1)*i.get(x-1,x),E=(i.get(x-1,x-1)-i.get(x,x))/2,M=E*E+h,N=Math.sqrt(Math.abs(M)),i.set(x,x,i.get(x,x)+k),i.set(x-1,x-1,i.get(x-1,x-1)+k),d=i.get(x,x),M>=0){for(N=E>=0?E+N:E-N,n[x-1]=d+N,n[x]=n[x-1],0!==N&&(n[x]=d-h/N),e[x-1]=0,e[x]=0,d=i.get(x,x-1),A=Math.abs(d)+Math.abs(N),E=d/A,M=N/A,C=Math.sqrt(E*E+M*M),E/=C,M/=C,o=x-1;o<t;o++)N=i.get(x-1,o),i.set(x-1,o,M*N+E*i.get(x,o)),i.set(x,o,M*i.get(x,o)-E*N);for(s=0;s<=x;s++)N=i.get(s,x-1),i.set(s,x-1,M*N+E*i.get(s,x)),i.set(s,x,M*i.get(s,x)-E*N);for(s=w;s<=_;s++)N=r.get(s,x-1),r.set(s,x-1,M*N+E*r.get(s,x)),r.set(s,x,M*r.get(s,x)-E*N)}else n[x-1]=d+E,n[x]=d+E,e[x-1]=N,e[x]=-N;x-=2,I=0}else{if(d=i.get(x,x),p=0,h=0,l<x&&(p=i.get(x-1,x-1),h=i.get(x,x-1)*i.get(x-1,x)),10===I){for(k+=d,s=w;s<=x;s++)i.set(s,s,i.get(s,s)-d);A=Math.abs(i.get(x,x-1))+Math.abs(i.get(x-1,x-2)),d=p=.75*A,h=-.4375*A*A}if(30===I&&(A=(p-d)/2,A=A*A+h,A>0)){for(A=Math.sqrt(A),p<d&&(A=-A),A=d-h/((p-d)/2+A),s=w;s<=x;s++)i.set(s,s,i.get(s,s)-A);k+=A,d=p=h=.964}for(I+=1,c=x-2;c>=l&&(N=i.get(c,c),C=d-N,A=p-N,E=(C*A-h)/i.get(c+1,c)+i.get(c,c+1),M=i.get(c+1,c+1)-N-C-A,C=i.get(c+2,c+1),A=Math.abs(E)+Math.abs(M)+Math.abs(C),E/=A,M/=A,C/=A,c!==l)&&!(Math.abs(i.get(c,c-1))*(Math.abs(M)+Math.abs(C))<S*(Math.abs(E)*(Math.abs(i.get(c-1,c-1))+Math.abs(N)+Math.abs(i.get(c+1,c+1)))));)c--;for(s=c+2;s<=x;s++)i.set(s,s-2,0),s>c+2&&i.set(s,s-3,0);for(a=c;a<=x-1&&(b=a!==x-1,a!==c&&(E=i.get(a,a-1),M=i.get(a+1,a-1),C=b?i.get(a+2,a-1):0,d=Math.abs(E)+Math.abs(M)+Math.abs(C),0!==d&&(E/=d,M/=d,C/=d)),0!==d);a++)if(A=Math.sqrt(E*E+M*M+C*C),E<0&&(A=-A),0!==A){for(a!==c?i.set(a,a-1,-A*d):l!==c&&i.set(a,a-1,-i.get(a,a-1)),E+=A,d=E/A,p=M/A,N=C/A,M/=E,C/=E,o=a;o<t;o++)E=i.get(a,o)+M*i.get(a+1,o),b&&(E+=C*i.get(a+2,o),i.set(a+2,o,i.get(a+2,o)-E*N)),i.set(a,o,i.get(a,o)-E*d),i.set(a+1,o,i.get(a+1,o)-E*p);for(s=0;s<=Math.min(x,a+3);s++)E=d*i.get(s,a)+p*i.get(s,a+1),b&&(E+=N*i.get(s,a+2),i.set(s,a+2,i.get(s,a+2)-E*C)),i.set(s,a,i.get(s,a)-E),i.set(s,a+1,i.get(s,a+1)-E*M);for(s=w;s<=_;s++)E=d*r.get(s,a)+p*r.get(s,a+1),b&&(E+=N*r.get(s,a+2),r.set(s,a+2,r.get(s,a+2)-E*C)),r.set(s,a,r.get(s,a)-E),r.set(s,a+1,r.get(s,a+1)-E*M)}}}if(0===T)return;for(x=t-1;x>=0;x--)if(E=n[x],M=e[x],0===M)for(l=x,i.set(x,x,1),s=x-1;s>=0;s--){for(h=i.get(s,s)-E,C=0,o=l;o<=x;o++)C+=i.get(s,o)*i.get(o,x);if(e[s]<0)N=h,A=C;else if(l=s,0===e[s]?i.set(s,x,0!==h?-C/h:-C/(S*T)):(d=i.get(s,s+1),p=i.get(s+1,s),M=(n[s]-E)*(n[s]-E)+e[s]*e[s],u=(d*A-N*C)/M,i.set(s,x,u),i.set(s+1,x,Math.abs(d)>Math.abs(N)?(-C-h*u)/d:(-A-p*u)/N)),u=Math.abs(i.get(s,x)),S*u*u>1)for(o=s;o<=x;o++)i.set(o,x,i.get(o,x)/u)}else if(M<0)for(l=x-1,Math.abs(i.get(x,x-1))>Math.abs(i.get(x-1,x))?(i.set(x-1,x-1,M/i.get(x,x-1)),i.set(x-1,x,-(i.get(x,x)-E)/i.get(x,x-1))):(v=gft(0,-i.get(x-1,x),i.get(x-1,x-1)-E,M),i.set(x-1,x-1,v[0]),i.set(x-1,x,v[1])),i.set(x,x-1,0),i.set(x,x,1),s=x-2;s>=0;s--){for(f=0,m=0,o=l;o<=x;o++)f+=i.get(s,o)*i.get(o,x-1),m+=i.get(s,o)*i.get(o,x);if(h=i.get(s,s)-E,e[s]<0)N=h,C=f,A=m;else if(l=s,0===e[s]?(v=gft(-f,-m,h,M),i.set(s,x-1,v[0]),i.set(s,x,v[1])):(d=i.get(s,s+1),p=i.get(s+1,s),g=(n[s]-E)*(n[s]-E)+e[s]*e[s]-M*M,y=2*(n[s]-E)*M,0===g&&0===y&&(g=S*T*(Math.abs(h)+Math.abs(M)+Math.abs(d)+Math.abs(p)+Math.abs(N))),v=gft(d*C-N*f+M*m,d*A-N*m-M*f,g,y),i.set(s,x-1,v[0]),i.set(s,x,v[1]),Math.abs(d)>Math.abs(N)+Math.abs(M)?(i.set(s+1,x-1,(-f-h*i.get(s,x-1)+M*i.get(s,x))/d),i.set(s+1,x,(-m-h*i.get(s,x)-M*i.get(s,x-1))/d)):(v=gft(-C-p*i.get(s,x-1),-A-p*i.get(s,x),N,M),i.set(s+1,x-1,v[0]),i.set(s+1,x,v[1]))),u=Math.max(Math.abs(i.get(s,x-1)),Math.abs(i.get(s,x))),S*u*u>1)for(o=s;o<=x;o++)i.set(o,x-1,i.get(o,x-1)/u),i.set(o,x,i.get(o,x)/u)}for(s=0;s<t;s++)if(s<w||s>_)for(o=s;o<t;o++)r.set(s,o,i.get(s,o));for(o=t-1;o>=w;o--)for(s=w;s<=_;s++){for(N=0,a=w;a<=Math.min(o,_);a++)N+=r.get(s,a)*i.get(a,o);r.set(s,o,N)}}(s,l,a,o,t)}this.n=s,this.e=l,this.d=a,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,n=this.n,r=this.e,i=this.d,s=new oft(n,n);for(t=0;t<n;t++){for(e=0;e<n;e++)s.set(t,e,0);s.set(t,t,i[t]),r[t]>0?s.set(t,t+1,r[t]):r[t]<0&&s.set(t,t-1,r[t])}return s}}function gft(t,e,n,r){let i,s;return Math.abs(n)>Math.abs(r)?(i=r/n,s=n+i*r,[(t+i*e)/s,(e-i*t)/s]):(i=n/r,s=r+i*n,[(i*t+e)/s,(i*e-t)/s])}class yft{constructor(t,e={}){t=cft.checkMatrix(t);let{Y:n}=e;const{scaleScores:r=!1,maxIterations:i=1e3,terminationCriteria:s=1e-10}=e;let o;if(n){if(n=Vpt(n)&&"number"==typeof n[0]?oft.columnVector(n):cft.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");o=n.getColumnVector(0)}else o=t.getColumnVector(0);let a,l,c,u,h=1;for(let e=0;e<i&&h>s;e++)c=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),c=c.div(c.norm()),a=t.mmul(c).div(c.transpose().mmul(c).get(0,0)),e>0&&(h=a.clone().sub(u).pow(2).sum()),u=a.clone(),n?(l=n.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),l=l.div(l.norm()),o=n.mmul(l).div(l.transpose().mmul(l).get(0,0))):o=a;if(n){let e=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0));e=e.div(e.norm());let r=t.clone().sub(a.clone().mmul(e.transpose())),i=o.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),s=n.clone().sub(a.clone().mulS(i.get(0,0)).mmul(l.transpose()));this.t=a,this.p=e.transpose(),this.w=c.transpose(),this.q=l,this.u=o,this.s=a.transpose().mmul(a),this.xResidual=r,this.yResidual=s,this.betas=i}else this.w=c.transpose(),this.s=a.transpose().mmul(a).sqrt(),this.t=r?a.clone().div(this.s.get(0,0)):a,this.xResidual=t.sub(a.mmul(c.transpose()))}}function bft(t,e){const n=new oft(t.rows,e.rows);for(let r=0;r<t.rows;r++)for(let i=0;i<e.rows;i++)n.set(r,i,$pt(t.getRow(r),e.getRow(i)));return n}function vft(t){let e=[];for(let n=0;n<t;n++)e.push(n);return e}function xft(t){let e=[t[0]];for(let n=1;n<t.length;n++)e[n]=e[n-1]+t[n];return e}const wft=Symbol("distance");class _ft{constructor(t,e,n,r,i){this.clusters=t,this.centroids=e,this.converged=n,this.iterations=r,this[wft]=i}nearest(t){const e=new Array(t.length);return Ppt(t,this.centroids.map((function(t){return t.centroid})),e,this[wft])}computeInformation(t){for(var e=this.centroids.map((function(t){return{centroid:t,error:0,size:0}})),n=0;n<t.length;n++)e[this.clusters[n]].error+=this[wft](t[n],this.centroids[this.clusters[n]]),e[this.clusters[n]].size++;for(var r=0;r<this.centroids.length;r++)e[r].size?e[r].error/=e[r].size:e[r].error=null;return new _ft(this.clusters,e,this.converged,this.iterations,this[wft])}}const Sft={maxIterations:100,tolerance:1e-6,withIterations:!1,initialization:"kmeans++",distanceFunction:$pt};function kft(t,e,n,r,i,s){var o=function(t,e,n,r){const i=e[0].length;for(var s=new Array(r),o=new Array(r),a=0;a<r;a++){s[a]=new Array(i),o[a]=0;for(var l=0;l<i;l++)s[a][l]=0}for(var c=0;c<e.length;c++){o[n[c]]++;for(var u=0;u<i;u++)s[n[c]][u]+=e[c][u]}for(var h=0;h<r;h++)for(var d=0;d<i;d++)o[h]?s[h][d]/=o[h]:s[h][d]=t[h][d];return s}(t,e,n=Ppt(e,t,n,i.distanceFunction),r),a=function(t,e,n,r){for(var i=0;i<t.length;i++)if(n(t[i],e[i])>r)return!1;return!0}(o,t,i.distanceFunction,i.tolerance);return new _ft(n,o,a,s,i.distanceFunction)}function Tft(t,e,n){if(n=Object.assign({},Sft,n),e<=0||e>t.length||!Number.isInteger(e))throw new Error("K should be a positive integer smaller than the number of points");var r;if(Array.isArray(n.initialization)){if(n.initialization.length!==e)throw new Error("The initial centers should have the same length as K");r=n.initialization}else switch(n.initialization){case"kmeans++":r=function(t,e,n={}){const r=(t=new oft(t)).rows,i=new Bpt(n.seed),s=[],o=n.localTrials||2+Math.floor(Math.log(e)),a=i.randInt(r);s.push(t.getRow(a));let l=new oft(1,t.rows);for(let e=0;e<t.rows;e++)l.set(0,e,$pt(t.getRow(e),s[0]));let c=[xft(l.getRow(0))];const u=1/c[0][r-1];let h=oft.mul(l,u);for(let n=1;n<e;n++){const e=i.choice(r,{replace:!0,size:o,probabilities:h[0]}),a=bft(t.selection(e,vft(t.columns)),t);let u,d,p;for(let t=0;t<o;t++){const n=oft.min(l,[a.getRow(t)]),r=n.sum();(void 0===u||r<d)&&(u=e[t],d=r,p=n)}s[n]=t.getRow(u),l=p,c=[xft(l.getRow(0))],h=oft.mul(l,1/c[0][r-1])}return s}(t,e,n);break;case"random":r=function(t,e,n){return new Bpt(n).choice(t,{size:e})}(t,e,n.seed);break;case"mostDistant":r=function(t,e,n,r){const i=new Bpt(r);var s=new Array(e);if(s[0]=Math.floor(i.random()*t.length),e>1){for(var o={dist:-1,index:-1},a=0;a<t.length;++a)n[s[0]][a]>o.dist&&(o.dist=n[s[0]][a],o.index=a);if(s[1]=o.index,e>2)for(var l=2;l<e;++l){for(var c={dist:-1,index:-1},u=0;u<t.length;++u){for(var h={dist:Number.MAX_VALUE,index:-1},d=0;d<l;++d)n[d][u]<h.dist&&-1===s.indexOf(u)&&(h={dist:n[d][u],index:u});h.dist!==Number.MAX_VALUE&&h.dist>c.dist&&(c=Object.assign({},h))}s[l]=c.index}}return s.map((e=>t[e]))}(t,e,function(t,e){for(var n=new Array(t.length),r=0;r<t.length;++r)for(var i=r;i<t.length;++i){n[r]||(n[r]=new Array(t.length)),n[i]||(n[i]=new Array(t.length));const s=e(t[r],t[i]);n[r][i]=s,n[i][r]=s}return n}(t,n.distanceFunction),n.seed);break;default:throw new Error(`Unknown initialization method: "${n.initialization}"`)}0===n.maxIterations&&(n.maxIterations=Number.MAX_VALUE);var i=new Array(t.length);if(n.withIterations)return function*(t,e,n,r,i){for(var s,o=!1,a=0;!o&&a<i.maxIterations;)s=kft(t,e,n,r,i,++a),yield s.computeInformation(e),o=s.converged,t=s.centroids}(r,t,i,e,n);for(var s,o=!1,a=0;!o&&a<n.maxIterations;)o=(s=kft(r,t,i,e,n,++a)).converged,r=s.centroids;return s.computeInformation(t)}function Eft(t,e){return t.map(((t,n)=>Math.abs(t-e[n])**2)).reduce(((t,e)=>t+e))**.5}class Mft extends vQ{constructor({k:t=3}={}){super(),this.title="k-means clustering",this.serviceName="kmeans-models",this.parameters={k:new JH(t,!0)},this.$centers=new JH([],!1),this.$clusters=new JH([],!1),this.dataset=[],this.start()}async train(t){this.$training.set({status:"start",epochs:1});const e=bQ(t)?t.items():t;for await(const{x:t}of e)this.dataset.push(t);const n=Tft(this.dataset,this.parameters.k.get());this.$centers.set(n.centroids.map((t=>t.centroid))),this.$clusters.set(n.clusters),this.$training.set({status:"success"})}async predict(t){let e=0,n=1e3;const r={};let i=0;for(let s=0;s<this.$centers.get().length;s++){const o=Eft(this.$centers.get()[s],t);o<n&&(n=o,e=s),r[`${s}`]=Math.exp(o),i+=Math.exp(o)}if(Object.entries(r).forEach((([t])=>{r[t]/=i})),0===this.$centers.get().length){const t=new Error("KMeans is not trained");t.name="[KMeans] Prediction Error",sG(t)}return{cluster:e,confidences:r}}async batchPredict(t){const e=[],n=bQ(t)?t.items():t;for await(const{x:t}of n)e.push(t);const r=[];for(let t=0;t<e.length;t++)this.predict(e[t]).then((t=>r.push(t)));if(0===this.$centers.get().length){const t=new Error("KMeans is not trained");t.name="[KMeans] Prediction Error",sG(t)}return r}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);_J(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){return{name:kJ(this.title),files:[],format:"ml-kmeans",metadata:{clusters:this.$clusters.get(),centers:this.$centers.get(),...t}}}async read(t){const e=t.metadata.data;e&&(Object.entries(e).forEach((([t,e])=>{})),this.$clusters.set(t.metadata.labels),this.$training.set({status:"loaded"}))}}
/**
        * @license
        * Copyright 2022 Google LLC. All Rights Reserved.
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        * http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        * =============================================================================
        */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function Cft(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function Aft(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Nft(t,e){for(var n=[],r=0;r<t.length;r++)n.push({value:t[r],index:r});n.sort((function(t,e){return e.value-t.value}));var i=new Float32Array(e),s=new Int32Array(e);for(r=0;r<e;r++)i[r]=n[r].value,s[r]=n[r].index;return{values:i,indices:s}}FH([rG],Mft.prototype,"train",null),FH([rG],Mft.prototype,"predict",null),FH([rG],Mft.prototype,"batchPredict",null),
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.flatten=function(){return this.throwIfDisposed(),il(this,[this.size])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.norm=function(t,e,n){return this.throwIfDisposed(),pc(this,t,e,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),ko(this,t,e,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.as1D=function(){return this.throwIfDisposed(),il(this,[this.size])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.as2D=function(t,e){return this.throwIfDisposed(),il(this,[t,e])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.asType=function(t){return this.throwIfDisposed(),no(this,t)};var Ift=function(){function t(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return t.prototype.addExample=function(t,e){var n=this;if(null==this.exampleShape&&(this.exampleShape=t.shape),!m(this.exampleShape,t.shape))throw new Error("Example shape provided, "+t.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),e in this.labelToClassId||(this.labelToClassId[e]=this.nextClassId++),Co((function(){var r=n.normalizeVectorToUnitLength(il(t,[t.size])),i=r.shape[0];if(null==n.classDatasetMatrices[e])n.classDatasetMatrices[e]=il(r,[1,i]);else{var s=al([il(n.classDatasetMatrices[e],[n.classExampleCount[e],i]),il(r,[1,i])],0);n.classDatasetMatrices[e].dispose(),n.classDatasetMatrices[e]=s}No(n.classDatasetMatrices[e]),null==n.classExampleCount[e]&&(n.classExampleCount[e]=0),n.classExampleCount[e]++}))},t.prototype.similarities=function(t){var e=this;return Co((function(){var n,r,i=e.normalizeVectorToUnitLength(il(t,[t.size])),s=i.shape[0];if(null==e.trainDatasetMatrix){var o=null;for(var a in e.classDatasetMatrices)n=o,r=e.classDatasetMatrices[a],o=null==n&&null==r?null:null==n?r.clone():null===r?n.clone():al([n,r],0);e.trainDatasetMatrix=o}if(null==e.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;No(e.trainDatasetMatrix);var l=e.getNumExamples();return il(ko(il(e.trainDatasetMatrix,[l,s]),il(i,[s,1])),[l])}))},t.prototype.predictClass=function(t,e){return void 0===e&&(e=3),Cft(this,void 0,void 0,(function(){var n,r,i,s,o=this;return Aft(this,(function(a){switch(a.label){case 0:if(e<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return n=Co((function(){return no(o.similarities(t),"float32")})),r=Math.min(e,this.getNumExamples()),s=Nft,[4,n.data()];case 1:return i=s.apply(void 0,[a.sent(),r]).indices,n.dispose(),[2,this.calculateTopClass(i,r)]}}))}))},t.prototype.clearClass=function(t){if(null==this.classDatasetMatrices[t])throw new Error("Cannot clear invalid class "+t);this.classDatasetMatrices[t].dispose(),delete this.classDatasetMatrices[t],delete this.classExampleCount[t],this.clearTrainDatasetMatrix()},t.prototype.clearAllClasses=function(){for(var t in this.classDatasetMatrices)this.clearClass(t)},t.prototype.getClassExampleCount=function(){return this.classExampleCount},t.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},t.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},t.prototype.setClassifierDataset=function(t){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=t,t)this.classExampleCount[e]=t[e].shape[0]},t.prototype.calculateTopClass=function(t,e){var n,r={};if(null==t)return{classIndex:this.labelToClassId[n],label:n,confidences:r};var i={},s=0;for(var o in this.classDatasetMatrices)s+=this.classExampleCount[o],i[o]=s;var a={};for(var o in this.classDatasetMatrices)a[o]=0;for(var l=0;l<t.length;l++){var c=t[l];for(var o in this.classDatasetMatrices)if(c<i[o]){a[o]++;break}}var u=0;for(var o in this.classDatasetMatrices){var h=a[o]/e;h>u&&(u=h,n=o),r[o]=h}return{classIndex:this.labelToClassId[n],label:n,confidences:r}},t.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},t.prototype.normalizeVectorToUnitLength=function(t){return Co((function(){var e=pc(t);return Aa(t,e)}))},t.prototype.getNumExamples=function(){var t=0;for(var e in this.classDatasetMatrices)t+=this.classExampleCount[e];return t},t.prototype.dispose=function(){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[t].dispose()},t}();class $ft extends vQ{constructor({k:t=3}={}){super(),this.title="KNN classifier",this.serviceName="knn-classifier-models",this.classifier=new Ift,this.parameters={k:new JH(t,!0)}}async train(t){this.labels=bQ(t)?await t.distinct("y"):this.labels=Array.from(new Set(await t.map((({y:t})=>t)).toArray()));const e=bQ(t)?t.items():t;if(this.labels.length<1)throw this.$training.set({status:"error"}),new Error("Cannot train a kNN with no classes");this.$training.set({status:"start",epochs:1}),this.classifier.clearAllClasses();for await(const{x:t,y:n}of e)this.classifier.addExample(os(t),n);this.$training.set({status:"success"})}async predict(t){if(!this.classifier||!this.labels||this.labels.length<1)return{label:void 0,confidences:{}};const{label:e,confidences:n}=await this.classifier.predictClass(os(t),this.parameters.k.get());return{label:e,confidences:n}}clear(){delete this.classifier}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);_J(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){if(!this.classifier)return null;const e=this.classifier.getClassifierDataset(),n={};for(const t of Object.keys(e)){const r=e[t].arraySync();n[t]=r}return{name:kJ(this.title),files:[],format:"knn-classifier",metadata:{labels:this.labels,data:n,...t}}}async read(t){const e=t.metadata.data;if(!e)return;const n={};for(const[t,r]of Object.entries(e))n[t]=Mh(r);this.labels=t.metadata.labels,this.classifier.setClassifierDataset(n),this.$training.set({status:"loaded"})}}FH([rG],$ft.prototype,"train",null),FH([rG],$ft.prototype,"predict",null);class Rft extends M7{constructor({layers:t=[64,32],...e}={}){super(e),this.title="MLPClassifier",this.parameters={layers:new JH(t,!0),...this.parameters}}buildModel(t,e){this.model=O5();for(const[e,n]of this.parameters.layers.get().entries()){const r={units:n,activation:"relu"};0===e&&(r.inputDim=t[0]),this.model.add(B8(r))}this.model.add(B8({units:e[0],activation:"softmax"}));const n=yp.adam();this.model.compile({optimizer:n,loss:"categoricalCrossentropy",metrics:["accuracy"]})}}class Oft extends E7{constructor({units:t=[64,32],...e}={}){super(e),this.title="MLPRegressor",this.parameters={units:new JH(t,!0),...this.parameters}}async train(t,e){this.transformDataset=t=>t.map((t=>({xs:os(t.x),ys:os(t.y)}))),super.train(t,e)}buildModel(t,e){const n=this.parameters.units.get();this.model=O5(),this.model.add(
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function(t){return new R2(t)}({inputShape:t}));for(const t of n)this.model.add(B8({units:t,activation:"relu"}));this.model.add(B8({units:e.length>0?e[0]:1}));const r=yp.adam();this.model.compile({optimizer:r,loss:"meanSquaredError",metrics:[U8]})}async predict(t){return this.model?Co((()=>{const e=this._predict(t).arraySync();return 1===e.length?e[0]:e})):null}}
/**
        * @license
        * Copyright 2021 Google LLC. All Rights Reserved.
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        * http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        * =============================================================================
        */
function Pft(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function Lft(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var Dft={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Fft=224,zft={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},Bft={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function Uft(t){return void 0===t&&(t={version:1,alpha:1}),Pft(this,void 0,void 0,(function(){var e,n,r,i,s,o,a;return Lft(this,(function(l){switch(l.label){case 0:if(null==Ef)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(r=t.version.toFixed(2),i=t.alpha?t.alpha.toFixed(2):"",s=-1,o=1,null==t.modelUrl){if(!(r in Bft))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(Bft));if(!(i in Bft[r]))throw new Error("MobileNet constructed with invalid alpha "+t.alpha+". Valid multipliers for this version are: "+Object.keys(Bft[r])+".");e=Bft[r][i].inputRange,s=e[0],o=e[1]}return null!=t.inputRange&&(n=t.inputRange,s=n[0],o=n[1]),[4,(a=new Hft(r,i,t.modelUrl,s,o)).load()];case 1:return l.sent(),[2,a]}}))}))}var Vft,jft,Wft,Hft=function(){function t(t,e,n,r,i){void 0===r&&(r=-1),void 0===i&&(i=1),this.version=t,this.alpha=e,this.modelUrl=n,this.inputMin=r,this.inputMax=i,this.normalizationConstant=(i-r)/255}return t.prototype.load=function(){return Pft(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Lft(this,(function(s){switch(s.label){case 0:return this.modelUrl?(t=this,[4,P0(this.modelUrl)]):[3,2];case 1:return t.model=s.sent(),[3,4];case 2:return e=Bft[this.version][this.alpha].url,n=this,[4,P0(e,{fromTFHub:!0})];case 3:n.model=s.sent(),s.label=4;case 4:return[4,(r=Co((function(){return i.model.predict(tu([1,Fft,Fft,3]))}))).data()];case 5:return s.sent(),r.dispose(),[2]}}))}))},t.prototype.infer=function(t,e){var n=this;return void 0===e&&(e=!1),Co((function(){t instanceof Si||(t=Yo(t));var r=Ma(Na(no(t,"float32"),n.normalizationConstant),n.inputMin),i=r;t.shape[0]===Fft&&t.shape[1]===Fft||(i=rp.resizeBilinear(r,[Fft,Fft],!0));var s,o=il(i,[-1,Fft,Fft,3]);if(e){var a=zft[n.version],l=n.model.execute(o,a);s=wh(l,[1,2])}else{var c=n.model.predict(o);s=cl(c,[0,1],[-1,1e3])}return s}))},t.prototype.classify=function(t,e){return void 0===e&&(e=3),Pft(this,void 0,void 0,(function(){var n,r;return Lft(this,(function(i){switch(i.label){case 0:return[4,Gft(n=this.infer(t),e)];case 1:return r=i.sent(),n.dispose(),[2,r]}}))}))},t}();function Gft(t,e){return Pft(this,void 0,void 0,(function(){var n,r,i,s,o,a,l;return Lft(this,(function(c){switch(c.label){case 0:return[4,(n=fh(t)).data()];case 1:for(r=c.sent(),n.dispose(),i=[],l=0;l<r.length;l++)i.push({value:r[l],index:l});for(i.sort((function(t,e){return e.value-t.value})),s=new Float32Array(e),o=new Int32Array(e),l=0;l<e;l++)s[l]=i[l].value,o[l]=i[l].index;for(a=[],l=0;l<o.length;l++)a.push({className:Dft[o[l]],probability:s[l]});return[2,a]}}))}))}function qft(t){let e,n,r,i,s;return{c(){e=RN("Using Mobilenet v"),n=RN(t[2]),r=RN(" with alpha = "),i=RN(t[3]),s=RN(".")},m(t,o){CN(t,e,o),CN(t,n,o),CN(t,r,o),CN(t,i,o),CN(t,s,o)},p(t,e){4&e&&BN(n,t[2]),8&e&&BN(i,t[3])},d(t){t&&AN(e),t&&AN(n),t&&AN(r),t&&AN(i),t&&AN(s)}}}function Xft(t){let e;return{c(){e=RN(" ")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function Yft(t){let e;function n(t,e){return t[4]?Xft:qft}let r=n(t),i=r(t);return{c(){e=IN("p"),i.c(),FN(e,"class","p-2 text-sm text-gray-600")},m(t,n){CN(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&AN(e),i.d()}}}function Kft(t){let e,n;return e=new OU({props:{title:t[0],loading:t[4],$$slots:{default:[Yft]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16&n&&(r.loading=t[4]),60&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Zft(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(4,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{version:l}=e,{alpha:c}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"version"in t&&n(2,l=t.version),"alpha"in t&&n(3,c=t.alpha)},[o,a,l,c,r]}class Jft extends HI{constructor(t){super(),WI(this,t,Zft,Kft,lN,{title:0,loading:1,version:2,alpha:3})}}class Qft extends vQ{constructor({version:t=1,alpha:e=1}={}){if(super(),this.title="mobileNet",this.parameters={},this.serviceName="undefined",Vft.set(this,void 0),this.$loading=new JH(!0,!0),![1,2].includes(t))throw new Error("Mobilenet version must be 1 or 2");if(![.25,.5,.75,1].includes(e))throw new Error("Mobilenet alpha must be 0.25 | 0.50 | 0.75 | 1.0");this.version=t,this.alpha=e,this.setup()}async setup(){const t=await Ys(),e=Object.keys(t).filter((t=>t.includes("mobileNet")));try{BH(this,Vft,await Uft({modelUrl:`indexeddb://mobilenet-v${this.version}-${this.alpha}`,version:this.version,alpha:this.alpha}),"f")}catch(t){e.length>0&&await Ks(e[0]),BH(this,Vft,await Uft({version:this.version,alpha:this.alpha}),"f"),await zH(this,Vft,"f").model.save(`indexeddb://mobilenet-v${this.version}-${this.alpha}`)}return eG.info(`MobileNet v${this.version} loaded with alpha = ${this.alpha}`),this.$loading.set(!1),this.start(),this}async process(t){return zH(this,Vft,"f")?Co((()=>zH(this,Vft,"f").infer(t,!0).arraySync()[0])):[]}async predict(t){if(!zH(this,Vft,"f"))throw new Error("Mobilenet is not loaded");const e=await zH(this,Vft,"f").classify(t,5);return{label:e[0].className,confidences:e.reduce(((t,e)=>({...t,[e.className]:e.probability})),{})}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Jft({target:e,props:{title:this.title,loading:this.$loading,version:this.version,alpha:this.alpha}}))}train(){throw new iG("Model `MobileNet` cannot be trained")}save(){throw new Error("MobileNet does not support saving")}load(){throw new Error("MobileNet does not support loading")}download(){throw new Error("MobileNet does not support downloading")}upload(){throw new Error("MobileNet does not support uploading")}}function tmt(t){let e,n,r;function i(e){t[7](e)}let s={type:"text"};return void 0!==t[2]&&(s.value=t[2]),e=new ZI({props:s}),uI.push((()=>BI(e,"value",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function emt(t){let e,n,r;function i(e){t[6](e)}let s={};return void 0!==t[2]&&(s.value=t[2]),e=new _$({props:s}),uI.push((()=>BI(e,"value",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function nmt(t){let e,n,r;function i(e){t[5](e)}let s={};return void 0!==t[2]&&(s.value=t[2]),e=new g$({props:s}),uI.push((()=>BI(e,"value",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.value=t[2],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function rmt(t){let e,n,r;function i(e){t[4](e)}let s={};return void 0!==t[2]&&(s.checked=t[2]),e=new j$({props:s}),uI.push((()=>BI(e,"checked",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};!n&&4&r&&(n=!0,i.checked=t[2],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function imt(t){let e,n,r;function i(e){t[3](e)}let s={options:t[1].options};return void 0!==t[2]&&(s.value=t[2]),e=new F$({props:s}),uI.push((()=>BI(e,"value",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};2&r&&(i.options=t[1].options),!n&&4&r&&(n=!0,i.value=t[2],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function smt(t){let e,n,r,i,s,o,a,l;const c=[imt,rmt,nmt,emt,tmt],u=[];function h(t,e){return 2&e&&(n=null),3&e&&(r=null),3&e&&(i=null),3&e&&(s=null),null==n&&(n=!!("menu"===t[1].type&&Array.isArray(t[1].options)&&t[1].options.length>0)),n?0:(null==r&&(r=!("boolean"!==t[1].type&&("auto"!==t[1].type||"boolean"!=typeof t[0].get()))),r?1:(null==i&&(i=!("number"!==t[1].type&&("auto"!==t[1].type||"number"!=typeof t[0].get()))),i?2:(null==s&&(s=!!("number array"===t[1].type||"auto"===t[1].type&&Array.isArray(t[0].get())&&t[0].get().length&&"number"==typeof t[0].get()[0])),s?3:4)))}return o=h(t,-1),a=u[o]=c[o](t),{c(){e=IN("div"),a.c(),VN(e,"flex-grow","1")},m(t,n){CN(t,e,n),u[o].m(e,null),l=!0},p(t,[n]){let r=o;o=h(t,n),o===r?u[o].p(t,n):(CI(),II(u[r],1,1,(()=>{u[r]=null})),AI(),a=u[o],a?a.p(t,n):(a=u[o]=c[o](t),a.c()),NI(a,1),a.m(e,null))},i(t){l||(NI(a),l=!0)},o(t){II(a),l=!1},d(t){t&&AN(e),u[o].d()}}}function omt(t,e,n){let r,i=nN,s=()=>(i(),i=hN(o,(t=>n(2,r=t))),o);t.$$.on_destroy.push((()=>i()));let{stream:o}=e;s();let{spec:a}=e;return t.$$set=t=>{"stream"in t&&s(n(0,o=t.stream)),"spec"in t&&n(1,a=t.spec)},[o,a,r,function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)},function(t){r=t,o.set(r)}]}Vft=new WeakMap,FH([rG],Qft.prototype,"train",null),FH([rG],Qft.prototype,"save",null),FH([rG],Qft.prototype,"load",null),FH([rG],Qft.prototype,"download",null),FH([rG],Qft.prototype,"upload",null);class amt extends HI{constructor(t){super(),WI(this,t,omt,smt,lN,{stream:0,spec:1})}}function lmt(t,e,n){const r=t.slice();return r[4]=e[n][0],r[5]=e[n][1],r}function cmt(t){let e,n;return e=new amt({props:{stream:t[5],spec:{type:"auto"}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.stream=t[5]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function umt(t){let e,n;return e=new amt({props:{stream:t[5],spec:t[2][t[4]]}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.stream=t[5]),6&n&&(r.spec=t[2][t[4]]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function hmt(t){let e,n,r,i,s,o,a,l,c=t[4]+"";const u=[umt,cmt],h=[];function d(t,e){return t[4]in t[2]?0:1}return s=d(t),o=h[s]=u[s](t),{c(){e=IN("div"),n=IN("p"),r=RN(c),i=ON(),o.c(),a=ON(),FN(n,"class","w-32 my-2"),FN(e,"class","flex my-1 items-center")},m(t,o){CN(t,e,o),TN(e,n),TN(n,r),TN(e,i),h[s].m(e,null),TN(e,a),l=!0},p(t,n){(!l||2&n)&&c!==(c=t[4]+"")&&BN(r,c);let i=s;s=d(t),s===i?h[s].p(t,n):(CI(),II(h[i],1,1,(()=>{h[i]=null})),AI(),o=h[s],o?o.p(t,n):(o=h[s]=u[s](t),o.c()),NI(o,1),o.m(e,a))},i(t){l||(NI(o),l=!0)},o(t){II(o),l=!1},d(t){t&&AN(e),h[s].d()}}}function dmt(t){let e,n,r=Object.entries(t[1]),i=[];for(let e=0;e<r.length;e+=1)i[e]=hmt(lmt(t,r,e));const s=t=>II(i[t],1,1,(()=>{i[t]=null}));return{c(){e=IN("div");for(let t=0;t<i.length;t+=1)i[t].c();FN(e,"class","m-2")},m(t,r){CN(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,n){if(6&n){let o;for(r=Object.entries(t[1]),o=0;o<r.length;o+=1){const s=lmt(t,r,o);i[o]?(i[o].p(s,n),NI(i[o],1)):(i[o]=hmt(s),i[o].c(),NI(i[o],1),i[o].m(e,null))}for(CI(),o=r.length;o<i.length;o+=1)s(o);AI()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)NI(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)II(i[t]);n=!1},d(t){t&&AN(e),NN(i,t)}}}function pmt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[dmt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),262&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function fmt(t,e,n){let{title:r}=e,{parameters:i}=e,{config:s={}}=e,o=[];return t.$$set=t=>{"title"in t&&n(0,r=t.title),"parameters"in t&&n(1,i=t.parameters),"config"in t&&n(2,s=t.config)},t.$$.update=()=>{if(10&t.$$.dirty){for(const t of o)t();n(3,o=Object.values(i).map((t=>t.subscribe())))}},[r,i,s,o]}class mmt extends HI{constructor(t){super(),WI(this,t,fmt,pmt,lN,{title:0,parameters:1,config:2})}}class gmt extends mG{constructor(t,e={}){super(),this.title="modelParameters",jft.set(this,void 0),BH(this,jft,t,"f"),this.config=e}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new mmt({target:e,props:{title:this.title,parameters:zH(this,jft,"f").parameters,config:this.config}}))}}function ymt(t){let e,n,r,i,s;function o(e){t[5](e)}let a={disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new g$({props:a}),uI.push((()=>BI(r,"value",o))),{c(){e=IN("div"),n=IN("div"),UI(r.$$.fragment),FN(n,"class","md:flex md:items-center mb-2"),FN(e,"class","w-full max-w-sm")},m(t,i){CN(t,e,i),TN(e,n),VI(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],bI((()=>i=!1))),r.$set(n)},i(t){s||(NI(r.$$.fragment,t),s=!0)},o(t){II(r.$$.fragment,t),s=!1},d(t){t&&AN(e),jI(r)}}}function bmt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[ymt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function vmt(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(u,(t=>n(3,r=t))),u),a=nN,l=()=>(a(),a=hN(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}jft=new WeakMap;class xmt extends HI{constructor(t){super(),WI(this,t,vmt,bmt,lN,{title:0,value:1,disabled:2})}}class wmt extends mG{constructor(t){super(),this.title="number",this.$value=new JH(0,!0),this.$disabled=new JH(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new xmt({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function _mt(t){let e,n,r,i,s;function o(e){t[5](e)}let a={disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new _$({props:a}),uI.push((()=>BI(r,"value",o))),{c(){e=IN("div"),n=IN("div"),UI(r.$$.fragment),FN(n,"class","md:flex md:items-center mb-2"),FN(e,"class","w-full max-w-sm")},m(t,i){CN(t,e,i),TN(e,n),VI(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],bI((()=>i=!1))),r.$set(n)},i(t){s||(NI(r.$$.fragment,t),s=!0)},o(t){II(r.$$.fragment,t),s=!1},d(t){t&&AN(e),jI(r)}}}function Smt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[_mt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function kmt(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(u,(t=>n(3,r=t))),u),a=nN,l=()=>(a(),a=hN(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}class Tmt extends HI{constructor(t){super(),WI(this,t,kmt,Smt,lN,{title:0,value:1,disabled:2})}}class Emt extends mG{constructor(t){super(),this.title="number array",this.$value=new JH([],!0),this.$disabled=new JH(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Tmt({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function Mmt(t){let e;return{c(){e=IN("p"),e.textContent="No model loaded"},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function Cmt(t){let e,n,r,i;return{c(){e=IN("p"),n=RN("Model Loaded from "),r=RN(t[2]),i=RN(".")},m(t,s){CN(t,e,s),TN(e,n),TN(e,r),TN(e,i)},p(t,e){4&e&&BN(r,t[2])},d(t){t&&AN(e)}}}function Amt(t){let e;return{c(){e=IN("p"),e.textContent="Loading Model..."},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function Nmt(t){let e;function n(t,e){return"loading"===t[3]?Amt:"loaded"===t[3]?Cmt:Mmt}let r=n(t),i=r(t);return{c(){e=IN("div"),i.c(),FN(e,"class","p-2 text-sm text-gray-600")},m(t,n){CN(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&AN(e),i.d()}}}function Imt(t){let e,n;return e=new OU({props:{title:t[0],loading:"loading"===t[3],$$slots:{default:[Nmt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading="loading"===t[3]),268&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function $mt(t,e,n){let r,i,s,o=nN,a=()=>(o(),o=hN(d,(t=>n(7,s=t))),d);var l,c,u;t.$$.on_destroy.push((()=>o()));let{title:h}=e,{training:d}=e;return a(),t.$$set=t=>{"title"in t&&n(0,h=t.title),"training"in t&&a(n(1,d=t.training))},t.$$.update=()=>{128&t.$$.dirty&&n(3,r=s.status),240&t.$$.dirty&&n(2,i=(null===n(4,l=s.data)||void 0===l?void 0:l.source)?"datastore"===s.data.source?`datastore at ${null===n(5,c=s.data)||void 0===c?void 0:c.url}`:"url"===s.data.source?`url ${null===n(6,u=s.data)||void 0===u?void 0:u.url}`:"files":"unknown source")},[h,d,i,r,l,c,u,s]}class Rmt extends HI{constructor(t){super(),WI(this,t,$mt,Imt,lN,{title:0,training:1})}}function Omt(t,e){return t===e}function Pmt(t,e){return t===e}class Lmt extends vQ{constructor({inputType:t,taskType:e,inputShape:n}){super(),this.title="onnx model",this.parameters={},this.serviceName="onnx-models",this.$loading=new JH(!1,!0),this.$ready=new JH(!1,!0),this.modelName="",this.lockLoading=Promise.resolve(),Wft.set(this,void 0),this.inputType=t,this.taskType=e,this.inputShape=n,this.start()}train(){throw new iG("Model `OnnxModel` cannot be trained")}async predict(t){if(!zH(this,Wft,"f")||!this.$ready.get())throw new Error("Model is not loaded");const e=this.preprocess(t),n=await zH(this,Wft,"f").run({[zH(this,Wft,"f").inputNames[0]]:e});return await this.postprocess(n)}async loadFromUrl(t){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{await this.loadModel(t,t),this.$training.set({status:"loaded",data:{source:"url",url:t}}),this.$loading.set(!1),this.$ready.set(!0)}catch(t){throw this.$training.set({status:"error"}),this.$loading.set(!1),t}}async loadFromFile(t){if(t){this.$training.set({status:"loading"}),this.$ready.set(!1),this.$loading.set(!0);try{const e=await new Promise(((e,n)=>{const r=new FileReader;r.onload=function(){const t=this.result;e(t)},r.onerror=function(){n()},r.readAsArrayBuffer(t)}));await this.loadModel(e,t.name),this.$training.set({status:"loaded",data:{source:"file"}}),this.$loading.set(!1),this.$ready.set(!0)}catch(t){throw this.$training.set({status:"error"}),this.$loading.set(!1),t}}}async loadModel(t,e){this.ready=!1,this.lockLoading=this.lockLoading.then((()=>ort.InferenceSession.create(t))).then((t=>{BH(this,Wft,t,"f")})),await this.lockLoading,this.modelName=e;try{await this.warmup()}catch(t){console.log("ONNX Model warmup failed",t)}this.ready=!0}preprocess(t){if(Omt(this.inputType,"image"))return this.preprocessImage(t);if(Omt(this.inputType,"generic")){const e=t.flat().flat().flat().flat().flat();return new ort.Tensor("float32",Float32Array.from(e),this.inputShape)}throw new Error("Invalid input data type")}preprocessImage(t){throw new Error("ONNX for Images: Not yet implemented")}async postprocess(t){if(Pmt(this.taskType,"classification")){const e=this.labels?t=>this.labels[t]:t=>t.toString(),n=Array.from(t.probabilities.data).reduce(((t,n,r)=>({...t,[e(r)]:n})),{});return{label:e(t.label.data[0]),confidences:n}}if(Pmt(this.taskType,"generic")){const e={};for(const n of zH(this,Wft,"f").outputNames)e[n]=Array.from(t[n].data);return e}throw new Error("Invalid output data type")}async warmup(){const t=Float32Array.from(Array(this.inputShape.reduce(((t,e)=>t*e),1)),(()=>Math.random())),e=new ort.Tensor("float32",t,this.inputShape);await zH(this,Wft,"f").run({[zH(this,Wft,"f").inputNames[0]]:e})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Rmt({target:e,props:{title:this.title,training:this.$training}}))}save(){throw new Error("OnnxModel does not support saving")}load(){throw new Error("OnnxModel does not support loading")}download(){throw new Error("OnnxModel does not support downloading")}upload(){throw new Error("OnnxModel does not support uploading")}}Wft=new WeakMap,FH([rG],Lmt.prototype,"train",null),FH([rG],Lmt.prototype,"predict",null),FH([rG],Lmt.prototype,"loadFromUrl",null),FH([rG],Lmt.prototype,"loadFromFile",null),FH([rG],Lmt.prototype,"loadModel",null),FH([rG],Lmt.prototype,"preprocess",null),FH([rG],Lmt.prototype,"postprocess",null),FH([rG],Lmt.prototype,"save",null),FH([rG],Lmt.prototype,"load",null),FH([rG],Lmt.prototype,"download",null),FH([rG],Lmt.prototype,"upload",null);class Dmt{constructor(t,e={}){if(!0===t){const t=e;return this.center=t.center,this.scale=t.scale,this.means=t.means,this.stdevs=t.stdevs,this.U=oft.checkMatrix(t.U),this.S=t.S,this.R=t.R,void(this.excludedFeatures=t.excludedFeatures||[])}t=new oft(t);const{isCovarianceMatrix:n=!1,method:r="SVD",nCompNIPALS:i=2,center:s=!0,scale:o=!1,ignoreZeroVariance:a=!1}=e;if(this.center=s,this.scale=o,this.means=null,this.stdevs=null,this.excludedFeatures=[],n)this._computeFromCovarianceMatrix(t);else switch(this._adjust(t,a),r){case"covarianceMatrix":{const e=new lft(t).mmul(t).div(t.rows-1);this._computeFromCovarianceMatrix(e);break}case"NIPALS":this._computeWithNIPALS(t,i);break;case"SVD":{const e=new pft(t,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=e.rightSingularVectors;const n=e.diagonal,r=[];for(const e of n)r.push(e*e/(t.rows-1));this.S=r;break}default:throw new Error(`unknown method: ${r}`)}}static load(t){if("string"!=typeof t.name)throw new TypeError("model must have a name property");if("PCA"!==t.name)throw new RangeError(`invalid model: ${t.name}`);return new Dmt(!0,t)}predict(t,e={}){const{nComponents:n=this.U.columns}=e;if(t=new oft(t),this.center&&(t.subRowVector(this.means),this.scale)){for(let e of this.excludedFeatures)t.removeColumn(e);t.divRowVector(this.stdevs)}let r=t.mmul(this.U);return r.subMatrix(0,r.rows-1,0,n-1)}invert(t){let e=(t=oft.checkMatrix(t)).mmul(this.U.transpose());return this.center&&(this.scale&&e.mulRowVector(this.stdevs),e.addRowVector(this.means)),e}getExplainedVariance(){let t=0;for(const e of this.S)t+=e;return this.S.map((e=>e/t))}getCumulativeVariance(){let t=this.getExplainedVariance();for(let e=1;e<t.length;e++)t[e]+=t[e-1];return t}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map((t=>Math.sqrt(t)))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(t,e){if(this.center){const n=t.mean("column"),r=this.scale?t.standardDeviation("column",{mean:n}):null;if(this.means=n,t.subRowVector(n),this.scale){for(let n=0;n<r.length;n++)if(0===r[n]){if(!e)throw new RangeError(`Cannot scale the dataset (standard deviation is zero at index ${n}`);t.removeColumn(n),r.splice(n,1),this.excludedFeatures.push(n),n--}this.stdevs=r,t.divRowVector(r)}}}_computeFromCovarianceMatrix(t){const e=new mft(t,{assumeSymmetric:!0});this.U=e.eigenvectorMatrix,this.U.flipRows(),this.S=e.realEigenvalues,this.S.reverse()}_computeWithNIPALS(t,e){this.U=new oft(e,t.columns),this.S=[];let n=t;for(let t=0;t<e;t++){let e=new yft(n);this.U.setRow(t,e.w.transpose()),this.S.push(Math.pow(e.s.get(0,0),2)),n=e.xResidual}this.U=this.U.transpose()}}class Fmt extends vQ{constructor(){super(...arguments),this.title="PCA",this.serviceName="pca",this.parameters={}}async train(t){this.$training.set({status:"start",epochs:-1});const e=bQ(t)?t.items():t,n=(await e.toArray()).reduce(((t,{x:e})=>t.concat([e])),[]);this.model=new Dmt(n),this.$training.set({status:"success",data:{explainedVariance:this.model.getExplainedVariance()}})}async predict(t){return this.model?this.model.predict([t]).to2DArray()[0].slice(0,2):null}clear(){this.model=null}async save(t,e,n,r=null){const i=await this.write(n);return i.name=e,this.saveToDatastore(t,i,r)}async load(t,e){const n=await this.loadFromDatastore(t,e);return await this.read(n),n}async download(t){const e=await this.write(t);_J(JSON.stringify(e),`${e.name}.json`,"text/plain")}async upload(...t){const e=t.filter((t=>t.name.includes(".json"))),n=await new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=JSON.parse(r.result);t(e)},r.onerror=n,r.readAsText(e[0])}));return await this.read(n),n}async write(t={}){var e;return{name:kJ(this.title),files:[],format:"ml-pca",metadata:{IPCAModel:null===(e=this.model)||void 0===e?void 0:e.toJSON(),...t}}}async read(t){const e=t.metadata.IPCAModel;e&&(this.model=Dmt.load(e),this.$training.set({status:"loaded"}))}}var zmt={};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof vr&&vr];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(t,e){if(e)t:{var i=r;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(e=e(s=i[t=t[t.length-1]]))!=s&&null!=e&&n(i,t,{configurable:!0,writable:!0,value:e})}}function s(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function o(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=o(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}i("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+i++,n)}})),i("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<i.length;o++){var a=r[i[o]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return t}));var l,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var u;t:{var h={};try{h.__proto__={a:!0},u=h.a;break t}catch(t){}u=!1}l=u?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var d=l;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,d)d(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ea=e.prototype}function f(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function g(t,e){t.j={U:e,V:!0},t.g=t.m||t.s}function y(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new f,this.h=t}function v(t,e,n,r){try{var i=e.call(t.g.i,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.g.l=!1,i;var s=i.value}catch(e){return t.g.i=null,g(t.g,e),x(t)}return t.g.i=null,r.call(t.g,s),x(t)}function x(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,g(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.V)throw e.U;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function w(t){this.next=function(e){return m(t.g),t.g.i?e=v(t,t.g.i.next,e,t.g.o):(t.g.o(e),e=x(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=v(t,t.g.i.throw,e,t.g.o):(g(t.g,e),e=x(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?v(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),x(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function _(t,e){return e=new w(new b(e)),d&&t.prototype&&d(e,t.prototype),e}f.prototype.o=function(t){this.h=t},f.prototype.return=function(t){this.j={return:t},this.g=this.s};var S="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};i("Object.assign",(function(t){return t||S})),i("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function i(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var s=r.setTimeout;n.prototype.i=function(t){s(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.C),reject:t(this.l)}},e.prototype.C=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.F(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.m(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.G(e,t):this.m(t)},e.prototype.l=function(t){this.s(2,t)},e.prototype.m=function(t){this.s(1,t)},e.prototype.s=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.D(),this.A()},e.prototype.D=function(){var t=this;s((function(){if(t.B()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.B=function(){if(this.o)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.A=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.F=function(t){var e=this.j();t.J(e.resolve,e.reject)},e.prototype.G=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){s(t)}}:e}var i,s,o=new e((function(t,e){i=t,s=e}));return this.J(r(t,i),r(n,s)),o},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.J=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},e.resolve=i,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=o(t),s=r.next();!s.done;s=r.next())i(s.value).J(e,n)}))},e.all=function(t){var n=o(t),r=n.next();return r.done?i([]):new e((function(t,e){function s(e){return function(n){o[e]=n,0==--a&&t(o)}}var o=[],a=0;do{o.push(void 0),a++,i(r.value).J(s(o.length-1),e),r=n.next()}while(!r.done)}))},e})),i("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),i("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var i=n[e];if(i===t||Object.is(i,t))return!0}return!1}})),i("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),i("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(i,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t){return t}))}}));var k=this||self;function T(t,e){t=t.split(".");var n,r=k;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function E(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var M,C,A="undefined"!=typeof TextDecoder,N="undefined"!=typeof TextEncoder;function I(t){if(N)t=(C||(C=new TextEncoder)).encode(t);else{var e=void 0;e=void 0!==e&&e;for(var n=0,r=new Uint8Array(3*t.length),i=0;i<t.length;i++){var s=t.charCodeAt(i);if(128>s)r[n++]=s;else{if(2048>s)r[n++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&i<t.length){var o=t.charCodeAt(++i);if(56320<=o&&57343>=o){s=1024*(s-55296)+o-56320+65536,r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=63&s|128;continue}i--}if(e)throw Error("Found an unpaired surrogate");s=65533}r[n++]=s>>12|224,r[n++]=s>>6&63|128}r[n++]=63&s|128}}t=r.subarray(0,n)}return t}var $={},R=null;function O(t,e){void 0===e&&(e=0),L(),e=$[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",i=0,s=0;i<t.length-2;i+=3){var o=t[i],a=t[i+1],l=t[i+2],c=e[o>>2];o=e[(3&o)<<4|a>>4],a=e[(15&a)<<2|l>>6],l=e[63&l],n[s++]=c+o+a+l}switch(c=0,l=r,t.length-i){case 2:l=e[(15&(c=t[i+1]))<<2]||r;case 1:t=t[i],n[s]=e[t>>2]+e[(3&t)<<4|c>>4]+l+r}return n.join("")}function P(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=R[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}L();for(var r=0;;){var i=n(-1),s=n(0),o=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|s>>4),64!=o&&(e(s<<4&240|o>>2),64!=a&&e(o<<6&192|a))}}(t,(function(t){r[i++]=t})),r.subarray(0,i)}function L(){if(!R){R={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));$[n]=r;for(var i=0;i<r.length;i++){var s=r[i];void 0===R[s]&&(R[s]=i)}}}}var D,F="function"==typeof Uint8Array.prototype.slice;function z(t,e,n){return e===n?D||(D=new Uint8Array(0)):F?t.slice(e,n):new Uint8Array(t.subarray(e,n))}var B=0;function U(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.l=!1,this.v=e,t&&V(this,t)}function V(t,e){e=e.constructor===Uint8Array?e:e.constructor===ArrayBuffer||e.constructor===Array?new Uint8Array(e):e.constructor===String?P(e):e instanceof Uint8Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t.h=e,t.j=0,t.i=t.h.length,t.g=t.j}function j(t){var e=t.h,n=e[t.g],r=127&n;return 128>n?(t.g+=1,r):(r|=(127&(n=e[t.g+1]))<<7,128>n?(t.g+=2,r):(r|=(127&(n=e[t.g+2]))<<14,128>n?(t.g+=3,r):(r|=(127&(n=e[t.g+3]))<<21,128>n?(t.g+=4,r):(r|=(15&(n=e[t.g+4]))<<28,128>n?(t.g+=5,r>>>0):(t.g+=5,128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&t.g++,r)))))}function W(t){var e=t.h[t.g],n=t.h[t.g+1],r=t.h[t.g+2],i=t.h[t.g+3];return t.g+=4,t=2*((n=(e<<0|n<<8|r<<16|i<<24)>>>0)>>31)+1,e=n>>>23&255,n&=8388607,255==e?n?NaN:1/0*t:0==e?t*Math.pow(2,-149)*n:t*Math.pow(2,e-150)*(n+Math.pow(2,23))}U.prototype.reset=function(){this.g=this.j};var H=[];function G(){this.g=new Uint8Array(64),this.h=0}function q(t,e){for(;127<e;)t.push(127&e|128),e>>>=7;t.push(e)}function X(t){var e={},n=void 0!==e.N&&e.N;this.o={v:void 0!==e.v&&e.v},this.N=n,e=this.o,H.length?(n=H.pop(),e&&(n.v=e.v),t&&V(n,t),t=n):t=new U(t,e),this.g=t,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}function Y(t){var e=t.g;if((e=e.g==e.i)||(e=t.j)||(e=(e=t.g).l||0>e.g||e.g>e.i),e)return!1;t.m=t.g.g;var n=7&(e=j(t.g));return 0!=n&&5!=n&&1!=n&&2!=n&&3!=n&&4!=n?(t.j=!0,!1):(t.i=e,t.l=e>>>3,t.h=n,!0)}function K(t){switch(t.h){case 0:if(0!=t.h)K(t);else{for(t=t.g;128&t.h[t.g];)t.g++;t.g++}break;case 1:1!=t.h?K(t):(t=t.g).g+=8;break;case 2:if(2!=t.h)K(t);else{var e=j(t.g);(t=t.g).g+=e}break;case 5:5!=t.h?K(t):(t=t.g).g+=4;break;case 3:for(e=t.l;;){if(!Y(t)){t.j=!0;break}if(4==t.h){t.l!=e&&(t.j=!0);break}K(t)}break;default:t.j=!0}}function Z(t,e,n){var r=t.g.i,i=j(t.g),s=t.g.g+i;if(t.g.i=s,n(e,t),0!==(n=s-t.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+i+" bytes, instead read "+(i-n)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=s,t.g.i=r,e}function J(t){var e,n=j(t.g),r=(t=t.g).g;if(t.g+=n,t=t.h,A)(e=M)||(e=M=new TextDecoder("utf-8",{fatal:!1})),e=e.decode(t.subarray(r,r+n));else{n=r+n;for(var i,s,o,a=[],l=null;r<n;)128>(i=t[r++])?a.push(i):224>i?r>=n?a.push(65533):(s=t[r++],194>i||128!=(192&s)?(r--,a.push(65533)):a.push((31&i)<<6|63&s)):240>i?r>=n-1?a.push(65533):128!=(192&(s=t[r++]))||224===i&&160>s||237===i&&160<=s||128!=(192&(e=t[r++]))?(r--,a.push(65533)):a.push((15&i)<<12|(63&s)<<6|63&e):244>=i?r>=n-2?a.push(65533):128!=(192&(s=t[r++]))||0!=s-144+(i<<28)>>30||128!=(192&(e=t[r++]))||128!=(192&(o=t[r++]))?(r--,a.push(65533)):(i=(7&i)<<18|(63&s)<<12|(63&e)<<6|63&o,i-=65536,a.push(55296+(i>>10&1023),56320+(1023&i))):a.push(65533),8192<=a.length&&(l=E(l,a),a.length=0);e=E(l,a)}return e}function Q(){this.h=[],this.i=0,this.g=new G}function tt(t,e){0!==e.length&&(t.h.push(e),t.i+=e.length)}function et(t){var e=t.i+t.g.length();if(0===e)return new Uint8Array(0);e=new Uint8Array(e);for(var n=t.h,r=n.length,i=0,s=0;s<r;s++){var o=n[s];0!==o.length&&(e.set(o,i),i+=o.length)}return 0!==(r=(n=t.g).h)&&(e.set(n.g.subarray(0,r),i),n.h=0),t.h=[e],e}function nt(t,e,n){if(null!=n){q(t.g,8*e+5),t=t.g;var r=n;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?B=0:(0,B=2147483648):isNaN(r)?(0,B=2147483647):34028234663852886e22<r?(0,B=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,B=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,B=(n<<31|e+127<<23|8388607&r)>>>0),n=B,t.push(n>>>0&255),t.push(n>>>8&255),t.push(n>>>16&255),t.push(n>>>24&255)}}G.prototype.push=function(t){if(!(this.h+1<this.g.length)){var e=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(e)}this.g[this.h++]=t},G.prototype.length=function(){return this.h},G.prototype.end=function(){var t=this.g,e=this.h;return this.h=0,z(t,0,e)},X.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};var rt="function"==typeof Uint8Array;function it(t,e,n){if(null!=t)return"object"==typeof t?rt&&t instanceof Uint8Array?n(t):st(t,e,n):e(t)}function st(t,e,n){if(Array.isArray(t)){for(var r=Array(t.length),i=0;i<t.length;i++)r[i]=it(t[i],e,n);return Array.isArray(t)&&t.W&&ct(r),r}for(i in r={},t)r[i]=it(t[i],e,n);return r}function ot(t){return"number"==typeof t?isFinite(t)?t:String(t):t}var at,lt={W:{value:!0,configurable:!0}};function ct(t){return Array.isArray(t)&&!Object.isFrozen(t)&&Object.defineProperties(t,lt),t}function ut(t,e,n){var r=at;if(at=null,t||(t=r),r=this.constructor.ca,t||(t=r?[r]:[]),this.j=r?0:-1,this.i=null,this.g=t,t=(r=this.g.length)-1,!r||(null===(r=this.g[t])||"object"!=typeof r||Array.isArray(r)||rt&&r instanceof Uint8Array)?void 0!==e&&-1<e?(this.l=Math.max(e,t+1-this.j),this.h=null):this.l=Number.MAX_VALUE:(this.l=t-this.j,this.h=r),n)for(e=0;e<n.length;e++)(t=n[e])<this.l?(t+=this.j,(r=this.g[t])?ct(r):this.g[t]=ht):(dt(this),(r=this.h[t])?ct(r):this.h[t]=ht)}var ht=Object.freeze(ct([]));function dt(t){var e=t.l+t.j;t.g[e]||(t.h=t.g[e]={})}function pt(t,e,n){return-1===e?null:void 0!==n&&n||e>=t.l?t.h?t.h[e]:void 0:t.g[e+t.j]}function ft(t){var e=void 0!==e&&e,n=pt(t,1,e);return null==n&&(n=ht),n===ht&&gt(t,1,n=ct([]),e),n}function mt(t,e,n){return null==(t=null==(t=pt(t,e))?t:+t)?void 0===n?0:n:t}function gt(t,e,n,r){void 0!==r&&r||e>=t.l?(dt(t),t.h[e]=n):t.g[e+t.j]=n}function yt(t,e){t.i||(t.i={});var n=t.i[1];if(!n){var r=ft(t);n=[];for(var i=0;i<r.length;i++)n[i]=new e(r[i]);t.i[1]=n}return n}function bt(t,e,n,r){var i=yt(t,n);e=e||new n,t=ft(t),null!=r?(i.splice(r,0,e),t.splice(r,0,vt(e))):(i.push(e),t.push(vt(e)))}function vt(t,e){if(t.i)for(var n in t.i){var r=t.i[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)r[i]&&vt(r[i]);else r&&vt(r)}return t.g}function xt(t,e){return null==(t=pt(t,e))?0:t}function wt(t,e){return null==(t=pt(t,e))?"":t}function _t(t,e){if(t=t.m){tt(e,e.g.end());for(var n=0;n<t.length;n++)tt(e,t[n])}}function St(t,e){if(4==e.h)return!1;var n=e.m;return K(e),e.N||(e=z(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e]),!0}function kt(t,e){var n=void 0;return new(n||(n=Promise))((function(r,i){function s(t){try{a(e.next(t))}catch(t){i(t)}}function o(t){try{a(e.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(s,o)}a((e=e.apply(t,void 0)).next())}))}function Tt(t){ut.call(this,t)}function Et(t,e){for(;Y(e);)switch(e.i){case 8:var n=j(e.g);gt(t,1,n);break;case 21:gt(t,2,n=W(e.g));break;case 26:gt(t,3,n=J(e));break;case 34:gt(t,4,n=J(e));break;default:if(!St(t,e))return t}return t}function Mt(t){ut.call(this,t,-1,Ct)}ut.prototype.toJSON=function(){return st(vt(this),ot,O)},ut.prototype.toString=function(){return vt(this).toString()},p(Tt,ut),p(Mt,ut),Mt.prototype.addClassification=function(t,e){return bt(this,t,Tt,e),this};var Ct=[1];function At(t){ut.call(this,t)}function Nt(t,e){for(;Y(e);)switch(e.i){case 13:var n=W(e.g);gt(t,1,n);break;case 21:gt(t,2,n=W(e.g));break;case 29:gt(t,3,n=W(e.g));break;case 37:gt(t,4,n=W(e.g));break;case 45:gt(t,5,n=W(e.g));break;default:if(!St(t,e))return t}return t}function It(t){ut.call(this,t,-1,$t)}p(At,ut),p(It,ut);var $t=[1];function Rt(t){ut.call(this,t)}function Ot(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Pt(t){return yt(t,Tt).map((function(t){return{index:xt(t,1),Y:mt(t,2),label:null!=pt(t,3)?wt(t,3):void 0,displayName:null!=pt(t,4)?wt(t,4):void 0}}))}function Lt(t){return{x:mt(t,1),y:mt(t,2),z:mt(t,3),visibility:null!=pt(t,4)?mt(t,4):void 0}}function Dt(t){t:{var e=new It;for(t=new X(t);Y(t);)if(10===t.i){bt(e,Z(t,new At,Nt),At,void 0)}else if(!St(e,t))break t}return yt(e,At).map(Lt)}function Ft(t,e){this.h=t,this.g=e,this.l=0}function zt(t,e,n){return function(t,e){var n=t.g;if(void 0===t.m){var r=Ot(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),i=Ot(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),s=n.createProgram();if(n.attachShader(s,r),n.attachShader(s,i),n.linkProgram(s),!n.getProgramParameter(s,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(s));r=t.m=s,n.useProgram(r),i=n.getUniformLocation(r,"sampler0"),t.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:i},t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.I),n.vertexAttribPointer(t.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.enableVertexAttribArray(t.j.H),n.vertexAttribPointer(t.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(i,0)}r=t.j,n.useProgram(t.m),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Bt(t){this.g=t}p(Rt,ut);var Ut=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Vt(t,e){return e+t}function jt(t,e){window[t]=e}function Wt(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||Vt,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=e,t.options)for(var n=(e=o(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Ht(t){return kt(t,(function t(){var e,n,r,i,s,o,l,c,u,h,d,p=this;return _(t,(function(t){switch(t.g){case 1:return e=p,p.R?(n=function(t,e){return void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(e):t.g.files}(p,p.j),y(t,function(){return kt(this,(function t(){return _(t,(function(t){switch(t.g){case 1:return t.m=2,y(t,WebAssembly.instantiate(Ut),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}}))}))}(),2)):t.return();case 2:if(r=t.h,"object"==typeof window)return jt("createMediapipeSolutionsWasm",{locateFile:p.locateFile}),jt("createMediapipeSolutionsPackedAssets",{locateFile:p.locateFile}),o=n.filter((function(t){return void 0!==t.data})),l=n.filter((function(t){return void 0===t.data})),c=Promise.all(o.map((function(t){var n=Gt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),u=Promise.all(l.map((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){return kt(e,(function t(){var e,n,r=this;return _(t,(function(t){if(1==t.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,y(t,e(n),2);r.h=t.h,t.g=0}))}))})),h=kt(e,(function t(){var e=this;return _(t,(function(t){return e.g.graph&&e.g.graph.url?t=y(t,Gt(e,e.g.graph.url),0):(t.g=0,t=void 0),t}))})),y(t,Promise.all([u,c,h]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return i=n.filter((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,a(i)),y(t,createMediapipeSolutionsWasm(Module),6);case 6:p.h=t.h,p.l=new OffscreenCanvas(1,1),p.h.canvas=p.l,s=p.h.GL.createContext(p.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),p.h.GL.makeContextCurrent(s),t.g=4;break;case 7:if(p.l=document.createElement("canvas"),!(d=p.l.getContext("webgl2",{}))&&!(d=p.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),t.return();p.D=d,p.h.canvas=p.l,p.h.createContext(p.l,!0,!0,{});case 4:p.i=new p.h.SolutionWasm,p.R=!1,t.g=0}}))}))}function Gt(t,e){return kt(t,(function t(){var n,r,i=this;return _(t,(function(t){return e in i.F?t.return(i.F[e]):(n=i.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),i.F[e]=r,t.return(r))}))}))}function qt(t,e,n){return kt(t,(function t(){var r,i,s,a,l,c,u,h,d,p,f,m,g,b,v=this;return _(t,(function(t){switch(t.g){case 1:if(!n)return t.return(e);for(r={},i=0,s=o(Object.keys(n)),a=s.next();!a.done;a=s.next())l=a.value,"string"!=typeof(c=n[l])&&"texture"===c.type&&void 0!==e[c.stream]&&++i;1<i&&(v.G=!1),u=o(Object.keys(n)),a=u.next();case 2:if(a.done){t.g=4;break}if(h=a.value,"string"==typeof(d=n[h]))return g=r,b=h,y(t,function(t,e,n){return kt(t,(function t(){var r,i=this;return _(t,(function(t){return"number"==typeof n||n instanceof Uint8Array||n instanceof i.h.Uint8BlobList?t.return(n):n instanceof i.h.Texture2dDataOut?((r=i.s[e])||(r=new Ft(i.h,i.D),i.s[e]=r),t.return(zt(r,n,i.G))):t.return(void 0)}))}))}(v,h,e[d]),14);if(p=e[d.stream],"detection_list"===d.type){if(p){for(var x=p.getRectList(),w=p.getLandmarksList(),S=p.getClassificationsList(),k=[],T=0;T<x.size();++T){var E=x.get(T);t:{var M=new Rt;for(E=new X(E);Y(E);)switch(E.i){case 13:var C=W(E.g);gt(M,1,C);break;case 21:gt(M,2,C=W(E.g));break;case 29:gt(M,3,C=W(E.g));break;case 37:gt(M,4,C=W(E.g));break;case 45:gt(M,5,C=W(E.g));break;case 48:for(var A=E.g,N=128,I=0,$=C=0;4>$&&128<=N;$++)I|=(127&(N=A.h[A.g++]))<<7*$;if(128<=N&&(I|=(127&(N=A.h[A.g++]))<<28,C|=(127&N)>>4),128<=N)for($=0;5>$&&128<=N;$++)C|=(127&(N=A.h[A.g++]))<<7*$+3;128>N?(A=I>>>0,(C=2147483648&(N=C>>>0))&&(N=~N>>>0,0==(A=1+~A>>>0)&&(N=N+1>>>0)),A=4294967296*N+(A>>>0),C=C?-A:A):(A.l=!0,C=void 0),gt(M,6,C);break;default:if(!St(M,E))break t}}M={Z:mt(M,1),$:mt(M,2),height:mt(M,3),width:mt(M,4),rotation:mt(M,5,0),X:xt(M,6)},E=Dt(w.get(T)),A=S.get(T);t:for(C=new Mt,A=new X(A);Y(A);)if(10===A.i)C.addClassification(Z(A,new Tt,Et));else if(!St(C,A))break t;M={T:M,O:E,M:Pt(C)},k.push(M)}x=k}else x=[];r[h]=x,t.g=7;break}if("proto_list"===d.type){if(p){for(x=Array(p.size()),w=0;w<p.size();w++)x[w]=p.get(w);p.delete()}else x=[];r[h]=x,t.g=7;break}if(void 0===p){t.g=3;break}if("float_list"===d.type){r[h]=p,t.g=7;break}if("proto"===d.type){r[h]=p,t.g=7;break}if("texture"!==d.type)throw Error("Unknown output config type: '"+d.type+"'");return(f=v.s[h])||(f=new Ft(v.h,v.D),v.s[h]=f),y(t,zt(f,p,v.G),13);case 13:m=t.h,r[h]=m;case 7:d.transform&&r[h]&&(r[h]=d.transform(r[h])),t.g=3;break;case 14:g[b]=t.h;case 3:a=u.next(),t.g=2;break;case 4:return t.return(r)}}))}))}function Xt(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),i=new t.h.StringList,s=o(e.wants),l=s.next();!l.done;l=s.next())i.push_back(l.value);s=t.h.PacketListener.implement({onResults:function(i){for(var s={},o=0;o<e.wants.length;++o)s[r[o]]=i.get(o);var a=t.listeners[n];a&&(t.C=qt(t,s,e.outs).then((function(n){n=a(n);for(var i=0;i<e.wants.length;++i){var o=s[r[i]];"object"==typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}n&&(t.C=n)})))}}),t.i.attachMultiListener(i,s),i.delete()}function Yt(t){switch(void 0===t&&(t=0),t){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Kt(t){var e=this;t=t||{},this.g=new Wt({locateFile:t.locateFile,files:function(t){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:Yt(t.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Dt},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Dt},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){return kt(e,(function e(){var n,r,i,s=this;return _(e,(function(e){return 1==e.g?(n=Yt(t),r="third_party/mediapipe/modules/pose_landmark/"+n,y(e,Gt(s.g,n),2)):(i=e.h,s.g.overrideFile(r,i),e.return(!0))}))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=Wt.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){return kt(this,(function t(){var e=this;return _(t,(function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],i=[],s={},a=o(Object.keys(t)),l=a.next();!l.done;s={K:s.K,L:s.L},l=a.next()){var c=l.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(l=e[c])&&(l.onChange&&(s.K=l.onChange,s.L=t[c],r.push(function(t){return function(){return kt(n,(function e(){var n=this;return _(e,(function(e){if(1==e.g)return y(e,t.K(t.L),2);!0===e.h&&(n.o=!0),e.g=0}))}))}}(s))),l.graphOptionXref&&(c={valueNumber:1===l.type?t[c]:0,valueBoolean:0===l.type&&t[c],valueString:2===l.type?t[c]:""},l=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),l.graphOptionXref),c),i.push(l))))}0===r.length&&0===i.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(i),this.u=(void 0===this.u?[]:this.u).concat(r))}},t.initialize=function(){return kt(this,(function t(){var e=this;return _(t,(function(t){return 1==t.g?y(t,Ht(e),2):3!=t.g?y(t,kt(e,(function t(){var e,n,r,i,s,a,l,c,u=this;return _(t,(function(t){if(1==t.g)return u.g.graph&&u.g.graph.url&&u.P===u.g.graph.url?t.return():(u.o=!0,u.g.graph&&u.g.graph.url?(u.P=u.g.graph.url,y(t,Gt(u,u.g.graph.url),3)):void(t.g=2));for(2!=t.g&&(e=t.h,u.i.loadGraph(e)),n=o(Object.keys(u.B)),r=n.next();!r.done;r=n.next())i=r.value,u.i.overrideFile(i,u.B[i]);if(u.B={},u.g.listeners)for(s=o(u.g.listeners),a=s.next();!a.done;a=s.next())l=a.value,Xt(u,l);c=u.j,u.j={},u.setOptions(c),t.g=0}))})),3):y(t,function(t){return kt(t,(function t(){var e,n,r,i,s,a,l=this;return _(t,(function(t){switch(t.g){case 1:if(!l.o)return t.return();if(!l.u){t.g=2;break}e=o(l.u),n=e.next();case 3:if(n.done){t.g=5;break}return y(t,(0,n.value)(),4);case 4:n=e.next(),t.g=3;break;case 5:l.u=void 0;case 2:if(l.A){for(r=new l.h.GraphOptionChangeRequestList,i=o(l.A),s=i.next();!s.done;s=i.next())a=s.value,r.push_back(a);l.i.changeOptions(r),r.delete(),l.A=void 0}l.o=!1,t.g=0}}))}))}(e),0)}))}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.B[t]=e},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){return kt(this,(function n(){var r,i,s,a,l,c,u,h,d,p=this;return _(n,(function(n){switch(n.g){case 1:return p.g.inputs?(r=1e3*(null==e?performance.now():e),y(n,p.C,2)):n.return();case 2:return y(n,p.initialize(),3);case 3:for(i=new p.h.PacketDataList,s=o(Object.keys(t)),a=s.next();!a.done;a=s.next())if(l=a.value,c=p.g.inputs[l]){t:{var f=p,m=t[l];switch(c.type){case"video":var g=f.m[c.stream];if(g||(g=new Ft(f.h,f.D),f.m[c.stream]=g),0===(f=g).l&&(f.l=f.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&m instanceof HTMLVideoElement){var b=m.videoWidth;g=m.videoHeight}else"undefined"!=typeof HTMLImageElement&&m instanceof HTMLImageElement?(b=m.naturalWidth,g=m.naturalHeight):(b=m.width,g=m.height);g={glName:f.l,width:b,height:g},(b=f.g).canvas.width=g.width,b.canvas.height=g.height,b.activeTexture(b.TEXTURE0),f.h.bindTexture2d(f.l),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),f.h.bindTexture2d(0),f=g;break t;case"detections":for((g=f.m[c.stream])||(g=new Bt(f.h),f.m[c.stream]=g),(f=g).data||(f.data=new f.g.DetectionListData),f.data.reset(m.length),g=0;g<m.length;++g){b=m[g];var v=f.data,x=v.setBoundingBox,w=g,_=b.T,S=new Rt;gt(S,1,_.Z),gt(S,2,_.$),gt(S,3,_.height),gt(S,4,_.width),gt(S,5,_.rotation),gt(S,6,_.X);var k=_=new Q;nt(k,1,pt(S,1)),nt(k,2,pt(S,2)),nt(k,3,pt(S,3)),nt(k,4,pt(S,4)),nt(k,5,pt(S,5));var T=pt(S,6);if(null!=T&&null!=T){q(k.g,48);var E=k.g,M=T;T=0>M;var C=(M=Math.abs(M))>>>0;for(M=Math.floor((M-C)/4294967296),M>>>=0,T&&(M=~M>>>0,4294967295<(C=1+(~C>>>0))&&(C=0,4294967295<++M&&(M=0))),T=B=C,C=M;0<C||127<T;)E.push(127&T|128),T=(T>>>7|C<<25)>>>0,C>>>=7;E.push(T)}if(_t(S,k),_=et(_),x.call(v,w,_),b.O)for(v=0;v<b.O.length;++v)k=!!(S=b.O[v]).visibility,w=(x=f.data).addNormalizedLandmark,_=g,S=Object.assign(Object.assign({},S),{visibility:k?S.visibility:0}),gt(k=new At,1,S.x),gt(k,2,S.y),gt(k,3,S.z),S.visibility&&gt(k,4,S.visibility),nt(E=S=new Q,1,pt(k,1)),nt(E,2,pt(k,2)),nt(E,3,pt(k,3)),nt(E,4,pt(k,4)),nt(E,5,pt(k,5)),_t(k,E),S=et(S),w.call(x,_,S);if(b.M)for(v=0;v<b.M.length;++v){if(w=(x=f.data).addClassification,_=g,S=b.M[v],gt(k=new Tt,2,S.Y),S.index&&gt(k,1,S.index),S.label&&gt(k,3,S.label),S.displayName&&gt(k,4,S.displayName),E=S=new Q,null!=(C=pt(k,1))&&null!=C)if(q(E.g,8),T=E.g,0<=C)q(T,C);else{for(M=0;9>M;M++)T.push(127&C|128),C>>=7;T.push(1)}nt(E,2,pt(k,2)),null!=(T=pt(k,3))&&(T=I(T),q(E.g,26),q(E.g,T.length),tt(E,E.g.end()),tt(E,T)),null!=(T=pt(k,4))&&(T=I(T),q(E.g,34),q(E.g,T.length),tt(E,E.g.end()),tt(E,T)),_t(k,E),S=et(S),w.call(x,_,S)}}f=f.data;break t;default:f={}}}switch(u=f,h=c.stream,c.type){case"video":i.pushTexture2d(Object.assign(Object.assign({},u),{stream:h,timestamp:r}));break;case"detections":(d=u).stream=h,d.timestamp=r,i.pushDetectionList(d);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return p.i.send(i),y(n,p.C,4);case 4:i.delete(),n.g=0}}))}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},T("Solution",Wt),T("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Kt.prototype).reset=function(){this.g.reset()},t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){return kt(this,(function t(){var e=this;return _(t,(function(t){return y(t,e.g.initialize(),0)}))}))},t.send=function(t,e){return kt(this,(function n(){var r=this;return _(n,(function(n){return y(n,r.g.send(t,e),0)}))}))},t.setOptions=function(t){this.g.setOptions(t)},T("Pose",Kt),T("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),T("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),T("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),T("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),T("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),T("VERSION","0.4.1633558788")}).call(vr);
/**
        * @license
        * Copyright 2022 Google LLC. All Rights Reserved.
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        * http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        * =============================================================================
        */
var Bmt=function(t,e){return(Bmt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Umt(t,e){function n(){this.constructor=t}Bmt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Vmt=function(){return(Vmt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function jmt(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}function Wmt(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function Hmt(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var Gmt=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],qmt=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],Xmt={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},Ymt={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},Kmt=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],Zmt=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function Jmt(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function Qmt(t){return jmt(this,void 0,void 0,(function(){var e,n;return Wmt(this,(function(r){switch(r.label){case 0:return e=document.createElement("canvas"),t instanceof Si?[4,Xo(t,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:e.width=Jmt(t.width),e.height=Jmt(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),r.label=3;case 3:return[2,e]}}))}))}function tgt(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s,o;return Wmt(this,(function(a){switch(a.label){case 0:return t instanceof Si?(e=t.shape.slice(0,2),n=e[0],r=e[1],i=ImageData.bind,[4,Xo(t)]):[3,2];case 1:return[2,new(i.apply(ImageData,[void 0,a.sent(),r,n]))];case 2:return s=document.createElement("canvas"),o=s.getContext("2d"),s.width=Jmt(t.width),s.height=Jmt(t.height),o.drawImage(t,0,0),[2,o.getImageData(0,0,s.width,s.height)]}}))}))}function egt(t){return jmt(this,void 0,void 0,(function(){var e;return Wmt(this,(function(n){switch(n.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,Qmt(t)]:[3,2];case 1:return e=n.sent(),[3,3];case 2:e=t,n.label=3;case 3:return[2,Yo(e,4)]}}))}))}function ngt(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got "+t);if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got "+t)}var rgt={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},igt=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,this.mask]}))}))},t.prototype.toImageData=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,tgt(this.mask)]}))}))},t.prototype.toTensor=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,egt(this.mask)]}))}))},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function sgt(t){return ngt(t),"person"}var ogt=function(){function t(t){var e,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new zmt.Pose({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing,enableSegmentation:t.enableSegmentation,smoothSegmentation:t.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(t){if(n.height=t.image.height,n.width=t.image.width,null==t.poseLandmarks)n.poses=[];else{var e=n.translateOutput(t.poseLandmarks,t.poseWorldLandmarks);t.segmentationMask&&(e.segmentation={maskValueToLabel:sgt,mask:new igt(t.segmentationMask)}),n.poses=[e]}}))}return t.prototype.translateOutput=function(t,e){var n=this,r={keypoints:t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,z:t.z,score:t.visibility,name:qmt[e]}}))};return null!=e&&(r.keypoints3D=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:qmt[e]}}))),r},t.prototype.estimatePoses=function(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i;return Wmt(this,(function(s){switch(s.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),t instanceof Si?(i=ImageData.bind,[4,Xo(t)]):[3,2];case 1:return r=new(i.apply(ImageData,[void 0,s.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:r=t,s.label=3;case 3:return t=r,[4,this.poseSolution.send({image:t},n)];case 4:return s.sent(),[2,this.poses]}}))}))},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function agt(t){return jmt(this,void 0,void 0,(function(){var e,n;return Wmt(this,(function(r){switch(r.label){case 0:return e=function(t){if(null==t)return Vmt({},rgt);var e=Vmt({},t);return e.runtime="mediapipe",null==e.enableSegmentation&&(e.enableSegmentation=rgt.enableSegmentation),null==e.enableSmoothing&&(e.enableSmoothing=rgt.enableSmoothing),null==e.smoothSegmentation&&(e.smoothSegmentation=rgt.smoothSegmentation),null==e.modelType&&(e.modelType=rgt.modelType),e}(t),[4,(n=new ogt(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function lgt(t){return t instanceof Si?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function cgt(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function ugt(t){return t instanceof Si?t:Yo(t)}function hgt(t,e,n){return dgt(n,"inputResolution"),[1/n.width*t[0][0]*e.width,1/n.height*t[0][1]*e.width,t[0][3]*e.width,1/n.width*t[1][0]*e.height,1/n.height*t[1][1]*e.height,t[1][3]*e.height,0,0]}function dgt(t,e){u(0!==t.width,(function(){return e+" width cannot be 0."})),u(0!==t.height,(function(){return e+" height cannot be 0."}))}function pgt(t,e,n){var r=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex,s=t.locationData,o=s.relativeKeypoints[r].x*e.width,a=s.relativeKeypoints[r].y*e.height,l=s.relativeKeypoints[i].x*e.width,c=s.relativeKeypoints[i].y*e.height,u=2*Math.sqrt((l-o)*(l-o)+(c-a)*(c-a)),h=function(t,e,n){var r,i=t.locationData,s=n.rotationVectorStartKeypointIndex,o=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=i.relativeKeypoints[s].x*e.width,l=i.relativeKeypoints[s].y*e.height,c=i.relativeKeypoints[o].x*e.width,u=i.relativeKeypoints[o].y*e.height;return cgt(r-Math.atan2(-(u-l),c-a))}(t,e,n);return{xCenter:o/e.width,yCenter:a/e.height,width:u/e.width,height:u/e.height,rotation:h}}function fgt(t){if(16!==t.length)throw new Error("Array length must be 16 but got "+t.length);return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function mgt(t,e,n,r,i,s,o){return t[e][i]*(t[n][s]*t[r][o]-t[n][o]*t[r][s])}function ggt(t,e,n){var r=(e+1)%4,i=(e+2)%4,s=(e+3)%4,o=(n+1)%4,a=(n+2)%4,l=(n+3)%4;return mgt(t,r,i,s,o,a,l)+mgt(t,i,s,r,o,a,l)+mgt(t,s,r,i,o,a,l)}function ygt(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],i=0,s=t;i<s.length;i++){var o=s[i],a=o.x-.5,l=o.y-.5,c=n.ignoreRotation?0:e.rotation,u=Math.cos(c)*a-Math.sin(c)*l,h=Math.sin(c)*a+Math.cos(c)*l;u=u*e.width+e.xCenter,h=h*e.height+e.yCenter;var d=o.z*e.width,p=Vmt({},o);p.x=u,p.y=h,p.z=d,r.push(p)}return r}function bgt(t,e){var n=function(t,e,n,r){var i=(r-n)/255;return{scale:i,offset:n-0*i}}(0,0,e[0],e[1]);return Co((function(){return Ma(Na(t,n.scale),n.offset)}))}function vgt(t,e,n){var r,i,s,o,a,l,c,u,h,d,p,f,m=e.outputTensorSize,g=e.keepAspectRatio,y=e.borderMode,b=e.outputTensorFloatRange,v=lgt(t),x=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}(v,n),w=function(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,i=e.width;dgt(e,"targetSize"),dgt(t,"roi");var s,o,a=r/i,l=t.height/t.width,c=0,u=0;return a>l?(s=t.width,o=t.width*a,u=(1-l/a)/2):(s=t.height/a,o=t.height,c=(1-a/l)/2),t.width=s,t.height=o,{top:u,left:c,right:c,bottom:u}}(x,m,g),_=(r=x,i=v.width,s=v.height,!1,o=r.width,a=r.height,1,l=Math.cos(r.rotation),c=Math.sin(r.rotation),u=r.xCenter,h=r.yCenter,d=1/i,p=1/s,(f=new Array(16))[0]=o*l*1*d,f[1]=-a*c*d,f[2]=0,f[3]=(-.5*o*l*1+.5*a*c+u)*d,f[4]=o*c*1*p,f[5]=a*l*p,f[6]=0,f[7]=(-.5*a*l-.5*o*c*1+h)*p,f[8]=0,f[9]=0,f[10]=o*d,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,fgt(f));return{imageTensor:Co((function(){var e=ugt(t),n=Mh(hgt(_,v,m),[1,8]),r="zero"===y?"constant":"nearest",i=rp.transform(gc(no(e,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=b?bgt(i,b):i})),padding:w,transformationMatrix:_}}function xgt(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}function wgt(t){return null!=t&&null!=t.currentTime}function _gt(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var a=t[o];n=Math.min(n,a.x),r=Math.max(r,a.x),i=Math.min(i,a.y),s=Math.max(s,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:i,xMax:r,yMax:s,width:r-n,height:s-i},e}function Sgt(t,e,n,r){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a;return Wmt(this,(function(l){switch(l.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),r=Mh(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),i=Eh(t.map((function(t){return t.score[0]}))),[4,rp.nonMaxSuppressionAsync(r,i,e,n)];case 1:return[4,(s=l.sent()).array()];case 2:return o=l.sent(),a=t.filter((function(t,e){return o.indexOf(e)>-1})),Ao([r,i,s]),[2,a]}}))}))}function kgt(t,e){return t.map((function(t){var n=Vmt(Vmt({},t),{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}function Tgt(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,_,S,k,T,E;return Wmt(this,(function(M){switch(M.label){case 0:if(r=wh(e,[0]),i=r.shape,s=i[0],o=i[1],a=i[2],t.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+t.length+", heatmap length: "+a);return l=[],[4,r.buffer()];case 1:for(c=M.sent(),u=0;u<t.length;u++)if(h=t[u],d=Vmt({},h),l.push(d),p=Math.trunc(d.x*o),f=Math.trunc(d.y*s),!(p<0||p>=o||f<0||p>=s)){for(m=Math.trunc((n.kernelSize-1)/2),g=Math.max(0,p-m),y=Math.min(o,p+m+1),b=Math.max(0,f-m),v=Math.min(s,f+m+1),x=0,w=0,_=0,S=0,k=b;k<v;++k)for(T=g;T<y;++T)E=c.get(k,T,u),x+=E,S=Math.max(S,E),w+=T*E,_+=k*E;S>=n.minConfidenceToRefine&&x>0&&(d.x=w/o/x,d.y=_/s/x)}return r.dispose(),[2,l]}}))}))}function Egt(t,e){var n=e.left,r=e.top,i=e.left+e.right,s=e.top+e.bottom;return t.map((function(t){return Vmt(Vmt({},t),{x:(t.x-n)/(1-i),y:(t.y-r)/(1-s),z:t.z/(1-i)})}))}function Mgt(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a;return Wmt(this,(function(l){switch(l.label){case 0:return r=t[0],i=t[1],s=function(t,e,n){return Co((function(){var r,i,s,o;n.reverseOutputOrder?(i=wh(cl(t,[0,n.boxCoordOffset+0],[-1,1])),r=wh(cl(t,[0,n.boxCoordOffset+1],[-1,1])),o=wh(cl(t,[0,n.boxCoordOffset+2],[-1,1])),s=wh(cl(t,[0,n.boxCoordOffset+3],[-1,1]))):(r=wh(cl(t,[0,n.boxCoordOffset+0],[-1,1])),i=wh(cl(t,[0,n.boxCoordOffset+1],[-1,1])),s=wh(cl(t,[0,n.boxCoordOffset+2],[-1,1])),o=wh(cl(t,[0,n.boxCoordOffset+3],[-1,1]))),i=Ma(Na(Aa(i,n.xScale),e.w),e.x),r=Ma(Na(Aa(r,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(s=Na(mc(Aa(s,n.hScale)),e.h),o=Na(mc(Aa(o,n.wScale)),e.w)):(s=Na(Aa(s,n.hScale),e.h),o=Na(Aa(o,n.wScale),e.h));var a=zc(r,Aa(s,2)),l=zc(i,Aa(o,2)),c=Ma(r,Aa(s,2)),u=Ma(i,Aa(o,2)),h=al([il(a,[n.numBoxes,1]),il(l,[n.numBoxes,1]),il(c,[n.numBoxes,1]),il(u,[n.numBoxes,1])],1);if(n.numKeypoints)for(var d=0;d<n.numKeypoints;++d){var p=n.keypointCoordOffset+d*n.numValuesPerKeypoint,f=void 0,m=void 0;n.reverseOutputOrder?(f=wh(cl(t,[0,p],[-1,1])),m=wh(cl(t,[0,p+1],[-1,1]))):(m=wh(cl(t,[0,p],[-1,1])),f=wh(cl(t,[0,p+1],[-1,1])));var g=Ma(Na(Aa(f,n.xScale),e.w),e.x),y=Ma(Na(Aa(m,n.yScale),e.h),e.y);h=al([h,il(g,[n.numBoxes,1]),il(y,[n.numBoxes,1])],1)}return h}))}(i,e,n),o=Co((function(){var t=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=_l(r,-n.scoreClippingThresh,n.scoreClippingThresh)),t=ll(t)):t})),[4,Cgt(s,o,n)];case 1:return a=l.sent(),Ao([s,o]),[2,a]}}))}))}function Cgt(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f;return Wmt(this,(function(m){switch(m.label){case 0:return r=[],[4,t.data()];case 1:return i=m.sent(),[4,e.data()];case 2:for(s=m.sent(),o=0;o<n.numBoxes;++o)if(!(null!=n.minScoreThresh&&s[o]<n.minScoreThresh||(a=o*n.numCoords,l=Agt(i[a+0],i[a+1],i[a+2],i[a+3],s[o],n.flipVertically,o),(c=l.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((u=l.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,d=0;d<h;d+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+d,f={x:i[p+0],y:n.flipVertically?1-i[p+1]:i[p+1]},u.relativeKeypoints.push(f);r.push(l)}return[2,r]}}))}))}function Agt(t,e,n,r,i,s,o){return{score:[i],ind:o,locationData:{relativeBoundingBox:{xMin:e,yMin:s?1-n:t,xMax:r,yMax:s?1-t:n,width:r-e,height:n-t}}}}function Ngt(t,e){return"none"===t?e:function(t){return 1/(1+Math.exp(-t))}(e)}function Igt(t,e,n,r){return jmt(this,void 0,void 0,(function(){var i,s,o,a,l,c,u,h;return Wmt(this,(function(d){switch(d.label){case 0:return n=n||e.flipHorizontally||!1,r=r||e.flipVertically||!1,i=t.size,s=i/e.numLandmarks,[4,t.data()];case 1:for(o=d.sent(),a=[],l=0;l<e.numLandmarks;++l)c=l*s,(h={x:0,y:0}).x=n?e.inputImageWidth-o[c]:o[c],s>1&&(h.y=r?e.inputImageHeight-o[c+1]:o[c+1]),s>2&&(h.z=o[c+2]),s>3&&(h.score=Ngt(e.visibilityActivation,o[c+3])),a.push(h);for(u=0;u<a.length;++u)(h=a[u]).x=h.x/e.inputImageWidth,h.y=h.y/e.inputImageHeight,h.z=h.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}}))}))}function $gt(t,e,n){var r=t.width,i=t.height,s=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(s=function(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),cgt(t)}(s,n)),0===s)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+i*n.shiftY;else{var o=(e.width*r*n.shiftX*Math.cos(s)-e.height*i*n.shiftY*Math.sin(s))/e.width,a=(e.width*r*n.shiftX*Math.sin(s)+e.height*i*n.shiftY*Math.cos(s))/e.height;t.xCenter=t.xCenter+o,t.yCenter=t.yCenter+a}if(n.squareLong){var l=Math.max(r*e.width,i*e.height);r=l/e.width,i=l/e.height}else if(n.squareShort){var c=Math.min(r*e.width,i*e.height);r=c/e.width,i=c/e.height}return t.width=r*n.scaleX,t.height=i*n.scaleY,t}var Rgt=function(){function t(t){this.alpha=t,this.initialized=!1}return t.prototype.apply=function(t,e){var n;return this.initialized?n=null==e?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(n=t,this.initialized=!0),this.rawValue=t,this.storedValue=n,n},t.prototype.applyWithAlpha=function(t,e,n){return this.alpha=e,this.apply(t,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),Ogt=function(){function t(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new Rgt(this.getAlpha(this.minCutOff)),this.dx=new Rgt(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r=Math.trunc(e);if(this.lastTimestamp>=r)return t;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var i=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*n*this.frequency:0,s=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),o=this.minCutOff+this.beta*Math.abs(s),a=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(s):null;return this.x.applyWithAlpha(t,this.getAlpha(o),a)},t.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},t}(),Pgt=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;this.initializeFiltersIfEmpty(t);var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return Hmt(t);i=1/n}return t.map((function(t,n){var s=Vmt(Vmt({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(s.z=r.zFilters[n].apply(t.z,e,i)),s}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new Ogt(e.config)})),this.yFilters=t.map((function(t){return new Ogt(e.config)})),this.zFilters=t.map((function(t){return new Ogt(e.config)})))},t}(),Lgt=function(){function t(t){this.config=t,this.window=[],this.lowPassFilter=new Rgt(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r,i=Math.trunc(e);if(this.lastTimestamp>=i)return t;if(-1===this.lastTimestamp)r=1;else{for(var s=t*n-this.lastValue*this.lastValueScale,o=i-this.lastTimestamp,a=s,l=o,c=(1+this.window.length)*(1e6/30),u=0,h=this.window;u<h.length;u++){var d=h[u];if(l+d.duration>c)break;a+=d.distance,l+=d.duration}var p=a/(1e-6*l);r=1-1/(1+this.config.velocityScale*Math.abs(p)),this.window.unshift({distance:s,duration:o}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=n,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(t,r)},t}(),Dgt=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return Hmt(t);i=1/n}return this.initializeFiltersIfEmpty(t),t.map((function(t,n){var s=Vmt(Vmt({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(s.z=r.zFilters[n].apply(t.z,e,i)),s}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new Lgt(e.config)})),this.yFilters=t.map((function(t){return new Lgt(e.config)})),this.zFilters=t.map((function(t){return new Lgt(e.config)})))},t}(),Fgt=function(){function t(t){if(null!=t.velocityFilter)this.keypointsFilter=new Dgt(t.velocityFilter);else{if(null==t.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+t+".");this.keypointsFilter=new Pgt(t.oneEuroFilter)}}return t.prototype.apply=function(t,e,n,r,i){if(void 0===r&&(r=!1),null==t)return this.keypointsFilter.reset(),null;var s=null!=i?function(t,e){return(t.width*e.width+t.height*e.height)/2}(i,n):1,o=r?kgt(t,n):t,a=this.keypointsFilter.apply(o,e,s);return r?function(t,e){return t.map((function(t){var n=Vmt(Vmt({},t),{x:t.x/e.width,y:t.y/e.height});return null!=t.z&&(t.z=t.z/e.width),n}))}(a,n):a},t}(),zgt=function(){function t(t){this.alpha=t.alpha}return t.prototype.apply=function(t){var e=this;if(null==t)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map((function(t){return new Rgt(e.alpha)})));for(var n=[],r=0;r<t.length;++r){var i=t[r],s=Vmt({},i);s.score=this.visibilityFilters[r].apply(i.score),n.push(s)}return n},t}(),Bgt={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},Ugt={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},Vgt={maxPoses:1,flipHorizontal:!1},jgt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},Wgt={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},Hgt={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},Ggt={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},qgt={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Xgt={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Ygt={kernelSize:7,minConfidenceToRefine:.5},Kgt={alpha:.1},Zgt={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},Jgt={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},Qgt={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},tyt={activation:"none"},eyt={combineWithPreviousRatio:.7},nyt=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,Qmt(this.mask)]}))}))},t.prototype.toImageData=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,tgt(this.mask)]}))}))},t.prototype.toTensor=function(){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(t){return[2,this.mask]}))}))},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function ryt(t){return ngt(t),"person"}var iyt=function(){function t(t,e,n,r,i,s){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=i,this.modelType=s,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(t){null==t.reduceBoxesInLowestLayer&&(t.reduceBoxesInLowestLayer=!1),null==t.interpolatedScaleAspectRatio&&(t.interpolatedScaleAspectRatio=1),null==t.fixedAnchorSize&&(t.fixedAnchorSize=!1);for(var e=[],n=0;n<t.numLayers;){for(var r=[],i=[],s=[],o=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var l=xgt(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)s.push(1),s.push(2),s.push(.5),o.push(.1),o.push(l),o.push(l);else{for(var c=0;c<t.aspectRatios.length;++c)s.push(t.aspectRatios[c]),o.push(l);if(t.interpolatedScaleAspectRatio>0){var u=a===t.strides.length-1?1:xgt(t.minScale,t.maxScale,a+1,t.strides.length);o.push(Math.sqrt(l*u)),s.push(t.interpolatedScaleAspectRatio)}}a++}for(var h=0;h<s.length;++h){var d=Math.sqrt(s[h]);r.push(o[h]/d),i.push(o[h]*d)}var p=0,f=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],f=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),f=Math.ceil(t.inputSizeWidth/m)}for(var g=0;g<p;++g)for(var y=0;y<f;++y)for(var b=0;b<r.length;++b){var v={xCenter:(y+t.anchorOffsetX)/f,yCenter:(g+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(v.width=1,v.height=1):(v.width=i[b],v.height=r[b]),e.push(v)}n=a}return e}(Bgt);var o=Eh(this.anchors.map((function(t){return t.width}))),a=Eh(this.anchors.map((function(t){return t.height}))),l=Eh(this.anchors.map((function(t){return t.xCenter}))),c=Eh(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:l,y:c,w:o,h:a},this.prevFilteredSegmentationMask=this.enableSegmentation?Mh([],[0,0]):null}return t.prototype.estimatePoses=function(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x,w,_,S,k,T;return Wmt(this,(function(E){switch(E.label){case 0:return r=function(t){var e;if(null==(e=null==t?Vgt:Vmt({},t)).maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}(e),null==t?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:wgt(t)?1e6*t.currentTime:null,i=lgt(t),s=Co((function(){return no(ugt(t),"float32")})),null!=(o=this.regionOfInterest)?[3,2]:[4,this.detectPose(s)]);case 1:if(0===(a=E.sent()).length)return this.reset(),s.dispose(),[2,[]];l=a[0],o=this.poseDetectionToRoi(l,i),E.label=2;case 2:return[4,this.poseLandmarksByRoi(o,s)];case 3:return c=E.sent(),s.dispose(),null==c?(this.reset(),[2,[]]):(u=c.landmarks,h=c.auxiliaryLandmarks,d=c.poseScore,p=c.worldLandmarks,f=c.segmentationMask,m=this.poseLandmarkFiltering(u,h,p,i),g=m.actualLandmarksFiltered,y=m.auxiliaryLandmarksFiltered,b=m.actualWorldLandmarksFiltered,v=this.poseLandmarksToRoi(y,i),this.regionOfInterest=v,x=this.smoothSegmentation&&null!=f?this.poseSegmentationFiltering(f):f,null!=(w=null!=g?kgt(g,i):null)&&w.forEach((function(t,e){t.name=qmt[e]})),null!=(_=b)&&_.forEach((function(t,e){t.name=qmt[e]})),S={score:d,keypoints:w,keypoints3D:_},null!==x&&(k=Co((function(){var t=gc(x,2),e=du(t,[[0,0],[0,0],[0,1]]);return iu(e,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||Ao(x),T={maskValueToLabel:ryt,mask:new nyt(k)},S.segmentation=T),[2,[S]])}}))}))},t.prototype.poseSegmentationFiltering=function(t){var e=this.prevFilteredSegmentationMask;return 0===e.size?this.prevFilteredSegmentationMask=t:(this.prevFilteredSegmentationMask=function(t,e,n){return"webgl"===Io()?function(t,e,n){var r=n.combineWithPreviousRatio.toFixed(2),i={variableNames:["prevMask","newMask"],outputShape:t.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * "+r+");\n\n      setOutput(outputValue);\n    }\n"},s=Ro();return Co((function(){var n=s.compileAndRun(i,[t,e]);return Eo().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(t,e,n):Co((function(){var r=zc(e,.5),i=uc(r),s=zc(1,ru(1,Na(i,Ma(5.68842,Na(i,Ma(-.748699,Na(i,Ma(-57.8051,Na(i,Ma(291.309,Na(i,-624.717)))))))))));return Ma(e,Na(zc(t,e),Na(s,n.combineWithPreviousRatio)))}))}(e,t,eyt),Ao(t)),Ao(e),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),Ao([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(Ao(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=Mh([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l,c,u;return Wmt(this,(function(h){switch(h.label){case 0:return e=vgt(t,Hgt),n=e.imageTensor,r=e.padding,i=this.detectorModel.predict(n),s=function(t){return Co((function(){var e=function(t){return Co((function(){return[cl(t,[0,0,0],[1,-1,1]),cl(t,[0,0,1],[1,-1,-1])]}))}(t),n=e[0],r=e[1];return{boxes:wh(r),logits:wh(n)}}))}(i),o=s.boxes,[4,Mgt([a=s.logits,o],this.anchorTensor,jgt)];case 1:return 0===(l=h.sent()).length?(Ao([n,i,a,o]),[2,l]):[4,Sgt(l,this.maxPoses,.3)];case 2:return c=h.sent(),u=function(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,i=e.left+e.right,s=e.top+e.bottom,o=0;o<t.length;o++){var a=t[o],l=a.locationData.relativeBoundingBox,c=(l.xMin-n)/(1-i),u=(l.yMin-r)/(1-s),h=l.width/(1-i),d=l.height/(1-s);l.xMin=c,l.yMin=u,l.width=h,l.height=d,l.xMax=c+h,l.yMax=u+d;var p=a.locationData.relativeKeypoints;p&&p.forEach((function(t){var e=(t.x-n)/(1-i),o=(t.y-r)/(1-s);t.x=e,t.y=o}))}return t}(c,r),Ao([n,i,a,o]),[2,u]}}))}))},t.prototype.poseDetectionToRoi=function(t,e){return $gt(pgt(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,Wgt)},t.prototype.poseLandmarksByRoi=function(t,e){return jmt(this,void 0,void 0,(function(){var n,r,i,s,o,a,l,c,u,h,d,p,f,m;return Wmt(this,(function(g){switch(g.label){case 0:if(n=lgt(e),r=vgt(e,Ggt,t),i=r.imageTensor,s=r.padding,o=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return a=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&a.push("activation_segmentation"),l=this.landmarkModel.execute(i,a),[4,this.tensorsToPoseLandmarksAndSegmentation(l)];case 1:return null==(c=g.sent())?(Ao(l),Ao(i),[2,null]):(u=c.landmarks,h=c.auxiliaryLandmarks,d=c.poseScore,p=c.worldLandmarks,f=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,t,s,o,u,h,p,f)]);case 2:return m=g.sent(),Ao(l),Ao(i),[2,Vmt({poseScore:d},m)]}}))}))},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(t,e,n,r,i,s,o,a){return jmt(this,void 0,void 0,(function(){var l,c,u,h,d,p;return Wmt(this,(function(f){return l=Egt(i,n),c=Egt(s,n),u=ygt(l,e),h=ygt(c,e),d=function(t,e){for(var n=[],r=0,i=t;r<i.length;r++){var s=i[r],o=s.x,a=s.y,l=e.rotation,c=Math.cos(l)*o-Math.sin(l)*a,u=Math.sin(l)*o+Math.cos(l)*a,h=Vmt({},s);h.x=c,h.y=u,n.push(h)}return n}(o,e),p=null,this.enableSegmentation&&(p=Co((function(){var e=a.shape,n=e[0],i=e[1],s=function(t){var e=fgt(new Array(16).fill(0));e[0][0]=ggt(t,0,0),e[1][0]=-ggt(t,0,1),e[2][0]=ggt(t,0,2),e[3][0]=-ggt(t,0,3),e[0][2]=ggt(t,2,0),e[1][2]=-ggt(t,2,1),e[2][2]=ggt(t,2,2),e[3][2]=-ggt(t,2,3),e[0][1]=-ggt(t,1,0),e[1][1]=ggt(t,1,1),e[2][1]=-ggt(t,1,2),e[3][1]=ggt(t,1,3),e[0][3]=-ggt(t,3,0),e[1][3]=ggt(t,3,1),e[2][3]=-ggt(t,3,2),e[3][3]=ggt(t,3,3);for(var n=t[0][0]*e[0][0]+t[1][0]*e[0][1]+t[2][0]*e[0][2]+t[3][0]*e[0][3],r=0;r<e.length;r++)for(var i=0;i<e.length;i++)e[r][i]/=n;return e}(r),o=Mh(hgt(s,{width:i,height:n},t),[1,8]),l=[1,n,i,1];return wh(rp.transform(il(a,l),o,"bilinear","constant",0,[t.height,t.width]),[0,3])})),Ao(a)),[2,{landmarks:u,auxiliaryLandmarks:h,worldLandmarks:d,segmentationMask:p}]}))}))},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l,c,u,h,d,p;return Wmt(this,(function(f){switch(f.label){case 0:return e=t[0],n=t[1],r=t[2],i=t[3],s=this.enableSegmentation?t[4]:null,[4,n.data()];case 1:return(o=f.sent()[0])<.5?[2,null]:[4,Igt(e,qgt)];case 2:return[4,Tgt(f.sent(),r,Ygt)];case 3:return a=f.sent(),l=a.slice(0,33),c=a.slice(33,35),[4,Igt(i,Xgt)];case 4:return u=f.sent(),h=u.slice(0,33),d=function(t,e,n){void 0===n&&(n=!0);for(var r=[],i=0;i<t.length;i++){var s=Vmt({},e[i]);n&&(s.score=t[i].score),r.push(s)}return r}(l,h,!0),p=this.enableSegmentation?function(t,e,n){return Co((function(){var n=wh(t,[0]),r=n.shape[2];if(1===r){var i=n;switch(e.activation){case"none":break;case"sigmoid":i=ll(i);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+e.activation+")")}return wh(i,[2])}throw new Error("Unsupported number of tensor channels "+r)}))}(s,tyt):null,[2,{landmarks:l,auxiliaryLandmarks:c,poseScore:o,worldLandmarks:d,segmentationMask:p}]}}))}))},t.prototype.poseLandmarksToRoi=function(t,e){return $gt(pgt(_gt(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,Wgt)},t.prototype.poseLandmarkFiltering=function(t,e,n,r){var i,s,o;if(null!=this.timestamp&&this.enableSmoothing){var a=pgt(_gt(e),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new zgt(Kgt)),i=this.visibilitySmoothingFilterActual.apply(t),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new zgt(Kgt)),s=this.visibilitySmoothingFilterAuxiliary.apply(e),o=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new Fgt(Zgt)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,r,!0,a),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new Fgt(Jgt)),s=this.landmarksSmoothingFilterAuxiliary.apply(s,this.timestamp,r,!0,a),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new Fgt(Qgt)),o=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else i=t,s=e,o=n;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:s,actualWorldLandmarksFiltered:o}},t}();function syt(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s,o;return Wmt(this,(function(a){switch(a.label){case 0:return e=function(t){var e=Vmt({},null==t?Ugt:t);if(null==e.enableSmoothing&&(e.enableSmoothing=Ugt.enableSmoothing),null==e.enableSegmentation&&(e.enableSegmentation=Ugt.enableSegmentation),null==e.smoothSegmentation&&(e.smoothSegmentation=Ugt.smoothSegmentation),null==e.modelType&&(e.modelType=Ugt.modelType),null==e.detectorModelUrl&&(e.detectorModelUrl=Ugt.detectorModelUrl),null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return e}(t),n="string"==typeof e.detectorModelUrl&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof e.landmarkModelUrl&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([P0(e.detectorModelUrl,{fromTFHub:n}),P0(e.landmarkModelUrl,{fromTFHub:r})])];case 1:return i=a.sent(),s=i[0],o=i[1],[2,new iyt(s,o,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}}))}))}var oyt,ayt,lyt,cyt=function(){function t(t){!function(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+t.maxTracks);if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+t.maxAge);if(void 0!==t.keypointTrackerParams){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+t.keypointTrackerParams.keypointConfidenceThreshold);if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+t.keypointTrackerParams.minNumberOfKeypoints);for(var e=0,n=t.keypointTrackerParams.keypointFalloff;e<n.length;e++){var r=n[e];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return t.prototype.apply=function(t,e){this.filterOldTracks(e);var n=this.computeSimilarity(t);return this.assignTracks(t,n,e),this.updateTracks(e),t},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(t){return t.id})))},t.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter((function(n){return t-n.lastTimestamp<=e.maxAge}))},t.prototype.assignTracks=function(t,e,n){for(var r=Array.from(Array(e[0].length).keys()),i=[],s=0,o=Array.from(Array(t.length).keys());s<o.length;s++){var a=o[s];if(0!==r.length){for(var l=-1,c=-1,u=0,h=r;u<h.length;u++){var d=h[u],p=e[a][d];p>=this.minSimilarity&&p>c&&(l=d,c=p)}if(l>=0){var f=this.tracks[l];f=Object.assign(f,this.createTrack(t[a],n,f.id)),t[a].id=f.id;var m=r.indexOf(l);r.splice(m,1)}else i.push(a)}else i.push(a)}for(var g=0,y=i;g<y.length;g++){a=y[g];var b=this.createTrack(t[a],n);this.tracks.push(b),t[a].id=b.id}},t.prototype.updateTracks=function(t){this.tracks.sort((function(t,e){return e.lastTimestamp-t.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(t,e,n){var r={id:n||this.nextTrackID(),lastTimestamp:e,keypoints:Hmt(t.keypoints).map((function(t){return Vmt({},t)}))};return void 0!==t.box&&(r.box=Vmt({},t.box)),r},t.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter((function(e){return!t.includes(e.id)}))},t.prototype.reset=function(){this.tracks=[]},t}(),uyt=function(t){function e(e){return t.call(this,e)||this}return Umt(e,t),e.prototype.computeSimilarity=function(t){var e=this;return 0===t.length||0===this.tracks.length?[[]]:t.map((function(t){return e.tracks.map((function(n){return e.iou(t,n)}))}))},e.prototype.iou=function(t,e){var n=Math.max(t.box.xMin,e.box.xMin),r=Math.max(t.box.yMin,e.box.yMin),i=Math.min(t.box.xMax,e.box.xMax),s=Math.min(t.box.yMax,e.box.yMax);if(n>=i||r>=s)return 0;var o=(i-n)*(s-r);return o/(t.box.width*t.box.height+e.box.width*e.box.height-o)},e}(cyt),hyt=function(t){function e(e){var n=t.call(this,e)||this;return n.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=e.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,n}return Umt(e,t),e.prototype.computeSimilarity=function(t){if(0===t.length||0===this.tracks.length)return[[]];for(var e=[],n=0,r=t;n<r.length;n++){for(var i=r[n],s=[],o=0,a=this.tracks;o<a.length;o++){var l=a[o];s.push(this.oks(i,l))}e.push(s)}return e},e.prototype.oks=function(t,e){for(var n=this.area(e.keypoints)+1e-6,r=0,i=0,s=0;s<t.keypoints.length;++s){var o=t.keypoints[s],a=e.keypoints[s];if(!(o.score<this.keypointThreshold||a.score<this.keypointThreshold)){i+=1;var l=Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2),c=2*this.keypointFalloff[s];r+=Math.exp(-1*l/(2*n*Math.pow(c,2)))}}return i<this.minNumKeyoints?0:r/i},e.prototype.area=function(t){var e=this,n=t.filter((function(t){return t.score>e.keypointThreshold})),r=Math.min.apply(Math,Hmt([1],n.map((function(t){return t.x})))),i=Math.max.apply(Math,Hmt([0],n.map((function(t){return t.x})))),s=Math.min.apply(Math,Hmt([1],n.map((function(t){return t.y}))));return(i-r)*(Math.max.apply(Math,Hmt([0],n.map((function(t){return t.y}))))-s)},e}(cyt);function dyt(t){switch(t){case ayt.BlazePose:return qmt.reduce((function(t,e,n){return t[e]=n,t}),{});case ayt.PoseNet:case ayt.MoveNet:return Gmt.reduce((function(t,e,n){return t[e]=n,t}),{});default:throw new Error("Model "+t+" is not supported.")}}(lyt=oyt||(oyt={})).Keypoint="keypoint",lyt.BoundingBox="boundingBox",function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(ayt||(ayt={}));var pyt=Object.freeze({__proto__:null,getKeypointIndexBySide:function(t){switch(t){case ayt.BlazePose:return Xmt;case ayt.PoseNet:case ayt.MoveNet:return Ymt;default:throw new Error("Model "+t+" is not supported.")}},getAdjacentPairs:function(t){switch(t){case ayt.BlazePose:return Zmt;case ayt.PoseNet:case ayt.MoveNet:return Kmt;default:throw new Error("Model "+t+" is not supported.")}},getKeypointIndexByName:dyt}),fyt=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],myt={modelType:"SinglePose.Lightning",enableSmoothing:!0},gyt={},yyt={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},byt={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},vyt={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function xyt(t,e){var n,r,i,s;return t?e.width>e.height?(n=1,r=e.height/e.width,i=0,s=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,s=0):e.width>e.height?(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,s=0):(n=1,r=e.height/e.width,i=0,s=(e.width/2-e.height/2)/e.width),{yMin:i,xMin:s,yMax:i+n,xMax:s+r,height:n,width:r}}function wyt(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return null!=e.maxTracks&&(n.maxTracks=e.maxTracks),null!=e.maxAge&&(n.maxAge=e.maxAge),null!=e.minSimilarity&&(n.minSimilarity=e.minSimilarity),n}var _yt=function(){function t(t,e){this.moveNetModel=t,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=dyt(ayt.MoveNet),"SinglePose.Lightning"===e.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===e.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===e.modelType,this.multiPoseModel||(this.keypointFilter=new Pgt(yyt),this.cropRegionFilterYMin=new Rgt(.9),this.cropRegionFilterXMin=new Rgt(.9),this.cropRegionFilterYMax=new Rgt(.9),this.cropRegionFilterXMax=new Rgt(.9)),this.enableSmoothing=e.enableSmoothing,e.minPoseScore?this.minPoseScore=e.minPoseScore:this.minPoseScore=.25,e.multiPoseMaxDimension?this.multiPoseMaxDimension=e.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=e.enableTracking,this.multiPoseModel&&this.enableTracking&&(e.trackerType===oyt.Keypoint?this.tracker=new hyt(e.trackerConfig):e.trackerType===oyt.BoundingBox&&(this.tracker=new uyt(e.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s;return Wmt(this,(function(o){switch(o.label){case 0:if(4!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||1!==e.shape[1]||17!==e.shape[2]||3!==e.shape[3])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===Io()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=o.sent(),o.label=3;case 3:for(e.dispose(),r={keypoints:[],score:0},i=0,s=0;s<17;++s)r.keypoints[s]={y:n[3*s],x:n[3*s+1],score:n[3*s+2]},r.keypoints[s].score>.2&&(++i,r.score+=r.keypoints[s].score);return i>0&&(r.score/=i),[2,r]}}))}))},t.prototype.runMultiPersonPoseModel=function(t){return jmt(this,void 0,void 0,(function(){var e,n,r,i,s,o,a,l;return Wmt(this,(function(c){switch(c.label){case 0:if(3!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||56!==e.shape[2])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===Io()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=c.sent(),c.label=3;case 3:for(e.dispose(),r=[],i=n.length/56,s=0;s<i;++s)for(r[s]={keypoints:[]},o=56*s+51,r[s].box={yMin:n[o],xMin:n[o+1],yMax:n[o+2],xMax:n[o+3],width:n[o+3]-n[o+1],height:n[o+2]-n[o]},a=56*s+55,r[s].score=n[a],r[s].keypoints=[],l=0;l<17;++l)r[s].keypoints[l]={y:n[56*s+3*l],x:n[56*s+3*l+1],score:n[56*s+3*l+2]};return[2,r]}}))}))},t.prototype.estimatePoses=function(t,e,n){return void 0===e&&(e=gyt),jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l;return Wmt(this,(function(c){switch(c.label){case 0:return e=function(t){return null==t?gyt:Vmt({},t)}(e),null==t?(this.reset(),[2,[]]):(null==n?wgt(t)&&(n=1e6*t.currentTime):n*=1e3,r=ugt(t),i=lgt(r),s=gc(r,0),t instanceof Si||r.dispose(),o=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(s,i,n)]);case 1:return o=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(s,i,n)];case 3:o=c.sent(),c.label=4;case 4:for(a=0;a<o.length;++a)for(l=0;l<o[a].keypoints.length;++l)o[a].keypoints[l].name=Gmt[l],o[a].keypoints[l].y*=i.height,o[a].keypoints[l].x*=i.width;return[2,o]}}))}))},t.prototype.estimateSinglePose=function(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a=this;return Wmt(this,(function(l){switch(l.label){case 0:return this.cropRegion||(this.cropRegion=xyt(null==this.cropRegion,e)),r=Co((function(){var e=Mh([[a.cropRegion.yMin,a.cropRegion.xMin,a.cropRegion.yMax,a.cropRegion.xMax]]),n=tu([1],"int32"),r=[a.modelInputResolution.height,a.modelInputResolution.width];return no(rp.cropAndResize(t,e,n,r,"bilinear",0),"int32")})),t.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(i=l.sent(),r.dispose(),i.score<this.minPoseScore)return this.reset(),[2,[]];for(s=0;s<i.keypoints.length;++s)i.keypoints[s].y=this.cropRegion.yMin+i.keypoints[s].y*this.cropRegion.height,i.keypoints[s].x=this.cropRegion.xMin+i.keypoints[s].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(i.keypoints=this.keypointFilter.apply(i.keypoints,n,1)),o=function(t,e,n,r){for(var i={},s=0,o=Gmt;s<o.length;s++){var a=o[s];i[a]=[e[n[a]].y*r.height,e[n[a]].x*r.width]}if(function(t,e){return(t[e.left_hip].score>.2||t[e.right_hip].score>.2)&&(t[e.left_shoulder].score>.2||t[e.right_shoulder].score>.2)}(e,n)){var l=(i.left_hip[0]+i.right_hip[0])/2,c=(i.left_hip[1]+i.right_hip[1])/2,u=function(t,e,n,r,i){for(var s=["left_shoulder","right_shoulder","left_hip","right_hip"],o=0,a=0,l=0;l<s.length;l++)(p=Math.abs(r-n[s[l]][0]))>o&&(o=p),(f=Math.abs(i-n[s[l]][1]))>a&&(a=f);for(var c=0,u=0,h=0,d=Object.keys(n);h<d.length;h++){var p,f,m=d[h];t[e[m]].score<.2||((p=Math.abs(r-n[m][0]))>c&&(c=p),(f=Math.abs(i-n[m][1]))>u&&(u=f))}return[o,a,c,u]}(e,n,i,l,c),h=u[0],d=u[1],p=u[2],f=u[3],m=Math.max(1.9*d,1.9*h,1.2*p,1.2*f),g=[l-(m=Math.min(m,Math.max(c,r.width-c,l,r.height-l))),c-m];if(m>Math.max(r.width,r.height)/2)return xyt(null==t,r);var y=2*m;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+y)/r.height,xMax:(g[1]+y)/r.width,height:(g[0]+y)/r.height-g[0]/r.height,width:(g[1]+y)/r.width-g[1]/r.width}}return xyt(null==t,r)}(this.cropRegion,i.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(o),[2,[i]]}}))}))},t.prototype.estimateMultiplePoses=function(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d,p,f=this;return Wmt(this,(function(m){switch(m.label){case 0:return e.width>e.height?(i=this.multiPoseMaxDimension,s=Math.round(this.multiPoseMaxDimension*e.height/e.width),r=rp.resizeBilinear(t,[s,i]),a=i,l=32*Math.ceil(s/32),o=du(r,[[0,0],[0,l-s],[0,0],[0,0]])):(i=Math.round(this.multiPoseMaxDimension*e.width/e.height),s=this.multiPoseMaxDimension,r=rp.resizeBilinear(t,[s,i]),a=32*Math.ceil(i/32),l=s,o=du(r,[[0,0],[0,0],[0,a-i],[0,0]])),r.dispose(),t.dispose(),c=no(o,"int32"),o.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(u=m.sent(),c.dispose(),u=u.filter((function(t){return t.score>=f.minPoseScore})),d=0;d<u.length;++d)for(h=0;h<u[d].keypoints.length;++h)u[d].keypoints[h].y*=l/s,u[d].keypoints[h].x*=a/i;if(this.enableTracking&&(this.tracker.apply(u,n),this.enableSmoothing)){for(d=0;d<u.length;++d)this.keypointFilterMap.has(u[d].id)||this.keypointFilterMap.set(u[d].id,new Pgt(yyt)),u[d].keypoints=this.keypointFilterMap.get(u[d].id).apply(u[d].keypoints,n,1);p=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(t,e){p.has(e)||f.keypointFilterMap.delete(e)}))}return[2,u]}}))}))},t.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),n=this.cropRegionFilterXMin.apply(t.xMin),r=this.cropRegionFilterYMax.apply(t.yMax),i=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:n,yMax:r,xMax:i,height:r-e,width:i-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function Syt(t){return void 0===t&&(t=myt),jmt(this,void 0,void 0,(function(){var e,n,r,i;return Wmt(this,(function(s){switch(s.label){case 0:return e=function(t){var e,n=null==t?myt:Vmt({},t);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(fyt.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+fyt);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=oyt.BoundingBox),n.trackerType===oyt.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(t){var e=wyt(byt,t);return e.keypointTrackerParams=Vmt({},byt.keypointTrackerParams),null!=t.keypointTrackerParams&&(null!=t.keypointTrackerParams.keypointConfidenceThreshold&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),null!=t.keypointTrackerParams.keypointFalloff&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),null!=t.keypointTrackerParams.minNumberOfKeypoints&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}(n.trackerConfig):n.trackerConfig=byt;else{if(n.trackerType!==oyt.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(e=n.trackerConfig,wyt(vyt,e)):n.trackerConfig=vyt}return n}(t),r=!0,e.modelUrl?(r="string"==typeof e.modelUrl&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,P0(e.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return i=void 0,"SinglePose.Lightning"===e.modelType?i="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===e.modelType?i="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===e.modelType&&(i="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,P0(i,{fromTFHub:r})];case 3:n=s.sent(),s.label=4;case 4:return"webgl"===Io()&&K().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new _yt(n,e)]}}))}))}var kyt={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},Tyt=["MobileNetV1","ResNet50"],Eyt={MobileNetV1:[8,16],ResNet50:[16]},Myt=[8,16,32],Cyt={MobileNetV1:[.5,.75,1],ResNet50:[1]},Ayt=[1,2,4],Nyt={maxPoses:1,flipHorizontal:!1},Iyt={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},$yt=[-123.15,-115.9,-103.06];function Ryt(t){return Math.floor(t/2)}var Oyt=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(Ryt(t),t);)this.exchange(t,Ryt(t)),t=Ryt(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function Pyt(t,e,n,r,i,s){for(var o=s.shape,a=o[0],l=o[1],c=!0,u=Math.max(n-i,0),h=Math.min(n+i+1,a),d=u;d<h;++d){for(var p=Math.max(r-i,0),f=Math.min(r+i+1,l),m=p;m<f;++m)if(s.get(d,m,t)>e){c=!1;break}if(!c)break}return c}function Lyt(t){return jmt(this,void 0,void 0,(function(){return Wmt(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function Dyt(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+17)}}function Fyt(t,e,n){var r=Dyt(t.heatmapY,t.heatmapX,t.id,n),i=r.y,s=r.x;return{x:t.heatmapX*e+s,y:t.heatmapY*e+i}}function zyt(t,e,n,r){var i=n.x,s=n.y;return t.some((function(t){var n,o,a,l,c=t.keypoints;return n=s,o=i,(a=c[r].y-n)*a+(l=c[r].x-o)*l<=e}))}var Byt=Gmt.reduce((function(t,e,n){return t[e]=n,t}),{}),Uyt=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(t){var e=t[0],n=t[1];return[Byt[e],Byt[n]]})),Vyt=Uyt.map((function(t){return t[1]})),jyt=Uyt.map((function(t){return t[0]}));function Wyt(t,e,n){return t<e?e:t>n?n:t}function Hyt(t,e,n,r){return{y:Wyt(Math.round(t.y/e),0,n-1),x:Wyt(Math.round(t.x/e),0,r-1)}}function Gyt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function qyt(t,e,n,r,i,s,o,a){void 0===a&&(a=2);for(var l=r.shape,c=l[0],u=l[1],h={y:e.y,x:e.x},d=Gyt(h,function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,Hyt(h,s,c,u),o)),p=0;p<a;p++){var f=Hyt(d,s,c,u),m=Dyt(f.y,f.x,n,i);d=Gyt({x:f.x*s,y:f.y*s},{x:m.x,y:m.y})}var g=Hyt(d,s,c,u),y=r.get(g.y,g.x,n);return{y:d.y,x:d.x,name:Gmt[n],score:y}}function Xyt(t,e,n,r,i,s){var o=e.shape[2],a=Vyt.length,l=new Array(o),c=t.part,u=t.score,h=Fyt(c,r,n);l[c.id]={score:u,name:Gmt[c.id],y:h.y,x:h.x};for(var d=a-1;d>=0;--d){var p=Vyt[d],f=jyt[d];l[p]&&!l[f]&&(l[f]=qyt(d,l[p],f,e,n,r,s))}for(d=0;d<a;++d)p=jyt[d],f=Vyt[d],l[p]&&!l[f]&&(l[f]=qyt(d,l[p],f,e,n,r,i));return l}function Yyt(t,e,n){return n.reduce((function(n,r,i){var s=r.y,o=r.x,a=r.score;return zyt(t,e,{y:s,x:o},i)||(n+=a),n}),0)/n.length}function Kyt(t,e,n,r,i,s,o,a){return void 0===o&&(o=.5),void 0===a&&(a=20),jmt(this,void 0,void 0,(function(){var l,c,u,h,d,p,f,m,g,y,b,v;return Wmt(this,(function(x){switch(x.label){case 0:return[4,Lyt([t,e,n,r])];case 1:for(l=x.sent(),c=l[0],u=l[1],h=l[2],d=l[3],p=[],f=function(t,e,n){for(var r=n.shape,i=r[0],s=r[1],o=r[2],a=new Oyt(i*s*o,(function(t){return t.score})),l=0;l<i;++l)for(var c=0;c<s;++c)for(var u=0;u<o;++u){var h=n.get(l,c,u);h<t||Pyt(u,h,l,c,1,n)&&a.enqueue({score:h,part:{heatmapY:l,heatmapX:c,id:u}})}return a}(o,0,c),m=a*a;p.length<s&&!f.empty();)g=f.dequeue(),y=Fyt(g.part,i,u),zyt(p,m,y,g.part.id)||(b=Xyt(g,c,u,i,h,d),v=Yyt(p,m,b),p.push({keypoints:b,score:v}));return[2,p]}}))}))}function Zyt(t,e,n){return Co((function(){var r=function(t,e){for(var n=[],r=0;r<Gmt.length;r++){var i=Jyt(t.get(r,0).valueOf(),t.get(r,1).valueOf(),r,e),s=i.x,o=i.y;n.push(o),n.push(s)}return Mh(n,[Gmt.length,2])}(t,n);return Ma(no(Na(t.toTensor(),lc(e,"int32")),"float32"),r)}))}function Jyt(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+Gmt.length)}}function Qyt(t,e,n){return jmt(this,void 0,void 0,(function(){var r,i,s,o,a,l,c,u,h,d;return Wmt(this,(function(p){switch(p.label){case 0:return r=0,i=function(t){var e=t.shape,n=e[0],r=e[1],i=e[2];return Co((function(){var e,s,o=il(t,[n*r,i]),a=Da(o,0),l=gc(Aa(a,lc(r,"int32")),1),c=gc((e=a,s=r,Co((function(){var t=Aa(e,lc(s,"int32"));return zc(e,Na(t,lc(s,"int32")))}))),1);return al([l,c],1)}))}(t),[4,Promise.all([t.buffer(),e.buffer(),i.buffer()])];case 1:return s=p.sent(),o=s[0],a=s[1],l=s[2],[4,(c=Zyt(l,n,a)).buffer()];case 2:return u=p.sent(),h=Array.from(function(t,e){for(var n=e.shape[0],r=new Float32Array(n),i=0;i<n;i++){var s=e.get(i,0),o=e.get(i,1);r[i]=t.get(s,o,i)}return r}(o,l)),d=h.map((function(t,e){return r+=t,{y:u.get(e,0),x:u.get(e,1),score:t,name:Gmt[e]}})),i.dispose(),c.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}function tbt(t,e){return(t-1)%e==0}var ebt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",nbt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function rbt(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var ibt=function(){function t(t,e){this.posenetModel=t;var n=this.posenetModel.inputs[0].shape;u(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var r,i,s=(r=e.inputResolution,i=e.outputStride,{height:rbt(r.height,i),width:rbt(r.width,i)});!function(t){u(Myt.indexOf(t)>=0,(function(){return"outputStride of "+t+" is invalid. It must be either 8 or 16."}))}(e.outputStride),function(t,e){u(tbt(t.height,e),(function(){return"height of "+t.height+" is invalid for output stride "+e+"."})),u(tbt(t.width,e),(function(){return"width of "+t.width+" is invalid for output stride "+e+"."}))}(s,e.outputStride),this.inputResolution=s,this.outputStride=e.outputStride,this.architecture=e.architecture}return t.prototype.estimatePoses=function(t,e){return void 0===e&&(e=Nyt),jmt(this,void 0,void 0,(function(){var n,r,i,s,o,a,l,c,u,h,d,p,f,m,g;return Wmt(this,(function(y){switch(y.label){case 0:return n=function(t){var e=t;if(null==e.maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1){if((e=Vmt(Vmt({},Iyt),e)).scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+e.scoreThreshold+". Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius "+e.nmsRadius+".")}return e}(e),null==t?[2,[]]:(this.maxPoses=n.maxPoses,r=vgt(t,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),i=r.imageTensor,s=r.padding,o="ResNet50"===this.architecture?Ma(i,$yt):bgt(i,[-1,1]),a=this.posenetModel.predict(o),"ResNet50"===this.architecture?(l=wh(a[2],[0]),c=wh(a[3],[0]),u=wh(a[0],[0]),h=wh(a[1],[0])):(l=wh(a[0],[0]),c=wh(a[1],[0]),u=wh(a[2],[0]),h=wh(a[3],[0])),d=ll(c),1!==this.maxPoses?[3,2]:[4,Qyt(d,l,this.outputStride)]);case 1:return f=y.sent(),p=[f],[3,4];case 2:return[4,Kyt(d,l,u,h,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:p=y.sent(),y.label=4;case 4:return m=lgt(t),g=function(t,e,n,r){var i=e.height,s=e.width,o=i/(n.height*(1-r.top-r.bottom)),a=s/(n.width*(1-r.left-r.right)),l=-r.top*n.height,c=-r.left*n.width;if(1===a&&1===o&&0===l&&0===c)return t;for(var u=0,h=t;u<h.length;u++)for(var d=0,p=h[u].keypoints;d<p.length;d++){var f=p[d];f.x=(f.x+c)*a,f.y=(f.y+l)*o}return t}(p,m,this.inputResolution,s),n.flipHorizontal&&(g=function(t,e){for(var n=0,r=t;n<r.length;n++)for(var i=0,s=r[n].keypoints;i<s.length;i++){var o=s[i];o.x=e.width-1-o.x}return t}(g,m)),i.dispose(),o.dispose(),Ao(a),l.dispose(),c.dispose(),u.dispose(),h.dispose(),d.dispose(),[2,g]}}))}))},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function sbt(t){return void 0===t&&(t=kyt),jmt(this,void 0,void 0,(function(){var e,n,r,i,s;return Wmt(this,(function(o){switch(o.label){case 0:return"ResNet50"!==(e=function(t){var e=t||kyt;if(null==e.architecture&&(e.architecture="MobileNetV1"),Tyt.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+Tyt);if(null==e.inputResolution&&(e.inputResolution={height:257,width:257}),null==e.outputStride&&(e.outputStride=16),Eyt[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+Eyt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),Cyt[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+Cyt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),Ayt.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+Ayt+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(t)).architecture?[3,2]:(a=e.outputStride,l=e.quantBytes,c="model-stride"+a+".json",n=4===l?nbt+"float/"+c:nbt+"quant"+l+"/"+c,[4,P0(e.modelUrl||n)]);case 1:return r=o.sent(),[2,new ibt(r,e)];case 2:return i=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+t+".json";return 4===n?ebt+"float/"+r[e]+"/"+i:ebt+"quant"+n+"/"+r[e]+"/"+i}(e.outputStride,e.multiplier,e.quantBytes),[4,P0(e.modelUrl||i)];case 3:return s=o.sent(),[2,new ibt(s,e)]}var a,l,c}))}))}const obt={MoveNet:.35,PoseNet:.5,BlazePose:.65},abt=["#ffffff","#800000","#469990","#e6194b","#42d4f4","#fabed4","#aaffc3","#9a6324","#000075","#f58231","#4363d8","#ffd8b1","#dcbeff","#808000","#ffe119","#911eb4","#bfef45","#f032e6","#3cb44b","#a9a9a9"];class lbt{constructor(t,e){this.model=t,this.width=e,this.params={lineWidth:2,radius:4,scoreThreshold:obt[t]},this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.width,this.ctx=this.canvas.getContext("2d")}drawKeypoint(t){if((null!=t.score?t.score:1)>=this.params.scoreThreshold){const e=new Path2D;e.arc(t.x,t.y,this.params.radius,0,2*Math.PI),this.ctx.fill(e),this.ctx.stroke(e)}}drawKeypoints(t){const e=pyt.getKeypointIndexBySide(this.model);this.ctx.fillStyle="Red",this.ctx.strokeStyle="White",this.ctx.lineWidth=this.params.lineWidth;for(const n of e.middle)this.drawKeypoint(t[n]);this.ctx.fillStyle="Green";for(const n of e.left)this.drawKeypoint(t[n]);this.ctx.fillStyle="Orange";for(const n of e.right)this.drawKeypoint(t[n])}drawSkeleton(t,e){const n=null!=e?abt[e%20]:"White";this.ctx.fillStyle=n,this.ctx.strokeStyle=n,this.ctx.lineWidth=this.params.lineWidth,pyt.getAdjacentPairs(this.model).forEach((([e,n])=>{const r=t[e],i=t[n],s=null!=r.score?r.score:1,o=null!=i.score?i.score:1,a=this.params.scoreThreshold||0;s>=a&&o>=a&&(this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke())}))}drawResult(t){if(null!=t.keypoints&&(this.drawKeypoints(t.keypoints),this.drawSkeleton(t.keypoints,t.id)),null!=t.keypoints3D)throw new Error("Keypoints 3D is not Implemented...")}drawResults(t){for(const e of t)this.drawResult(e)}drawImage(t){this.ctx.clearRect(0,0,t.width,t.width),this.canvas.height=t.height,this.canvas.width=t.width,this.ctx.putImageData(t,0,0)}render(t,e,n="ImageData"){return this.drawImage(t),this.drawResults(e),"ImageData"===n?this.ctx.getImageData(0,0,this.width,this.width):this.canvas.toDataURL("image/jpeg")}}function cbt(t){let e,n,r;return{c(){e=RN("Using "),n=RN(t[2]),r=RN(" pose detector.")},m(t,i){CN(t,e,i),CN(t,n,i),CN(t,r,i)},p(t,e){4&e&&BN(n,t[2])},d(t){t&&AN(e),t&&AN(n),t&&AN(r)}}}function ubt(t){let e;return{c(){e=RN(" ")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function hbt(t){let e;function n(t,e){return t[3]?ubt:cbt}let r=n(t),i=r(t);return{c(){e=IN("p"),i.c(),FN(e,"class","p-2 text-sm text-gray-600")},m(t,n){CN(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&AN(e),i.d()}}}function dbt(t){let e,n;return e=new OU({props:{title:t[0],loading:t[3],$$slots:{default:[hbt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading=t[3]),28&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function pbt(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{loading:a}=e;s();let{model:l}=e;return t.$$set=t=>{"title"in t&&n(0,o=t.title),"loading"in t&&s(n(1,a=t.loading)),"model"in t&&n(2,l=t.model)},[o,a,l,r]}class fbt extends HI{constructor(t){super(),WI(this,t,pbt,dbt,lN,{title:0,loading:1,model:2})}}var mbt,gbt,ybt;class bbt extends vQ{constructor(t="MoveNet",e){super(),this.model=t,this.modelConfig=e,this.title="Pose Detection",this.parameters={},this.serviceName="undefined",mbt.set(this,void 0),this.$loading=new JH(!0,!0),this.$bodyParts=new JH("Full body",!1),gbt.set(this,void 0),ybt.set(this,void 0),BH(this,gbt,new lbt(ayt[t],224),"f"),BH(this,ybt,new lbt(ayt[t],60),"f"),this.start(),this.setup(t,e)}async setup(t,e){BH(this,mbt,await function(t,e){return jmt(this,void 0,void 0,(function(){var n,r;return Wmt(this,(function(i){switch(t){case ayt.PoseNet:return[2,sbt(e)];case ayt.BlazePose:if(r=void 0,null!=(n=e)){if("tfjs"===n.runtime)return[2,syt(e)];if("mediapipe"===n.runtime)return[2,agt(e)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case ayt.MoveNet:return[2,Syt(e)];default:throw new Error(t+" is not a supported model name.")}}))}))}(ayt[t],e),"f"),eG.info(`${t} loaded`),this.$loading.set(!1),this.start()}async predict(t){if(!zH(this,mbt,"f"))return eG.error("Movenet is not loaded"),[];return await zH(this,mbt,"f").estimatePoses(t)}postprocess(t,e){const n=e&&Array.isArray(e)&&e.length>0?(t,n)=>e.includes(n):()=>!0;return t.map((t=>{const e=t.keypoints[0];return t.keypoints.filter(n).reduce(((t,n)=>[...t,(n.x-e.x)/100,(n.y-e.y)/100]),[])})).reduce(((t,e)=>[...t,...e]),[])}thumbnail(t,e){return zH(this,ybt,"f").render(t,e,"dataURL")}render(t,e){return zH(this,gbt,"f").render(t,e)}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new fbt({target:e,props:{title:this.title,loading:this.$loading,model:this.model}}))}train(){throw new iG("Model `MobileNet` cannot be trained")}save(){throw new Error("MobileNet does not support saving")}load(){throw new Error("MobileNet does not support loading")}download(){throw new Error("MobileNet does not support downloading")}upload(){throw new Error("MobileNet does not support uploading")}}mbt=new WeakMap,gbt=new WeakMap,ybt=new WeakMap,FH([rG],bbt.prototype,"train",null),FH([rG],bbt.prototype,"save",null),FH([rG],bbt.prototype,"load",null),FH([rG],bbt.prototype,"download",null),FH([rG],bbt.prototype,"upload",null);var vbt={},xbt={},wbt={};const _bt="125",Sbt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},kbt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Tbt=100,Ebt=300,Mbt=301,Cbt=302,Abt=303,Nbt=304,Ibt=306,$bt=307,Rbt=1e3,Obt=1001,Pbt=1002,Lbt=1003,Dbt=1004,Fbt=1005,zbt=1006,Bbt=1007,Ubt=1008,Vbt=1009,jbt=1012,Wbt=1014,Hbt=1015,Gbt=1016,qbt=1020,Xbt=1022,Ybt=1023,Kbt=1026,Zbt=1027,Jbt=33776,Qbt=33777,tvt=33778,evt=33779,nvt=35840,rvt=35841,ivt=35842,svt=35843,ovt=37492,avt=37496,lvt=2300,cvt=2301,uvt=2302,hvt=2400,dvt=2401,pvt=2402,fvt=2500,mvt=2501,gvt=3e3,yvt=3001,bvt=3007,vvt=3002,xvt=3004,wvt=3005,_vt=3006,Svt=7680,kvt=35044,Tvt=35048,Evt="300 es";function Mvt(){}Object.assign(Mvt.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});const Cvt=[];for(let t=0;t<256;t++)Cvt[t]=(t<16?"0":"")+t.toString(16);let Avt=1234567;const Nvt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Cvt[255&t]+Cvt[t>>8&255]+Cvt[t>>16&255]+Cvt[t>>24&255]+"-"+Cvt[255&e]+Cvt[e>>8&255]+"-"+Cvt[e>>16&15|64]+Cvt[e>>24&255]+"-"+Cvt[63&n|128]+Cvt[n>>8&255]+"-"+Cvt[n>>16&255]+Cvt[n>>24&255]+Cvt[255&r]+Cvt[r>>8&255]+Cvt[r>>16&255]+Cvt[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},damp:function(t,e,n,r){return Nvt.lerp(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(Nvt.euclideanModulo(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Avt=t%2147483647),Avt=16807*Avt%2147483647,(Avt-1)/2147483646},degToRad:function(t){return t*Nvt.DEG2RAD},radToDeg:function(t){return t*Nvt.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Ivt{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class $vt{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],b=r[4],v=r[7],x=r[2],w=r[5],_=r[8];return i[0]=s*f+o*y+a*x,i[3]=s*m+o*b+a*w,i[6]=s*g+o*v+a*_,i[1]=l*f+c*y+u*x,i[4]=l*m+c*b+u*w,i[7]=l*g+c*v+u*_,i[2]=h*f+d*y+p*x,i[5]=h*m+d*b+p*w,i[8]=h*g+d*v+p*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}let Rvt;const Ovt={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Rvt&&(Rvt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Rvt.width=t.width,Rvt.height=t.height;const n=Rvt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Rvt}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let Pvt=0;function Lvt(t=Lvt.DEFAULT_IMAGE,e=Lvt.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,o=1023,a=1009,l=1,c=3e3){Object.defineProperty(this,"id",{value:Pvt++}),this.uuid=Nvt.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Ivt(0,0),this.repeat=new Ivt(1,1),this.center=new Ivt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $vt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}function Dvt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Ovt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Lvt.DEFAULT_IMAGE=void 0,Lvt.DEFAULT_MAPPING=Ebt,Lvt.prototype=Object.assign(Object.create(Mvt.prototype),{constructor:Lvt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Nvt.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Dvt(r[t].image)):e.push(Dvt(r[t]))}else e=Dvt(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==Ebt)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Rbt:t.x=t.x-Math.floor(t.x);break;case Obt:t.x=t.x<0?0:1;break;case Pbt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Rbt:t.y=t.y-Math.floor(t.y);break;case Obt:t.y=t.y<0?0:1;break;case Pbt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Lvt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Fvt{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,y=(g+1)/2,b=(c+h)/4,v=(u+f)/4,x=(p+m)/4;return t>a&&t>y?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=b/n,i=v/n):a>y?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=b/r,i=x/r):y<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=v/i,r=x/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class zvt extends Mvt{constructor(t,e,n){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=t,this.height=e,this.scissor=new Fvt(0,0,t,e),this.scissorTest=!1,this.viewport=new Fvt(0,0,t,e),n=n||{},this.texture=new Lvt(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:zbt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setSize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Bvt{constructor(t=0,e=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return n.copy(t).slerp(e,r)}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(u!==f||a!==h||l!==d||c!==p){let t=1-o;const e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Nvt.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Uvt{constructor(t=0,e=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(jvt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(jvt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Vvt.copy(this).projectOnVector(t),this.sub(Vvt)}reflect(t){return this.sub(Vvt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Nvt.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Vvt=new Uvt,jvt=new Bvt;class Wvt{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Uvt(1/0,1/0,1/0),this.max=void 0!==e?e:new Uvt(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=qvt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Uvt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Uvt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Xvt.copy(e.boundingBox),Xvt.applyMatrix4(t.matrixWorld),this.union(Xvt));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Uvt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,qvt),qvt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ext),nxt.subVectors(this.max,ext),Yvt.subVectors(t.a,ext),Kvt.subVectors(t.b,ext),Zvt.subVectors(t.c,ext),Jvt.subVectors(Kvt,Yvt),Qvt.subVectors(Zvt,Kvt),txt.subVectors(Yvt,Zvt);let e=[0,-Jvt.z,Jvt.y,0,-Qvt.z,Qvt.y,0,-txt.z,txt.y,Jvt.z,0,-Jvt.x,Qvt.z,0,-Qvt.x,txt.z,0,-txt.x,-Jvt.y,Jvt.x,0,-Qvt.y,Qvt.x,0,-txt.y,txt.x,0];return!!Hvt(e,Yvt,Kvt,Zvt,nxt)&&(e=[1,0,0,0,1,0,0,0,1],!!Hvt(e,Yvt,Kvt,Zvt,nxt)&&(rxt.crossVectors(Jvt,Qvt),e=[rxt.x,rxt.y,rxt.z],Hvt(e,Yvt,Kvt,Zvt,nxt)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Uvt),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return qvt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(qvt).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Gvt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Gvt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Gvt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Gvt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Gvt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Gvt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Gvt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Gvt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Gvt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function Hvt(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){ixt.fromArray(t,s);const o=i.x*Math.abs(ixt.x)+i.y*Math.abs(ixt.y)+i.z*Math.abs(ixt.z),a=e.dot(ixt),l=n.dot(ixt),c=r.dot(ixt);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Gvt=[new Uvt,new Uvt,new Uvt,new Uvt,new Uvt,new Uvt,new Uvt,new Uvt],qvt=new Uvt,Xvt=new Wvt,Yvt=new Uvt,Kvt=new Uvt,Zvt=new Uvt,Jvt=new Uvt,Qvt=new Uvt,txt=new Uvt,ext=new Uvt,nxt=new Uvt,rxt=new Uvt,ixt=new Uvt,sxt=new Wvt;class oxt{constructor(t,e){this.center=void 0!==t?t:new Uvt,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):sxt.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Uvt),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Wvt),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const axt=new Uvt,lxt=new Uvt,cxt=new Uvt,uxt=new Uvt,hxt=new Uvt,dxt=new Uvt,pxt=new Uvt;class fxt{constructor(t,e){this.origin=void 0!==t?t:new Uvt,this.direction=void 0!==e?e:new Uvt(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Uvt),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,axt)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Uvt),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=axt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(axt.copy(this.direction).multiplyScalar(e).add(this.origin),axt.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){lxt.copy(t).add(e).multiplyScalar(.5),cxt.copy(e).sub(t).normalize(),uxt.copy(this.origin).sub(lxt);const i=.5*t.distanceTo(e),s=-this.direction.dot(cxt),o=uxt.dot(this.direction),a=-uxt.dot(cxt),l=uxt.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=i*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(cxt).multiplyScalar(h).add(lxt),d}intersectSphere(t,e){axt.subVectors(t.center,this.origin);const n=axt.dot(this.direction),r=axt.dot(axt)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r?null:((i>n||n!=n)&&(n=i),(s<r||r!=r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,axt)}intersectTriangle(t,e,n,r,i){hxt.subVectors(e,t),dxt.subVectors(n,t),pxt.crossVectors(hxt,dxt);let s,o=this.direction.dot(pxt);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}uxt.subVectors(this.origin,t);const a=s*this.direction.dot(dxt.crossVectors(uxt,dxt));if(a<0)return null;const l=s*this.direction.dot(hxt.cross(uxt));if(l<0)return null;if(a+l>o)return null;const c=-s*uxt.dot(pxt);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class mxt{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new mxt).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/gxt.setFromMatrixColumn(t,0).length(),i=1/gxt.setFromMatrixColumn(t,1).length(),s=1/gxt.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(bxt,t,vxt)}lookAt(t,e,n){const r=this.elements;return _xt.subVectors(t,e),0===_xt.lengthSq()&&(_xt.z=1),_xt.normalize(),xxt.crossVectors(n,_xt),0===xxt.lengthSq()&&(1===Math.abs(n.z)?_xt.x+=1e-4:_xt.z+=1e-4,_xt.normalize(),xxt.crossVectors(n,_xt)),xxt.normalize(),wxt.crossVectors(_xt,xxt),r[0]=xxt.x,r[4]=wxt.x,r[8]=_xt.x,r[1]=xxt.y,r[5]=wxt.y,r[9]=_xt.y,r[2]=xxt.z,r[6]=wxt.z,r[10]=_xt.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],b=n[7],v=n[11],x=n[15],w=r[0],_=r[4],S=r[8],k=r[12],T=r[1],E=r[5],M=r[9],C=r[13],A=r[2],N=r[6],I=r[10],$=r[14],R=r[3],O=r[7],P=r[11],L=r[15];return i[0]=s*w+o*T+a*A+l*R,i[4]=s*_+o*E+a*N+l*O,i[8]=s*S+o*M+a*I+l*P,i[12]=s*k+o*C+a*$+l*L,i[1]=c*w+u*T+h*A+d*R,i[5]=c*_+u*E+h*N+d*O,i[9]=c*S+u*M+h*I+d*P,i[13]=c*k+u*C+h*$+d*L,i[2]=p*w+f*T+m*A+g*R,i[6]=p*_+f*E+m*N+g*O,i[10]=p*S+f*M+m*I+g*P,i[14]=p*k+f*C+m*$+g*L,i[3]=y*w+b*T+v*A+x*R,i[7]=y*_+b*E+v*N+x*O,i[11]=y*S+b*M+v*I+x*P,i[15]=y*k+b*C+v*$+x*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*d-i*s*u+n*s*d+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,b=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,v=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,x=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,w=e*y+n*b+r*v+i*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/w;return t[0]=y*_,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*_,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*_,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*d-n*a*d)*_,t[4]=b*_,t[5]=(c*m*i-p*h*i+p*r*d-e*m*d-c*r*g+e*h*g)*_,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*_,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*d+e*a*d)*_,t[8]=v*_,t[9]=(p*u*i-c*f*i-p*n*d+e*f*d+c*n*g-e*u*g)*_,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*_,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*d-e*o*d)*_,t[12]=x*_,t[13]=(c*f*r-p*u*r+p*n*h-e*f*h-c*n*m+e*u*m)*_,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*_,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*_,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,d=i*c,p=i*u,f=s*c,m=s*u,g=o*u,y=a*l,b=a*c,v=a*u,x=n.x,w=n.y,_=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+v)*x,r[2]=(p-b)*x,r[3]=0,r[4]=(d-v)*w,r[5]=(1-(h+g))*w,r[6]=(m+y)*w,r[7]=0,r[8]=(p+b)*_,r[9]=(m-y)*_,r[10]=(1-(h+f))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=gxt.set(r[0],r[1],r[2]).length();const s=gxt.set(r[4],r[5],r[6]).length(),o=gxt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],yxt.copy(this);const a=1/i,l=1/s,c=1/o;return yxt.elements[0]*=a,yxt.elements[1]*=a,yxt.elements[2]*=a,yxt.elements[4]*=l,yxt.elements[5]*=l,yxt.elements[6]*=l,yxt.elements[8]*=c,yxt.elements[9]*=c,yxt.elements[10]*=c,e.setFromRotationMatrix(yxt),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),d=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,i,s){const o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,d=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const gxt=new Uvt,yxt=new mxt,bxt=new Uvt(0,0,0),vxt=new Uvt(1,1,1),xxt=new Uvt,wxt=new Uvt,_xt=new Uvt;class Sxt{constructor(t=0,e=0,n=0,r=Sxt.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const r=Nvt.clamp,i=t.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return kxt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(kxt,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return Txt.setFromEuler(this),this.setFromQuaternion(Txt,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Uvt(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Sxt.DefaultOrder="XYZ",Sxt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const kxt=new mxt,Txt=new Bvt;class Ext{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Mxt=0;const Cxt=new Uvt,Axt=new Bvt,Nxt=new mxt,Ixt=new Uvt,$xt=new Uvt,Rxt=new Uvt,Oxt=new Bvt,Pxt=new Uvt(1,0,0),Lxt=new Uvt(0,1,0),Dxt=new Uvt(0,0,1),Fxt={type:"added"},zxt={type:"removed"};function Bxt(){Object.defineProperty(this,"id",{value:Mxt++}),this.uuid=Nvt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Bxt.DefaultUp.clone();const t=new Uvt,e=new Sxt,n=new Bvt,r=new Uvt(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new mxt},normalMatrix:{value:new $vt}}),this.matrix=new mxt,this.matrixWorld=new mxt,this.matrixAutoUpdate=Bxt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ext,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Bxt.DefaultUp=new Uvt(0,1,0),Bxt.DefaultMatrixAutoUpdate=!0,Bxt.prototype=Object.assign(Object.create(Mvt.prototype),{constructor:Bxt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Axt.setFromAxisAngle(t,e),this.quaternion.multiply(Axt),this},rotateOnWorldAxis:function(t,e){return Axt.setFromAxisAngle(t,e),this.quaternion.premultiply(Axt),this},rotateX:function(t){return this.rotateOnAxis(Pxt,t)},rotateY:function(t){return this.rotateOnAxis(Lxt,t)},rotateZ:function(t){return this.rotateOnAxis(Dxt,t)},translateOnAxis:function(t,e){return Cxt.copy(t).applyQuaternion(this.quaternion),this.position.add(Cxt.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Pxt,t)},translateY:function(t){return this.translateOnAxis(Lxt,t)},translateZ:function(t){return this.translateOnAxis(Dxt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Nxt.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?Ixt.copy(t):Ixt.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),$xt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Nxt.lookAt($xt,Ixt,this.up):Nxt.lookAt(Ixt,$xt,this.up),this.quaternion.setFromRotationMatrix(Nxt),r&&(Nxt.extractRotation(r.matrixWorld),Axt.setFromRotationMatrix(Nxt),this.quaternion.premultiply(Axt.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Fxt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(zxt)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(zxt)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Nxt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Nxt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Nxt),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Uvt),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Bvt),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($xt,t,Rxt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Uvt),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($xt,Oxt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Uvt),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}});const Uxt=new Uvt,Vxt=new Uvt,jxt=new $vt;class Wxt{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Uvt(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Uxt.subVectors(n,e).cross(Vxt.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Uvt),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Uvt);const n=t.delta(Uxt),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Uvt),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||jxt.getNormalMatrix(t),r=this.coplanarPoint(Uxt).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const Hxt=new Uvt,Gxt=new Uvt,qxt=new Uvt,Xxt=new Uvt,Yxt=new Uvt,Kxt=new Uvt,Zxt=new Uvt,Jxt=new Uvt,Qxt=new Uvt,twt=new Uvt;class ewt{constructor(t,e,n){this.a=void 0!==t?t:new Uvt,this.b=void 0!==e?e:new Uvt,this.c=void 0!==n?n:new Uvt}static getNormal(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Uvt),r.subVectors(n,e),Hxt.subVectors(t,e),r.cross(Hxt);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Hxt.subVectors(r,e),Gxt.subVectors(n,e),qxt.subVectors(t,e);const s=Hxt.dot(Hxt),o=Hxt.dot(Gxt),a=Hxt.dot(qxt),l=Gxt.dot(Gxt),c=Gxt.dot(qxt),u=s*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Uvt),0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,Xxt),Xxt.x>=0&&Xxt.y>=0&&Xxt.x+Xxt.y<=1}static getUV(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,Xxt),a.set(0,0),a.addScaledVector(i,Xxt.x),a.addScaledVector(s,Xxt.y),a.addScaledVector(o,Xxt.z),a}static isFrontFacing(t,e,n,r){return Hxt.subVectors(n,e),Gxt.subVectors(t,e),Hxt.cross(Gxt).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Hxt.subVectors(this.c,this.b),Gxt.subVectors(this.a,this.b),.5*Hxt.cross(Gxt).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Uvt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ewt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Wxt),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ewt.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return ewt.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return ewt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ewt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Uvt);const n=this.a,r=this.b,i=this.c;let s,o;Yxt.subVectors(r,n),Kxt.subVectors(i,n),Jxt.subVectors(t,n);const a=Yxt.dot(Jxt),l=Kxt.dot(Jxt);if(a<=0&&l<=0)return e.copy(n);Qxt.subVectors(t,r);const c=Yxt.dot(Qxt),u=Kxt.dot(Qxt);if(c>=0&&u<=c)return e.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(Yxt,s);twt.subVectors(t,i);const d=Yxt.dot(twt),p=Kxt.dot(twt);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(Kxt,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Zxt.subVectors(i,r),o=(u-c)/(u-c+(d-p)),e.copy(r).addScaledVector(Zxt,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(Yxt,s).addScaledVector(Kxt,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const nwt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rwt={h:0,s:0,l:0},iwt={h:0,s:0,l:0};function swt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function owt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function awt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class lwt{constructor(t,e,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Nvt.euclideanModulo(t,1),e=Nvt.clamp(e,0,1),n=Nvt.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=swt(i,r,t+1/3),this.g=swt(i,r,t),this.b=swt(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=nwt[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=owt(t.r),this.g=owt(t.g),this.b=owt(t.b),this}copyLinearToSRGB(t){return this.r=awt(t.r),this.g=awt(t.g),this.b=awt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),s=Math.min(e,n,r);let o,a;const l=(s+i)/2;if(s===i)o=0,a=0;else{const t=i-s;switch(a=l<=.5?t/(i+s):t/(2-i-s),i){case e:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-e)/t+2;break;case r:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(rwt),rwt.h+=t,rwt.s+=e,rwt.l+=n,this.setHSL(rwt.h,rwt.s,rwt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(rwt),t.getHSL(iwt);const n=Nvt.lerp(rwt.h,iwt.h,e),r=Nvt.lerp(rwt.s,iwt.s,e),i=Nvt.lerp(rwt.l,iwt.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}lwt.NAMES=nwt,lwt.prototype.r=1,lwt.prototype.g=1,lwt.prototype.b=1;class cwt{constructor(t,e,n,r,i,s=0){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new Uvt,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new lwt,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let uwt=0;function hwt(){Object.defineProperty(this,"id",{value:uwt++}),this.uuid=Nvt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Tbt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Svt,this.stencilZFail=Svt,this.stencilZPass=Svt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function dwt(t){hwt.call(this),this.type="MeshBasicMaterial",this.color=new lwt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}hwt.prototype=Object.assign(Object.create(Mvt.prototype),{constructor:hwt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(hwt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),dwt.prototype=Object.create(hwt.prototype),dwt.prototype.constructor=dwt,dwt.prototype.isMeshBasicMaterial=!0,dwt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const pwt=new Uvt,fwt=new Ivt;function mwt(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=kvt,this.updateRange={offset:0,count:-1},this.version=0}function gwt(t,e,n){mwt.call(this,new Int8Array(t),e,n)}function ywt(t,e,n){mwt.call(this,new Uint8Array(t),e,n)}function bwt(t,e,n){mwt.call(this,new Uint8ClampedArray(t),e,n)}function vwt(t,e,n){mwt.call(this,new Int16Array(t),e,n)}function xwt(t,e,n){mwt.call(this,new Uint16Array(t),e,n)}function wwt(t,e,n){mwt.call(this,new Int32Array(t),e,n)}function _wt(t,e,n){mwt.call(this,new Uint32Array(t),e,n)}function Swt(t,e,n){mwt.call(this,new Uint16Array(t),e,n)}function kwt(t,e,n){mwt.call(this,new Float32Array(t),e,n)}function Twt(t,e,n){mwt.call(this,new Float64Array(t),e,n)}function Ewt(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(mwt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(mwt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new lwt),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Ivt),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Uvt),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Fvt),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)fwt.fromBufferAttribute(this,e),fwt.applyMatrix3(t),this.setXY(e,fwt.x,fwt.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)pwt.fromBufferAttribute(this,e),pwt.applyMatrix3(t),this.setXYZ(e,pwt.x,pwt.y,pwt.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)pwt.x=this.getX(e),pwt.y=this.getY(e),pwt.z=this.getZ(e),pwt.applyMatrix4(t),this.setXYZ(e,pwt.x,pwt.y,pwt.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)pwt.x=this.getX(e),pwt.y=this.getY(e),pwt.z=this.getZ(e),pwt.applyNormalMatrix(t),this.setXYZ(e,pwt.x,pwt.y,pwt.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)pwt.x=this.getX(e),pwt.y=this.getY(e),pwt.z=this.getZ(e),pwt.transformDirection(t),this.setXYZ(e,pwt.x,pwt.y,pwt.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),gwt.prototype=Object.create(mwt.prototype),gwt.prototype.constructor=gwt,ywt.prototype=Object.create(mwt.prototype),ywt.prototype.constructor=ywt,bwt.prototype=Object.create(mwt.prototype),bwt.prototype.constructor=bwt,vwt.prototype=Object.create(mwt.prototype),vwt.prototype.constructor=vwt,xwt.prototype=Object.create(mwt.prototype),xwt.prototype.constructor=xwt,wwt.prototype=Object.create(mwt.prototype),wwt.prototype.constructor=wwt,_wt.prototype=Object.create(mwt.prototype),_wt.prototype.constructor=_wt,Swt.prototype=Object.create(mwt.prototype),Swt.prototype.constructor=Swt,Swt.prototype.isFloat16BufferAttribute=!0,kwt.prototype=Object.create(mwt.prototype),kwt.prototype.constructor=kwt,Twt.prototype=Object.create(mwt.prototype),Twt.prototype.constructor=Twt;const Mwt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Cwt(t,e){return new Mwt[t](e)}let Awt=0;const Nwt=new mxt,Iwt=new Bxt,$wt=new Uvt,Rwt=new Wvt,Owt=new Wvt,Pwt=new Uvt;function Lwt(){Object.defineProperty(this,"id",{value:Awt++}),this.uuid=Nvt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Lwt.prototype=Object.assign(Object.create(Mvt.prototype),{constructor:Lwt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(Ewt(t)>65535?_wt:xwt)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new $vt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Nwt.makeRotationX(t),this.applyMatrix4(Nwt),this},rotateY:function(t){return Nwt.makeRotationY(t),this.applyMatrix4(Nwt),this},rotateZ:function(t){return Nwt.makeRotationZ(t),this.applyMatrix4(Nwt),this},translate:function(t,e,n){return Nwt.makeTranslation(t,e,n),this.applyMatrix4(Nwt),this},scale:function(t,e,n){return Nwt.makeScale(t,e,n),this.applyMatrix4(Nwt),this},lookAt:function(t){return Iwt.lookAt(t),Iwt.updateMatrix(),this.applyMatrix4(Iwt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter($wt).negate(),this.translate($wt.x,$wt.y,$wt.z),this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new kwt(e,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Wvt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Uvt(-1/0,-1/0,-1/0),new Uvt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Rwt.setFromBufferAttribute(n),this.morphTargetsRelative?(Pwt.addVectors(this.boundingBox.min,Rwt.min),this.boundingBox.expandByPoint(Pwt),Pwt.addVectors(this.boundingBox.max,Rwt.max),this.boundingBox.expandByPoint(Pwt)):(this.boundingBox.expandByPoint(Rwt.min),this.boundingBox.expandByPoint(Rwt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oxt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Uvt,1/0);if(t){const n=this.boundingSphere.center;if(Rwt.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Owt.setFromBufferAttribute(n),this.morphTargetsRelative?(Pwt.addVectors(Rwt.min,Owt.min),Rwt.expandByPoint(Pwt),Pwt.addVectors(Rwt.max,Owt.max),Rwt.expandByPoint(Pwt)):(Rwt.expandByPoint(Owt.min),Rwt.expandByPoint(Owt.max))}Rwt.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Pwt.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Pwt));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)Pwt.fromBufferAttribute(s,e),o&&($wt.fromBufferAttribute(t,e),Pwt.add($wt)),r=Math.max(r,n.distanceToSquared(Pwt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,r=e.position.array,i=e.normal.array,s=e.uv.array,o=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new mwt(new Float32Array(4*o),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new Uvt,c[t]=new Uvt;const u=new Uvt,h=new Uvt,d=new Uvt,p=new Ivt,f=new Ivt,m=new Ivt,g=new Uvt,y=new Uvt;function b(t,e,n){u.fromArray(r,3*t),h.fromArray(r,3*e),d.fromArray(r,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),y.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(y),c[e].add(y),c[n].add(y))}let v=this.groups;0===v.length&&(v=[{start:0,count:n.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)b(n[t+0],n[t+1],n[t+2])}const x=new Uvt,w=new Uvt,_=new Uvt,S=new Uvt;function k(t){_.fromArray(i,3*t),S.copy(_);const e=l[t];x.copy(e),x.sub(_.multiplyScalar(_.dot(e))).normalize(),w.crossVectors(S,e);const n=w.dot(c[t])<0?-1:1;a[4*t]=x.x,a[4*t+1]=x.y,a[4*t+2]=x.z,a[4*t+3]=n}for(let t=0,e=v.length;t<e;++t){const e=v[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)k(n[t+0]),k(n[t+1]),k(n[t+2])}},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new mwt(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Uvt,i=new Uvt,s=new Uvt,o=new Uvt,a=new Uvt,l=new Uvt,c=new Uvt,u=new Uvt;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Pwt.fromBufferAttribute(t,e),Pwt.normalize(),t.setXYZ(e,Pwt.x,Pwt.y,Pwt.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let t=0,i=e.length;t<i;t++){o=e[t]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new mwt(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Lwt,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),t.data.attributes[e]=i}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.toJSON(t.data);""!==r.name&&(i.name=r.name),s.push(i)}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t},clone:function(){return(new Lwt).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Dwt=new mxt,Fwt=new fxt,zwt=new oxt,Bwt=new Uvt,Uwt=new Uvt,Vwt=new Uvt,jwt=new Uvt,Wwt=new Uvt,Hwt=new Uvt,Gwt=new Uvt,qwt=new Uvt,Xwt=new Uvt,Ywt=new Ivt,Kwt=new Ivt,Zwt=new Ivt,Jwt=new Uvt,Qwt=new Uvt;function t_t(t=new Lwt,e=new dwt){Bxt.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function e_t(t,e,n,r,i,s,o,a,l,c,u,h){Bwt.fromBufferAttribute(i,c),Uwt.fromBufferAttribute(i,u),Vwt.fromBufferAttribute(i,h);const d=t.morphTargetInfluences;if(e.morphTargets&&s&&d){Gwt.set(0,0,0),qwt.set(0,0,0),Xwt.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(jwt.fromBufferAttribute(n,c),Wwt.fromBufferAttribute(n,u),Hwt.fromBufferAttribute(n,h),o?(Gwt.addScaledVector(jwt,e),qwt.addScaledVector(Wwt,e),Xwt.addScaledVector(Hwt,e)):(Gwt.addScaledVector(jwt.sub(Bwt),e),qwt.addScaledVector(Wwt.sub(Uwt),e),Xwt.addScaledVector(Hwt.sub(Vwt),e)))}Bwt.add(Gwt),Uwt.add(qwt),Vwt.add(Xwt)}t.isSkinnedMesh&&(t.boneTransform(c,Bwt),t.boneTransform(u,Uwt),t.boneTransform(h,Vwt));const p=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,2!==e.side,a),null===l)return null;Qwt.copy(a),Qwt.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Qwt);return c<n.near||c>n.far?null:{distance:c,point:Qwt.clone(),object:t}}(t,e,n,r,Bwt,Uwt,Vwt,Jwt);if(p){a&&(Ywt.fromBufferAttribute(a,c),Kwt.fromBufferAttribute(a,u),Zwt.fromBufferAttribute(a,h),p.uv=ewt.getUV(Jwt,Bwt,Uwt,Vwt,Ywt,Kwt,Zwt,new Ivt)),l&&(Ywt.fromBufferAttribute(l,c),Kwt.fromBufferAttribute(l,u),Zwt.fromBufferAttribute(l,h),p.uv2=ewt.getUV(Jwt,Bwt,Uwt,Vwt,Ywt,Kwt,Zwt,new Ivt));const t=new cwt(c,u,h);ewt.getNormal(Bwt,Uwt,Vwt,t.normal),p.face=t}return p}t_t.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:t_t,isMesh:!0,copy:function(t){return Bxt.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),zwt.copy(n.boundingSphere),zwt.applyMatrix4(i),!1===t.ray.intersectsSphere(zwt))return;if(Dwt.copy(i).invert(),Fwt.copy(t.ray).applyMatrix4(Dwt),null!==n.boundingBox&&!1===Fwt.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);s=e_t(this,f,t,Fwt,o,a,l,c,u,r,h,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);s=e_t(this,r,t,Fwt,o,a,l,c,u,h,d,p),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){s=e_t(this,p,t,Fwt,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}}else{for(let n=Math.max(0,d.start),i=Math.min(o.count,d.start+d.count);n<i;n+=3){s=e_t(this,r,t,Fwt,o,a,l,c,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class n_t extends Lwt{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,y){const b=s/m,v=p/g,x=s/2,w=p/2,_=f/2,S=m+1,k=g+1;let T=0,E=0;const M=new Uvt;for(let s=0;s<k;s++){const o=s*v-w;for(let a=0;a<S;a++){const h=a*b-x;M[t]=h*r,M[e]=o*i,M[n]=_,l.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(d,E,y),d+=E,h+=T}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new kwt(l,3)),this.setAttribute("normal",new kwt(c,3)),this.setAttribute("uv",new kwt(u,2))}}function r_t(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function i_t(t){const e={};for(let n=0;n<t.length;n++){const r=r_t(t[n]);for(const t in r)e[t]=r[t]}return e}const s_t={clone:r_t,merge:i_t};function o_t(t){hwt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function a_t(){Bxt.call(this),this.type="Camera",this.matrixWorldInverse=new mxt,this.projectionMatrix=new mxt,this.projectionMatrixInverse=new mxt}function l_t(t=50,e=1,n=.1,r=2e3){a_t.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}o_t.prototype=Object.create(hwt.prototype),o_t.prototype.constructor=o_t,o_t.prototype.isShaderMaterial=!0,o_t.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=r_t(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},o_t.prototype.toJSON=function(t){const e=hwt.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},a_t.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:a_t,isCamera:!0,copy:function(t,e){return Bxt.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Uvt),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Bxt.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){Bxt.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),l_t.prototype=Object.assign(Object.create(a_t.prototype),{constructor:l_t,isPerspectiveCamera:!0,copy:function(t,e){return a_t.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Nvt.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Nvt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Nvt.RAD2DEG*Math.atan(Math.tan(.5*Nvt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*Nvt.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Bxt.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const c_t=90;function u_t(t,e,n){if(Bxt.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new l_t(c_t,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Uvt(1,0,0)),this.add(r);const i=new l_t(c_t,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Uvt(-1,0,0)),this.add(i);const s=new l_t(c_t,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Uvt(0,1,0)),this.add(s);const o=new l_t(c_t,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Uvt(0,-1,0)),this.add(o);const a=new l_t(c_t,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Uvt(0,0,1)),this.add(a);const l=new l_t(c_t,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Uvt(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c}}function h_t(t,e,n,r,i,s,o,a,l,c){t=void 0!==t?t:[],e=void 0!==e?e:Mbt,o=void 0!==o?o:Xbt,Lvt.call(this,t,e,n,r,i,s,o,a,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}u_t.prototype=Object.create(Bxt.prototype),u_t.prototype.constructor=u_t,h_t.prototype=Object.create(Lvt.prototype),h_t.prototype.constructor=h_t,h_t.prototype.isCubeTexture=!0,Object.defineProperty(h_t.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});class d_t extends zvt{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),e=e||{},this.texture=new h_t(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Ybt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new n_t(5,5,5),i=new o_t({name:"CubemapFromEquirect",uniforms:r_t(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const s=new t_t(r,i),o=e.minFilter;e.minFilter===Ubt&&(e.minFilter=zbt);return new u_t(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}function p_t(t,e,n,r,i,s,o,a,l,c,u,h){Lvt.call(this,null,s,o,a,l,c,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==l?l:Lbt,this.minFilter=void 0!==c?c:Lbt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}p_t.prototype=Object.create(Lvt.prototype),p_t.prototype.constructor=p_t,p_t.prototype.isDataTexture=!0;const f_t=new oxt,m_t=new Uvt;class g_t{constructor(t,e,n,r,i,s){this.planes=[void 0!==t?t:new Wxt,void 0!==e?e:new Wxt,void 0!==n?n:new Wxt,void 0!==r?r:new Wxt,void 0!==i?i:new Wxt,void 0!==s?s:new Wxt]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],y=n[14],b=n[15];return e[0].setComponents(o-r,u-a,f-h,b-m).normalize(),e[1].setComponents(o+r,u+a,f+h,b+m).normalize(),e[2].setComponents(o+i,u+l,f+d,b+g).normalize(),e[3].setComponents(o-i,u-l,f-d,b-g).normalize(),e[4].setComponents(o-s,u-c,f-p,b-y).normalize(),e[5].setComponents(o+s,u+c,f+p,b+y).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),f_t.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(f_t)}intersectsSprite(t){return f_t.center.set(0,0,0),f_t.radius=.7071067811865476,f_t.applyMatrix4(t.matrixWorld),this.intersectsSphere(f_t)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(m_t.x=r.normal.x>0?t.max.x:t.min.x,m_t.y=r.normal.y>0?t.max.y:t.min.y,m_t.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(m_t)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}function y_t(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function b_t(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=r.get(e);void 0===s?r.set(e,function(e,r){const i=e.array,s=e.usage,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,i,s),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):s.version<e.version&&(!function(e,r,i){const s=r.array,o=r.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,s):(n?t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,i),s.version=e.version)}}}class v_t extends Lwt{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,c=a+1,u=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*h-s;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new kwt(p,3)),this.setAttribute("normal",new kwt(f,3)),this.setAttribute("uv",new kwt(m,2))}}const x_t={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},w_t={common:{diffuse:{value:new lwt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new $vt},uv2Transform:{value:new $vt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ivt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new lwt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new lwt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $vt}},sprite:{diffuse:{value:new lwt(15658734)},opacity:{value:1},center:{value:new Ivt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $vt}}},__t={basic:{uniforms:i_t([w_t.common,w_t.specularmap,w_t.envmap,w_t.aomap,w_t.lightmap,w_t.fog]),vertexShader:x_t.meshbasic_vert,fragmentShader:x_t.meshbasic_frag},lambert:{uniforms:i_t([w_t.common,w_t.specularmap,w_t.envmap,w_t.aomap,w_t.lightmap,w_t.emissivemap,w_t.fog,w_t.lights,{emissive:{value:new lwt(0)}}]),vertexShader:x_t.meshlambert_vert,fragmentShader:x_t.meshlambert_frag},phong:{uniforms:i_t([w_t.common,w_t.specularmap,w_t.envmap,w_t.aomap,w_t.lightmap,w_t.emissivemap,w_t.bumpmap,w_t.normalmap,w_t.displacementmap,w_t.fog,w_t.lights,{emissive:{value:new lwt(0)},specular:{value:new lwt(1118481)},shininess:{value:30}}]),vertexShader:x_t.meshphong_vert,fragmentShader:x_t.meshphong_frag},standard:{uniforms:i_t([w_t.common,w_t.envmap,w_t.aomap,w_t.lightmap,w_t.emissivemap,w_t.bumpmap,w_t.normalmap,w_t.displacementmap,w_t.roughnessmap,w_t.metalnessmap,w_t.fog,w_t.lights,{emissive:{value:new lwt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:x_t.meshphysical_vert,fragmentShader:x_t.meshphysical_frag},toon:{uniforms:i_t([w_t.common,w_t.aomap,w_t.lightmap,w_t.emissivemap,w_t.bumpmap,w_t.normalmap,w_t.displacementmap,w_t.gradientmap,w_t.fog,w_t.lights,{emissive:{value:new lwt(0)}}]),vertexShader:x_t.meshtoon_vert,fragmentShader:x_t.meshtoon_frag},matcap:{uniforms:i_t([w_t.common,w_t.bumpmap,w_t.normalmap,w_t.displacementmap,w_t.fog,{matcap:{value:null}}]),vertexShader:x_t.meshmatcap_vert,fragmentShader:x_t.meshmatcap_frag},points:{uniforms:i_t([w_t.points,w_t.fog]),vertexShader:x_t.points_vert,fragmentShader:x_t.points_frag},dashed:{uniforms:i_t([w_t.common,w_t.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:x_t.linedashed_vert,fragmentShader:x_t.linedashed_frag},depth:{uniforms:i_t([w_t.common,w_t.displacementmap]),vertexShader:x_t.depth_vert,fragmentShader:x_t.depth_frag},normal:{uniforms:i_t([w_t.common,w_t.bumpmap,w_t.normalmap,w_t.displacementmap,{opacity:{value:1}}]),vertexShader:x_t.normal_vert,fragmentShader:x_t.normal_frag},sprite:{uniforms:i_t([w_t.sprite,w_t.fog]),vertexShader:x_t.sprite_vert,fragmentShader:x_t.sprite_frag},background:{uniforms:{uvTransform:{value:new $vt},t2D:{value:null}},vertexShader:x_t.background_vert,fragmentShader:x_t.background_frag},cube:{uniforms:i_t([w_t.envmap,{opacity:{value:1}}]),vertexShader:x_t.cube_vert,fragmentShader:x_t.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:x_t.equirect_vert,fragmentShader:x_t.equirect_frag},distanceRGBA:{uniforms:i_t([w_t.common,w_t.displacementmap,{referencePosition:{value:new Uvt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:x_t.distanceRGBA_vert,fragmentShader:x_t.distanceRGBA_frag},shadow:{uniforms:i_t([w_t.lights,w_t.fog,{color:{value:new lwt(0)},opacity:{value:1}}]),vertexShader:x_t.shadow_vert,fragmentShader:x_t.shadow_frag}};function S_t(t,e,n,r,i){const s=new lwt(0);let o,a,l=0,c=null,u=0,h=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(s,l)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?d(s,l):m&&m.isColor&&(d(m,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===Ibt)?(void 0===a&&(a=new t_t(new n_t(1,1,1),new o_t({name:"BackgroundCubeMaterial",uniforms:r_t(__t.cube.uniforms),vertexShader:__t.cube.vertexShader,fragmentShader:__t.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,c===m&&u===m.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=m,u=m.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new t_t(new v_t(2,2),new o_t({name:"BackgroundMaterial",uniforms:r_t(__t.background.uniforms),vertexShader:__t.background.vertexShader,fragmentShader:__t.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&u===m.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=m,u=m.version,h=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function k_t(t,e,n,r){const i=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=d(null);let c=l;function u(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function d(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function p(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==i){(r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function g(){const e=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function y(e,n,i,s,o,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,s,o,a):t.vertexAttribIPointer(e,n,i,o,a)}function b(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,b,v){let x=!1;if(o){const e=function(e,n,i){const o=!0===i.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];void 0===u&&(u=d(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u);return u}(b,h,l);c!==e&&(c=e,u(c.object)),x=function(t,e){const n=c.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],s=r[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;i++}return c.attributesNum!==i||c.index!==e}(b,v),x&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,i++}c.attributes=n,c.attributesNum=i,c.index=e}(b,v)}else{const t=!0===l.wireframe;c.geometry===b.id&&c.program===h.id&&c.wireframe===t||(c.geometry=b.id,c.program=h.id,c.wireframe=t,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==v&&n.update(v,34963),x&&(!function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const r=c[e];if(r>=0){const s=l[e];if(void 0!==s){const e=s.normalized,i=s.itemSize,o=n.get(s);if(void 0===o)continue;const l=o.buffer,c=o.type,u=o.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,o=n.stride,h=s.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),t.bindBuffer(34962,l),y(r,i,c,e,o*u,h*u)}else s.isInstancedBufferAttribute?(m(r,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):f(r),t.bindBuffer(34962,l),y(r,i,c,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const s=e.buffer,o=e.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),t.bindBuffer(34962,s),t.vertexAttribPointer(r+0,4,o,!1,64,0),t.vertexAttribPointer(r+1,4,o,!1,64,16),t.vertexAttribPointer(r+2,4,o,!1,64,32),t.vertexAttribPointer(r+3,4,o,!1,64,48)}else if("instanceColor"===e){const e=n.get(i.instanceColor);if(void 0===e)continue;const s=e.buffer,o=e.type;m(r,1),t.bindBuffer(34962,s),t.vertexAttribPointer(r,3,o,!1,12,0)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}g()}(i,l,h,b),null!==v&&t.bindBuffer(34963,n.get(v).buffer))},reset:b,resetDefaultState:v,dispose:function(){b();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)h(r[t].object),delete r[t];delete n[t.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function T_t(t,e,n,r){const i=r.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,r){t.drawArrays(s,e,r),n.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(i)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),n.update(o,s,a)}}function E_t(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),y=u>0,b=s||!!e.get("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:s?t.getParameter(36183):0}}function M_t(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Wxt,a=new $vt,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=r;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(i,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==r||i;return i=e,n=u(t,s,0),r=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||s&&!p)s?u(null):c();else{const t=s?0:r,e=4*t;let i=f.clippingState||null;l.value=i,i=u(h,o,e,a);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function C_t(t){let e=new WeakMap;function n(t,e){return e===Abt?t.mapping=Mbt:e===Nbt&&(t.mapping=Cbt),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(s===Abt||s===Nbt){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=t.getRenderList(),a=t.getRenderTarget(),l=new d_t(s.height/2);return l.fromEquirectangularTexture(t,i),e.set(i,l),t.setRenderTarget(a),t.setRenderList(o),i.addEventListener("dispose",r),n(l.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}function A_t(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function N_t(t,e,n,r){const i={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(Ewt(n)>65535?_wt:xwt)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function I_t(t,e,n,r){const i=r.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(s,r,o,e*a),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,r*a,c),n.update(l,s,c)}}function $_t(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function R_t(t,e){return t[0]-e[0]}function O_t(t,e){return Math.abs(e[1])-Math.abs(t[1])}function P_t(t){const e={},n=new Float32Array(8),r=[];for(let t=0;t<8;t++)r[t]=[t,0];return{update:function(i,s,o,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=e[s.id];if(void 0===u){u=[];for(let t=0;t<c;t++)u[t]=[t,0];e[s.id]=u}for(let t=0;t<c;t++){const e=u[t];e[0]=t,e[1]=l[t]}u.sort(O_t);for(let t=0;t<8;t++)t<c&&u[t][1]?(r[t][0]=u[t][0],r[t][1]=u[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(R_t);const h=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal;let p=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],o=e[1];i!==Number.MAX_SAFE_INTEGER&&o?(h&&s.getAttribute("morphTarget"+t)!==h[i]&&s.setAttribute("morphTarget"+t,h[i]),d&&s.getAttribute("morphNormal"+t)!==d[i]&&s.setAttribute("morphNormal"+t,d[i]),n[t]=o,p+=o):(h&&!0===s.hasAttribute("morphTarget"+t)&&s.deleteAttribute("morphTarget"+t),d&&!0===s.hasAttribute("morphNormal"+t)&&s.deleteAttribute("morphNormal"+t),n[t]=0)}const f=s.morphTargetsRelative?1:1-p;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function L_t(t,e,n,r){let i=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=r.render.frame,a=t.geometry,l=e.get(t,a);return i.get(l)!==o&&(e.update(l),i.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}function D_t(t=null,e=1,n=1,r=1){Lvt.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Lbt,this.minFilter=Lbt,this.wrapR=Obt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function F_t(t=null,e=1,n=1,r=1){Lvt.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Lbt,this.minFilter=Lbt,this.wrapR=Obt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}__t.physical={uniforms:i_t([__t.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ivt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new lwt(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:x_t.meshphysical_vert,fragmentShader:x_t.meshphysical_frag},D_t.prototype=Object.create(Lvt.prototype),D_t.prototype.constructor=D_t,D_t.prototype.isDataTexture2DArray=!0,F_t.prototype=Object.create(Lvt.prototype),F_t.prototype.constructor=F_t,F_t.prototype.isDataTexture3D=!0;const z_t=new Lvt,B_t=new D_t,U_t=new F_t,V_t=new h_t,j_t=[],W_t=[],H_t=new Float32Array(16),G_t=new Float32Array(9),q_t=new Float32Array(4);function X_t(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=j_t[i];if(void 0===s&&(s=new Float32Array(i),j_t[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function Y_t(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function K_t(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Z_t(t,e){let n=W_t[e];void 0===n&&(n=new Int32Array(e),W_t[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function J_t(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Q_t(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Y_t(n,e))return;t.uniform2fv(this.addr,e),K_t(n,e)}}function tSt(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Y_t(n,e))return;t.uniform3fv(this.addr,e),K_t(n,e)}}function eSt(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Y_t(n,e))return;t.uniform4fv(this.addr,e),K_t(n,e)}}function nSt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Y_t(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),K_t(n,e)}else{if(Y_t(n,r))return;q_t.set(r),t.uniformMatrix2fv(this.addr,!1,q_t),K_t(n,r)}}function rSt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Y_t(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),K_t(n,e)}else{if(Y_t(n,r))return;G_t.set(r),t.uniformMatrix3fv(this.addr,!1,G_t),K_t(n,r)}}function iSt(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Y_t(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),K_t(n,e)}else{if(Y_t(n,r))return;H_t.set(r),t.uniformMatrix4fv(this.addr,!1,H_t),K_t(n,r)}}function sSt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||z_t,i)}function oSt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||B_t,i)}function aSt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||U_t,i)}function lSt(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||V_t,i)}function cSt(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function uSt(t,e){const n=this.cache;Y_t(n,e)||(t.uniform2iv(this.addr,e),K_t(n,e))}function hSt(t,e){const n=this.cache;Y_t(n,e)||(t.uniform3iv(this.addr,e),K_t(n,e))}function dSt(t,e){const n=this.cache;Y_t(n,e)||(t.uniform4iv(this.addr,e),K_t(n,e))}function pSt(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function fSt(t,e){t.uniform1fv(this.addr,e)}function mSt(t,e){t.uniform1iv(this.addr,e)}function gSt(t,e){t.uniform2iv(this.addr,e)}function ySt(t,e){t.uniform3iv(this.addr,e)}function bSt(t,e){t.uniform4iv(this.addr,e)}function vSt(t,e){const n=X_t(e,this.size,2);t.uniform2fv(this.addr,n)}function xSt(t,e){const n=X_t(e,this.size,3);t.uniform3fv(this.addr,n)}function wSt(t,e){const n=X_t(e,this.size,4);t.uniform4fv(this.addr,n)}function _St(t,e){const n=X_t(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function SSt(t,e){const n=X_t(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function kSt(t,e){const n=X_t(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function TSt(t,e,n){const r=e.length,i=Z_t(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTexture2D(e[t]||z_t,i[t])}function ESt(t,e,n){const r=e.length,i=Z_t(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.safeSetTextureCube(e[t]||V_t,i[t])}function MSt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return J_t;case 35664:return Q_t;case 35665:return tSt;case 35666:return eSt;case 35674:return nSt;case 35675:return rSt;case 35676:return iSt;case 5124:case 35670:return cSt;case 35667:case 35671:return uSt;case 35668:case 35672:return hSt;case 35669:case 35673:return dSt;case 5125:return pSt;case 35678:case 36198:case 36298:case 36306:case 35682:return sSt;case 35679:case 36299:case 36307:return aSt;case 35680:case 36300:case 36308:case 36293:return lSt;case 36289:case 36303:case 36311:case 36292:return oSt}}(e.type)}function CSt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return fSt;case 35664:return vSt;case 35665:return xSt;case 35666:return wSt;case 35674:return _St;case 35675:return SSt;case 35676:return kSt;case 5124:case 35670:return mSt;case 35667:case 35671:return gSt;case 35668:case 35672:return ySt;case 35669:case 35673:return bSt;case 35678:case 36198:case 36298:case 36306:case 35682:return TSt;case 35680:case 36300:case 36308:case 36293:return ESt}}(e.type)}function ASt(t){this.id=t,this.seq=[],this.map={}}CSt.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),K_t(e,t)},ASt.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}};const NSt=/(\w+)(\])?(\[|\.)?/g;function ISt(t,e){t.seq.push(e),t.map[e.id]=e}function $St(t,e,n){const r=t.name,i=r.length;for(NSt.lastIndex=0;;){const s=NSt.exec(r),o=NSt.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){ISt(n,void 0===c?new MSt(a,t,e):new CSt(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new ASt(a),ISt(n,t)),n=t}}}function RSt(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);$St(n,t.getUniformLocation(e,n.name),this)}}function OSt(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}RSt.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},RSt.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},RSt.upload=function(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},RSt.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let PSt=0;function LSt(t){switch(t){case gvt:return["Linear","( value )"];case yvt:return["sRGB","( value )"];case vvt:return["RGBE","( value )"];case xvt:return["RGBM","( value, 7.0 )"];case wvt:return["RGBM","( value, 16.0 )"];case _vt:return["RGBD","( value, 256.0 )"];case bvt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function DSt(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function FSt(t,e){const n=LSt(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function zSt(t,e){const n=LSt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function BSt(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function USt(t){return""!==t}function VSt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function jSt(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const WSt=/^[ \t]*#include +<([\w\d./]+)>/gm;function HSt(t){return t.replace(WSt,GSt)}function GSt(t,e){const n=x_t[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return HSt(n)}const qSt=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,XSt=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function YSt(t){return t.replace(XSt,ZSt).replace(qSt,KSt)}function KSt(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ZSt(t,e,n,r)}function ZSt(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function JSt(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function QSt(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Mbt:case Cbt:e="ENVMAP_TYPE_CUBE";break;case Ibt:case $bt:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Cbt:case $bt:e="ENVMAP_MODE_REFRACTION"}return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(USt).join("\n")}(n),f=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),m=i.createProgram();let g,y,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(USt).join("\n"),g.length>0&&(g+="\n"),y=[p,f].filter(USt).join("\n"),y.length>0&&(y+="\n")):(g=[JSt(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(USt).join("\n"),y=[p,JSt(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?x_t.tonemapping_pars_fragment:"",0!==n.toneMapping?BSt("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",x_t.encodings_pars_fragment,n.map?FSt("mapTexelToLinear",n.mapEncoding):"",n.matcap?FSt("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?FSt("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?FSt("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?FSt("lightMapTexelToLinear",n.lightMapEncoding):"",zSt("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(USt).join("\n")),o=HSt(o),o=VSt(o,n),o=jSt(o,n),a=HSt(a),a=VSt(a,n),a=jSt(a,n),o=YSt(o),a=YSt(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",n.glslVersion===Evt?"":"out highp vec4 pc_fragColor;",n.glslVersion===Evt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const v=b+y+a,x=OSt(i,35633,b+g+o),w=OSt(i,35632,v);if(i.attachShader(m,x),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(m).trim(),e=i.getShaderInfoLog(x).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,s=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const e=DSt(i,x,"vertex"),n=DSt(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:y}})}let _,S;return i.deleteShader(x),i.deleteShader(w),this.getUniforms=function(){return void 0===_&&(_=new RSt(i,m)),_},this.getAttributes=function(){return void 0===S&&(S=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(i,m)),S},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=PSt++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}function tkt(t,e,n,r,i,s){const o=[],a=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=gvt,e}return{getParameters:function(i,o,f,g,y){const b=g.fog,v=i.isMeshStandardMaterial?g.environment:null,x=e.get(i.envMap||v),w=p[i.type],_=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=u,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(y):0;let S,k;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),w){const t=__t[w];S=t.vertexShader,k=t.fragmentShader}else S=i.vertexShader,k=i.fragmentShader;const T=t.getRenderTarget();return{isWebGL2:a,shaderID:w,shaderName:i.type,vertexShader:S,fragmentShader:k,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:h,outputEncoding:null!==T?m(T.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===Ibt||x.mapping===$bt),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&_>0,maxBones:_,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)n.push(e[f[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=p[t.type];let n;if(e){const t=__t[e];n=s_t.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=o.length;t<e;t++){const e=o[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new QSt(t,n,e,i),o.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=o.indexOf(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function ekt(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function nkt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function rkt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ikt(t){const e=[];let n=0;const r=[],i=[],s={id:-1};function o(r,i,o,a,l,c){let u=e[n];const h=t.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).push(c)},unshift:function(t,e,n,s,a,l){const c=o(t,e,n,s,a,l);(!0===n.transparent?i:r).unshift(c)},finish:function(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){r.length>1&&r.sort(t||nkt),i.length>1&&i.sort(e||rkt)}}}function skt(t){let e=new WeakMap;return{get:function(n,r){const i=e.get(n);let s;return void 0===i?(s=new ikt(t),e.set(n,new WeakMap),e.get(n).set(r,s)):(s=i.get(r),void 0===s&&(s=new ikt(t),i.set(r,s))),s},dispose:function(){e=new WeakMap}}}function okt(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Uvt,color:new lwt};break;case"SpotLight":n={position:new Uvt,direction:new Uvt,color:new lwt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Uvt,color:new lwt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Uvt,skyColor:new lwt,groundColor:new lwt};break;case"RectAreaLight":n={color:new lwt,position:new Uvt,halfWidth:new Uvt,halfHeight:new Uvt}}return t[e.id]=n,n}}}let akt=0;function lkt(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function ckt(t,e){const n=new okt,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ivt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ivt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Uvt);const s=new Uvt,o=new mxt,a=new mxt;return{setup:function(s){let o=0,a=0,l=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;s.sort(lkt);for(let t=0,e=s.length;t<e;t++){const e=s[t],y=e.color,b=e.intensity,v=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=y.r*b,a+=y.g*b,l+=y.b*b;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],b);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=x,i.directionalShadowMatrix[c]=e.shadow.matrix,f++}i.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(y).multiplyScalar(b),t.distance=v,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=e.shadow.matrix,g++}i.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(y).multiplyScalar(b),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[d]=t,d++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=e.shadow.matrix,m++}i.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(b),t.groundColor.copy(e.groundColor).multiplyScalar(b),i.hemi[p]=t,p++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=w_t.LTC_FLOAT_1,i.rectAreaLTC2=w_t.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=w_t.LTC_HALF_1,i.rectAreaLTC2=w_t.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=a,i.ambient[2]=l;const y=i.hash;y.directionalLength===c&&y.pointLength===u&&y.spotLength===h&&y.rectAreaLength===d&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===m&&y.numSpotShadows===g||(i.directional.length=c,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,y.directionalLength=c,y.pointLength=u,y.spotLength=h,y.rectAreaLength=d,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=m,y.numSpotShadows=g,i.version=akt++)},setupView:function(t,e){let n=0,r=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function ukt(t,e){const n=new ckt(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function hkt(t,e){let n=new WeakMap;return{get:function(r,i=0){let s;return!1===n.has(r)?(s=new ukt(t,e),n.set(r,[]),n.get(r).push(s)):i>=n.get(r).length?(s=new ukt(t,e),n.get(r).push(s)):s=n.get(r)[i],s},dispose:function(){n=new WeakMap}}}function dkt(t){hwt.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function pkt(t){hwt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Uvt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}dkt.prototype=Object.create(hwt.prototype),dkt.prototype.constructor=dkt,dkt.prototype.isMeshDepthMaterial=!0,dkt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},pkt.prototype=Object.create(hwt.prototype),pkt.prototype.constructor=pkt,pkt.prototype.isMeshDistanceMaterial=!0,pkt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function fkt(t,e,n){let r=new g_t;const i=new Ivt,s=new Ivt,o=new Fvt,a=[],l=[],c={},u={0:1,1:0,2:2},h=new o_t({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ivt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new Lwt;p.setAttribute("position",new mwt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new t_t(p,h),m=this;function g(n,r){const i=e.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,f,null)}function y(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new dkt({depthPacking:3201,morphTargets:t,skinning:e}),a[r]=i),i}function b(t,e,n){const r=t<<0|e<<1|n<<2;let i=l[r];return void 0===i&&(i=new pkt({morphTargets:t,skinning:e}),l[r]=i),i}function v(e,n,r,i,s,o,a){let l=null,h=y,d=e.customDepthMaterial;if(!0===i.isPointLight&&(h=b,d=e.customDistanceMaterial),void 0===d){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e));l=h(t,i,!0===e.isInstancedMesh)}else l=d;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=l.uuid,e=r.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let i=n[e];void 0===i&&(i=l.clone(),n[e]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=s,l.farDistance=o),l}function x(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=i[c.materialIndex];if(u&&u.visible){const e=v(n,r,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,c)}}}else if(i.visible){const e=v(n,r,i,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)x(l[t],i,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,a,l){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let c=0,u=e.length;c<u;c++){const u=e[c],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),s.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(s.x=Math.floor(n/p.x),i.x=s.x*p.x,h.mapSize.x=s.x),i.y>n&&(s.y=Math.floor(n/p.y),i.y=s.y*p.y,h.mapSize.y=s.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const t={minFilter:zbt,magFilter:zbt,format:Ybt};h.map=new zvt(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new zvt(i.x,i.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:Lbt,magFilter:Lbt,format:Ybt};h.map=new zvt(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const f=h.getViewportCount();for(let t=0;t<f;t++){const e=h.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),h.updateMatrices(u,t),r=h.getFrustum(),x(a,l,h.camera,u,this.type)}h.isPointLightShadow||3!==this.type||g(h,l),h.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(c,u,h)}}function mkt(t,e,n){const r=n.isWebGL2;const i=new function(){let e=!1;const n=new Fvt;let r=null;const i=new Fvt(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?R(2929):O(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},o=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?R(2960):O(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}};let a={},l=null,c=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,y=!1,b=null,v=null,x=null,w=null,_=null;const S=t.getParameter(35661);let k=!1,T=0;const E=t.getParameter(7938);-1!==E.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(E)[1]),k=T>=1):-1!==E.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(E)[1]),k=T>=2);let M=null,C={};const A=new Fvt,N=new Fvt;function I(e,n,r){const i=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return s}const $={};function R(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function O(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}$[3553]=I(3553,3553,1),$[34067]=I(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),o.setClear(0),R(2929),s.setFunc(3),F(!1),z(1),R(2884),D(0);const P={[Tbt]:32774,101:32778,102:32779};if(r)P[103]=32775,P[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(P[103]=t.MIN_EXT,P[104]=t.MAX_EXT)}const L={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function D(e,n,r,i,s,o,a,l){if(0!==e){if(c||(R(3042),c=!0),5===e)s=s||n,o=o||r,a=a||i,n===h&&s===f||(t.blendEquationSeparate(P[n],P[s]),h=n,f=s),r===d&&i===p&&o===m&&a===g||(t.blendFuncSeparate(L[r],L[i],L[o],L[a]),d=r,p=i,m=o,g=a),u=e,y=null;else if(e!==u||l!==y){if(h===Tbt&&f===Tbt||(t.blendEquation(32774),h=Tbt,f=Tbt),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}d=null,p=null,m=null,g=null,u=e,y=l}}else c&&(O(3042),c=!1)}function F(e){b!==e&&(e?t.frontFace(2304):t.frontFace(2305),b=e)}function z(e){0!==e?(R(2884),e!==v&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):O(2884),v=e}function B(e,n,r){e?(R(32823),w===n&&_===r||(t.polygonOffset(n,r),w=n,_=r)):O(32823)}function U(e){void 0===e&&(e=33984+S-1),M!==e&&(t.activeTexture(e),M=e)}return{buffers:{color:i,depth:s,stencil:o},enable:R,disable:O,useProgram:function(e){return l!==e&&(t.useProgram(e),l=e,!0)},setBlending:D,setMaterial:function(t,e){2===t.side?O(2884):R(2884);let n=1===t.side;e&&(n=!n),F(n),1===t.blending&&!1===t.transparent?D(0):D(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const r=t.stencilWrite;o.setTest(r),r&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),B(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:F,setCullFace:z,setLineWidth:function(e){e!==x&&(k&&t.lineWidth(e),x=e)},setPolygonOffset:B,setScissorTest:function(t){t?R(3089):O(3089)},activeTexture:U,bindTexture:function(e,n){null===M&&U();let r=C[M];void 0===r&&(r={type:void 0,texture:void 0},C[M]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||$[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=C[M];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===A.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),A.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){a={},M=null,C={},l=null,c=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,y=!1,b=null,v=null,x=null,w=null,_=null,i.reset(),s.reset(),o.reset()}}}function gkt(t,e,n,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?Nvt.floorPowerOfTwo:Math.floor,s=r(i*t.width),o=r(i*t.height);void 0===p&&(p=m(s,o));const a=n?m(s,o):p;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return Nvt.isPowerOfTwo(t.width)&&Nvt.isPowerOfTwo(t.height)}function b(t,e){return t.generateMipmaps&&e&&t.minFilter!==Lbt&&t.minFilter!==zbt}function v(e,n,i,s){t.generateMipmap(e);r.get(n).__maxMipLevel=Math.log(Math.max(i,s))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),6407===r&&(5126===i&&(s=34837),5131===i&&(s=34843),5121===i&&(s=32849)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||e.get("EXT_color_buffer_float"),s}function w(t){return t===Lbt||t===Dbt||t===Fbt?9728:9729}function _(e){const n=e.target;n.removeEventListener("dispose",_),function(e){const n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&d.delete(n),o.memory.textures--}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=r.get(e),i=r.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}(n),o.memory.textures--}let k=0;function T(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void I(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function E(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;N(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=o||l?l?r.image[t].image:r.image[t]:g(r.image[t],!1,!0,c);const h=u[0],d=y(h)||a,p=s.convert(r.format),f=s.convert(r.type),m=x(r.internalFormat,p,f);let w;if(A(34067,r,d),o){for(let t=0;t<6;t++){w=u[t].mipmaps;for(let e=0;e<w.length;e++){const i=w[e];r.format!==Ybt&&r.format!==Xbt?null!==p?n.compressedTexImage2D(34069+t,e,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,m,i.width,i.height,0,p,f,i.data)}}e.__maxMipLevel=w.length-1}else{w=r.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,p,f,u[t].data);for(let e=0;e<w.length;e++){const r=w[e].image[t].image;n.texImage2D(34069+t,e+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+t,0,m,p,f,u[t]);for(let e=0;e<w.length;e++){const r=w[e];n.texImage2D(34069+t,e+1,m,p,f,r.image[t])}}e.__maxMipLevel=w.length}b(r,d)&&v(34067,r,h.width,h.height);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}const M={[Rbt]:10497,[Obt]:33071,[Pbt]:33648},C={[Lbt]:9728,[Dbt]:9984,[Fbt]:9986,[zbt]:9729,[Bbt]:9985,[Ubt]:9987};function A(n,s,o){o?(t.texParameteri(n,10242,M[s.wrapS]),t.texParameteri(n,10243,M[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,M[s.wrapR]),t.texParameteri(n,10240,C[s.magFilter]),t.texParameteri(n,10241,C[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===Obt&&s.wrapT===Obt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,w(s.magFilter)),t.texParameteri(n,10241,w(s.minFilter)),s.minFilter!==Lbt&&s.minFilter!==zbt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=e.get("EXT_texture_filter_anisotropic");if(l){if(s.type===Hbt&&null===e.get("OES_texture_float_linear"))return;if(s.type===Gbt&&null===(a||e.get("OES_texture_half_float_linear")))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function N(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",_),e.__webglTexture=t.createTexture(),o.memory.textures++)}function I(e,r,i){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),N(e,r),n.activeTexture(33984+i),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const l=function(t){return!a&&(t.wrapS!==Obt||t.wrapT!==Obt||t.minFilter!==Lbt&&t.minFilter!==zbt)}(r)&&!1===y(r.image),c=g(r.image,l,!1,u),h=y(c)||a,d=s.convert(r.format);let p,f=s.convert(r.type),m=x(r.internalFormat,d,f);A(o,r,h);const w=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=r.type===Hbt?36012:r.type===Wbt?33190:r.type===qbt?35056:33189:r.type===Hbt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Kbt&&6402===m&&r.type!==jbt&&r.type!==Wbt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=jbt,f=s.convert(r.type)),r.format===Zbt&&6402===m&&(m=34041,r.type!==qbt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=qbt,f=s.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(r.isDataTexture)if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)p=w[t],n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=w.length;t<e;t++)p=w[t],r.format!==Ybt&&r.format!==Xbt?null!==d?n.compressedTexImage2D(3553,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,p.width,p.height,0,d,f,p.data);e.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),e.__maxMipLevel=0;else if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)p=w[t],n.texImage2D(3553,t,m,d,f,p);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,d,f,c),e.__maxMipLevel=0;b(r,h)&&v(o,r,c.width,c.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function $(e,i,o,a){const l=s.convert(i.texture.format),c=s.convert(i.texture.type),u=x(i.texture.internalFormat,l,c);n.texImage2D(a,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,a,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function R(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Hbt?i=36012:e.type===Wbt&&(i=33190));const r=P(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=s.convert(n.texture.format),i=s.convert(n.texture.type),o=x(n.texture.internalFormat,e,i);if(r){const e=P(n);t.renderbufferStorageMultisample(36161,e,o,n.width,n.height)}else t.renderbufferStorage(36161,o,n.width,n.height)}t.bindRenderbuffer(36161,null)}function O(e){const n=r.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Kbt)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Zbt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,e)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)t.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),R(n.__webglDepthbuffer[r],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),R(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function P(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let L=!1,D=!1;this.allocateTextureUnit=function(){const t=k;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),k+=1,t},this.resetTextureUnits=function(){k=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(e){const i=r.get(e),l=r.get(e.texture);e.addEventListener("dispose",S),l.__webglTexture=t.createTexture(),o.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=y(e)||a;if(!a||e.texture.format!==Xbt||e.texture.type!==Hbt&&e.texture.type!==Gbt||(e.texture.format=Ybt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=s.convert(e.texture.format),r=s.convert(e.texture.type),o=x(e.texture.internalFormat,n,r),a=P(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),R(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),A(34067,e.texture,h);for(let t=0;t<6;t++)$(i.__webglFramebuffer[t],e,36064,34069+t);b(e.texture,h)&&v(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),A(3553,e.texture,h),$(i.__webglFramebuffer,e,36064,3553),b(e.texture,h)&&v(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(b(e,y(t)||a)){const i=t.isWebGLCubeRenderTarget?34067:3553,s=r.get(e).__webglTexture;n.bindTexture(i,s),v(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(a){const n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const i=e.width,s=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024),t.blitFramebuffer(0,0,i,s,0,0,i,s,o,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===L&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),L=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),t=t.texture),E(t,e)}}function ykt(t,e,n){const r=n.isWebGL2;return{convert:function(t){let n;if(t===Vbt)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===jbt)return 5123;if(1013===t)return 5124;if(t===Wbt)return 5125;if(t===Hbt)return 5126;if(t===Gbt)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===Xbt)return 6407;if(t===Ybt)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===Kbt)return 6402;if(t===Zbt)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(t===Jbt||t===Qbt||t===tvt||t===evt){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===Jbt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Qbt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===tvt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===evt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===nvt||t===rvt||t===ivt||t===svt){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(t===nvt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===rvt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ivt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===svt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===ovt||t===avt)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(t===ovt)return n.COMPRESSED_RGB8_ETC2;if(t===avt)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===qbt?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function bkt(t=[]){l_t.call(this),this.cameras=t}function vkt(){Bxt.call(this),this.type="Group"}function xkt(){this._targetRay=null,this._grip=null,this._hand=null}function wkt(t,e){const n=this;let r=null,i=1,s=null,o="local-floor",a=null;const l=[],c=new Map,u=new l_t;u.layers.enable(1),u.viewport=new Fvt;const h=new l_t;h.layers.enable(2),h.viewport=new Fvt;const d=[u,h],p=new bkt;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(t){const e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function y(){c.forEach((function(t,e){t.disconnect(e)})),c.clear(),f=null,m=null,t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(t){const e=r.inputSources;for(let t=0;t<l.length;t++)c.set(e[t],l[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=c.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),c.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=c.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=l[t];return void 0===e&&(e=new xkt,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=l[t];return void 0===e&&(e=new xkt,l[t]=e),e.getGripSpace()},this.getHand=function(t){let e=l[t];return void 0===e&&(e=new xkt,l[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=async function(t){if(r=t,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",y),r.addEventListener("inputsourceschange",b);const t=e.getContextAttributes();!0!==t.xrCompatible&&await e.makeXRCompatible();const a={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},l=new XRWebGLLayer(r,e,a);r.updateRenderState({baseLayer:l}),s=await r.requestReferenceSpace(o),S.setContext(r),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const v=new Uvt,x=new Uvt;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){p.near=h.near=u.near=t.near,p.far=h.far=u.far=t.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const e=t.parent,n=p.cameras;w(p,e);for(let t=0;t<n.length;t++)w(n[t],e);t.matrixWorld.copy(p.matrixWorld),t.matrix.copy(p.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){v.setFromMatrixPosition(e.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);const r=v.distanceTo(x),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,y=a+f,b=d-m,w=p+(r-m),_=l*a/y*g,S=c*a/y*g;t.projectionMatrix.makePerspective(b,w,_,S,g,y)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let _=null;const S=new y_t;S.setAnimationLoop((function(e,n){if(a=n.getViewerPose(s),null!==a){const e=a.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let t=0;t<e.length;t++){const r=e[t],s=n.getViewport(r),o=d[t];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===t&&p.matrix.copy(o.matrix),!0===i&&p.cameras.push(o)}}const i=r.inputSources;for(let t=0;t<l.length;t++){const e=l[t],r=i[t];e.update(r,n,s)}_&&_(e,n)})),this.setAnimationLoop=function(t){_=t},this.dispose=function(){}}function _kt(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,s;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,s){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,s):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Skt(t){const e=void 0!==(t=t||{}).canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=gvt,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,y=0,b=0,v=null,x=null,w=-1,_=null;const S=new Fvt,k=new Fvt;let T=null,E=e.width,M=e.height,C=1,A=null,N=null;const I=new Fvt(0,0,E,M),$=new Fvt(0,0,E,M);let R=!1;const O=new g_t;let P=!1,L=!1;const D=new mxt,F=new Uvt,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function B(){return null===v?C:1}let U,V,j,W,H,G,q,X,Y,K,Z,J,Q,tt,et,nt,rt,it,st,ot,at,lt=n;function ct(t,n){for(let r=0;r<t.length;r++){const i=t[r],s=e.getContext(i,n);if(null!==s)return s}return null}try{const t={alpha:r,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===lt){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),lt=ct(e,t),null===lt)throw ct(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===lt.getShaderPrecisionFormat&&(lt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){U=new A_t(lt),V=new E_t(lt,U,t),U.init(V),ot=new ykt(lt,U,V),j=new mkt(lt,U,V),j.scissor(k.copy($).multiplyScalar(C).floor()),j.viewport(S.copy(I).multiplyScalar(C).floor()),W=new $_t,H=new ekt,G=new gkt(lt,U,j,H,V,ot,W),q=new C_t(f),X=new b_t(lt,V),at=new k_t(lt,U,X,V),Y=new N_t(lt,X,W,at),K=new L_t(lt,Y,X,W),rt=new P_t(lt),et=new M_t(H),Z=new tkt(f,q,U,V,at,et),J=new _kt(H),Q=new skt(H),tt=new hkt(U,V),nt=new S_t(f,q,j,K,a),it=new T_t(lt,U,W,V),st=new I_t(lt,U,W,V),W.programs=Z.programs,f.capabilities=V,f.extensions=U,f.properties=H,f.renderLists=Q,f.state=j,f.info=W}ut();const ht=new wkt(f,lt);this.xr=ht;const dt=new fkt(f,K,V.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ut()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),H.remove(t)}(e)}function gt(t){const e=H.get(t).program;void 0!==e&&Z.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return lt},this.getContextAttributes=function(){return lt.getContextAttributes()},this.forceContextLoss=function(){const t=U.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=U.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(E,M,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Ivt),t.set(E,M)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,M=n,e.width=Math.floor(t*C),e.height=Math.floor(n*C),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Ivt),t.set(E*C,M*C).floor()},this.setDrawingBufferSize=function(t,n,r){E=t,M=n,C=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Fvt),t.copy(S)},this.getViewport=function(t){return t.copy(I)},this.setViewport=function(t,e,n,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,n,r),j.viewport(S.copy(I).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy($)},this.setScissor=function(t,e,n,r){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,r),j.scissor(k.copy($).multiplyScalar(C).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(t){j.setScissorTest(R=t)},this.setOpaqueSort=function(t){A=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new lwt),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),lt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",ft,!1),Q.dispose(),tt.dispose(),H.dispose(),q.dispose(),K.dispose(),at.dispose(),ht.dispose(),bt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=H.get(t);t.hasPositions&&!n.position&&(n.position=lt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=lt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=lt.createBuffer()),t.hasColors&&!n.color&&(n.color=lt.createBuffer());const r=e.getAttributes();t.hasPositions&&(lt.bindBuffer(34962,n.position),lt.bufferData(34962,t.positionArray,35048),at.enableAttribute(r.position),lt.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(lt.bindBuffer(34962,n.normal),lt.bufferData(34962,t.normalArray,35048),at.enableAttribute(r.normal),lt.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(lt.bindBuffer(34962,n.uv),lt.bufferData(34962,t.uvArray,35048),at.enableAttribute(r.uv),lt.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(lt.bindBuffer(34962,n.color),lt.bufferData(34962,t.colorArray,35048),at.enableAttribute(r.color),lt.vertexAttribPointer(r.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),lt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=z);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=St(t,e,r,i);j.setMaterial(r,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=Y.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,l);let d=it;null!==l&&(u=X.get(l),d=st,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==s?s.start*h:0,y=null!==s?s.count*h:1/0,b=Math.max(f,g),v=Math.min(p,f+m,g+y)-1,x=Math.max(0,v-b+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*B()),d.setMode(1)):d.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),j.setLineWidth(t*B()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(b,x,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(b,x,t)}else d.render(b,x)}},this.compile=function(t,e){d=tt.get(t),d.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights();const n=new WeakMap;t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];!1===n.has(s)&&(_t(s,t,e),n.set(s))}else!1===n.has(r)&&(_t(r,t,e),n.set(r))}))};let yt=null;const bt=new y_t;function vt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||O.intersectsSprite(t)){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);const e=K.update(t),i=t.material;i.visible&&h.push(t,e,i,n,F.z,null)}}else if(t.isImmediateRenderObject)r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D),h.push(t,null,t.material,n,F.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==W.render.frame&&(t.skeleton.update(),t.skeleton.frame=W.render.frame),!t.frustumCulled||O.intersectsObject(t))){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);const e=K.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,F.z,o)}}else i.visible&&h.push(t,e,i,n,F.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)vt(i[t],e,n,r)}function xt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];o.layers.test(r.layers)&&(j.viewport(S.copy(r.viewport)),d.setupLightsView(r),wt(o,e,r,a,l,c))}}else wt(o,e,n,a,l,c)}}function wt(t,e,n,r,i,s){if(t.onBeforeRender(f,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=St(n,e,i,t);j.setMaterial(i),at.reset(),function(t,e){t.render((function(t){f.renderBufferImmediate(t,e)}))}(t,r)}else f.renderBufferDirect(n,e,r,i,t,s);t.onAfterRender(f,e,n,r,i,s)}function _t(t,e,n){!0!==e.isScene&&(e=z);const r=H.get(t),i=d.state.lights,s=d.state.shadowsArray,o=i.state.version,a=Z.getParameters(t,i.state,s,e,n),l=Z.getProgramCacheKey(a);let c=r.program,u=!0;if(r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=q.get(t.envMap||r.environment),void 0===c)t.addEventListener("dispose",mt);else if(c.cacheKey!==l)gt(t);else if(r.lightsStateVersion!==o)u=!1;else{if(void 0!==a.shaderID)return;u=!1}u&&(a.uniforms=Z.getUniforms(t),t.onBeforeCompile(a,f),c=Z.acquireProgram(a,l),r.program=c,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=et.numPlanes,r.numIntersection=et.numIntersection,h.clippingPlanes=et.uniform),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=RSt.seqWithValue(p.seq,h);r.uniformsList=m}function St(t,e,n,r){!0!==e.isScene&&(e=z),G.resetTextureUnits();const i=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===v?f.outputEncoding:v.texture.encoding,a=q.get(n.envMap||s),l=H.get(n),c=d.state.lights;if(!0===P&&(!0===L||t!==_)){const e=t===_&&n.id===w;et.setState(n,t,e)}n.version===l.__version?n.fog&&l.fog!==i||l.environment!==s||l.needsLights&&l.lightsStateVersion!==c.state.version?_t(n,e,r):void 0===l.numClippingPlanes||l.numClippingPlanes===et.numPlanes&&l.numIntersection===et.numIntersection?(l.outputEncoding!==o||l.envMap!==a)&&_t(n,e,r):_t(n,e,r):(_t(n,e,r),l.__version=n.version);let u=!1,h=!1,p=!1;const m=l.program,g=m.getUniforms(),y=l.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==w&&(w=n.id,h=!0),u||_!==t){if(g.setValue(lt,"projectionMatrix",t.projectionMatrix),V.logarithmicDepthBuffer&&g.setValue(lt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),_!==t&&(_=t,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(lt,F.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(lt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(lt,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){g.setOptional(lt,r,"bindMatrix"),g.setOptional(lt,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(V.floatVertexTextures){if(null===t.boneTexture){let n=Math.sqrt(4*e.length);n=Nvt.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new p_t(r,n,n,Ybt,Hbt);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}g.setValue(lt,"boneTexture",t.boneTexture,G),g.setValue(lt,"boneTextureSize",t.boneTextureSize)}else g.setOptional(lt,t,"boneMatrices")}}var b,x;return(h||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,g.setValue(lt,"receiveShadow",r.receiveShadow)),h&&(g.setValue(lt,"toneMappingExposure",f.toneMappingExposure),l.needsLights&&(x=p,(b=y).ambientLightColor.needsUpdate=x,b.lightProbe.needsUpdate=x,b.directionalLights.needsUpdate=x,b.directionalLightShadows.needsUpdate=x,b.pointLights.needsUpdate=x,b.pointLightShadows.needsUpdate=x,b.spotLights.needsUpdate=x,b.spotLightShadows.needsUpdate=x,b.rectAreaLights.needsUpdate=x,b.hemisphereLights.needsUpdate=x),i&&n.fog&&J.refreshFogUniforms(y,i),J.refreshMaterialUniforms(y,n,C,M),RSt.upload(lt,l.uniformsList,y,G)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(RSt.upload(lt,l.uniformsList,y,G),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(lt,"center",r.center),g.setValue(lt,"modelViewMatrix",r.modelViewMatrix),g.setValue(lt,"normalMatrix",r.normalMatrix),g.setValue(lt,"modelMatrix",r.matrixWorld),m}bt.setAnimationLoop((function(t){ht.isPresenting||yt&&yt(t)})),"undefined"!=typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){yt=t,ht.setAnimationLoop(t),null===t?bt.stop():bt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;at.resetDefaultState(),w=-1,_=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(f,t,e,n||v),d=tt.get(t,p.length),d.init(),p.push(d),D.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),O.setFromProjectionMatrix(D),L=this.localClippingEnabled,P=et.init(this.clippingPlanes,L,e),h=Q.get(t,e),h.init(),vt(t,e,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(A,N),!0===P&&et.beginShadows();const i=d.state.shadowsArray;dt.render(i,t,e),d.setupLights(),d.setupLightsView(e),!0===P&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const s=h.opaque,o=h.transparent;s.length>0&&xt(s,t,e),o.length>0&&xt(o,t,e),!0===t.isScene&&t.onAfterRender(f,t,e),null!==v&&(G.updateRenderTargetMipmap(v),G.updateMultisampleRenderTarget(v)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(t){g!==t&&null===v&&lt.bindFramebuffer(36160,t),g=t},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderTarget=function(){return v},this.setRenderTarget=function(t,e=0,n=0){v=t,y=e,b=n,t&&void 0===H.get(t).__webglFramebuffer&&G.setupRenderTarget(t);let r=g,i=!1;if(t){const n=H.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],i=!0):r=t.isWebGLMultisampleRenderTarget?H.get(t).__webglMultisampledFramebuffer:n,S.copy(t.viewport),k.copy(t.scissor),T=t.scissorTest}else S.copy(I).multiplyScalar(C).floor(),k.copy($).multiplyScalar(C).floor(),T=R;if(x!==r&&(lt.bindFramebuffer(36160,r),x=r),j.viewport(S),j.scissor(k),j.setScissorTest(T),i){const r=H.get(t.texture);lt.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=H.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){let o=!1;a!==x&&(lt.bindFramebuffer(36160,a),o=!0);try{const a=t.texture,l=a.format,c=a.type;if(l!==Ybt&&ot.convert(l)!==lt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=c===Gbt&&(U.has("EXT_color_buffer_half_float")||V.isWebGL2&&U.has("EXT_color_buffer_float"));if(!(c===Vbt||ot.convert(c)===lt.getParameter(35738)||c===Hbt&&(V.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===lt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&lt.readPixels(e,n,r,i,ot.convert(l),ot.convert(c),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&lt.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r),o=ot.convert(e.format);G.setTexture2D(e,0),lt.copyTexImage2D(3553,n,o,t.x,t.y,i,s,0),j.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,s=e.image.height,o=ot.convert(n.format),a=ot.convert(n.type);G.setTexture2D(n,0),lt.pixelStorei(37440,n.flipY),lt.pixelStorei(37441,n.premultiplyAlpha),lt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?lt.texSubImage2D(3553,r,t.x,t.y,i,s,o,a,e.image.data):e.isCompressedTexture?lt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):lt.texSubImage2D(3553,r,t.x,t.y,o,a,e.image),0===r&&n.generateMipmaps&&lt.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(t){G.setTexture2D(t,0),j.unbindTexture()},this.resetState=function(){j.reset(),at.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function kkt(t){Skt.call(this,t)}bkt.prototype=Object.assign(Object.create(l_t.prototype),{constructor:bkt,isArrayCamera:!0}),vkt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:vkt,isGroup:!0}),Object.assign(xkt.prototype,{constructor:xkt,getHandSpace:function(){return null===this._hand&&(this._hand=new vkt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new vkt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new vkt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const t=new vkt;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[r.jointName]=t,l.add(t)}const i=l.joints[r.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}}),Object.assign(wkt.prototype,Mvt.prototype),kkt.prototype=Object.assign(Object.create(Skt.prototype),{constructor:kkt,isWebGL1Renderer:!0});class Tkt{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new lwt(t),this.density=void 0!==e?e:25e-5}clone(){return new Tkt(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Ekt{constructor(t,e,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new lwt(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}clone(){return new Ekt(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Mkt extends Bxt{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function Ckt(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=kvt,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Nvt.generateUUID()}Object.defineProperty(Ckt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ckt.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nvt.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new Ckt(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nvt.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Akt=new Uvt;function Nkt(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function Ikt(t){hwt.call(this),this.type="SpriteMaterial",this.color=new lwt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let $kt;Object.defineProperties(Nkt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Nkt.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)Akt.x=this.getX(e),Akt.y=this.getY(e),Akt.z=this.getZ(e),Akt.applyMatrix4(t),this.setXYZ(e,Akt.x,Akt.y,Akt.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new mwt(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Nkt(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Ikt.prototype=Object.create(hwt.prototype),Ikt.prototype.constructor=Ikt,Ikt.prototype.isSpriteMaterial=!0,Ikt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Rkt=new Uvt,Okt=new Uvt,Pkt=new Uvt,Lkt=new Ivt,Dkt=new Ivt,Fkt=new mxt,zkt=new Uvt,Bkt=new Uvt,Ukt=new Uvt,Vkt=new Ivt,jkt=new Ivt,Wkt=new Ivt;function Hkt(t){if(Bxt.call(this),this.type="Sprite",void 0===$kt){$kt=new Lwt;const t=new Ckt(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);$kt.setIndex([0,1,2,0,2,3]),$kt.setAttribute("position",new Nkt(t,3,0,!1)),$kt.setAttribute("uv",new Nkt(t,2,3,!1))}this.geometry=$kt,this.material=void 0!==t?t:new Ikt,this.center=new Ivt(.5,.5)}function Gkt(t,e,n,r,i,s){Lkt.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Dkt.x=s*Lkt.x-i*Lkt.y,Dkt.y=i*Lkt.x+s*Lkt.y):Dkt.copy(Lkt),t.copy(e),t.x+=Dkt.x,t.y+=Dkt.y,t.applyMatrix4(Fkt)}Hkt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:Hkt,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Okt.setFromMatrixScale(this.matrixWorld),Fkt.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Pkt.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Okt.multiplyScalar(-Pkt.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;Gkt(zkt.set(-.5,-.5,0),Pkt,s,Okt,r,i),Gkt(Bkt.set(.5,-.5,0),Pkt,s,Okt,r,i),Gkt(Ukt.set(.5,.5,0),Pkt,s,Okt,r,i),Vkt.set(0,0),jkt.set(1,0),Wkt.set(1,1);let o=t.ray.intersectTriangle(zkt,Bkt,Ukt,!1,Rkt);if(null===o&&(Gkt(Bkt.set(-.5,.5,0),Pkt,s,Okt,r,i),jkt.set(0,1),o=t.ray.intersectTriangle(zkt,Ukt,Bkt,!1,Rkt),null===o))return;const a=t.ray.origin.distanceTo(Rkt);a<t.near||a>t.far||e.push({distance:a,point:Rkt.clone(),uv:ewt.getUV(Rkt,zkt,Bkt,Ukt,Vkt,jkt,Wkt,new Ivt),face:null,object:this})},copy:function(t){return Bxt.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const qkt=new Uvt,Xkt=new Uvt;function Ykt(){Bxt.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Ykt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:Ykt,isLOD:!0,copy:function(t){Bxt.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){qkt.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(qkt);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){qkt.setFromMatrixPosition(t.matrixWorld),Xkt.setFromMatrixPosition(this.matrixWorld);const n=qkt.distanceTo(Xkt)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}},toJSON:function(t){const e=Bxt.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}});const Kkt=new Uvt,Zkt=new Fvt,Jkt=new Fvt,Qkt=new Uvt,tTt=new mxt;function eTt(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),t_t.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new mxt,this.bindMatrixInverse=new mxt}function nTt(){Bxt.call(this),this.type="Bone"}eTt.prototype=Object.assign(Object.create(t_t.prototype),{constructor:eTt,isSkinnedMesh:!0,copy:function(t){return t_t.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Fvt,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){t_t.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const n=this.skeleton,r=this.geometry;Zkt.fromBufferAttribute(r.attributes.skinIndex,t),Jkt.fromBufferAttribute(r.attributes.skinWeight,t),Kkt.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=Jkt.getComponent(t);if(0!==r){const i=Zkt.getComponent(t);tTt.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(Qkt.copy(Kkt).applyMatrix4(tTt),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}),nTt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:nTt,isBone:!0});const rTt=new mxt,iTt=new mxt;function sTt(t=[],e=[]){this.uuid=Nvt.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(sTt.prototype,{init:function(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new mxt)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new mxt;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:iTt;rTt.multiplyMatrices(i,e[r]),rTt.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new sTt(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new nTt),this.bones.push(i),this.boneInverses.push((new mxt).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const s=n[r];t.boneInverses.push(s.toArray())}return t}});const oTt=new mxt,aTt=new mxt,lTt=[],cTt=new t_t;function uTt(t,e,n){t_t.call(this,t,e),this.instanceMatrix=new mwt(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function hTt(t){hwt.call(this),this.type="LineBasicMaterial",this.color=new lwt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}uTt.prototype=Object.assign(Object.create(t_t.prototype),{constructor:uTt,isInstancedMesh:!0,copy:function(t){return t_t.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(cTt.geometry=this.geometry,cTt.material=this.material,void 0!==cTt.material)for(let i=0;i<r;i++){this.getMatrixAt(i,oTt),aTt.multiplyMatrices(n,oTt),cTt.matrixWorld=aTt,cTt.raycast(t,lTt);for(let t=0,n=lTt.length;t<n;t++){const n=lTt[t];n.instanceId=i,n.object=this,e.push(n)}lTt.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new mwt(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),hTt.prototype=Object.create(hwt.prototype),hTt.prototype.constructor=hTt,hTt.prototype.isLineBasicMaterial=!0,hTt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const dTt=new Uvt,pTt=new Uvt,fTt=new mxt,mTt=new fxt,gTt=new oxt;function yTt(t=new Lwt,e=new hTt){Bxt.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}yTt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:yTt,isLine:!0,copy:function(t){return Bxt.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)dTt.fromBufferAttribute(e,t-1),pTt.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=dTt.distanceTo(pTt);t.setAttribute("lineDistance",new kwt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),gTt.copy(n.boundingSphere),gTt.applyMatrix4(r),gTt.radius+=i,!1===t.ray.intersectsSphere(gTt))return;fTt.copy(r).invert(),mTt.copy(t.ray).applyMatrix4(fTt);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,a=new Uvt,l=new Uvt,c=new Uvt,u=new Uvt,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,s=n.length-1;r<s;r+=h){const s=n[r],h=n[r+1];a.fromBufferAttribute(i,s),l.fromBufferAttribute(i,h);if(mTt.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){a.fromBufferAttribute(i,n),l.fromBufferAttribute(i,n+1);if(mTt.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const bTt=new Uvt,vTt=new Uvt;function xTt(t,e){yTt.call(this,t,e),this.type="LineSegments"}function wTt(t,e){yTt.call(this,t,e),this.type="LineLoop"}function _Tt(t){hwt.call(this),this.type="PointsMaterial",this.color=new lwt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}xTt.prototype=Object.assign(Object.create(yTt.prototype),{constructor:xTt,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)bTt.fromBufferAttribute(e,t),vTt.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+bTt.distanceTo(vTt);t.setAttribute("lineDistance",new kwt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),wTt.prototype=Object.assign(Object.create(yTt.prototype),{constructor:wTt,isLineLoop:!0}),_Tt.prototype=Object.create(hwt.prototype),_Tt.prototype.constructor=_Tt,_Tt.prototype.isPointsMaterial=!0,_Tt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const STt=new mxt,kTt=new fxt,TTt=new oxt,ETt=new Uvt;function MTt(t=new Lwt,e=new _Tt){Bxt.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function CTt(t,e,n,r,i,s,o){const a=kTt.distanceSqToPoint(t);if(a<n){const n=new Uvt;kTt.closestPointToPoint(t,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}function ATt(t,e,n,r,i,s,o,a,l){Lvt.call(this,t,e,n,r,i,s,o,a,l),this.format=void 0!==o?o:Xbt,this.minFilter=void 0!==s?s:zbt,this.magFilter=void 0!==i?i:zbt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function NTt(t,e,n,r,i,s,o,a,l,c,u,h){Lvt.call(this,null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function ITt(t,e,n,r,i,s,o,a,l){Lvt.call(this,t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}function $Tt(t,e,n,r,i,s,o,a,l,c){if((c=void 0!==c?c:Kbt)!==Kbt&&c!==Zbt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Kbt&&(n=jbt),void 0===n&&c===Zbt&&(n=qbt),Lvt.call(this,null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:Lbt,this.minFilter=void 0!==a?a:Lbt,this.flipY=!1,this.generateMipmaps=!1}MTt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:MTt,isPoints:!0,copy:function(t){return Bxt.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),TTt.copy(n.boundingSphere),TTt.applyMatrix4(r),TTt.radius+=i,!1===t.ray.intersectsSphere(TTt))return;STt.copy(r).invert(),kTt.copy(t.ray).applyMatrix4(STt);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];ETt.fromBufferAttribute(s,a),CTt(ETt,a,o,r,t,e,this)}}else for(let n=0,i=s.count;n<i;n++)ETt.fromBufferAttribute(s,n),CTt(ETt,n,o,r,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),ATt.prototype=Object.assign(Object.create(Lvt.prototype),{constructor:ATt,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),NTt.prototype=Object.create(Lvt.prototype),NTt.prototype.constructor=NTt,NTt.prototype.isCompressedTexture=!0,ITt.prototype=Object.create(Lvt.prototype),ITt.prototype.constructor=ITt,ITt.prototype.isCanvasTexture=!0,$Tt.prototype=Object.create(Lvt.prototype),$Tt.prototype.constructor=$Tt,$Tt.prototype.isDepthTexture=!0;class RTt extends Lwt{constructor(t=1,e=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],s=[],o=[],a=[],l=new Uvt,c=new Ivt;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=e;i++,u+=3){const h=n+i/e*r;l.x=t*Math.cos(h),l.y=t*Math.sin(h),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/t+1)/2,c.y=(s[u+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new kwt(s,3)),this.setAttribute("normal",new kwt(o,3)),this.setAttribute("uv",new kwt(a,2))}}class OTt extends Lwt{constructor(t=1,e=1,n=1,r=8,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,s=new Ivt,f=new Uvt;let y=0;const b=!0===n?t:e,v=!0===n?1:-1;for(let t=1;t<=r;t++)u.push(0,m*v,0),h.push(0,v,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=b*i,f.y=m*v,f.z=b*n,u.push(f.x,f.y,f.z),h.push(0,v,0),s.x=.5*n+.5,s.y=.5*i*v+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=x+t;!0===n?c.push(r,r+1,e):c.push(r+1,r,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const s=new Uvt,y=new Uvt;let b=0;const v=(e-t)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,b=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);y.x=b*l,y.y=-g*n+m,y.z=b*f,u.push(y.x,y.y,y.z),s.set(l,v,f).normalize(),h.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],s=f[e][t+1];c.push(n,r,s),c.push(r,i,s),b+=6}l.addGroup(g,b,0),g+=b}(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new kwt(u,3)),this.setAttribute("normal",new kwt(h,3)),this.setAttribute("uv",new kwt(d,2))}}class PTt extends OTt{constructor(t=1,e=1,n=8,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}}class LTt extends Lwt{constructor(t,e,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],s=[];function o(t,e,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const o=t.clone().lerp(n,r/i),a=e.clone().lerp(n,r/i),l=i-r;for(let t=0;t<=l;t++)s[r][t]=0===t&&r===i?o:o.clone().lerp(a,t/l)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){i.push(t.x,t.y,t.z)}function l(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function c(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Uvt,r=new Uvt,i=new Uvt;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],r),l(e[s+2],i),o(n,r,i,t)}(r),function(t){const e=new Uvt;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new Uvt;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new Uvt,e=new Uvt,n=new Uvt,r=new Uvt,o=new Ivt,a=new Ivt,l=new Ivt;for(let h=0,d=0;h<i.length;h+=9,d+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),r.copy(t).add(e).add(n).divideScalar(3);const p=u(r);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new kwt(i,3)),this.setAttribute("normal",new kwt(i.slice(),3)),this.setAttribute("uv",new kwt(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class DTt extends LTt{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}}const FTt=new Uvt,zTt=new Uvt,BTt=new Uvt,UTt=new ewt;class VTt extends Lwt{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0===t.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),r=Math.cos(Nvt.DEG2RAD*e),i=t.getIndex(),s=t.getAttribute("position"),o=i?i.count:s.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),u={},h=[];for(let t=0;t<o;t+=3){i?(a[0]=i.getX(t),a[1]=i.getX(t+1),a[2]=i.getX(t+2)):(a[0]=t,a[1]=t+1,a[2]=t+2);const{a:e,b:o,c:d}=UTt;if(e.fromBufferAttribute(s,a[0]),o.fromBufferAttribute(s,a[1]),d.fromBufferAttribute(s,a[2]),UTt.getNormal(BTt),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=c[t],i=c[e],s=UTt[l[t]],o=UTt[l[e]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(BTt.dot(u[p].normal)<=r&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),u[p]=null):d in u||(u[d]={index0:a[t],index1:a[e],normal:BTt.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];FTt.fromBufferAttribute(s,e),zTt.fromBufferAttribute(s,n),h.push(FTt.x,FTt.y,FTt.z),h.push(zTt.x,zTt.y,zTt.z)}this.setAttribute("position",new kwt(h,3))}}const jTt=function(t,e,n){n=n||2;const r=e&&e.length,i=r?e[0]*n:t.length;let s=WTt(t,0,i,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,p;if(r&&(s=function(t,e,n,r){const i=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=WTt(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(eEt(c));for(i.sort(ZTt),s=0;s<i.length;s++)JTt(i[s],n),n=HTt(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(let e=n;e<i;e+=n)h=t[e],d=t[e+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return GTt(s,o,n,a,l,p),o};function WTt(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=hEt(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=hEt(s,t[s],t[s+1],o);return o&&sEt(o,o.next)&&(dEt(o),o=o.next),o}function HTt(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!sEt(r,r.next)&&0!==iEt(r.prev,r,r.next))r=r.next;else{if(dEt(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function GTt(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=tEt(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?XTt(t,r,i,s):qTt(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),dEt(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?GTt(t=YTt(HTt(t),e,n),e,n,r,i,s,2):2===o&&KTt(t,e,n,r,i,s):GTt(HTt(t),e,n,r,i,s,1);break}}function qTt(t){const e=t.prev,n=t,r=t.next;if(iEt(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(nEt(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&iEt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function XTt(t,e,n,r){const i=t.prev,s=t,o=t.next;if(iEt(i,s,o)>=0)return!1;const a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=tEt(a,l,e,n,r),d=tEt(c,u,e,n,r);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&nEt(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&iEt(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&nEt(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&iEt(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&nEt(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&iEt(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&nEt(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&iEt(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function YTt(t,e,n){let r=t;do{const i=r.prev,s=r.next.next;!sEt(i,s)&&oEt(i,r,r.next,s)&&cEt(i,s)&&cEt(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),dEt(r),dEt(r.next),r=t=s),r=r.next}while(r!==t);return HTt(r)}function KTt(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&rEt(o,t)){let a=uEt(o,t);return o=HTt(o,o.next),a=HTt(a,a.next),GTt(o,e,n,r,i,s),void GTt(a,e,n,r,i,s)}t=t.next}o=o.next}while(o!==t)}function ZTt(t,e){return t.x-e.x}function JTt(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let s,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>o){if(o=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s;const a=s,l=s.x,c=s.y;let u,h=1/0;n=s;do{r>=n.x&&n.x>=l&&r!==n.x&&nEt(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),cEt(n,t)&&(u<h||u===h&&(n.x>s.x||n.x===s.x&&QTt(s,n)))&&(s=n,h=u)),n=n.next}while(n!==a);return s}(t,e),e){const n=uEt(e,t);HTt(e,e.next),HTt(n,n.next)}}function QTt(t,e){return iEt(t.prev,t,e.prev)<0&&iEt(e.next,t,t.next)<0}function tEt(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function eEt(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function nEt(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function rEt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&oEt(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(cEt(t,e)&&cEt(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(iEt(t.prev,t,e.prev)||iEt(t,e.prev,e))||sEt(t,e)&&iEt(t.prev,t,t.next)>0&&iEt(e.prev,e,e.next)>0)}function iEt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function sEt(t,e){return t.x===e.x&&t.y===e.y}function oEt(t,e,n,r){const i=lEt(iEt(t,e,n)),s=lEt(iEt(t,e,r)),o=lEt(iEt(n,r,t)),a=lEt(iEt(n,r,e));return i!==s&&o!==a||(!(0!==i||!aEt(t,n,e))||(!(0!==s||!aEt(t,r,e))||(!(0!==o||!aEt(n,t,r))||!(0!==a||!aEt(n,e,r)))))}function aEt(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function lEt(t){return t>0?1:t<0?-1:0}function cEt(t,e){return iEt(t.prev,t,t.next)<0?iEt(t,e,t.next)>=0&&iEt(t,t.prev,e)>=0:iEt(t,e,t.prev)<0||iEt(t,t.next,e)<0}function uEt(t,e){const n=new pEt(t.i,t.x,t.y),r=new pEt(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function hEt(t,e,n,r){const i=new pEt(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function dEt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pEt(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const fEt={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return fEt.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];mEt(t),gEt(n,t);let s=t.length;e.forEach(mEt);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,gEt(n,e[t]);const o=jTt(n,r);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}};function mEt(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function gEt(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class yEt extends Lwt{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:bEt;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,y,b,v,x,w=!1;f&&(g=f.getSpacedPoints(a),w=!0,c=!1,y=f.computeFrenetFrames(a,!1),b=new Uvt,v=new Uvt,x=new Uvt),c||(p=0,u=0,h=0,d=0);const _=t.extractPoints(o);let S=_.shape;const k=_.holes;if(!fEt.isClockWise(S)){S=S.reverse();for(let t=0,e=k.length;t<e;t++){const e=k[t];fEt.isClockWise(e)&&(k[t]=e.reverse())}}const T=fEt.triangulateShape(S,k),E=S;for(let t=0,e=k.length;t<e;t++){const e=k[t];S=S.concat(e)}function M(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const C=S.length,A=T.length;function N(t,e,n){let r,i,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-a*l);r=p+o*m-t.x,i=f+a*m-t.y;const g=r*r+i*i;if(g<=2)return new Ivt(r,i);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new Ivt(r/s,i/s)}const I=[];for(let t=0,e=E.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),I[t]=N(E[t],E[n],E[r]);const $=[];let R,O=I.concat();for(let t=0,e=k.length;t<e;t++){const e=k[t];R=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),R[t]=N(e[t],e[r],e[i]);$.push(R),O=O.concat(R)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=M(E[t],I[t],r);D(e.x,e.y,-n)}for(let t=0,e=k.length;t<e;t++){const e=k[t];R=$[t];for(let t=0,i=e.length;t<i;t++){const i=M(e[t],R[t],r);D(i.x,i.y,-n)}}}const P=h+d;for(let t=0;t<C;t++){const e=c?M(S[t],O[t],P):S[t];w?(v.copy(y.normals[0]).multiplyScalar(e.x),b.copy(y.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(v).add(b),D(x.x,x.y,x.z)):D(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const n=c?M(S[e],O[e],P):S[e];w?(v.copy(y.normals[t]).multiplyScalar(n.x),b.copy(y.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(v).add(b),D(x.x,x.y,x.z)):D(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=M(E[t],I[t],r);D(e.x,e.y,l+n)}for(let t=0,e=k.length;t<e;t++){const e=k[t];R=$[t];for(let t=0,i=e.length;t<i;t++){const i=M(e[t],R[t],r);w?D(i.x,i.y+g[a-1].y,g[a-1].x+n):D(i.x,i.y,l+n)}}}function L(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=C*t,s=C*(t+1);z(e+r+n,e+i+n,e+i+s,e+r+s)}}}function D(t,e,n){s.push(t),s.push(e),s.push(n)}function F(t,e,i){B(t),B(e),B(i);const s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);U(o[0]),U(o[1]),U(o[2])}function z(t,e,i,s){B(t),B(e),B(s),B(e),B(i),B(s);const o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);U(a[0]),U(a[1]),U(a[3]),U(a[1]),U(a[2]),U(a[3])}function B(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function U(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=C*t;for(let t=0;t<A;t++){const n=T[t];F(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<A;t++){const n=T[t];F(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<A;t++){const e=T[t];F(e[2],e[1],e[0])}for(let t=0;t<A;t++){const e=T[t];F(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;L(E,e),e+=E.length;for(let t=0,n=k.length;t<n;t++){const n=k[t];L(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new kwt(r,3)),this.setAttribute("uv",new kwt(i,2)),this.computeVertexNormals()}toJSON(){const t=Lwt.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}const bEt={generateTopUV:function(t,e,n,r,i){const s=e[3*n],o=e[3*n+1],a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new Ivt(s,o),new Ivt(a,l),new Ivt(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*s],g=e[3*s+1],y=e[3*s+2];return Math.abs(a-u)<.01?[new Ivt(o,1-l),new Ivt(c,1-h),new Ivt(d,1-f),new Ivt(m,1-y)]:[new Ivt(a,1-l),new Ivt(u,1-h),new Ivt(p,1-f),new Ivt(g,1-y)]}};class vEt extends LTt{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}}class xEt extends Lwt{constructor(t,e=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=Nvt.clamp(r,0,2*Math.PI);const i=[],s=[],o=[],a=1/e,l=new Uvt,c=new Ivt;for(let i=0;i<=e;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*h,l.y=t[n].y,l.z=t[n].x*d,s.push(l.x,l.y,l.z),c.x=i/e,c.y=n/(t.length-1),o.push(c.x,c.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,s=r,o=r+t.length,a=r+t.length+1,l=r+1;i.push(s,o,l),i.push(o,a,l)}if(this.setIndex(i),this.setAttribute("position",new kwt(s,3)),this.setAttribute("uv",new kwt(o,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new Uvt,i=new Uvt,s=new Uvt,o=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[o+a+0],i.y=n[o+a+1],i.z=n[o+a+2],s.addVectors(r,i).normalize(),n[a+0]=n[o+a+0]=s.x,n[a+1]=n[o+a+1]=s.y,n[a+2]=n[o+a+2]=s.z}}}class wEt extends LTt{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}}function _Et(t,e,n){Lwt.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],s=[],o=[],a=1e-5,l=new Uvt,c=new Uvt,u=new Uvt,h=new Uvt,d=new Uvt;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=e;n++){const r=n/e;t(r,p,c),i.push(c.x,c.y,c.z),r-a>=0?(t(r-a,p,u),h.subVectors(c,u)):(t(r+a,p,u),h.subVectors(u,c)),p-a>=0?(t(r,p-a,u),d.subVectors(c,u)):(t(r,p+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),s.push(l.x,l.y,l.z),o.push(r,p)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*p+n,i=t*p+n+1,s=(t+1)*p+n+1,o=(t+1)*p+n;r.push(e,i,o),r.push(i,s,o)}this.setIndex(r),this.setAttribute("position",new kwt(i,3)),this.setAttribute("normal",new kwt(s,3)),this.setAttribute("uv",new kwt(o,2))}_Et.prototype=Object.create(Lwt.prototype),_Et.prototype.constructor=_Et;class SEt extends Lwt{constructor(t=.5,e=1,n=8,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let u=t;const h=(e-t)/(r=Math.max(1,r)),d=new Uvt,p=new Ivt;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*s;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}u+=h}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,s=r+n+1,a=r+n+2,l=r+1;o.push(i,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new kwt(a,3)),this.setAttribute("normal",new kwt(l,3)),this.setAttribute("uv",new kwt(c,2))}}class kEt extends Lwt{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=r.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===fEt.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===fEt.isClockWise(e)&&(u[t]=e.reverse())}const h=fEt.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+o,i=e[1]+o,s=e[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new kwt(r,3)),this.setAttribute("normal",new kwt(i,3)),this.setAttribute("uv",new kwt(s,2))}toJSON(){const t=Lwt.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class TEt extends Lwt{constructor(t=1,e=8,n=6,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new Uvt,h=new Uvt,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let b=0;0==d&&0==s?b=.5/e:d==n&&a==Math.PI&&(b=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),u.y=t*Math.cos(s+y*o),u.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+b,1-y),g.push(l++)}c.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=c[t][r+1],i=c[t][r],o=c[t+1][r],l=c[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new kwt(p,3)),this.setAttribute("normal",new kwt(f,3)),this.setAttribute("uv",new kwt(m,2))}}class EEt extends LTt{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}}class MEt extends yEt{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Lwt;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(r,e),this.type="TextGeometry"}}class CEt extends Lwt{constructor(t=1,e=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],a=[],l=[],c=new Uvt,u=new Uvt,h=new Uvt;for(let s=0;s<=n;s++)for(let d=0;d<=r;d++){const p=d/r*i,f=s/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/r),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(n,i,a),s.push(i,o,a)}this.setIndex(s),this.setAttribute("position",new kwt(o,3)),this.setAttribute("normal",new kwt(a,3)),this.setAttribute("uv",new kwt(l,2))}}class AEt extends Lwt{constructor(t=1,e=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new Uvt,h=new Uvt,d=new Uvt,p=new Uvt,f=new Uvt,m=new Uvt,g=new Uvt;for(let o=0;o<=n;++o){const b=o/n*i*Math.PI*2;y(b,i,s,t,d),y(b+.01,i,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,s=-e*Math.cos(i),p=e*Math.sin(i);u.x=d.x+(s*g.x+p*f.x),u.y=d.y+(s*g.y+p*f.y),u.z=d.z+(s*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(n,i,a),o.push(i,s,a)}function y(t,e,n,r,i){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new kwt(a,3)),this.setAttribute("normal",new kwt(l,3)),this.setAttribute("uv",new kwt(c,2))}}class NEt extends Lwt{constructor(t,e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new Uvt,a=new Uvt,l=new Ivt;let c=new Uvt;const u=[],h=[],d=[],p=[];function f(i){c=t.getPointAt(i/e,c);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new kwt(u,3)),this.setAttribute("normal",new kwt(h,3)),this.setAttribute("uv",new kwt(d,2))}toJSON(){const t=Lwt.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class IEt extends Lwt{constructor(t){if(super(),this.type="WireframeGeometry",!0===t.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const e=[],n=[0,0],r={},i=new Uvt;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],i=e.start;for(let t=i,s=i+e.count;t<s;t+=3)for(let e=0;e<3;e++){const i=o.getX(t+e),s=o.getX(t+(e+1)%3);n[0]=Math.min(i,s),n[1]=Math.max(i,s);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];i.fromBufferAttribute(s,n.index1),e.push(i.x,i.y,i.z),i.fromBufferAttribute(s,n.index2),e.push(i.x,i.y,i.z)}}else{const n=t.attributes.position;for(let t=0,r=n.count/3;t<r;t++)for(let r=0;r<3;r++){const s=3*t+r;i.fromBufferAttribute(n,s),e.push(i.x,i.y,i.z);const o=3*t+(r+1)%3;i.fromBufferAttribute(n,o),e.push(i.x,i.y,i.z)}}this.setAttribute("position",new kwt(e,3))}}var $Et=Object.freeze({__proto__:null,BoxGeometry:n_t,BoxBufferGeometry:n_t,CircleGeometry:RTt,CircleBufferGeometry:RTt,ConeGeometry:PTt,ConeBufferGeometry:PTt,CylinderGeometry:OTt,CylinderBufferGeometry:OTt,DodecahedronGeometry:DTt,DodecahedronBufferGeometry:DTt,EdgesGeometry:VTt,ExtrudeGeometry:yEt,ExtrudeBufferGeometry:yEt,IcosahedronGeometry:vEt,IcosahedronBufferGeometry:vEt,LatheGeometry:xEt,LatheBufferGeometry:xEt,OctahedronGeometry:wEt,OctahedronBufferGeometry:wEt,ParametricGeometry:_Et,ParametricBufferGeometry:_Et,PlaneGeometry:v_t,PlaneBufferGeometry:v_t,PolyhedronGeometry:LTt,PolyhedronBufferGeometry:LTt,RingGeometry:SEt,RingBufferGeometry:SEt,ShapeGeometry:kEt,ShapeBufferGeometry:kEt,SphereGeometry:TEt,SphereBufferGeometry:TEt,TetrahedronGeometry:EEt,TetrahedronBufferGeometry:EEt,TextGeometry:MEt,TextBufferGeometry:MEt,TorusGeometry:CEt,TorusBufferGeometry:CEt,TorusKnotGeometry:AEt,TorusKnotBufferGeometry:AEt,TubeGeometry:NEt,TubeBufferGeometry:NEt,WireframeGeometry:IEt});function REt(t){hwt.call(this),this.type="ShadowMaterial",this.color=new lwt(0),this.transparent=!0,this.setValues(t)}function OEt(t){o_t.call(this,t),this.type="RawShaderMaterial"}function PEt(t){hwt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new lwt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lwt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ivt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function LEt(t){PEt.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ivt(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Nvt.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function DEt(t){hwt.call(this),this.type="MeshPhongMaterial",this.color=new lwt(16777215),this.specular=new lwt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lwt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ivt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function FEt(t){hwt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new lwt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lwt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ivt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function zEt(t){hwt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ivt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function BEt(t){hwt.call(this),this.type="MeshLambertMaterial",this.color=new lwt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lwt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function UEt(t){hwt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new lwt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ivt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function VEt(t){hTt.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}REt.prototype=Object.create(hwt.prototype),REt.prototype.constructor=REt,REt.prototype.isShadowMaterial=!0,REt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this},OEt.prototype=Object.create(o_t.prototype),OEt.prototype.constructor=OEt,OEt.prototype.isRawShaderMaterial=!0,PEt.prototype=Object.create(hwt.prototype),PEt.prototype.constructor=PEt,PEt.prototype.isMeshStandardMaterial=!0,PEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},LEt.prototype=Object.create(PEt.prototype),LEt.prototype.constructor=LEt,LEt.prototype.isMeshPhysicalMaterial=!0,LEt.prototype.copy=function(t){return PEt.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new lwt).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},DEt.prototype=Object.create(hwt.prototype),DEt.prototype.constructor=DEt,DEt.prototype.isMeshPhongMaterial=!0,DEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},FEt.prototype=Object.create(hwt.prototype),FEt.prototype.constructor=FEt,FEt.prototype.isMeshToonMaterial=!0,FEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},zEt.prototype=Object.create(hwt.prototype),zEt.prototype.constructor=zEt,zEt.prototype.isMeshNormalMaterial=!0,zEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},BEt.prototype=Object.create(hwt.prototype),BEt.prototype.constructor=BEt,BEt.prototype.isMeshLambertMaterial=!0,BEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},UEt.prototype=Object.create(hwt.prototype),UEt.prototype.constructor=UEt,UEt.prototype.isMeshMatcapMaterial=!0,UEt.prototype.copy=function(t){return hwt.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},VEt.prototype=Object.create(hTt.prototype),VEt.prototype.constructor=VEt,VEt.prototype.isLineDashedMaterial=!0,VEt.prototype.copy=function(t){return hTt.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var jEt=Object.freeze({__proto__:null,ShadowMaterial:REt,SpriteMaterial:Ikt,RawShaderMaterial:OEt,ShaderMaterial:o_t,PointsMaterial:_Tt,MeshPhysicalMaterial:LEt,MeshStandardMaterial:PEt,MeshPhongMaterial:DEt,MeshToonMaterial:FEt,MeshNormalMaterial:zEt,MeshLambertMaterial:BEt,MeshDepthMaterial:dkt,MeshDistanceMaterial:pkt,MeshBasicMaterial:dwt,MeshMatcapMaterial:UEt,LineDashedMaterial:VEt,LineBasicMaterial:hTt,Material:hwt});const WEt={arraySlice:function(t,e,n){return WEt.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r,i=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*i;if(!(s<n||s>=r)){l.push(e.times[t]);for(let n=0;n<a;++n)c.push(e.values[t*a+n])}}0!==l.length&&(e.times=WEt.convertArray(l,e.times.constructor),e.values=WEt.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,s=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===o)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(s<=r.times[0]){const t=a,e=l-a;d=WEt.arraySlice(r.values,t,e)}else if(s>=r.times[h]){const t=h*l+a,e=t+l-a;d=WEt.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,n=l-a;t.evaluate(s),d=WEt.arraySlice(t.resultBuffer,e,n)}if("quaternion"===i){(new Bvt).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===i)Bvt.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)o.values[e+n]-=d[n]}}}return t.blendMode=mvt,t}};function HEt(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function GEt(t,e,n,r){HEt.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function qEt(t,e,n,r){HEt.call(this,t,e,n,r)}function XEt(t,e,n,r){HEt.call(this,t,e,n,r)}function YEt(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=WEt.convertArray(e,this.TimeBufferType),this.values=WEt.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function KEt(t,e,n){YEt.call(this,t,e,n)}function ZEt(t,e,n,r){YEt.call(this,t,e,n,r)}function JEt(t,e,n,r){YEt.call(this,t,e,n,r)}function QEt(t,e,n,r){HEt.call(this,t,e,n,r)}function tMt(t,e,n,r){YEt.call(this,t,e,n,r)}function eMt(t,e,n,r){YEt.call(this,t,e,n,r)}function nMt(t,e,n,r){YEt.call(this,t,e,n,r)}function rMt(t,e=-1,n,r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Nvt.generateUUID(),this.duration<0&&this.resetDuration()}function iMt(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return JEt;case"vector":case"vector2":case"vector3":case"vector4":return nMt;case"color":return ZEt;case"quaternion":return tMt;case"bool":case"boolean":return KEt;case"string":return eMt}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];WEt.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(HEt.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(HEt.prototype,{beforeStart_:HEt.prototype.copySampleValue_,afterEnd_:HEt.prototype.copySampleValue_}),GEt.prototype=Object.assign(Object.create(HEt.prototype),{constructor:GEt,DefaultSettings_:{endingStart:hvt,endingEnd:hvt},intervalChanged_:function(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case dvt:i=t,o=2*e-n;break;case pvt:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case dvt:s=t,a=2*n-e;break;case pvt:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c},interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,b=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let t=0;t!==o;++t)i[t]=g*s[c+t]+y*s[l+t]+b*s[a+t]+v*s[u+t];return i}}),qEt.prototype=Object.assign(Object.create(HEt.prototype),{constructor:qEt,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let t=0;t!==o;++t)i[t]=s[l+t]*u+s[a+t]*c;return i}}),XEt.prototype=Object.assign(Object.create(HEt.prototype),{constructor:XEt,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(YEt,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:WEt.convertArray(t.times,Array),values:WEt.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(YEt.prototype,{constructor:YEt,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:cvt,InterpolantFactoryMethodDiscrete:function(t){return new XEt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new qEt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new GEt(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case lvt:e=this.InterpolantFactoryMethodDiscrete;break;case cvt:e=this.InterpolantFactoryMethodLinear;break;case uvt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return lvt;case this.InterpolantFactoryMethodLinear:return cvt;case this.InterpolantFactoryMethodSmooth:return uvt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=WEt.arraySlice(n,i,s),this.values=WEt.arraySlice(this.values,i*t,s*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&WEt.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=WEt.arraySlice(this.times),e=WEt.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===uvt,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=WEt.arraySlice(t,0,s),this.values=WEt.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this},clone:function(){const t=WEt.arraySlice(this.times,0),e=WEt.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),KEt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:KEt,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:lvt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ZEt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:ZEt,ValueTypeName:"color"}),JEt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:JEt,ValueTypeName:"number"}),QEt.prototype=Object.assign(Object.create(HEt.prototype),{constructor:QEt,interpolate_:function(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Bvt.slerpFlat(i,0,s,l-o,s,l,a);return i}}),tMt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:tMt,ValueTypeName:"quaternion",DefaultInterpolation:cvt,InterpolantFactoryMethodLinear:function(t){return new QEt(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),eMt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:eMt,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:lvt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),nMt.prototype=Object.assign(Object.create(YEt.prototype),{constructor:nMt,ValueTypeName:"vector"}),Object.assign(rMt,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(iMt(n[t]).scale(r));const i=new rMt(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(YEt.toJSON(n[t]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const i=e.length,s=[];for(let t=0;t<i;t++){let o=[],a=[];o.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const l=WEt.getKeyframeOrder(o);o=WEt.sortedArray(o,1,l),a=WEt.sortedArray(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new JEt(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new rMt(t,-1,s)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(i);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const s=[];for(const t in r)s.push(rMt.CreateFromMorphTargetSequence(t,r[t],e,n));return s},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const s=[],o=[];WEt.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new JEt(".morphTargetInfluence["+n+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";n(nMt,s+".position",i,"pos",r),n(tMt,s+".quaternion",i,"rot",r),n(nMt,s+".scale",i,"scl",r)}}if(0===r.length)return null;return new rMt(i,a,r,o)}}),Object.assign(rMt.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new rMt(this.name,this.duration,t,this.blendMode)},toJSON:function(){return rMt.toJSON(this)}});const sMt={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function oMt(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const aMt=new oMt;function lMt(t){this.manager=void 0!==t?t:aMt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(lMt.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const cMt={};function uMt(t){lMt.call(this,t)}function hMt(t){lMt.call(this,t)}function dMt(t){lMt.call(this,t)}function pMt(t){lMt.call(this,t)}function fMt(t){lMt.call(this,t)}function mMt(t){lMt.call(this,t)}function gMt(t){lMt.call(this,t)}function yMt(){this.type="Curve",this.arcLengthDivisions=200}function bMt(t,e,n,r,i,s,o,a){yMt.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}function vMt(t,e,n,r,i,s){bMt.call(this,t,e,n,n,r,i,s),this.type="ArcCurve"}function xMt(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}uMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:uMt,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=sMt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;if(void 0!==cMt[t])return void cMt[t].push({onLoad:e,onProgress:n,onError:r});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const n=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let r;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);r="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{cMt[t]=[],cMt[t].push({onLoad:e,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",t,!0),a.addEventListener("load",(function(e){const n=this.response,r=cMt[t];if(delete cMt[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),sMt.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){const n=cMt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),a.addEventListener("error",(function(e){const n=cMt[t];delete cMt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){const n=cMt[t];delete cMt[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return i.manager.itemStart(t),a},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),hMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:hMt,load:function(t,e,n,r){const i=this,s=new uMt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const r=rMt.parse(t[n]);e.push(r)}return e}}),dMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:dMt,load:function(t,e,n,r){const i=this,s=[],o=new NTt,a=new uMt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(t[c],(function(t){const n=i.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=zbt),o.image=s,o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=zbt),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,r);return o}}),pMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:pMt,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=sMt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),sMt.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),fMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:fMt,load:function(t,e,n,r){const i=new h_t,s=new pMt(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){i.images[n]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return i}}),mMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:mMt,load:function(t,e,n,r){const i=this,s=new p_t,o=new uMt(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Obt,s.wrapT=void 0!==n.wrapT?n.wrapT:Obt,s.magFilter=void 0!==n.magFilter?n.magFilter:zbt,s.minFilter=void 0!==n.minFilter?n.minFilter:zbt,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=Ubt),1===n.mipmapCount&&(s.minFilter=zbt),s.needsUpdate=!0,e&&e(s,n))}),n,r),s}}),gMt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:gMt,load:function(t,e,n,r){const i=new Lvt,s=new pMt(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Xbt:Ybt,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}),Object.assign(yMt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const c=n[r];return(r+(s-c)/(n[r+1]-c))/(i-1)},getTangent:function(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new Ivt:new Uvt);return a.copy(o).sub(s).normalize(),a},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Uvt,r=[],i=[],s=[],o=new Uvt,a=new mxt;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new Uvt),r[e].normalize()}i[0]=new Uvt,s[0]=new Uvt;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Nvt.clamp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Nvt.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),bMt.prototype=Object.create(yMt.prototype),bMt.prototype.constructor=bMt,bMt.prototype.isEllipseCurve=!0,bMt.prototype.getPoint=function(t,e){const n=e||new Ivt,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)},bMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},bMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},bMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},vMt.prototype=Object.create(bMt.prototype),vMt.prototype.constructor=vMt,vMt.prototype.isArcCurve=!0;const wMt=new Uvt,_Mt=new xMt,SMt=new xMt,kMt=new xMt;function TMt(t=[],e=!1,n="centripetal",r=.5){yMt.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}function EMt(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function MMt(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function CMt(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function AMt(t=new Ivt,e=new Ivt,n=new Ivt,r=new Ivt){yMt.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function NMt(t=new Uvt,e=new Uvt,n=new Uvt,r=new Uvt){yMt.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function IMt(t=new Ivt,e=new Ivt){yMt.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function $Mt(t=new Uvt,e=new Uvt){yMt.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function RMt(t=new Ivt,e=new Ivt,n=new Ivt){yMt.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}function OMt(t=new Uvt,e=new Uvt,n=new Uvt){yMt.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}function PMt(t=[]){yMt.call(this),this.type="SplineCurve",this.points=t}TMt.prototype=Object.create(yMt.prototype),TMt.prototype.constructor=TMt,TMt.prototype.isCatmullRomCurve3=!0,TMt.prototype.getPoint=function(t,e=new Uvt){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(wMt.subVectors(r[0],r[1]).add(r[0]),o=wMt);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(wMt.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=wMt),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),_Mt.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,e,n,r),SMt.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,e,n,r),kMt.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(_Mt.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),SMt.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),kMt.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(_Mt.calc(c),SMt.calc(c),kMt.calc(c)),n},TMt.prototype.copy=function(t){yMt.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},TMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},TMt.prototype.fromJSON=function(t){yMt.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Uvt).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},AMt.prototype=Object.create(yMt.prototype),AMt.prototype.constructor=AMt,AMt.prototype.isCubicBezierCurve=!0,AMt.prototype.getPoint=function(t,e=new Ivt){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(CMt(t,r.x,i.x,s.x,o.x),CMt(t,r.y,i.y,s.y,o.y)),n},AMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},AMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},AMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},NMt.prototype=Object.create(yMt.prototype),NMt.prototype.constructor=NMt,NMt.prototype.isCubicBezierCurve3=!0,NMt.prototype.getPoint=function(t,e=new Uvt){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(CMt(t,r.x,i.x,s.x,o.x),CMt(t,r.y,i.y,s.y,o.y),CMt(t,r.z,i.z,s.z,o.z)),n},NMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},NMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},NMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},IMt.prototype=Object.create(yMt.prototype),IMt.prototype.constructor=IMt,IMt.prototype.isLineCurve=!0,IMt.prototype.getPoint=function(t,e=new Ivt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},IMt.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},IMt.prototype.getTangent=function(t,e){const n=e||new Ivt;return n.copy(this.v2).sub(this.v1).normalize(),n},IMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},IMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},IMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},$Mt.prototype=Object.create(yMt.prototype),$Mt.prototype.constructor=$Mt,$Mt.prototype.isLineCurve3=!0,$Mt.prototype.getPoint=function(t,e=new Uvt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},$Mt.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},$Mt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},$Mt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},$Mt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},RMt.prototype=Object.create(yMt.prototype),RMt.prototype.constructor=RMt,RMt.prototype.isQuadraticBezierCurve=!0,RMt.prototype.getPoint=function(t,e=new Ivt){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(MMt(t,r.x,i.x,s.x),MMt(t,r.y,i.y,s.y)),n},RMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},RMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},RMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},OMt.prototype=Object.create(yMt.prototype),OMt.prototype.constructor=OMt,OMt.prototype.isQuadraticBezierCurve3=!0,OMt.prototype.getPoint=function(t,e=new Uvt){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(MMt(t,r.x,i.x,s.x),MMt(t,r.y,i.y,s.y),MMt(t,r.z,i.z,s.z)),n},OMt.prototype.copy=function(t){return yMt.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},OMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},OMt.prototype.fromJSON=function(t){return yMt.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},PMt.prototype=Object.create(yMt.prototype),PMt.prototype.constructor=PMt,PMt.prototype.isSplineCurve=!0,PMt.prototype.getPoint=function(t,e=new Ivt){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(EMt(o,a.x,l.x,c.x,u.x),EMt(o,a.y,l.y,c.y,u.y)),n},PMt.prototype.copy=function(t){yMt.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},PMt.prototype.toJSON=function(){const t=yMt.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},PMt.prototype.fromJSON=function(t){yMt.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Ivt).fromArray(n))}return this};var LMt=Object.freeze({__proto__:null,ArcCurve:vMt,CatmullRomCurve3:TMt,CubicBezierCurve:AMt,CubicBezierCurve3:NMt,EllipseCurve:bMt,LineCurve:IMt,LineCurve3:$Mt,QuadraticBezierCurve:RMt,QuadraticBezierCurve3:OMt,SplineCurve:PMt});function DMt(){yMt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function FMt(t){DMt.call(this),this.type="Path",this.currentPoint=new Ivt,t&&this.setFromPoints(t)}function zMt(t){FMt.call(this,t),this.uuid=Nvt.generateUUID(),this.type="Shape",this.holes=[]}function BMt(t,e=1){Bxt.call(this),this.type="Light",this.color=new lwt(t),this.intensity=e}function UMt(t,e,n){BMt.call(this,t,n),this.type="HemisphereLight",this.position.copy(Bxt.DefaultUp),this.updateMatrix(),this.groundColor=new lwt(e)}function VMt(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ivt(512,512),this.map=null,this.mapPass=null,this.matrix=new mxt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new g_t,this._frameExtents=new Ivt(1,1),this._viewportCount=1,this._viewports=[new Fvt(0,0,1,1)]}function jMt(){VMt.call(this,new l_t(50,1,.5,500)),this.focus=1}function WMt(t,e,n,r,i,s){BMt.call(this,t,e),this.type="SpotLight",this.position.copy(Bxt.DefaultUp),this.updateMatrix(),this.target=new Bxt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==s?s:1,this.shadow=new jMt}function HMt(){VMt.call(this,new l_t(90,1,.5,500)),this._frameExtents=new Ivt(4,2),this._viewportCount=6,this._viewports=[new Fvt(2,1,1,1),new Fvt(0,1,1,1),new Fvt(3,1,1,1),new Fvt(1,1,1,1),new Fvt(3,0,1,1),new Fvt(1,0,1,1)],this._cubeDirections=[new Uvt(1,0,0),new Uvt(-1,0,0),new Uvt(0,0,1),new Uvt(0,0,-1),new Uvt(0,1,0),new Uvt(0,-1,0)],this._cubeUps=[new Uvt(0,1,0),new Uvt(0,1,0),new Uvt(0,1,0),new Uvt(0,1,0),new Uvt(0,0,1),new Uvt(0,0,-1)]}function GMt(t,e,n,r){BMt.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new HMt}function qMt(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){a_t.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}function XMt(){VMt.call(this,new qMt(-5,5,5,-5,.5,500))}function YMt(t,e){BMt.call(this,t,e),this.type="DirectionalLight",this.position.copy(Bxt.DefaultUp),this.updateMatrix(),this.target=new Bxt,this.shadow=new XMt}function KMt(t,e){BMt.call(this,t,e),this.type="AmbientLight"}function ZMt(t,e,n,r){BMt.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}DMt.prototype=Object.assign(Object.create(yMt.prototype),{constructor:DMt,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new IMt(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],s=i.getLength(),o=0===s?0:1-t/s;return i.getPointAt(o)}r++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){yMt.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=yMt.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){yMt.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new LMt[n.type]).fromJSON(n))}return this}}),FMt.prototype=Object.assign(Object.create(DMt.prototype),{constructor:FMt,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new IMt(this.currentPoint.clone(),new Ivt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const i=new RMt(this.currentPoint.clone(),new Ivt(t,e),new Ivt(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,i,s){const o=new AMt(this.currentPoint.clone(),new Ivt(t,e),new Ivt(n,r),new Ivt(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this},splineThru:function(t){const e=new PMt([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this},absarc:function(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this},ellipse:function(t,e,n,r,i,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this},absellipse:function(t,e,n,r,i,s,o,a){const l=new bMt(t,e,n,r,i,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return DMt.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=DMt.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return DMt.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),zMt.prototype=Object.assign(Object.create(FMt.prototype),{constructor:zMt,getPointsHoles:function(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){FMt.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=FMt.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){FMt.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new FMt).fromJSON(n))}return this}}),BMt.prototype=Object.assign(Object.create(Bxt.prototype),{constructor:BMt,isLight:!0,copy:function(t){return Bxt.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=Bxt.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),UMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:UMt,isHemisphereLight:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(VMt.prototype,{_projScreenMatrix:new mxt,_lightPositionWorld:new Uvt,_lookTarget:new Uvt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(t.matrixWorld),e.position.copy(s),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),jMt.prototype=Object.assign(Object.create(VMt.prototype),{constructor:jMt,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*Nvt.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),VMt.prototype.updateMatrices.call(this,t)}}),WMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:WMt,isSpotLight:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),HMt.prototype=Object.assign(Object.create(VMt.prototype),{constructor:HMt,isPointLightShadow:!0,updateMatrices:function(t,e=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,s=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),s.copy(n.position),s.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(s),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),GMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:GMt,isPointLight:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),qMt.prototype=Object.assign(Object.create(a_t.prototype),{constructor:qMt,isOrthographicCamera:!0,copy:function(t,e){return a_t.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Bxt.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),XMt.prototype=Object.assign(Object.create(VMt.prototype),{constructor:XMt,isDirectionalLightShadow:!0,updateMatrices:function(t){VMt.prototype.updateMatrices.call(this,t)}}),YMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:YMt,isDirectionalLight:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),KMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:KMt,isAmbientLight:!0}),ZMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:ZMt,isRectAreaLight:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=BMt.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class JMt{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Uvt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}function QMt(t,e){BMt.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new JMt}function tCt(t){lMt.call(this,t),this.textures={}}QMt.prototype=Object.assign(Object.create(BMt.prototype),{constructor:QMt,isLightProbe:!0,copy:function(t){return BMt.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=BMt.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),tCt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:tCt,load:function(t,e,n,r){const i=this,s=new uMt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new jEt[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new lwt).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new lwt).setHex(i.value);break;case"v2":r.uniforms[e].value=(new Ivt).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new Uvt).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new Fvt).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new $vt).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new mxt).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Ivt).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Ivt).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});const eCt={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function nCt(){Lwt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function rCt(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),mwt.call(this,t,e,n),this.meshPerAttribute=r||1}function iCt(t){lMt.call(this,t)}nCt.prototype=Object.assign(Object.create(Lwt.prototype),{constructor:nCt,isInstancedBufferGeometry:!0,copy:function(t){return Lwt.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=Lwt.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),rCt.prototype=Object.assign(Object.create(mwt.prototype),{constructor:rCt,isInstancedBufferAttribute:!0,copy:function(t){return mwt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=mwt.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),iCt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:iCt,load:function(t,e,n,r){const i=this,s=new uMt(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],s=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),o=new Ckt(Cwt(i.type,s),i.stride);return o.uuid=i.uuid,e[r]=o,o}const i=t.isInstancedBufferGeometry?new nCt:new Lwt,s=t.data.index;if(void 0!==s){const t=Cwt(s.type,s.array);i.setIndex(new mwt(t,1))}const o=t.data.attributes;for(const e in o){const n=o[e];let s;if(n.isInterleavedBufferAttribute){s=new Nkt(r(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=Cwt(n.type,n.array);s=new(n.isInstancedBufferAttribute?rCt:mwt)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),i.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let o;if(i.isInterleavedBufferAttribute){o=new Nkt(r(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{o=new mwt(Cwt(i.type,i.array),i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),s.push(o)}i.morphAttributes[e]=s}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];i.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new Uvt;void 0!==c.center&&t.fromArray(c.center),i.boundingSphere=new oxt(t,c.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}});const sCt={UVMapping:Ebt,CubeReflectionMapping:Mbt,CubeRefractionMapping:Cbt,EquirectangularReflectionMapping:Abt,EquirectangularRefractionMapping:Nbt,CubeUVReflectionMapping:Ibt,CubeUVRefractionMapping:$bt},oCt={RepeatWrapping:Rbt,ClampToEdgeWrapping:Obt,MirroredRepeatWrapping:Pbt},aCt={NearestFilter:Lbt,NearestMipmapNearestFilter:Dbt,NearestMipmapLinearFilter:Fbt,LinearFilter:zbt,LinearMipmapNearestFilter:Bbt,LinearMipmapLinearFilter:Ubt};function lCt(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),lMt.call(this,t),this.options={premultiplyAlpha:"none"}}function cCt(){this.type="ShapePath",this.color=new lwt,this.subPaths=[],this.currentPath=null}lCt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:lCt,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=sMt.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,i.options)})).then((function(n){sMt.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(cCt.prototype,{moveTo:function(t,e){return this.currentPath=new FMt,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,s){return this.currentPath.bezierCurveTo(t,e,n,r,i,s),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new zMt;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=e[i],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[i],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return r}const i=fEt.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new zMt,l.curves=a.curves,c.push(l),c;let u=!i(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let e=0,n=s.length;e<n;e++)a=s[e],p=a.getPoints(),o=i(p),o=t?!o:o,o?(!u&&d[g]&&g++,d[g]={s:new zMt,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(s);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)h[t]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let s=0;s<i.length;s++){const o=i[s];let a=!0;for(let i=0;i<d.length;i++)r(o.p,d[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:s}),a?(a=!1,h[i].push(o)):t=!0);a&&h[n].push(o)}}e.length>0&&(t||(m=h))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,c.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return c}});class uCt{constructor(t){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],r=function(t,e,n){const r=Array.from?Array.from(t):String(t).split(""),i=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[];let a=0,l=0;for(let t=0;t<r.length;t++){const e=r[t];if("\n"===e)a=0,l-=s;else{const t=hCt(e,i,a,l,n);a+=t.offsetX,o.push(t.path)}}return o}(t,e,this.data);for(let t=0,e=r.length;t<e;t++)Array.prototype.push.apply(n,r[t].toShapes());return n}}function hCt(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const o=new cCt;let a,l,c,u,h,d,p,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=t.length;i<s;){switch(t[i++]){case"m":a=t[i++]*e+n,l=t[i++]*e+r,o.moveTo(a,l);break;case"l":a=t[i++]*e+n,l=t[i++]*e+r,o.lineTo(a,l);break;case"q":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,o.quadraticCurveTo(h,d,c,u);break;case"b":c=t[i++]*e+n,u=t[i++]*e+r,h=t[i++]*e+n,d=t[i++]*e+r,p=t[i++]*e+n,f=t[i++]*e+r,o.bezierCurveTo(h,d,p,f,c,u)}}}return{offsetX:s.ha*e,path:o}}function dCt(t){lMt.call(this,t)}let pCt;dCt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:dCt,load:function(t,e,n,r){const i=this,s=new uMt(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new uCt(t)}});const fCt={getContext:function(){return void 0===pCt&&(pCt=new(window.AudioContext||window.webkitAudioContext)),pCt},setContext:function(t){pCt=t}};function mCt(t){lMt.call(this,t)}function gCt(t,e,n){QMt.call(this,void 0,n);const r=(new lwt).set(t),i=(new lwt).set(e),s=new Uvt(r.r,r.g,r.b),o=new Uvt(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}function yCt(t,e){QMt.call(this,void 0,e);const n=(new lwt).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}mCt.prototype=Object.assign(Object.create(lMt.prototype),{constructor:mCt,load:function(t,e,n,r){const i=this,s=new uMt(i.manager);s.setResponseType("arraybuffer"),s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);fCt.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}),gCt.prototype=Object.assign(Object.create(QMt.prototype),{constructor:gCt,isHemisphereLightProbe:!0,copy:function(t){return QMt.prototype.copy.call(this,t),this},toJSON:function(t){return QMt.prototype.toJSON.call(this,t)}}),yCt.prototype=Object.assign(Object.create(QMt.prototype),{constructor:yCt,isAmbientLightProbe:!0,copy:function(t){return QMt.prototype.copy.call(this,t),this},toJSON:function(t){return QMt.prototype.toJSON.call(this,t)}});const bCt=new mxt,vCt=new mxt;function xCt(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new l_t,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new l_t,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(xCt.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,s=e.near*Math.tan(Nvt.DEG2RAD*e.fov*.5)/e.zoom;let o,a;vCt.elements[12]=-r,bCt.elements[12]=r,o=-s*e.aspect+i,a=s*e.aspect+i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(n),o=-s*e.aspect-i,a=s*e.aspect-i,n.elements[0]=2*e.near/(a-o),n.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(vCt),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(bCt)}});class wCt{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=_Ct(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=_Ct();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function _Ct(){return("undefined"==typeof performance?Date:performance).now()}const SCt=new Uvt,kCt=new Bvt,TCt=new Uvt,ECt=new Uvt;class MCt extends Bxt{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const CCt=new Uvt,ACt=new Bvt,NCt=new Uvt,ICt=new Uvt;class $Ct{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}function RCt(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(RCt.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){o.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){Bvt.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){const s=this._workIndex*i;Bvt.multiplyQuaternionsFlat(t,s,t,e,t,n),Bvt.slerpFlat(t,e,t,e,t,s,r)},_lerp:function(t,e,n,r,i){const s=1-r;for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]*s+t[n+o]*r}},_lerpAdditive:function(t,e,n,r,i){for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]+t[n+s]*r}}});const OCt="\\[\\]\\.:\\/",PCt=new RegExp("[\\[\\]\\.:\\/]","g"),LCt="[^\\[\\]\\.:\\/]",DCt="[^"+OCt.replace("\\.","")+"]",FCt=/((?:WC+[\/:])*)/.source.replace("WC",LCt),zCt=/(WCOD+)?/.source.replace("WCOD",DCt),BCt=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",LCt),UCt=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",LCt),VCt=new RegExp("^"+FCt+zCt+BCt+UCt+"$"),jCt=["material","materials","bones"];function WCt(t,e,n){const r=n||HCt.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function HCt(t,e,n){this.path=e,this.parsedPath=n||HCt.parseTrackName(e),this.node=HCt.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function GCt(){this.uuid=Nvt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(WCt.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(HCt,{Composite:WCt,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new HCt.Composite(t,e,n):new HCt(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(PCt,"")},parseTrackName:function(t){const e=VCt.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==jCt.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(HCt.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=HCt.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(HCt.prototype,{_getValue_unbound:HCt.prototype.getValue,_setValue_unbound:HCt.prototype.setValue}),Object.assign(GCt.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=e[h];if(void 0===d){d=a++,e[h]=d,t.push(u);for(let t=0,e=s;t!==e;++t)i[t].push(new HCt(u,n[t],r[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[h]=a,t[a]=u;for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new HCt(u,n[t],r[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=i){const s=i++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[l];e[l]=r,e[s]=i}}}this.nCachedObjects_=i},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<i){const o=--i,a=t[o],c=--s,u=t[c];e[a.uuid]=l,t[l]=a,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[c];e[l]=r,e[o]=i,e.pop()}}else{const i=--s,o=t[i];i>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,s.push(t),o.push(e),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new HCt(r,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});class qCt{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,s=i.length,o=new Array(s),a={endingStart:hvt,endingEnd:hvt};for(let t=0;t!==s;++t){const e=i[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===mvt)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const s=2202===n;if(0===t)return-1===i?r:s&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=dvt,r.endingEnd=dvt):(r.endingStart=t?this.zeroSlopeAtStart?dvt:hvt:pvt,r.endingEnd=e?this.zeroSlopeAtEnd?dvt:hvt:pvt)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}}function XCt(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}XCt.prototype=Object.assign(Object.create(Mvt.prototype),{constructor:XCt,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==i;++t){const i=r[t],l=i.name;let u=c[l];if(void 0!==u)s[t]=u;else{if(u=s[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;u=new RCt(HCt.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[t]=u}o[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,i=this._actionsByClip;let s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new qEt(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,i=r.uuid;let s="string"==typeof t?rMt.findByName(r,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:fvt),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new qCt(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c},existingAction:function(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?rMt.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o){e[o]._update(r,t,i,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class YCt{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new YCt(void 0===this.value.clone?this.value:this.value.clone())}}function KCt(t,e,n){Ckt.call(this,t,e),this.meshPerAttribute=n||1}function ZCt(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function JCt(t,e,n,r){this.ray=new fxt(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new Ext,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function QCt(t,e){return t.distance-e.distance}function tAt(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)tAt(r[t],e,n,!0)}}KCt.prototype=Object.assign(Object.create(Ckt.prototype),{constructor:KCt,isInstancedInterleavedBuffer:!0,copy:function(t){return Ckt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=Ckt.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=Ckt.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(ZCt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ZCt.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(JCt.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,n){const r=n||[];return tAt(t,this,r,e),r.sort(QCt),r},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=t.length;n<i;n++)tAt(t[n],this,r,e);return r.sort(QCt),r}});class eAt{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Nvt.clamp(e/this.radius,-1,1))),this}}const nAt=new Ivt;class rAt{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Ivt(1/0,1/0),this.max=void 0!==e?e:new Ivt(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=nAt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Ivt),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Ivt),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Ivt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Ivt),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return nAt.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const iAt=new Uvt,sAt=new Uvt;class oAt{constructor(t,e){this.start=void 0!==t?t:new Uvt,this.end=void 0!==e?e:new Uvt}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Uvt),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Uvt),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Uvt),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){iAt.subVectors(t,this.start),sAt.subVectors(this.end,this.start);const n=sAt.dot(sAt);let r=sAt.dot(iAt)/n;return e&&(r=Nvt.clamp(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Uvt),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function aAt(t){Bxt.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}aAt.prototype=Object.create(Bxt.prototype),aAt.prototype.constructor=aAt,aAt.prototype.isImmediateRenderObject=!0;const lAt=new Uvt;const cAt=new Uvt,uAt=new mxt,hAt=new mxt;class dAt extends xTt{constructor(t){const e=pAt(t),n=new Lwt,r=[],i=[],s=new lwt(0,0,1),o=new lwt(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new kwt(r,3)),n.setAttribute("color",new kwt(i,3));super(n,new hTt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");hAt.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(uAt.multiplyMatrices(hAt,i.matrixWorld),cAt.setFromMatrixPosition(uAt),r.setXYZ(n,cAt.x,cAt.y,cAt.z),uAt.multiplyMatrices(hAt,i.parent.matrixWorld),cAt.setFromMatrixPosition(uAt),r.setXYZ(n+1,cAt.x,cAt.y,cAt.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function pAt(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,pAt(t.children[n]));return e}const fAt=new Uvt,mAt=new lwt,gAt=new lwt;class yAt extends xTt{constructor(t=10,e=10,n=4473924,r=8947848){n=new lwt(n),r=new lwt(r);const i=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,u=-o;t<=e;t++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const e=t===i?n:r;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Lwt;c.setAttribute("position",new kwt(a,3)),c.setAttribute("color",new kwt(l,3));super(c,new hTt({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const bAt=new Uvt,vAt=new Uvt,xAt=new Uvt;const wAt=new Uvt,_At=new a_t;function SAt(t,e,n,r,i,s,o){wAt.set(i,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],wAt.x,wAt.y,wAt.z)}}const kAt=new Wvt;class TAt extends xTt{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Lwt;i.setIndex(new mwt(n,1)),i.setAttribute("position",new mwt(r,3)),super(i,new hTt({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&kAt.setFromObject(this.object),kAt.isEmpty())return;const e=kAt.min,n=kAt.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return xTt.prototype.copy.call(this,t),this.object=t.object,this}}const EAt=new Uvt;let MAt,CAt;class AAt extends xTt{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Lwt;n.setAttribute("position",new kwt(e,3)),n.setAttribute("color",new kwt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new hTt({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const NAt=new Float32Array(1),IAt=new Int32Array(NAt.buffer),$At={toHalfFloat:function(t){NAt[0]=t;const e=IAt[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},RAt=Math.pow(2,8),OAt=[.125,.215,.35,.446,.526,.582],PAt=5+OAt.length,LAt=20,DAt={[gvt]:0,[yvt]:1,[vvt]:2,[xvt]:3,[wvt]:4,[_vt]:5,[bvt]:6},FAt=new dwt({side:1,depthWrite:!1,depthTest:!1}),zAt=new t_t(new n_t,FAt),BAt=new qMt,{_lodPlanes:UAt,_sizeLods:VAt,_sigmas:jAt}=ZAt(),WAt=new lwt;let HAt=null;const GAt=(1+Math.sqrt(5))/2,qAt=1/GAt,XAt=[new Uvt(1,1,1),new Uvt(-1,1,1),new Uvt(1,1,-1),new Uvt(-1,1,-1),new Uvt(0,GAt,qAt),new Uvt(0,GAt,-qAt),new Uvt(qAt,0,GAt),new Uvt(-qAt,0,GAt),new Uvt(GAt,qAt,0),new Uvt(-GAt,qAt,0)];function YAt(t){const e=Math.max(t.r,t.g,t.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);t.multiplyScalar(Math.pow(2,-n));return(n+128)/255}function KAt(t){return void 0!==t&&t.type===Vbt&&(t.encoding===gvt||t.encoding===yvt||t.encoding===bvt)}function ZAt(){const t=[],e=[],n=[];let r=8;for(let i=0;i<PAt;i++){const s=Math.pow(2,r);e.push(s);let o=1/s;i>4?o=OAt[i-8+4-1]:0==i&&(o=0),n.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),y=new Float32Array(f*d*h),b=new Float32Array(m*d*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(r,p*d*t),y.set(u,f*d*t);const i=[t,t,t,t,t,t];b.set(i,m*d*t)}const v=new Lwt;v.setAttribute("position",new mwt(g,p)),v.setAttribute("uv",new mwt(y,f)),v.setAttribute("faceIndex",new mwt(b,m)),t.push(v),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function JAt(t){const e=new zvt(3*RAt,3*RAt,t);return e.texture.mapping=Ibt,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function QAt(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function tNt(){return new OEt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Ivt(1,1)},inputEncoding:{value:DAt[3e3]},outputEncoding:{value:DAt[3e3]}},vertexShader:nNt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${rNt()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function eNt(){return new OEt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:DAt[3e3]},outputEncoding:{value:DAt[3e3]}},vertexShader:nNt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${rNt()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function nNt(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function rNt(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function iNt(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),TMt.call(this,t),this.type="catmullrom",this.closed=!0}function sNt(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),TMt.call(this,t),this.type="catmullrom"}function oNt(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),TMt.call(this,t),this.type="catmullrom"}yMt.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(yMt.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(FMt.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),iNt.prototype=Object.create(TMt.prototype),sNt.prototype=Object.create(TMt.prototype),oNt.prototype=Object.create(TMt.prototype),Object.assign(oNt.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),yAt.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},dAt.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(lMt.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),eCt.extractUrlBase(t)}}),lMt.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(rAt.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Wvt.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(oxt.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),g_t.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},oAt.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Nvt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Nvt.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Nvt.ceilPowerOfTwo(t)}}),Object.assign($vt.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(mxt.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Uvt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Wxt.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(Bvt.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(fxt.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(ewt.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(ewt,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ewt.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ewt.getNormal(t,e,n,r)}}),Object.assign(zMt.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new yEt(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new kEt(this,t)}}),Object.assign(Ivt.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Uvt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Fvt.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Bxt.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Bxt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(t_t.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(t_t.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Ykt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(sTt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),eTt.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(yMt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),l_t.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(BMt.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(mwt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tvt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tvt)}}}),Object.assign(mwt.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tvt:kvt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Lwt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new mwt(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Lwt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(nCt.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(JCt.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ckt.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Tvt},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ckt.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Tvt:kvt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(yEt.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(Mkt.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(YCt.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(hwt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new lwt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(DEt.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(LEt.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(o_t.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Skt.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Skt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?yvt:gvt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(fkt.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(zvt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(MCt.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new mCt).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),$Ct.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},u_t.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},u_t.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)};const aNt={merge:function(t,e,n){let r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};Ovt.crossOrigin=void 0,Ovt.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new gMt;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Ovt.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new fMt;i.setCrossOrigin(this.crossOrigin);const s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Ovt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ovt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const lNt={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_bt}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_bt);var cNt=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:Tbt,AddOperation:2,AdditiveAnimationBlendMode:mvt,AdditiveBlending:2,AlphaFormat:1021,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:KMt,AmbientLightProbe:yCt,AnimationClip:rMt,AnimationLoader:hMt,AnimationMixer:XCt,AnimationObjectGroup:GCt,AnimationUtils:WEt,ArcCurve:vMt,ArrayCamera:bkt,ArrowHelper:class extends Bxt{constructor(t,e,n,r,i,s){super(),this.type="ArrowHelper",void 0===t&&(t=new Uvt(0,0,1)),void 0===e&&(e=new Uvt(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===s&&(s=.2*i),void 0===MAt&&(MAt=new Lwt,MAt.setAttribute("position",new kwt([0,0,0,0,1,0],3)),CAt=new OTt(0,.5,1,5,1),CAt.translate(0,-.5,0)),this.position.copy(e),this.line=new yTt(MAt,new hTt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new t_t(CAt,new dwt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{EAt.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(EAt,e)}}setLength(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},Audio:MCt,AudioAnalyser:$Ct,AudioContext:fCt,AudioListener:class extends Bxt{constructor(){super(),this.type="AudioListener",this.context=fCt.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new wCt}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(SCt,kCt,TCt),ECt.set(0,0,-1).applyQuaternion(kCt),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(SCt.x,t),e.positionY.linearRampToValueAtTime(SCt.y,t),e.positionZ.linearRampToValueAtTime(SCt.z,t),e.forwardX.linearRampToValueAtTime(ECt.x,t),e.forwardY.linearRampToValueAtTime(ECt.y,t),e.forwardZ.linearRampToValueAtTime(ECt.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(SCt.x,SCt.y,SCt.z),e.setOrientation(ECt.x,ECt.y,ECt.z,n.x,n.y,n.z)}},AudioLoader:mCt,AxesHelper:AAt,AxisHelper:function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AAt(t)},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new mMt(t)},Bone:nTt,BooleanKeyframeTrack:KEt,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new TAt(t,e)},Box2:rAt,Box3:Wvt,Box3Helper:class extends xTt{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Lwt;r.setIndex(new mwt(n,1)),r.setAttribute("position",new kwt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new hTt({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},BoxBufferGeometry:n_t,BoxGeometry:n_t,BoxHelper:TAt,BufferAttribute:mwt,BufferGeometry:Lwt,BufferGeometryLoader:iCt,ByteType:1010,Cache:sMt,Camera:a_t,CameraHelper:class extends xTt{constructor(t){const e=new Lwt,n=new hTt({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={},o=new lwt(16755200),a=new lwt(16711680),l=new lwt(43775),c=new lwt(16777215),u=new lwt(3355443);function h(t,e,n){d(t,n),d(e,n)}function d(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new kwt(r,3)),e.setAttribute("color",new kwt(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;_At.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),SAt("c",e,t,_At,0,0,-1),SAt("t",e,t,_At,0,0,1),SAt("n1",e,t,_At,-1,-1,-1),SAt("n2",e,t,_At,1,-1,-1),SAt("n3",e,t,_At,-1,1,-1),SAt("n4",e,t,_At,1,1,-1),SAt("f1",e,t,_At,-1,-1,1),SAt("f2",e,t,_At,1,-1,1),SAt("f3",e,t,_At,-1,1,1),SAt("f4",e,t,_At,1,1,1),SAt("u1",e,t,_At,.7,1.1,-1),SAt("u2",e,t,_At,-.7,1.1,-1),SAt("u3",e,t,_At,0,2,-1),SAt("cf1",e,t,_At,-1,0,1),SAt("cf2",e,t,_At,1,0,1),SAt("cf3",e,t,_At,0,-1,1),SAt("cf4",e,t,_At,0,1,1),SAt("cn1",e,t,_At,-1,0,-1),SAt("cn2",e,t,_At,1,0,-1),SAt("cn3",e,t,_At,0,-1,-1),SAt("cn4",e,t,_At,0,1,-1),t.getAttribute("position").needsUpdate=!0}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:ITt,CatmullRomCurve3:TMt,CineonToneMapping:3,CircleBufferGeometry:RTt,CircleGeometry:RTt,ClampToEdgeWrapping:Obt,Clock:wCt,ClosedSplineCurve3:iNt,Color:lwt,ColorKeyframeTrack:ZEt,CompressedTexture:NTt,CompressedTextureLoader:dMt,ConeBufferGeometry:PTt,ConeGeometry:PTt,CubeCamera:u_t,CubeReflectionMapping:Mbt,CubeRefractionMapping:Cbt,CubeTexture:h_t,CubeTextureLoader:fMt,CubeUVReflectionMapping:Ibt,CubeUVRefractionMapping:$bt,CubicBezierCurve:AMt,CubicBezierCurve3:NMt,CubicInterpolant:GEt,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:yMt,CurvePath:DMt,CustomBlending:5,CustomToneMapping:5,CylinderBufferGeometry:OTt,CylinderGeometry:OTt,Cylindrical:class{constructor(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}},DataTexture:p_t,DataTexture2DArray:D_t,DataTexture3D:F_t,DataTextureLoader:mMt,DataUtils:$At,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:aMt,DepthFormat:Kbt,DepthStencilFormat:Zbt,DepthTexture:$Tt,DirectionalLight:YMt,DirectionalLightHelper:class extends Bxt{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new Lwt;r.setAttribute("position",new kwt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new hTt({fog:!1,toneMapped:!1});this.lightPlane=new yTt(r,i),this.add(this.lightPlane),r=new Lwt,r.setAttribute("position",new kwt([0,0,0,0,0,1],3)),this.targetLine=new yTt(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){bAt.setFromMatrixPosition(this.light.matrixWorld),vAt.setFromMatrixPosition(this.light.target.matrixWorld),xAt.subVectors(vAt,bAt),this.lightPlane.lookAt(vAt),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vAt),this.targetLine.scale.z=xAt.length()}},DiscreteInterpolant:XEt,DodecahedronBufferGeometry:DTt,DodecahedronGeometry:DTt,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new mwt(t,e).setUsage(Tvt)},DynamicCopyUsage:35050,DynamicDrawUsage:Tvt,DynamicReadUsage:35049,EdgesGeometry:VTt,EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new xTt(new VTt(t.geometry),new hTt({color:void 0!==e?e:16777215}))},EllipseCurve:bMt,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:Abt,EquirectangularRefractionMapping:Nbt,Euler:Sxt,EventDispatcher:Mvt,ExtrudeBufferGeometry:yEt,ExtrudeGeometry:yEt,Face3:cwt,Face4:function(t,e,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new cwt(t,e,n,i,s,o)},FaceColors:1,FileLoader:uMt,FlatShading:1,Float16BufferAttribute:Swt,Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new kwt(t,e)},Float32BufferAttribute:kwt,Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Twt(t,e)},Float64BufferAttribute:Twt,FloatType:Hbt,Fog:Ekt,FogExp2:Tkt,Font:uCt,FontLoader:dCt,FrontSide:0,Frustum:g_t,GLBufferAttribute:ZCt,GLSL1:"100",GLSL3:Evt,GammaEncoding:bvt,GeometryUtils:aNt,GreaterDepth:6,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:yAt,Group:vkt,HalfFloatType:Gbt,HemisphereLight:UMt,HemisphereLightHelper:class extends Bxt{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new wEt(e);r.rotateY(.5*Math.PI),this.material=new dwt({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new mwt(s,3)),this.add(new t_t(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");mAt.copy(this.light.color),gAt.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?mAt:gAt;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(fAt.setFromMatrixPosition(this.light.matrixWorld).negate())}},HemisphereLightProbe:gCt,IcosahedronBufferGeometry:vEt,IcosahedronGeometry:vEt,ImageBitmapLoader:lCt,ImageLoader:pMt,ImageUtils:Ovt,ImmediateRenderObject:aAt,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:rCt,InstancedBufferGeometry:nCt,InstancedInterleavedBuffer:KCt,InstancedMesh:uTt,Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new vwt(t,e)},Int16BufferAttribute:vwt,Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new wwt(t,e)},Int32BufferAttribute:wwt,Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new gwt(t,e)},Int8BufferAttribute:gwt,IntType:1013,InterleavedBuffer:Ckt,InterleavedBufferAttribute:Nkt,Interpolant:HEt,InterpolateDiscrete:lvt,InterpolateLinear:cvt,InterpolateSmooth:uvt,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:Svt,KeyframeTrack:YEt,LOD:Ykt,LatheBufferGeometry:xEt,LatheGeometry:xEt,Layers:Ext,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:2,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:BMt,LightProbe:QMt,Line:yTt,Line3:oAt,LineBasicMaterial:hTt,LineCurve:IMt,LineCurve3:$Mt,LineDashedMaterial:VEt,LineLoop:wTt,LinePieces:1,LineSegments:xTt,LineStrip:0,LinearEncoding:gvt,LinearFilter:zbt,LinearInterpolant:qEt,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:Ubt,LinearMipmapNearestFilter:Bbt,LinearToneMapping:1,Loader:lMt,LoaderUtils:eCt,LoadingManager:oMt,LogLuvEncoding:3003,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:Sbt,Material:hwt,MaterialLoader:tCt,Math:Nvt,MathUtils:Nvt,Matrix3:$vt,Matrix4:mxt,MaxEquation:104,Mesh:t_t,MeshBasicMaterial:dwt,MeshDepthMaterial:dkt,MeshDistanceMaterial:pkt,MeshFaceMaterial:function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},MeshLambertMaterial:BEt,MeshMatcapMaterial:UEt,MeshNormalMaterial:zEt,MeshPhongMaterial:DEt,MeshPhysicalMaterial:LEt,MeshStandardMaterial:PEt,MeshToonMaterial:FEt,MinEquation:103,MirroredRepeatWrapping:Pbt,MixOperation:1,MultiMaterial:function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},MultiplyBlending:4,MultiplyOperation:0,NearestFilter:Lbt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:Fbt,NearestMipmapNearestFilter:Dbt,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColors:0,NoToneMapping:0,NormalAnimationBlendMode:fvt,NormalBlending:1,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:JEt,Object3D:Bxt,ObjectLoader:class extends lMt{constructor(t){super(t)}load(t,e,n,r){const i=this,s=""===this.path?eCt.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new uMt(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,i,a,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new zMt).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new sTt).fromJSON(t[e],r);n[i.uuid]=i}return n}parseGeometries(t,e){const n={};let r;if(void 0!==t){const i=new iCt;for(let s=0,o=t.length;s<o;s++){let o;const a=t[s];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new $Et[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new $Et[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new $Et[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new $Et[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new $Et[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new $Et[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new $Et[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new $Et[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new $Et[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new $Et[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new $Et[a.type]((new LMt[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new $Et[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new $Et[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}o=new $Et[a.type](r,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let t=0,n=a.shapes.length;t<n;t++){const n=e[a.shapes[t]];r.push(n)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new LMt[t.type]).fromJSON(t)),o=new $Et[a.type](r,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new tCt;i.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const r=s.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=rMt.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:Cwt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new oMt(e);i=new pMt(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=s(i[t]);null!==e&&(e instanceof HTMLImageElement?r[n.uuid].push(e):r[n.uuid].push(new p_t(e.data,e.width,e.height)))}}else{const t=s(n.url);null!==t&&(r[n.uuid]=t)}}}return r}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,s=t.length;i<s;i++){const s=t[i];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image];Array.isArray(a)?(o=new h_t(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new p_t(a.data,a.width,a.height):new Lvt(a),a&&(o.needsUpdate=!0)),o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,sCt)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],oCt),o.wrapT=n(s.wrap[1],oCt)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,aCt)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,aCt)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r}parseObject(t,e,n,r){let i,s,o;function a(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new Mkt,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new lwt(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new Ekt(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new Tkt(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new l_t(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new qMt(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new KMt(t.color,t.intensity);break;case"DirectionalLight":i=new YMt(t.color,t.intensity);break;case"PointLight":i=new GMt(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new ZMt(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new WMt(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new UMt(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new QMt).fromJSON(t);break;case"SkinnedMesh":s=a(t.geometry),o=l(t.material),i=new eTt(s,o),void 0!==t.bindMode&&(i.bindMode=t.bindMode),void 0!==t.bindMatrix&&i.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"Mesh":s=a(t.geometry),o=l(t.material),i=new t_t(s,o);break;case"InstancedMesh":s=a(t.geometry),o=l(t.material);const e=t.count,n=t.instanceMatrix;i=new uTt(s,o,e),i.instanceMatrix=new mwt(new Float32Array(n.array),16);break;case"LOD":i=new Ykt;break;case"Line":i=new yTt(a(t.geometry),l(t.material));break;case"LineLoop":i=new wTt(a(t.geometry),l(t.material));break;case"LineSegments":i=new xTt(a(t.geometry),l(t.material));break;case"PointCloud":case"Points":i=new MTt(a(t.geometry),l(t.material));break;case"Sprite":i=new Hkt(l(t.material));break;case"Group":i=new vkt;break;case"Bone":i=new nTt;break;default:i=new Bxt}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const s=t.children;for(let t=0;t<s.length;t++)i.add(this.parseObject(s[t],e,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];i.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},ObjectSpaceNormalMap:1,OctahedronBufferGeometry:wEt,OctahedronGeometry:wEt,OneFactor:201,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:205,OneMinusSrcColorFactor:203,OrthographicCamera:qMt,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new Uvt(0,1,0);return new OEt({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:DAt[3e3]},outputEncoding:{value:DAt[3e3]}},vertexShader:nNt(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${rNt()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(LAt),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){HAt=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=eNt(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=tNt(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<UAt.length;t++)UAt[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(HAt),t.scissorTest=!1,QAt(t,0,0,t.width,t.height)}_fromTexture(t){HAt=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:Lbt,minFilter:Lbt,generateMipmaps:!1,type:Vbt,format:1023,encoding:KAt(t)?t.encoding:vvt,depthBuffer:!1},n=JAt(e);return n.depthBuffer=!t,this._pingPongRenderTarget=JAt(e),n}_compileMaterial(t){const e=new t_t(UAt[0],t);this._renderer.compile(e,BAt)}_sceneToCubeUV(t,e,n,r){const i=new l_t(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(WAt),a.toneMapping=0,a.outputEncoding=gvt,a.autoClear=!1;let h=!1;const d=t.background;if(d){if(d.isColor){FAt.color.copy(d).convertSRGBToLinear(),t.background=null;const e=YAt(FAt.color);FAt.opacity=e,h=!0}}else{FAt.color.copy(WAt).convertSRGBToLinear();const t=YAt(FAt.color);FAt.opacity=t,h=!0}for(let e=0;e<6;e++){const n=e%3;0==n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1==n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e])),QAt(r,n*RAt,e>2?RAt:0,RAt,RAt),a.setRenderTarget(r),h&&a.render(zAt,i),a.render(t,i)}a.toneMapping=u,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=eNt()):null==this._equirectShader&&(this._equirectShader=tNt());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new t_t(UAt[0],r),s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=DAt[t.encoding],s.outputEncoding.value=DAt[e.texture.encoding],QAt(e,0,0,3*RAt,2*RAt),n.setRenderTarget(e),n.render(i,BAt)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<PAt;e++){const n=Math.sqrt(jAt[e]*jAt[e]-jAt[e-1]*jAt[e-1]),r=XAt[(e-1)%XAt.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new t_t(UAt[r],l),u=l.uniforms,h=VAt[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):LAt;f>LAt&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<LAt;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=DAt[t.texture.encoding],u.outputEncoding.value=DAt[t.texture.encoding];const y=VAt[r];QAt(e,3*Math.max(0,RAt-2*y),(0===r?0:2*RAt)+2*y*(r>4?r-8+4:0),3*y,2*y),a.setRenderTarget(e),a.render(c,BAt)}},ParametricBufferGeometry:_Et,ParametricGeometry:_Et,Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Hkt(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new _Tt(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new MTt(t,e)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new _Tt(t)},Path:FMt,PerspectiveCamera:l_t,Plane:Wxt,PlaneBufferGeometry:v_t,PlaneGeometry:v_t,PlaneHelper:class extends yTt{constructor(t,e=1,n=16776960){const r=n,i=new Lwt;i.setAttribute("position",new kwt([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new hTt({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Lwt;s.setAttribute("position",new kwt([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new t_t(s,new dwt({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new MTt(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new _Tt(t)},PointLight:GMt,PointLightHelper:class extends t_t{constructor(t,e,n){super(new TEt(e,4,2),new dwt({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:MTt,PointsMaterial:_Tt,PolarGridHelper:class extends xTt{constructor(t=10,e=16,n=8,r=64,i=4473924,s=8947848){i=new lwt(i),s=new lwt(s);const o=[],a=[];for(let n=0;n<=e;n++){const r=n/e*(2*Math.PI),l=Math.sin(r)*t,c=Math.cos(r)*t;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const l=1&e?i:s,c=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c;o.push(n,0,i),a.push(l.r,l.g,l.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c,o.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new Lwt;l.setAttribute("position",new kwt(o,3)),l.setAttribute("color",new kwt(a,3));super(l,new hTt({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},PolyhedronBufferGeometry:LTt,PolyhedronGeometry:LTt,PositionalAudio:class extends MCt{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(CCt,ACt,NCt),ICt.set(0,0,1).applyQuaternion(ACt);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(CCt.x,t),e.positionY.linearRampToValueAtTime(CCt.y,t),e.positionZ.linearRampToValueAtTime(CCt.z,t),e.orientationX.linearRampToValueAtTime(ICt.x,t),e.orientationY.linearRampToValueAtTime(ICt.y,t),e.orientationZ.linearRampToValueAtTime(ICt.z,t)}else e.setPosition(CCt.x,CCt.y,CCt.z),e.setOrientation(ICt.x,ICt.y,ICt.z)}},PropertyBinding:HCt,PropertyMixer:RCt,QuadraticBezierCurve:RMt,QuadraticBezierCurve3:OMt,Quaternion:Bvt,QuaternionKeyframeTrack:tMt,QuaternionLinearInterpolant:QEt,REVISION:_bt,RGBADepthPacking:3201,RGBAFormat:Ybt,RGBAIntegerFormat:1033,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:avt,RGBA_PVRTC_2BPPV1_Format:svt,RGBA_PVRTC_4BPPV1_Format:ivt,RGBA_S3TC_DXT1_Format:Qbt,RGBA_S3TC_DXT3_Format:tvt,RGBA_S3TC_DXT5_Format:evt,RGBDEncoding:_vt,RGBEEncoding:vvt,RGBEFormat:1023,RGBFormat:Xbt,RGBIntegerFormat:1032,RGBM16Encoding:wvt,RGBM7Encoding:xvt,RGB_ETC1_Format:36196,RGB_ETC2_Format:ovt,RGB_PVRTC_2BPPV1_Format:rvt,RGB_PVRTC_4BPPV1_Format:nvt,RGB_S3TC_DXT1_Format:Jbt,RGFormat:1030,RGIntegerFormat:1031,RawShaderMaterial:OEt,Ray:fxt,Raycaster:JCt,RectAreaLight:ZMt,RedFormat:1028,RedIntegerFormat:1029,ReinhardToneMapping:2,RepeatWrapping:Rbt,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingBufferGeometry:SEt,RingGeometry:SEt,SRGB8_ALPHA8_ASTC_10x10_Format:37851,SRGB8_ALPHA8_ASTC_10x5_Format:37848,SRGB8_ALPHA8_ASTC_10x6_Format:37849,SRGB8_ALPHA8_ASTC_10x8_Format:37850,SRGB8_ALPHA8_ASTC_12x10_Format:37852,SRGB8_ALPHA8_ASTC_12x12_Format:37853,SRGB8_ALPHA8_ASTC_4x4_Format:37840,SRGB8_ALPHA8_ASTC_5x4_Format:37841,SRGB8_ALPHA8_ASTC_5x5_Format:37842,SRGB8_ALPHA8_ASTC_6x5_Format:37843,SRGB8_ALPHA8_ASTC_6x6_Format:37844,SRGB8_ALPHA8_ASTC_8x5_Format:37845,SRGB8_ALPHA8_ASTC_8x6_Format:37846,SRGB8_ALPHA8_ASTC_8x8_Format:37847,Scene:Mkt,SceneUtils:lNt,ShaderChunk:x_t,ShaderLib:__t,ShaderMaterial:o_t,ShadowMaterial:REt,Shape:zMt,ShapeBufferGeometry:kEt,ShapeGeometry:kEt,ShapePath:cCt,ShapeUtils:fEt,ShortType:1011,Skeleton:sTt,SkeletonHelper:dAt,SkinnedMesh:eTt,SmoothShading:2,Sphere:oxt,SphereBufferGeometry:TEt,SphereGeometry:TEt,Spherical:eAt,SphericalHarmonics3:JMt,Spline:oNt,SplineCurve:PMt,SplineCurve3:sNt,SpotLight:WMt,SpotLightHelper:class extends Bxt{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Lwt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,s=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new kwt(r,3));const i=new hTt({fog:!1,toneMapped:!1});this.cone=new xTt(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),lAt.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lAt),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:Hkt,SpriteMaterial:Ikt,SrcAlphaFactor:204,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:kvt,StaticReadUsage:35045,StereoCamera:xCt,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:eMt,SubtractEquation:101,SubtractiveBlending:3,TOUCH:kbt,TangentSpaceNormalMap:0,TetrahedronBufferGeometry:EEt,TetrahedronGeometry:EEt,TextBufferGeometry:MEt,TextGeometry:MEt,Texture:Lvt,TextureLoader:gMt,TorusBufferGeometry:CEt,TorusGeometry:CEt,TorusKnotBufferGeometry:AEt,TorusKnotGeometry:AEt,Triangle:ewt,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:NEt,TubeGeometry:NEt,UVMapping:Ebt,Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xwt(t,e)},Uint16BufferAttribute:xwt,Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new _wt(t,e)},Uint32BufferAttribute:_wt,Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ywt(t,e)},Uint8BufferAttribute:ywt,Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new bwt(t,e)},Uint8ClampedBufferAttribute:bwt,Uniform:YCt,UniformsLib:w_t,UniformsUtils:s_t,UnsignedByteType:Vbt,UnsignedInt248Type:qbt,UnsignedIntType:Wbt,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedShortType:jbt,VSMShadowMap:3,Vector2:Ivt,Vector3:Uvt,Vector4:Fvt,VectorKeyframeTrack:nMt,Vertex:function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Uvt(t,e,n)},VertexColors:2,VideoTexture:ATt,WebGL1Renderer:kkt,WebGLCubeRenderTarget:d_t,WebGLMultisampleRenderTarget:class extends zvt{constructor(t,e,n){super(t,e,n),Object.defineProperty(this,"isWebGLMultisampleRenderTarget",{value:!0}),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}},WebGLRenderTarget:zvt,WebGLRenderTargetCube:function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new d_t(t,n)},WebGLRenderer:Skt,WebGLUtils:ykt,WireframeGeometry:IEt,WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new xTt(new IEt(t.geometry),new hTt({color:void 0!==e?e:16777215}))},WrapAroundEnding:pvt,XHRLoader:function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new uMt(t)},ZeroCurvatureEnding:hvt,ZeroFactor:200,ZeroSlopeEnding:dvt,ZeroStencilOp:0,sRGBEncoding:yvt}),uNt=wr(cNt),hNt=function(t,e){void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new Uvt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Sbt.ROTATE,MIDDLE:Sbt.DOLLY,RIGHT:Sbt.PAN},this.touches={ONE:kbt.ROTATE,TWO:kbt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.listenToKeyEvents=function(t){t.addEventListener("keydown",W),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),a=o.NONE},this.update=function(){var e=new Uvt,i=(new Bvt).setFromUnitVectors(t.up,new Uvt(0,1,0)),s=i.clone().invert(),f=new Uvt,m=new Bvt,g=2*Math.PI;return function(){var t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(i),c.setFromVector3(e),n.autoRotate&&a===o.NONE&&k(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);var y=n.minAzimuthAngle,b=n.maxAzimuthAngle;return isFinite(y)&&isFinite(b)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),b<-Math.PI?b+=g:b>Math.PI&&(b-=g),c.theta=y<=b?Math.max(y,Math.min(b,c.theta)):c.theta>(y+b)/2?Math.max(y,c.theta):Math.min(b,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),e.setFromSpherical(c),e.applyQuaternion(s),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),f.copy(n.object.position),m.copy(n.object.quaternion),p=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",X),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("wheel",j),n.domElement.removeEventListener("touchstart",H),n.domElement.removeEventListener("touchend",q),n.domElement.removeEventListener("touchmove",G),n.domElement.ownerDocument.removeEventListener("pointermove",U),n.domElement.ownerDocument.removeEventListener("pointerup",V),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",W)};var n=this,r={type:"change"},i={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=o.NONE,l=1e-6,c=new eAt,u=new eAt,h=1,d=new Uvt,p=!1,f=new Ivt,m=new Ivt,g=new Ivt,y=new Ivt,b=new Ivt,v=new Ivt,x=new Ivt,w=new Ivt,_=new Ivt;function S(){return Math.pow(.95,n.zoomSpeed)}function k(t){u.theta-=t}function T(t){u.phi-=t}var E,M=(E=new Uvt,function(t,e){E.setFromMatrixColumn(e,0),E.multiplyScalar(-t),d.add(E)}),C=function(){var t=new Uvt;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),d.add(t)}}(),A=function(){var t=new Uvt;return function(e,r){var i=n.domElement;if(n.object.isPerspectiveCamera){var s=n.object.position;t.copy(s).sub(n.target);var o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),M(2*e*o/i.clientHeight,n.object.matrix),C(2*r*o/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(e*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),C(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function N(t){n.object.isPerspectiveCamera?h/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(t){n.object.isPerspectiveCamera?h*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function $(t){f.set(t.clientX,t.clientY)}function R(t){y.set(t.clientX,t.clientY)}function O(t){if(1==t.touches.length)f.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);f.set(e,n)}}function P(t){if(1==t.touches.length)y.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);y.set(e,n)}}function L(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);x.set(0,r)}function D(t){if(1==t.touches.length)m.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);m.set(e,r)}g.subVectors(m,f).multiplyScalar(n.rotateSpeed);var i=n.domElement;k(2*Math.PI*g.x/i.clientHeight),T(2*Math.PI*g.y/i.clientHeight),f.copy(m)}function F(t){if(1==t.touches.length)b.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);b.set(e,r)}v.subVectors(b,y).multiplyScalar(n.panSpeed),A(v.x,v.y),y.copy(b)}function z(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);w.set(0,i),_.set(0,Math.pow(w.y/x.y,n.zoomSpeed)),N(_.y),x.copy(w)}function B(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var e;switch(t.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Sbt.DOLLY:if(!1===n.enableZoom)return;!function(t){x.set(t.clientX,t.clientY)}(t),a=o.DOLLY;break;case Sbt.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;R(t),a=o.PAN}else{if(!1===n.enableRotate)return;$(t),a=o.ROTATE}break;case Sbt.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;$(t),a=o.ROTATE}else{if(!1===n.enablePan)return;R(t),a=o.PAN}break;default:a=o.NONE}a!==o.NONE&&(n.domElement.ownerDocument.addEventListener("pointermove",U),n.domElement.ownerDocument.addEventListener("pointerup",V),n.dispatchEvent(i))}(t)}}function U(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){if(!1===n.enabled)return;switch(t.preventDefault(),a){case o.ROTATE:if(!1===n.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),g.subVectors(m,f).multiplyScalar(n.rotateSpeed);var e=n.domElement;k(2*Math.PI*g.x/e.clientHeight),T(2*Math.PI*g.y/e.clientHeight),f.copy(m),n.update()}(t);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(t){w.set(t.clientX,t.clientY),_.subVectors(w,x),_.y>0?N(S()):_.y<0&&I(S()),x.copy(w),n.update()}(t);break;case o.PAN:if(!1===n.enablePan)return;!function(t){b.set(t.clientX,t.clientY),v.subVectors(b,y).multiplyScalar(n.panSpeed),A(v.x,v.y),y.copy(b),n.update()}(t)}}(t)}}function V(t){switch(t.pointerType){case"mouse":case"pen":!function(t){if(n.domElement.ownerDocument.removeEventListener("pointermove",U),n.domElement.ownerDocument.removeEventListener("pointerup",V),!1===n.enabled)return;n.dispatchEvent(s),a=o.NONE}()}}function j(t){!1===n.enabled||!1===n.enableZoom||a!==o.NONE&&a!==o.ROTATE||(t.preventDefault(),t.stopPropagation(),n.dispatchEvent(i),function(t){t.deltaY<0?I(S()):t.deltaY>0&&N(S()),n.update()}(t),n.dispatchEvent(s))}function W(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){var e=!1;switch(t.keyCode){case n.keys.UP:A(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:A(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:A(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:A(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function H(t){if(!1!==n.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(n.touches.ONE){case kbt.ROTATE:if(!1===n.enableRotate)return;O(t),a=o.TOUCH_ROTATE;break;case kbt.PAN:if(!1===n.enablePan)return;P(t),a=o.TOUCH_PAN;break;default:a=o.NONE}break;case 2:switch(n.touches.TWO){case kbt.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&L(t),n.enablePan&&P(t)}(t),a=o.TOUCH_DOLLY_PAN;break;case kbt.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&L(t),n.enableRotate&&O(t)}(t),a=o.TOUCH_DOLLY_ROTATE;break;default:a=o.NONE}break;default:a=o.NONE}a!==o.NONE&&n.dispatchEvent(i)}}function G(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),a){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;D(t),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;F(t),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&z(t),n.enablePan&&F(t)}(t),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&z(t),n.enableRotate&&D(t)}(t),n.update();break;default:a=o.NONE}}function q(t){!1!==n.enabled&&(n.dispatchEvent(s),a=o.NONE)}function X(t){!1!==n.enabled&&t.preventDefault()}n.domElement.addEventListener("contextmenu",X),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("wheel",j),n.domElement.addEventListener("touchstart",H),n.domElement.addEventListener("touchend",q),n.domElement.addEventListener("touchmove",G),this.update()};(hNt.prototype=Object.create(Mvt.prototype)).constructor=hNt;var dNt=function(t,e){hNt.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Sbt.PAN,this.mouseButtons.RIGHT=Sbt.ROTATE,this.touches.ONE=kbt.PAN,this.touches.TWO=kbt.DOLLY_ROTATE};(dNt.prototype=Object.create(Mvt.prototype)).constructor=dNt;var pNt=wr(Object.freeze({__proto__:null,OrbitControls:hNt,MapControls:dNt})),fNt={};!function(t){Object.defineProperty(t,"__esModule",{value:!0});var e,n=function(t,e,n,r,i,s,o){this.pointIndices=t,this.labelStrings=e,this.scaleFactors=n,this.useSceneOpacityFlags=r,this.defaultFontSize=i,this.fillColors=s,this.strokeColors=o};t.LabelRenderParams=n,(e=t.CameraType||(t.CameraType={}))[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic";var r=function(t,e,n,r,i,s,o,a,l,c,u,h,d,p){this.camera=t,this.cameraType=e,this.cameraTarget=n,this.screenWidth=r,this.screenHeight=i,this.nearestCameraSpacePointZ=s,this.farthestCameraSpacePointZ=o,this.backgroundColor=a,this.pointColors=l,this.pointScaleFactors=c,this.labels=u,this.polylineColors=h,this.polylineOpacities=d,this.polylineWidths=p};t.RenderContext=r}(fNt);var mNt={};Object.defineProperty(mNt,"__esModule",{value:!0});var gNt=uNt;function yNt(t,e){return void 0===e&&(e=!0),t.needsUpdate=e,t.minFilter=gNt.LinearFilter,t.generateMipmaps=!1,t.flipY=!1,t}mNt.vector3DToScreenCoords=function(t,e,n,r){var i=window.devicePixelRatio,s=(new gNt.Vector3).copy(r).project(t);return[(s.x+1)/2*e*i,-(s.y-1)/2*n*i]},mNt.vector3FromPackedArray=function(t,e){var n=3*e;return new gNt.Vector3(t[n],t[n+1],t[n+2])},mNt.getNearFarPoints=function(t,e,n){for(var r=1/0,i=0,s=(new gNt.Vector3).copy(n).sub(e),o=(new gNt.Vector3).copy(s).normalize(),a=t.length/3,l=0,c=new gNt.Vector3,u=new gNt.Vector3,h=0;h<a;h++){c.x=t[l],c.y=t[l+1],c.z=t[l+2],l+=3,u.copy(c).sub(e);var d=o.dot(u);d<0||(i=d>i?d:i,r=d<r?d:r)}return[r,i]},mNt.createTextureFromCanvas=function(t){return yNt(new gNt.Texture(t))},mNt.createTextureFromImage=function(t,e){var n=new gNt.Texture(t);return t.complete?(n.needsUpdate=!0,e()):t.onload=function(){n.needsUpdate=!0,e()},yNt(n,!1)},mNt.hasWebGLSupport=function(){try{var t=document.createElement("canvas");return null!=(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}},mNt.extent=function(t){for(var e=1/0,n=-1/0,r=0;r<t.length;r++){var i=t[r];i<e&&(e=i),i>n&&(n=i)}return[e,n]},mNt.scaleLinear=function(t,e,n){var r=e[1]-e[0],i=n[1]-n[0];return(t-e[0])/r*i+n[0]},mNt.scaleExponential=function(t,e,n){var r=Math.pow(e[1],Math.E)-Math.pow(e[0],Math.E),i=n[1]-n[0];return(Math.pow(t,Math.E)-e[0])/r*i+n[0]},mNt.packRgbIntoUint8Array=function(t,e,n,r,i){t[3*e]=n,t[3*e+1]=r,t[3*e+2]=i},mNt.styleRgbFromHexColor=function(t){var e=new gNt.Color(t);return[255*e.r|0,255*e.g|0,255*e.b|0]};var bNt=function(t){return 100*t+"%"};mNt.getDefaultPointInPolylineColor=function(t,e,n,r,i,s){var o="hsl("+(n+(r-n)*t/e)+", "+bNt(i)+", "+bNt(s)+")";return new gNt.Color(o)};var vNt={};Object.defineProperty(vNt,"__esModule",{value:!0});var xNt=function(){function t(t,e,n){this.startCoordinates=[0,0],this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.display="none",this.svgElement.style.height="100%",this.svgElement.style.width="100%",this.svgElement.style.position="absolute",t.insertAdjacentElement("afterbegin",this.svgElement),this.rectElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rectElement.style.stroke=n.select.stroke,this.rectElement.style.strokeDasharray=n.select.strokeDashArray,this.rectElement.style.strokeWidth=""+n.select.strokeWidth,this.rectElement.style.fill=n.select.fill,this.rectElement.style.fillOpacity=""+n.select.fillOpacity,this.svgElement.appendChild(this.rectElement),this.selectionCallback=e,this.isMouseDown=!1}return t.prototype.onMouseDown=function(t,e){this.isMouseDown=!0,this.rectElement.style.display="block",this.svgElement.style.display="block",this.startCoordinates=[t,e],this.lastBoundingBox={x:this.startCoordinates[0],y:this.startCoordinates[1],width:1,height:1}},t.prototype.onMouseMove=function(t,e){this.isMouseDown&&(this.lastBoundingBox.x=Math.min(t,this.startCoordinates[0]),this.lastBoundingBox.y=Math.max(e,this.startCoordinates[1]),this.lastBoundingBox.width=Math.max(t,this.startCoordinates[0])-this.lastBoundingBox.x,this.lastBoundingBox.height=this.lastBoundingBox.y-Math.min(e,this.startCoordinates[1]),this.rectElement.setAttribute("x",""+this.lastBoundingBox.x),this.rectElement.setAttribute("y",""+(this.lastBoundingBox.y-this.lastBoundingBox.height)),this.rectElement.setAttribute("width",""+this.lastBoundingBox.width),this.rectElement.setAttribute("height",""+this.lastBoundingBox.height))},t.prototype.onMouseUp=function(){this.isMouseDown=!1,this.svgElement.style.display="none",this.rectElement.style.display="none",this.rectElement.setAttribute("width","0"),this.rectElement.setAttribute("height","0"),this.selectionCallback(this.lastBoundingBox)},t}();vNt.ScatterPlotRectangleSelector=xNt;var wNt=vr&&vr.__assign||function(){return wNt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},wNt.apply(this,arguments)},_Nt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},SNt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(wbt,"__esModule",{value:!0});var kNt=uNt,TNt=pNt,ENt=fNt,MNt=mNt,CNt=vNt,ANt=1.2,NNt="Shift",INt="Control",$Nt=new kNt.Vector3(.45,.9,1.6),RNt=new kNt.Vector3(0,0,0),ONt=new kNt.Vector3(0,0,4),PNt=new kNt.Vector3(0,0,0),LNt={mouseRotateSpeed:1,autoRotateSpeed:2,zoomSpeed:.125},DNt=function(){function t(t,e){var n=this;this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.selectEnabled=!0,this.visualizers=new Map,this.onCameraMoveListeners=[],this.height=0,this.width=0,this.dimensions=3,this.interactionMode="PAN",this.pickingTexture=new kNt.WebGLRenderTarget(0,0),this.orbitAnimationOnNextCameraCreation=!1,this.orbitAnimationId=null,this.worldSpacePointPositions=new Float32Array(0),this.pointColors=new Float32Array(0),this.pointScaleFactors=new Float32Array(0),this.polylineColors={},this.polylineOpacities=new Float32Array(0),this.polylineWidths=new Float32Array(0),this.selecting=!1,this.nearestPoint=null,this.mouseIsDown=!1,this.isDragSequence=!1,this.lastHovered=null,this.container=t,this.styles=e.styles,this.setParameters(e),this.computeLayoutValues(),this.scene=new kNt.Scene,this.renderer=new kNt.WebGLRenderer({alpha:!0,premultipliedAlpha:!1,antialias:!1}),this.renderer.setClearColor(this.styles.backgroundColor,1),this.container.appendChild(this.renderer.domElement),this.light=new kNt.PointLight(16772287,1,0),this.scene.add(this.light),this.orbitControlParams=wNt(wNt({},LNt),e.orbitControlParams),this.rectangleSelector=new CNt.ScatterPlotRectangleSelector(this.container,(function(t){n.selectBoundingBox(t)}),this.styles),this.addInteractionListeners(),this.setDimensions(3),this.makeCamera(e.camera),this.resize()}return t.prototype.setParameters=function(t){void 0!==t.onClick&&(this.clickCallback=t.onClick),void 0!==t.onHover&&(this.hoverCallback=t.onHover),void 0!==t.onSelect&&(this.selectCallback=t.onSelect),void 0!==t.selectEnabled&&(this.selectEnabled=t.selectEnabled)},t.prototype.addInteractionListeners=function(){this.container.addEventListener("pointermove",this.onMouseMove.bind(this)),this.container.addEventListener("pointerdown",this.onMouseDown.bind(this)),this.container.addEventListener("pointerup",this.onMouseUp.bind(this)),this.container.addEventListener("click",this.onClick.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1)},t.prototype.addCameraControlsEventListeners=function(t){var e=this;t.addEventListener("start",(function(){e.stopOrbitAnimation(),e.onCameraMoveListeners.forEach((function(n){return n(e.camera.position,t.target)}))})),t.addEventListener("change",(function(){e.render()})),t.addEventListener("end",(function(){}))},t.prototype.makeOrbitControls=function(t,e){null!=this.orbitCameraControls&&this.orbitCameraControls.dispose();var n=new TNt.OrbitControls(t,this.renderer.domElement);n.zoomSpeed=this.orbitControlParams.zoomSpeed,n.enableRotate=e,n.autoRotate=!1,n.enableKeys=!1,n.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,e?(n.mouseButtons.LEFT=kNt.MOUSE.LEFT,n.mouseButtons.RIGHT=kNt.MOUSE.RIGHT):(n.mouseButtons.LEFT=kNt.MOUSE.RIGHT,n.mouseButtons.RIGHT=kNt.MOUSE.LEFT),n.reset(),this.camera=t,this.orbitCameraControls=n,this.addCameraControlsEventListeners(this.orbitCameraControls)},t.prototype.makeCamera=function(t){void 0===t&&(t={});var e=this.makeDefaultCameraDef(this.dimensions,t);this.recreateCamera(e),3===this.dimensions&&this.styles.axesVisible?this.add3dAxes():this.remove3dAxesFromScene()},t.prototype.makeCamera3D=function(t,e,n){var r,i=e/n;(r=new kNt.PerspectiveCamera(70,i,.01,100)).position.set(t.position[0],t.position[1],t.position[2]);var s=new kNt.Vector3(t.target[0],t.target[1],t.target[2]);r.lookAt(s),r.zoom=t.zoom,r.updateProjectionMatrix(),this.camera=r,this.makeOrbitControls(r,!0)},t.prototype.makeCamera2D=function(t,e,n){var r,i=new kNt.Vector3(t.target[0],t.target[1],t.target[2]),s=e/n,o=-1.2,a=ANt,l=-1.2,c=ANt;s>1?(o*=s,a*=s):(c/=s,l/=s),(r=new kNt.OrthographicCamera(o,a,c,l,-1e3,1e3)).position.set(t.position[0],t.position[1],t.position[2]),r.up=new kNt.Vector3(0,0,1),r.lookAt(i),r.zoom=t.zoom,r.updateProjectionMatrix(),this.camera=r,this.makeOrbitControls(r,!1)},t.prototype.makeDefaultCameraDef=function(t,e){void 0===e&&(e={});var n=2===t,r=n?ONt:$Nt,i=n?PNt:RNt,s={orthographic:n,zoom:1,position:[r.x,r.y,r.z],target:[i.x,i.y,i.z]};return e.zoom&&(s.zoom=e.zoom),e.position&&(s.position=e.position),e.target&&(s.target=e.target),s},t.prototype.recreateCamera=function(t){t.orthographic?this.makeCamera2D(t,this.width,this.height):this.makeCamera3D(t,this.width,this.height),this.orbitCameraControls.minDistance=.05,this.orbitCameraControls.maxDistance=10,this.orbitCameraControls.update(),this.orbitAnimationOnNextCameraCreation&&this.startOrbitAnimation()},t.prototype.setInteractionMode=function(t){this.interactionMode=t,"SELECT"===t?(this.selecting=!0,this.container.style.cursor="crosshair",this.orbitCameraControls.enabled=!1):(this.selecting=!1,this.container.style.cursor="default",this.orbitCameraControls.enabled=!0)},t.prototype.onClick=function(t,e){if(void 0===e&&(e=!0),!t||!this.selecting){if(!this.isDragSequence&&e){if(this.selectEnabled){var n=null!=this.nearestPoint?[this.nearestPoint]:[];this.selectCallback(n)}this.clickCallback(this.nearestPoint)}this.isDragSequence=!1,this.render()}},t.prototype.onMouseDown=function(t){this.isDragSequence=!1,this.mouseIsDown=!0,this.selecting?(this.rectangleSelector.onMouseDown(t.offsetX,t.offsetY),this.setNearestPointToMouse(t)):!t.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===kNt.MOUSE.RIGHT?(this.orbitCameraControls.mouseButtons.ORBIT=kNt.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=kNt.MOUSE.RIGHT):t.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===kNt.MOUSE.LEFT&&(this.orbitCameraControls.mouseButtons.ORBIT=kNt.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=kNt.MOUSE.LEFT)},t.prototype.onMouseUp=function(t){this.selecting&&(this.rectangleSelector.onMouseUp(),this.render()),this.mouseIsDown=!1},t.prototype.onMouseMove=function(t){this.isDragSequence=this.mouseIsDown,this.selecting&&this.mouseIsDown?(this.rectangleSelector.onMouseMove(t.offsetX,t.offsetY),this.render()):this.mouseIsDown||(this.setNearestPointToMouse(t),this.nearestPoint!=this.lastHovered&&(this.lastHovered=this.nearestPoint,this.hoverCallback(this.nearestPoint)))},t.prototype.onKeyDown=function(t){t.key===INt&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=kNt.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=kNt.MOUSE.LEFT),t.key===NNt&&this.selectEnabled&&(this.selecting=!0,this.orbitCameraControls.enabled=!1,this.container.style.cursor="crosshair")},t.prototype.onKeyUp=function(t){t.key===INt&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=kNt.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=kNt.MOUSE.RIGHT),t.key===NNt&&this.selectEnabled&&(this.selecting=!1,this.orbitCameraControls.enabled=!0,this.container.style.cursor="default",this.render())},t.prototype.getPointIndicesFromBoundingBox=function(t){if(null==this.worldSpacePointPositions)return[];this.camera.updateMatrixWorld();var e=window.devicePixelRatio||1,n=Math.floor(t.x*e),r=Math.floor(t.y*e),i=Math.max(Math.floor(t.width*e),1),s=Math.max(Math.floor(t.height*e),1);if(i<=2&&s<=2)return this.getPointIndicesFromBoundingBoxPickingTexture(t);for(var o=this.renderer.domElement,a=o.width,l=o.height,c=[],u=new kNt.Vector3,h=0;h<this.worldSpacePointPositions.length;h++){var d=3*h,p=_Nt(this.worldSpacePointPositions.slice(d,d+3),3),f=p[0],m=p[1],g=p[2];u.x=f,u.y=m,u.z=g;var y=u.project(this.camera),b=(y.x+1)*a/2,v=-(y.y-1)*l/2;b>=n&&b<=n+i&&v<=r&&v>=r-s&&c.push(h)}return c},t.prototype.getPointIndicesFromBoundingBoxPickingTexture=function(t){if(null==this.worldSpacePointPositions)return[];var e=this.worldSpacePointPositions.length/3,n=window.devicePixelRatio||1,r=Math.floor(t.x*n),i=Math.floor(t.y*n),s=Math.max(Math.floor(t.width*n),1),o=Math.max(Math.floor(t.height*n),1),a=new Uint8Array(s*o*4);this.renderer.readRenderTargetPixels(this.pickingTexture,r,this.pickingTexture.height-i,s,o,a);for(var l=new Uint8Array(this.worldSpacePointPositions.length),c=0;c<s*o;c++){var u=a[4*c]<<16|a[4*c+1]<<8|a[4*c+2];16777215!==u&&u<e&&(l[u]=1)}var h=[];for(c=0;c<l.length;c++)1===l[c]&&h.push(c);return h},t.prototype.selectBoundingBox=function(t){var e=this.getPointIndicesFromBoundingBox(t);this.selectCallback(e)},t.prototype.setNearestPointToMouse=function(t){if(null!=this.pickingTexture){var e={x:t.offsetX,y:t.offsetY,width:1,height:1},n=this.getPointIndicesFromBoundingBoxPickingTexture(e);this.nearestPoint=n.length?n[0]:null}else this.nearestPoint=null},t.prototype.computeLayoutValues=function(){return this.width=this.container.offsetWidth,this.height=Math.max(1,this.container.offsetHeight),[this.width,this.height]},t.prototype.sceneIs3D=function(){return 3===this.dimensions},t.prototype.remove3dAxesFromScene=function(){var t=this.scene.getObjectByName("axes");return null!=t&&this.scene.remove(t),t},t.prototype.add3dAxes=function(){var t=new kNt.AxesHelper;t.name="axes",this.scene.add(t)},t.prototype.setDimensions=function(t){if(2!==t&&3!==t)throw new RangeError("dimensions must be 2 or 3");this.dimensions!==t&&(this.dimensions=t,this.makeCamera())},t.prototype.getCameraPosition=function(){var t=this.camera.position;return[t.x,t.y,t.z]},t.prototype.getCameraTarget=function(){var t=this.orbitCameraControls.target;return[t.x,t.y,t.z]},t.prototype.setCameraPositionAndTarget=function(t,e){this.stopOrbitAnimation(),this.camera.position.set(t[0],t[1],t[2]),this.orbitCameraControls.target.set(e[0],e[1],e[2]),this.orbitCameraControls.update(),this.render()},t.prototype.startOrbitAnimation=function(){this.sceneIs3D()&&(null!=this.orbitAnimationId&&this.stopOrbitAnimation(),this.orbitCameraControls.autoRotate=!0,this.orbitCameraControls.autoRotateSpeed=this.orbitControlParams.autoRotateSpeed,this.updateOrbitAnimation())},t.prototype.orbitIsAnimating=function(){return null!=this.orbitAnimationId},t.prototype.updateOrbitAnimation=function(){var t=this;this.orbitCameraControls.update(),this.orbitAnimationId=requestAnimationFrame((function(){return t.updateOrbitAnimation()}))},t.prototype.stopOrbitAnimation=function(){this.orbitCameraControls.autoRotate=!1,this.orbitCameraControls.rotateSpeed=this.orbitControlParams.mouseRotateSpeed,null!=this.orbitAnimationId&&(cancelAnimationFrame(this.orbitAnimationId),this.orbitAnimationId=null)},t.prototype.setActiveVisualizers=function(t){var e,n,r,i,s=new Set(t.map((function(t){return t.id})));try{for(var o=SNt(this.visualizers.values()),a=o.next();!a.done;a=o.next()){var l=a.value;s.has(l.id)||(l.dispose(),this.visualizers.delete(l.id))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}try{for(var c=SNt(t),u=c.next();!u.done;u=c.next()){l=u.value;this.visualizers.set(l.id,l),l.setScene(this.scene),l.onResize(this.width,this.height),this.worldSpacePointPositions&&l.onPointPositionsChanged(this.worldSpacePointPositions)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}},t.prototype.disposeAllVisualizers=function(){this.visualizers.forEach((function(t){return t.dispose()})),this.visualizers.clear()},t.prototype.setPointPositions=function(t){this.worldSpacePointPositions=t,this.visualizers.forEach((function(e){return e.onPointPositionsChanged(t)}))},t.prototype.render=function(){var t=this.camera.position.clone();t.x+=1,t.y+=1,this.light.position.set(t.x,t.y,t.z);var e=this.camera instanceof kNt.PerspectiveCamera?ENt.CameraType.Perspective:ENt.CameraType.Orthographic,n=[0,0];null!=this.worldSpacePointPositions&&(n=MNt.getNearFarPoints(this.worldSpacePointPositions,this.camera.position,this.orbitCameraControls.target));var r=new ENt.RenderContext(this.camera,e,this.orbitCameraControls.target,this.width,this.height,n[0],n[1],this.styles.backgroundColor,this.pointColors,this.pointScaleFactors,this.labels,this.polylineColors,this.polylineOpacities,this.polylineWidths);this.visualizers.forEach((function(t){return t.onPickingRender(r)}));var i=this.remove3dAxesFromScene();this.renderer.setRenderTarget(this.pickingTexture),this.renderer.render(this.scene,this.camera),null!=i&&this.scene.add(i),this.visualizers.forEach((function(t){return t.onRender(r)})),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},t.prototype.setPointColors=function(t){this.pointColors=t},t.prototype.setPointScaleFactors=function(t){this.pointScaleFactors=t},t.prototype.setLabels=function(t){this.labels=t},t.prototype.setPolylineColors=function(t){this.polylineColors=t},t.prototype.setPolylineOpacities=function(t){this.polylineOpacities=t},t.prototype.setPolylineWidths=function(t){this.polylineWidths=t},t.prototype.resetZoom=function(){this.recreateCamera(this.makeDefaultCameraDef(this.dimensions)),this.render()},t.prototype.setDayNightMode=function(t){for(var e=this.container.querySelectorAll("canvas"),n=t?"invert(100%)":"",r=0;r<e.length;r++)e[r].style.filter=n},t.prototype.resize=function(t){void 0===t&&(t=!0);var e=_Nt([this.width,this.height],2),n=e[0],r=e[1],i=_Nt(this.computeLayoutValues(),2),s=i[0],o=i[1];if(3===this.dimensions){(a=this.camera).aspect=s/o,a.updateProjectionMatrix()}else{var a=this.camera,l=s/n,c=o/r,u=(a.right-a.left)*l/2,h=(a.top-a.bottom)*c/2;a.top=h,a.bottom=-h,a.left=-u,a.right=u,a.updateProjectionMatrix()}var d=window.devicePixelRatio||1;this.renderer.setPixelRatio(d),this.renderer.setSize(s,o);var p=new kNt.Vector2;this.renderer.getSize(p);var f=this.renderer.getPixelRatio();this.pickingTexture=new kNt.WebGLRenderTarget(p.width*f,p.height*f),this.pickingTexture.texture.minFilter=kNt.LinearFilter,this.visualizers.forEach((function(t){return t.onResize(s,o)})),t&&this.render()},t.prototype.onCameraMove=function(t){this.onCameraMoveListeners.push(t)},t.prototype.clickOnPoint=function(t){this.nearestPoint=t,this.onClick(null,!1)},t}();wbt.ScatterPlot=DNt;var FNt={},zNt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(FNt,"__esModule",{value:!0});var BNt=uNt,UNt=new Map,VNt=/^(rgba|hsla)\((\d+),\s*(\d+%?),\s*(\d+%?)(?:,\s*(\d+(?:\.\d+)?))?\)$/;FNt.parseColor=function(t){if(UNt.has(t))return UNt.get(t);var e=function(t){var e=VNt.exec(t);if(e){var n=zNt(e,6);n[0];var r=n[1],i=n[2],s=n[3],o=n[4],a=n[5];return{colorString:r.replace("a","")+"("+i+","+s+","+o+")",opacity:parseFloat(a)}}return{colorString:t,opacity:1}}(t),n=e.colorString,r=e.opacity,i=new BNt.Color(n),s={r:i.r,g:i.g,b:i.b,opacity:r};return UNt.set(t,s),s};var jNt={},WNt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(jNt,"__esModule",{value:!0});var HNt="Points must be an array of either 2 or 3 dimensional number arrays",GNt=function(){function t(t,e){var n,r;void 0===e&&(e=[]),this.points=t,this.metadata=e;var i=t[0].length;if(2!==i&&3!==i)throw new Error(HNt);try{for(var s=WNt(t),o=s.next();!o.done;o=s.next()){if(i!==o.value.length)throw new Error(HNt)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this.dimensions=i}return t.prototype.setSpriteMetadata=function(t){this.spriteMetadata=t},t}();jNt.Dataset=GNt;var qNt={};Object.defineProperty(qNt,"__esModule",{value:!0});qNt.makeStyles=function(t){var e={backgroundColor:"#ffffff",axesVisible:!0,fog:{color:"#ffffff",enabled:!0,threshold:5e3},label:{fontSize:10,scaleDefault:1,scaleLarge:2,fillColorSelected:"#000000",fillColorHover:"#000000",strokeColorSelected:"#ffffff",strokeColorHover:"#ffffff",strokeWidth:3,fillWidth:6},label3D:{fontSize:80,scale:2.2,color:"black",backgroundColor:"#ffffff",colorUnselected:"#ffffff",colorNoSelection:"#ffffff"},point:{colorUnselected:"rgba(227, 227, 227, 0.7)",colorNoSelection:"rgba(117, 117, 217, 0.7)",colorSelected:"rgba(250, 102, 102, 0.7)",colorHover:"rgba(118, 11, 79, 0.7)",scaleDefault:1,scaleSelected:1.2,scaleHover:1.2},polyline:{startHue:60,endHue:360,saturation:1,lightness:.3,defaultOpacity:.2,defaultLineWidth:2,selectedOpacity:.9,selectedLineWidth:3,deselectedOpacity:.05},select:{fill:"#dddddd",fillOpacity:.2,stroke:"#aaaaaa",strokeWidth:2,strokeDashArray:"10 5"},sprites:{minPointSize:5,imageSize:30,colorUnselected:"#ffffff",colorNoSelection:"#ffffff"}};if(void 0===t)return e;for(var n in e){var r=n;"object"==typeof e[r]&&"object"==typeof t[r]?e[r]=Object.assign(e[r],t[r]):void 0!==t[r]&&(e[r]=t[r])}return e};var XNt={};Object.defineProperty(XNt,"__esModule",{value:!0}),XNt.RGB_NUM_ELEMENTS=3,XNt.RGBA_NUM_ELEMENTS=4,XNt.XYZ_NUM_ELEMENTS=3,XNt.UV_NUM_ELEMENTS=2,XNt.INDEX_NUM_ELEMENTS=1,XNt.SCATTER_PLOT_CUBE_LENGTH=2;var YNt={};Object.defineProperty(YNt,"__esModule",{value:!0});var KNt=uNt,ZNt=mNt,JNt=XNt,QNt=8192,tIt=function(t,e){return"\n      attribute vec2 posObj;\n      attribute vec4 color;\n      varying vec2 vUv;\n      varying vec4 vColor;\n\n      void main() {\n        vUv = uv;\n        vColor = color;\n\n        // Rotate label to face camera.\n\n        vec4 vRight = vec4(\n          modelViewMatrix[0][0], modelViewMatrix[1][0], modelViewMatrix[2][0], 0);\n\n        vec4 vUp = vec4(\n          modelViewMatrix[0][1], modelViewMatrix[1][1], modelViewMatrix[2][1], 0);\n\n        vec4 vAt = -vec4(\n          modelViewMatrix[0][2], modelViewMatrix[1][2], modelViewMatrix[2][2], 0);\n\n        mat4 pointToCamera = mat4(vRight, vUp, vAt, vec4(0, 0, 0, 1));\n\n        vec2 scaledPos = posObj * "+1/t+" * "+e+";\n\n        vec4 posRotated = pointToCamera * vec4(scaledPos, 0, 1);\n        vec4 mvPosition = modelViewMatrix * (vec4(position, 0) + posRotated);\n        gl_Position = projectionMatrix * mvPosition;\n      }"},eIt=function(){function t(t){this.styles=t,this.id="3D_LABELS",this.labelStrings=[],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.uniforms={},this.totalVertexCount=0,this.labelVertexMap=[]}return t.prototype.createGlyphTexture=function(){var t=this.styles.label3D,e=t.fontSize,n=t.backgroundColor,r=t.color,i=document.createElement("canvas");i.width=QNt,i.height=e;var s=i.getContext("2d");s.font="bold "+e+"px roboto",s.textBaseline="top",s.fillStyle=n,s.rect(0,0,i.width,i.height),s.fill(),s.fillStyle=r;for(var o=s.measureText(" ").width,a=new Float32Array(256),l=new Float32Array(256),c=0,u=0;u<256;u++){var h=" "+String.fromCharCode(u),d=s.measureText(h).width;a[u]=d-o,l[u]=c,s.fillText(h,c-o,0),c+=d}return{texture:ZNt.createTextureFromCanvas(i),lengths:a,offsets:l}},t.prototype.processLabelVerts=function(t){var e=0;this.labelVertexMap=[];for(var n=0;n<t;n++){for(var r=this.labelStrings[n],i=[],s=0;s<r.length;s++){for(var o=0;o<6;o++)i.push(6*e+o);e++}this.labelVertexMap.push(i)}this.totalVertexCount=6*e},t.prototype.createColorBuffers=function(t){var e=this;this.pickingColors=new Float32Array(this.totalVertexCount*JNt.RGB_NUM_ELEMENTS),this.renderColors=new Float32Array(this.totalVertexCount*JNt.RGB_NUM_ELEMENTS);for(var n=function(t){var n=new KNt.Color(t);r.labelVertexMap[t].forEach((function(t){e.pickingColors[JNt.RGB_NUM_ELEMENTS*t]=n.r,e.pickingColors[JNt.RGB_NUM_ELEMENTS*t+1]=n.g,e.pickingColors[JNt.RGB_NUM_ELEMENTS*t+2]=n.b,e.renderColors[JNt.RGB_NUM_ELEMENTS*t]=1,e.renderColors[JNt.RGB_NUM_ELEMENTS*t+1]=1,e.renderColors[JNt.RGB_NUM_ELEMENTS*t+2]=1}))},r=this,i=0;i<t;i++)n(i)},t.prototype.createLabels=function(){var t=this,e=this.styles.label3D,n=e.fontSize,r=e.scale;if(null!=this.labelStrings&&null!=this.worldSpacePointPositions){var i=this.worldSpacePointPositions.length/JNt.XYZ_NUM_ELEMENTS;if(i===this.labelStrings.length){this.glyphTexture=this.createGlyphTexture(),this.uniforms={glyphTexture:{value:null},picking:{value:!1}},this.material=new KNt.ShaderMaterial({uniforms:this.uniforms,transparent:!0,vertexShader:tIt(n,r),fragmentShader:"\n      uniform sampler2D glyphTexture;\n      uniform bool picking;\n      varying vec2 vUv;\n      varying vec4 vColor;\n\n      void main() {\n        if (picking) {\n          gl_FragColor = vColor;\n        } else {\n          vec4 fromTexture = texture(glyphTexture, vUv);\n          gl_FragColor = vColor * fromTexture;\n        }\n      }"}),this.processLabelVerts(i),this.createColorBuffers(i);var s=new Float32Array(this.totalVertexCount*JNt.XYZ_NUM_ELEMENTS);this.positions=new KNt.BufferAttribute(s,JNt.XYZ_NUM_ELEMENTS);var o=new Float32Array(this.totalVertexCount*JNt.XYZ_NUM_ELEMENTS),a=new Float32Array(this.totalVertexCount*JNt.UV_NUM_ELEMENTS),l=new Float32Array(this.totalVertexCount*JNt.RGB_NUM_ELEMENTS),c=new KNt.BufferAttribute(o,2),u=new KNt.BufferAttribute(a,JNt.UV_NUM_ELEMENTS),h=new KNt.BufferAttribute(l,JNt.RGB_NUM_ELEMENTS);this.geometry=new KNt.BufferGeometry,this.geometry.setAttribute("posObj",c),this.geometry.setAttribute("position",this.positions),this.geometry.setAttribute("uv",u),this.geometry.setAttribute("color",h);for(var d=0,p=0;p<i;p++){for(var f=this.labelStrings[p],m=0,g=0;g<f.length;g++){var y=f.charCodeAt(g);m+=this.glyphTexture.lengths[y]}m/=-2;for(g=0;g<f.length;g++){y=f.charCodeAt(g);var b=this.glyphTexture.lengths[y],v=(m+b)/n,x=m/n,w=n/n;c.setXY(6*d+0,x,0),c.setXY(6*d+1,v,0),c.setXY(6*d+2,x,w),c.setXY(6*d+3,x,w),c.setXY(6*d+4,v,0),c.setXY(6*d+5,v,w);var _=this.glyphTexture.offsets[y],S=this.glyphTexture.offsets[y]+b;_/=QNt,S/=QNt;u.setXY(6*d+0,_,1),u.setXY(6*d+1,S,1),u.setXY(6*d+2,_,0),u.setXY(6*d+3,_,0),u.setXY(6*d+4,S,1),u.setXY(6*d+5,S,0),d++,m+=b}}var k=function(e){var n=ZNt.vector3FromPackedArray(T.worldSpacePointPositions,e);T.labelVertexMap[e].forEach((function(e){t.positions.setXYZ(e,n.x,n.y,n.z)}))},T=this;for(p=0;p<i;p++)k(p);this.labelsMesh=new KNt.Mesh(this.geometry,this.material),this.labelsMesh.frustumCulled=!1,this.scene.add(this.labelsMesh)}}},t.prototype.colorLabels=function(t){if(null!=this.labelStrings&&null!=this.geometry&&null!=t){var e=this.geometry.getAttribute("color");e.array=this.renderColors;for(var n=t.length/JNt.RGBA_NUM_ELEMENTS,r=0,i=0;i<n;++i){for(var s=new KNt.Color(t[r],t[r+1],t[r+2]),o=this.labelVertexMap[i].length,a=0;a<o;++a)e.setXYZ(this.labelVertexMap[i][a],s.r,s.g,s.b);r+=JNt.RGBA_NUM_ELEMENTS}e.needsUpdate=!0}},t.prototype.setScene=function(t){this.scene=t},t.prototype.dispose=function(){this.labelsMesh&&(this.scene&&this.scene.remove(this.labelsMesh),this.labelsMesh=null),this.geometry&&(this.geometry.dispose(),this.geometry=null),null!=this.glyphTexture&&null!=this.glyphTexture.texture&&(this.glyphTexture.texture.dispose(),this.glyphTexture.texture=null)},t.prototype.onPickingRender=function(t){if(null!=this.geometry){this.material.uniforms.glyphTexture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!0;var e=this.geometry.getAttribute("color");e.array=this.pickingColors,e.needsUpdate=!0}else this.createLabels()},t.prototype.onRender=function(t){if(null!=this.geometry){this.colorLabels(t.pointColors),this.material.uniforms.glyphTexture.value=this.glyphTexture.texture,this.material.uniforms.picking.value=!1;var e=this.geometry.getAttribute("color");e.array=this.renderColors,e.needsUpdate=!0}else this.createLabels()},t.prototype.onPointPositionsChanged=function(t){this.worldSpacePointPositions=t,this.dispose()},t.prototype.setLabelStrings=function(t){this.labelStrings=t,this.dispose()},t.prototype.onResize=function(t,e){},t}();YNt.ScatterPlotVisualizer3DLabels=eIt;var nIt={};Object.defineProperty(nIt,"__esModule",{value:!0});var rIt=uNt,iIt=fNt,sIt=mNt,oIt=XNt,aIt=function(t){return"\n    // Index of the specific vertex (passed in as bufferAttribute), and the\n    // variable that will be used to pass it to the fragment shader.\n    attribute float spriteIndex;\n    attribute vec4 color;\n    attribute float scaleFactor;\n\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n\n    uniform bool sizeAttenuation;\n    uniform float pointSize;\n    uniform float spritesPerRow;\n    uniform float spritesPerColumn;\n\n    varying float fogDepth;\n\n    void main() {\n      // Pass index and color values to fragment shader.\n      vColor = color;\n      xyIndex = vec2(mod(spriteIndex, spritesPerRow),\n                floor(spriteIndex / spritesPerColumn));\n\n      // Transform current vertex by modelViewMatrix (model world position and\n      // camera world position matrix).\n      vec4 cameraSpacePos = modelViewMatrix * vec4(position, 1.0);\n\n      // Project vertex in camera-space to screen coordinates using the camera's\n      // projection matrix.\n      gl_Position = projectionMatrix * cameraSpacePos;\n\n      // Create size attenuation (if we're in 3D mode) by making the size of\n      // each point inversly proportional to its distance to the camera.\n      float outputPointSize = pointSize;\n      if (sizeAttenuation) {\n        outputPointSize = -pointSize / cameraSpacePos.z;\n        fogDepth = pointSize / outputPointSize * 1.2;\n      } else {  // Create size attenuation (if we're in 2D mode)\n        const float PI = 3.1415926535897932384626433832795;\n        const float minScale = 0.1;  // minimum scaling factor\n        const float outSpeed = 2.0;  // shrink speed when zooming out\n        const float outNorm = (1. - minScale) / atan(outSpeed);\n        const float maxScale = 15.0;  // maximum scaling factor\n        const float inSpeed = 0.02;  // enlarge speed when zooming in\n        const float zoomOffset = 0.3;  // offset zoom pivot\n        float zoom = projectionMatrix[0][0] + zoomOffset;  // zoom pivot\n        float scale = zoom < 1. ? 1. + outNorm * atan(outSpeed * (zoom - 1.)) :\n                      1. + 2. / PI * (maxScale - 1.) * atan(inSpeed * (zoom - 1.));\n        outputPointSize = pointSize * scale;\n      }\n\n      gl_PointSize =\n        max(outputPointSize * scaleFactor, "+t.toFixed(1)+");\n    }"},lIt="\n    bool point_in_unit_circle(vec2 spriteCoord) {\n      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);\n      return dot(centerToP, centerToP) < (0.5 * 0.5);\n    }\n\n    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {\n      vec3 v0 = vec3(0, 1, 0);\n      vec3 v1 = vec3(0.5, 0, 0);\n      vec3 v2 = vec3(1, 1, 0);\n      vec3 p = vec3(spriteCoord, 0);\n      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;\n      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;\n      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);\n    }\n\n    bool point_in_unit_square(vec2 spriteCoord) {\n      return true;\n    }\n  ",cIt="\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n\n    uniform sampler2D spriteTexture;\n    uniform float spritesPerRow;\n    uniform float spritesPerColumn;\n    uniform bool isImage;\n\n    "+rIt.ShaderChunk.common+"\n    "+lIt+"\n    uniform vec3 fogColor;\n    varying float fogDepth;\n\t\tuniform float fogNear;\n    uniform float fogFar;\n\n    void main() {\n      if (isImage) {\n        // Coordinates of the vertex within the entire sprite image.\n        vec2 coords =\n          (gl_PointCoord + xyIndex) / vec2(spritesPerRow, spritesPerColumn);\n        gl_FragColor = vColor * texture(spriteTexture, coords);\n      } else {\n        bool inside = point_in_unit_circle(gl_PointCoord);\n        if (!inside) {\n          discard;\n        }\n        gl_FragColor = vColor;\n      }\n      float fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n      gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n    }",uIt=function(){function t(t,e){this.styles=t,this.id="SPRITES",this.isSpriteSheetMode=!1,this.spritesPerRow=0,this.spritesPerColumn=0,this.spriteDimensions=[0,0],this.worldSpacePointPositions=new Float32Array(0),this.pickingColors=new Float32Array(0),this.renderColors=new Float32Array(0),this.standinTextureForPoints=sIt.createTextureFromCanvas(document.createElement("canvas")),e&&(this.spriteSheetParams=e,this.setSpriteSheet(e),this.isSpriteSheetMode=!0),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial()}return t.prototype.createUniforms=function(){return{spriteTexture:{type:"t"},spritesPerRow:{type:"f"},spritesPerColumn:{type:"f"},fogColor:{type:"c"},fogNear:{type:"f"},fogFar:{type:"f"},isImage:{type:"bool"},sizeAttenuation:{type:"bool"},pointSize:{type:"f"}}},t.prototype.createRenderMaterial=function(){this.isSpriteSheetMode;var t=this.createUniforms();return new rIt.ShaderMaterial({uniforms:t,vertexShader:aIt(this.styles.sprites.minPointSize),fragmentShader:cIt,transparent:!0,depthFunc:rIt.LessDepth,fog:this.styles.fog.enabled,blending:rIt.NormalBlending})},t.prototype.createPickingMaterial=function(){var t=this.createUniforms();return new rIt.ShaderMaterial({uniforms:t,vertexShader:aIt(this.styles.sprites.minPointSize),fragmentShader:"\n    varying vec2 xyIndex;\n    varying vec4 vColor;\n    uniform bool isImage;\n\n    \n    bool point_in_unit_circle(vec2 spriteCoord) {\n      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);\n      return dot(centerToP, centerToP) < (0.5 * 0.5);\n    }\n\n    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {\n      vec3 v0 = vec3(0, 1, 0);\n      vec3 v1 = vec3(0.5, 0, 0);\n      vec3 v2 = vec3(1, 1, 0);\n      vec3 p = vec3(spriteCoord, 0);\n      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;\n      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;\n      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);\n    }\n\n    bool point_in_unit_square(vec2 spriteCoord) {\n      return true;\n    }\n  \n\n    varying float fogDepth;\n\n    void main() {\n      xyIndex; // Silence 'unused variable' warning.\n      fogDepth; // Silence 'unused variable' warning.\n      if (isImage) {\n        gl_FragColor = vColor;\n      } else {\n        bool inside = point_in_unit_circle(gl_PointCoord);\n        if (!inside) {\n          discard;\n        }\n        gl_FragColor = vColor;\n      }\n    }",transparent:!0,depthTest:!0,depthWrite:!0,fog:!1,blending:rIt.NormalBlending})},t.prototype.createPointSprites=function(t,e){var n=null!=e?e.length/oIt.XYZ_NUM_ELEMENTS:0,r=this.createGeometry(n);this.fog=new rIt.Fog(16777215),this.points=new rIt.Points(r,this.renderMaterial),this.points.frustumCulled=!1,null!=this.spriteIndexBufferAttribute&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute),t.add(this.points)},t.prototype.calculatePointSize=function(t){var e=this.styles.sprites.imageSize;if(this.texture)return t?e:this.spriteDimensions[0];var n=null!=this.worldSpacePointPositions?this.worldSpacePointPositions.length/oIt.XYZ_NUM_ELEMENTS:1,r=200/Math.log(n)/Math.log(8);return t?r:r/1.5},t.prototype.createGeometry=function(t){var e=t;this.pickingColors=new Float32Array(e*oIt.RGBA_NUM_ELEMENTS);for(var n=0,r=0;r<e;r++){var i=new rIt.Color(r);this.pickingColors[n++]=i.r,this.pickingColors[n++]=i.g,this.pickingColors[n++]=i.b,this.pickingColors[n++]=1}var s=new rIt.BufferGeometry;return s.setAttribute("position",new rIt.BufferAttribute(new Float32Array([]),oIt.XYZ_NUM_ELEMENTS)),s.setAttribute("color",new rIt.BufferAttribute(new Float32Array([]),oIt.RGBA_NUM_ELEMENTS)),s.setAttribute("scaleFactor",new rIt.BufferAttribute(new Float32Array([]),oIt.INDEX_NUM_ELEMENTS)),s.computeVertexNormals(),s},t.prototype.setFogDistances=function(t,e,n){var r=this.styles.fog,i=r.threshold,s=r.enabled;if(t&&s){this.fog.near=e;var o=e-n;this.fog.far=e-i*o}else this.fog.near=1/0,this.fog.far=1/0},t.prototype.dispose=function(){this.disposeGeometry(),this.disposeSpriteSheet()},t.prototype.disposeGeometry=function(){null!=this.points&&(this.scene.remove(this.points),this.points.geometry.dispose(),this.points=null,this.worldSpacePointPositions=null)},t.prototype.disposeSpriteSheet=function(){this.texture&&this.texture.dispose(),this.texture=null,this.renderMaterial=null,this.pickingMaterial=null,this.spriteSheetImage=null},t.prototype.setScene=function(t){this.scene=t},t.prototype.setSpriteSheet=function(t){var e=this,n=t.spriteDimensions,r=t.onImageLoad,i=t.spritesheetImage;if("string"==typeof i){var s=i;(i=new Image).src=s}this.spriteSheetImage=i,this.texture=sIt.createTextureFromImage(this.spriteSheetImage,(function(){e.spritesPerRow=e.spriteSheetImage.width/n[0],e.spritesPerColumn=e.spriteSheetImage.height/n[1],r()})),this.spriteDimensions=n,this.setSpriteIndexBuffer()},t.prototype.setSpriteIndexBuffer=function(){var t=this.spriteSheetParams.spriteIndices;this.spriteIndexBufferAttribute=new rIt.BufferAttribute(t,oIt.INDEX_NUM_ELEMENTS),null!=this.points&&this.points.geometry.setAttribute("spriteIndex",this.spriteIndexBufferAttribute)},t.prototype.onPointPositionsChanged=function(t){null!=this.points&&this.worldSpacePointPositions.length!==t.length&&this.disposeGeometry(),this.worldSpacePointPositions=t,null==this.points&&this.createPointSprites(this.scene,t),this.spriteSheetParams&&this.setSpriteIndexBuffer(),this.renderMaterial=this.createRenderMaterial(),this.pickingMaterial=this.createPickingMaterial();var e=this.points.geometry.getAttribute("position");e.array=t,e.count=t.length/oIt.XYZ_NUM_ELEMENTS,e.needsUpdate=!0},t.prototype.onPickingRender=function(t){var e=t.cameraType===iIt.CameraType.Perspective;this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.pickingMaterial.uniforms.spritesPerRow.value=this.spritesPerColumn,this.pickingMaterial.uniforms.sizeAttenuation.value=e,this.pickingMaterial.uniforms.pointSize.value=this.calculatePointSize(e),this.points.material=this.pickingMaterial;var n=this.points.geometry.getAttribute("color");n.array=this.pickingColors,n.count=this.pickingColors.length/oIt.RGBA_NUM_ELEMENTS,n.needsUpdate=!0;var r=this.points.geometry.getAttribute("scaleFactor");r.array=t.pointScaleFactors,r.count=t.pointScaleFactors.length,r.count=t.pointScaleFactors.length/oIt.INDEX_NUM_ELEMENTS,r.needsUpdate=!0},t.prototype.onRender=function(t){var e=t.camera instanceof rIt.PerspectiveCamera;this.setFogDistances(e,t.nearestCameraSpacePointZ,t.farthestCameraSpacePointZ),this.scene.fog=this.fog,this.scene.fog.color=new rIt.Color(t.backgroundColor),this.renderMaterial.uniforms.fogColor.value=this.scene.fog.color,this.renderMaterial.uniforms.fogNear.value=this.fog.near,this.renderMaterial.uniforms.fogFar.value=this.fog.far,this.renderMaterial.uniforms.spritesPerRow.value=this.spritesPerRow,this.renderMaterial.uniforms.spritesPerColumn.value=this.spritesPerColumn,this.renderMaterial.uniforms.isImage.value=null!=this.texture,this.renderMaterial.uniforms.spriteTexture.value=null!=this.texture?this.texture:this.standinTextureForPoints,this.renderMaterial.uniforms.sizeAttenuation.value=e,this.renderMaterial.uniforms.pointSize.value=this.calculatePointSize(e),this.points.material=this.renderMaterial;var n=this.points.geometry.getAttribute("color");this.renderColors=t.pointColors,n.array=this.renderColors,n.count=this.renderColors.length/oIt.RGBA_NUM_ELEMENTS,n.needsUpdate=!0;var r=this.points.geometry.getAttribute("scaleFactor");r.array=t.pointScaleFactors,r.count=t.pointScaleFactors.length/oIt.INDEX_NUM_ELEMENTS,r.needsUpdate=!0},t.prototype.onResize=function(t,e){},t}();nIt.ScatterPlotVisualizerSprites=uIt;var hIt={},dIt={};Object.defineProperty(dIt,"__esModule",{value:!0});var pIt=function(){function t(t,e,n){this.bound=t,this.cellWidth=e,this.cellHeight=n,this.numHorizCells=Math.ceil(this.boundWidth(t)/e),this.numVertCells=Math.ceil(this.boundHeight(t)/n),this.grid=new Array(this.numHorizCells*this.numVertCells)}return t.prototype.boundWidth=function(t){return t.hiX-t.loX},t.prototype.boundHeight=function(t){return t.hiY-t.loY},t.prototype.boundsIntersect=function(t,e){return!(t.loX>e.hiX||t.loY>e.hiY||t.hiX<e.loX||t.hiY<e.loY)},t.prototype.insert=function(t,e){if(void 0===e&&(e=!1),t.hiX<this.bound.loX||t.loX>this.bound.hiX||t.hiY<this.bound.loY||t.loY>this.bound.hiY)return!1;for(var n=this.getCellX(t.loX),r=this.getCellX(t.hiX),i=this.getCellY(t.loY),s=this.getCellY(t.hiY),o=i*this.numHorizCells+n,a=o,l=i;l<=s;l++){for(var c=n;c<=r;c++){var u=this.grid[a++];if(u)for(var h=0;h<u.length;h++)if(this.boundsIntersect(t,u[h]))return!1}a+=this.numHorizCells-(r-n+1)}if(e)return!0;a=o;for(l=i;l<=s;l++){for(c=n;c<=r;c++)this.grid[a]?this.grid[a].push(t):this.grid[a]=[t],a++;a+=this.numHorizCells-(r-n+1)}return!0},t.prototype.getCellX=function(t){return Math.floor((t-this.bound.loX)/this.cellWidth)},t.prototype.getCellY=function(t){return Math.floor((t-this.bound.loY)/this.cellHeight)},t}();dIt.CollisionGrid=pIt;var fIt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(hIt,"__esModule",{value:!0});var mIt=uNt,gIt=fNt,yIt=dIt,bIt=mNt,vIt=function(){function t(t,e){this.styles=e,this.id="CANVAS_LABELS",this.worldSpacePointPositions=new Float32Array(0),this.labelsActive=!0,this.canvas=document.createElement("canvas"),t.appendChild(this.canvas),this.gc=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none"}return t.prototype.removeAllLabels=function(){var t=this.canvas.width*window.devicePixelRatio,e=this.canvas.height*window.devicePixelRatio;this.gc.clearRect(0,0,t,e)},t.prototype.makeLabels=function(t){if(null!=t.labels&&0!==t.labels.pointIndices.length&&null!=this.worldSpacePointPositions){var e,n=t.labels,r=t.cameraType===gIt.CameraType.Perspective,i=parseInt(this.gc.font,10),s=window.devicePixelRatio,o=this.canvas.width*s,a=this.canvas.height*s,l={loX:0,hiX:o,loY:0,hiY:a};e=new yIt.CollisionGrid(l,o/25,a/50);var c=[t.farthestCameraSpacePointZ,t.nearestCameraSpacePointZ],u=function(t){return bIt.scaleExponential(t,c,[.1,1])},h=t.camera.position,d=h.clone().sub(t.cameraTarget),p=new mIt.Vector3;this.gc.textBaseline="middle",this.gc.miterLimit=2;for(var f=Math.min(1e4,n.pointIndices.length),m=0;m<f;++m){var g,y=n.pointIndices[m];if(g=bIt.vector3FromPackedArray(this.worldSpacePointPositions,y),p.copy(h).sub(g),!(d.dot(p)<0)){var b=fIt(bIt.vector3DToScreenCoords(t.camera,t.screenWidth,t.screenHeight,g),2),v=b[0],x=b[1],w={loX:(v+=4)-2,hiX:v+1+2,loY:x-i/2-2,hiY:x+i/2+2};if(e.insert(w,!0)){var _=n.labelStrings[m],S=n.defaultFontSize*n.scaleFactors[m]*s;if(this.gc.font=S+"px roboto",w.hiX+=this.gc.measureText(_).width-1,e.insert(w)){var k=1;r&&1===n.useSceneOpacityFlags[m]&&(k=u(p.length())),this.gc.fillStyle=this.styleStringFromPackedRgba(n.fillColors,m,k),this.gc.strokeStyle=this.styleStringFromPackedRgba(n.strokeColors,m,k),this.gc.lineWidth=this.styles.label.strokeWidth,this.gc.strokeText(_,v,x),this.gc.lineWidth=this.styles.label.fillWidth,this.gc.fillText(_,v,x)}}}}}},t.prototype.styleStringFromPackedRgba=function(t,e,n){var r=3*e;return"rgba("+t[r]+","+t[r+1]+","+t[r+2]+","+n+")"},t.prototype.onResize=function(t,e){var n=window.devicePixelRatio;this.canvas.width=t*n,this.canvas.height=e*n,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"},t.prototype.dispose=function(){this.removeAllLabels()},t.prototype.onPointPositionsChanged=function(t){this.worldSpacePointPositions=t,this.removeAllLabels()},t.prototype.onRender=function(t){this.labelsActive&&(this.removeAllLabels(),this.makeLabels(t))},t.prototype.setScene=function(t){},t.prototype.onPickingRender=function(t){},t}();hIt.ScatterPlotVisualizerCanvasLabels=vIt;var xIt={},wIt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(xIt,"__esModule",{value:!0});var _It=uNt,SIt=mNt,kIt=XNt,TIt=function(){function t(){this.id="POLYLINES",this.sequences=[],this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={},this.pointSequenceIndices=new Map}return t.prototype.getPointSequenceIndex=function(t){return this.pointSequenceIndices.get(t)},t.prototype.updateSequenceIndices=function(){for(var t=0;t<this.sequences.length;t++)for(var e=this.sequences[t],n=0;n<e.indices.length-1;n++){var r=e.indices[n];this.pointSequenceIndices.set(r,t),this.pointSequenceIndices.set(r+1,t)}},t.prototype.createPolylines=function(){var t,e;this.updateSequenceIndices();try{for(var n=wIt(this.polylines),r=n.next();!r.done;r=n.next()){var i=r.value;this.scene.remove(i),i.geometry.dispose()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.polylines=[];for(var s=0;s<this.sequences.length;s++){var o=new _It.BufferGeometry;o.addAttribute("position",this.polylinePositionBuffer[s]),o.addAttribute("color",this.polylineColorBuffer[s]);var a=new _It.LineBasicMaterial({linewidth:1,opacity:1,transparent:!0,vertexColors:!0});(i=new _It.LineSegments(o,a)).frustumCulled=!1,this.polylines.push(i),this.scene.add(i)}},t.prototype.dispose=function(){var t,e;try{for(var n=wIt(this.polylines),r=n.next();!r.done;r=n.next()){var i=r.value;this.scene.remove(i),i.geometry.dispose()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.polylines=[],this.polylinePositionBuffer={},this.polylineColorBuffer={}},t.prototype.setScene=function(t){this.scene=t},t.prototype.setSequences=function(t){this.sequences=t},t.prototype.onPointPositionsChanged=function(t){if(null==t&&this.dispose(),null!=t&&0!==this.sequences.length){for(var e=0;e<this.sequences.length;e++){var n=2*((s=this.sequences[e]).indices.length-1),r=new Float32Array(n*kIt.XYZ_NUM_ELEMENTS);this.polylinePositionBuffer[e]=new _It.BufferAttribute(r,kIt.XYZ_NUM_ELEMENTS);var i=new Float32Array(n*kIt.RGBA_NUM_ELEMENTS);this.polylineColorBuffer[e]=new _It.BufferAttribute(i,kIt.RGBA_NUM_ELEMENTS)}for(e=0;e<this.sequences.length;e++){for(var s=this.sequences[e],o=0,a=0;a<s.indices.length-1;a++){var l=s.indices[a],c=s.indices[a+1],u=SIt.vector3FromPackedArray(t,l),h=SIt.vector3FromPackedArray(t,c);this.polylinePositionBuffer[e].setXYZ(o,u.x,u.y,u.z),this.polylinePositionBuffer[e].setXYZ(o+1,h.x,h.y,h.z),o+=2}this.polylinePositionBuffer[e].needsUpdate=!0}this.createPolylines()}},t.prototype.onRender=function(t){for(var e=0;e<this.polylines.length;e++){var n=this.polylines[e].material;n.opacity=t.polylineOpacities[e],n.linewidth=t.polylineWidths[e],this.polylineColorBuffer[e].array=t.polylineColors[e],this.polylineColorBuffer[e].needsUpdate=!0}},t.prototype.onPickingRender=function(t){},t.prototype.onResize=function(t,e){},t}();xIt.ScatterPlotVisualizerPolylines=TIt;var EIt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},MIt=vr&&vr.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(EIt(arguments[e]));return t},CIt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(xbt,"__esModule",{value:!0});var AIt=wbt,NIt=FNt,IIt=jNt,$It=fNt,RIt=qNt,OIt=mNt,PIt=XNt,LIt=YNt,DIt=nIt,FIt=hIt,zIt=xIt,BIt=function(){function t(t,e){var n=this;void 0===e&&(e={}),this.pointColorer=null,this.sequences=[],this.renderMode="POINT",this.rotateOnStart=!0,this.selectEnabled=!0,this.showLabelsOnHover=!0,this.hoverPointIndex=null,this.selectedPointIndices=new Set,this.clickCallback=function(){},this.hoverCallback=function(){},this.selectCallback=function(){},this.cameraMoveCallback=function(){},this.onHover=function(t){n.hoverCallback(t),n.hoverPointIndex=t,n.updateScatterPlotAttributes(),n.renderScatterPlot()},this.onClick=function(t){n.clickCallback(t)},this.select=function(t){n.selectEnabled&&(n.selectedPointIndices=new Set(t),n.updateScatterPlotAttributes(),n.renderScatterPlot())},this.onSelect=function(t){n.selectEnabled&&(n.selectCallback(t),n.select(t))},this.containerElement=t,this.styles=RIt.makeStyles(e.styles),this.setParameters(e),this.scatterPlot=new AIt.ScatterPlot(t,{camera:e.camera,onClick:this.onClick,onHover:this.onHover,onSelect:this.onSelect,selectEnabled:this.selectEnabled,styles:this.styles,orbitControlParams:e.orbitControls}),this.scatterPlot.onCameraMove(this.cameraMoveCallback)}return t.prototype.setParameters=function(t){void 0!==t.onClick&&(this.clickCallback=t.onClick),void 0!==t.onHover&&(this.hoverCallback=t.onHover),void 0!==t.onSelect&&(this.selectCallback=t.onSelect),void 0!==t.onCameraMove&&(this.cameraMoveCallback=t.onCameraMove),void 0!==t.pointColorer&&(this.pointColorer=t.pointColorer),void 0!==t.renderMode&&(this.renderMode=t.renderMode),void 0!==t.rotateOnStart&&(this.rotateOnStart=t.rotateOnStart),void 0!==t.selectEnabled&&(this.selectEnabled=t.selectEnabled),void 0!==t.showLabelsOnHover&&(this.showLabelsOnHover=t.showLabelsOnHover)},t.prototype.render=function(t){this.updateDataset(t),this.clearVisualizers(),this.setVisualizers(),this.rotateOnStart&&this.scatterPlot.startOrbitAnimation()},t.prototype.clearVisualizers=function(){this.canvasLabelsVisualizer=void 0,this.labels3DVisualizer=void 0,this.pointVisualizer=void 0,this.polylineVisualizer=void 0,this.spritesheetVisualizer=void 0,this.scatterPlot.disposeAllVisualizers()},t.prototype.renderScatterPlot=function(){this.dataset&&this.scatterPlot.render()},t.prototype.resetZoom=function(){this.scatterPlot.resetZoom()},t.prototype.setRenderMode=function(t){this.renderMode=t,this.setVisualizers(),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions()},t.prototype.setTextRenderMode=function(){this.setRenderMode("TEXT"),this.renderScatterPlot()},t.prototype.setPointRenderMode=function(){this.setRenderMode("POINT"),this.renderScatterPlot()},t.prototype.setSpriteRenderMode=function(){this.dataset&&this.dataset.spriteMetadata&&(this.setRenderMode("SPRITE"),this.renderScatterPlot())},t.prototype.setSequences=function(t){this.sequences=t,this.updatePolylineAttributes(),this.setVisualizers(),this.renderScatterPlot()},t.prototype.setPanMode=function(){this.scatterPlot.setInteractionMode("PAN")},t.prototype.setSelectMode=function(){this.scatterPlot.setInteractionMode("SELECT")},t.prototype.setDimensions=function(t){var e=t<2||t>3,n=this.dataset&&t>this.dataset.dimensions;if(e||n)throw new RangeError("Setting invalid dimensionality");this.scatterPlot.setDimensions(t),this.renderScatterPlot()},t.prototype.setPointColorer=function(t){this.pointColorer=t,this.updateScatterPlotAttributes(),this.renderScatterPlot()},t.prototype.callPointColorer=function(t,e){return t(e,this.selectedPointIndices,this.hoverPointIndex)},t.prototype.setHoverPointIndex=function(t){this.hoverPointIndex=t,this.updateScatterPlotAttributes(),this.scatterPlot.orbitIsAnimating()||this.renderScatterPlot()},t.prototype.resize=function(){this.scatterPlot.resize()},t.prototype.updateDataset=function(t){this.setDataset(t),this.scatterPlot.setDimensions(t.dimensions),this.updateScatterPlotAttributes(),this.updateScatterPlotPositions(),this.renderScatterPlot()},t.prototype.isOrbiting=function(){return this.scatterPlot.orbitIsAnimating()},t.prototype.startOrbitAnimation=function(){this.scatterPlot.startOrbitAnimation()},t.prototype.stopOrbitAnimation=function(){this.scatterPlot.stopOrbitAnimation()},t.prototype.setDataset=function(t){this.dataset=t,this.labels3DVisualizer&&this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray())},t.prototype.updateScatterPlotPositions=function(){var t=this.dataset;if(t){var e=this.generatePointPositionArray(t);this.scatterPlot.setPointPositions(e)}},t.prototype.updateScatterPlotAttributes=function(){var t=this.dataset;if(t){var e=this.generatePointColorArray(t),n=this.generatePointScaleFactorArray(t),r=this.generateVisibleLabelRenderParams();this.scatterPlot.setPointColors(e),this.scatterPlot.setPointScaleFactors(n),this.scatterPlot.setLabels(r)}},t.prototype.updatePolylineAttributes=function(){var t=this.dataset;if(t){var e=this.generateLineSegmentColorMap(t),n=this.generateLineSegmentOpacityArray(t),r=this.generateLineSegmentWidthArray(t);this.scatterPlot.setPolylineColors(e),this.scatterPlot.setPolylineOpacities(n),this.scatterPlot.setPolylineWidths(r)}},t.prototype.generatePointPositionArray=function(t){var e,n,r=[0,0];e=OIt.extent(t.points.map((function(t){return t[0]}))),n=OIt.extent(t.points.map((function(t){return t[1]}))),3===t.dimensions&&(r=OIt.extent(t.points.map((function(t){return t[2]}))));var i=function(t){return Math.abs(t[1]-t[0])},s=i(e),o=i(n),a=i(r),l=Math.max(s,o,a),c=PIt.SCATTER_PLOT_CUBE_LENGTH/2,u=function(t,e){return[t/l*-e,e*(t/l)]},h=u(s,c),d=u(o,c),p=u(a,c),f=new Float32Array(3*t.points.length),m=0;return t.points.forEach((function(i,s){var o=t.points[s];f[m++]=OIt.scaleLinear(o[0],e,h),f[m++]=OIt.scaleLinear(o[1],n,d),3===t.dimensions?f[m++]=OIt.scaleLinear(o[2],r,p):f[m++]=0})),f},t.prototype.generateVisibleLabelRenderParams=function(){var t=this,e=t.hoverPointIndex,n=t.selectedPointIndices,r=t.styles,i=null!==e?1:0,s=new Uint32Array(i),o=new Float32Array(i),a=new Int8Array(i),l=new Uint8Array(3*i),c=new Uint8Array(3*i),u=[];o.fill(r.label.scaleDefault),a.fill(1);var h=0;if(null!==e){u.push(this.getLabelText(e)),s[h]=e,o[h]=r.label.scaleLarge,a[h]=0;var d=OIt.styleRgbFromHexColor(r.label.fillColorHover);OIt.packRgbIntoUint8Array(l,h,d[0],d[1],d[2]);var p=OIt.styleRgbFromHexColor(r.label.strokeColorHover);OIt.packRgbIntoUint8Array(c,h,p[0],p[1],p[1]),++h}d=OIt.styleRgbFromHexColor(r.label.fillColorSelected),p=OIt.styleRgbFromHexColor(r.label.strokeColorSelected);if(1===n.size){var f=MIt(n)[0];u.push(this.getLabelText(f)),s[h]=f,o[h]=r.label.scaleLarge,a[h]=0,OIt.packRgbIntoUint8Array(l,h,d[0],d[1],d[2]),OIt.packRgbIntoUint8Array(c,h,p[0],p[1],p[2])}return new $It.LabelRenderParams(new Float32Array(s),u,o,a,r.label.fontSize,l,c)},t.prototype.generatePointScaleFactorArray=function(t){var e,n,r=this,i=r.hoverPointIndex,s=r.selectedPointIndices,o=r.styles.point,a=o.scaleDefault,l=o.scaleSelected,c=o.scaleHover,u=new Float32Array(t.points.length);u.fill(a),s.size;try{for(var h=CIt(s.values()),d=h.next();!d.done;d=h.next()){u[d.value]=l}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}return null!=i&&(u[i]=c),u},t.prototype.generatePointColorArray=function(t){var e,n,r=this,i=r.hoverPointIndex,s=r.pointColorer,o=r.selectedPointIndices,a=r.styles.point,l=a.colorHover,c=a.colorNoSelection,u=a.colorSelected,h=a.colorUnselected,d=new Float32Array(t.points.length*PIt.RGBA_NUM_ELEMENTS),p=h,f=c;"TEXT"===this.renderMode&&(p=this.styles.label3D.colorUnselected,f=this.styles.label3D.colorNoSelection),"SPRITE"===this.renderMode&&(p=this.styles.sprites.colorUnselected,f=this.styles.sprites.colorNoSelection);var m=t.points.length,g=this.selectedPointIndices.size;if(s)for(var y=0,b=0;b<m;++b){var v=NIt.parseColor(this.callPointColorer(s,b)||f);d[y++]=v.r,d[y++]=v.g,d[y++]=v.b,d[y++]=v.opacity}else{for(y=0,v=g>0?NIt.parseColor(p):NIt.parseColor(f),b=0;b<m;++b)d[y++]=v.r,d[y++]=v.g,d[y++]=v.b,d[y++]=v.opacity;v=NIt.parseColor(u);try{for(var x=CIt(o.values()),w=x.next();!w.done;w=x.next()){var _=w.value*PIt.RGBA_NUM_ELEMENTS;d[_++]=v.r,d[_++]=v.g,d[_++]=v.b,d[_++]=v.opacity}}catch(t){e={error:t}}finally{try{w&&!w.done&&(n=x.return)&&n.call(x)}finally{if(e)throw e.error}}if(null!=i){var S=NIt.parseColor(l),k=i*PIt.RGBA_NUM_ELEMENTS;d[k++]=S.r,d[k++]=S.g,d[k++]=S.b,d[k++]=S.opacity}}return d},t.prototype.generate3DLabelsArray=function(){var t=this.dataset;if(!t)return[];for(var e=[],n=t.points.length,r=0;r<n;++r)e.push(this.getLabelText(r));return e},t.prototype.generateLineSegmentColorMap=function(t){for(var e=this.pointColorer,n=this.styles,r={},i=0;i<this.sequences.length;i++){var s=this.sequences[i],o=new Float32Array(2*(s.indices.length-1)*3),a=0;if(e)for(var l=0;l<s.indices.length-1;l++){var c=NIt.parseColor(this.callPointColorer(e,s.indices[l])),u=NIt.parseColor(this.callPointColorer(e,s.indices[l+1]));o[a++]=c.r,o[a++]=c.g,o[a++]=c.b,o[a++]=u.r,o[a++]=u.g,o[a++]=u.b}else for(l=0;l<s.indices.length-1;l++){c=OIt.getDefaultPointInPolylineColor(l,s.indices.length,n.polyline.startHue,n.polyline.endHue,n.polyline.saturation,n.polyline.lightness),u=OIt.getDefaultPointInPolylineColor(l+1,s.indices.length,n.polyline.startHue,n.polyline.endHue,n.polyline.saturation,n.polyline.lightness);o[a++]=c.r,o[a++]=c.g,o[a++]=c.b,o[a++]=u.r,o[a++]=u.g,o[a++]=u.b}r[i]=o}return r},t.prototype.generateLineSegmentOpacityArray=function(t){var e=this.selectedPointIndices,n=this.styles,r=new Float32Array(this.sequences.length);if(e.size>0){r.fill(n.polyline.deselectedOpacity);var i=this.polylineVisualizer.getPointSequenceIndex(MIt(e)[0]);void 0!==i&&(r[i]=n.polyline.selectedOpacity)}else r.fill(n.polyline.defaultOpacity);return r},t.prototype.generateLineSegmentWidthArray=function(t){var e=this.selectedPointIndices,n=this.styles,r=new Float32Array(this.sequences.length);if(r.fill(n.polyline.defaultLineWidth),e.size>0){var i=this.polylineVisualizer.getPointSequenceIndex(MIt(e)[0]);void 0!==i&&(r[i]=n.polyline.selectedLineWidth)}return r},t.prototype.getLabelText=function(t){var e=this.dataset;if(!e)return"";var n=e.metadata[t];return n&&null!=n.label?""+n.label:""},t.prototype.initializeCanvasLabelsVisualizer=function(){return this.canvasLabelsVisualizer||(this.canvasLabelsVisualizer=new FIt.ScatterPlotVisualizerCanvasLabels(this.containerElement,this.styles)),this.canvasLabelsVisualizer},t.prototype.initialize3DLabelsVisualizer=function(){return this.labels3DVisualizer||(this.labels3DVisualizer=new LIt.ScatterPlotVisualizer3DLabels(this.styles)),this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray()),this.labels3DVisualizer},t.prototype.initializePointVisualizer=function(){return this.pointVisualizer||(this.pointVisualizer=new DIt.ScatterPlotVisualizerSprites(this.styles)),this.pointVisualizer},t.prototype.initializeSpritesheetVisualizer=function(){var t=this,e=this.styles,n=this.dataset,r=n.spriteMetadata;if(!this.spritesheetVisualizer&&r){if(!r.spriteImage||!r.singleSpriteSize)return;var i=n.points.length,s=void 0;if(r.spriteIndices)s=new Float32Array(r.spriteIndices);else{s=new Float32Array(i);for(var o=0;o<i;++o)s[o]=o}var a=new DIt.ScatterPlotVisualizerSprites(e,{spritesheetImage:r.spriteImage,spriteDimensions:r.singleSpriteSize,spriteIndices:s,onImageLoad:function(){return t.renderScatterPlot()}});a.id="SPRITE_SHEET_VISUALIZER",this.spritesheetVisualizer=a}return this.spritesheetVisualizer},t.prototype.initializePolylineVisualizer=function(){return this.polylineVisualizer||(this.polylineVisualizer=new zIt.ScatterPlotVisualizerPolylines),this.polylineVisualizer.setSequences(this.sequences),this.polylineVisualizer},t.prototype.setVisualizers=function(){var t=this.dataset,e=this.renderMode,n=[];if("TEXT"===e){var r=this.initialize3DLabelsVisualizer();n.push(r)}else if("POINT"===e){r=this.initializePointVisualizer();n.push(r)}else if("SPRITE"===e&&t.spriteMetadata){(r=this.initializeSpritesheetVisualizer())&&n.push(r)}if(this.sequences.length>0){r=this.initializePolylineVisualizer();n.push(r)}if(("POINT"===e||"SPRITE"===e)&&this.showLabelsOnHover){r=this.initializeCanvasLabelsVisualizer();n.push(r)}this.scatterPlot.setActiveVisualizers(n)},t.Dataset=IIt.Dataset,t}();xbt.ScatterGL=BIt,Object.defineProperty(vbt,"__esModule",{value:!0});var UIt=xbt,VIt=vbt.ScatterGL=UIt.ScatterGL,jIt=jNt;function WIt(t){let e;return{c(){e=IN("div"),FN(e,"id","scatter-container"),FN(e,"class","svelte-f0tf1i")},m(n,r){CN(n,e,r),t[4](e)},p:nN,d(n){n&&AN(e),t[4](null)}}}function HIt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[WIt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),66&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function GIt(t,e,n){let r,i,{title:s}=e,{embedding:o}=e,{labels:a}=e;return rI((()=>{const t=document.getElementById("scatter-container");i=new VIt(t,{styles:{point:{scaleDefault:1.6,scaleSelected:2,scaleHover:2}}}),o.subscribe((t=>{if(t.length>0){let e=[];e=void 0===a||0===a.get().length?new Array(t.length).fill(0):a.get();const n=new VIt.Dataset(t);i.render(n);const r=Array.from(new Set(e)),s=[...new Array(r.length)].map(((t,e)=>Math.floor(255/r.length*e))),o=s.map((t=>`hsla(${t}, 100%, 50%, 0.1)`)),l=s.map((t=>`hsla(${t}, 100%, 50%, 0.75)`)),c=s.map((t=>`hsla(${t}, 100%, 50%, 1)`));i.setPointColorer(((t,n,i)=>n.size>0?n.has(t)?c[r.indexOf(e[t])]:o[r.indexOf(e[t])]:t===i?c[r.indexOf(e[t])]:l[r.indexOf(e[t])]))}})),a.subscribe((t=>{const e=Array.from(new Set(t)),n=[...new Array(e.length)].map(((t,n)=>Math.floor(255/e.length*n))),r=n.map((t=>`hsla(${t}, 100%, 50%, 0.1)`)),s=n.map((t=>`hsla(${t}, 100%, 50%, 0.75)`)),o=n.map((t=>`hsla(${t}, 100%, 50%, 1)`));i.setPointColorer(((n,i,a)=>i.size>0?i.has(n)?o[e.indexOf(t[n])]:r[e.indexOf(t[n])]:n===a?o[e.indexOf(t[n])]:s[e.indexOf(t[n])]))}))})),t.$$set=t=>{"title"in t&&n(0,s=t.title),"embedding"in t&&n(2,o=t.embedding),"labels"in t&&n(3,a=t.labels)},[s,r,o,a,function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}vbt.Dataset=jIt.Dataset;class qIt extends HI{constructor(t){super(),WI(this,t,GIt,HIt,lN,{title:0,embedding:2,labels:3})}get title(){return this.$$.ctx[0]}set title(t){this.$$set({title:t}),_I()}get embedding(){return this.$$.ctx[2]}set embedding(t){this.$$set({embedding:t}),_I()}get labels(){return this.$$.ctx[3]}set labels(t){this.$$set({labels:t}),_I()}}class XIt extends mG{constructor(t,e){super(),this.title="Scatter plot",this.$data=t.hold(),this.$labels=e.hold(),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new qIt({target:e,props:{title:this.title,embedding:this.$data,labels:this.$labels}}))}}function YIt(t){let e,n;return e=new F$({props:{options:t[3],value:t[4]}}),e.$on("change",t[5]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.options=t[3]),16&n&&(r.value=t[4]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function KIt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[YIt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function ZIt(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(u,(t=>n(3,r=t))),u),a=nN,l=()=>(a(),a=hN(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{options:u}=e;o();let{value:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"options"in t&&o(n(1,u=t.options)),"value"in t&&l(n(2,h=t.value))},[c,u,h,r,i,function({detail:t}){h.set(t)}]}class JIt extends HI{constructor(t){super(),WI(this,t,ZIt,KIt,lN,{title:0,options:1,value:2})}}class QIt extends mG{constructor(t,e){super(),this.title="select",this.$options=new JH(t,!0),this.$value=new JH(void 0!==e?e:t[0],!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new JIt({target:e,props:{title:this.title,options:this.$options,value:this.$value}}))}}const{document:t$t}=LI;function e$t(t){let e;return{c(){e=RN("Clear")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function n$t(t){let e,n,r,i,s,o,a,l;return s=new XI({props:{size:"small",type:"danger",$$slots:{default:[e$t]},$$scope:{ctx:t}}}),s.$on("click",t[2]),{c(){e=IN("div"),n=IN("canvas"),r=ON(),i=IN("div"),UI(s.$$.fragment),FN(n,"id","fxid"),FN(n,"class","sketchpad-container svelte-1trukpy"),FN(n,"width","300"),FN(n,"height","300"),FN(i,"class","m-1"),FN(e,"class","w-full flex flex-col items-center box-border")},m(c,u){CN(c,e,u),TN(e,n),t[8](n),TN(e,r),TN(e,i),VI(s,i,null),o=!0,a||(l=[LN(n,"mousemove",t[3]),LN(n,"mousedown",t[4])],a=!0)},p(t,e){const n={};16384&e&&(n.$$scope={dirty:e,ctx:t}),s.$set(n)},i(t){o||(NI(s.$$.fragment,t),o=!0)},o(t){II(s.$$.fragment,t),o=!1},d(n){n&&AN(e),t[8](null),jI(s),a=!1,oN(l)}}}function r$t(t){let e,n,r,i,s;return n=new OU({props:{title:t[0],$$slots:{default:[n$t]},$$scope:{ctx:t}}}),{c(){e=ON(),UI(n.$$.fragment)},m(o,a){CN(o,e,a),VI(n,o,a),r=!0,i||(s=LN(t$t.body,"mouseup",t[5]),i=!0)},p(t,[e]){const r={};1&e&&(r.title=t[0]),16386&e&&(r.$$scope={dirty:e,ctx:t}),n.$set(r)},i(t){r||(NI(n.$$.fragment,t),r=!0)},o(t){II(n.$$.fragment,t),r=!1},d(t){t&&AN(e),jI(n,t),i=!1,s()}}}function i$t(t,e,n){let r,i,{title:s}=e,{strokeStart:o}=e,{strokeEnd:a}=e,l=!1,c={left:0,top:0},u={x:0,y:0};const h=oI();function d(){i.clearRect(0,0,r.width,r.height),i.fillStyle="white",i.fillRect(0,0,r.width,r.height),l=!1}function p(t){const e=t.clientX-c.left,n=t.clientY-c.top;l&&(i.beginPath(),i.strokeStyle="black",i.lineWidth=10,i.lineJoin="round",i.moveTo(u.x,u.y),i.lineTo(e,n),i.closePath(),i.stroke()),u.x=e,u.y=n}return rI((async()=>{await gI(),await gI(),i=r.getContext("2d"),d(),h("canvasElement",r)})),t.$$set=t=>{"title"in t&&n(0,s=t.title),"strokeStart"in t&&n(6,o=t.strokeStart),"strokeEnd"in t&&n(7,a=t.strokeEnd)},[s,r,d,p,function(t){const e=r.getBoundingClientRect();c={top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft},p(t),o.set(),l=!0},function(){l&&a.set(),l=!1},o,a,function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class s$t extends HI{constructor(t){super(),WI(this,t,i$t,r$t,lN,{title:0,strokeStart:6,strokeEnd:7})}}var o$t,a$t,l$t,c$t;class u$t extends mG{constructor(){super(),this.title="sketchPad",this.$images=new JH(qV()),this.$thumbnails=new JH(qV()),this.$strokeStart=new JH(qV()),this.$strokeEnd=new JH(qV()),o$t.set(this,60),a$t.set(this,void 0),l$t.set(this,void 0),c$t.set(this,void 0),this.setupCapture(),this.$strokeEnd.subscribe((()=>{this.capture()})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new s$t({target:e,props:{title:this.title,strokeStart:this.$strokeStart,strokeEnd:this.$strokeEnd}}),this.$$.app.$on("canvasElement",(t=>{this.sketchElement=t.detail,BH(this,c$t,this.sketchElement.getContext("2d"),"f")})))}setupCapture(){BH(this,a$t,document.createElement("canvas"),"f"),zH(this,a$t,"f").width=zH(this,o$t,"f"),zH(this,a$t,"f").height=zH(this,o$t,"f"),BH(this,l$t,zH(this,a$t,"f").getContext("2d"),"f")}capture(){const t=this.captureThumbnail();this.$thumbnails.set(t),this.$images.set(this.captureImage())}captureThumbnail(){return zH(this,l$t,"f").drawImage(this.sketchElement,0,0,zH(this,a$t,"f").width,zH(this,a$t,"f").height),zH(this,a$t,"f").toDataURL("image/jpeg")}captureImage(){return zH(this,c$t,"f").getImageData(0,0,this.sketchElement.width,this.sketchElement.height)}}function h$t(t){return"[object Date]"===Object.prototype.toString.call(t)}function d$t(t,e,n,r){if("number"==typeof n||h$t(n)){const i=r-n,s=(n-e)/(t.dt||1/60),o=(s+(t.opts.stiffness*i-t.opts.damping*s)*t.inv_mass)*t.dt;return Math.abs(o)<t.opts.precision&&Math.abs(i)<t.opts.precision?r:(t.settled=!1,h$t(n)?new Date(n.getTime()+o):n+o)}if(Array.isArray(n))return n.map(((i,s)=>d$t(t,e[s],n[s],r[s])));if("object"==typeof n){const i={};for(const s in n)i[s]=d$t(t,e[s],n[s],r[s]);return i}throw new Error(`Cannot spring ${typeof n} values`)}function p$t(t,e={}){const n=H$(t),{stiffness:r=.15,damping:i=.8,precision:s=.01}=e;let o,a,l,c=t,u=t,h=1,d=0,p=!1;function f(e,r={}){u=e;const i=l={};if(null==t||r.hard||m.stiffness>=1&&m.damping>=1)return p=!0,o=xN(),c=e,n.set(t=u),Promise.resolve();if(r.soft){const t=!0===r.soft?.5:+r.soft;d=1/(60*t),h=0}return a||(o=xN(),p=!1,a=kN((e=>{if(p)return p=!1,a=null,!1;h=Math.min(h+d,1);const r={inv_mass:h,opts:m,settled:!0,dt:60*(e-o)/1e3},i=d$t(r,c,t,u);return o=e,c=t,n.set(t=i),r.settled&&(a=null),!r.settled}))),new Promise((t=>{a.promise.then((()=>{i===l&&t()}))}))}const m={set:f,update:(e,n)=>f(e(u,t),n),subscribe:n.subscribe,stiffness:r,damping:i,precision:s};return m}function f$t(t,e,n){const r=t.slice();return r[28]=e[n],r[30]=n,r}function m$t(t){let e,n,r,i,s=("label"===t[6]||"label"===t[7])&&g$t(t);return{c(){e=IN("span"),s&&s.c(),FN(e,"class","pip first"),FN(e,"style",n=t[14]+": 0%;"),GN(e,"selected",t[18](t[0])),GN(e,"in-range",t[17](t[0]))},m(n,o){CN(n,e,o),s&&s.m(e,null),r||(i=[LN(e,"click",(function(){aN(t[21](t[0]))&&t[21](t[0]).apply(this,arguments)})),LN(e,"touchend",DN((function(){aN(t[21](t[0]))&&t[21](t[0]).apply(this,arguments)})))],r=!0)},p(r,i){"label"===(t=r)[6]||"label"===t[7]?s?s.p(t,i):(s=g$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null),16384&i&&n!==(n=t[14]+": 0%;")&&FN(e,"style",n),262145&i&&GN(e,"selected",t[18](t[0])),131073&i&&GN(e,"in-range",t[17](t[0]))},d(t){t&&AN(e),s&&s.d(),r=!1,oN(i)}}}function g$t(t){let e,n,r=t[12](t[16](t[0]),0,0)+"",i=t[10]&&y$t(t),s=t[11]&&b$t(t);return{c(){e=IN("span"),i&&i.c(),n=RN(r),s&&s.c(),FN(e,"class","pipVal")},m(t,r){CN(t,e,r),i&&i.m(e,null),TN(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=y$t(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),69633&o&&r!==(r=t[12](t[16](t[0]),0,0)+"")&&BN(n,r),t[11]?s?s.p(t,o):(s=b$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&AN(e),i&&i.d(),s&&s.d()}}}function y$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[10]),FN(e,"class","pipVal-prefix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){1024&e&&BN(n,t[10])},d(t){t&&AN(e)}}}function b$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[11]),FN(e,"class","pipVal-suffix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){2048&e&&BN(n,t[11])},d(t){t&&AN(e)}}}function v$t(t){let e,n=Array(t[20]+1),r=[];for(let e=0;e<n.length;e+=1)r[e]=k$t(f$t(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=PN()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);CN(t,e,n)},p(t,i){if(4120131&i){let s;for(n=Array(t[20]+1),s=0;s<n.length;s+=1){const o=f$t(t,n,s);r[s]?r[s].p(o,i):(r[s]=k$t(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){NN(r,t),t&&AN(e)}}}function x$t(t){let e,n,r,i,s,o=("label"===t[6]||"label"===t[9])&&w$t(t);return{c(){e=IN("span"),o&&o.c(),n=ON(),FN(e,"class","pip"),FN(e,"style",r=t[14]+": "+t[15](t[19](t[30]))+"%;"),GN(e,"selected",t[18](t[19](t[30]))),GN(e,"in-range",t[17](t[19](t[30])))},m(r,a){CN(r,e,a),o&&o.m(e,null),TN(e,n),i||(s=[LN(e,"click",(function(){aN(t[21](t[19](t[30])))&&t[21](t[19](t[30])).apply(this,arguments)})),LN(e,"touchend",DN((function(){aN(t[21](t[19](t[30])))&&t[21](t[19](t[30])).apply(this,arguments)})))],i=!0)},p(i,s){"label"===(t=i)[6]||"label"===t[9]?o?o.p(t,s):(o=w$t(t),o.c(),o.m(e,n)):o&&(o.d(1),o=null),573440&s&&r!==(r=t[14]+": "+t[15](t[19](t[30]))+"%;")&&FN(e,"style",r),786432&s&&GN(e,"selected",t[18](t[19](t[30]))),655360&s&&GN(e,"in-range",t[17](t[19](t[30])))},d(t){t&&AN(e),o&&o.d(),i=!1,oN(s)}}}function w$t(t){let e,n,r=t[12](t[19](t[30]),t[30],t[15](t[19](t[30])))+"",i=t[10]&&_$t(t),s=t[11]&&S$t(t);return{c(){e=IN("span"),i&&i.c(),n=RN(r),s&&s.c(),FN(e,"class","pipVal")},m(t,r){CN(t,e,r),i&&i.m(e,null),TN(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=_$t(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),561152&o&&r!==(r=t[12](t[19](t[30]),t[30],t[15](t[19](t[30])))+"")&&BN(n,r),t[11]?s?s.p(t,o):(s=S$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&AN(e),i&&i.d(),s&&s.d()}}}function _$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[10]),FN(e,"class","pipVal-prefix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){1024&e&&BN(n,t[10])},d(t){t&&AN(e)}}}function S$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[11]),FN(e,"class","pipVal-suffix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){2048&e&&BN(n,t[11])},d(t){t&&AN(e)}}}function k$t(t){let e,n=t[19](t[30])!==t[0]&&t[19](t[30])!==t[1],r=n&&x$t(t);return{c(){r&&r.c(),e=PN()},m(t,n){r&&r.m(t,n),CN(t,e,n)},p(t,i){524291&i&&(n=t[19](t[30])!==t[0]&&t[19](t[30])!==t[1]),n?r?r.p(t,i):(r=x$t(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},d(t){r&&r.d(t),t&&AN(e)}}}function T$t(t){let e,n,r,i,s=("label"===t[6]||"label"===t[8])&&E$t(t);return{c(){e=IN("span"),s&&s.c(),FN(e,"class","pip last"),FN(e,"style",n=t[14]+": 100%;"),GN(e,"selected",t[18](t[1])),GN(e,"in-range",t[17](t[1]))},m(n,o){CN(n,e,o),s&&s.m(e,null),r||(i=[LN(e,"click",(function(){aN(t[21](t[1]))&&t[21](t[1]).apply(this,arguments)})),LN(e,"touchend",DN((function(){aN(t[21](t[1]))&&t[21](t[1]).apply(this,arguments)})))],r=!0)},p(r,i){"label"===(t=r)[6]||"label"===t[8]?s?s.p(t,i):(s=E$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null),16384&i&&n!==(n=t[14]+": 100%;")&&FN(e,"style",n),262146&i&&GN(e,"selected",t[18](t[1])),131074&i&&GN(e,"in-range",t[17](t[1]))},d(t){t&&AN(e),s&&s.d(),r=!1,oN(i)}}}function E$t(t){let e,n,r=t[12](t[16](t[1]),t[20],100)+"",i=t[10]&&M$t(t),s=t[11]&&C$t(t);return{c(){e=IN("span"),i&&i.c(),n=RN(r),s&&s.c(),FN(e,"class","pipVal")},m(t,r){CN(t,e,r),i&&i.m(e,null),TN(e,n),s&&s.m(e,null)},p(t,o){t[10]?i?i.p(t,o):(i=M$t(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),1118210&o&&r!==(r=t[12](t[16](t[1]),t[20],100)+"")&&BN(n,r),t[11]?s?s.p(t,o):(s=C$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&AN(e),i&&i.d(),s&&s.d()}}}function M$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[10]),FN(e,"class","pipVal-prefix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){1024&e&&BN(n,t[10])},d(t){t&&AN(e)}}}function C$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[11]),FN(e,"class","pipVal-suffix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){2048&e&&BN(n,t[11])},d(t){t&&AN(e)}}}function A$t(t){let e,n,r,i=(t[6]&&!1!==t[7]||t[7])&&m$t(t),s=(t[6]&&!1!==t[9]||t[9])&&v$t(t),o=(t[6]&&!1!==t[8]||t[8])&&T$t(t);return{c(){e=IN("div"),i&&i.c(),n=ON(),s&&s.c(),r=ON(),o&&o.c(),FN(e,"class","rangePips"),GN(e,"disabled",t[5]),GN(e,"hoverable",t[4]),GN(e,"vertical",t[2]),GN(e,"reversed",t[3]),GN(e,"focus",t[13])},m(t,a){CN(t,e,a),i&&i.m(e,null),TN(e,n),s&&s.m(e,null),TN(e,r),o&&o.m(e,null)},p(t,[a]){t[6]&&!1!==t[7]||t[7]?i?i.p(t,a):(i=m$t(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),t[6]&&!1!==t[9]||t[9]?s?s.p(t,a):(s=v$t(t),s.c(),s.m(e,r)):s&&(s.d(1),s=null),t[6]&&!1!==t[8]||t[8]?o?o.p(t,a):(o=T$t(t),o.c(),o.m(e,null)):o&&(o.d(1),o=null),32&a&&GN(e,"disabled",t[5]),16&a&&GN(e,"hoverable",t[4]),4&a&&GN(e,"vertical",t[2]),8&a&&GN(e,"reversed",t[3]),8192&a&&GN(e,"focus",t[13])},i:nN,o:nN,d(t){t&&AN(e),i&&i.d(),s&&s.d(),o&&o.d()}}}function N$t(t,e,n){let r,i,s,o,a,{range:l=!1}=e,{min:c=0}=e,{max:u=100}=e,{step:h=1}=e,{values:d=[(u+c)/2]}=e,{vertical:p=!1}=e,{reversed:f=!1}=e,{hoverable:m=!0}=e,{disabled:g=!1}=e,{pipstep:y}=e,{all:b=!0}=e,{first:v}=e,{last:x}=e,{rest:w}=e,{prefix:_=""}=e,{suffix:S=""}=e,{formatter:k=((t,e)=>t)}=e,{focus:T}=e,{orientationStart:E}=e,{percentOf:M}=e,{moveHandle:C}=e,{fixFloat:A}=e;return t.$$set=t=>{"range"in t&&n(22,l=t.range),"min"in t&&n(0,c=t.min),"max"in t&&n(1,u=t.max),"step"in t&&n(23,h=t.step),"values"in t&&n(24,d=t.values),"vertical"in t&&n(2,p=t.vertical),"reversed"in t&&n(3,f=t.reversed),"hoverable"in t&&n(4,m=t.hoverable),"disabled"in t&&n(5,g=t.disabled),"pipstep"in t&&n(25,y=t.pipstep),"all"in t&&n(6,b=t.all),"first"in t&&n(7,v=t.first),"last"in t&&n(8,x=t.last),"rest"in t&&n(9,w=t.rest),"prefix"in t&&n(10,_=t.prefix),"suffix"in t&&n(11,S=t.suffix),"formatter"in t&&n(12,k=t.formatter),"focus"in t&&n(13,T=t.focus),"orientationStart"in t&&n(14,E=t.orientationStart),"percentOf"in t&&n(15,M=t.percentOf),"moveHandle"in t&&n(26,C=t.moveHandle),"fixFloat"in t&&n(16,A=t.fixFloat)},t.$$.update=()=>{41943047&t.$$.dirty&&n(27,r=y||((u-c)/h>=(p?50:100)?(u-c)/(p?10:20):1)),142606339&t.$$.dirty&&n(20,i=parseInt((u-c)/(h*r),10)),142671873&t.$$.dirty&&n(19,s=function(t){return A(c+t*h*r)}),16842752&t.$$.dirty&&n(18,o=function(t){return d.some((e=>A(e)===A(t)))}),20971520&t.$$.dirty&&n(17,a=function(t){return"min"===l?d[0]>t:"max"===l?d[0]<t:l?d[0]<t&&d[1]>t:void 0})},[c,u,p,f,m,g,b,v,x,w,_,S,k,T,E,M,A,a,o,s,i,function(t){g||C(void 0,t)},l,h,d,y,C,r]}o$t=new WeakMap,a$t=new WeakMap,l$t=new WeakMap,c$t=new WeakMap;class I$t extends HI{constructor(t){super(),WI(this,t,N$t,A$t,lN,{range:22,min:0,max:1,step:23,values:24,vertical:2,reversed:3,hoverable:4,disabled:5,pipstep:25,all:6,first:7,last:8,rest:9,prefix:10,suffix:11,formatter:12,focus:13,orientationStart:14,percentOf:15,moveHandle:26,fixFloat:16})}}function $$t(t,e,n){const r=t.slice();return r[64]=e[n],r[66]=n,r}function R$t(t){let e,n,r=t[21](t[64],t[66],t[23](t[64]))+"",i=t[18]&&O$t(t),s=t[19]&&P$t(t);return{c(){e=IN("span"),i&&i.c(),n=RN(r),s&&s.c(),FN(e,"class","rangeFloat")},m(t,r){CN(t,e,r),i&&i.m(e,null),TN(e,n),s&&s.m(e,null)},p(t,o){t[18]?i?i.p(t,o):(i=O$t(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),10485761&o[0]&&r!==(r=t[21](t[64],t[66],t[23](t[64]))+"")&&BN(n,r),t[19]?s?s.p(t,o):(s=P$t(t),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(t){t&&AN(e),i&&i.d(),s&&s.d()}}}function O$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[18]),FN(e,"class","rangeFloat-prefix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){262144&e[0]&&BN(n,t[18])},d(t){t&&AN(e)}}}function P$t(t){let e,n;return{c(){e=IN("span"),n=RN(t[19]),FN(e,"class","rangeFloat-suffix")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){524288&e[0]&&BN(n,t[19])},d(t){t&&AN(e)}}}function L$t(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[7]&&R$t(t);return{c(){e=IN("span"),n=IN("span"),r=ON(),p&&p.c(),FN(n,"class","rangeNub"),FN(e,"role","slider"),FN(e,"class","rangeHandle"),FN(e,"data-handle",t[66]),FN(e,"style",i=t[28]+": "+t[29][t[66]]+"%; z-index: "+(t[26]===t[66]?3:2)+";"),FN(e,"aria-valuemin",s=!0===t[2]&&1===t[66]?t[0][0]:t[3]),FN(e,"aria-valuemax",o=!0===t[2]&&0===t[66]?t[0][1]:t[4]),FN(e,"aria-valuenow",a=t[64]),FN(e,"aria-valuetext",l=""+(t[18]+t[21](t[64],t[66],t[23](t[64]))+t[19])),FN(e,"aria-orientation",c=t[6]?"vertical":"horizontal"),FN(e,"aria-disabled",t[10]),FN(e,"disabled",t[10]),FN(e,"tabindex",u=t[10]?-1:0),GN(e,"active",t[24]&&t[26]===t[66]),GN(e,"press",t[25]&&t[26]===t[66])},m(i,s){CN(i,e,s),TN(e,n),TN(e,r),p&&p.m(e,null),h||(d=[LN(e,"blur",t[34]),LN(e,"focus",t[35]),LN(e,"keydown",t[36])],h=!0)},p(t,n){t[7]?p?p.p(t,n):(p=R$t(t),p.c(),p.m(e,null)):p&&(p.d(1),p=null),872415232&n[0]&&i!==(i=t[28]+": "+t[29][t[66]]+"%; z-index: "+(t[26]===t[66]?3:2)+";")&&FN(e,"style",i),13&n[0]&&s!==(s=!0===t[2]&&1===t[66]?t[0][0]:t[3])&&FN(e,"aria-valuemin",s),21&n[0]&&o!==(o=!0===t[2]&&0===t[66]?t[0][1]:t[4])&&FN(e,"aria-valuemax",o),1&n[0]&&a!==(a=t[64])&&FN(e,"aria-valuenow",a),11272193&n[0]&&l!==(l=""+(t[18]+t[21](t[64],t[66],t[23](t[64]))+t[19]))&&FN(e,"aria-valuetext",l),64&n[0]&&c!==(c=t[6]?"vertical":"horizontal")&&FN(e,"aria-orientation",c),1024&n[0]&&FN(e,"aria-disabled",t[10]),1024&n[0]&&FN(e,"disabled",t[10]),1024&n[0]&&u!==(u=t[10]?-1:0)&&FN(e,"tabindex",u),83886080&n[0]&&GN(e,"active",t[24]&&t[26]===t[66]),100663296&n[0]&&GN(e,"press",t[25]&&t[26]===t[66])},d(t){t&&AN(e),p&&p.d(),h=!1,oN(d)}}}function D$t(t){let e,n;return{c(){e=IN("span"),FN(e,"class","rangeBar"),FN(e,"style",n=t[28]+": "+t[32](t[29])+"%; "+t[27]+": "+t[33](t[29])+"%;")},m(t,n){CN(t,e,n)},p(t,r){939524096&r[0]&&n!==(n=t[28]+": "+t[32](t[29])+"%; "+t[27]+": "+t[33](t[29])+"%;")&&FN(e,"style",n)},d(t){t&&AN(e)}}}function F$t(t){let e,n;return e=new I$t({props:{values:t[0],min:t[3],max:t[4],step:t[5],range:t[2],vertical:t[6],reversed:t[8],orientationStart:t[28],hoverable:t[9],disabled:t[10],all:t[13],first:t[14],last:t[15],rest:t[16],pipstep:t[12],prefix:t[18],suffix:t[19],formatter:t[20],focus:t[24],percentOf:t[23],moveHandle:t[31],fixFloat:t[30]}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};1&n[0]&&(r.values=t[0]),8&n[0]&&(r.min=t[3]),16&n[0]&&(r.max=t[4]),32&n[0]&&(r.step=t[5]),4&n[0]&&(r.range=t[2]),64&n[0]&&(r.vertical=t[6]),256&n[0]&&(r.reversed=t[8]),268435456&n[0]&&(r.orientationStart=t[28]),512&n[0]&&(r.hoverable=t[9]),1024&n[0]&&(r.disabled=t[10]),8192&n[0]&&(r.all=t[13]),16384&n[0]&&(r.first=t[14]),32768&n[0]&&(r.last=t[15]),65536&n[0]&&(r.rest=t[16]),4096&n[0]&&(r.pipstep=t[12]),262144&n[0]&&(r.prefix=t[18]),524288&n[0]&&(r.suffix=t[19]),1048576&n[0]&&(r.formatter=t[20]),16777216&n[0]&&(r.focus=t[24]),8388608&n[0]&&(r.percentOf=t[23]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function z$t(t){let e,n,r,i,s,o,a=t[0],l=[];for(let e=0;e<a.length;e+=1)l[e]=L$t($$t(t,a,e));let c=t[2]&&D$t(t),u=t[11]&&F$t(t);return{c(){e=IN("div");for(let t=0;t<l.length;t+=1)l[t].c();n=ON(),c&&c.c(),r=ON(),u&&u.c(),FN(e,"id",t[17]),FN(e,"class","rangeSlider"),GN(e,"range",t[2]),GN(e,"disabled",t[10]),GN(e,"hoverable",t[9]),GN(e,"vertical",t[6]),GN(e,"reversed",t[8]),GN(e,"focus",t[24]),GN(e,"min","min"===t[2]),GN(e,"max","max"===t[2]),GN(e,"pips",t[11]),GN(e,"pip-labels","label"===t[13]||"label"===t[14]||"label"===t[15]||"label"===t[16])},m(a,h){CN(a,e,h);for(let t=0;t<l.length;t+=1)l[t].m(e,null);TN(e,n),c&&c.m(e,null),TN(e,r),u&&u.m(e,null),t[50](e),i=!0,s||(o=[LN(window,"mousedown",t[39]),LN(window,"touchstart",t[39]),LN(window,"mousemove",t[40]),LN(window,"touchmove",t[40]),LN(window,"mouseup",t[41]),LN(window,"touchend",t[42]),LN(window,"keydown",t[43]),LN(e,"mousedown",t[37]),LN(e,"mouseup",t[38]),LN(e,"touchstart",DN(t[37])),LN(e,"touchend",DN(t[38]))],s=!0)},p(t,s){if(934020317&s[0]|56&s[1]){let r;for(a=t[0],r=0;r<a.length;r+=1){const i=$$t(t,a,r);l[r]?l[r].p(i,s):(l[r]=L$t(i),l[r].c(),l[r].m(e,n))}for(;r<l.length;r+=1)l[r].d(1);l.length=a.length}t[2]?c?c.p(t,s):(c=D$t(t),c.c(),c.m(e,r)):c&&(c.d(1),c=null),t[11]?u?(u.p(t,s),2048&s[0]&&NI(u,1)):(u=F$t(t),u.c(),NI(u,1),u.m(e,null)):u&&(CI(),II(u,1,1,(()=>{u=null})),AI()),(!i||131072&s[0])&&FN(e,"id",t[17]),(!i||4&s[0])&&GN(e,"range",t[2]),(!i||1024&s[0])&&GN(e,"disabled",t[10]),(!i||512&s[0])&&GN(e,"hoverable",t[9]),(!i||64&s[0])&&GN(e,"vertical",t[6]),(!i||256&s[0])&&GN(e,"reversed",t[8]),(!i||16777216&s[0])&&GN(e,"focus",t[24]),(!i||4&s[0])&&GN(e,"min","min"===t[2]),(!i||4&s[0])&&GN(e,"max","max"===t[2]),(!i||2048&s[0])&&GN(e,"pips",t[11]),(!i||122880&s[0])&&GN(e,"pip-labels","label"===t[13]||"label"===t[14]||"label"===t[15]||"label"===t[16])},i(t){i||(NI(u),i=!0)},o(t){II(u),i=!1},d(n){n&&AN(e),NN(l,n),c&&c.d(),u&&u.d(),t[50](null),s=!1,oN(o)}}}function B$t(t){if(!t)return-1;for(var e=0;t=t.previousElementSibling;)e++;return e}function U$t(t){return t.type.includes("touch")?t.touches[0]:t}function V$t(t,e,n){let r,i,s,o,a,l,c=nN;t.$$.on_destroy.push((()=>c()));let{slider:u}=e,{range:h=!1}=e,{pushy:d=!1}=e,{min:p=0}=e,{max:f=100}=e,{step:m=1}=e,{values:g=[(f+p)/2]}=e,{vertical:y=!1}=e,{float:b=!1}=e,{reversed:v=!1}=e,{hoverable:x=!0}=e,{disabled:w=!1}=e,{pips:_=!1}=e,{pipstep:S}=e,{all:k}=e,{first:T}=e,{last:E}=e,{rest:M}=e,{id:C}=e,{prefix:A=""}=e,{suffix:N=""}=e,{formatter:I=((t,e,n)=>t)}=e,{handleFormatter:$=I}=e,{precision:R=2}=e,{springValues:O={stiffness:.15,damping:.4}}=e;const P=oI();let L,D,F,z=0,B=!1,U=!1,V=!1,j=!1,W=g.length-1;const H=t=>parseFloat(t.toFixed(R));function G(){return u.getBoundingClientRect()}function q(t){const e=G();let n=0,r=0,i=0;y?(n=t.clientY-e.top,r=n/e.height*100,r=v?r:100-r):(n=t.clientX-e.left,r=n/e.width*100,r=v?100-r:r),i=(f-p)/100*r+p,X(W,i)}function X(t,e){return e=s(e),void 0===t&&(t=W),h&&(0===t&&e>g[1]?d?n(0,g[1]=e,g):e=g[1]:1===t&&e<g[0]&&(d?n(0,g[0]=e,g):e=g[0])),g[t]!==e&&n(0,g[t]=e,g),D!==e&&(!w&&P("change",{activeHandle:W,startValue:L,previousValue:void 0===D?L:D,value:g[W],values:g.map((t=>s(t)))}),D=e),e}function Y(){!w&&P("stop",{activeHandle:W,startValue:L,value:g[W],values:g.map((t=>s(t)))})}return t.$$set=t=>{"slider"in t&&n(1,u=t.slider),"range"in t&&n(2,h=t.range),"pushy"in t&&n(44,d=t.pushy),"min"in t&&n(3,p=t.min),"max"in t&&n(4,f=t.max),"step"in t&&n(5,m=t.step),"values"in t&&n(0,g=t.values),"vertical"in t&&n(6,y=t.vertical),"float"in t&&n(7,b=t.float),"reversed"in t&&n(8,v=t.reversed),"hoverable"in t&&n(9,x=t.hoverable),"disabled"in t&&n(10,w=t.disabled),"pips"in t&&n(11,_=t.pips),"pipstep"in t&&n(12,S=t.pipstep),"all"in t&&n(13,k=t.all),"first"in t&&n(14,T=t.first),"last"in t&&n(15,E=t.last),"rest"in t&&n(16,M=t.rest),"id"in t&&n(17,C=t.id),"prefix"in t&&n(18,A=t.prefix),"suffix"in t&&n(19,N=t.suffix),"formatter"in t&&n(20,I=t.formatter),"handleFormatter"in t&&n(21,$=t.handleFormatter),"precision"in t&&n(45,R=t.precision),"springValues"in t&&n(46,O=t.springValues)},t.$$.update=()=>{24&t.$$.dirty[0]&&n(49,i=function(t){return t<=p?p:t>=f?f:t}),56&t.$$.dirty[0]|262144&t.$$.dirty[1]&&n(48,s=function(t){if(t<=p)return H(p);if(t>=f)return H(f);let e=(t-p)%m,n=t-e;return 2*Math.abs(e)>=m&&(n+=e>0?m:-m),n=i(n),H(n)}),24&t.$$.dirty[0]&&n(23,r=function(t){let e=(t-p)/(f-p)*100;return isNaN(e)||e<=0?0:e>=100?100:H(e)}),12582937&t.$$.dirty[0]|229376&t.$$.dirty[1]&&(Array.isArray(g)||(n(0,g=[(f+p)/2]),console.error("'values' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)")),n(0,g=function(t){return"min"===h||"max"===h?t.slice(0,1):h?t.slice(0,2):t}(g.map((t=>s(t))))),z!==g.length?(n(22,F=p$t(g.map((t=>r(t))),O)),c(),c=hN(F,(t=>n(29,l=t)))):F.set(g.map((t=>r(t)))),n(47,z=g.length)),320&t.$$.dirty[0]&&n(28,o=y?v?"top":"bottom":v?"right":"left"),320&t.$$.dirty[0]&&n(27,a=y?v?"bottom":"top":v?"left":"right")},[g,u,h,p,f,m,y,b,v,x,w,_,S,k,T,E,M,C,A,N,I,$,F,r,B,V,W,a,o,l,H,X,function(t){return"min"===h?0:t[0]},function(t){return"max"===h?0:"min"===h?100-t[0]:100-t[1]},function(t){j&&(n(24,B=!1),U=!1,n(25,V=!1))},function(t){w||(n(26,W=B$t(t.target)),n(24,B=!0))},function(t){if(!w){const e=B$t(t.target);let n=t.ctrlKey||t.metaKey||t.shiftKey?10*m:m,r=!1;switch(t.key){case"PageDown":n*=10;case"ArrowRight":case"ArrowUp":X(e,g[e]+n),r=!0;break;case"PageUp":n*=10;case"ArrowLeft":case"ArrowDown":X(e,g[e]-n),r=!0;break;case"Home":X(e,p),r=!0;break;case"End":X(e,f),r=!0}r&&(t.preventDefault(),t.stopPropagation())}},function(t){if(!w){const e=t.target,r=U$t(t);n(24,B=!0),U=!0,n(25,V=!0),n(26,W=function(t){const e=G();let n,r=0,i=0,s=0;return y?(r=t.clientY-e.top,i=r/e.height*100,i=v?i:100-i):(r=t.clientX-e.left,i=r/e.width*100,i=v?100-i:i),s=(f-p)/100*i+p,!0===h&&g[0]===g[1]?s>g[1]?1:0:(n=g.indexOf([...g].sort(((t,e)=>Math.abs(s-t)-Math.abs(s-e)))[0]),n)}(r)),L=D=s(g[W]),!w&&P("start",{activeHandle:W,value:L,values:g.map((t=>s(t)))}),"touchstart"!==t.type||e.matches(".pipVal")||q(r)}},function(t){"touchend"===t.type&&Y(),n(25,V=!1)},function(t){j=!1,B&&t.target!==u&&!u.contains(t.target)&&n(24,B=!1)},function(t){w||U&&q(U$t(t))},function(t){if(!w){const e=t.target;U&&((e===u||u.contains(e))&&(n(24,B=!0),function(t){const e=u.querySelectorAll(".handle"),n=Array.prototype.includes.call(e,t),r=Array.prototype.some.call(e,(e=>e.contains(t)));return n||r}(e)||e.matches(".pipVal")||q(U$t(t))),Y())}U=!1,n(25,V=!1)},function(t){U=!1,n(25,V=!1)},function(t){w||(t.target===u||u.contains(t.target))&&(j=!0)},d,R,O,z,s,i,function(t){uI[t?"unshift":"push"]((()=>{u=t,n(1,u)}))}]}class j$t extends HI{constructor(t){super(),WI(this,t,V$t,z$t,lN,{slider:1,range:2,pushy:44,min:3,max:4,step:5,values:0,vertical:6,float:7,reversed:8,hoverable:9,disabled:10,pips:11,pipstep:12,all:13,first:14,last:15,rest:16,id:17,prefix:18,suffix:19,formatter:20,handleFormatter:21,precision:45,springValues:46},null,[-1,-1,-1])}}function W$t(t){let e,n;return e=new j$t({props:{values:t[12],min:t[13],max:t[14],step:t[15],range:t[5],float:t[6],vertical:t[7],pips:t[8],pipstep:t[9],formatter:t[10],all:"label",springValues:{stiffness:.2,damping:.8}}}),e.$on("stop",t[16]),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};4096&n&&(r.values=t[12]),8192&n&&(r.min=t[13]),16384&n&&(r.max=t[14]),32768&n&&(r.step=t[15]),32&n&&(r.range=t[5]),64&n&&(r.float=t[6]),128&n&&(r.vertical=t[7]),256&n&&(r.pips=t[8]),512&n&&(r.pipstep=t[9]),1024&n&&(r.formatter=t[10]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function H$t(t){let e,n,r;function i(e){t[17](e)}let s={min:t[13],max:t[14],step:t[15],range:t[5],float:t[6],vertical:t[7],pips:t[8],pipstep:t[9],formatter:t[10],all:"label",springValues:{stiffness:.2,damping:.8}};return void 0!==t[12]&&(s.values=t[12]),e=new j$t({props:s}),uI.push((()=>BI(e,"values",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};8192&r&&(i.min=t[13]),16384&r&&(i.max=t[14]),32768&r&&(i.step=t[15]),32&r&&(i.range=t[5]),64&r&&(i.float=t[6]),128&r&&(i.vertical=t[7]),256&r&&(i.pips=t[8]),512&r&&(i.pipstep=t[9]),1024&r&&(i.formatter=t[10]),!n&&4096&r&&(n=!0,i.values=t[12],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function G$t(t){let e,n,r,i;const s=[H$t,W$t],o=[];function a(t,e){return t[11]?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=PN()},m(t,n){o[e].m(t,n),CN(t,r,n),i=!0},p(t,i){let l=e;e=a(t),e===l?o[e].p(t,i):(CI(),II(o[l],1,1,(()=>{o[l]=null})),AI(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),NI(n,1),n.m(r.parentNode,r))},i(t){i||(NI(n),i=!0)},o(t){II(n),i=!1},d(t){o[e].d(t),t&&AN(r)}}}function q$t(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[G$t]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),327648&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function X$t(t,e,n){let r,i,s,o,a=nN,l=()=>(a(),a=hN(g,(t=>n(12,r=t))),g),c=nN,u=()=>(c(),c=hN(y,(t=>n(13,i=t))),y),h=nN,d=()=>(h(),h=hN(b,(t=>n(14,s=t))),b),p=nN,f=()=>(p(),p=hN(v,(t=>n(15,o=t))),v);t.$$.on_destroy.push((()=>a())),t.$$.on_destroy.push((()=>c())),t.$$.on_destroy.push((()=>h())),t.$$.on_destroy.push((()=>p()));let{title:m}=e,{values:g}=e;l();let{min:y}=e;u();let{max:b}=e;d();let{step:v}=e;f();let{range:x}=e,{float:w}=e,{vertical:_}=e,{pips:S}=e,{pipstep:k}=e,{formatter:T}=e,{continuous:E}=e;return t.$$set=t=>{"title"in t&&n(0,m=t.title),"values"in t&&l(n(1,g=t.values)),"min"in t&&u(n(2,y=t.min)),"max"in t&&d(n(3,b=t.max)),"step"in t&&f(n(4,v=t.step)),"range"in t&&n(5,x=t.range),"float"in t&&n(6,w=t.float),"vertical"in t&&n(7,_=t.vertical),"pips"in t&&n(8,S=t.pips),"pipstep"in t&&n(9,k=t.pipstep),"formatter"in t&&n(10,T=t.formatter),"continuous"in t&&n(11,E=t.continuous)},[m,g,y,b,v,x,w,_,S,k,T,E,r,i,s,o,function({detail:t}){g.set(t.values)},function(t){r=t,g.set(r)}]}class Y$t extends HI{constructor(t){super(),WI(this,t,X$t,q$t,lN,{title:0,values:1,min:2,max:3,step:4,range:5,float:6,vertical:7,pips:8,pipstep:9,formatter:10,continuous:11})}}class K$t extends mG{constructor({values:t=[.2],min:e=0,max:n=1,step:r=.01,range:i="min",float:s=!0,vertical:o=!1,pips:a=!1,pipstep:l,formatter:c=(t=>function(t,e){if(void 0===e||0==+e)return Math.round(t);let n=+t;const r=+e;if(isNaN(n)||"number"!=typeof r||r%1!=0)return NaN;let i=n.toString().split("e");return n=Math.round(+(i[0]+"e"+(i[1]?+i[1]+r:r))),i=n.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]-r:-r))}(t,3)),continuous:u=!0}={}){super(),this.title="slider",this.$values=new JH(t,!0),this.$min=new JH(e,!0),this.$max=new JH(n,!0),this.$step=new JH(r,!0),this.range=i,this.float=s,this.vertical=o,this.pips=a,this.pipstep=void 0!==l?l:Math.floor((n-e)/(10*r)),this.formatter=c,this.continuous=u,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new Y$t({target:e,props:{title:this.title,values:this.$values,min:this.$min,max:this.$max,step:this.$step,range:this.range,float:this.float,vertical:this.vertical,pips:this.pips,pipstep:this.pipstep,formatter:this.formatter,continuous:this.continuous}}))}}function Z$t(t){let e,n,r,i;return{c(){e=IN("div"),n=IN("textarea"),FN(n,"class","w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none svelte-1nngj94"),FN(n,"placeholder",t[2]),n.disabled=t[4],FN(e,"class","w-full svelte-1nngj94")},m(s,o){CN(s,e,o),TN(e,n),UN(n,t[5]),r||(i=LN(n,"input",t[6]),r=!0)},p(t,e){4&e&&FN(n,"placeholder",t[2]),16&e&&(n.disabled=t[4]),32&e&&UN(n,t[5])},d(t){t&&AN(e),r=!1,i()}}}function J$t(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[Z$t]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),180&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function Q$t(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(d,(t=>n(4,r=t))),d),a=nN,l=()=>(a(),a=hN(u,(t=>n(5,i=t))),u);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;l();let{placeholder:h}=e,{disabled:d}=e;return o(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&l(n(1,u=t.value)),"placeholder"in t&&n(2,h=t.placeholder),"disabled"in t&&o(n(3,d=t.disabled))},[c,u,h,d,r,i,function(){i=this.value,u.set(i)}]}class tRt extends HI{constructor(t){super(),WI(this,t,Q$t,J$t,lN,{title:0,value:1,placeholder:2,disabled:3})}}class eRt extends mG{constructor(t="",e=""){super(),this.title="text area",this.$disabled=new JH(!1,!0),this.$value=new JH(t,!0),this.placeholder=e,this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new tRt({target:e,props:{title:this.title,value:this.$value,placeholder:this.placeholder,disabled:this.$disabled}}))}}function nRt(t){let e,n,r,i,s;function o(e){t[5](e)}let a={type:"text",placeholder:"Enter a label..",disabled:t[4]};return void 0!==t[3]&&(a.value=t[3]),r=new ZI({props:a}),uI.push((()=>BI(r,"value",o))),{c(){e=IN("div"),n=IN("div"),UI(r.$$.fragment),FN(n,"class","md:flex md:items-center mb-2"),FN(e,"class","w-full max-w-sm")},m(t,i){CN(t,e,i),TN(e,n),VI(r,n,null),s=!0},p(t,e){const n={};16&e&&(n.disabled=t[4]),!i&&8&e&&(i=!0,n.value=t[3],bI((()=>i=!1))),r.$set(n)},i(t){s||(NI(r.$$.fragment,t),s=!0)},o(t){II(r.$$.fragment,t),s=!1},d(t){t&&AN(e),jI(r)}}}function rRt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[nRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),88&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function iRt(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(u,(t=>n(3,r=t))),u),a=nN,l=()=>(a(),a=hN(h,(t=>n(4,i=t))),h);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{value:u}=e;o();let{disabled:h}=e;return l(),t.$$set=t=>{"title"in t&&n(0,c=t.title),"value"in t&&o(n(1,u=t.value)),"disabled"in t&&l(n(2,h=t.disabled))},[c,u,h,r,i,function(t){r=t,u.set(r)}]}class sRt extends HI{constructor(t){super(),WI(this,t,iRt,rRt,lN,{title:0,value:1,disabled:2})}}class oRt extends mG{constructor(t){super(),this.title="text input",this.$value=new JH("",!0),this.$disabled=new JH(!1,!0),void 0!==t&&this.$value.set(t),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new sRt({target:e,props:{title:this.title,value:this.$value,disabled:this.$disabled}}))}}function aRt(...t){return new oRt(...t)}function lRt(t){let e;return{c(){e=IN("p"),e.textContent="No model loaded"},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function cRt(t){let e,n,r,i;return{c(){e=IN("p"),n=RN("Model Loaded from "),r=RN(t[2]),i=RN(".")},m(t,s){CN(t,e,s),TN(e,n),TN(e,r),TN(e,i)},p(t,e){4&e&&BN(r,t[2])},d(t){t&&AN(e)}}}function uRt(t){let e;return{c(){e=IN("p"),e.textContent="Loading Model..."},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function hRt(t){let e;function n(t,e){return"loading"===t[3]?uRt:"loaded"===t[3]?cRt:lRt}let r=n(t),i=r(t);return{c(){e=IN("div"),i.c(),FN(e,"class","p-2 text-sm text-gray-600")},m(t,n){CN(t,e,n),i.m(e,null)},p(t,s){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e,null)))},d(t){t&&AN(e),i.d()}}}function dRt(t){let e,n;return e=new OU({props:{title:t[0],loading:"loading"===t[3],$$slots:{default:[hRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),8&n&&(r.loading="loading"===t[3]),268&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function pRt(t,e,n){let r,i,s,o=nN,a=()=>(o(),o=hN(d,(t=>n(7,s=t))),d);var l,c,u;t.$$.on_destroy.push((()=>o()));let{title:h}=e,{training:d}=e;return a(),t.$$set=t=>{"title"in t&&n(0,h=t.title),"training"in t&&a(n(1,d=t.training))},t.$$.update=()=>{128&t.$$.dirty&&n(3,r=s.status),240&t.$$.dirty&&n(2,i=(null===n(4,l=s.data)||void 0===l?void 0:l.source)?"datastore"===s.data.source?`datastore at ${null===n(5,c=s.data)||void 0===c?void 0:c.url}`:"url"===s.data.source?`url ${null===n(6,u=s.data)||void 0===u?void 0:u.url}`:"files":"unknown source")},[h,d,i,r,l,c,u,s]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
ki().prototype.mul=function(t){return this.throwIfDisposed(),Na(this,t)};class fRt extends HI{constructor(t){super(),WI(this,t,pRt,dRt,lN,{title:0,training:1})}}function mRt(t,e){return t===e}function gRt(t,e){return t===e}class yRt extends H8{constructor({inputType:t,taskType:e,segmentationOptions:n={applyArgmax:!1,output:"image"}}){super(),this.title="tfjs model",this.parameters={},this.segmentationOptions={applyArgmax:!1,output:"image",...n},this.inputType=t,this.taskType=e,this.$training.subscribe((({status:t})=>{"loaded"===t&&(this.inputShape=this.model.inputs[0].shape.map((t=>t&&t>0?t:1)))}))}train(){throw new iG("Model `TfModel` cannot be trained")}async predict(t){if(!this.model||"loaded"!==this.$training.get().status)throw new Error("Model is not loaded");const e=Co((()=>{const e=this.preprocess(t);return this.model.predict(e.expandDims(0)).gather(0)})),n=await this.postprocess(e);return e.dispose(),n}preprocess(t){if(mRt(this.inputType,"image"))return this.preprocessImage(t);if(mRt(this.inputType,"generic"))return os(t);throw new Error("Invalid input data type")}preprocessImage(t){return rp.resizeBilinear(Yo(t),[this.inputShape[1],this.inputShape[2]])}async postprocess(t){if(gRt(this.taskType,"classification")){const e=this.labels?t=>this.labels[t]:t=>t.toString(),n=Co((()=>t.argMax().dataSync()[0])),r=t.arraySync().reduce(((t,n,r)=>({...t,[e(r)]:n})),{});return{label:e(n),confidences:r}}if(gRt(this.taskType,"segmentation")){const[e,n]=t.shape,r=this.segmentationOptions.applyArgmax?Co((()=>t.argMax(-1).mul(.5))):t,i="image"===this.segmentationOptions.output?new ImageData(await Xo(r),e,n):await r.array();return this.segmentationOptions.applyArgmax&&r.dispose(),i}if(gRt(this.taskType,"generic"))return t.array();throw new Error("Invalid output data type")}async loadFromFiles(t){this.$training.set({status:"loading"});try{const e=t.filter((t=>t.name.includes(".json"))),n=t.filter((t=>t.name.includes(".bin")));if(1!==e.length){const t=new Error("The provided files are not compatible with this model");throw t.name="File upload error",t}if(this.$training.set({status:"loading"}),t.length){const t=await SJ(e[0]);this.loadFn="graph-model"===t.format?P0:P5,this.model=await this.loadFn(W8([e[0],...n])),await this.warmup(),this.$training.set({status:"loaded",data:{source:"file"}})}}catch(t){throw this.$training.set({status:"error"}),t}}async loadFromUrl(t){this.$training.set({status:"loading"});try{const e=await fetch(t).then((t=>t.json()));this.loadFn="graph-model"===e.format?P0:P5,this.model=await this.loadFn(j8(t)),await this.warmup(),this.$training.set({status:"loaded",data:{source:"url",url:t}})}catch(t){throw console.log("[tf-model] Loading error",t),this.$training.set({status:"error"}),t}}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new fRt({target:e,props:{title:this.title,training:this.$training}}))}}function bRt(t){let e,n,r;function i(e){t[7](e)}let s={disabled:t[5],text:t[6]};return void 0!==t[4]&&(s.checked=t[4]),e=new j$({props:s}),uI.push((()=>BI(e,"checked",i))),{c(){UI(e.$$.fragment)},m(t,n){VI(e,t,n),r=!0},p(t,r){const i={};32&r&&(i.disabled=t[5]),64&r&&(i.text=t[6]),!n&&16&r&&(n=!0,i.checked=t[4],bI((()=>n=!1))),e.$set(i)},i(t){r||(NI(e.$$.fragment,t),r=!0)},o(t){II(e.$$.fragment,t),r=!1},d(t){jI(e,t)}}}function vRt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[bRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),368&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function xRt(t,e,n){let r,i,s,o=nN,a=()=>(o(),o=hN(f,(t=>n(4,r=t))),f),l=nN,c=()=>(l(),l=hN(m,(t=>n(5,i=t))),m),u=nN,h=()=>(u(),u=hN(p,(t=>n(6,s=t))),p);t.$$.on_destroy.push((()=>o())),t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>u()));let{title:d}=e,{text:p}=e;h();let{checked:f}=e;a();let{disabled:m}=e;return c(),t.$$set=t=>{"title"in t&&n(0,d=t.title),"text"in t&&h(n(1,p=t.text)),"checked"in t&&a(n(2,f=t.checked)),"disabled"in t&&c(n(3,m=t.disabled))},[d,p,f,m,r,i,s,function(t){r=t,f.set(r)}]}FH([rG],yRt.prototype,"train",null),FH([rG],yRt.prototype,"predict",null),FH([rG],yRt.prototype,"preprocess",null),FH([rG],yRt.prototype,"preprocessImage",null),FH([rG],yRt.prototype,"postprocess",null),FH([rG],yRt.prototype,"loadFromFiles",null),FH([rG],yRt.prototype,"loadFromUrl",null);class wRt extends HI{constructor(t){super(),WI(this,t,xRt,vRt,lN,{title:0,text:1,checked:2,disabled:3})}}class _Rt extends mG{constructor(t="toggle me"){super(),this.title="toggle",this.$checked=new JH(!1,!0),this.$disabled=new JH(!1,!0),this.$text=new JH(t,!0),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new wRt({target:e,props:{title:this.title,text:this.$text,checked:this.$checked,disabled:this.$disabled}}))}}function SRt(t){let e;return{c(){e=IN("div"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> \n    <p>Select one or several runs to display information</p>',FN(e,"class","empty svelte-yj1ygt")},m(t,n){CN(t,e,n)},p:nN,i:nN,o:nN,d(t){t&&AN(e)}}}function kRt(t){let e,n;return e=new _U({props:{columns:[{name:"field"},...t[2]],provider:t[1],selectable:!1}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.columns=[{name:"field"},...t[2]]),2&n&&(r.provider=t[1]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function TRt(t){let e,n,r,i;const s=[kRt,SRt],o=[];function a(t,e){return t[0].length>0?0:1}return e=a(t),n=o[e]=s[e](t),{c(){n.c(),r=PN()},m(t,n){o[e].m(t,n),CN(t,r,n),i=!0},p(t,[i]){let l=e;e=a(t),e===l?o[e].p(t,i):(CI(),II(o[l],1,1,(()=>{o[l]=null})),AI(),n=o[e],n?n.p(t,i):(n=o[e]=s[e](t),n.c()),NI(n,1),n.m(r.parentNode,r))},i(t){i||(NI(n),i=!0)},o(t){II(n),i=!1},d(t){o[e].d(t),t&&AN(r)}}}function ERt(t,e,n){let r,i,s,o,{runs:a}=e;return t.$$set=t=>{"runs"in t&&n(0,a=t.runs)},t.$$.update=()=>{1&t.$$.dirty&&n(2,r=a.map(((t,e)=>({name:`Run ${e+1}`})))),1&t.$$.dirty&&n(4,i=a.length>0?Object.keys(a[0]).filter((t=>"logs"!==t)):[]),17&t.$$.dirty&&n(3,s=i.map((t=>a.map(((e,n)=>({[`Run ${n+1}`]:e[t]}))).reduce(((t,e)=>({...t,...e})),{field:t})))),8&t.$$.dirty&&n(1,o=new CU({data:s}))},[a,o,r,s,i]}class MRt extends HI{constructor(t){super(),WI(this,t,ERt,TRt,lN,{runs:0})}}function CRt(t,e,n){const r=t.slice();return r[5]=e[n],r[6]=e,r[7]=n,r}function ARt(t){let e,n=t[7];const r=()=>t[3](e,n),i=()=>t[3](null,n);return{c(){e=IN("div"),FN(e,"class","card inner-card xl:flex-1 svelte-1o4ebpu")},m(t,n){CN(t,e,n),r()},p(e,s){n!==(t=e)[7]&&(i(),n=t[7],r())},d(t){t&&AN(e),i()}}}function NRt(t){let e,n=Object.values(t[0]),r=[];for(let e=0;e<n.length;e+=1)r[e]=ARt(CRt(t,n,e));return{c(){e=IN("div");for(let t=0;t<r.length;t+=1)r[t].c();FN(e,"class","grid grid-cols-1 gap-1")},m(n,i){CN(n,e,i);for(let t=0;t<r.length;t+=1)r[t].m(e,null);t[4](e)},p(t,[i]){if(5&i){let s;for(n=Object.values(t[0]),s=0;s<n.length;s+=1){const o=CRt(t,n,s);r[s]?r[s].p(o,i):(r[s]=ARt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},i:nN,o:nN,d(n){n&&AN(e),NN(r,n),t[4](null)}}}function IRt(t,e,n){let r,{charts:i}=e,s=[];return rI((async()=>{await gI(),await gI(),Object.keys(i).length>1&&r.clientWidth>700&&n(1,r.style.gridTemplateColumns="repeat(2, minmax(0, 1fr))",r);for(const[t,e]of Object.values(i).entries())e.mount(s[t])})),sI((()=>{for(const t of Object.values(i))t.destroy()})),t.$$set=t=>{"charts"in t&&n(0,i=t.charts)},[i,r,s,function(t,e){uI[t?"unshift":"push"]((()=>{s[e]=t,n(2,s)}))},function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class $Rt extends HI{constructor(t){super(),WI(this,t,IRt,NRt,lN,{charts:0})}}class RRt extends mG{constructor(t,e={loss:["loss","lossVal"],accuracy:["acc","accVal"]}){if(super(),this.model=t,this.title="training plot",this.charts={},!t){const t=new Error("[training plot] No model was provided");t.name="Component Compatibility Error",sG(t)}if(!t.$training){const t=new Error("[training plot] The provided model is incompatible with the training plot component, missing `$training` stream");t.name="Component Compatibility Error",sG(t)}let n=e;"string"==typeof e&&(n=[e]),Array.isArray(n)&&(n=n.reduce(((t,e)=>({...t,[e]:e})),{}));const r={};for(const[t,e]of Object.entries(n)){const n=Array.isArray(e)?e:[e];this.charts[t]=gut({preset:"line-fast",options:{xlabel:"Epoch",ylabel:t}});for(const e of n)Object.keys(r).includes(e)||(r[e]=new JH([],!0)),this.charts[t].addSeries(r[e],e);this.charts[t].title=t}t.$training.subscribe((t=>{if("start"===t.status)!function(){for(const t of Object.values(r))t.set([])}();else if(t.data)for(const[e,n]of Object.entries(t.data)){if(!Object.keys(r).includes(e))return;Array.isArray(n)?r[e].set(n.map(((t,e)=>({x:e+1,y:t})))):r[e].set(r[e].get().concat([{x:r[e].get().length+1,y:n}]))}})),this.start()}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new $Rt({target:e,props:{charts:this.charts}}))}}function ORt(...t){return new RRt(...t)}function PRt(t){let e;return{c(){e=IN("div"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg> \n    <p>Select one or several runs to display information</p>',FN(e,"class","empty svelte-yj1ygt")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function LRt(t){let e;return{c(){e=IN("div")},m(n,r){CN(n,e,r),t[7](e)},p:nN,d(n){n&&AN(e),t[7](null)}}}function DRt(t){let e;function n(t,e){return t[0].length>0?LRt:PRt}let r=n(t),i=r(t);return{c(){i.c(),e=PN()},m(t,n){i.m(t,n),CN(t,e,n)},p(t,[s]){r===(r=n(t))&&i?i.p(t,s):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},i:nN,o:nN,d(t){i.d(t),t&&AN(e)}}}function FRt(t,e,n){let r,i,s,o,a,{names:l}=e,{logs:c}=e;return sI((()=>{a&&a.destroy()})),t.$$set=t=>{"names"in t&&n(2,l=t.names),"logs"in t&&n(0,c=t.logs)},t.$$.update=()=>{9&t.$$.dirty&&(n(3,o=Array.from(new Set(c.map(Object.keys).flat()))),o.sort()),5&t.$$.dirty&&n(6,r=c.map(((t,e)=>Object.entries(t).reduce(((t,[n,r])=>({...t,[`${n} (${l[e]})`]:r})),{}))).reduce(((t,e)=>({...t,...e})),{})),72&t.$$.dirty&&n(5,i=o.reduce(((t,e)=>({...t,[e]:Object.keys(r).filter((t=>t.startsWith(`${e} (`)))})),{})),114&t.$$.dirty&&(a&&a.destroy(),n(4,a=ORt({$training:new JH({status:"success",data:r},!0)},i)),a.mount(s))},[c,s,l,o,a,i,r,function(t){uI[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}class zRt extends HI{constructor(t){super(),WI(this,t,FRt,DRt,lN,{names:2,logs:0})}}function BRt(t,e,n){const r=t.slice();return r[13]=e[n],r[15]=n,r}function URt(t){let e;return{c(){e=RN("Graphs")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function VRt(t){let e;return{c(){e=RN("Metadata")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function jRt(t){let e;return{c(){e=RN("Parameters")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function WRt(t){let e;return{c(){e=RN("Model Summary")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function HRt(t){let e,n,r,i,s,o,a,l;return e=new J$({props:{$$slots:{default:[URt]},$$scope:{ctx:t}}}),r=new J$({props:{$$slots:{default:[VRt]},$$scope:{ctx:t}}}),s=new J$({props:{$$slots:{default:[jRt]},$$scope:{ctx:t}}}),a=new J$({props:{$$slots:{default:[WRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment),n=ON(),UI(r.$$.fragment),i=ON(),UI(s.$$.fragment),o=ON(),UI(a.$$.fragment)},m(t,c){VI(e,t,c),CN(t,n,c),VI(r,t,c),CN(t,i,c),VI(s,t,c),CN(t,o,c),VI(a,t,c),l=!0},p(t,n){const i={};65536&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const o={};65536&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const l={};65536&n&&(l.$$scope={dirty:n,ctx:t}),s.$set(l);const c={};65536&n&&(c.$$scope={dirty:n,ctx:t}),a.$set(c)},i(t){l||(NI(e.$$.fragment,t),NI(r.$$.fragment,t),NI(s.$$.fragment,t),NI(a.$$.fragment,t),l=!0)},o(t){II(e.$$.fragment,t),II(r.$$.fragment,t),II(s.$$.fragment,t),II(a.$$.fragment,t),l=!1},d(t){jI(e,t),t&&AN(n),jI(r,t),t&&AN(i),jI(s,t),t&&AN(o),jI(a,t)}}}function GRt(t){let e,n;return e=new zRt({props:{logs:t[4].map(eOt),names:t[4].map(nOt)}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.logs=t[4].map(eOt)),16&n&&(r.names=t[4].map(nOt)),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function qRt(t){let e,n;return e=new MRt({props:{runs:t[4]}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.runs=t[4]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function XRt(t){let e,n;return e=new MRt({props:{runs:t[4].map(rOt)}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};16&n&&(r.runs=t[4].map(rOt)),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function YRt(t){let e,n,r,i,s,o,a,l,c,u,h=t[15]+1+"",d=t[13]+"";return{c(){e=IN("div"),n=IN("h2"),r=RN("Model "),i=RN(h),s=ON(),o=IN("div"),a=IN("pre"),l=RN(d),c=IN("br"),u=ON(),FN(o,"class","summary svelte-y4izzs")},m(t,h){CN(t,e,h),TN(e,n),TN(n,r),TN(n,i),TN(e,s),TN(e,o),TN(o,a),TN(a,l),TN(a,c),TN(e,u)},p(t,e){16&e&&d!==(d=t[13]+"")&&BN(l,d)},d(t){t&&AN(e)}}}function KRt(t){let e,n=t[4].map(iOt),r=[];for(let e=0;e<n.length;e+=1)r[e]=YRt(BRt(t,n,e));return{c(){e=IN("div");for(let t=0;t<r.length;t+=1)r[t].c();FN(e,"class","summaries svelte-y4izzs")},m(t,n){CN(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,i){if(16&i){let s;for(n=t[4].map(iOt),s=0;s<n.length;s+=1){const o=BRt(t,n,s);r[s]?r[s].p(o,i):(r[s]=YRt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&AN(e),NN(r,t)}}}function ZRt(t){let e,n,r,i,s,o,a,l,c,u;return e=new TU({props:{$$slots:{default:[HRt]},$$scope:{ctx:t}}}),r=new nR({props:{$$slots:{default:[GRt]},$$scope:{ctx:t}}}),s=new nR({props:{$$slots:{default:[qRt]},$$scope:{ctx:t}}}),a=new nR({props:{$$slots:{default:[XRt]},$$scope:{ctx:t}}}),c=new nR({props:{$$slots:{default:[KRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment),n=ON(),UI(r.$$.fragment),i=ON(),UI(s.$$.fragment),o=ON(),UI(a.$$.fragment),l=ON(),UI(c.$$.fragment)},m(t,h){VI(e,t,h),CN(t,n,h),VI(r,t,h),CN(t,i,h),VI(s,t,h),CN(t,o,h),VI(a,t,h),CN(t,l,h),VI(c,t,h),u=!0},p(t,n){const i={};65536&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const o={};65552&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const l={};65552&n&&(l.$$scope={dirty:n,ctx:t}),s.$set(l);const u={};65552&n&&(u.$$scope={dirty:n,ctx:t}),a.$set(u);const h={};65552&n&&(h.$$scope={dirty:n,ctx:t}),c.$set(h)},i(t){u||(NI(e.$$.fragment,t),NI(r.$$.fragment,t),NI(s.$$.fragment,t),NI(a.$$.fragment,t),NI(c.$$.fragment,t),u=!0)},o(t){II(e.$$.fragment,t),II(r.$$.fragment,t),II(s.$$.fragment,t),II(a.$$.fragment,t),II(c.$$.fragment,t),u=!1},d(t){jI(e,t),t&&AN(n),jI(r,t),t&&AN(i),jI(s,t),t&&AN(o),jI(a,t),t&&AN(l),jI(c,t)}}}function JRt(t){let e,n,r,i,s,o,a;function l(e){t[10](e)}let c={columns:t[7],provider:t[6],actions:[...t[1].map(tOt),{name:"delete",confirm:!0}]};return void 0!==t[4]&&(c.selection=t[4]),e=new _U({props:c}),uI.push((()=>BI(e,"selection",l))),t[11](e),e.$on("select",t[12]),o=new Y$({props:{$$slots:{default:[ZRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment),r=ON(),i=IN("br"),s=ON(),UI(o.$$.fragment)},m(t,n){VI(e,t,n),CN(t,r,n),CN(t,i,n),CN(t,s,n),VI(o,t,n),a=!0},p(t,r){const i={};2&r&&(i.actions=[...t[1].map(tOt),{name:"delete",confirm:!0}]),!n&&16&r&&(n=!0,i.selection=t[4],bI((()=>n=!1))),e.$set(i);const s={};65552&r&&(s.$$scope={dirty:r,ctx:t}),o.$set(s)},i(t){a||(NI(e.$$.fragment,t),NI(o.$$.fragment,t),a=!0)},o(t){II(e.$$.fragment,t),II(o.$$.fragment,t),a=!1},d(n){t[11](null),jI(e,n),n&&AN(r),n&&AN(i),n&&AN(s),jI(o,n)}}}function QRt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[JRt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),65562&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}const tOt=t=>"string"==typeof t?{name:t}:t,eOt=t=>t.logs,nOt=t=>t.name,rOt=t=>t.params,iOt=t=>t.model?.summary||"No summary available";function sOt(t,e,n){let r,i=nN,s=()=>(i(),i=hN(u,(t=>n(4,r=t))),u);t.$$.on_destroy.push((()=>i()));let{title:o}=e,{service:a}=e,{metrics:l}=e,{actions:c}=e,{selection:u}=e;s();const h=oI(),d=new AU({service:a,transform:{...l.reduce(((t,e)=>({...t,[e]:t=>e in t.logs?t.logs[e][t.logs[e].length-1]:"metrics not found"})),{}),...c.reduce(((t,e)=>({...t,["string"==typeof e?e:e.name]:()=>"string"==typeof e?e:e.name})),{})}});d.data.subscribe((()=>{u.set([])}));const p=[{name:"name",sortable:!0},{name:"start",sortable:!0,type:"date"},...l.map((t=>({name:t}))),{name:"epochs"},{name:"status"},...c.map((t=>({name:"string"==typeof t?t:t.name,type:"action"})))];let f;rI((async()=>{await gI(),await gI();for(const t of c){const e="string"==typeof t?t:t.name;f.$on(e,(({detail:t})=>{h(e,t)}))}}));return t.$$set=t=>{"title"in t&&n(0,o=t.title),"service"in t&&n(8,a=t.service),"metrics"in t&&n(9,l=t.metrics),"actions"in t&&n(1,c=t.actions),"selection"in t&&s(n(2,u=t.selection))},[o,c,u,f,r,h,d,p,a,l,function(t){r=t,u.set(r)},function(t){uI[t?"unshift":"push"]((()=>{f=t,n(3,f)}))},({detail:t})=>h("load",t)]}class oOt extends HI{constructor(t){super(),WI(this,t,sOt,QRt,lN,{title:0,service:8,metrics:9,actions:1,selection:2})}}function aOt(t,e){const n={...t};for(const[t,r]of Object.entries(e))n[t]=(n[t]||[]).concat([r]);return n}const lOt={metrics:["accuracy","accuracyVal","loss","lossVal"],actions:[]};class cOt extends mG{constructor(t,e={}){super(),this.dataStore=t,this.title="Training History",this.$selection=new JH([],!0),this.$actions=new JH(null).skip(1),this.ready=Promise.resolve(),this.stopTracking=XH,this.lock=Promise.resolve(),this.options={...lOt,...e},this.lock=this.lock.then(XH),this.start(),this.ready=this.ready.then((()=>this.dataStore.connect())).then((()=>{this.runService=this.dataStore.service("runs")})).catch((()=>{eG.log("[dataset] dataStore connection failed")}))}track(t,e="anonymous"){return this.ready.then((()=>(this.stopTracking(),this.model=t,this.modelName=e,this.runService.find({query:{basename:e,$sort:{createdAt:-1},$select:["name"],$limit:1}})))).then((({data:t})=>t.length>0?parseInt(t[0].name.split(`${e}-`)[1])+1:1)).then((t=>{this.nextIndex=t,this.crtRun=null,this.stopTracking=this.model?this.model.$training.subscribe(this.trackTrainingStream):XH})),this}async trackTrainingStream(t){if("start"===t.status)this.crtRun=await this.runService.create({name:`${this.modelName}-${this.nextIndex++}`,basename:this.modelName,start:new Date(Date.now()).toISOString(),source:"js",status:t.status,epochs:t.epochs,params:Object.entries(this.model.parameters).map((([t,e])=>({[t]:e.get()}))).reduce(((t,e)=>({...t,...e})),{}),logs:{}});else if("epoch"===t.status)this.runService.patch(this.crtRun.id,{status:t.status,epoch:t.epoch,logs:aOt(this.crtRun.logs,t.data)});else if("success"===t.status){const e=await this.model.save(this.dataStore,this.modelName,{});this.runService.patch(this.crtRun.id,{status:t.status,epoch:t.epoch,logs:t.data,checkpoints:(this.crtRun.checkpoints||[]).concat([{id:e,name:`${this.crtRun.name}@final`,service:this.model.serviceName}])})}else"error"===t.status&&this.runService.patch(this.crtRun.id,{status:t.status})}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.ready.then((()=>{this.$$.app=new oOt({target:e,props:{title:this.title,service:this.runService,metrics:this.options.metrics,actions:this.options.actions,selection:this.$selection}});for(const t of this.options.actions){const e="string"==typeof t?t:t.name;this.$$.app.$on(e,(({detail:t})=>{this.$actions.set({name:e,data:t})}))}})))}}var uOt;FH([(uOt="lock",function(t,e,n){const r=n.value;return n.value=function(...t){const e=this[uOt].then((()=>r.apply(this,t)));return this[uOt]=e,e},n})],cOt.prototype,"trackTrainingStream",null);var hOt={},dOt={},pOt={},fOt={},mOt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}};function gOt(t,e){return Math.floor(e()*t)}function yOt(t){for(var e=[],n=0;n<t;n++)e.push(void 0);return e}function bOt(t,e){return yOt(t).map((function(){return e}))}function vOt(t){return bOt(t,0)}function xOt(t){return t.reduce((function(t,e){return t+e}))}Object.defineProperty(fOt,"__esModule",{value:!0}),fOt.tauRandInt=gOt,fOt.tauRand=function(t){return t()},fOt.norm=function(t){var e,n,r=0;try{for(var i=mOt(t),s=i.next();!s.done;s=i.next()){var o=s.value;r+=Math.pow(o,2)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return Math.sqrt(r)},fOt.empty=yOt,fOt.range=function(t){return yOt(t).map((function(t,e){return e}))},fOt.filled=bOt,fOt.zeros=vOt,fOt.ones=function(t){return bOt(t,1)},fOt.linear=function(t,e,n){return yOt(n).map((function(r,i){return t+i*((e-t)/(n-1))}))},fOt.sum=xOt,fOt.mean=function(t){return xOt(t)/t.length},fOt.max=function(t){for(var e=0,n=0;n<t.length;n++)e=t[n]>e?t[n]:e;return e},fOt.max2d=function(t){for(var e=0,n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)e=t[n][r]>e?t[n][r]:e;return e},fOt.rejectionSample=function(t,e,n){for(var r=vOt(t),i=0;i<t;i++)for(var s=!0;s;){for(var o=gOt(e,n),a=!1,l=0;l<i;l++)if(o===r[l]){a=!0;break}a||(s=!1),r[i]=o}return r},fOt.reshape2d=function(t,e,n){var r=[],i=0;if(t.length!==e*n)throw new Error("Array dimensions must match input length.");for(var s=0;s<e;s++){for(var o=[],a=0;a<n;a++)o.push(t[i]),i+=1;r.push(o)}return r};var wOt=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(pOt,"__esModule",{value:!0});var _Ot=wOt(fOt);function SOt(t,e){var n=function(n){return _Ot.empty(t).map((function(){return _Ot.filled(e,n)}))},r=[];return r.push(n(-1)),r.push(n(1/0)),r.push(n(0)),r}function kOt(t,e,n,r,i){e=Math.floor(e);var s=t[0][e],o=t[1][e];if(t[2][e],n>=o[0])return 0;for(var a=0;a<s.length;a++)if(r===s[a])return 0;return TOt(t,e,n,r,i)}function TOt(t,e,n,r,i){var s=t[0][e],o=t[1][e],a=t[2][e];if(n>=o[0])return 0;o[0]=n,s[0]=r,a[0]=i;for(var l=0,c=0;;){var u=2*l+1,h=u+1,d=t[0][0].length;if(u>=d)break;if(h>=d){if(!(o[u]>n))break;c=u}else if(o[u]>=o[h]){if(!(n<o[u]))break;c=u}else{if(!(n<o[h]))break;c=h}o[l]=o[c],s[l]=s[c],a[l]=a[c],l=c}return o[l]=n,s[l]=r,a[l]=i,1}function EOt(t,e,n,r){for(;2*r+1<n;){var i=2*r+1,s=i+1,o=r;if(t[o]<t[i]&&(o=i),s<n&&t[o]<t[s]&&(o=s),o===r)break;var a=t[r];t[r]=t[o],t[o]=a;var l=e[r];e[r]=e[o],e[o]=l,r=o}}pOt.makeHeap=SOt,pOt.rejectionSample=function(t,e,n){for(var r=_Ot.zeros(t),i=0;i<t;i++){for(var s=!0,o=0;s;){o=_Ot.tauRandInt(e,n);for(var a=!1,l=0;l<i;l++)if(o===r[l]){a=!0;break}a||(s=!1)}r[i]=o}return r},pOt.heapPush=kOt,pOt.uncheckedHeapPush=TOt,pOt.buildCandidates=function(t,e,n,r,i){for(var s=SOt(e,r),o=0;o<e;o++)for(var a=0;a<n;a++)if(!(t[0][o][a]<0)){var l=t[0][o][a],c=t[2][o][a],u=_Ot.tauRand(i);kOt(s,o,u,l,c),kOt(s,l,u,o,c),t[2][o][a]=0}return s},pOt.deheapSort=function(t){for(var e=t[0],n=t[1],r=0;r<e.length;r++)for(var i=e[r],s=n[r],o=0;o<i.length-1;o++){var a=i.length-o-1,l=s.length-o-1,c=i[0];i[0]=i[a],i[a]=c;var u=s[0];s[0]=s[l],s[l]=u,EOt(s,i,l,0)}return{indices:e,weights:n}},pOt.smallestFlagged=function(t,e){for(var n=t[0][e],r=t[1][e],i=t[2][e],s=1/0,o=-1,a=0;a>n.length;a++)1===i[a]&&r[a]<s&&(s=r[a],o=a);return o>=0?(i[o]=0,Math.floor(n[o])):-1};var MOt,COt={},AOt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},NOt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},IOt=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(COt,"__esModule",{value:!0});var $Ot=IOt(fOt),ROt=function(){function t(t,e,n,r){if(this.entries=new Map,this.nRows=0,this.nCols=0,t.length!==e.length||t.length!==n.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=r[0],this.nCols=r[1];for(var i=0;i<n.length;i++){var s=t[i],o=e[i];this.checkDims(s,o);var a=this.makeKey(s,o);this.entries.set(a,{value:n[i],row:s,col:o})}}return t.prototype.makeKey=function(t,e){return t+":"+e},t.prototype.checkDims=function(t,e){if(!(t<this.nRows&&e<this.nCols))throw new Error("row and/or col specified outside of matrix dimensions")},t.prototype.set=function(t,e,n){this.checkDims(t,e);var r=this.makeKey(t,e);this.entries.has(r)?this.entries.get(r).value=n:this.entries.set(r,{value:n,row:t,col:e})},t.prototype.get=function(t,e,n){void 0===n&&(n=0),this.checkDims(t,e);var r=this.makeKey(t,e);return this.entries.has(r)?this.entries.get(r).value:n},t.prototype.getAll=function(t){void 0===t&&(t=!0);var e=[];return this.entries.forEach((function(t){e.push(t)})),t&&e.sort((function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row})),e},t.prototype.getDims=function(){return[this.nRows,this.nCols]},t.prototype.getRows=function(){return Array.from(this.entries,(function(t){var e=AOt(t,2);return e[0],e[1].row}))},t.prototype.getCols=function(){return Array.from(this.entries,(function(t){var e=AOt(t,2);return e[0],e[1].col}))},t.prototype.getValues=function(){return Array.from(this.entries,(function(t){var e=AOt(t,2);return e[0],e[1].value}))},t.prototype.forEach=function(t){this.entries.forEach((function(e){return t(e.value,e.row,e.col)}))},t.prototype.map=function(e){var n=[];this.entries.forEach((function(t){n.push(e(t.value,t.row,t.col))}));var r=[this.nRows,this.nCols];return new t(this.getRows(),this.getCols(),n,r)},t.prototype.toArray=function(){var t=this,e=$Ot.empty(this.nRows).map((function(){return $Ot.zeros(t.nCols)}));return this.entries.forEach((function(t){e[t.row][t.col]=t.value})),e},t}();COt.SparseMatrix=ROt,COt.transpose=function(t){var e=[],n=[],r=[];t.forEach((function(t,i,s){e.push(i),n.push(s),r.push(t)}));var i=[t.nCols,t.nRows];return new ROt(n,e,r,i)},COt.identity=function(t){for(var e=AOt(t,1)[0],n=new ROt([],[],[],t),r=0;r<e;r++)n.set(r,r,1);return n},COt.pairwiseMultiply=function(t,e){return POt(t,e,(function(t,e){return t*e}))},COt.add=function(t,e){return POt(t,e,(function(t,e){return t+e}))},COt.subtract=function(t,e){return POt(t,e,(function(t,e){return t-e}))},COt.maximum=function(t,e){return POt(t,e,(function(t,e){return t>e?t:e}))},COt.multiplyScalar=function(t,e){return t.map((function(t){return t*e}))},COt.eliminateZeros=function(t){for(var e=new Set,n=t.getValues(),r=t.getRows(),i=t.getCols(),s=0;s<n.length;s++)0===n[s]&&e.add(s);var o=function(t,n){return!e.has(n)},a=n.filter(o),l=r.filter(o),c=i.filter(o);return new ROt(l,c,a,t.getDims())},COt.normalize=function(t,e){var n,r;void 0===e&&(e="l2");var i=OOt[e],s=new Map;t.forEach((function(t,e,n){var r=s.get(e)||[];r.push(n),s.set(e,r)}));var o=new ROt([],[],[],t.getDims()),a=function(e){for(var n=s.get(e).sort(),r=n.map((function(n){return t.get(e,n)})),a=i(r),l=0;l<a.length;l++)o.set(e,n[l],a[l])};try{for(var l=NOt(s.keys()),c=l.next();!c.done;c=l.next()){a(c.value)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return o};var OOt=((MOt={}).max=function(t){for(var e=-1/0,n=0;n<t.length;n++)e=t[n]>e?t[n]:e;return t.map((function(t){return t/e}))},MOt.l1=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return t.map((function(t){return t/e}))},MOt.l2=function(t){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n],2);return t.map((function(t){return Math.sqrt(Math.pow(t,2)/e)}))},MOt);function POt(t,e,n){for(var r=new Set,i=[],s=[],o=[],a=function(r,a){i.push(r),s.push(a);var l=n(t.get(r,a),e.get(r,a));o.push(l)},l=t.getValues(),c=t.getRows(),u=t.getCols(),h=0;h<l.length;h++){var d=(g=c[h])+":"+(y=u[h]);r.add(d),a(g,y)}var p=e.getValues(),f=e.getRows(),m=e.getCols();for(h=0;h<p.length;h++){var g,y;d=(g=f[h])+":"+(y=m[h]);r.has(d)||a(g,y)}var b=[t.nRows,t.nCols];return new ROt(i,s,o,b)}COt.getCSR=function(t){var e=[];t.forEach((function(t,n,r){e.push({value:t,row:n,col:r})})),e.sort((function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row}));for(var n=[],r=[],i=[],s=-1,o=0;o<e.length;o++){var a=e[o],l=a.row,c=a.col,u=a.value;l!==s&&(s=l,i.push(o)),n.push(c),r.push(u)}return{indices:n,values:r,indptr:i}};var LOt={},DOt={},FOt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},zOt=vr&&vr.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(FOt(arguments[e]));return t},BOt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},UOt=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(DOt,"__esModule",{value:!0});var VOt=UOt(fOt),jOt=function(t,e,n,r){this.hyperplanes=t,this.offsets=e,this.children=n,this.indices=r};function WOt(t,e,n,r,i){if(void 0===n&&(n=30),e.length>n){var s=function(t,e,n){var r=t[0].length,i=VOt.tauRandInt(e.length,n),s=VOt.tauRandInt(e.length,n);s=(s+=i===s?1:0)%e.length;for(var o=e[i],a=e[s],l=0,c=VOt.zeros(r),u=0;u<c.length;u++)c[u]=t[o][u]-t[a][u],l-=c[u]*(t[o][u]+t[a][u])/2;var h=0,d=0,p=VOt.zeros(e.length);for(u=0;u<e.length;u++){for(var f=l,m=0;m<r;m++)f+=c[m]*t[e[u]][m];0===f?(p[u]=VOt.tauRandInt(2,n),0===p[u]?h+=1:d+=1):f>0?(p[u]=0,h+=1):(p[u]=1,d+=1)}var g=VOt.zeros(h),y=VOt.zeros(d);h=0,d=0;for(u=0;u<p.length;u++)0===p[u]?(g[h]=e[u],h+=1):(y[d]=e[u],d+=1);return{indicesLeft:g,indicesRight:y,hyperplane:c,offset:l}}(t,e,i),o=s.indicesLeft,a=s.indicesRight,l=s.hyperplane,c=s.offset;return{leftChild:WOt(t,o,n,r+1,i),rightChild:WOt(t,a,n,r+1,i),isLeaf:!1,hyperplane:l,offset:c}}return{indices:e,isLeaf:!0}}function HOt(t,e,n,r,i,s,o){var a;if(t.isLeaf)return r[s][0]=-o,(a=i[o]).splice.apply(a,zOt([0,t.indices.length],t.indices)),{nodeNum:s,leafNum:o+=1};e[s]=t.hyperplane,n[s]=t.offset,r[s][0]=s+1;var l=s,c=HOt(t.leftChild,e,n,r,i,s+1,o);return s=c.nodeNum,o=c.leafNum,r[l][1]=s+1,{nodeNum:(c=HOt(t.rightChild,e,n,r,i,s+1,o)).nodeNum,leafNum:c.leafNum}}function GOt(t){return t.isLeaf?1:1+GOt(t.leftChild)+GOt(t.rightChild)}function qOt(t){return t.isLeaf?1:qOt(t.leftChild)+qOt(t.rightChild)}function XOt(t,e,n,r){for(var i=e,s=0;s<n.length;s++)i+=t[s]*n[s];return 0===i?VOt.tauRandInt(2,r):i>0?0:1}DOt.FlatTree=jOt,DOt.makeForest=function(t,e,n,r){var i=Math.max(10,e),s=VOt.range(n).map((function(e,n){return function(t,e,n,r){void 0===e&&(e=30);var i=VOt.range(t.length);return WOt(t,i,e,n,r)}(t,i,n,r)})),o=s.map((function(t){return function(t,e){var n=GOt(t),r=qOt(t),i=VOt.range(n).map((function(){return VOt.zeros(t.hyperplane?t.hyperplane.length:0)})),s=VOt.zeros(n),o=VOt.range(n).map((function(){return[-1,-1]})),a=VOt.range(r).map((function(){return VOt.range(e).map((function(){return-1}))}));return HOt(t,i,s,o,a,0,0),new jOt(i,s,o,a)}(t,i)}));return o},DOt.makeLeafArray=function(t){var e,n;if(t.length>0){var r=[];try{for(var i=BOt(t),s=i.next();!s.done;s=i.next()){var o=s.value;r.push.apply(r,zOt(o.indices))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return[[-1]]},DOt.searchFlatTree=function(t,e,n){for(var r=0;e.children[r][0]>0;){r=0===XOt(e.hyperplanes[r],e.offsets[r],t,n)?e.children[r][0]:e.children[r][1]}var i=-1*e.children[r][0];return e.indices[i]};var YOt=vr&&vr.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},KOt=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(LOt,"__esModule",{value:!0});var ZOt=KOt(pOt),JOt=KOt(COt),QOt=KOt(DOt),tPt=KOt(fOt);LOt.makeNNDescent=function(t,e){return function(n,r,i,s,o,a,l,c){void 0===s&&(s=10),void 0===o&&(o=50),void 0===a&&(a=.001),void 0===l&&(l=.5),void 0===c&&(c=!0);for(var u=n.length,h=ZOt.makeHeap(n.length,i),d=0;d<n.length;d++)for(var p=ZOt.rejectionSample(i,n.length,e),f=0;f<p.length;f++){var m=t(n[d],n[p[f]]);ZOt.heapPush(h,d,m,p[f],1),ZOt.heapPush(h,p[f],m,d,1)}if(c)for(var g=0;g<r.length;g++)for(d=0;d<r[g].length&&!(r[g][d]<0);d++)for(f=d+1;f<r[g].length&&!(r[g][f]<0);f++){m=t(n[r[g][d]],n[r[g][f]]);ZOt.heapPush(h,r[g][d],m,r[g][f],1),ZOt.heapPush(h,r[g][f],m,r[g][d],1)}for(g=0;g<s;g++){var y=ZOt.buildCandidates(h,u,i,o,e),b=0;for(d=0;d<u;d++)for(f=0;f<o;f++){var v=Math.floor(y[0][d][f]);if(!(v<0||tPt.tauRand(e)<l))for(var x=0;x<o;x++){var w=Math.floor(y[0][d][x]),_=y[2][d][f],S=y[2][d][x];if(!(w<0||!_&&!S)){m=t(n[v],n[w]);b+=ZOt.heapPush(h,v,m,w,1),b+=ZOt.heapPush(h,w,m,v,1)}}}if(b<=a*i*n.length)break}return ZOt.deheapSort(h)}},LOt.makeInitializations=function(t){return{initFromRandom:function(e,n,r,i,s){for(var o=0;o<r.length;o++)for(var a=tPt.rejectionSample(e,n.length,s),l=0;l<a.length;l++)if(!(a[l]<0)){var c=t(n[a[l]],r[o]);ZOt.heapPush(i,o,c,a[l],1)}},initFromTree:function(e,n,r,i,s){for(var o=0;o<r.length;o++)for(var a=QOt.searchFlatTree(r[o],e,s),l=0;l<a.length;l++){if(a[l]<0)return;var c=t(n[a[l]],r[o]);ZOt.heapPush(i,o,c,a[l],1)}}}},LOt.makeInitializedNNSearch=function(t){return function(e,n,r,i){for(var s,o,a=JOt.getCSR(n),l=a.indices,c=a.indptr,u=0;u<i.length;u++)for(var h=new Set(r[0][u]);;){var d=ZOt.smallestFlagged(r,u);if(-1===d)break;var p=l.slice(c[d],c[d+1]);try{for(var f=YOt(p),m=f.next();!m.done;m=f.next()){var g=m.value;if(g!==d&&-1!==g&&!h.has(g)){var y=t(e[g],i[u]);ZOt.uncheckedHeapPush(r,u,y,g,1),h.add(g)}}}catch(t){s={error:t}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(s)throw s.error}}}return r}},LOt.initializeSearch=function(t,e,n,r,i,s,o){var a,l,c=ZOt.makeHeap(n.length,r);if(i(r,e,n,c,o),t)try{for(var u=YOt(t),h=u.next();!h.done;h=u.next()){s(h.value,e,n,c,o)}}catch(t){a={error:t}}finally{try{h&&!h.done&&(l=u.return)&&l.call(u)}finally{if(a)throw a.error}}return c};const ePt=Object.prototype.toString;function nPt(t){return ePt.call(t).endsWith("Array]")}function rPt(t,e,n){let r=0;const i=n(e);for(let e=0;e<t.x.length;e++)r+=Math.abs(t.y[e]-i(t.x[e]));return r}function iPt(t,e,n,r,i){let s=n*r*r,o=oft.eye(e.length,e.length,s);const a=i(e);let l=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)l[e]=a(t.x[e]);let c=function(t,e,n,r,i){const s=n.length,o=t.x.length;let a=new Array(s);for(let l=0;l<s;l++){a[l]=new Array(o);let s=n.slice();s[l]+=r;let c=i(s);for(let n=0;n<o;n++)a[l][n]=e[n]-c(t.x[n])}return new oft(a)}(t,l,e,r,i),u=function(t,e){const n=t.x.length;let r=new Array(n);for(let i=0;i<n;i++)r[i]=[t.y[i]-e[i]];return new oft(r)}(t,l),h=fft(o.add(c.mmul(c.transpose())));return(e=(e=new oft([e])).sub(h.mmul(c).mmul(u).mul(r).transpose())).to1DArray()}var sPt=Object.freeze({__proto__:null,default:function(t,e,n={}){let{maxIterations:r=100,gradientDifference:i=.1,damping:s=0,errorTolerance:o=.01,minValues:a,maxValues:l,initialValues:c}=n;if(s<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!nPt(t.x)||t.x.length<2||!nPt(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");let u=c||new Array(e.length).fill(1),h=u.length;if(l=l||new Array(h).fill(Number.MAX_SAFE_INTEGER),a=a||new Array(h).fill(Number.MIN_SAFE_INTEGER),l.length!==a.length)throw new Error("minValues and maxValues must be the same size");if(!nPt(u))throw new Error("initialValues must be an array");let d,p=rPt(t,u,e),f=p<=o;for(d=0;d<r&&!f;d++){u=iPt(t,u,s,i,e);for(let t=0;t<h;t++)u[t]=Math.min(Math.max(a[t],u[t]),l[t]);if(p=rPt(t,u,e),isNaN(p))break;f=p<=o}return{parameterValues:u,parameterError:p,iterations:d}}}),oPt=wr(sPt),aPt=vr&&vr.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},lPt=vr&&vr.__generator||function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},cPt=vr&&vr.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},uPt=vr&&vr.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(cPt(arguments[e]));return t},hPt=vr&&vr.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},dPt=vr&&vr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(dOt,"__esModule",{value:!0});var pPt=hPt(pOt),fPt=hPt(COt),mPt=hPt(LOt),gPt=hPt(DOt),yPt=hPt(fOt),bPt=dPt(oPt),vPt=1e-5,xPt=.001,wPt=function(){function t(t){void 0===t&&(t={});var e=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=_Pt,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new SPt;var n=function(n){void 0!==t[n]&&(e[n]=t[n])};n("distanceFn"),n("learningRate"),n("localConnectivity"),n("minDist"),n("nComponents"),n("nEpochs"),n("nNeighbors"),n("negativeSampleRate"),n("random"),n("repulsionStrength"),n("setOpMixRatio"),n("spread"),n("transformQueueSize")}return t.prototype.fit=function(t){return this.initializeFit(t),this.optimizeLayout(),this.embedding},t.prototype.fitAsync=function(t,e){return void 0===e&&(e=function(){return!0}),aPt(this,void 0,void 0,(function(){return lPt(this,(function(n){switch(n.label){case 0:return this.initializeFit(t),[4,this.optimizeLayoutAsync(e)];case 1:return n.sent(),[2,this.embedding]}}))}))},t.prototype.setSupervisedProjection=function(t,e){void 0===e&&(e={}),this.Y=t,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},t.prototype.setPrecomputedKNN=function(t,e){this.knnIndices=t,this.knnDistances=e},t.prototype.initializeFit=function(t){if(t.length<=this.nNeighbors)throw new Error("Not enough data points ("+t.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===t&&this.isInitialized)return this.getNEpochs();if(this.X=t,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(t);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(t,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(t),this.processGraphForSupervisedProjection();var n=this.initializeSimplicialSetEmbedding(),r=n.head,i=n.tail,s=n.epochsPerSample;return this.optimizationState.head=r,this.optimizationState.tail=i,this.optimizationState.epochsPerSample=s,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},t.prototype.makeSearchFns=function(){var t=mPt.makeInitializations(this.distanceFn),e=t.initFromTree,n=t.initFromRandom;this.initFromTree=e,this.initFromRandom=n,this.search=mPt.makeInitializedNNSearch(this.distanceFn)},t.prototype.makeSearchGraph=function(t){for(var e=this.knnIndices,n=this.knnDistances,r=[t.length,t.length],i=new fPt.SparseMatrix([],[],[],r),s=0;s<e.length;s++)for(var o=e[s],a=n[s],l=0;l<o.length;l++){var c=o[l],u=a[l];u>0&&i.set(s,c,u)}var h=fPt.transpose(i);return fPt.maximum(i,h)},t.prototype.transform=function(t){var e=this,n=this.X;if(void 0===n||0===n.length)throw new Error("No data has been fit.");var r=Math.floor(this.nNeighbors*this.transformQueueSize);r=Math.min(n.length,r);var i=mPt.initializeSearch(this.rpForest,n,t,r,this.initFromRandom,this.initFromTree,this.random),s=this.search(n,this.searchGraph,i,t),o=pPt.deheapSort(s),a=o.indices,l=o.weights;a=a.map((function(t){return t.slice(0,e.nNeighbors)})),l=l.map((function(t){return t.slice(0,e.nNeighbors)}));var c=Math.max(0,this.localConnectivity-1),u=this.smoothKNNDistance(l,this.nNeighbors,c),h=u.sigmas,d=u.rhos,p=this.computeMembershipStrengths(a,l,h,d),f=p.rows,m=p.cols,g=p.vals,y=[t.length,n.length],b=new fPt.SparseMatrix(f,m,g,y),v=fPt.normalize(b,"l1"),x=fPt.getCSR(v),w=t.length,_=APt(yPt.reshape2d(x.indices,w,this.nNeighbors),yPt.reshape2d(x.values,w,this.nNeighbors),this.embedding),S=this.nEpochs?this.nEpochs/3:b.nRows<=1e4?100:30,k=b.getValues().reduce((function(t,e){return e>t?e:t}),0);b=b.map((function(t){return t<k/S?0:t})),b=fPt.eliminateZeros(b);var T=this.makeEpochsPerSample(b.getValues(),S),E=b.getRows(),M=b.getCols();return this.assignOptimizationStateParameters({headEmbedding:_,tailEmbedding:this.embedding,head:E,tail:M,currentEpoch:0,nEpochs:S,nVertices:b.getDims()[1],epochsPerSample:T}),this.prepareForOptimizationLoop(),this.optimizeLayout()},t.prototype.processGraphForSupervisedProjection=function(){var t=this.Y,e=this.X;if(t){if(t.length!==e.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var n=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,t,n)}}},t.prototype.step=function(){var t=this.optimizationState.currentEpoch;return t<this.getNEpochs()&&this.optimizeLayoutStep(t),this.optimizationState.currentEpoch},t.prototype.getEmbedding=function(){return this.embedding},t.prototype.nearestNeighbors=function(t){var e=this.distanceFn,n=this.nNeighbors,r=mPt.makeNNDescent(e,this.random),i=5+Math.floor(function(t){return.5===t?0:Math.round(t)}(Math.pow(t.length,.5)/20)),s=Math.max(5,Math.floor(Math.round(function(t){return Math.log(t)/Math.log(2)}(t.length))));this.rpForest=gPt.makeForest(t,n,i,this.random);var o=r(t,gPt.makeLeafArray(this.rpForest),n,s);return{knnIndices:o.indices,knnDistances:o.weights}},t.prototype.fuzzySimplicialSet=function(t,e,n){void 0===n&&(n=1);var r=this,i=r.knnIndices,s=void 0===i?[]:i,o=r.knnDistances,a=void 0===o?[]:o,l=r.localConnectivity,c=this.smoothKNNDistance(a,e,l),u=c.sigmas,h=c.rhos,d=this.computeMembershipStrengths(s,a,u,h),p=d.rows,f=d.cols,m=d.vals,g=[t.length,t.length],y=new fPt.SparseMatrix(p,f,m,g),b=fPt.transpose(y),v=fPt.pairwiseMultiply(y,b),x=fPt.subtract(fPt.add(y,b),v),w=fPt.multiplyScalar(x,n),_=fPt.multiplyScalar(v,1-n);return fPt.add(w,_)},t.prototype.categoricalSimplicialSetIntersection=function(t,e,n,r){void 0===r&&(r=1);var i=MPt(t,e,r,n);return CPt(i=fPt.eliminateZeros(i))},t.prototype.smoothKNNDistance=function(t,e,n,r,i){void 0===n&&(n=1),void 0===r&&(r=64),void 0===i&&(i=1);for(var s=Math.log(e)/Math.log(2)*i,o=yPt.zeros(t.length),a=yPt.zeros(t.length),l=0;l<t.length;l++){var c=0,u=1/0,h=1,d=t[l],p=d.filter((function(t){return t>0}));if(p.length>=n){var f=Math.floor(n),m=n-f;f>0?(o[l]=p[f-1],m>vPt&&(o[l]+=m*(p[f]-p[f-1]))):o[l]=m*p[0]}else p.length>0&&(o[l]=yPt.max(p));for(var g=0;g<r;g++){for(var y=0,b=1;b<t[l].length;b++){var v=t[l][b]-o[l];y+=v>0?Math.exp(-v/h):1}if(Math.abs(y-s)<vPt)break;y>s?h=(c+(u=h))/2:(c=h,u===1/0?h*=2:h=(c+u)/2)}if(a[l]=h,o[l]>0){var x=yPt.mean(d);a[l]<xPt*x&&(a[l]=xPt*x)}else{var w=yPt.mean(t.map(yPt.mean));a[l]<xPt*w&&(a[l]=xPt*w)}}return{sigmas:a,rhos:o}},t.prototype.computeMembershipStrengths=function(t,e,n,r){for(var i=t.length,s=t[0].length,o=yPt.zeros(i*s),a=yPt.zeros(i*s),l=yPt.zeros(i*s),c=0;c<i;c++)for(var u=0;u<s;u++){var h=0;-1!==t[c][u]&&(h=t[c][u]===c?0:e[c][u]-r[c]<=0?1:Math.exp(-(e[c][u]-r[c])/n[c]),o[c*s+u]=c,a[c*s+u]=t[c][u],l[c*s+u]=h)}return{rows:o,cols:a,vals:l}},t.prototype.initializeSimplicialSetEmbedding=function(){for(var t=this,e=this.getNEpochs(),n=this.nComponents,r=this.graph.getValues(),i=0,s=0;s<r.length;s++){var o=r[s];i<r[s]&&(i=o)}var a=this.graph.map((function(t){return t<i/e?0:t}));this.embedding=yPt.zeros(a.nRows).map((function(){return yPt.zeros(n).map((function(){return 20*yPt.tauRand(t.random)-10}))}));var l=[],c=[],u=[],h=a.getAll();for(s=0;s<h.length;s++){var d=h[s];d.value&&(l.push(d.value),u.push(d.row),c.push(d.col))}return{head:c,tail:u,epochsPerSample:this.makeEpochsPerSample(l,e)}},t.prototype.makeEpochsPerSample=function(t,e){var n=yPt.filled(t.length,-1),r=yPt.max(t),i=t.map((function(t){return t/r*e}));return i.forEach((function(t,r){t>0&&(n[r]=e/i[r])})),n},t.prototype.assignOptimizationStateParameters=function(t){Object.assign(this.optimizationState,t)},t.prototype.prepareForOptimizationLoop=function(){var t=this,e=t.repulsionStrength,n=t.learningRate,r=t.negativeSampleRate,i=this.optimizationState,s=i.epochsPerSample,o=i.headEmbedding,a=i.tailEmbedding,l=o[0].length,c=o.length===a.length,u=s.map((function(t){return t/r})),h=uPt(u),d=uPt(s);this.assignOptimizationStateParameters({epochOfNextSample:d,epochOfNextNegativeSample:h,epochsPerNegativeSample:u,moveOther:c,initialAlpha:n,alpha:n,gamma:e,dim:l})},t.prototype.initializeOptimization=function(){var t=this.embedding,e=this.embedding,n=this.optimizationState,r=n.head,i=n.tail,s=n.epochsPerSample,o=this.getNEpochs(),a=this.graph.nCols,l=EPt(this.spread,this.minDist),c=l.a,u=l.b;this.assignOptimizationStateParameters({headEmbedding:t,tailEmbedding:e,head:r,tail:i,epochsPerSample:s,a:c,b:u,nEpochs:o,nVertices:a})},t.prototype.optimizeLayoutStep=function(t){for(var e=this.optimizationState,n=e.head,r=e.tail,i=e.headEmbedding,s=e.tailEmbedding,o=e.epochsPerSample,a=e.epochOfNextSample,l=e.epochOfNextNegativeSample,c=e.epochsPerNegativeSample,u=e.moveOther,h=e.initialAlpha,d=e.alpha,p=e.gamma,f=e.a,m=e.b,g=e.dim,y=e.nEpochs,b=e.nVertices,v=0;v<o.length;v++)if(!(a[v]>t)){var x=n[v],w=r[v],_=i[x],S=s[w],k=TPt(_,S),T=0;k>0&&(T=-2*f*m*Math.pow(k,m-1),T/=f*Math.pow(k,m)+1);for(var E=0;E<g;E++){var M=kPt(T*(_[E]-S[E]),4);_[E]+=M*d,u&&(S[E]+=-M*d)}a[v]+=o[v];for(var C=Math.floor((t-l[v])/c[v]),A=0;A<C;A++){var N=yPt.tauRandInt(b,this.random),I=s[N],$=TPt(_,I),R=0;if($>0)R=2*p*m,R/=(.001+$)*(f*Math.pow($,m)+1);else if(x===N)continue;for(E=0;E<g;E++){M=4;R>0&&(M=kPt(R*(_[E]-I[E]),4)),_[E]+=M*d}}l[v]+=C*c[v]}return e.alpha=h*(1-t/y),e.currentEpoch+=1,i},t.prototype.optimizeLayoutAsync=function(t){var e=this;return void 0===t&&(t=function(){return!0}),new Promise((function(n,r){var i=function(){return aPt(e,void 0,void 0,(function(){var e,s,o,a,l,c;return lPt(this,(function(u){try{if(e=this.optimizationState,s=e.nEpochs,o=e.currentEpoch,this.embedding=this.optimizeLayoutStep(o),a=this.optimizationState.currentEpoch,l=!1===t(a),c=a===s,l||c)return[2,n(c)];setTimeout((function(){return i()}),0)}catch(t){r(t)}return[2]}))}))};setTimeout((function(){return i()}),0)}))},t.prototype.optimizeLayout=function(t){void 0===t&&(t=function(){return!0});for(var e=!1,n=[];!e;){var r=this.optimizationState,i=r.nEpochs,s=r.currentEpoch;n=this.optimizeLayoutStep(s);var o=this.optimizationState.currentEpoch,a=!1===t(o);e=o===i||a}return n},t.prototype.getNEpochs=function(){var t=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=t.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},t}();function _Pt(t,e){for(var n=0,r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)}dOt.UMAP=wPt,dOt.euclidean=_Pt,dOt.cosine=function(t,e){for(var n=0,r=0,i=0,s=0;s<t.length;s++)n+=t[s]*e[s],r+=Math.pow(t[s],2),i+=Math.pow(e[s],2);return 0===r&&0===i?0:0===r||0===i?1:1-n/Math.sqrt(r*i)};var SPt=function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0};function kPt(t,e){return t>e?e:t<-e?-e:t}function TPt(t,e){for(var n=0,r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return n}function EPt(t,e){var n=yPt.linear(0,3*t,300).map((function(t){return t<e?1:t})),r=yPt.zeros(n.length).map((function(r,i){return n[i]>=e?Math.exp(-(n[i]-e)/t):r})),i={x:n,y:r},s={damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01},o=bPt.default(i,(function(t){var e=cPt(t,2),n=e[0],r=e[1];return function(t){return 1/(1+n*Math.pow(t,2*r))}}),s).parameterValues,a=cPt(o,2);return{a:a[0],b:a[1]}}function MPt(t,e,n,r){return void 0===n&&(n=1),void 0===r&&(r=5),t.map((function(t,i,s){return-1===e[i]||-1===e[s]?t*Math.exp(-n):e[i]!==e[s]?t*Math.exp(-r):t}))}function CPt(t){t=fPt.normalize(t,"max");var e=fPt.transpose(t),n=fPt.pairwiseMultiply(e,t);return t=fPt.add(t,fPt.subtract(e,n)),fPt.eliminateZeros(t)}function APt(t,e,n){for(var r=yPt.zeros(t.length).map((function(t){return yPt.zeros(n[0].length)})),i=0;i<t.length;i++)for(var s=0;s<t[0].length;s++)for(var o=0;o<n[0].length;o++){var a=t[i][s];r[i][o]+=e[i][s]*n[a][o]}return r}dOt.findABParams=EPt,dOt.fastIntersection=MPt,dOt.resetLocalConnectivity=CPt,dOt.initTransform=APt,Object.defineProperty(hOt,"__esModule",{value:!0});var NPt,IPt,$Pt,RPt,OPt,PPt,LPt,DPt,FPt,zPt,BPt,UPt,VPt=dOt,jPt=hOt.UMAP=VPt.UMAP;class WPt extends vQ{constructor({nComponents:t=2,nNeighbors:e=15,minDist:n=.1,spread:r=1,supervised:i=!1}={}){super(),this.title="UMAP",this.serviceName="umap",this.parameters={nComponents:new JH(t,!0),nNeighbors:new JH(e,!0),minDist:new JH(n,!0),spread:new JH(r,!0),supervised:new JH(i,!0)}}async train(t){this.$training.set({status:"start",epochs:-1});const e=bQ(t)?t.items():t,n=await e.toArray(),r=n.reduce(((t,{x:e})=>t.concat([e])),[]);if(this.model=new jPt({nComponents:this.parameters.nComponents.get()}),this.parameters.supervised.get()){const t=n.map((t=>t.y));this.model.setSupervisedProjection(t)}const i=this.model.initializeFit(r);this.$training.set({status:"start",epochs:i});for(let t=0;t<i;t++)this.model.step(),this.$training.set({status:"epoch",epoch:t+1,epochs:i,data:{embedding:this.model.getEmbedding()}});this.$training.set({status:"success",data:{embedding:this.model.getEmbedding()}})}async predict(t){return this.model?this.model.transform([t])[0]:null}save(){throw new Error("Umap does not support saving")}load(){throw new Error("Umap does not support loading")}download(){throw new Error("Umap does not support downloading")}upload(){throw new Error("Umap does not support uploading")}}function HPt(t){let e,n;return e=new B$({}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function GPt(t){let e,n,r,i,s,o,a,l,c,u,h;function d(e){t[10](e)}let p={text:"activate video"};void 0!==t[7]&&(p.checked=t[7]),i=new j$({props:p}),uI.push((()=>BI(i,"checked",d)));let f=t[7]&&!t[8]&&HPt();return{c(){e=IN("div"),n=IN("div"),r=IN("div"),UI(i.$$.fragment),o=ON(),a=IN("div"),f&&f.c(),l=ON(),c=IN("video"),VN(n,"margin-left","10px"),FN(c,"id","webcam-video"),FN(c,"class","max-w-none svelte-18llgdn"),VN(c,"width",t[1]>t[2]?`${t[6]}px`:"auto"),VN(c,"height",t[1]>t[2]?"auto":t[6]*t[2]/t[1]+"px"),c.autoplay=!0,c.muted=!0,c.playsInline=!0,FN(a,"class","webcam-container svelte-18llgdn"),VN(a,"flex-direction",t[1]>t[2]?"column":"row"),VN(a,"height",t[6]*t[2]/t[1]+"px"),yI((()=>t[12].call(a))),FN(e,"class","webcam svelte-18llgdn")},m(s,d){CN(s,e,d),TN(e,n),TN(n,r),VI(i,r,null),TN(e,o),TN(e,a),f&&f.m(a,null),TN(a,l),TN(a,c),t[11](c),u=function(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");const n=IN("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=HN();let i;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",i=LN(window,"message",(t=>{t.source===n.contentWindow&&e()}))):(n.src="about:blank",n.onload=()=>{i=LN(n.contentWindow,"resize",e)}),TN(t,n),()=>{(r||i&&n.contentWindow)&&i(),AN(n)}}(a,t[12].bind(a)),h=!0},p(t,e){const n={};!s&&128&e&&(s=!0,n.checked=t[7],bI((()=>s=!1))),i.$set(n),t[7]&&!t[8]?f?384&e&&NI(f,1):(f=HPt(),f.c(),NI(f,1),f.m(a,l)):f&&(CI(),II(f,1,1,(()=>{f=null})),AI()),(!h||70&e)&&VN(c,"width",t[1]>t[2]?`${t[6]}px`:"auto"),(!h||70&e)&&VN(c,"height",t[1]>t[2]?"auto":t[6]*t[2]/t[1]+"px"),(!h||6&e)&&VN(a,"flex-direction",t[1]>t[2]?"column":"row"),(!h||70&e)&&VN(a,"height",t[6]*t[2]/t[1]+"px")},i(t){h||(NI(i.$$.fragment,t),NI(f),h=!0)},o(t){II(i.$$.fragment,t),II(f),h=!1},d(n){n&&AN(e),jI(i),f&&f.d(),t[11](null),u()}}}function qPt(t){let e,n;return e=new OU({props:{title:t[0],$$slots:{default:[GPt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title=t[0]),16870&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function XPt(t,e,n){let r,i,s=nN,o=()=>(s(),s=hN(d,(t=>n(7,r=t))),d),a=nN,l=()=>(a(),a=hN(g,(t=>n(8,i=t))),g);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>a()));let{title:c}=e,{width:u}=e,{height:h}=e,{active:d}=e;o();let p,f,{mediaStream:m}=e,{ready:g}=e;l();let y=XH;return rI((async()=>{await gI(),await gI(),y=m.subscribe((t=>{t&&n(5,p.srcObject=t,p)}))})),sI((()=>{y()})),t.$$set=t=>{"title"in t&&n(0,c=t.title),"width"in t&&n(1,u=t.width),"height"in t&&n(2,h=t.height),"active"in t&&o(n(3,d=t.active)),"mediaStream"in t&&n(9,m=t.mediaStream),"ready"in t&&l(n(4,g=t.ready))},[c,u,h,d,g,p,f,r,i,m,function(t){r=t,d.set(r)},function(t){uI[t?"unshift":"push"]((()=>{p=t,n(5,p)}))},function(){f=this.clientWidth,n(6,f)}]}class YPt extends HI{constructor(t){super(),WI(this,t,XPt,qPt,lN,{title:0,width:1,height:2,active:3,mediaStream:9,ready:4})}}class KPt extends mG{constructor({width:t=224,height:e=224,period:n=50}={}){super(),this.title="webcam",this.$active=new JH(!1,!0),this.$ready=new JH(!1,!0),this.$mediastream=new JH(void 0,!0),this.$images=new JH(qV(),!0),this.$thumbnails=new JH(qV(),!0),NPt.set(this,void 0),IPt.set(this,void 0),$Pt.set(this,void 0),RPt.set(this,void 0),OPt.set(this,document.createElement("video")),PPt.set(this,60),LPt.set(this,XH),DPt.set(this,XH),FPt.set(this,void 0),zPt.set(this,void 0),BPt.set(this,void 0),UPt.set(this,void 0),BH(this,NPt,t,"f"),BH(this,IPt,e,"f"),this.period=n,this.setupCapture(),this.start(),zH(this,OPt,"f").autoplay=!0,BH(this,LPt,this.$active.subscribe((t=>{zH(this,DPt,"f").call(this),t?(this.loadCameras(),BH(this,DPt,function(t,e){let n,r=(new Date).getTime(),i=!1;return n=window.requestAnimationFrame((function s(){i||((new Date).getTime()-r>=e&&(t(),r=(new Date).getTime()),n=window.requestAnimationFrame(s))})),function(){window.cancelAnimationFrame(n),i=!0}}(this.process,this.period),"f")):this.stopCamera()})),"f")}getWidth(){return zH(this,NPt,"f")}mount(t){const e=t||document.querySelector(`#${this.id}`);e&&(this.destroy(),this.$$.app=new YPt({target:e,props:{title:this.title,width:zH(this,NPt,"f"),height:zH(this,IPt,"f"),active:this.$active,mediaStream:this.$mediastream,ready:this.$ready}}))}stop(){if(super.stop(),zH(this,DPt,"f").call(this),zH(this,LPt,"f").call(this),this.$mediastream.get())for(const t of this.$mediastream.get().getTracks())t.stop()}setupCapture(){BH(this,FPt,document.createElement("canvas"),"f"),zH(this,FPt,"f").width=zH(this,PPt,"f"),zH(this,FPt,"f").height=zH(this,PPt,"f")*zH(this,IPt,"f")/zH(this,NPt,"f"),BH(this,zPt,zH(this,FPt,"f").getContext("2d"),"f"),BH(this,BPt,document.createElement("canvas"),"f"),zH(this,BPt,"f").width=zH(this,NPt,"f"),zH(this,BPt,"f").height=zH(this,IPt,"f"),BH(this,UPt,zH(this,BPt,"f").getContext("2d"),"f")}async loadCameras(){try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});BH(this,$Pt,t.getVideoTracks()[0].getSettings().width,"f"),BH(this,RPt,t.getVideoTracks()[0].getSettings().height,"f"),this.loadSrcStream(t)}catch(t){sG(new Error("Webcam not supported"))}}loadSrcStream(t){this.$mediastream.set(t),zH(this,OPt,"f").srcObject=t,zH(this,OPt,"f").onloadedmetadata=()=>{this.$ready.set(!0)}}stopCamera(){if(this.$mediastream.get()){const t=this.$mediastream.get().getTracks();for(const e of t)e.stop(),zH(this,OPt,"f").srcObject=null;this.$ready.set(!1)}}process(){this.$ready.get()&&(this.$thumbnails.set(this.captureThumbnail()),this.$images.set(this.captureImage()))}captureThumbnail(){if(!this.$ready.get())return null;if(zH(this,IPt,"f")/zH(this,RPt,"f")>zH(this,NPt,"f")/zH(this,$Pt,"f")){const t=zH(this,FPt,"f").height*zH(this,$Pt,"f")/zH(this,RPt,"f");zH(this,zPt,"f").drawImage(zH(this,OPt,"f"),zH(this,FPt,"f").width/2-t/2,0,t,zH(this,FPt,"f").height)}else{const t=zH(this,FPt,"f").width*zH(this,RPt,"f")/zH(this,$Pt,"f");zH(this,zPt,"f").drawImage(zH(this,OPt,"f"),0,zH(this,FPt,"f").height/2-t/2,zH(this,FPt,"f").width,t)}return zH(this,FPt,"f").toDataURL("image/jpeg")}captureImage(){if(!this.$ready.get())return null;if(zH(this,IPt,"f")/zH(this,RPt,"f")>zH(this,NPt,"f")/zH(this,$Pt,"f")){const t=zH(this,IPt,"f")*zH(this,$Pt,"f")/zH(this,RPt,"f");zH(this,UPt,"f").drawImage(zH(this,OPt,"f"),zH(this,NPt,"f")/2-t/2,0,t,zH(this,IPt,"f"))}else{const t=zH(this,NPt,"f")*zH(this,RPt,"f")/zH(this,$Pt,"f");zH(this,UPt,"f").drawImage(zH(this,OPt,"f"),0,zH(this,IPt,"f")/2-t/2,zH(this,NPt,"f"),t)}return zH(this,UPt,"f").getImageData(0,0,zH(this,NPt,"f"),zH(this,IPt,"f"))}}function ZPt(t){return"string"==typeof t}function JPt(t){return Array.isArray(t)}NPt=new WeakMap,IPt=new WeakMap,$Pt=new WeakMap,RPt=new WeakMap,OPt=new WeakMap,PPt=new WeakMap,LPt=new WeakMap,DPt=new WeakMap,FPt=new WeakMap,zPt=new WeakMap,BPt=new WeakMap,UPt=new WeakMap;class QPt{constructor(t,e=!0){this.name=t,this.showSidebar=e,this.components=[],this.componentsLeft=[]}use(...t){return this.components=this.components.concat(t),this}sidebar(...t){return this.componentsLeft=this.componentsLeft.concat(t),this}mount(){for(const t of this.components)if(JPt(t))for(const e of t)e.mount();else ZPt(t)||t.mount();for(const t of this.componentsLeft)t.mount()}destroy(){for(const t of this.components)if(JPt(t))for(const e of t)e.destroy();else ZPt(t)||t.destroy();for(const t of this.componentsLeft)t.destroy()}}class tLt{constructor(t,e){this.path=t,this.name=e,this.keys=[],this.fns=[],this.params={},this.regex=function(t,e,n,r){return t instanceof RegExp?t:(t instanceof Array&&(t=`(${t.join("|")})`),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,((t,n,r,i,s,o)=>(e.push({name:i,optional:!!o}),n=n||"",`${o?"":n}(?:${o?n:""}${r||""}${s||r&&"([^/.]+?)"||"([^/]+?)"})${o||""}`))).replace(/([/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp(`^${t}$`,n?"":"i"))}(this.path,this.keys,!1,!1)}addHandler(t){this.fns.push(t)}removeHandler(t){this.fns=this.fns.filter((e=>t===e))}run(t){for(const e of this.fns)e.apply(this,t)}match(t,e){const n=this.regex.exec(t);if(!n)return!1;for(let t=1,r=n.length;t<r;t++){const r=this.keys[t-1],i="string"==typeof n[t]?decodeURIComponent(n[t]):n[t];r&&(this.params[r.name]=i),e.push(i)}return!0}}function eLt(t,e){const n=[];return!!e.match(t,n)&&(e.run(n),!0)}class nLt{constructor(){this.map={},this.routes=[],this.addListener()}route(t,e){const n=t.split(" "),r=2===n.length?n[0]:null;t=2===n.length?n[1]:n[0],Object.keys(this.map).includes(t)||(this.map[t]=new tLt(t,r),this.routes.push(this.map[t])),this.map[t].addHandler(e),this.reload()}addListener(){window.addEventListener("hashchange",this.reload.bind(this),!1)}removeListener(){window.removeEventListener("hashchange",this.reload.bind(this))}reload(){const t=window.location.hash.substring(1);for(let e=0;e<this.routes.length;e++){if(eLt(t,this.routes[e]))return}}navigate(t,{silent:e=!1}={}){e&&this.removeListener(),setTimeout((()=>{window.location.hash=t,e&&setTimeout((()=>{this.addListener()}),1)}),1)}}function rLt(t,e,n){const r=t.slice();return r[1]=e[n],r}function iLt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function sLt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function oLt(t){let e,n,r=t[0].showSidebar&&aLt(t),i=t[0].components,s=[];for(let e=0;e<i.length;e+=1)s[e]=pLt(rLt(t,i,e));return{c(){r&&r.c(),e=ON(),n=IN("div");for(let t=0;t<s.length;t+=1)s[t].c();FN(n,"class","right svelte-15dyumc"),GN(n,"fullw",!t[0].showSidebar)},m(t,i){r&&r.m(t,i),CN(t,e,i),CN(t,n,i);for(let t=0;t<s.length;t+=1)s[t].m(n,null)},p(t,o){if(t[0].showSidebar?r?r.p(t,o):(r=aLt(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),1&o){let e;for(i=t[0].components,e=0;e<i.length;e+=1){const r=rLt(t,i,e);s[e]?s[e].p(r,o):(s[e]=pLt(r),s[e].c(),s[e].m(n,null))}for(;e<s.length;e+=1)s[e].d(1);s.length=i.length}1&o&&GN(n,"fullw",!t[0].showSidebar)},d(t){r&&r.d(t),t&&AN(e),t&&AN(n),NN(s,t)}}}function aLt(t){let e,n=t[0].componentsLeft,r=[];for(let e=0;e<n.length;e+=1)r[e]=lLt(sLt(t,n,e));return{c(){e=IN("div");for(let t=0;t<r.length;t+=1)r[t].c();FN(e,"class","left svelte-15dyumc")},m(t,n){CN(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,i){if(1&i){let s;for(n=t[0].componentsLeft,s=0;s<n.length;s+=1){const o=sLt(t,n,s);r[s]?r[s].p(o,i):(r[s]=lLt(o),r[s].c(),r[s].m(e,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){t&&AN(e),NN(r,t)}}}function lLt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[4]),FN(e,"class","card")},m(t,n){CN(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&FN(e,"id",n)},d(t){t&&AN(e)}}}function cLt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[1].id),FN(e,"class","card")},m(t,n){CN(t,e,n)},p(t,r){1&r&&n!==(n=t[1].id)&&FN(e,"id",n)},d(t){t&&AN(e)}}}function uLt(t){let e,n,r=t[1]+"";return{c(){e=IN("h2"),n=RN(r),FN(e,"class","svelte-15dyumc")},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){1&e&&r!==(r=t[1]+"")&&BN(n,r)},d(t){t&&AN(e)}}}function hLt(t){let e,n,r=t[1],i=[];for(let e=0;e<r.length;e+=1)i[e]=dLt(iLt(t,r,e));return{c(){e=IN("div");for(let t=0;t<i.length;t+=1)i[t].c();n=ON(),FN(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){CN(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);TN(e,n)},p(t,s){if(1&s){let o;for(r=t[1],o=0;o<r.length;o+=1){const a=iLt(t,r,o);i[o]?i[o].p(a,s):(i[o]=dLt(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&AN(e),NN(i,t)}}}function dLt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[4]),FN(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){CN(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&FN(e,"id",n)},d(t){t&&AN(e)}}}function pLt(t){let e,n;function r(t,n){return 1&n&&(e=null),null==e&&(e=!!Array.isArray(t[1])),e?hLt:"string"==typeof t[1]?uLt:cLt}let i=r(t,-1),s=i(t);return{c(){s.c(),n=PN()},m(t,e){s.m(t,e),CN(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&AN(n)}}}function fLt(t){let e,n=t[0]&&oLt(t);return{c(){n&&n.c(),e=PN()},m(t,r){n&&n.m(t,r),CN(t,e,r)},p(t,[r]){t[0]?n?n.p(t,r):(n=oLt(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:nN,o:nN,d(t){n&&n.d(t),t&&AN(e)}}}function mLt(t,e,n){let{dashboard:r}=e;return iI((()=>{r.mount()})),t.$$set=t=>{"dashboard"in t&&n(0,r=t.dashboard)},[r]}class gLt extends HI{constructor(t){super(),WI(this,t,mLt,fLt,lN,{dashboard:0})}}function yLt(t){let e;return{c(){e=RN("This dataset is empty")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function bLt(t){let e,n,r,i,s,o=t[3]?"s":"";return{c(){e=RN("This dataset contains "),n=RN(t[3]),r=RN(" instance"),i=RN(o),s=RN(".")},m(t,o){CN(t,e,o),CN(t,n,o),CN(t,r,o),CN(t,i,o),CN(t,s,o)},p(t,e){8&e&&BN(n,t[3]),8&e&&o!==(o=t[3]?"s":"")&&BN(i,o)},d(t){t&&AN(e),t&&AN(n),t&&AN(r),t&&AN(i),t&&AN(s)}}}function vLt(t){let e,n,r,i;return e=new XI({props:{$$slots:{default:[xLt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){UI(e.$$.fragment),n=ON(),r=IN("span"),FN(r,"class","w-1")},m(t,s){VI(e,t,s),CN(t,n,s),CN(t,r,s),i=!0},p(t,n){const r={};256&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(NI(e.$$.fragment,t),i=!0)},o(t){II(e.$$.fragment,t),i=!1},d(t){jI(e,t),t&&AN(n),t&&AN(r)}}}function xLt(t){let e;return{c(){e=RN("Download Dataset")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function wLt(t){let e;return{c(){e=RN("Upload Dataset")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function _Lt(t){let e;return{c(){e=RN("Clear Dataset")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function SLt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].title+"";function y(t,e){return t[3]?bLt:yLt}let b=y(t),v=b(t),x=t[3]&&vLt(t);return l=new XI({props:{$$slots:{default:[wLt]},$$scope:{ctx:t}}}),l.$on("click",t[5]),f=new XI({props:{type:"danger",$$slots:{default:[_Lt]},$$scope:{ctx:t}}}),f.$on("click",t[6]),{c(){e=IN("span"),n=RN(g),r=ON(),i=IN("p"),v.c(),s=ON(),o=IN("div"),x&&x.c(),a=ON(),UI(l.$$.fragment),c=ON(),u=IN("span"),h=ON(),d=IN("input"),p=ON(),UI(f.$$.fragment),FN(e,"class","card-title"),FN(i,"class","pb-2"),FN(u,"class","w-1"),FN(d,"type","file"),d.multiple=!0,FN(d,"class","hidden"),FN(o,"class","flex")},m(g,y){CN(g,e,y),TN(e,n),CN(g,r,y),CN(g,i,y),v.m(i,null),CN(g,s,y),CN(g,o,y),x&&x.m(o,null),TN(o,a),VI(l,o,null),TN(o,c),TN(o,u),TN(o,h),TN(o,d),t[7](d),TN(o,p),VI(f,o,null),m=!0},p(t,[e]){(!m||1&e)&&g!==(g=t[0].title+"")&&BN(n,g),b===(b=y(t))&&v?v.p(t,e):(v.d(1),v=b(t),v&&(v.c(),v.m(i,null))),t[3]?x?(x.p(t,e),8&e&&NI(x,1)):(x=vLt(t),x.c(),NI(x,1),x.m(o,a)):x&&(CI(),II(x,1,1,(()=>{x=null})),AI());const r={};256&e&&(r.$$scope={dirty:e,ctx:t}),l.$set(r);const s={};256&e&&(s.$$scope={dirty:e,ctx:t}),f.$set(s)},i(t){m||(NI(x),NI(l.$$.fragment,t),NI(f.$$.fragment,t),m=!0)},o(t){II(x),II(l.$$.fragment,t),II(f.$$.fragment,t),m=!1},d(n){n&&AN(e),n&&AN(r),n&&AN(i),v.d(),n&&AN(s),n&&AN(o),x&&x.d(),jI(l),t[7](null),jI(f)}}}function kLt(t,e,n){let r,i,s=nN;t.$$.on_destroy.push((()=>s()));let o,{dataset:a}=e;return rI((async()=>{await gI(),await gI(),o.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);a.upload(n)}))})),t.$$set=t=>{"dataset"in t&&n(0,a=t.dataset)},t.$$.update=()=>{1&t.$$.dirty&&(n(2,r=a.$count),s(),s=hN(r,(t=>n(3,i=t))))},[a,o,r,i,function(){a.download()},function(){null==o||o.click()},function(){a.clear()},function(t){uI[t?"unshift":"push"]((()=>{o=t,n(1,o)}))}]}class TLt extends HI{constructor(t){super(),WI(this,t,kLt,SLt,lN,{dataset:0})}}function ELt(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:NLt,then:CLt,catch:MLt,value:4,blocks:[,,,]};return OI(n=t[0].connect(),i),{c(){e=PN(),i.block.c()},m(t,n){CN(t,e,n),i.block.m(t,i.anchor=n),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(e,r){t=e,i.ctx=t,1&r&&n!==(n=t[0].connect())&&OI(n,i)||PI(i,t,r)},i(t){r||(NI(i.block),r=!0)},o(t){for(let t=0;t<3;t+=1){II(i.blocks[t])}r=!1},d(t){t&&AN(e),i.block.d(t),i.token=null,i=null}}}function MLt(t){return{c:nN,m:nN,p:nN,i:nN,o:nN,d:nN}}function CLt(t){let e,n,r,i,s,o,a,l=t[4].email+"";return o=new XI({props:{$$slots:{default:[ALt]},$$scope:{ctx:t}}}),o.$on("click",t[3]),{c(){e=IN("p"),n=RN("Hello, "),r=RN(l),i=ON(),s=IN("div"),UI(o.$$.fragment),FN(e,"class","pb-2"),FN(s,"class","flex")},m(t,l){CN(t,e,l),TN(e,n),TN(e,r),CN(t,i,l),CN(t,s,l),VI(o,s,null),a=!0},p(t,e){(!a||1&e)&&l!==(l=t[4].email+"")&&BN(r,l);const n={};32&e&&(n.$$scope={dirty:e,ctx:t}),o.$set(n)},i(t){a||(NI(o.$$.fragment,t),a=!0)},o(t){II(o.$$.fragment,t),a=!1},d(t){t&&AN(e),t&&AN(i),t&&AN(s),jI(o)}}}function ALt(t){let e;return{c(){e=RN("Log out")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function NLt(t){let e,n;return e=new B$({}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p:nN,i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function ILt(t){let e,n,r,i=t[2].join(", ")+"";return{c(){e=IN("div"),n=RN("This data store contains the following services: "),r=RN(i)},m(t,i){CN(t,e,i),TN(e,n),TN(e,r)},p(t,e){4&e&&i!==(i=t[2].join(", ")+"")&&BN(r,i)},d(t){t&&AN(e)}}}function $Lt(t){let e,n,r,i=t[0].requiresAuth&&ELt(t),s=t[2]&&ILt(t);return{c(){i&&i.c(),e=ON(),s&&s.c(),n=PN()},m(t,o){i&&i.m(t,o),CN(t,e,o),s&&s.m(t,o),CN(t,n,o),r=!0},p(t,r){t[0].requiresAuth?i?(i.p(t,r),1&r&&NI(i,1)):(i=ELt(t),i.c(),NI(i,1),i.m(e.parentNode,e)):i&&(CI(),II(i,1,1,(()=>{i=null})),AI()),t[2]?s?s.p(t,r):(s=ILt(t),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i(t){r||(NI(i),r=!0)},o(t){II(i),r=!1},d(t){i&&i.d(t),t&&AN(e),s&&s.d(t),t&&AN(n)}}}function RLt(t){let e,n;return e=new OU({props:{title:"data store ("+t[0].location+")",$$slots:{default:[$Lt]},$$scope:{ctx:t}}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,[n]){const r={};1&n&&(r.title="data store ("+t[0].location+")"),37&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function OLt(t,e,n){let r,i,s=nN;t.$$.on_destroy.push((()=>s()));let{dataStore:o}=e;return t.$$set=t=>{"dataStore"in t&&n(0,o=t.dataStore)},t.$$.update=()=>{1&t.$$.dirty&&(n(1,r=o.$services),s(),s=hN(r,(t=>n(2,i=t))))},[o,r,i,function(){o.logout()}]}class PLt extends HI{constructor(t){super(),WI(this,t,OLt,RLt,lN,{dataStore:0})}}function LLt(t){let e;return{c(){e=RN("Download Model")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function DLt(t){let e;return{c(){e=RN("Upload Model")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function FLt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p=t[0].title+"";return s=new XI({props:{$$slots:{default:[LLt]},$$scope:{ctx:t}}}),s.$on("click",t[2]),h=new XI({props:{$$slots:{default:[DLt]},$$scope:{ctx:t}}}),h.$on("click",t[3]),{c(){e=IN("span"),n=RN(p),r=ON(),i=IN("div"),UI(s.$$.fragment),o=ON(),a=IN("span"),l=ON(),c=IN("input"),u=ON(),UI(h.$$.fragment),FN(e,"class","card-title"),FN(a,"class","w-1"),FN(c,"type","file"),c.multiple=!0,FN(c,"class","hidden"),FN(i,"class","flex")},m(p,f){CN(p,e,f),TN(e,n),CN(p,r,f),CN(p,i,f),VI(s,i,null),TN(i,o),TN(i,a),TN(i,l),TN(i,c),t[4](c),TN(i,u),VI(h,i,null),d=!0},p(t,[e]){(!d||1&e)&&p!==(p=t[0].title+"")&&BN(n,p);const r={};32&e&&(r.$$scope={dirty:e,ctx:t}),s.$set(r);const i={};32&e&&(i.$$scope={dirty:e,ctx:t}),h.$set(i)},i(t){d||(NI(s.$$.fragment,t),NI(h.$$.fragment,t),d=!0)},o(t){II(s.$$.fragment,t),II(h.$$.fragment,t),d=!1},d(n){n&&AN(e),n&&AN(r),n&&AN(i),jI(s),t[4](null),jI(h)}}}function zLt(t){return"download"in t}function BLt(t,e,n){let r,{model:i}=e;return rI((async()=>{await gI(),await gI(),r.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);zLt(i)&&i.upload(...n)}))})),t.$$set=t=>{"model"in t&&n(0,i=t.model)},[i,r,function(){zLt(i)?i.download():sG(new Error("This model cannot be saved"))},function(){zLt(i)?null==r||r.click():sG(new Error("This model cannot be uploaded"))},function(t){uI[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class ULt extends HI{constructor(t){super(),WI(this,t,BLt,FLt,lN,{model:0})}}function VLt(t){let e;return{c(){e=RN("This batch prediction component is empty")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function jLt(t){let e,n,r,i,s=t[3]?"s":"";return{c(){e=RN("This batch prediction component contains\n    "),n=RN(t[3]),r=RN("\n    prediction"),i=RN(s)},m(t,s){CN(t,e,s),CN(t,n,s),CN(t,r,s),CN(t,i,s)},p(t,e){8&e&&BN(n,t[3]),8&e&&s!==(s=t[3]?"s":"")&&BN(i,s)},d(t){t&&AN(e),t&&AN(n),t&&AN(r),t&&AN(i)}}}function WLt(t){let e,n,r,i;return e=new XI({props:{$$slots:{default:[HLt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){UI(e.$$.fragment),n=ON(),r=IN("span"),FN(r,"class","w-1")},m(t,s){VI(e,t,s),CN(t,n,s),CN(t,r,s),i=!0},p(t,n){const r={};256&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(NI(e.$$.fragment,t),i=!0)},o(t){II(e.$$.fragment,t),i=!1},d(t){jI(e,t),t&&AN(n),t&&AN(r)}}}function HLt(t){let e;return{c(){e=RN("Download Predictions")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function GLt(t){let e;return{c(){e=RN("Upload Predictions")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function qLt(t){let e;return{c(){e=RN("Clear Predictions")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function XLt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].title+"";function y(t,e){return t[3]?jLt:VLt}let b=y(t),v=b(t),x=t[3]&&WLt(t);return l=new XI({props:{$$slots:{default:[GLt]},$$scope:{ctx:t}}}),l.$on("click",t[5]),f=new XI({props:{type:"danger",$$slots:{default:[qLt]},$$scope:{ctx:t}}}),f.$on("click",t[6]),{c(){e=IN("span"),n=RN(g),r=ON(),i=IN("p"),v.c(),s=ON(),o=IN("div"),x&&x.c(),a=ON(),UI(l.$$.fragment),c=ON(),u=IN("span"),h=ON(),d=IN("input"),p=ON(),UI(f.$$.fragment),FN(e,"class","card-title"),FN(i,"class","pb-2"),FN(u,"class","w-1"),FN(d,"type","file"),d.multiple=!0,FN(d,"class","hidden"),FN(o,"class","flex")},m(g,y){CN(g,e,y),TN(e,n),CN(g,r,y),CN(g,i,y),v.m(i,null),CN(g,s,y),CN(g,o,y),x&&x.m(o,null),TN(o,a),VI(l,o,null),TN(o,c),TN(o,u),TN(o,h),TN(o,d),t[7](d),TN(o,p),VI(f,o,null),m=!0},p(t,[e]){(!m||1&e)&&g!==(g=t[0].title+"")&&BN(n,g),b===(b=y(t))&&v?v.p(t,e):(v.d(1),v=b(t),v&&(v.c(),v.m(i,null))),t[3]?x?(x.p(t,e),8&e&&NI(x,1)):(x=WLt(t),x.c(),NI(x,1),x.m(o,a)):x&&(CI(),II(x,1,1,(()=>{x=null})),AI());const r={};256&e&&(r.$$scope={dirty:e,ctx:t}),l.$set(r);const s={};256&e&&(s.$$scope={dirty:e,ctx:t}),f.$set(s)},i(t){m||(NI(x),NI(l.$$.fragment,t),NI(f.$$.fragment,t),m=!0)},o(t){II(x),II(l.$$.fragment,t),II(f.$$.fragment,t),m=!1},d(n){n&&AN(e),n&&AN(r),n&&AN(i),v.d(),n&&AN(s),n&&AN(o),x&&x.d(),jI(l),t[7](null),jI(f)}}}function YLt(t,e,n){let r,i,s=nN;t.$$.on_destroy.push((()=>s()));let o,{prediction:a}=e;return rI((async()=>{await gI(),await gI(),o.addEventListener("change",(t=>{const e=t.target.files,n=[];for(let t=0;t<e.length;t++)n.push(e[t]);a.upload(n)}))})),t.$$set=t=>{"prediction"in t&&n(0,a=t.prediction)},t.$$.update=()=>{1&t.$$.dirty&&(n(2,r=a.$count),s(),s=hN(r,(t=>n(3,i=t))))},[a,o,r,i,function(){a.download()},function(){null==o||o.click()},function(){a.clear()},function(t){uI[t?"unshift":"push"]((()=>{o=t,n(1,o)}))}]}class KLt extends HI{constructor(t){super(),WI(this,t,YLt,XLt,lN,{prediction:0})}}function ZLt(t,e,n){const r=t.slice();return r[1]=e[n],r}function JLt(t,e,n){const r=t.slice();return r[4]=e[n].id,r}function QLt(t,e,n){const r=t.slice();return r[7]=e[n],r}function tDt(t,e,n){const r=t.slice();return r[10]=e[n],r}function eDt(t,e,n){const r=t.slice();return r[13]=e[n],r}function nDt(t,e,n){const r=t.slice();return r[16]=e[n],r}function rDt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g=t[0].xDataStores,y=[];for(let e=0;e<g.length;e+=1)y[e]=iDt(nDt(t,g,e));const b=t=>II(y[t],1,1,(()=>{y[t]=null}));let v=t[0].xModels,x=[];for(let e=0;e<v.length;e+=1)x[e]=sDt(eDt(t,v,e));const w=t=>II(x[t],1,1,(()=>{x[t]=null}));let _=t[0].xDatasets,S=[];for(let e=0;e<_.length;e+=1)S[e]=oDt(tDt(t,_,e));const k=t=>II(S[t],1,1,(()=>{S[t]=null}));let T=t[0].xPredictions,E=[];for(let e=0;e<T.length;e+=1)E[e]=aDt(QLt(t,T,e));const M=t=>II(E[t],1,1,(()=>{E[t]=null}));let C=t[0].components,A=[];for(let e=0;e<C.length;e+=1)A[e]=dDt(ZLt(t,C,e));return{c(){e=IN("div"),n=IN("h2"),n.textContent="Data Stores",r=ON();for(let t=0;t<y.length;t+=1)y[t].c();i=ON(),s=IN("h2"),s.textContent="Models",o=ON();for(let t=0;t<x.length;t+=1)x[t].c();a=ON(),l=IN("h2"),l.textContent="Datasets",c=ON();for(let t=0;t<S.length;t+=1)S[t].c();u=ON(),h=IN("h2"),h.textContent="Predictions",d=ON();for(let t=0;t<E.length;t+=1)E[t].c();p=ON(),f=IN("div");for(let t=0;t<A.length;t+=1)A[t].c();FN(e,"class","left svelte-inuorr"),FN(f,"class","right svelte-inuorr")},m(t,g){CN(t,e,g),TN(e,n),TN(e,r);for(let t=0;t<y.length;t+=1)y[t].m(e,null);TN(e,i),TN(e,s),TN(e,o);for(let t=0;t<x.length;t+=1)x[t].m(e,null);TN(e,a),TN(e,l),TN(e,c);for(let t=0;t<S.length;t+=1)S[t].m(e,null);TN(e,u),TN(e,h),TN(e,d);for(let t=0;t<E.length;t+=1)E[t].m(e,null);CN(t,p,g),CN(t,f,g);for(let t=0;t<A.length;t+=1)A[t].m(f,null);m=!0},p(t,n){if(1&n){let r;for(g=t[0].xDataStores,r=0;r<g.length;r+=1){const s=nDt(t,g,r);y[r]?(y[r].p(s,n),NI(y[r],1)):(y[r]=iDt(s),y[r].c(),NI(y[r],1),y[r].m(e,i))}for(CI(),r=g.length;r<y.length;r+=1)b(r);AI()}if(1&n){let r;for(v=t[0].xModels,r=0;r<v.length;r+=1){const i=eDt(t,v,r);x[r]?(x[r].p(i,n),NI(x[r],1)):(x[r]=sDt(i),x[r].c(),NI(x[r],1),x[r].m(e,a))}for(CI(),r=v.length;r<x.length;r+=1)w(r);AI()}if(1&n){let r;for(_=t[0].xDatasets,r=0;r<_.length;r+=1){const i=tDt(t,_,r);S[r]?(S[r].p(i,n),NI(S[r],1)):(S[r]=oDt(i),S[r].c(),NI(S[r],1),S[r].m(e,u))}for(CI(),r=_.length;r<S.length;r+=1)k(r);AI()}if(1&n){let r;for(T=t[0].xPredictions,r=0;r<T.length;r+=1){const i=QLt(t,T,r);E[r]?(E[r].p(i,n),NI(E[r],1)):(E[r]=aDt(i),E[r].c(),NI(E[r],1),E[r].m(e,null))}for(CI(),r=T.length;r<E.length;r+=1)M(r);AI()}if(1&n){let e;for(C=t[0].components,e=0;e<C.length;e+=1){const r=ZLt(t,C,e);A[e]?A[e].p(r,n):(A[e]=dDt(r),A[e].c(),A[e].m(f,null))}for(;e<A.length;e+=1)A[e].d(1);A.length=C.length}},i(t){if(!m){for(let t=0;t<g.length;t+=1)NI(y[t]);for(let t=0;t<v.length;t+=1)NI(x[t]);for(let t=0;t<_.length;t+=1)NI(S[t]);for(let t=0;t<T.length;t+=1)NI(E[t]);m=!0}},o(t){y=y.filter(Boolean);for(let t=0;t<y.length;t+=1)II(y[t]);x=x.filter(Boolean);for(let t=0;t<x.length;t+=1)II(x[t]);S=S.filter(Boolean);for(let t=0;t<S.length;t+=1)II(S[t]);E=E.filter(Boolean);for(let t=0;t<E.length;t+=1)II(E[t]);m=!1},d(t){t&&AN(e),NN(y,t),NN(x,t),NN(S,t),NN(E,t),t&&AN(p),t&&AN(f),NN(A,t)}}}function iDt(t){let e,n,r;return n=new PLt({props:{dataStore:t[16]}}),{c(){e=IN("div"),UI(n.$$.fragment),FN(e,"class","card")},m(t,i){CN(t,e,i),VI(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.dataStore=t[16]),n.$set(r)},i(t){r||(NI(n.$$.fragment,t),r=!0)},o(t){II(n.$$.fragment,t),r=!1},d(t){t&&AN(e),jI(n)}}}function sDt(t){let e,n,r;return n=new ULt({props:{model:t[13]}}),{c(){e=IN("div"),UI(n.$$.fragment),FN(e,"class","card")},m(t,i){CN(t,e,i),VI(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.model=t[13]),n.$set(r)},i(t){r||(NI(n.$$.fragment,t),r=!0)},o(t){II(n.$$.fragment,t),r=!1},d(t){t&&AN(e),jI(n)}}}function oDt(t){let e,n,r;return n=new TLt({props:{dataset:t[10]}}),{c(){e=IN("div"),UI(n.$$.fragment),FN(e,"class","card")},m(t,i){CN(t,e,i),VI(n,e,null),r=!0},p(t,e){const r={};1&e&&(r.dataset=t[10]),n.$set(r)},i(t){r||(NI(n.$$.fragment,t),r=!0)},o(t){II(n.$$.fragment,t),r=!1},d(t){t&&AN(e),jI(n)}}}function aDt(t){let e,n,r,i;return n=new KLt({props:{prediction:t[7]}}),{c(){e=IN("div"),UI(n.$$.fragment),r=ON(),FN(e,"class","card")},m(t,s){CN(t,e,s),VI(n,e,null),TN(e,r),i=!0},p(t,e){const r={};1&e&&(r.prediction=t[7]),n.$set(r)},i(t){i||(NI(n.$$.fragment,t),i=!0)},o(t){II(n.$$.fragment,t),i=!1},d(t){t&&AN(e),jI(n)}}}function lDt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[1].id),FN(e,"class","card")},m(t,n){CN(t,e,n)},p(t,r){1&r&&n!==(n=t[1].id)&&FN(e,"id",n)},d(t){t&&AN(e)}}}function cDt(t){let e,n,r=t[1]+"";return{c(){e=IN("h2"),n=RN(r)},m(t,r){CN(t,e,r),TN(e,n)},p(t,e){1&e&&r!==(r=t[1]+"")&&BN(n,r)},d(t){t&&AN(e)}}}function uDt(t){let e,n,r=t[1],i=[];for(let e=0;e<r.length;e+=1)i[e]=hDt(JLt(t,r,e));return{c(){e=IN("div");for(let t=0;t<i.length;t+=1)i[t].c();n=ON(),FN(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){CN(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);TN(e,n)},p(t,s){if(1&s){let o;for(r=t[1],o=0;o<r.length;o+=1){const a=JLt(t,r,o);i[o]?i[o].p(a,s):(i[o]=hDt(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&AN(e),NN(i,t)}}}function hDt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[4]),FN(e,"class","card flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){CN(t,e,n)},p(t,r){1&r&&n!==(n=t[4])&&FN(e,"id",n)},d(t){t&&AN(e)}}}function dDt(t){let e,n;function r(t,n){return 1&n&&(e=null),null==e&&(e=!!Array.isArray(t[1])),e?uDt:"string"==typeof t[1]?cDt:lDt}let i=r(t,-1),s=i(t);return{c(){s.c(),n=PN()},m(t,e){s.m(t,e),CN(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&AN(n)}}}function pDt(t){let e,n,r=t[0]&&rDt(t);return{c(){r&&r.c(),e=PN()},m(t,i){r&&r.m(t,i),CN(t,e,i),n=!0},p(t,[n]){t[0]?r?(r.p(t,n),1&n&&NI(r,1)):(r=rDt(t),r.c(),NI(r,1),r.m(e.parentNode,e)):r&&(CI(),II(r,1,1,(()=>{r=null})),AI())},i(t){n||(NI(r),n=!0)},o(t){II(r),n=!1},d(t){r&&r.d(t),t&&AN(e)}}}function fDt(t,e,n){let{settings:r}=e;return iI((()=>{r.mount()})),t.$$set=t=>{"settings"in t&&n(0,r=t.settings)},[r]}class mDt extends HI{constructor(t){super(),WI(this,t,fDt,pDt,lN,{settings:0})}}function gDt(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r[11]=n,r}function yDt(t){let e,n,r,i,s=t[9]+"";return{c(){e=IN("a"),n=RN(s),r=ON(),FN(e,"href",i=`#${t[8]}`),FN(e,"class","ml-2 mr-5 flex items-center hover:text-black border-solid border-0 border-b-2 border-transparent svelte-1ut593v"),GN(e,"active",!t[4]&&t[2]===t[9])},m(t,i){CN(t,e,i),TN(e,n),TN(e,r)},p(t,r){2&r&&s!==(s=t[9]+"")&&BN(n,s),2&r&&i!==(i=`#${t[8]}`)&&FN(e,"href",i),22&r&&GN(e,"active",!t[4]&&t[2]===t[9])},d(t){t&&AN(e)}}}function bDt(t){let e,n,r;return{c(){e=$N("svg"),n=$N("circle"),r=$N("path"),FN(n,"cx","12"),FN(n,"cy","12"),FN(n,"r","3"),FN(r,"d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"width","24"),FN(e,"height","24"),FN(e,"viewBox","0 0 24 24"),FN(e,"fill","none"),FN(e,"stroke","currentColor"),FN(e,"stroke-width","2"),FN(e,"stroke-linecap","round"),FN(e,"stroke-linejoin","round"),FN(e,"class","feather feather-settings")},m(t,i){CN(t,e,i),TN(e,n),TN(e,r)},p:nN,d(t){t&&AN(e)}}}function vDt(t){let e,n,r,i;return e=new XI({props:{round:!0,type:"danger",$$slots:{default:[xDt]},$$scope:{ctx:t}}}),e.$on("click",t[5]),{c(){UI(e.$$.fragment),n=ON(),r=IN("span"),FN(r,"class","w-1")},m(t,s){VI(e,t,s),CN(t,n,s),CN(t,r,s),i=!0},p(t,n){const r={};4096&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(NI(e.$$.fragment,t),i=!0)},o(t){II(e.$$.fragment,t),i=!1},d(t){jI(e,t),t&&AN(n),t&&AN(r)}}}function xDt(t){let e,n,r;return{c(){e=$N("svg"),n=$N("path"),r=$N("line"),FN(n,"d","M18.36 6.64a9 9 0 1 1-12.73 0"),FN(r,"x1","12"),FN(r,"y1","2"),FN(r,"x2","12"),FN(r,"y2","12"),FN(e,"xmlns","http://www.w3.org/2000/svg"),FN(e,"width","24"),FN(e,"height","24"),FN(e,"viewBox","0 0 24 24"),FN(e,"fill","none"),FN(e,"stroke","currentColor"),FN(e,"stroke-width","2"),FN(e,"stroke-linecap","round"),FN(e,"stroke-linejoin","round"),FN(e,"class","feather feather-power")},m(t,i){CN(t,e,i),TN(e,n),TN(e,r)},p:nN,d(t){t&&AN(e)}}}function wDt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m=Object.entries(t[1]),g=[];for(let e=0;e<m.length;e+=1)g[e]=yDt(gDt(t,m,e));u=new XI({props:{round:!0,$$slots:{default:[bDt]},$$scope:{ctx:t}}}),u.$on("click",t[6]);let y=t[3]&&vDt(t);return{c(){e=IN("header"),n=IN("div"),r=IN("a"),i=IN("span"),s=RN(t[0]),o=ON(),a=IN("nav");for(let t=0;t<g.length;t+=1)g[t].c();l=ON(),c=IN("div"),UI(u.$$.fragment),h=ON(),d=IN("span"),p=ON(),y&&y.c(),FN(i,"class","mx-3 text-lg"),FN(r,"href","#/"),FN(r,"class","flex p-3 title-font font-medium items-center text-gray-900 mb-4 md:mb-0 border-solid border-0 border-r border-gray-200 svelte-1ut593v"),FN(a,"class","flex items-stretch justify-start flex-wrap text-base grow mx-4"),FN(d,"class","w-1"),FN(c,"class","flex items-center"),FN(n,"class","mx-auto flex flex-wrap flex-col md:flex-row items-stretch w-full"),FN(e,"class","bg-white text-gray-700 body-font")},m(t,m){CN(t,e,m),TN(e,n),TN(n,r),TN(r,i),TN(i,s),TN(n,o),TN(n,a);for(let t=0;t<g.length;t+=1)g[t].m(a,null);TN(n,l),TN(n,c),VI(u,c,null),TN(c,h),TN(c,d),TN(c,p),y&&y.m(c,null),f=!0},p(t,[e]){if((!f||1&e)&&BN(s,t[0]),22&e){let n;for(m=Object.entries(t[1]),n=0;n<m.length;n+=1){const r=gDt(t,m,n);g[n]?g[n].p(r,e):(g[n]=yDt(r),g[n].c(),g[n].m(a,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=m.length}const n={};4096&e&&(n.$$scope={dirty:e,ctx:t}),u.$set(n),t[3]?y?(y.p(t,e),8&e&&NI(y,1)):(y=vDt(t),y.c(),NI(y,1),y.m(c,null)):y&&(CI(),II(y,1,1,(()=>{y=null})),AI())},i(t){f||(NI(u.$$.fragment,t),NI(y),f=!0)},o(t){II(u.$$.fragment,t),II(y),f=!1},d(t){t&&AN(e),NN(g,t),jI(u),y&&y.d()}}}function _Dt(t,e,n){let{title:r}=e,{items:i}=e,{current:s}=e,{closable:o}=e,{showSettings:a=!1}=e;const l=oI();return t.$$set=t=>{"title"in t&&n(0,r=t.title),"items"in t&&n(1,i=t.items),"current"in t&&n(2,s=t.current),"closable"in t&&n(3,o=t.closable),"showSettings"in t&&n(4,a=t.showSettings)},[r,i,s,o,a,function(){setTimeout((()=>{l("quit")}),400)},function(){window.location.href=a?window.location.href.split("#")[0]+"#"+Object.keys(i)[Object.values(i).indexOf(s)]:window.location.href.split("#")[0]+"#settings"}]}class SDt extends HI{constructor(t){super(),WI(this,t,_Dt,wDt,lN,{title:0,items:1,current:2,closable:3,showSettings:4,quit:5})}get quit(){return this.$$.ctx[5]}}function kDt(t){let e;return{c(){e=RN(" ")},m(t,n){CN(t,e,n)},p:nN,d(t){t&&AN(e)}}}function TDt(e){let n;function r(e,n){return e[1][0]===t.LogLevel.Warning?CDt:e[1][0]===t.LogLevel.Error?MDt:EDt}let i=r(e),s=i(e);return{c(){s.c(),n=PN()},m(t,e){s.m(t,e),CN(t,n,e)},p(t,e){i===(i=r(t))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&AN(n)}}}function EDt(t){let e,n=(t[1][1]||"")+"";return{c(){e=RN(n)},m(t,n){CN(t,e,n)},p(t,r){2&r&&n!==(n=(t[1][1]||"")+"")&&BN(e,n)},d(t){t&&AN(e)}}}function MDt(t){let e,n,r=(t[1][1]||"")+"";return{c(){e=RN("Err:\n        "),n=RN(r)},m(t,r){CN(t,e,r),CN(t,n,r)},p(t,e){2&e&&r!==(r=(t[1][1]||"")+"")&&BN(n,r)},d(t){t&&AN(e),t&&AN(n)}}}function CDt(t){let e,n,r=(t[1][1]||"")+"";return{c(){e=RN("Warn:\n        "),n=RN(r)},m(t,r){CN(t,e,r),CN(t,n,r)},p(t,e){2&e&&r!==(r=(t[1][1]||"")+"")&&BN(n,r)},d(t){t&&AN(e),t&&AN(n)}}}function ADt(e){let n,r,i,s,o,a;function l(t,e){return t[1]?TDt:kDt}let c=l(e),u=c(e);return{c(){n=IN("footer"),r=IN("p"),u.c(),i=ON(),s=IN("p"),o=RN("© 2021 "),a=RN(e[0]),FN(r,"class","console svelte-i04gf3"),GN(r,"error",e[1]&&e[1][0]===t.LogLevel.Error),GN(r,"warning",e[1]&&e[1][0]===t.LogLevel.Warning),FN(s,"class","text-sm text-gray-500 sm:ml-4 sm:pl-4 sm:border-gray-200"),FN(n,"class","bg-white text-gray-600 border-t px-5 py-1 flex items-center justify-between flex-col sm:flex-row")},m(t,e){CN(t,n,e),TN(n,r),u.m(r,null),TN(n,i),TN(n,s),TN(s,o),TN(s,a)},p(e,[n]){c===(c=l(e))&&u?u.p(e,n):(u.d(1),u=c(e),u&&(u.c(),u.m(r,null))),2&n&&GN(r,"error",e[1]&&e[1][0]===t.LogLevel.Error),2&n&&GN(r,"warning",e[1]&&e[1][0]===t.LogLevel.Warning),1&n&&BN(a,e[0])},i:nN,o:nN,d(t){t&&AN(n),u.d()}}}function NDt(t,e,n){let r,{author:i}=e;const s=nG();return pN(t,s,(t=>n(1,r=t))),t.$$set=t=>{"author"in t&&n(0,i=t.author)},[i,r,s]}class IDt extends HI{constructor(t){super(),WI(this,t,NDt,ADt,lN,{author:0})}}function $Dt(t){let e,n,r,i,s,o,a,l,c,u,h;r=new SDt({props:{title:t[0],items:t[10].reduce(t[12],{}),current:t[9],showSettings:t[8],closable:t[4]}}),r.$on("quit",t[5]);const d=[ODt,RDt],p=[];function f(t,e){return t[8]?0:t[9]?1:-1}return~(o=f(t))&&(a=p[o]=d[o](t)),c=new IDt({props:{author:t[1]}}),{c(){e=IN("div"),n=IN("div"),UI(r.$$.fragment),i=ON(),s=IN("main"),a&&a.c(),l=ON(),UI(c.$$.fragment),FN(s,"class","main-container svelte-1da5cws"),FN(n,"class","app-container svelte-1da5cws"),FN(e,"class","marcelle fixed h-screen w-full max-w-full overflow-y-scroll overflow-x-hidden top-0 left-0 z-50")},m(t,a){CN(t,e,a),TN(e,n),VI(r,n,null),TN(n,i),TN(n,s),~o&&p[o].m(s,null),TN(n,l),VI(c,n,null),h=!0},p(e,n){t=e;const i={};1&n&&(i.title=t[0]),1088&n&&(i.items=t[10].reduce(t[12],{})),512&n&&(i.current=t[9]),256&n&&(i.showSettings=t[8]),16&n&&(i.closable=t[4]),r.$set(i);let l=o;o=f(t),o===l?~o&&p[o].p(t,n):(a&&(CI(),II(p[l],1,1,(()=>{p[l]=null})),AI()),~o?(a=p[o],a?a.p(t,n):(a=p[o]=d[o](t),a.c()),NI(a,1),a.m(s,null)):a=null);const u={};2&n&&(u.author=t[1]),c.$set(u)},i(e){h||(NI(r.$$.fragment,e),NI(a),NI(c.$$.fragment,e),yI((()=>{u||(u=RI(n,r$,{amount:10,duration:t[4]?400:0},!0)),u.run(1)})),h=!0)},o(e){II(r.$$.fragment,e),II(a),II(c.$$.fragment,e),u||(u=RI(n,r$,{amount:10,duration:t[4]?400:0},!1)),u.run(0),h=!1},d(t){t&&AN(e),jI(r),~o&&p[o].d(),jI(c),t&&u&&u.end()}}}function RDt(t){let e,n;return e=new gLt({props:{dashboard:t[2][t[9]]}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};516&n&&(r.dashboard=t[2][t[9]]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function ODt(t){let e,n;return e=new mDt({props:{settings:t[3]}}),{c(){UI(e.$$.fragment)},m(t,r){VI(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.settings=t[3]),e.$set(r)},i(t){n||(NI(e.$$.fragment,t),n=!0)},o(t){II(e.$$.fragment,t),n=!1},d(t){jI(e,t)}}}function PDt(t){let e,n,r,i;document.title=e=t[0];let s=t[7]&&$Dt(t);return{c(){n=ON(),s&&s.c(),r=PN()},m(t,e){CN(t,n,e),s&&s.m(t,e),CN(t,r,e),i=!0},p(t,[n]){(!i||1&n)&&e!==(e=t[0])&&(document.title=e),t[7]?s?(s.p(t,n),128&n&&NI(s,1)):(s=$Dt(t),s.c(),NI(s,1),s.m(r.parentNode,r)):s&&(CI(),II(s,1,1,(()=>{s=null})),AI())},i(t){i||(NI(s),i=!0)},o(t){II(s),i=!1},d(t){t&&AN(n),s&&s.d(t),t&&AN(r)}}}function LDt(t){let e=t.replace(/^\s+|\s+$/g,"");e=e.toLowerCase();const n="àáäâèéëêìíïîòóöôùúüûñç·/_,:;";for(let t=0,r=n.length;t<r;t++)e=e.replace(new RegExp(n.charAt(t),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(t));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e}function DDt(t,e,n){let r,i;const s=oI();let{title:o}=e,{author:a}=e,{dashboards:l={}}=e,{settings:c}=e,{page:u}=e,{closable:h}=e,d=!1;rI((()=>{n(7,d=!0)}));let p=!1,f=Object.keys(l)[0]||void 0;rI((()=>{try{const t=new nLt;t.route("settings",(()=>{n(8,p=!0),f&&l[f].destroy(),u.set("settings")})),i.forEach(((e,i)=>{t.route(e,(()=>{n(8,p=!1),f!==r[i]&&(f&&l[f].destroy(),n(9,f=r[i]),u.set(""===e?LDt(r[0]):e))}))}))}catch(t){console.log("Could not enable router",t)}}));return t.$$set=t=>{"title"in t&&n(0,o=t.title),"author"in t&&n(1,a=t.author),"dashboards"in t&&n(2,l=t.dashboards),"settings"in t&&n(3,c=t.settings),"page"in t&&n(11,u=t.page),"closable"in t&&n(4,h=t.closable)},t.$$.update=()=>{4&t.$$.dirty&&n(6,r=Object.keys(l)),64&t.$$.dirty&&n(10,i=[""].concat(r.slice(1).map(LDt)))},[o,a,l,c,h,function(){n(7,d=!1),setTimeout((()=>{s("quit")}),400)},r,d,p,f,i,u,(t,e,n)=>({...t,[e]:r[n]})]}class FDt extends HI{constructor(t){super(),WI(this,t,DDt,PDt,lN,{title:0,author:1,dashboards:2,settings:3,page:11,closable:4,quit:5})}get quit(){return this.$$.ctx[5]}}function zDt(t){return"string"==typeof t}function BDt(t){return Array.isArray(t)}class UDt{constructor(){this.name="settings",this.components=[],this.xModels=[],this.xDatasets=[],this.xPredictions=[],this.xDataStores=[]}use(...t){return this.components=this.components.concat(t),this}dataStores(...t){return this.xDataStores=t,this}models(...t){return this.xModels=t,this}datasets(...t){return this.xDatasets=t,this}predictions(...t){return this.xPredictions=t,this}mount(){for(const t of this.components)if(BDt(t))for(const e of t)e.mount();else zDt(t)||t.mount()}destroy(){for(const t of this.components)if(BDt(t))for(const e of t)e.destroy();else zDt(t)||t.destroy()}}class VDt{constructor({title:t="Hello, Marcelle!",author:e="author",closable:n=!1}){this.panels={},this.settings=new UDt,this.$active=new JH(!1,!0),this.$page=new JH("",!0),this.title=t,this.author=e,this.closable=n}page(t,e){return Object.keys(this.panels).includes(t)||(this.panels[t]=new QPt(t,e)),this.panels[t]}show(){this.app=new FDt({target:document.body,props:{title:this.title,author:this.author,dashboards:this.panels,settings:this.settings,page:this.$page,closable:this.closable}}),this.$active.set(!0),this.app.$on("quit",(()=>{var t;this.$active.set(!1),null===(t=this.app)||void 0===t||t.$destroy();for(const t of Object.values(this.panels))t.destroy();this.app=void 0}))}hide(){var t;null===(t=this.app)||void 0===t||t.quit()}}function jDt(t,e,n){const r=t.slice();return r[4]=e[n],r}function WDt(t,e,n){const r=t.slice();return r[7]=e[n].id,r}function HDt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[4].id)},m(t,n){CN(t,e,n)},p(t,r){8&r&&n!==(n=t[4].id)&&FN(e,"id",n)},d(t){t&&AN(e)}}}function GDt(t){let e,n,r=t[4],i=[];for(let e=0;e<r.length;e+=1)i[e]=qDt(WDt(t,r,e));return{c(){e=IN("div");for(let t=0;t<i.length;t+=1)i[t].c();n=ON(),FN(e,"class","flex flex-row flex-wrap items-stretch")},m(t,r){CN(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);TN(e,n)},p(t,s){if(8&s){let o;for(r=t[4],o=0;o<r.length;o+=1){const a=WDt(t,r,o);i[o]?i[o].p(a,s):(i[o]=qDt(a),i[o].c(),i[o].m(e,n))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(t){t&&AN(e),NN(i,t)}}}function qDt(t){let e,n;return{c(){e=IN("div"),FN(e,"id",n=t[7]),FN(e,"class","flex-none xl:flex-1 w-full xl:w-auto")},m(t,n){CN(t,e,n)},p(t,r){8&r&&n!==(n=t[7])&&FN(e,"id",n)},d(t){t&&AN(e)}}}function XDt(t){let e,n;function r(t,n){return 8&n&&(e=null),null==e&&(e=!!Array.isArray(t[4])),e?GDt:HDt}let i=r(t,-1),s=i(t);return{c(){s.c(),n=PN()},m(t,e){s.m(t,e),CN(t,n,e)},p(t,e){i===(i=r(t,e))&&s?s.p(t,e):(s.d(1),s=i(t),s&&(s.c(),s.m(n.parentNode,n)))},d(t){s.d(t),t&&AN(n)}}}function YDt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m=t[3],g=[];for(let e=0;e<m.length;e+=1)g[e]=XDt(jDt(t,m,e));return{c(){e=IN("div"),n=IN("div"),r=IN("div"),i=IN("h3"),s=RN(t[0]),o=RN(".\n        "),a=RN(t[1]),l=ON(),c=IN("div"),u=IN("p"),h=RN(t[2]),d=ON(),p=IN("div"),f=IN("div");for(let t=0;t<g.length;t+=1)g[t].c();FN(i,"class","text-lg leading-6 font-medium text-gray-900"),FN(i,"id","modal-headline"),FN(u,"class","text-sm leading-5 text-gray-500"),FN(c,"class","mt-2"),FN(r,"class","desc svelte-tq2nfn"),FN(f,"class","text-center"),FN(p,"class","components svelte-tq2nfn"),FN(n,"class","flex flex-col w-full"),FN(e,"class","bg-white px-4 pt-2 pb-4 sm:px-6 sm:pb-4 flex")},m(t,m){CN(t,e,m),TN(e,n),TN(n,r),TN(r,i),TN(i,s),TN(i,o),TN(i,a),TN(r,l),TN(r,c),TN(c,u),TN(u,h),TN(n,d),TN(n,p),TN(p,f);for(let t=0;t<g.length;t+=1)g[t].m(f,null)},p(t,[e]){if(1&e&&BN(s,t[0]),2&e&&BN(a,t[1]),4&e&&BN(h,t[2]),8&e){let n;for(m=t[3],n=0;n<m.length;n+=1){const r=jDt(t,m,n);g[n]?g[n].p(r,e):(g[n]=XDt(r),g[n].c(),g[n].m(f,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=m.length}},i:nN,o:nN,d(t){t&&AN(e),NN(g,t)}}}function KDt(t,e,n){let{index:r}=e,{title:i}=e,{description:s}=e,{components:o=[]}=e;return t.$$set=t=>{"index"in t&&n(0,r=t.index),"title"in t&&n(1,i=t.title),"description"in t&&n(2,s=t.description),"components"in t&&n(3,o=t.components)},[r,i,s,o]}class ZDt extends HI{constructor(t){super(),WI(this,t,KDt,YDt,lN,{index:0,title:1,description:2,components:3})}}function JDt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function QDt(t){let e;return{c(){e=RN("Close")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function tFt(t){let e,n,r;function i(){return t[6](t[12])}return{c(){e=IN("button"),FN(e,"class","page-button svelte-1r1rt01"),GN(e,"current",t[3]===t[12])},m(t,s){CN(t,e,s),n||(r=LN(e,"click",i),n=!0)},p(n,r){t=n,8&r&&GN(e,"current",t[3]===t[12])},d(t){t&&AN(e),n=!1,r()}}}function eFt(t){let e;return{c(){e=RN("Previous")},m(t,n){CN(t,e,n)},d(t){t&&AN(e)}}}function nFt(t){let e,n=t[3]>=t[0].length-1?"Finish":"Next";return{c(){e=RN(n)},m(t,n){CN(t,e,n)},p(t,r){9&r&&n!==(n=t[3]>=t[0].length-1?"Finish":"Next")&&BN(e,n)},d(t){t&&AN(e)}}}function rFt(t){let e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,y,b,v,x;o=new ZDt({props:{title:t[0][t[3]].attr.title,description:t[0][t[3]].attr.description,components:t[0][t[3]].components,index:t[3]+1}}),u=new XI({props:{type:"danger",$$slots:{default:[QDt]},$$scope:{ctx:t}}}),u.$on("click",t[2]);let w=Array(t[0].length),_=[];for(let e=0;e<w.length;e+=1)_[e]=tFt(JDt(t,w,e));return m=new XI({props:{disabled:t[3]<=0,$$slots:{default:[eFt]},$$scope:{ctx:t}}}),m.$on("click",t[7]),y=new XI({props:{variant:"filled",type:t[3]>=t[0].length-1?"success":"default",$$slots:{default:[nFt]},$$scope:{ctx:t}}}),y.$on("click",t[8]),{c(){e=IN("div"),n=IN("div"),r=IN("div"),i=ON(),s=IN("div"),UI(o.$$.fragment),a=ON(),l=IN("div"),c=IN("div"),UI(u.$$.fragment),h=ON(),d=IN("div");for(let t=0;t<_.length;t+=1)_[t].c();p=ON(),f=IN("div"),UI(m.$$.fragment),g=ON(),UI(y.$$.fragment),FN(r,"class","absolute inset-0 bg-gray-500 opacity-50"),FN(n,"class","absolute min-h-screen inset-0 transition-opacity"),FN(d,"class","text-center"),FN(f,"class","text-right"),FN(l,"class","bg-white border-t border-gray-300 px-4 py-2 grid grid-cols-3"),FN(s,"class","bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-3xl sm:w-full"),FN(e,"class","marcelle wizard svelte-1r1rt01")},m(w,S){CN(w,e,S),TN(e,n),TN(n,r),TN(e,i),TN(e,s),VI(o,s,null),TN(s,a),TN(s,l),TN(l,c),VI(u,c,null),TN(l,h),TN(l,d);for(let t=0;t<_.length;t+=1)_[t].m(d,null);TN(l,p),TN(l,f),VI(m,f,null),TN(f,g),VI(y,f,null),b=!0,v||(x=LN(r,"click",t[5]),v=!0)},p(t,[e]){const n={};9&e&&(n.title=t[0][t[3]].attr.title),9&e&&(n.description=t[0][t[3]].attr.description),9&e&&(n.components=t[0][t[3]].components),8&e&&(n.index=t[3]+1),o.$set(n);const r={};if(8192&e&&(r.$$scope={dirty:e,ctx:t}),u.$set(r),25&e){let n;for(w=Array(t[0].length),n=0;n<w.length;n+=1){const r=JDt(t,w,n);_[n]?_[n].p(r,e):(_[n]=tFt(r),_[n].c(),_[n].m(d,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=w.length}const i={};8&e&&(i.disabled=t[3]<=0),8192&e&&(i.$$scope={dirty:e,ctx:t}),m.$set(i);const s={};9&e&&(s.type=t[3]>=t[0].length-1?"success":"default"),8201&e&&(s.$$scope={dirty:e,ctx:t}),y.$set(s)},i(t){b||(NI(o.$$.fragment,t),NI(u.$$.fragment,t),NI(m.$$.fragment,t),NI(y.$$.fragment,t),b=!0)},o(t){II(o.$$.fragment,t),II(u.$$.fragment,t),II(m.$$.fragment,t),II(y.$$.fragment,t),b=!1},d(t){t&&AN(e),jI(o),jI(u),NN(_,t),jI(m),jI(y),v=!1,x()}}}function iFt(t,e,n){let r,i=nN,s=()=>(i(),i=hN(a,(t=>n(3,r=t))),a);t.$$.on_destroy.push((()=>i()));let{pages:o}=e,{current:a}=e;function l(t){if(t>=0&&t<=o.length-1){for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.destroy();else t.destroy();a.set(t)}}s(),iI((()=>{for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.mount();else t.mount()})),sI((()=>{for(const t of o[a.get()].components)if(Array.isArray(t))for(const e of t)e.destroy();else t.destroy()}));const c=oI();function u(){c("quit")}return t.$$set=t=>{"pages"in t&&n(0,o=t.pages),"current"in t&&s(n(1,a=t.current))},[o,a,u,r,l,function(){u()},t=>l(t),()=>{l(r-1)},()=>{a.get()<o.length-1?l(r+1):u()}]}class sFt extends HI{constructor(t){super(),WI(this,t,iFt,rFt,lN,{pages:0,current:1,quit:2})}get quit(){return this.$$.ctx[2]}}class oFt{constructor(t){this.pageFn=t,this.components=[],this.attr={title:"",description:""}}title(t){return this.attr.title=t,this}description(t){return this.attr.description=t,this}use(...t){return this.components=this.components.concat(t),this}page(){return this.pageFn()}}class aFt{constructor(){this.pages=[],this.app=void 0,this.$current=new JH(0,!0),this.$current.start()}page(){const t=new oFt(this.page.bind(this));return this.pages.push(t),t}show(){this.app=new sFt({target:document.body,props:{pages:this.pages,current:this.$current}}),this.app.$on("quit",(()=>{var t;null===(t=this.app)||void 0===t||t.$destroy(),this.app=void 0}))}hide(){var t;null===(t=this.app)||void 0===t||t.quit()}}t.ArrayIterable=uG,t.Component=mG,t.LazyIterable=cG,t.Model=vQ,t.ServiceIterable=bJ,t.Stream=JH,t.TFJSBaseModel=H8,t.TFJSCustomClassifier=M7,t.TFJSCustomModel=E7,t.account=function(...t){return new D7(...t)},t.batchPrediction=function(...t){return new W7(...t)},t.button=function(...t){return new K7(...t)},t.cocoSsd=function(...t){return new l9(...t)},t.confidencePlot=function(...t){return new Eut(...t)},t.confusionMatrix=function(...t){return new Hut(...t)},t.createStream=function(t,e=!1){return new JH(t,e)},t.dashboard=function(t){return new VDt(t)},t.dataStore=wJ,t.dataset=function(t,e){return new yQ(t,e)},t.dataset2tfjs=k7,t.datasetBrowser=function(...t){return new lht(...t)},t.datasetScatter=function(...t){return new Ddt(...t)},t.datasetTable=function(t,e){return new Kdt(t,e)},t.detectionBoxes=function(...t){return new ept(...t)},t.fileUpload=function(...t){return new lpt(...t)},t.genericChart=gut,t.getLogStream=nG,t.imageDisplay=function(...t){return new ppt(...t)},t.imageUpload=function(...t){return new Ipt(...t)},t.isDataset=bQ,t.isStream=ZH,t.iterableFromArray=function(t){return new uG(t)},t.iterableFromService=vJ,t.kmeansClustering=function(...t){return new Mft(...t)},t.knnClassifier=function(...t){return new $ft(...t)},t.logger=eG,t.mergeDeep=dG,t.mlpClassifier=function(...t){return new Rft(...t)},t.mlpRegressor=function(...t){return new Oft(...t)},t.mobileNet=function(...t){return new Qft(...t)},t.modelParameters=function(t,e={}){if(!t.parameters)throw new Error("The argument is not a valid component with parameters");return new gmt(t,e)},t.notification=DU,t.number=function(...t){return new wmt(...t)},t.numberArray=function(...t){return new Emt(...t)},t.onnxModel=function(t){return new Lmt(t)},t.pca=function(...t){return new Fmt(...t)},t.poseDetection=function(...t){return new bbt(...t)},t.predictionProgress=function(t){if(!t.$status)throw new Error("The argument is not a valid Batch Prediction");const e=t.$status.map((({status:t,count:e,total:n})=>{let r="default",i=n>0?(e+1)/n:null;return"error"===t&&(r="danger"),"idle"===t&&(r="idle",i=0),["success","loaded"].includes(t)&&(r="success",i=1),["start","loading"].includes(t)&&(i=null),{message:`Status: ${t}`,progress:i,type:r}})).hold(),n=j7(e);return n.title="Prediction Progress",n},t.progressBar=j7,t.scatterPlot=function(...t){return new XIt(...t)},t.select=function(...t){return new QIt(...t)},t.sketchPad=function(...t){return new u$t(...t)},t.slider=function(...t){return new K$t(...t)},t.text=Sut,t.textArea=function(...t){return new eRt(...t)},t.textField=function(){const t=new Error("textField has been renamed to textInput");return t.name="Deprecation Notice",sG(t),aRt()},t.textInput=aRt,t.tfjsModel=function(t){return new yRt(t)},t.throwError=sG,t.toggle=function(...t){return new _Rt(...t)},t.trainingHistory=function(...t){return new cOt(...t)},t.trainingPlot=ORt,t.trainingProgress=function(t){if(!t.$training)throw new Error("The argument is not a valid MLP");const e=t.$training.map((({status:t,epoch:e,epochs:n})=>{let r="default",i=n>0?e/n:null;return"error"===t&&(r="danger"),"idle"===t&&(r="idle",i=0),["success","loaded"].includes(t)&&(r="success",i=1),["start","loading"].includes(t)&&(i=null),{message:`Status: ${t}`,progress:i,type:r}})).hold(),n=new V7(e);return n.title="Training Progress",n},t.umap=function(...t){return new WPt(...t)},t.webcam=function(...t){return new KPt(...t)},t.wizard=function(){return new aFt},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=marcelle.bundle.umd.js.map
